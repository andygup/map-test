import{BT as e,Mg as t,Og as n,Ux as r,_S as i,fC as a,kg as o,uE as s,vd as c,vv as l}from"./index-CZ4oMP1N.js";import{t as u}from"./MeshTransform-mXzx59gA.js";import{n as d,s as f}from"./editingSupport-37XIr8jM.js";async function p(e,a,s){let{geometry:c}=a,l={...a.attributes};if(s!=null&&c?.type===`mesh`){let{transformFieldRoles:a}=s,{origin:d,spatialReference:f,vertexSpace:p}=c,m=c.transform??new u,h=p.type===`local`,g=e.spatialReference,_=g.isGeographic,v=i(g,f),y=o(f,g)&&n(f,g);if(!(h&&_&&y||!h&&!_&&v))return null;let b=t(d,f,g);if(b==null)return null;if(l[a.originX]=b.x,l[a.originY]=b.y,l[a.originZ]=b.z??0,m!=null){let{translation:e,scale:t,rotation:n}=m,i=h?1:r(f)/r(g);l[a.translationX]=e[0]*i,l[a.translationY]=e[2]*i,l[a.translationZ]=-e[1]*i,l[a.scaleX]=t[0],l[a.scaleY]=t[2],l[a.scaleZ]=t[1],l[a.rotationX]=n[0],l[a.rotationY]=n[2],l[a.rotationZ]=-n[1],l[a.rotationDeg]=n[3]}return{attributes:l}}return c==null?{attributes:l}:c.type===`mesh`||c.type===`extent`?null:{geometry:c.toJSON(),attributes:l}}async function m(e,t){let n=await Promise.all((t.addAttachments??[]).map(t=>h(e,t))),r=await Promise.all((t.updateAttachments??[]).map(t=>h(e,t))),i=t.deleteAttachments??[];return n.length||r.length||i.length?{adds:n,updates:r,deletes:[...i]}:null}async function h(e,t){let{feature:n,attachment:r}=t,{globalId:i,name:o,contentType:s,data:c,uploadId:l}=r,u={globalId:i};if(n&&(`attributes`in n?u.parentGlobalId=n.attributes?.[e.globalIdField]:n.globalId&&(u.parentGlobalId=n.globalId)),l)u.uploadId=l;else if(c){let e=await a(c);e&&(u.contentType=e.mediaType,u.data=e.data),c instanceof File&&(u.name=c.name)}return o&&(u.name=o),s&&(u.contentType=s),u}function g(e,t,n){if(!t||t.length===0)return[];if(n&&f(t))return t.map(e=>e.globalId);if(d(t))return t.map(e=>e.objectId);let r=n?e.globalIdField:e.objectIdField;return r?t.map(e=>e.getAttribute(r)):[]}function _(e){let t=e?.assetMaps;if(t){for(let e of t.addResults)e.success||s.getLogger(`esri.layers.graphics.sources.support.sourceUtils`).error(`Failed to map asset to feature with globalId ${e.globalId}.`);for(let e of t.updateResults)e.success||s.getLogger(`esri.layers.graphics.sources.support.sourceUtils`).error(`Failed to map asset to feature with globalId ${e.globalId}.`)}let n=e?.attachments,r={addFeatureResults:e?.addResults?.map(v)??[],updateFeatureResults:e?.updateResults?.map(v)??[],deleteFeatureResults:e?.deleteResults?.map(v)??[],addAttachmentResults:n?.addResults?n.addResults.map(v):[],updateAttachmentResults:n?.updateResults?n.updateResults.map(v):[],deleteAttachmentResults:n?.deleteResults?n.deleteResults.map(v):[]};return e?.editMoment&&(r.editMoment=e.editMoment),r}function v(t){let n=!0===t.success?null:t.error||{code:void 0,description:`Feature edit failed`};return{objectId:t.objectId,globalId:t.globalId,error:n?new e(`feature-layer-source:edit-failure`,n.description,{code:n.code}):null}}function y(e,t){return new c({attributes:e.attributes,geometry:l({...e.geometry,spatialReference:t})})}function b(e,t){return{adds:e?.adds?.map(e=>y(e,t))||[],updates:e?.updates?.map(e=>({original:y(e[0],t),current:y(e[1],t)}))||[],deletes:e?.deletes?.map(e=>y(e,t))||[],spatialReference:t}}function x(e){let t=e.details.raw,n=+t.code,r=+t.extendedCode;return n===500&&(r===-2147217144||r===-2147467261)}export{x as a,m as i,v as n,p as o,g as r,_ as s,b as t};