import{$p as e,I_ as t,Xp as n,Yp as r,tm as i,vn as a,wn as o}from"./index-CZ4oMP1N.js";import"./ImmutableArray-C3KNQCVd.js";import{X as s,it as c,lt as l,nt as u,s as d,v as f,y as p}from"./Dictionary-ByWMrwnf.js";import"./shared-CBxUlSgW.js";import"./number-bp6QQFrm.js";import{t as m}from"./containerUtils-CNnsTsDa.js";import{i as h,t as g}from"./WhereClause-CO9FHcAq.js";import{t as _}from"./fieldStats-B5F0iEW-.js";async function v(t,n,r,i){if(r.length===1){if(e(r[0]))return _(t,r[0],l(r[1],-1));if(u(r[0]))return _(t,r[0].toArray(),l(r[1],-1))}else if(r.length===2){if(e(r[0]))return _(t,r[0],l(r[1],-1));if(u(r[0]))return _(t,r[0].toArray(),l(r[1],-1));if(d(r[0])){let e=await r[0].load(),a=await b(g.create(r[1],{fieldsIndex:e.getFieldsIndex(),timeZone:e.dateFieldsTimeZoneDefaultUTC}),i,n);return y(n,await r[0].calculateStatistic(t,a,l(r[2],1e3),n.abortSignal))}}else if(r.length===3&&d(r[0])){let e=await r[0].load(),a=await b(g.create(r[1],{fieldsIndex:e.getFieldsIndex(),timeZone:e.dateFieldsTimeZoneDefaultUTC}),i,n);return y(n,await r[0].calculateStatistic(t,a,l(r[2],1e3),n.abortSignal))}return _(t,r,-1)}function y(e,n){return h.isTimestampOffset(n)?a.fromReaderAsTimeStampOffset(n.toStorageFormat()):r(n)?a.dateJSAndZoneToArcadeDate(n,p(e)):t.isDateTime(n)?a.dateTimeToArcadeDate(n):n}async function b(e,t,n){let r=e.getVariables();if(r.length>0){let i={};for(let e of r)i[e]=t.evaluateIdentifier(n,{name:e});e.parameters=i}return e}function x(t){t.mode===`async`&&(t.functions.stdev=function(e,n){return t.standardFunctionAsync(e,n,(n,r,i)=>v(`stdev`,e,i,t))},t.functions.variance=function(e,n){return t.standardFunctionAsync(e,n,(n,r,i)=>v(`variance`,e,i,t))},t.functions.average=function(e,n){return t.standardFunctionAsync(e,n,(n,r,i)=>v(`mean`,e,i,t))},t.functions.mean=function(e,n){return t.standardFunctionAsync(e,n,(n,r,i)=>v(`mean`,e,i,t))},t.functions.sum=function(e,n){return t.standardFunctionAsync(e,n,(n,r,i)=>v(`sum`,e,i,t))},t.functions.min=function(e,n){return t.standardFunctionAsync(e,n,(n,r,i)=>v(`min`,e,i,t))},t.functions.max=function(e,n){return t.standardFunctionAsync(e,n,(n,r,i)=>v(`max`,e,i,t))},t.functions.count=function(r,i){return t.standardFunctionAsync(r,i,async(t,a,c)=>{if(s(c,1,1,r,i),c[0]==null)return 0;if(d(c[0]))return c[0].count(t.abortSignal);if(e(c[0])||n(c[0]))return c[0].length;if(u(c[0]))return c[0].length();if(f(c[0]))return c[0].entryCount();throw new o(r,`InvalidParameter`,i)})},t.functions.isempty=function(e,n){return t.standardFunctionAsync(e,n,async(e,t,n)=>{if(s(n,1,2,e,t),n.length>=2&&!i(n[1]))throw new o(e,`InvalidParameter`,t);return l(n[1],!1)?d(n[0])?await n[0].isEmpty(e.abortSignal):m(n[0]):c(n[0])})})}export{x as registerFunctions};