import{Hc as e,Mc as t,Sv as n,ig as r}from"./index-CZ4oMP1N.js";import{b as i}from"./CIMSymbolHelper-l5sn5wJj.js";import{f as a}from"./rasterizingUtils-CKtfcOpu.js";var o=.45;function s(e){switch(e.type){case`CIMPointSymbol`:{let t=e.symbolLayers;if(!t||t.length!==1)return null;let n=t[0];return n.type===`CIMVectorMarker`?s(n):null}case`CIMVectorMarker`:{let t=e.markerGraphics;if(!t||t.length!==1)return null;let n=t[0];if(!n)return null;let r=n.geometry,i=d(r);if(!i)return null;let a=n.symbol;if(!a||a.type!==`CIMPolygonSymbol`&&a.type!==`CIMLineSymbol`||a.symbolLayers?.some(e=>!!e.effects))return null;let o=0;for(let e of a.symbolLayers??[])o=Math.max(e.type===`CIMSolidStroke`?e.width:0,o);let{sdfTextureSize:s,sdfPaddingRatio:c}=m(i,e.frame,e.size,e.anchorPoint,e.anchorPointUnits!==`Relative`,o,e.scaleSymbolsProportionally);return{type:`sdf`,geometry:r,sdfTextureSize:s,sdfPaddingRatio:c,asFill:a.type===`CIMPolygonSymbol`}}}}function c(e){return e?e.rings?e.rings:e.paths?e.paths:e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:null:null}function l(e){let t=1/0,n=-1/0,r=1/0,a=-1/0;for(let i of e)for(let e of i)e[0]<t&&(t=e[0]),e[0]>n&&(n=e[0]),e[1]<r&&(r=e[1]),e[1]>a&&(a=e[1]);return new i(t,r,n-t,a-r)}function u(e){let t=1/0,n=-1/0,r=1/0,i=-1/0;for(let a of e)for(let e of a)e[0]<t&&(t=e[0]),e[0]>n&&(n=e[0]),e[1]<r&&(r=e[1]),e[1]>i&&(i=e[1]);return[t,r,n,i]}function d(e){return e?e.rings?u(e.rings):e.paths?u(e.paths):n(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function f(e,t,n){let[r,i,a,o]=d(e),s=a-r,c=o-i,l=t,u=Math.floor(.5*(l*n-4)),f=(l-2*(u+4))/Math.max(s,c),p=Math.round(s*f),m=Math.round(c*f);return{pixelDimensions:[s,c],texelDimensions:[Math.round((p+2*u)/f),Math.round((m+2*u)/f)]}}var p=1.61803;function m(e,t,n,i,a,s,c){let[l,u,d,f]=e;if(d<l||f<u)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5,sdfTextureSize:128};let m=d-l,h=f-u,g=Math.max(m,h),_,v=.5;{!c&&t!=null&&(s*=(t.ymax-t.ymin)/n);let e=s/(s+g);e>o&&e<1&&(v=Math.min(e+.1,.99))}{let e=(g+s)/h,t=r(n)*e;_=Math.floor(t*p+8),_=1<<32-Math.clz32(_-1),_=Math.max(_,128)}let y=_,b=Math.floor(.5*(y*v-4)),x=(y-2*(b+4))/g,S=Math.round(m*x)+2*b,C=Math.round(h*x)+2*b,w=1;t&&(w=C*(1-v)/((t.ymax-t.ymin)*x));let T=0,E=0,D=1;i&&(a?t&&n&&t.ymax-t.ymin>0&&(D=(t.xmax-t.xmin)/(t.ymax-t.ymin),T=i.x/(n*D),E=i.y/n):(T=i.x,E=i.y)),t&&(T=.5*(t.xmax+t.xmin)+T*(t.xmax-t.xmin),E=.5*(t.ymax+t.ymin)+E*(t.ymax-t.ymin)),T-=l,E-=u,T*=x,E*=x,T+=b,E+=b;let O=T/S-.5,k=E/C-.5;return a&&n&&(O*=n*D,k*=n),{frameSizeRatio:w,anchorX:O,anchorY:k,widthRatio:D,sdfTextureSize:_,sdfPaddingRatio:v}}function h(e){let t=c(e.geometry),n=l(t),r=e.sdfTextureSize,i=Math.floor(.5*(r*e.sdfPaddingRatio-4)),a=r-2*(i+4),o=a/Math.max(n.width,n.height),s=Math.round(n.width*o)+2*i,u=Math.round(n.height*o)+2*i,d=[];for(let r of t)if(r&&r.length>1){let t=[];for(let a of r){let[r,s]=a;r-=n.x,s-=n.y,r*=o,s*=o,r+=i-.5,s+=i-.5,e.asFill?t.push([r,s]):t.push([Math.round(r),Math.round(s)])}if(e.asFill){let e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}d.push(t)}let f=g(d,s,u,i);return e.asFill&&_(d,s,u,i,f),{data:v(f,i),width:s,height:u,sdfPaddingRatio:e.sdfPaddingRatio,sdfDecodeCoeff:2*i/a}}function g(e,t,n,r){let i=t*n,a=Array(i),o=r*r+1;for(let e=0;e<i;++e)a[e]=o;for(let i of e){let e=i.length;for(let o=1;o<e;++o){let e=i[o-1],s=i[o],c,l,u,d;e[0]<s[0]?(c=e[0],l=s[0]):(c=s[0],l=e[0]),e[1]<s[1]?(u=e[1],d=s[1]):(u=s[1],d=e[1]);let f=Math.floor(c)-r,p=Math.floor(l)+r,m=Math.floor(u)-r,h=Math.floor(d)+r;f<0&&(f=0),p>t&&(p=t),m<0&&(m=0),h>n&&(h=n);let g=s[0]-e[0],_=s[1]-e[1],v=g*g+_*_;for(let r=f;r<p;r++)for(let i=m;i<h;i++){let o=r+.5,c=i+.5,l,u,d=(o-e[0])*g+(c-e[1])*_;d<0?(l=e[0],u=e[1]):d>v?(l=s[0],u=s[1]):(d/=v,l=e[0]+d*g,u=e[1]+d*_);let f=(o-l)*(o-l)+(c-u)*(c-u),p=(n-i-1)*t+r;f<a[p]&&(a[p]=f)}}}for(let e=0;e<i;++e)a[e]=Math.sqrt(a[e]);return a}function _(e,t,n,r,i){for(let a of e){let e=a.length;for(let o=1;o<e;++o){let e=a[o-1],s=a[o],c,l,u,d;e[0]<s[0]?(c=e[0],l=s[0]):(c=s[0],l=e[0]),e[1]<s[1]?(u=e[1],d=s[1]):(u=s[1],d=e[1]);let f=Math.floor(c),p=Math.floor(l)+1,m=Math.floor(u),h=Math.floor(d)+1;f<r&&(f=r),p>t-r&&(p=t-r),m<r&&(m=r),h>n-r&&(h=n-r);for(let a=m;a<h;++a){if(e[1]>a==s[1]>a)continue;let o=a+.5,c=(n-a-1)*t;for(let t=f;t<p;++t)t+.5<(s[0]-e[0])*(o-e[1])/(s[1]-e[1])+e[0]&&(i[c+t]=-i[c+t]);for(let e=r;e<f;++e)i[c+e]=-i[c+e]}}}}function v(e,t){let n=2*t,r=e.length,i=new Uint8Array(4*r);for(let t=0;t<r;++t){let r=.5-e[t]/n;a(r,i,4*t)}return i}export{h as a,s as i,m as n,f as r,d as t};