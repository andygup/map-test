import{AT as e,BT as t,DT as n,Hw as r,Jf as i,Jw as a,OT as o,Vh as s,XS as c,ZS as l,Zf as u,ax as d,ba as f,g as p,gC as m,gD as h,ha as g,jT as _,pD as v,rd as y,wi as b,wx as x,xa as S,ya as C,zi as w}from"./index-ByaFsVj4.js";import"./QueryEngineCapabilities-COyCnRVj.js";import{i as T}from"./clientSideDefaults-8lL7sncR.js";var E=Symbol(`isCSVGraphicOrigin`),D,O=class extends f{get[(D=E,i)](){return this.layer}get[u](){return this.layer}get[S](){return this.layer}constructor(e){super(),this[D]=!0,this.type=`csv`,this.layer=e}get id(){return this.layer.id}},k=class extends s{constructor(e){super(e),this.type=`csv`,this.refresh=r(async e=>{await this.load();let{extent:t,timeExtent:n}=await this._connection.invoke(`refresh`,e);return t&&(this.sourceJSON.extent=t),n&&(this.sourceJSON.timeInfo.timeExtent=[n.start,n.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){await this.load(t);let n=await this._connection.invoke(`queryFeatures`,e?e.toJSON():null,t);return g.fromJSON(n)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._connection.invoke(`queryFeatures`,e?e.toJSON():null,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._connection.invoke(`queryFeatureCount`,e?e.toJSON():null,t)}async queryObjectIds(e,t={}){return await this.load(t),this._connection.invoke(`queryObjectIds`,e?e.toJSON():null,t)}async queryExtent(e,t={}){await this.load(t);let n=await this._connection.invoke(`queryExtent`,e?e.toJSON():null,t);return{count:n.count,extent:d.fromJSON(n.extent)}}async querySnapping(e,t={}){return await this.load(t),this._connection.invoke(`querySnapping`,e,t)}async queryAttributeBins(e,t={}){return await this.load(),this._connection.invoke(`queryAttributeBins`,e?e.toJSON():null,t)}async _startWorker(e){this._connection=await C(`CSVSourceWorker`,{strategy:v(`feature-layers-workers`)?`dedicated`:`local`,signal:e,registryTarget:this});let{url:t,delimiter:n,fields:r,latitudeField:i,longitudeField:a,spatialReference:o,timeInfo:s}=this.loadOptions,c=await this._connection.invoke(`load`,{url:t,customParameters:this.customParameters,parsingOptions:{delimiter:n,fields:r?.map(e=>e.toJSON()),latitudeField:i,longitudeField:a,spatialReference:o?.toJSON(),timeInfo:s?.toJSON()}},{signal:e});this.locationInfo=c.locationInfo,this.sourceJSON=c.layerDefinition,this.delimiter=c.delimiter}};h([n()],k.prototype,`type`,void 0),h([n()],k.prototype,`loadOptions`,void 0),h([n()],k.prototype,`customParameters`,void 0),h([n()],k.prototype,`locationInfo`,void 0),h([n()],k.prototype,`sourceJSON`,void 0),h([n()],k.prototype,`delimiter`,void 0),k=h([o(`esri.layers.graphics.sources.CSVSource`)],k);function A(e,n){throw new t(n,`CSVLayer (title: ${e.title}, id: ${e.id}) cannot be saved to a portal item`)}var j=class extends p{constructor(...e){super(...e),this.geometryType=`point`,this.capabilities=T(!1,!1),this.delimiter=null,this.editingEnabled=!1,this.fields=null,this.graphicOrigin=new O(this),this.latitudeField=null,this.locationType=`coordinates`,this.longitudeField=null,this.operationalLayerType=`CSV`,this.outFields=[`*`],this.path=null,this.spatialReference=x.WGS84,this.source=null,this.type=`csv`}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}load(e){let t=e==null?null:e.signal,n=this.loadFromPortal({supportedTypes:[`CSV`],supportsData:!1},e).catch(a).then(async()=>this.initLayerProperties(await this.createGraphicsSource(t)));return this.addResolvingPromise(n),Promise.resolve(this)}get portalItem(){return super.portalItem}set portalItem(e){super.portalItem=e}set fieldConfigurations(e){}get fieldConfigurations(){}get isTable(){return this.loaded&&this.geometryType==null}readWebMapLabelsVisible(e,t){return t.showLabels==null?!!t.layerDefinition?.drawingInfo?.labelingInfo:t.showLabels}writePopupTemplate(e,t,n,r){e&&(t[n]=e.toJSON(r))}set url(e){if(!e)return void this._set(`url`,e);let t=m(e);this._set(`url`,t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async createGraphicsSource(e){let t=new k({loadOptions:{delimiter:this.delimiter,fields:this.fields,latitudeField:this.latitudeField??void 0,longitudeField:this.longitudeField??void 0,spatialReference:this.spatialReference??void 0,timeInfo:this.timeInfo??void 0,url:this.url},customParameters:this.customParameters??void 0});return this._set(`source`,t),await t.load({signal:e}),this.read({locationInfo:t.locationInfo,columnDelimiter:t.delimiter},{origin:`service`,url:this.parsedUrl}),t}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(y.from(e)||this.createQuery())).then(e=>{if(e?.features)for(let t of e.features)t.layer=t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(y.from(e)||this.createQuery())}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(y.from(e)||this.createQuery()))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(y.from(e)||this.createQuery()))}read(e,t){super.read(e,t),t?.origin===`service`&&this.revert([`latitudeField`,`longitudeField`],`service`)}write(e,t){return super.write(e,{...t,writeLayerSchema:!0})}clone(){throw new t(`csv-layer:clone`,`CSVLayer (title: ${this.title}, id: ${this.id}) cannot be cloned`)}async save(e){return A(this,`csv-layer:save`)}async saveAs(e,t){return A(this,`csv-layer:save-as`)}async hasDataChanged(){try{let{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return t!=null&&this.read(t,{origin:`service`,url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_verifyFields(){}_verifySource(){}_hasMemorySource(){return!1}};h([n(b)],j.prototype,`attributeTableTemplate`,void 0),h([n({type:w})],j.prototype,`elevationInfo`,void 0),h([n({readOnly:!0,json:{read:!1,write:!1}})],j.prototype,`capabilities`,void 0),h([n({type:[`,`,` `,`;`,`|`,`	`],json:{read:{source:`columnDelimiter`},write:{target:`columnDelimiter`,ignoreOrigin:!0}}})],j.prototype,`delimiter`,void 0),h([n({readOnly:!0,type:Boolean,json:{origins:{"web-scene":{read:!1,write:!1}}}})],j.prototype,`editingEnabled`,void 0),h([n({json:{write:!1}})],j.prototype,`fieldConfigurations`,null),h([n({json:{read:{source:`layerDefinition.fields`},write:{target:`layerDefinition.fields`}}})],j.prototype,`fields`,void 0),h([n({readOnly:!0})],j.prototype,`graphicOrigin`,void 0),h([n({type:Boolean,readOnly:!0})],j.prototype,`isTable`,null),h([_(`web-map`,`labelsVisible`,[`layerDefinition.drawingInfo.labelingInfo`,`showLabels`])],j.prototype,`readWebMapLabelsVisible`,null),h([n({type:String,json:{read:{source:`locationInfo.latitudeFieldName`},write:{target:`locationInfo.latitudeFieldName`,ignoreOrigin:!0}}})],j.prototype,`latitudeField`,void 0),h([n({type:[`show`,`hide`]})],j.prototype,`listMode`,void 0),h([n({type:[`coordinates`],json:{read:{source:`locationInfo.locationType`},write:{target:`locationInfo.locationType`,ignoreOrigin:!0,isRequired:!0}}})],j.prototype,`locationType`,void 0),h([n({type:String,json:{read:{source:`locationInfo.longitudeFieldName`},write:{target:`locationInfo.longitudeFieldName`,ignoreOrigin:!0}}})],j.prototype,`longitudeField`,void 0),h([n({type:[`CSV`]})],j.prototype,`operationalLayerType`,void 0),h([n()],j.prototype,`outFields`,void 0),h([n({type:String,json:{origins:{"web-scene":{read:!1,write:!1}},read:!1,write:!1}})],j.prototype,`path`,void 0),h([e(`popupTemplate`)],j.prototype,`writePopupTemplate`,null),h([n({type:x})],j.prototype,`spatialReference`,void 0),h([n({json:{read:!1},cast:null,type:k,readOnly:!0})],j.prototype,`source`,void 0),h([n({json:{read:!1},value:`csv`,readOnly:!0})],j.prototype,`type`,void 0),h([n({json:{read:c,write:{isRequired:!0,ignoreOrigin:!0,writer:l}}})],j.prototype,`url`,null),j=h([o(`esri.layers.CSVLayer`)],j);var M=j;export{M as default};