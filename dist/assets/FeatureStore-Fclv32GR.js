import{BT as e,JE as t,bf as n,ef as r,ov as i,tx as a,uE as o}from"./index-CzMixifc.js";import{x as s}from"./featureConversionUtils-VvJ2pauf.js";import{t as c}from"./BoundsStore-DZ48kmJe.js";import{c as l}from"./timeSupport-CjNpK2fD.js";import{t as u}from"./optimizedFeatureQueryEngineAdapter-DhyuxDon.js";var d=n(),f=class{constructor(e){this.geometryInfo=e,this._boundsStore=new c,this._featuresById=new Map,this._usedMemory=0,this.events=new i,this.featureAdapter=u}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach(t=>{t.geometry!=null&&t.geometry.coords&&(e+=t.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(this.fullBounds==null)return null;let[t,n,r,i]=this.fullBounds;return{xmin:t,ymin:n,xmax:r,ymax:i,spatialReference:l(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(let t of e)this._add(t);this._emitChanged()}upsertMany(e){let n=e.map(e=>this._upsert(e));return this._emitChanged(),n.filter(t)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){let t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(let t of e){let e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(let n of e){let e=this._boundsStore.get(n.objectId);e&&t(r(d,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach(t=>e(t))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,e=>{t(this._featuresById.get(e))})}_emitChanged(){this.events.emit(`changed`,void 0)}_add(t){if(!t)return;let n=t.objectId;if(n==null)return void o.getLogger(`esri.layers.graphics.data.FeatureStore`).error(new e(`featurestore:invalid-feature`,`feature id is missing`,{feature:t}));let r=this._featuresById.get(n),i;if(r?(t.displayId=r.displayId,i=this._boundsStore.get(n),this._boundsStore.delete(n),this._usedMemory-=this.estimateFeatureUsedMemory?.(r)??0):this.onFeatureAdd!=null&&this.onFeatureAdd(t),!t.geometry?.coords?.length)return this._boundsStore.set(n,null),void this._featuresById.set(n,t);i=s(i??a(),t.geometry),i!=null&&this._boundsStore.set(n,i),this._featuresById.set(n,t),this._usedMemory+=this.estimateFeatureUsedMemory?.(t)??0}_upsert(t){let n=t?.objectId;if(n==null)return o.getLogger(`esri.layers.graphics.data.FeatureStore`).error(new e(`featurestore:invalid-feature`,`feature id is missing`,{feature:t})),null;let r=this._featuresById.get(n);if(!r)return this._add(t),t;this._usedMemory-=this.estimateFeatureUsedMemory?.(r)??0;let{geometry:i,attributes:c}=t;for(let e in c)r.attributes[e]=c[e];return i&&(r.geometry=i,this._boundsStore.set(n,s(a(),i)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(r)??0,r}_remove(e){this.onFeatureRemove!=null&&this.onFeatureRemove(e);let t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}};export{f as t};