const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-icon-gYn-WqYd.js","assets/dom-DR7u6Enw.js","assets/guid-CL9r11ws.js","assets/logger-DEjkIaVS.js","assets/index-CzMixifc.js","assets/index-CDgdHpAj.css","assets/observers-kuJ9lXOQ.js","assets/calcite-icon-Bb-7Fyxx.js","assets/visualVariableUtils-BPPIHCjn.js","assets/chartUtilsAm5-Bh9JPTcq.js","assets/Theme-CYpebp7z.js","assets/Tooltip-dvfUu4sp.js","assets/DefaultTheme-C8j4Lmkf.js","assets/chartCommon-DYaYefhr.js","assets/Button-MJxCOW8g.js","assets/ColorSet-Dt2L4vVz.js","assets/pieChart-DWlKp4rw.js","assets/Tick-_e9s-pnF.js","assets/xyChart-CPqb_gmv.js","assets/arcade-BEgcp4A0.js","assets/ImmutableArray-C3KNQCVd.js","assets/arcadeEnvironment-BvmpPtDd.js","assets/arcade-B3q1v9qD.js","assets/Dictionary-CGt1qKCN.js","assets/shared-DVF4C5pR.js","assets/number-D2fZD7kK.js","assets/track-BkLI1XI_.js","assets/ArcadePortal-CAomFS7x.js","assets/Attachment-CF32PXLj.js","assets/Feature-2QyVo8eG.js","assets/featureConversionUtils-VvJ2pauf.js","assets/OptimizedFeatureSet-D4F9ObY_.js","assets/memoryEstimations-C3WUBUZI.js","assets/OptimizedGeometry-5fDazGe-.js","assets/containerUtils-BiL8DqKh.js","assets/functions-CroXKA2K.js","assets/fieldStats-zmanK7EC.js","assets/WhereClause-2gh-KjwG.js","assets/streamLayerUtils-82UmlW-3.js","assets/arcade-DETdxCOd.js","assets/unitConversion-BEfQFMd-.js","assets/aiServices-CrDUD_oX.js","assets/commonProperties-CaHgSHvW.js","assets/Feature-iXAdRAf_.js","assets/calcite-loader-CQiQFcGp.js","assets/controllers-D0o5KNzP.js","assets/useT9n-_kjC0vuS.js","assets/calcite-loader-B-PZ8g3y.js","assets/uniqueValues-CIbOEIIZ.js","assets/pbf-Dny0go3N.js","assets/quantizationUtils-CzrQVcZ1.js","assets/queryUtils-fxq7u50x.js","assets/urlUtils-7tPnOsRB.js","assets/executeQueryJSON-BmDY9cVm.js","assets/query-BeU-rNp1.js","assets/pbfQueryUtils-Dy8pLZgd.js","assets/queryUtils-ByyjBzze.js","assets/executeQueryPBF-Brhxo-EH.js","assets/FixedIntervalBinParameters-5fcY6iRA.js","assets/AttributeBinsQuery-BqDFZU-T.js","assets/generateRendererUtils-Boi4GqnB.js","assets/PivotQuery-oj9Nn1TH.js","assets/statsWorker-DToyUrt5.js","assets/utils-Cm-RG8rq.js","assets/utils-BUI45WL8.js","assets/utils-nAxNAb0W.js","assets/calcite-chip-CxYkw8Dj.js","assets/useSetFocus-Cu78bSEg.js","assets/interactive-BW6W6K6P.js","assets/key-NNODzVeo.js","assets/calcite-list-CHW8xZ33.js","assets/calcite-input-mORJeaMe.js","assets/form-BJzlThUk.js","assets/label-DezmwjkL.js","assets/keyed-BK-D59eG.js","assets/static-CiTTjtPx.js","assets/useCancelable-DxFl1F3J.js","assets/utils2-CgJ5PVN8.js","assets/calcite-input-message-CEDGxJvU.js","assets/calcite-scrim-C6LDz3WS.js","assets/debounce-Dcuk9yc4.js","assets/calcite-list-item-CPU34qgI.js","assets/dynamicClasses-DbfUCjG2.js","assets/floating-ui-DL0DvRub.js","assets/openCloseComponent-BYOM6qG3.js","assets/resources5-DH9g29p4.js","assets/resources7-BCEARoZX.js","assets/calcite-action-1RbBCVmz.js","assets/calcite-dropdown-group-emVbjtug.js","assets/calcite-dropdown-item-BfSnOJL4.js","assets/calcite-dropdown-C4t59jgm.js","assets/calcite-notice-_aiuU757.js","assets/Feature-B8gfxUoM.js","assets/quantity-DI5We-W2.js","assets/throttle-B2HVGxWH.js","assets/unitFormatUtils-dqVr3yY8.js","assets/isImageryGraphicOrigin-Qwa2m0c8.js","assets/isImageryTileGraphicOrigin-BCvTqw3y.js","assets/AttachmentInfo-COZ0ISIZ.js","assets/cimSymbolUtils-Dwr_LmxD.js","assets/utils-BroCumRv.js","assets/FeatureUtilityNetworkAssociationsViewModel-CzeImw4Z.js","assets/featureUtils-CHNJK_gb.js","assets/FeatureUtilityNetworkAssociationList-ivyBgDGW.js"])))=>i.map(i=>d[i]);
import{$_ as e,$w as t,Ar as n,BS as r,BT as i,DT as a,D_ as o,EC as s,Fo as c,Gw as l,Ho as u,Hw as d,Io as f,JE as p,Jp as m,LS as h,Lo as g,Nh as _,No as v,OT as y,Or as ee,QE as te,Q_ as ne,RS as re,Rl as ie,Ro as b,Sh as ae,Vo as oe,Xa as se,Xw as ce,Ya as x,Yp as le,_D as ue,__ as de,_w as S,aE as fe,ap as pe,cp as me,dE as he,dg as ge,dp as _e,dw as ve,eT as ye,ev as C,fT as w,g as be,gD as T,gE as xe,gg as Se,gw as Ce,h_ as we,id as Te,ip as Ee,iv as De,jo as Oe,jp as ke,kT as Ae,mD as je,mg as E,np as Me,nv as D,op as Ne,pE as Pe,ph as Fe,px as Ie,qw as Le,rT as Re,rd as ze,rh as Be,rp as Ve,sp as He,uE as Ue,up as We,vT as Ge,v_ as Ke,vd as qe,vg as Je,vt as Ye,wx as Xe,y_ as Ze,z_ as Qe}from"./index-CzMixifc.js";import{o as $e}from"./shared-DVF4C5pR.js";import{r as et}from"./streamLayerUtils-82UmlW-3.js";import{n as tt}from"./executeQueryJSON-BmDY9cVm.js";import{n as nt}from"./isImageryGraphicOrigin-Qwa2m0c8.js";import{a as rt}from"./utils-BroCumRv.js";import{n as it}from"./isImageryTileGraphicOrigin-BCvTqw3y.js";import{s as at}from"./utils-BUI45WL8.js";import{t as ot}from"./AttachmentInfo-COZ0ISIZ.js";import{a as st}from"./unitFormatUtils-dqVr3yY8.js";import{t as ct}from"./throttle-B2HVGxWH.js";import{A as lt,E as ut,M as dt,O as ft,S as pt,T as mt,_ as ht,a as gt,b as _t,c as vt,g as yt,h as bt,j as xt,k as St,l as Ct,m as wt,n as Tt,o as Et,p as Dt,r as Ot,s as kt,t as At,u as jt,v as Mt,w as Nt,x as Pt,y as Ft}from"./featureUtils-CHNJK_gb.js";import{n as It,t as Lt}from"./FeatureUtilityNetworkAssociationsViewModel-CzeImw4Z.js";var Rt={editing:!1,operations:{add:!0,update:!0,delete:!0}},zt=De.ofType(ot),O=class extends S{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.attachmentKeywords=null,this.attachmentTypes=null,this.capabilities={...Rt},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new zt,this.fileInfos=new De,this.graphic=null,this.mode=`view`,this.orderByFields=null,this.filesEnabled=!1,this.addHandles(D(()=>this.graphic,()=>this._graphicChanged(),C))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...Rt,...e}}get state(){return this._getAttachmentsPromise?`loading`:this.graphic?`ready`:`disabled`}get supportsResizeAttachments(){let{graphic:e}=this;if(!e)return!1;let t=e.sourceLayer??e.layer;return t?.loaded&&`capabilities`in t&&t.capabilities&&`attachment`in t.capabilities&&t.capabilities.attachment&&`supportsResize`in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}get supportsTypeWildcard(){let{graphic:e}=this;if(!e)return!1;let t=e.sourceLayer??e.layer;return t?.loaded&&`capabilities`in t&&t.capabilities&&`attachment`in t.capabilities&&t.capabilities.attachment&&`supportsResize`in t.capabilities.attachment&&t.capabilities.attachment.supportsTypeWildcard||!1}async getAttachments(){let{_attachmentLayer:e,attachmentInfos:t,orderByFields:r,attachmentTypes:a,attachmentKeywords:o,supportsTypeWildcard:s}=this;if(!e||typeof e.queryAttachments!=`function`)throw new i(`invalid-layer`,`getAttachments(): A valid layer is required.`);let c=this._getObjectId();if(typeof c!=`number`)throw new i(`invalid-object-id`,`getAttachments(): Numeric object id is required`);let l=r?.map(e=>`${e.field} ${e.order===`descending`?`DESC`:`ASC`}`),u=new n({objectIds:[c],returnMetadata:!0,orderByFields:l,attachmentTypes:s?a?.filter(Boolean).map(e=>`${e}/*`):void 0,keywords:o}),d=[],f=e.queryAttachments(u).then(e=>e[c]||d).catch(()=>d);this._getAttachmentsPromise=f,this.notifyChange(`state`);let p=await f;return t.destroyAll(),p.length&&t.addMany(p),this._getAttachmentsPromise=null,this.notifyChange(`state`),p}async addAttachment(e,t=this.graphic){let{_attachmentLayer:n,attachmentInfos:r,capabilities:a}=this;if(!t)throw new i(`invalid-graphic`,`addAttachment(): A valid graphic is required.`,{graphic:t});if(!e)throw new i(`invalid-attachment`,`addAttachment(): An attachment is required.`,{attachment:e});if(!a.operations?.add)throw new i(`invalid-capabilities`,`addAttachment(): add capabilities are required.`);if(!n||typeof n.addAttachment!=`function`)throw new i(`invalid-layer`,`addAttachment(): A valid layer is required.`);let o=n.addAttachment(t,e).then(e=>this._queryAttachment(e.objectId,t)),s=await o;return r.add(s),s}async deleteAttachment(e){let{_attachmentLayer:t,attachmentInfos:n,graphic:r,capabilities:a}=this;if(!e)throw new i(`invalid-attachment-info`,`deleteAttachment(): An attachmentInfo is required.`,{attachmentInfo:e});if(!a.operations?.delete)throw new i(`invalid-capabilities`,`deleteAttachment(): delete capabilities are required.`);if(!t||typeof t.deleteAttachments!=`function`)throw new i(`invalid-layer`,`deleteAttachment(): A valid layer is required.`);if(!r)throw new i(`invalid-graphic`,`deleteAttachment(): A graphic is required.`);let o=t.deleteAttachments(r,[e.id]).then(()=>e),s=await o;return n.remove(s),s.destroy(),s}async updateAttachment(e,t=this.activeAttachmentInfo){let{_attachmentLayer:n,attachmentInfos:r,graphic:a,capabilities:o}=this;if(!e)throw new i(`invalid-attachment`,`updateAttachment(): An attachment is required.`,{attachment:e});if(!t)throw new i(`invalid-attachment-info`,`updateAttachment(): An attachmentInfo is required.`,{attachmentInfo:t});if(!o.operations?.update)throw new i(`invalid-capabilities`,`updateAttachment(): Update capabilities are required.`);let s=r.indexOf(t);if(!n||typeof n.updateAttachment!=`function`)throw new i(`invalid-layer`,`updateAttachment(): A valid layer is required.`);if(!a)throw new i(`invalid-graphic`,`updateAttachment(): A graphic is required.`);let c=n.updateAttachment(a,t.id,e).then(e=>this._queryAttachment(e.objectId)),l=await c;return r.splice(s,1,l),l}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;let n={file:e,form:t};return this.fileInfos.add(n),n}updateFile(e,t,n=this.activeFileInfo){if(!e||!t||!n)return null;let r=this.fileInfos.indexOf(n);return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}deleteFile(e){let t=this.fileInfos.find(t=>t.file===e);return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){let{_attachmentLayer:r}=this;if(!e||!r?.queryAttachments)throw new i(`invalid-attachment-id`,`Could not query attachment.`);let a=this._getObjectId(t);if(typeof a!=`number`)throw new i(`invalid-object-id`,`getAttachments(): Numeric object id is required`);let o=new n({objectIds:[a],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(o).then(e=>e[a][0])}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>this.attachmentInfos.destroyAll()))}_setAttachmentLayer(){let{graphic:e}=this,t=lt(e);this._attachmentLayer=t?t.type===`scene`&&t.associatedLayer!=null?t.associatedLayer:t:null}};T([a({type:[String]})],O.prototype,`attachmentKeywords`,void 0),T([a({type:[[`application`,`audio`,`image`,`model`,`text`,`video`]]})],O.prototype,`attachmentTypes`,void 0),T([a()],O.prototype,`capabilities`,void 0),T([Ae(`capabilities`)],O.prototype,`castCapabilities`,null),T([a()],O.prototype,`activeAttachmentInfo`,void 0),T([a()],O.prototype,`activeFileInfo`,void 0),T([a({readOnly:!0,type:zt})],O.prototype,`attachmentInfos`,void 0),T([a()],O.prototype,`fileInfos`,void 0),T([a({type:qe})],O.prototype,`graphic`,void 0),T([a()],O.prototype,`mode`,void 0),T([a({type:[_e]})],O.prototype,`orderByFields`,void 0),T([a({readOnly:!0})],O.prototype,`state`,null),T([a()],O.prototype,`filesEnabled`,void 0),T([a({readOnly:!0})],O.prototype,`supportsResizeAttachments`,null),T([a({readOnly:!0})],O.prototype,`supportsTypeWildcard`,null),O=T([y(`esri.widgets.Attachments.AttachmentsViewModel`)],O);function Bt(e){let t=e.toLowerCase();return t===`image/bmp`||t===`image/emf`||t===`image/exif`||t===`image/gif`||t===`image/x-icon`||t===`image/jpeg`||t===`image/png`||t===`image/tiff`||t===`image/x-wmf`}function Vt(e){let t=h(`esri/themes/base/images/files/`);return e?e===`text/plain`?`${t}text-32.svg`:e===`application/pdf`?`${t}pdf-32.svg`:e===`text/csv`?`${t}csv-32.svg`:e===`application/gpx+xml`?`${t}gpx-32.svg`:e===`application/x-dwf`?`${t}cad-32.svg`:e===`application/postscript`||e===`application/json`||e===`text/xml`||e===`model/vrml`?`${t}code-32.svg`:e===`application/x-zip-compressed`||e===`application/x-7z-compressed`||e===`application/x-gzip`||e===`application/x-tar`||e===`application/x-gtar`||e===`application/x-bzip2`||e===`application/gzip`||e===`application/x-compress`||e===`application/x-apple-diskimage`||e===`application/x-rar-compressed`||e===`application/zip`?`${t}zip-32.svg`:e.includes(`image/`)?`${t}image-32.svg`:e.includes(`audio/`)?`${t}sound-32.svg`:e.includes(`video/`)?`${t}video-32.svg`:e.includes(`msexcel`)||e.includes(`ms-excel`)||e.includes(`spreadsheetml`)?`${t}excel-32.svg`:e.includes(`msword`)||e.includes(`ms-word`)||e.includes(`wordprocessingml`)?`${t}word-32.svg`:e.includes(`powerpoint`)||e.includes(`presentationml`)?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}var Ht={close:`esri-icon-close`,collapse:`esri-icon-collapse`,down:`esri-icon-down`,downArrow:`esri-icon-down-arrow`,dragHorizontal:`esri-icon-drag-horizontal`,dragVertical:`esri-icon-drag-vertical`,duplicate:`esri-icon-duplicate`,expand:`esri-icon-expand`,fontFallbackText:`esri-icon-font-fallback-text`,forward:`esri-icon-forward`,handleVertical:`esri-icon-handle-vertical`,icon:`esri-icon`,left:`esri-icon-left`,locateCircled:`esri-icon-locate-circled`,noticeTriangle:`esri-icon-notice-triangle`,pause:`esri-icon-pause`,play:`esri-icon-play`,plus:`esri-icon-plus`,radioChecked:`esri-icon-radio-checked`,radioUnchecked:`esri-icon-radio-unchecked`,refresh:`esri-icon-refresh`,reverse:`esri-icon-reverse`,right:`esri-icon-right`,search:`esri-icon-search`,swap:`esri-icon-swap`,table:`esri-icon-table`,trash:`esri-icon-trash`,up:`esri-icon-up`,upArrow:`esri-icon-up-arrow`,upDownArrows:`esri-icon-up-down-arrows`,urbanModel:`esri-icon-urban-model`,zoomInMagnifyingGlass:`esri-icon-zoom-in-magnifying-glass`,zoomToObject:`esri-icon-zoom-to-object`},Ut={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},k=`esri-attachments`,A={base:k,loaderContainer:`${k}__loader-container`,loader:`${k}__loader`,container:`${k}__container`,containerList:`${k}__container--list`,containerPreview:`${k}__container--preview`,actions:`${k}__actions`,deleteButton:`${k}__delete-button`,addAttachmentButton:`${k}__add-attachment-button`,errorMessage:`${k}__error-message`,items:`${k}__items`,item:`${k}__item`,itemButton:`${k}__item-button`,itemMask:`${k}__item-mask`,itemMaskIcon:`${k}__item-mask--icon`,itemImage:`${k}__image`,itemImageResizable:`${k}__image--resizable`,itemLabel:`${k}__label`,itemFilename:`${k}__filename`,itemChevronIcon:`${k}__item-chevron-icon`,itemLink:`${k}__item-link`,itemLinkOverlay:`${k}__item-link-overlay`,itemLinkOverlayIcon:`${k}__item-link-overlay-icon`,itemAddIcon:`${k}__item-add-icon`,formNode:`${k}__form-node`,fileFieldset:`${k}__file-fieldset`,fileLabel:`${k}__file-label`,fileName:`${k}__file-name`,fileInput:`${k}__file-input`,metadata:`${k}__metadata`,metadataFieldset:`${k}__metadata-fieldset`,progressBar:`${k}__progress-bar`},Wt=window.CSS,j=class extends x{constructor(e,t){super(e,t),this.displayType=`auto`,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={...Ut},this._supportsImageOrientation=Wt&&Wt.supports&&Wt.supports(`image-orientation`,`from-image`),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e={viewModel:new O,...e}),e}initialize(){this.addHandles([ne(()=>this.viewModel?.attachmentInfos,`change`,()=>this.scheduleRender()),ne(()=>this.viewModel?.fileInfos,`change`,()=>this.scheduleRender()),D(()=>this.viewModel?.mode,()=>this._modeChanged(),C)])}loadDependencies(){return se({icon:()=>r(()=>import(`./calcite-icon-gYn-WqYd.js`),__vite__mapDeps([0,1,2,3,4,5,6,7]))})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){let{displayType:e}=this;return e&&e!==`auto`?e:this.viewModel.supportsResizeAttachments?`preview`:`list`}get attachmentKeywords(){return this.viewModel.attachmentKeywords}set attachmentKeywords(e){this.viewModel.attachmentKeywords=e}get attachmentTypes(){return this.viewModel.attachmentTypes}set attachmentTypes(e){this.viewModel.attachmentTypes=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return`attachment`}set icon(e){this._overrideIfSome(`icon`,e)}get label(){return this.messages?.widgetLabel??``}set label(e){this._overrideIfSome(`label`,e)}castVisibleElements(e){return{...Ut,...e}}addAttachment(){let{_addAttachmentForm:e,viewModel:t}=this;return this._set(`submitting`,!0),this._set(`error`,null),t.addAttachment(e).then(e=>(this._set(`submitting`,!1),this._set(`error`,null),t.mode=`view`,e)).catch(e=>{throw this._set(`submitting`,!1),this._set(`error`,new i(`attachments:add-attachment`,this.messages.addErrorMessage,e)),e})}deleteAttachment(e){let{viewModel:t}=this;return this._set(`submitting`,!0),this._set(`error`,null),t.deleteAttachment(e).then(e=>(this._set(`submitting`,!1),this._set(`error`,null),t.mode=`view`,e)).catch(e=>{throw this._set(`submitting`,!1),this._set(`error`,new i(`attachments:delete-attachment`,this.messages.deleteErrorMessage,e)),e})}updateAttachment(){let{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set(`submitting`,!0),this._set(`error`,null),e.updateAttachment(t).then(t=>(this._set(`submitting`,!1),this._set(`error`,null),e.mode=`view`,t)).catch(e=>{throw this._set(`submitting`,!1),this._set(`error`,new i(`attachments:update-attachment`,this.messages.updateErrorMessage,e)),e})}addFile(){let e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode=`view`,e}updateFile(){let{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode=`view`,t}deleteFile(e){let t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode=`view`,t}render(){let{submitting:e,viewModel:t}=this,{state:n}=t;return g(`div`,{class:this.classes(A.base,E.widget)},e?this._renderProgressBar():null,n===`loading`?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){let{error:e,visibleElements:t}=this;return e&&t.errorMessage?g(`div`,{class:A.errorMessage,key:`error-message`},e.message):null}_renderAttachments(){let{activeFileInfo:e,mode:t,activeAttachmentInfo:n}=this.viewModel;return t===`add`?this._renderAddForm():t===`edit`?this._renderDetailsForm(n||e):this._renderAttachmentContainer()}_renderLoading(){return g(`div`,{class:A.loaderContainer,key:`loader`},g(`div`,{class:A.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?g(`div`,{class:A.progressBar,key:`progress-bar`}):null}_renderAddForm(){let{submitting:e,selectedFile:t}=this,n=e||!t,r=this.visibleElements.cancelAddButton?g(`button`,{bind:this,class:this.classes(E.button,E.buttonTertiary,E.buttonSmall,E.buttonHalf,e&&E.buttonDisabled),disabled:e,onclick:this._cancelForm,type:`button`},this.messages.cancel):null,i=this.visibleElements.addSubmitButton?g(`button`,{class:this.classes(E.button,E.buttonSecondary,E.buttonSmall,E.buttonHalf,{[E.buttonDisabled]:n}),disabled:n,type:`submit`},this.messages.add):null,a=t?g(`span`,{class:A.fileName,key:`file-name`},t.name):null,o=g(`form`,{afterCreate:u,afterRemoved:oe,bind:this,"data-node-ref":`_addAttachmentForm`,onsubmit:this._submitAddAttachment},g(`fieldset`,{class:A.fileFieldset},a,g(`label`,{class:this.classes(A.fileLabel,E.button,E.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,g(`input`,{bind:this,class:A.fileInput,name:`attachment`,onchange:this._handleFileInputChange,type:`file`}))),i,r);return g(`div`,{class:A.formNode,key:`add-form-container`},o)}_renderDetailsForm(e){let{visibleElements:t,viewModel:n,selectedFile:r,submitting:i}=this,{capabilities:a}=n,o=i||!r,s,c,l,d;r?(s=r.type,c=r.name,l=r.size):e&&`file`in e?(s=e.file.type,c=e.file.name,l=e.file.size):e&&`contentType`in e&&(s=e.contentType,c=e.name,l=e.size,d=e.url);let f=a.editing&&a.operations?.delete&&t.deleteButton?g(`button`,{bind:this,class:this.classes(E.button,E.buttonSmall,E.buttonTertiary,A.deleteButton,{[E.buttonDisabled]:i}),disabled:i,key:`delete-button`,onclick:t=>this._submitDeleteAttachment(t,e),type:`button`},this.messages.delete):void 0,p=a.editing&&a.operations?.update&&t.updateButton?g(`button`,{class:this.classes(E.button,E.buttonSmall,E.buttonThird,{[E.buttonDisabled]:o}),disabled:o,key:`update-button`,type:`submit`},this.messages.update):void 0,m=this.visibleElements.cancelUpdateButton?g(`button`,{bind:this,class:this.classes(E.button,E.buttonSmall,E.buttonTertiary,E.buttonThird,{[E.buttonDisabled]:i}),disabled:i,key:`cancel-button`,onclick:this._cancelForm,type:`button`},this.messages.cancel):void 0,h=a.editing&&a.operations?.update?g(`fieldset`,{class:A.fileFieldset,key:`file`},g(`span`,{class:A.fileName,key:`file-name`},c),g(`label`,{class:this.classes(A.fileLabel,E.button,E.buttonSecondary)},this.messages.changeFile,g(`input`,{bind:this,class:A.fileInput,name:`attachment`,onchange:this._handleFileInputChange,type:`file`}))):void 0,_=g(`fieldset`,{class:A.metadataFieldset,key:`size`},g(`label`,null,st(this.messagesUnits,l??0))),v=g(`fieldset`,{class:A.metadataFieldset,key:`content-type`},g(`label`,null,s)),y=d==null?this._renderImageMask(e,400):g(`a`,{class:A.itemLink,href:d,rel:`noreferrer`,target:`_blank`},this._renderImageMask(e,400),g(`div`,{class:A.itemLinkOverlay},g(`span`,{class:A.itemLinkOverlayIcon},g(`calcite-icon`,{icon:`launch`})))),ee=g(`form`,{afterCreate:u,afterRemoved:oe,bind:this,"data-node-ref":`_updateAttachmentForm`,onsubmit:t=>this._submitUpdateAttachment(t,e)},g(`div`,{class:A.metadata},_,v),h,g(`div`,{class:A.actions},f,m,p));return g(`div`,{class:A.formNode,key:`edit-form-container`},y,ee)}_renderImageMask(e,t){return e?`file`in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){let{supportsResizeAttachments:n}=this.viewModel,r=Vt(t),i={[A.itemImageResizable]:n};return g(`div`,{class:this.classes(A.itemMaskIcon,A.itemMask),key:r},g(`img`,{alt:e,class:this.classes(i,A.itemImage),src:r,title:e}))}_renderImageMaskForAttachment(e,t){let{supportsResizeAttachments:n}=this.viewModel;if(!e)return null;let{contentType:r,name:i,size:a,url:o}=e;if(!n||!Bt(r))return this._renderGenericImageMask(i,r);let s=this._getCSSTransform(e),c=s?{transform:s,"image-orientation":`none`}:{},l=`${o}${o?.includes(`?`)?`&`:`?`}w=${t}&s=${a}`,u={[A.itemImageResizable]:n};return g(`div`,{class:this.classes(A.itemMask),key:l},g(`img`,{alt:i,class:this.classes(u,A.itemImage),src:l,styles:c,title:i}))}_renderFile(e){let{file:t}=e;return g(`li`,{class:A.item,key:t},g(`button`,{"aria-label":this.messages.attachmentDetails,bind:this,class:A.itemButton,key:`details-button`,onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:`button`},this._renderImageMask(e),g(`label`,{class:A.itemLabel},g(`span`,{class:A.itemFilename},t.name||this.messages.noTitle),g(`span`,{"aria-hidden":`true`,class:this.classes(A.itemChevronIcon,b(this.container)?Ht.left:Ht.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){let{viewModel:n,effectiveDisplayType:r}=this,{capabilities:i,supportsResizeAttachments:a}=n,{contentType:o,name:s,url:c}=e,l=this._renderImageMask(e,t===`list`?48:400),u=i.editing?g(`span`,{"aria-hidden":`true`,class:this.classes(A.itemChevronIcon,b(this.container)?Ht.left:Ht.right)}):null,d=[l,r===`preview`&&a&&Bt(o)?null:g(`label`,{class:A.itemLabel},g(`span`,{class:A.itemFilename},s||this.messages.noTitle),u)],f=i.editing?g(`button`,{"aria-label":this.messages.attachmentDetails,bind:this,class:A.itemButton,"data-attachment-info-id":e.id,key:`details-button`,onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:`button`},d):g(`a`,{class:A.itemButton,href:c??void 0,key:`details-link`,rel:`noreferrer`,target:`_blank`},d);return g(`li`,{class:A.item,key:e},f)}_renderAttachmentContainer(){let{effectiveDisplayType:e,viewModel:t,visibleElements:n}=this,{attachmentInfos:r,capabilities:i,fileInfos:a}=t,o=!!r?.length,s=!!a?.length,c={[A.containerList]:e!==`preview`,[A.containerPreview]:e===`preview`},l=i.editing&&i.operations?.add&&n.addButton?g(`button`,{bind:this,class:this.classes(E.button,E.buttonTertiary,A.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:`button`},g(`span`,{"aria-hidden":`true`,class:this.classes(A.itemAddIcon,Ht.plus)}),this.messages.add):void 0,u=o?g(`ul`,{class:A.items,key:`attachments-list`},r.toArray().map(t=>this._renderAttachmentInfo({attachmentInfo:t,displayType:e}))):void 0,d=s?g(`ul`,{class:A.items,key:`file-list`},a.toArray().map(e=>this._renderFile(e))):void 0,f=s||o?void 0:g(`div`,{class:E.empty},this.messages.noAttachments);return g(`div`,{class:this.classes(A.container,c),key:`attachments-container`},u,d,f,l)}_modeChanged(){this._set(`error`,null),this._set(`selectedFile`,null)}_handleFileInputChange(e){let t=e.target,n=t.files?.item(0);this._set(`selectedFile`,n)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&(`file`in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&`file`in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){let{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode=`edit`}_startEditFile(e){let{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode=`edit`}_startAddAttachment(){this.viewModel.mode=`add`}_cancelForm(e){e.preventDefault(),this.viewModel.mode=`view`}_getCSSTransform(e){let{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:``,t.mirrored?`scaleX(-1)`:``].join(` `):``}};T([a()],j.prototype,`capabilities`,null),T([a()],j.prototype,`displayType`,void 0),T([a({readOnly:!0})],j.prototype,`effectiveDisplayType`,null),T([a()],j.prototype,`attachmentKeywords`,null),T([a()],j.prototype,`attachmentTypes`,null),T([a({type:qe})],j.prototype,`graphic`,null),T([a()],j.prototype,`icon`,null),T([a()],j.prototype,`label`,null),T([a(),f(`esri/widgets/Attachments/t9n/Attachments`)],j.prototype,`messages`,void 0),T([a(),f(`esri/core/t9n/Units`)],j.prototype,`messagesUnits`,void 0),T([a({readOnly:!0})],j.prototype,`selectedFile`,void 0),T([a({readOnly:!0})],j.prototype,`submitting`,void 0),T([a({readOnly:!0})],j.prototype,`error`,void 0),T([a({type:O})],j.prototype,`viewModel`,void 0),T([a()],j.prototype,`visibleElements`,void 0),T([Ae(`visibleElements`)],j.prototype,`castVisibleElements`,null),j=T([y(`esri.widgets.Attachments`)],j);var M=class extends O{constructor(e){super(e),this.description=null,this.title=null}};T([a()],M.prototype,`description`,void 0),T([a()],M.prototype,`title`,void 0),M=T([y(`esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel`)],M);function Gt({level:e,class:t,...n},r){let i=Kt(e);return g(`h${i}`,{...n,"aria-level":String(i),class:c(E.heading,t),role:`heading`},r)}function Kt(e){return ve(Math.ceil(e),1,6)}var qt=`esri-feature-element-info`,Jt={base:qt,title:`${qt}__title`,description:`${qt}__description`},N=class extends x{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return g(`div`,{class:Jt.base},this._renderTitle(),this._renderDescription())}_renderTitle(){let{title:e}=this;return e?g(Gt,{class:Jt.title,innerHTML:e,level:this.headingLevel}):null}_renderDescription(){let{description:e}=this;return e?g(`div`,{class:Jt.description,innerHTML:e,key:`description`}):null}};T([a()],N.prototype,`description`,void 0),T([a()],N.prototype,`headingLevel`,void 0),T([a()],N.prototype,`title`,void 0),N=T([y(`esri.widgets.Feature.support.FeatureElementInfo`)],N);var Yt={base:`esri-feature-attachments`},P=class extends x{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new j,this.headingLevel=2,this.viewModel=new M}initialize(){this._featureElementInfo=new N,this.addHandles([D(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),C),D(()=>this.viewModel,e=>this.attachmentsWidget.viewModel=e,C)])}destroy(){this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),this._featureElementInfo?.destroy()}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get displayType(){return this.attachmentsWidget.displayType}set displayType(e){this.attachmentsWidget.displayType=e}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{attachmentsWidget:e}=this;return g(`div`,{class:Yt.base},this._featureElementInfo?.render(),e?.render())}_setupFeatureElementInfo(){let{description:e,title:t,headingLevel:n}=this;this._featureElementInfo?.set({description:e,title:t,headingLevel:n})}};T([a({readOnly:!0})],P.prototype,`attachmentsWidget`,void 0),T([a()],P.prototype,`description`,null),T([a()],P.prototype,`displayType`,null),T([a()],P.prototype,`graphic`,null),T([a()],P.prototype,`headingLevel`,void 0),T([a()],P.prototype,`title`,null),T([a({type:M})],P.prototype,`viewModel`,void 0),P=T([y(`esri.widgets.Feature.FeatureAttachments`)],P);var F=class extends S{constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.addHandles(D(()=>this.creator,e=>{this._destroyContent(),this._createContent(e)},C))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?`loading`:`ready`}_destroyContent(){let{created:e,graphic:t,destroyer:n}=this;e&&t&&(mt({type:`content`,value:n,event:{graphic:t}}),this._set(`created`,null))}async _createContent(e){let t=this.graphic;if(!t||!e)return;let n=mt({type:`content`,value:e,event:{graphic:t}});this._loadingPromise=n,this.notifyChange(`state`);let r=await n;n===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange(`state`),this._set(`created`,r))}};T([a({readOnly:!0})],F.prototype,`created`,void 0),T([a()],F.prototype,`creator`,void 0),T([a()],F.prototype,`destroyer`,void 0),T([a({type:qe})],F.prototype,`graphic`,void 0),T([a({readOnly:!0})],F.prototype,`state`,null),F=T([y(`esri.widgets.Feature.FeatureContent.FeatureContentViewModel`)],F);var Xt=`esri-feature-content`,Zt={base:Xt,loaderContainer:`${Xt}__loader-container`,loader:`${Xt}__loader`},I=class extends x{constructor(e,t){super(e,t),this.viewModel=null,this._addTargetToAnchors=e=>{Array.from(e.querySelectorAll(`a`)).forEach(e=>{At(e.href)&&!e.hasAttribute(`target`)&&e.setAttribute(`target`,`_blank`)})}}get creator(){return this.viewModel?.creator}set creator(e){this.viewModel&&(this.viewModel.creator=e)}get graphic(){return this.viewModel?.graphic}set graphic(e){this.viewModel&&(this.viewModel.graphic=e)}render(){let e=this.viewModel?.state;return g(`div`,{class:Zt.base},e===`loading`?this._renderLoading():this._renderCreated())}_renderLoading(){return g(`div`,{class:Zt.loaderContainer,key:`loader`},g(`div`,{class:Zt.loader}))}_renderCreated(){let e=this.viewModel?.created;return e?e instanceof HTMLElement?g(`div`,{afterCreate:this._attachToNode,bind:e,key:e}):v(e)?g(`div`,{key:e},!e.destroyed&&e.render()):g(`div`,{afterCreate:this._addTargetToAnchors,innerHTML:e,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};T([a()],I.prototype,`creator`,null),T([a()],I.prototype,`graphic`,null),T([a({type:F})],I.prototype,`viewModel`,void 0),I=T([y(`esri.widgets.Feature.FeatureContent`)],I);var L=class extends S{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.isContentFieldInfos=!1,this.graphic=null,this.layer=null,this.title=null}get formattedFieldInfos(){let{expressionInfos:e,fieldInfos:t,layer:n,isContentFieldInfos:r,graphic:i}=this,a=[];return t?.forEach(t=>{if(!(!t.hasOwnProperty(`visible`)||t.visible))return;let o=t.clone();o.label=Pt({fieldInfo:o,expressionInfos:e,layer:n,graphic:i,isContentFieldInfos:r}),Fe(n)&&gt({fieldInfo:t,graphic:i})&&(o.fieldFormat=Ct({fieldInfo:o,isContentFieldInfos:r,layer:n})),a.push(o)}),a}};T([a()],L.prototype,`attributes`,void 0),T([a({type:[Me]})],L.prototype,`expressionInfos`,void 0),T([a()],L.prototype,`description`,void 0),T([a({type:[me]})],L.prototype,`fieldInfos`,void 0),T([a({readOnly:!0})],L.prototype,`formattedFieldInfos`,null),T([a()],L.prototype,`isContentFieldInfos`,void 0),T([a()],L.prototype,`graphic`,void 0),T([a()],L.prototype,`layer`,void 0),T([a()],L.prototype,`title`,void 0),L=T([y(`esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel`)],L);var Qt=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:`_blank`,label:`{messages.view}`},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:`{hierPart}`},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:`{hierPart}`},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`App Studio Player`},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Collector`},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Explorer`},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Navigator`},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Survey123`},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Trek2There`},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Workforce`},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`iForm`},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`FlowFinity`},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Laserfische`},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:`{messages.openInApp}`,appName:`Microsoft Power Bi`}];function $t(e,t){if(typeof t!=`string`||!t)return t;let n=Qt.find(e=>e.pattern.test(t));if(!n)return t;let r=t.match(n.pattern),i=r?.[2],a=xe(xe(n.label,{messages:e,hierPart:i}),{appName:n.appName}),o=n.target?` target="${n.target}"`:``,c=n.target===`_blank`?` rel="noreferrer"`:``;return Je.sanitizeUrl(s(t)).replace(n.pattern,`<a${o} href="$1"${c}>${a}</a>`)}var en=`esri-feature-fields`,tn={base:en,fieldHeader:`${en}__field-header`,fieldData:`${en}__field-data`,fieldDataDate:`${en}__field-data--date`},R=class extends x{constructor(e,t){super(e,t),this._featureElementInfo=null,this.viewModel=new L,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new N,this.addHandles(D(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),C))}destroy(){this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get expressionInfos(){return this.viewModel.expressionInfos}set expressionInfos(e){this.viewModel.expressionInfos=e}get fieldInfos(){return this.viewModel.fieldInfos}set fieldInfos(e){this.viewModel.fieldInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return g(`div`,{class:tn.base},this._featureElementInfo?.render(),this._renderFields())}_renderFieldInfo(e,t){let{attributes:n}=this.viewModel,r=e.fieldName||``,i=e.label||r,a=n?n[r]==null?``:n[r]:``,o=e?.fieldFormat?.type===`date-time`,s=typeof a==`number`&&!o?this._forceLTR(a):$t(this.messagesURIUtils,a),c={[tn.fieldDataDate]:o};return g(`tr`,{key:`fields-element-info-row-${r}-${t}`},g(`th`,{class:tn.fieldHeader,innerHTML:i,key:`fields-element-info-row-header-${r}-${t}`}),g(`td`,{class:this.classes(tn.fieldData,c),innerHTML:s,key:`fields-element-info-row-data-${r}-${t}`}))}_renderFields(){let{formattedFieldInfos:e}=this.viewModel;return e?.length?g(`table`,{class:E.table,summary:this.messages.fieldsSummary},g(`tbody`,null,e.map((e,t)=>this._renderFieldInfo(e,t)))):null}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};T([a()],R.prototype,`attributes`,null),T([a()],R.prototype,`description`,null),T([a()],R.prototype,`expressionInfos`,null),T([a()],R.prototype,`fieldInfos`,null),T([a()],R.prototype,`title`,null),T([a({type:L,nonNullable:!0})],R.prototype,`viewModel`,void 0),T([a(),f(`esri/widgets/Feature/t9n/Feature`)],R.prototype,`messages`,void 0),T([a(),f(`esri/widgets/support/t9n/uriUtils`)],R.prototype,`messagesURIUtils`,void 0),R=T([y(`esri.widgets.Feature.FeatureFields`)],R);var nn={maximumFractionDigits:20};function rn(e){return de(e,nn)}function an(e,t,n,r){let i=``;t===0?i=`< `:t===n&&(i=`> `);let a=sn(e,r);return a==null?``:i+a}function on(e){let{format:t,fieldFormat:n}=e||{};return n?.type===`number`||!!t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)}function sn(e,t){if(e==null)return e;let{fieldType:n,format:r,fieldFormat:i,timeZoneOptions:a}=t||{};if(cn(n))return at(e,{fieldType:n,format:r?.dateFormat,fieldFormat:i?.type===`date-time`?i:void 0,timeZoneOptions:a});if(typeof e==`string`&&on(t)){let t=Number(e);isNaN(t)||(e=t)}if(typeof e==`string`)return e;let o=i?.type===`number`?Ke(i):r?we(r):void 0;return o?de(e,o):rn(e)}function cn(e){return[`date`,`date-only`,`time-only`,`timestamp-offset`].includes(e||``)}var ln=new Be([64,64,64]);function un(e,t){let n=[],r=e.length-1;return e.length===5?n.push(0,2,4):n.push(0,r),e.map((e,i)=>n.includes(i)?an(e,i,r,t):null)}async function dn(e,t,n){let i=!1,a=[],o=[];if(e.stops){let t=e.stops;a=t.map(e=>e.value),i=t.some(e=>!!e.label),i&&(o=t.map(e=>e.label))}let s=a[0],c=a[a.length-1];if(s==null&&c==null)return null;let l=i?null:un(a,n);return(await Promise.all(a.map(async(n,a)=>{let s=e.type===`opacity`?await fn(n,e,t):(await r(async()=>{let{getColor:e}=await import(`./visualVariableUtils-BPPIHCjn.js`);return{getColor:e}},__vite__mapDeps([8,4,5]))).getColor(e,n),c=i?o[a]:l?.[a]??``;return s==null?null:{value:n,color:s,label:c}}))).filter(p).reverse()}async function fn(e,t,n){let i=new Be(n??ln),a=(await r(async()=>{let{getOpacity:e}=await import(`./visualVariableUtils-BPPIHCjn.js`);return{getOpacity:e}},__vite__mapDeps([8,4,5]))).getOpacity(t,e);return a!=null&&(i.a=a),i}function pn(e){if(!e.colorStops)return[];let t=[...e.colorStops].filter(e=>e.color?.a>0),n=t.length-1;if(t&&t[0]){let e=t[n];e&&e.ratio!==1&&(t.push(new Ye({ratio:1,color:e.color})),n++)}return t.map((t,r)=>{let i=``;return r===0?i=e.legendOptions?.minLabel||`low`:r===n&&(i=e.legendOptions?.maxLabel||`high`),{color:t.color,label:i,ratio:t.ratio}}).reverse()}o(`short-date`);async function z(e,t,n){fe(e,t,()=>[]).push(...n)}async function mn(e){let t=new Map;if(!e)return t;if(`visualVariables`in e&&e.visualVariables){for(let n of e.visualVariables)if(hn(n)){let e=(await dn(n)??[]).map(e=>e.color);await z(t,n.field||n.valueExpression,e)}}if(e.type===`heatmap`){let n=pn(e).map(e=>e.color);await z(t,e.field||e.valueExpression,n)}else if(e.type===`pie-chart`){for(let n of e.attributes)await z(t,n.field||n.valueExpression,[n.color]);await z(t,`default`,[e?.othersCategory?.color,rt(e.backgroundFillSymbol,null)])}else if(e.type===`dot-density`){for(let n of e.attributes)await z(t,n.field||n.valueExpression,[n.color]);await z(t,`default`,[e.backgroundColor])}else if(e.type===`unique-value`)if(e.authoringInfo?.type===`predominance`)for(let n of e.uniqueValueInfos??[])await z(t,n.value.toString(),[rt(n.symbol,null)]);else{let n=(e.uniqueValueInfos??[]).map(e=>rt(e.symbol,null)),{field:r,field2:i,field3:a,valueExpression:o}=e;(r||o)&&await z(t,r||o,n),i&&await z(t,i,n),a&&await z(t,a,n)}else if(e.type===`class-breaks`){let n=e.classBreakInfos.map(e=>rt(e.symbol,null)),{field:r,valueExpression:i}=e;await z(t,r??i,n)}else e.type===`simple`&&await z(t,`default`,[rt(e.symbol,null)]);return`defaultSymbol`in e&&e.defaultSymbol&&await z(t,`default`,[rt(e.defaultSymbol,null)]),t.forEach((e,n)=>{let r=te(e.filter(Boolean),(e,t)=>JSON.stringify(e)===JSON.stringify(t));t.set(n,r)}),t}function hn(e){return e.type===`color`}var gn=`esri.widgets.Feature.support.relatedFeatureUtils`,_n=()=>Ue.getLogger(gn),vn=new Map;function yn(e){if(!_t(e))return null;let[t,n]=e.split(`/`).slice(1);return{layerId:t,fieldName:n}}function bn(e,t){if(!t.relationships)return null;let n=null,{relationships:r}=t;return r.some(t=>t.id===parseInt(e,10)&&(n=t,!0)),n}function xn({originRelationship:e,relationships:t,layerId:n}){return t.find(({relatedTableId:t,id:r})=>`${t}`===n&&r===e?.id)??null}function Sn(e,t){let n=t.toLowerCase();for(let t in e)if(t.toLowerCase()===n)return e[t];return null}function Cn(e,t){let n=bn(e,t);if(n)return{url:`${t.url}/${n.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:n,relatedFields:[],outStatistics:[]}}function wn(e,t){if(!t||!e)return;let{features:n,statsFeatures:r}=e,i=n?.value;t.relatedFeatures=i?i.features:[];let a=r?.value;t.relatedStatsFeatures=a?a.features:[]}function Tn(e,t,n,r){let i=new ee;return i.outFields=[`*`],i.relationshipId=typeof t.id==`number`?t.id:parseInt(t.id,10),i.objectIds=[e.attributes[n.objectIdField]],i.gdbVersion=n.gdbVersion??null,i.historicMoment=n.historicMoment??null,n.queryRelatedFeatures?.(i,r)??Promise.resolve({})}function En(e,t,n){let r=0,i=[];for(;r<t.length;)i.push(`${e} IN (${t.slice(r,n+r)})`),r+=n;return i.join(` OR `)}function Dn(e){return e?te(e):void 0}function On(e){return e?te(e,(e,t)=>JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON())):void 0}async function kn(e,t,n,r){let i=n.layerId.toString(),{layerInfo:a,relation:o,relatedFields:s,outStatistics:c,url:l,sourceSpatialReference:u}=t,d=Dn(s),f=On(c);if(!a||!o)return null;let p=xn({originRelationship:o,relationships:a.relationships,layerId:i});if(p?.relationshipTableId&&p.keyFieldInRelationshipTable){let t=(await Tn(e,p,n,r))[e.attributes[n.objectIdField]];if(!t)return null;let i=t.features.map(e=>e.attributes[a.objectIdField]);if(f?.length&&a.supportsStatistics){let e=new ze;e.where=En(a.objectIdField,i,1e3),e.outFields=d,e.outStatistics=f,e.sourceSpatialReference=u;let n={features:Promise.resolve(t),statsFeatures:tt(l,e)};return ce(n)}}let m=p?.keyField;if(m){let t=ke(Pn(a.fields,m)),i=Sn(e.attributes,o.keyField),s=t?`${m}=${i}`:`${m}='${i}'`,c=n.historicMoment,p=n.gdbVersion,h=tt(l,new ze({where:s,outFields:d,sourceSpatialReference:u,historicMoment:c,gdbVersion:p}),r),g=f?.length&&a.supportsStatistics?tt(l,new ze({where:s,outFields:d,outStatistics:f,sourceSpatialReference:u}),r):null,_={features:h};return g&&(_.statsFeatures=g),ce(_)}return null}function An(e,t){return re(e,{query:{f:`json`},signal:t?.signal})}function jn({relatedInfos:e,layer:n},r){let a={};return e.forEach((e,t)=>{let{relation:r}=e;if(!r){let e=new i(`editor:relation-required`,`A relation is required on a layer to retrieve related records.`);throw _n().error(e),e}let{relatedTableId:o}=r;if(typeof o!=`number`){let e=new i(`editor:related-table`,`A related table ID is required on a layer to retrieve related records.`);throw _n().error(e),e}let s=`${n.url}/${o}`,c=vn.get(s),l=c??An(s);c||vn.set(s,l),a[t]=l}),t(ce(a),r)}function Mn({graphic:e,relatedInfos:t,layer:n},r){let i={};return t.forEach((t,a)=>{t.layerInfo&&(i[a]=kn(e,t,n,r))}),ce(i)}function Nn({relatedInfo:e,fieldName:t,fieldInfo:n}){if(e.relatedFields?.push(t),n.statisticType){let r=new Te({statisticType:n.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics?.push(r)}}function Pn(e,t){if(e!=null){t=t.toLowerCase();for(let n of e)if(n&&n.name.toLowerCase()===t)return n}return null}var Fn={chartAnimation:!0},B=class extends S{constructor(e){super(e),this.abilities={...Fn},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{...Fn,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){let{formattedMediaInfoCount:t}=this;this.activeMediaInfoIndex=(e+t)%t}_pageContentElementMedia(e){let{activeMediaInfoIndex:t}=this,n=t+e;this._setContentElementMedia(n)}_formatMediaInfos(){let{mediaInfos:e,layer:t}=this,n=this.attributes??{},r=this.formattedAttributes??{},i=this.expressionAttributes??{},a=this.fieldInfoMap??new Map;return e?.map(e=>{let o=e?.clone();return o?(o.title=vt({attributes:n,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:t,text:o.title}),o.caption=vt({attributes:n,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:t,text:o.caption}),o.altText=vt({attributes:n,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:t,text:o.altText}),o.type===`image`?o.value?(this._setImageValue({value:o.value,formattedAttributes:r,layer:t}),o.value.sourceURL?o:void 0):void 0:o.type===`pie-chart`||o.type===`line-chart`||o.type===`column-chart`||o.type===`bar-chart`?o.value?(this._setChartValue({value:o.value,chartType:o.type,attributes:n,formattedAttributes:r,layer:t,expressionAttributes:i}),o):void 0:null):null}).filter(p)??[]}_setImageValue(e){let t=this.fieldInfoMap??new Map,{value:n,formattedAttributes:r,layer:i}=e,{linkURL:a,sourceURL:o}=n;if(o){let e=Tt(o,i);n.sourceURL=kt({formattedAttributes:r,template:e,fieldInfoMap:t})}if(a){let e=Tt(a,i);n.linkURL=kt({formattedAttributes:r,template:e,fieldInfoMap:t})}}_setChartValue(e){let{value:t,attributes:n,formattedAttributes:r,chartType:i,layer:a,expressionAttributes:o}=e,{popupTemplate:s,relatedInfos:c}=this,{fields:l,normalizeField:u}=t,d=a;if(t.fields=Et(l,d),u&&(t.normalizeField=dt(u,d)),!l.some(e=>!!(r[e]!=null||_t(e)&&c?.size)))return;let f=s?.fieldInfos??[];l.forEach((e,a)=>{let s=t.colors?.[a];if(_t(e))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:f,fieldName:e,formattedAttributes:r,chartType:i,value:t,color:s})]);let c=this._getChartOption({value:t,attributes:n,chartType:i,formattedAttributes:r,expressionAttributes:o,fieldName:e,fieldInfos:f,color:s});t.series.push(c)})}_getRelatedChartInfos(e){let{fieldInfos:t,fieldName:n,formattedAttributes:r,chartType:i,value:a,color:o}=e,s=[],c=yn(n),l=c&&this.relatedInfos?.get(c.layerId.toString());if(!l)return s;let{relatedFeatures:u,relation:d}=l;if(!d||!u)return s;let{cardinality:f}=d;return u.forEach(e=>{let{attributes:l}=e;l&&Object.keys(l).forEach(e=>{e===c.fieldName&&s.push(this._getChartOption({value:a,attributes:l,formattedAttributes:r,fieldName:n,chartType:i,relatedFieldName:e,hasMultipleRelatedFeatures:u?.length>1,fieldInfos:t,color:o}))})}),f===`one-to-many`||f===`many-to-many`?s:[s[0]]}_getTooltip({label:e,value:t,chartType:n}){return n===`pie-chart`?`${e}`:`${e}: ${t}`}_getChartOption(e){let{value:t,attributes:n,formattedAttributes:r,expressionAttributes:i,fieldName:a,relatedFieldName:o,fieldInfos:s,chartType:c,hasMultipleRelatedFeatures:l,color:u}=e,{layer:d,graphic:f}=this,p=this.fieldInfoMap??new Map,{normalizeField:m,tooltipField:h}=t,g=m?_t(m)?n[yn(m).fieldName]:n[m]:null,_=jt(a)&&i?.[a]!==void 0?i[a]:o&&n[o]!==void 0?n[o]:n[a]===void 0?r[a]:n[a],v=_===void 0?null:_&&g?_/g:_,y=new He({fieldName:a,color:u,value:v==null?void 0:typeof v==`number`?v:Number(v)});if(_t(a)){let e=p.get(a.toLowerCase()),t=h&&p.get(h.toLowerCase()),i=e?.fieldName??a,s=l&&h?yn(h).fieldName:t?.fieldName??h,u=l&&s?n[s]:r[s]??(e&&Pt({fieldInfo:e,graphic:f,layer:d}))??e?.fieldName??o,m=l&&o?n[o]:r[i];return y.tooltip=this._getTooltip({label:u,value:m,chartType:c}),y}let ee=Nt(s,a),te=dt(a,d),ne=h&&r[h]!==void 0?r[h]:Pt({fieldInfo:ee||new me({fieldName:te}),expressionInfos:this.popupTemplate?.expressionInfos,graphic:f,layer:d}),re=r[te];return y.tooltip=this._getTooltip({label:ne,value:re,chartType:c}),y}};T([a()],B.prototype,`abilities`,void 0),T([Ae(`abilities`)],B.prototype,`castAbilities`,null),T([a()],B.prototype,`activeMediaInfoIndex`,void 0),T([a({readOnly:!0})],B.prototype,`activeMediaInfo`,null),T([a()],B.prototype,`attributes`,void 0),T([a()],B.prototype,`description`,void 0),T([a()],B.prototype,`fieldInfoMap`,void 0),T([a()],B.prototype,`formattedAttributes`,void 0),T([a()],B.prototype,`expressionAttributes`,void 0),T([a({readOnly:!0})],B.prototype,`formattedMediaInfos`,null),T([a()],B.prototype,`graphic`,void 0),T([a()],B.prototype,`layer`,void 0),T([a({readOnly:!0})],B.prototype,`formattedMediaInfoCount`,null),T([a()],B.prototype,`mediaInfos`,void 0),T([a()],B.prototype,`popupTemplate`,void 0),T([a()],B.prototype,`relatedInfos`,void 0),T([a()],B.prototype,`title`,void 0),B=T([y(`esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel`)],B);var V=`esri-feature-media`,H={base:V,mediaContainer:`${V}__container`,mediaItemContainer:`${V}__item-container`,mediaItem:`${V}__item`,mediaItemText:`${V}__item-text`,mediaItemTitle:`${V}__item-title`,mediaItemCaption:`${V}__item-caption`,mediaNavigation:`${V}__item-navigation`,mediaPagination:`${V}__pagination`,mediaPaginationText:`${V}__pagination-text`,mediaChart:`${V}__chart`,mediaPaginationButton:`${V}__pagination-button`,mediaPaginationIcon:`${V}__pagination-icon`,mediaChartRendered:`${V}__chart--rendered`},In=15,U=`category`,Ln=`value`,Rn=`rgba(50, 50, 50, 1)`,zn=250,Bn=500,Vn=200,W=class extends x{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this._chartRootMap=new WeakMap,this.viewModel=new B,this.messages=null,this._disposeChart=e=>{this._chartRootMap.get(e)?.dispose(),this._chartRootMap.delete(e)},this._createChart=async e=>{let{destroyed:t,viewModel:n}=this;if(t||!n||!e)return;let{createRoot:i}=await r(async()=>{let{createRoot:e}=await import(`./chartUtilsAm5-Bh9JPTcq.js`);return{createRoot:e}},__vite__mapDeps([9,4,5,10,11,12])),a=await i(e);this._chartRootMap.set(e,a),await this._renderChart({mediaInfo:n.activeMediaInfo,root:a})}}initialize(){this._featureElementInfo=new N,this.addHandles([D(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),C),D(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),C)])}loadDependencies(){return se({icon:()=>r(()=>import(`./calcite-icon-gYn-WqYd.js`),__vite__mapDeps([0,1,2,3,4,5,6,7]))})}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo?.destroy()}get attributes(){return this.viewModel.attributes}set attributes(e){this.viewModel.attributes=e}get activeMediaInfoIndex(){return this.viewModel.activeMediaInfoIndex}set activeMediaInfoIndex(e){this.viewModel.activeMediaInfoIndex=e}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get fieldInfoMap(){return this.viewModel.fieldInfoMap}set fieldInfoMap(e){this.viewModel.fieldInfoMap=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get mediaInfos(){return this.viewModel.mediaInfos}set mediaInfos(e){this.viewModel.mediaInfos=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get relatedInfos(){return this.viewModel.relatedInfos}set relatedInfos(e){this.viewModel.relatedInfos=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){return g(`div`,{bind:this,class:H.base,onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this._renderMedia())}_renderMedia(){let{formattedMediaInfoCount:e,activeMediaInfoIndex:t}=this.viewModel,n=this._renderMediaText();return e?g(`div`,{class:H.mediaContainer,key:`media-element-container`},this._renderMediaInfo(),g(`div`,{class:H.mediaNavigation},n,e>1?g(`div`,{class:H.mediaPagination},this._renderMediaPageButton(`previous`),g(`span`,{class:H.mediaPaginationText},Ze(this.messages.pageText,{index:t+1,total:e})),this._renderMediaPageButton(`next`)):null)):null}_renderMediaText(){let{activeMediaInfo:e}=this.viewModel;if(!e)return null;let t=e&&e.title?g(`div`,{class:H.mediaItemTitle,innerHTML:e.title,key:`media-title`}):null,n=e&&e.caption?g(`div`,{class:H.mediaItemCaption,innerHTML:e.caption,key:`media-caption`}):null;return t||n?g(`div`,{class:H.mediaItemText,key:`media-text`},t,n):null}_renderImageMediaInfo(e){if(!e.value)return null;let{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:n,formattedMediaInfoCount:r}=this.viewModel,{value:i,refreshInterval:a,altText:o,title:s,type:c}=e,{sourceURL:l,linkURL:u}=i,d=At(u??void 0)?`_blank`:`_self`,f=d===`_blank`?`noreferrer`:``,p=a?t:null,m=p?p.timestamp:0,h=p?p.sourceURL:l,_=g(`img`,{alt:o||s,key:`media-${c}-${n}-${r}-${m}`,src:h??void 0});return(u?g(`a`,{href:u,rel:f,target:d,title:s},_):null)??_}_renderChartMediaInfo(e){let{activeMediaInfoIndex:t,formattedMediaInfoCount:n}=this.viewModel;return g(`div`,{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:H.mediaChart,key:`media-${e.type}-${t}-${n}`})}_renderMediaInfoType(){let{activeMediaInfo:e}=this.viewModel;return e?e.type===`image`?this._renderImageMediaInfo(e):e.type.includes(`chart`)?this._renderChartMediaInfo(e):null:null}_renderMediaInfo(){let{activeMediaInfo:e}=this.viewModel;return e?g(`div`,{class:H.mediaItemContainer,key:`media-container`},g(`div`,{class:H.mediaItem,key:`media-item-container`},this._renderMediaInfoType())):null}_renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;let t=e===`previous`,n=t?this.messages.previous:this.messages.next,r=t?`chevron-left`:`chevron-right`,i=t?`media-previous`:`media-next`,a=t?this._previous:this._next;return g(`button`,{"aria-label":n,bind:this,class:H.mediaPaginationButton,key:i,onclick:a,tabIndex:0,title:n,type:`button`},g(`calcite-icon`,{class:H.mediaPaginationIcon,icon:r,scale:`s`}))}_setupFeatureElementInfo(){let{description:e,title:t}=this;this._featureElementInfo?.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRenderer(){if(!this.viewModel)return;let{graphic:e,layer:t}=this.viewModel;return e?.isAggregate&&t?.featureReduction&&`renderer`in t.featureReduction?t.featureReduction.renderer:t?.renderer}async _getSeriesColors(e){let{colorAm5:t}=await r(async()=>{let{colorAm5:e}=await import(`./chartCommon-DYaYefhr.js`);return{colorAm5:e}},__vite__mapDeps([13,10,4,5,14,11,15])),n=new Map;return e.forEach(e=>{e.color&&n.set(e,t(e.color.toCss(!0)))}),n}async _getRendererColors(){let{colorAm5:e}=await r(async()=>{let{colorAm5:e}=await import(`./chartCommon-DYaYefhr.js`);return{colorAm5:e}},__vite__mapDeps([13,10,4,5,14,11,15])),t=new Map,n=this._getRenderer();if(!n)return t;let i=await mn(n);return i.delete(`default`),Array.from(i.values()).every(e=>e?.length===1)&&Array.from(i.keys()).forEach(n=>{let r=i.get(n)?.[0]?.toCss(!0);r&&t.set(n,e(r))}),t}_handleMediaKeyup(e){let{key:t}=e;t===`ArrowLeft`&&(e.stopPropagation(),this.viewModel.previous()),t===`ArrowRight`&&(e.stopPropagation(),this.viewModel.next())}_canAnimateChart(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!ie()}_getChartAnimationMS(){return this._canAnimateChart()?zn:0}_getChartSeriesAnimationMS(){return this._canAnimateChart()?Bn:0}async _renderChart(e){let{root:t,mediaInfo:n}=e,{value:i,type:a}=n,{ResponsiveThemeAm5:o,DarkThemeAm5:s,AnimatedThemeAm5:c,ColorSetAm5:l,ThemeAm5:u,esriChartColorSet:d}=await r(async()=>{let{ResponsiveThemeAm5:e,DarkThemeAm5:t,AnimatedThemeAm5:n,ColorSetAm5:r,ThemeAm5:i,esriChartColorSet:a}=await import(`./chartCommon-DYaYefhr.js`);return{ResponsiveThemeAm5:e,DarkThemeAm5:t,AnimatedThemeAm5:n,ColorSetAm5:r,ThemeAm5:i,esriChartColorSet:a}},__vite__mapDeps([13,10,4,5,14,11,15])),f=u.new(t);f.rule(`ColorSet`).set(`colors`,d),f.rule(`ColorSet`).set(`reuse`,!0);let p=[o.new(t),f];Se(this.container)&&p.push(s.new(t)),this._canAnimateChart()&&p.push(c.new(t)),t.setThemes(p);let m=await this._getRendererColors(),h=await this._getSeriesColors(i.series),g=l.new(t,{}),_=h.get(i.series[0]),v=_?{lineSettings:{stroke:_}}:void 0,y=i.series.map((e,t)=>{let n=h.get(e)||m.get(e.fieldName)||g.getIndex(t);return{[U]:e.tooltip,[Ln]:e.value,columnSettings:{fill:n,stroke:n},...v}}).filter(e=>a!==`pie-chart`||e.value!=null&&e.value>0);await(a===`pie-chart`?this._createPieChart(e,y):this._createXYChart(e,y))}_getDirection(){return b(this.container)?`rtl`:`ltr`}async _customizeChartTooltip(e,t=`horizontal`){let{colorAm5:n}=await r(async()=>{let{colorAm5:e}=await import(`./chartCommon-DYaYefhr.js`);return{colorAm5:e}},__vite__mapDeps([13,10,4,5,14,11,15]));e.setAll({pointerOrientation:t}),e.get(`background`)?.setAll({stroke:n(Rn)}),e.label.setAll({direction:this._getDirection(),oversizedBehavior:`wrap`,maxWidth:Vn})}async _createPieChart(e,t){let{TooltipAm5:n}=await r(async()=>{let{TooltipAm5:e}=await import(`./chartCommon-DYaYefhr.js`);return{TooltipAm5:e}},__vite__mapDeps([13,10,4,5,14,11,15])),{PieChartAm5:i,PieSeriesAm5:a}=await r(async()=>{let{PieChartAm5:e,PieSeriesAm5:t}=await import(`./pieChart-DWlKp4rw.js`);return{PieChartAm5:e,PieSeriesAm5:t}},__vite__mapDeps([16,4,5,10,17,15,12])),{mediaInfo:o,root:s}=e,{title:c}=o,l=o?.altText||o?.title||``,u=s.container.children.push(i.new(s,{ariaLabel:l,focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),d=`{category}: {valuePercentTotal.formatNumber('0.00')}%
 ({value})`,f=n.new(s,{labelText:d}),p=u.series.push(a.new(s,{name:c,valueField:Ln,categoryField:U,tooltip:f}));p.ticks.template.set(`forceHidden`,!0),p.labels.template.set(`forceHidden`,!0),p.slices.template.states.create(`active`,{shiftRadius:5}),await this._customizeChartTooltip(f),p.slices.template.setAll({ariaLabel:d,focusable:!0,templateField:`columnSettings`}),p.data.setAll(t),await p.appear(this._getChartSeriesAnimationMS()),await u.appear(this._getChartAnimationMS()),u.root.dom.classList.toggle(H.mediaChartRendered,!0)}_getMinSeriesValue(e){let t=0;return e.forEach(e=>t=Math.min(e.value,t)),t}async _createColumnChart(e,t,n){let{TooltipAm5:i,ScrollbarAm5:a}=await r(async()=>{let{TooltipAm5:e,ScrollbarAm5:t}=await import(`./chartCommon-DYaYefhr.js`);return{TooltipAm5:e,ScrollbarAm5:t}},__vite__mapDeps([13,10,4,5,14,11,15])),{CategoryAxisAm5:o,AxisRendererXAm5:s,ValueAxisAm5:c,AxisRendererYAm5:l,ColumnSeriesAm5:u}=await r(async()=>{let{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,ColumnSeriesAm5:i}=await import(`./xyChart-CPqb_gmv.js`);return{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,ColumnSeriesAm5:i}},__vite__mapDeps([18,4,5,10,14,17,15,12])),{mediaInfo:d,root:f}=t,{value:p,title:m}=d;e.setAll({wheelX:`panX`,wheelY:`zoomX`});let h=e.xAxes.push(o.new(f,{renderer:s.new(f,{inversed:b(this.container)}),categoryField:U}));h.get(`renderer`).labels.template.setAll({forceHidden:!0});let g=e.yAxes.push(c.new(f,{renderer:l.new(f,{inside:!1}),min:this._getMinSeriesValue(p.series)}));g.get(`renderer`).labels.template.setAll({direction:this._getDirection()});let _=`{categoryX}`,v=i.new(f,{labelText:_}),y=e.series.push(u.new(f,{name:m,xAxis:h,yAxis:g,valueYField:Ln,categoryXField:U,tooltip:v}));await this._customizeChartTooltip(v),y.columns.template.setAll({ariaLabel:_,focusable:!0,templateField:`columnSettings`}),p.series.length>In&&e.set(`scrollbarX`,a.new(f,{orientation:`horizontal`})),h.data.setAll(n),y.data.setAll(n),await y.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createBarChart(e,t,n){let{TooltipAm5:i,ScrollbarAm5:a}=await r(async()=>{let{TooltipAm5:e,ScrollbarAm5:t}=await import(`./chartCommon-DYaYefhr.js`);return{TooltipAm5:e,ScrollbarAm5:t}},__vite__mapDeps([13,10,4,5,14,11,15])),{CategoryAxisAm5:o,AxisRendererXAm5:s,ValueAxisAm5:c,AxisRendererYAm5:l,ColumnSeriesAm5:u}=await r(async()=>{let{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,ColumnSeriesAm5:i}=await import(`./xyChart-CPqb_gmv.js`);return{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,ColumnSeriesAm5:i}},__vite__mapDeps([18,4,5,10,14,17,15,12])),{mediaInfo:d,root:f}=t,{value:p,title:m}=d;e.setAll({wheelX:`panY`,wheelY:`zoomY`});let h=e.yAxes.push(o.new(f,{renderer:l.new(f,{inversed:!0}),categoryField:U}));h.get(`renderer`).labels.template.setAll({forceHidden:!0});let g=e.xAxes.push(c.new(f,{renderer:s.new(f,{inside:!1,inversed:b(this.container)}),min:this._getMinSeriesValue(p.series)}));g.get(`renderer`).labels.template.setAll({direction:this._getDirection()});let _=`{categoryY}`,v=i.new(f,{labelText:_}),y=e.series.push(u.new(f,{name:m,xAxis:g,yAxis:h,valueXField:Ln,categoryYField:U,tooltip:v}));await this._customizeChartTooltip(v,`vertical`),y.columns.template.setAll({ariaLabel:_,focusable:!0,templateField:`columnSettings`}),p.series.length>In&&e.set(`scrollbarY`,a.new(f,{orientation:`vertical`})),h.data.setAll(n),y.data.setAll(n),await y.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createLineChart(e,t,n){let{TooltipAm5:i,ScrollbarAm5:a}=await r(async()=>{let{TooltipAm5:e,ScrollbarAm5:t}=await import(`./chartCommon-DYaYefhr.js`);return{TooltipAm5:e,ScrollbarAm5:t}},__vite__mapDeps([13,10,4,5,14,11,15])),{CategoryAxisAm5:o,AxisRendererXAm5:s,ValueAxisAm5:c,AxisRendererYAm5:l,LineSeriesAm5:u}=await r(async()=>{let{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,LineSeriesAm5:i}=await import(`./xyChart-CPqb_gmv.js`);return{CategoryAxisAm5:e,AxisRendererXAm5:t,ValueAxisAm5:n,AxisRendererYAm5:r,LineSeriesAm5:i}},__vite__mapDeps([18,4,5,10,14,17,15,12])),{root:d,mediaInfo:f}=t,{value:p,title:m}=f;e.setAll({wheelX:`panX`,wheelY:`zoomX`});let h=e.xAxes.push(o.new(d,{renderer:s.new(d,{inversed:b(this.container)}),categoryField:U}));h.get(`renderer`).labels.template.setAll({forceHidden:!0});let g=e.yAxes.push(c.new(d,{renderer:l.new(d,{inside:!1}),min:this._getMinSeriesValue(p.series)}));g.get(`renderer`).labels.template.setAll({direction:this._getDirection()});let _=n[0]?.lineSettings?.stroke,v=i.new(d,{getFillFromSprite:!_,labelText:`{categoryX}`});_&&v.get(`background`)?.setAll({fill:_});let y=e.series.push(u.new(d,{name:m,xAxis:h,yAxis:g,valueYField:Ln,categoryXField:U,tooltip:v}));y.strokes.template.setAll({templateField:`lineSettings`}),await this._customizeChartTooltip(v,`vertical`),p.series.length>In&&e.set(`scrollbarX`,a.new(d,{orientation:`horizontal`})),h.data.setAll(n),y.data.setAll(n),await y.appear(this._getChartSeriesAnimationMS()),await e.appear(this._getChartAnimationMS())}async _createXYChart(e,t){let{XYChartAm5:n,XYCursorAm5:i}=await r(async()=>{let{XYChartAm5:e,XYCursorAm5:t}=await import(`./xyChart-CPqb_gmv.js`);return{XYChartAm5:e,XYCursorAm5:t}},__vite__mapDeps([18,4,5,10,14,17,15,12])),{root:a,mediaInfo:o}=e,{type:s}=o,c=o?.altText||o?.title||``,l=a.container.children.push(n.new(a,{ariaLabel:c,focusable:!0,panX:!0,panY:!0}));l.set(`cursor`,i.new(a,{})),s===`column-chart`&&await this._createColumnChart(l,e,t),s===`bar-chart`&&await this._createBarChart(l,e,t),s===`line-chart`&&await this._createLineChart(l,e,t),l.root.dom.classList.toggle(H.mediaChartRendered,!0)}_clearMediaRefreshTimer(){let{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){let t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();let{activeMediaInfo:e}=this.viewModel;e?.type===`image`&&e?.refreshInterval>0&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){let{refreshInterval:t,value:n}=e,r=6e4*t;this._updateMediaInfoTimestamp(n.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(n.sourceURL)},r)}_getImageSource(e,t){let n=e.includes(`?`)?`&`:`?`,[r,i=``]=e.split(`#`);return`${r}${n}timestamp=${t}${i?`#`:``}${i}`}};T([a()],W.prototype,`_refreshIntervalInfo`,void 0),T([a()],W.prototype,`attributes`,null),T([a()],W.prototype,`activeMediaInfoIndex`,null),T([a()],W.prototype,`description`,null),T([a()],W.prototype,`fieldInfoMap`,null),T([a()],W.prototype,`layer`,null),T([a()],W.prototype,`mediaInfos`,null),T([a()],W.prototype,`popupTemplate`,null),T([a()],W.prototype,`relatedInfos`,null),T([a()],W.prototype,`title`,null),T([a({type:B})],W.prototype,`viewModel`,void 0),T([a(),f(`esri/widgets/Feature/t9n/Feature`)],W.prototype,`messages`,void 0),W=T([y(`esri.widgets.Feature.FeatureMedia`)],W);var Hn=`esri.widgets.Feature.support.arcadeFeatureUtils`,Un=()=>Ue.getLogger(Hn);function Wn(e){return yt(ht(e))}function Gn(e){return`createQuery`in e&&`queryFeatures`in e}async function Kn({graphic:e,view:t,options:n}){let{isAggregate:r}=e,i=e.layer??e.sourceLayer;if(!r||!i||t?.type!==`2d`)return[];let a=await t.whenLayerView(i);if(!Gn(a))return[];let o=a.createQuery(),s=e.getObjectId();o.aggregateIds=s==null?[]:[s];let{features:c}=await a.queryFeatures(o,n);return c}function qn({layer:e,aggregatedFeatures:t,interceptor:n}){let{fields:r,objectIdField:i,geometryType:a,spatialReference:o}=e,s=`displayField`in e?e.displayField:void 0;return new be({fields:r,objectIdField:i,geometryType:a,spatialReference:o,displayField:s,interceptor:n,...e.type===`feature`?{templates:e.templates,typeIdField:e.typeIdField,types:e.types}:null,source:t})}function Jn(e){return e.isAggregate?`popup-feature-reduction`:e.declaredClass===`esri.views.3d.layers.VoxelGraphic`?`popup-voxel`:nt(e.origin)||it(e.origin)?`popup-imagery`:`popup`}function Yn(e){return{scale:e?.scale,timeProperties:{currentStart:e?.timeExtent?.start,currentEnd:e?.timeExtent?.end,startIncluded:!0,endIncluded:!0}}}function Xn(e){return{$voxel:e}}function Zn(e){let t=null;if(e.origin.layer.fields?.length>0){t=e.cloneShallow();let n=e.origin.layer.fieldsIndex;t.attributes=Object.fromEntries(Object.entries(t.attributes??{}).filter(([e])=>n.has(e)))}return{$pixel:e,$imageCollectionItem:t}}async function Qn(e,t,n,r,i,a,o){let s=null;if(a.has(`$aggregatedfeatures`)){let e=await Kn({graphic:t,view:n,options:r}),a=t.sourceLayer||t.layer;s=qn({layer:a,aggregatedFeatures:e,interceptor:i})}return{vars:{$feature:t,$aggregatedFeatures:s,$view:Yn(n)},track:o?await er(e,t,n):null,[Symbol.dispose]:()=>s?.[Symbol.dispose]()}}function $n(e){if(le(e))return e.getTime();if(typeof e==`number`)return e;if(typeof e==`string`)return new Date(e).getTime();throw Error(`Unexpected time value: ${e}`)}async function er(e,t,n){let r=t.sourceLayer||t.layer;if(r==null||!(`timeInfo`in r))return null;let i=r.timeInfo?.trackIdField;if(i==null)return null;let a=t.getAttribute(i);if(a==null)return null;let o,s;if(typeof a==`string`)o=`"${i.replaceAll(`"`,`""`)}" = '${a.replaceAll(`'`,`''`)}'`;else{if(typeof a!=`number`)return Un().warn(`Expected track id to be a string or number`),null;o=`"${i.replaceAll(`"`,`""`)}" = ${a}`}if(r.type===`stream`&&n!=null){let e=await n.whenLayerView(r),t=e.createQuery();t.returnGeometry=!0,t.where=m(t.where,o),s=(await e.queryFeatures(t)).features}else{if(!(`queryFeatures`in r))return null;{let e=r.createQuery();e.returnGeometry=!0,e.where=m(e.where,o),s=(await r.queryFeatures(e)).features}}let c=r.fieldsIndex.normalizeFieldName(r.timeInfo.startField)??`__esri_time_received__`,l=r.timeInfo.endField?r.fieldsIndex.normalizeFieldName(r.timeInfo.endField):null,u=s.map(t=>{let r=t.getObjectId();if(r==null)throw Error(`Cannot identify observation`);let i=e.ArcadeFeature.createFromGraphic(t,n?.timeZone),a=$n(t.getAttribute(c));return{id:r,feature:i,startTime:a,endTime:l==null?a:$n(t.getAttribute(l)),stats:{totalDistance:void 0,distance:void 0,speed:void 0,acceleration:void 0}}}).sort((e,t)=>e.startTime-t.startTime),d=t.declaredClass===`esri.TrackGraphic`?u.length-1:u.findIndex(e=>t.getObjectId()===e.id);if(d<0)throw Error(`Couldn't locate feature in observations`);return{observations:u,currentObservationIndex:d}}async function tr(e,t,n,r,i,a){let o=(t.sourceLayer||t.layer)??void 0;return{vars:{$feature:t,$layer:o!=null&&$e(o)?o:o?.type===`scene`&&o.associatedLayer!=null?o.associatedLayer:void 0,$map:n,$datastore:o&&`url`in o?o.url:void 0,$userInput:r,$graph:o?.type===`knowledge-graph-sublayer`?o.parentCompositeLayer?.knowledgeGraph:void 0,$view:Yn(i)},track:a?await er(e,t,i):null}}async function nr(e,{arcade:t,graphic:n,map:r,location:i,view:a,options:o,interceptor:s,arcadeExecutor:c,usesTrack:l}){switch(e){case`popup`:return{...await tr(t,n,r,i,a,l),[Symbol.dispose](){}};case`popup-feature-reduction`:{let e=new Set(c.variablesUsed);return await Qn(t,n,a,o,s,e,l)}case`popup-voxel`:return{vars:Xn(n),track:null,[Symbol.dispose](){}};case`popup-imagery`:return{vars:Zn(n),track:null,[Symbol.dispose](){}};default:throw Error(`Unexpected profile name ${e}`)}}async function rr(){let[e,t,{Feature:n}]=await Promise.all([r(()=>import(`./arcade-BEgcp4A0.js`),__vite__mapDeps([19,4,5,20,21])),r(()=>import(`./arcade-B3q1v9qD.js`),__vite__mapDeps([22,23,4,5,20,24,25,26,27,28,29,30,31,32,33,21,34,35,36,37,38,39,40,41,42])),r(()=>import(`./Feature-iXAdRAf_.js`),__vite__mapDeps([43,23,4,5,20,24,25,29,30,31,32,33]))]);return{executor:e,syntaxUtils:t,ArcadeFeature:n}}async function ir(e,t,n){let{executor:{createArcadeProfile:r,createArcadeExecutor:i},syntaxUtils:a}=n,o=Jn(t),s=r(o),c;try{c=await i(e,s)}catch(t){return Un().error(`arcade-executor-error`,{error:t,expression:e}),null}let l=new Set;c.variablesUsed.includes(`$view`)&&(a.scriptUsesViewProperties(c.syntaxTree,[`scale`])&&l.add(`view-scale`),a.scriptUsesViewProperties(c.syntaxTree,[`timeProperties`])&&l.add(`view-time-extent`));let u=a.scriptUsesTrack(c.syntaxTree);return{dependencies:l,async evaluate({graphic:t,interceptor:r,location:i,map:a,options:s,spatialReference:l,view:d}){let f={stack:[],error:void 0,hasError:!1};try{let p=je(f,await nr(o,{arcade:n,graphic:t,map:a,location:i,view:d,options:s,interceptor:r,arcadeExecutor:c,usesTrack:u}),!1),m={abortSignal:s?.signal??void 0,interceptor:r??void 0,rawOutput:!0,spatialReference:l??void 0,timeZone:d?.timeZone,track:p.track,console(...e){Un().info(...e)}};try{return await c.executeAsync(p.vars,m)}catch(n){if(s?.signal?.aborted)return;Un().error(`arcade-execution-error`,{error:n,graphic:t,expression:e});return}}catch(e){f.error=e,f.hasError=!0}finally{ue(f)}}}}async function ar({expression:e,graphic:t}){return e?ir(e,t,await rr()):null}async function or(e,t){if(!e?.length)return{dependencies:new Set,expressions:new Map};let n=await rr(),r=new Set,i=new Map;for(let a of e){let e=await ir(a.expression,t,n);i.set(`expression/${a.name}`,e),e?.dependencies.forEach(e=>r.add(e))}return{dependencies:r,expressions:i}}var sr=1,G=class extends S{constructor(t){super(t),this._compileTask=null,this._evaluateTask=null,this.expressionInfo=null,this.graphic=null,this.contentElementViewModel=null,this.interceptor=null,this.location=null,this.view=null,this._createVM=()=>{let e=this.contentElement?.type;this.contentElementViewModel?.destroy();let t=e===`fields`?new L:e===`media`?new B:e===`text`?new F:null;this._set(`contentElementViewModel`,t)},this._compileThrottled=ct(this._startCompile,()=>this.notifyChange(`state`),sr,this),this._evaluateThrottled=ct(this._startEvaluate,()=>this.notifyChange(`state`),sr,this),this.addHandles([D(()=>[this.expressionInfo,this.graphic],()=>this._compileThrottled(),C),D(()=>[this.contentElement],()=>this._createVM(),C),e(()=>{if(!this._compileTask?.finished)return null;let e=this._compileTask.value,t=e?.dependencies;return[e,this.spatialReference,this.map,this.view,t?.has(`view-scale`)?this.view?.scale:null,t?.has(`view-time-extent`)?this.view?.timeExtent?.start:null,t?.has(`view-time-extent`)?this.view?.timeExtent?.end:null]},([e])=>this._evaluateThrottled(e))])}initialize(){this.addHandles([this._compileThrottled,this._evaluateThrottled])}destroy(){this._compileTask=w(this._compileTask),this._evaluateTask=w(this._evaluateTask),this.contentElementViewModel?.destroy(),this._set(`contentElementViewModel`,null)}get contentElement(){return this._evaluateTask?.value}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override(`spatialReference`,e)}get state(){let{contentElement:e,contentElementViewModel:t}=this;return this._compileThrottled.hasPendingUpdates()||this._evaluateThrottled.hasPendingUpdates()||!this._compileTask?.finished||!this._evaluateTask?.finished?`loading`:e||t?`ready`:`disabled`}get map(){return this.view?.map??null}set map(e){this._override(`map`,e)}_startCompile(){this._evaluateTask=w(this._evaluateTask),this._compileTask=w(this._compileTask),this._compileTask=ge(async e=>{let{expressionInfo:t,graphic:n}=this,r=t?.expression;if(!r||!n)return null;let i=await ar({expression:r,graphic:n});return ye(e),i})}_startEvaluate(e){this._evaluateTask=w(this._evaluateTask),this._evaluateTask=ge(async t=>{let{graphic:n}=this;if(!e||!n)return null;let{interceptor:r,spatialReference:i,map:a,location:o,view:s}=this,c=await e.evaluate({graphic:n,interceptor:r,location:o,map:a,options:{signal:t},spatialReference:i,view:s});ye(t);let l=c;if(!l||l.declaredClass!==`esri.arcade.Dictionary`)return null;let u=await l.castAsJsonAsync(t);ye(t);let d=u?.type,f=d===`media`?Ee.fromJSON(u):d===`text`?pe.fromJSON(u):d===`fields`?Ve.fromJSON(u):null;return f.type===`media`&&!f.mediaInfos||f.type===`fields`&&!f.fieldInfos||f.type===`text`&&!f.text?null:f})}};T([a()],G.prototype,`_compileTask`,void 0),T([a()],G.prototype,`_evaluateTask`,void 0),T([a({type:We})],G.prototype,`expressionInfo`,void 0),T([a({type:qe})],G.prototype,`graphic`,void 0),T([a({readOnly:!0})],G.prototype,`contentElement`,null),T([a({readOnly:!0})],G.prototype,`contentElementViewModel`,void 0),T([a()],G.prototype,`interceptor`,void 0),T([a({type:Ie})],G.prototype,`location`,void 0),T([a()],G.prototype,`spatialReference`,null),T([a({readOnly:!0})],G.prototype,`state`,null),T([a()],G.prototype,`map`,null),T([a()],G.prototype,`view`,void 0),G=T([y(`esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel`)],G);var cr=`esri-feature`,lr={base:`${cr}-expression`,loadingSpinnerContainer:`${cr}__loading-container`},ur=class extends x{constructor(e,t){super(e,t),this._contentWidget=null,this.viewModel=new G}initialize(){this.addHandles(D(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),C))}loadDependencies(){return se({loader:()=>r(()=>import(`./calcite-loader-CQiQFcGp.js`),__vite__mapDeps([44,45,4,5,2,46,47]))})}destroy(){this._destroyContentWidget()}render(){let{state:e}=this.viewModel;return g(`div`,{class:lr.base},e===`loading`?this._renderLoading():e===`disabled`?null:this._contentWidget?.render())}_renderLoading(){return g(`div`,{class:lr.loadingSpinnerContainer,key:`loading-container`},g(`calcite-loader`,{inline:!0,label:``}))}_destroyContentWidget(){let{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){let{contentElementViewModel:e,contentElement:t}=this.viewModel,n=t?.type;this._destroyContentWidget(),this._contentWidget=e?n===`fields`?new R({viewModel:e}):n===`media`?new W({viewModel:e}):n===`text`?new I({viewModel:e}):null:null,this.scheduleRender()}};T([a({type:G})],ur.prototype,`viewModel`,void 0),ur=T([y(`esri.widgets.Feature.FeatureExpression`)],ur);var dr=e=>{let t=[];if(e.formTemplate){let{description:n,title:r}=e.formTemplate;e.fields?.forEach(e=>{let i=r&&Pe(r,e.name),a=n&&Pe(n,e.name);(i||a)&&t.push(e.name)})}return t},fr=100,K=class extends Ce(_(S)){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{let{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{let{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{let{_queryPageAbortController:e}=this;e&&e.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();let e=new AbortController;this._queryAbortController=e,await Re(this._query()),this._queryAbortController===e&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();let e=new AbortController;this._queryFeatureCountAbortController=e,await Re(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{let e=new AbortController;this._queryPageAbortController=e,await Re(this._queryPage()),this._queryPageAbortController===e&&(this._queryPageAbortController=null)},this._queryDebounced=d(this._queryController,fr),this._queryFeatureCountDebounced=d(this._queryFeatureCountController,fr),this._queryPageDebounced=d(this._queryPageController,fr),this._query=async()=>{let{_queryAbortController:e,relatedFeatures:t}=this;this.featureCount&&(this.relatedLayer?.type!==`subtype-group`||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,t.destroyAll(),this.destroyed||t.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:e?.signal}))))},this.addHandles([D(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory],()=>this._queryDebounced(),C),D(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),D(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){let{featuresPerPage:t,featureCount:n}=this,r=Math.ceil(n/t)||1;this._set(`featurePage`,Math.min(Math.max(e,1),r))}get featurePage(){return this._get(`featurePage`)}get orderByFieldsFixedCasing(){let{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(e=>{let n=e.clone();return n.field=dt(e.field,t),n}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&this.relationshipId!=null&&typeof this.objectId==`number`}get canQuery(){let e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&this.relationshipId!=null&&this.objectId!=null&&e?.supportsCount&&e?.supportsPagination)}get allCategoriesCount(){return this.allCategories?.length??0}get categories(){let{allCategories:e}=this;return this.showAllEnabled?e:e?.slice(0,this.displayCount)??null}set displayCount(e){this._set(`displayCount`,Math.min(Math.max(e??3,0),10))}get displayCount(){return this._get(`displayCount`)}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get(`relatedFeatures`)||new De}get relatedLayer(){let{layer:e,map:t,relationship:n}=this;if(!e?.loaded||!t||!n)return null;let r=e.type===`subtype-sublayer`&&e.parent&&Dt(e.parent)?e.parent:e;return St(t,r,n)??null}get relatedLayerKeyField(){let{relatedLayer:e,relationshipId:t}=this;return e?.loaded&&t!=null?e.relationships?.find(e=>e.id===t)?.keyField:null}get relatedLayerKeyFields(){let{relatedLayer:e}=this;return e?.loaded?e.relationships?.map(e=>e.keyField).filter(p)??[]:[]}get relationship(){let{relationshipId:e,layer:t}=this;return e!=null&&t?.loaded?t.relationships?.find(({id:t})=>t===e)??null:null}get relationshipKey(){let{relationshipKeyField:e}=this;return(e&&this.graphic?.attributes?.[e])??null}get relationshipKeyField(){return this.relationship?.keyField||null}get relatedFeatureViewModels(){return this._get(`relatedFeatureViewModels`)||new De}get state(){let{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:n,canQuery:r,_loaded:i,canLoad:a}=this;return t||a&&!i?`loading`:e||n?`querying`:r?`ready`:`disabled`}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}async _queryFeatureCount(){let{layer:e,relatedLayer:t}=this;await e?.load(),await t?.load();let{_queryFeatureCountAbortController:n,activeCategory:i,canQuery:a,objectId:o,relatedLayerKeyField:s,relationshipId:c,relationshipKey:l,supportsCacheHint:u}=this;if(!a||!e||!t||o==null)return this._set(`featureCount`,0),void this._set(`allCategories`,null);if(t?.type===`subtype-group`&&!i){if(this._set(`featureCount`,0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),s&&l!=null){let{default:e}=await r(async()=>{let{default:e}=await import(`./uniqueValues-CIbOEIIZ.js`);return{default:e}},__vite__mapDeps([48,4,5,32,49,50,31,33,51,30,52,53,54,55,56,57,58,59,60,61,62,63,64,65])),{uniqueValueInfos:i}=await e({layer:t,sqlWhere:`${s} = '${l}'`,field:t.subtypeField,signal:n?.signal}),a=i.map(({count:e,value:n})=>{let r=t.subtypes?.find(e=>e.code===n)?.name;return n!=null&&r?{count:e,value:n,name:r}:void 0}).filter(p);this._set(`allCategories`,a)}return}let{historicMoment:d,gdbVersion:f}=e,m=new ee({cacheHint:u,gdbVersion:f,historicMoment:d,relationshipId:c,returnGeometry:!1,objectIds:[o],where:this._getRelationshipWhereClause(t)}),h=await e.queryRelatedFeaturesCount(m,{signal:n?.signal});this._set(`allCategories`,null),this._set(`featureCount`,h[o]||0)}_getRelationshipWhereClause(e){let{activeCategory:t}=this,n=e.createQuery(),r=`subtypeField`in e?e.subtypeField:void 0,i=t&&r?`${r} = ${t.value}`:void 0,a=n.where;return a&&i?`(${a}) AND (${i})`:a??i}_sliceFeatures(e){let{showAllEnabled:t,displayCount:n}=this;return t?e:n?e.slice(0,n):[]}async _queryPage(){let{relatedFeatures:e,featurePage:t,showAllEnabled:n,_queryPageAbortController:r,featureCount:i}=this;!n||t<2||!i||this.relatedLayer?.type===`subtype-group`&&!this.activeCategory||e.addMany(await this._queryRelatedFeatures({signal:r?.signal}))}async _queryRelatedFeatures(e){let{displayCount:t,featureCount:n,featurePage:r,featuresPerPage:i,layer:a,orderByFieldsFixedCasing:o,relatedLayer:s,relatedLayerKeyFields:c,relationshipId:l,showAllEnabled:u,supportsCacheHint:d}=this,{canQuery:f,objectId:p}=this;if(!f||!a||!s||p==null)return[];let m=u?((r-1)*i+n)%n:0,h=u?i:t,g=s.objectIdField,_=`subtypeField`in s?s.subtypeField:void 0,v=[...o.map(e=>e.field),...dr(s),...c,g,_].filter(pr),y=o.map(e=>`${e.field} ${e.order}`),{historicMoment:te,gdbVersion:ne}=a,re=new ee({orderByFields:y,start:m,num:h,outFields:v,cacheHint:d,historicMoment:te,gdbVersion:ne,relationshipId:l,returnGeometry:!1,objectIds:[p],where:this._getRelationshipWhereClause(s)}),ie=await a.queryRelatedFeatures(re,{signal:e?.signal}),b=ie[p]?.features||[];return s.type===`subtype-group`&&_?b.forEach(e=>{let t=e.attributes[_],n=s.findSublayerForSubtypeCode?.(t);e.sourceLayer=n,e.layer=n}):b.forEach(e=>{e.sourceLayer=s,e.layer=s}),b}};function pr(e){return e!=null&&e!==``}T([a()],K.prototype,`_loaded`,void 0),T([a()],K.prototype,`_queryAbortController`,void 0),T([a()],K.prototype,`_queryPageAbortController`,void 0),T([a()],K.prototype,`_queryFeatureCountAbortController`,void 0),T([a({value:1})],K.prototype,`featurePage`,null),T([a()],K.prototype,`featuresPerPage`,void 0),T([a({readOnly:!0})],K.prototype,`orderByFieldsFixedCasing`,null),T([a({readOnly:!0})],K.prototype,`supportsCacheHint`,null),T([a({readOnly:!0})],K.prototype,`canLoad`,null),T([a({readOnly:!0})],K.prototype,`canQuery`,null),T([a()],K.prototype,`activeCategory`,void 0),T([a({readOnly:!0})],K.prototype,`allCategories`,void 0),T([a({readOnly:!0})],K.prototype,`allCategoriesCount`,null),T([a({readOnly:!0})],K.prototype,`categories`,null),T([a()],K.prototype,`description`,void 0),T([a({value:3})],K.prototype,`displayCount`,null),T([a({type:qe})],K.prototype,`graphic`,void 0),T([a({readOnly:!0})],K.prototype,`itemDescriptionFieldName`,null),T([a()],K.prototype,`layer`,void 0),T([a()],K.prototype,`map`,void 0),T([a({readOnly:!0})],K.prototype,`objectId`,null),T([a({readOnly:!0})],K.prototype,`objectIdField`,null),T([a()],K.prototype,`orderByFields`,void 0),T([a({readOnly:!0})],K.prototype,`relatedFeatures`,null),T([a({readOnly:!0})],K.prototype,`relatedLayer`,null),T([a({readOnly:!0})],K.prototype,`relatedLayerKeyField`,null),T([a({readOnly:!0})],K.prototype,`relatedLayerKeyFields`,null),T([a({readOnly:!0})],K.prototype,`relationship`,null),T([a({readOnly:!0})],K.prototype,`relationshipKey`,null),T([a({readOnly:!0})],K.prototype,`relationshipKeyField`,null),T([a({readOnly:!0})],K.prototype,`featureCount`,void 0),T([a({readOnly:!0})],K.prototype,`relatedFeatureViewModels`,null),T([a()],K.prototype,`relationshipId`,void 0),T([a()],K.prototype,`showAllEnabled`,void 0),T([a()],K.prototype,`state`,null),T([a()],K.prototype,`title`,void 0),K=T([y(`esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel`)],K);var mr,hr=`esri-feature`,gr=`${hr}-relationship`,q={base:gr,listContainer:`${gr}__list`,listItem:`${gr}__list-item`,listItemHidden:`${gr}__list-item--hidden`,listContainerQuerying:`${gr}__list--querying`,featureObserver:`${hr}__feature-observer`,stickySpinnerContainer:`${hr}__sticky-loading-container`,loadingSpinnerContainer:`${hr}__loading-container`},_r={title:!0,description:!0},J=mr=class extends x{constructor(e,t){super(e,t),this._featureElementInfo=null,this._relatedFeatureIntersectionObserverNode=null,this._relatedFeatureIntersectionObserver=new IntersectionObserver(([e])=>{e?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this.flowItems=null,this.flowType=`feature-relationship`,this.headingLevel=2,this.viewModel=new K,this.messages=null,this.messagesCommon=null,this.visibleElements={..._r},this._increaseFeaturePage=()=>{let{state:e,showAllEnabled:t,relatedFeatures:n,featuresPerPage:r,featurePage:i}=this.viewModel;e===`ready`&&t&&n.length>=r*i&&this.viewModel.featurePage++}}initialize(){this._featureElementInfo=new N,this.addHandles([D(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),C),D(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),ne(()=>this.viewModel.relatedFeatureViewModels,`change`,()=>this._setupRelatedFeatureViewModels())])}loadDependencies(){return se({chip:()=>r(()=>import(`./calcite-chip-CxYkw8Dj.js`),__vite__mapDeps([66,4,5,45,67,1,2,68,69,3,6,46,7])),icon:()=>r(()=>import(`./calcite-icon-gYn-WqYd.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),list:()=>r(()=>import(`./calcite-list-CHW8xZ33.js`),__vite__mapDeps([70,4,5,45,71,67,1,72,68,69,73,46,74,75,2,3,6,76,77,7,78,47,79,80])),"list-item":()=>r(()=>import(`./calcite-list-item-CPU34qgI.js`),__vite__mapDeps([81,4,5,45,67,1,82,83,80,72,2,68,69,3,6,84,85,86,46,77,87,74,88,89,90,7,47])),loader:()=>r(()=>import(`./calcite-loader-CQiQFcGp.js`),__vite__mapDeps([44,45,4,5,2,46,47])),notice:()=>r(()=>import(`./calcite-notice-_aiuU757.js`),__vite__mapDeps([91,4,5,45,67,1,2,3,6,84,46,7]))})}destroy(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=Ge(this._featureElementInfo)}get displayShowAllButton(){let{showAllEnabled:e,featureCount:t,displayCount:n,state:r,allCategoriesCount:i}=this.viewModel;return!e&&r===`ready`&&(!!i&&(i>n||n===0)||!!t&&(t>n||n===0))}get displayListItems(){let{relatedFeatureViewModels:e,allCategoriesCount:t}=this.viewModel;return this.displayShowAllButton||!!e.length||!!t}get allItemsDescription(){let{messages:e}=this,{featureCount:t,allCategories:n,allCategoriesCount:r}=this.viewModel;return Ze(e?.numberRecords,{number:de(n?r:t)})}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){let{activeCategory:e,title:t}=this.viewModel;return e?.name??t}set title(e){this.viewModel.title=e}castVisibleElements(e){return{..._r,...e}}render(){let{state:e}=this.viewModel;return g(`div`,{class:this.classes(q.base,E.widget)},this._featureElementInfo?.render(),e===`loading`?this._renderLoading():e===`disabled`?this._renderRelationshipNotFound():this._renderRelatedFeatures())}_selectCategory(e){let{flowItems:t,featureVisibleElements:n,viewModel:r}=this;t&&(r.activeCategory=e,r.showAllEnabled=!0,t.push(new mr({flowItems:t,featureVisibleElements:n,visibleElements:{title:!1,description:!1},viewModel:r})))}async _selectRecord(e){let{flowItems:t,featureVisibleElements:n}=this;if(!t)return;e.abilities={relationshipContent:!0};let{default:i}=await r(async()=>{let{default:e}=await import(`./Feature-B8gfxUoM.js`);return{default:e}},__vite__mapDeps([92,24,4,5,32,49,93,94,95,96,97,31,33,98,38,52,53,54,55,56,64,99,100,101,102]));t.push(new i({flowItems:t,flowType:this.flowType,viewModel:e,visibleElements:n}))}_showAllRecords(){let{flowItems:e}=this;if(!e)return;let{viewModel:t,featureVisibleElements:n}=this;t.showAllEnabled=!0;let r=new mr({flowItems:e,featureVisibleElements:n,visibleElements:{title:!1,description:!1},viewModel:t});e.push(r)}_renderStickyLoading(){return this.viewModel.state===`querying`?g(`div`,{class:q.stickySpinnerContainer,key:`sticky-loader`},this._renderLoadingIcon()):null}_renderLoadingIcon(){return g(`calcite-loader`,{inline:!0,label:``})}_renderLoading(){return g(`div`,{class:q.loadingSpinnerContainer,key:`loading-container`},this._renderLoadingIcon())}_renderShowAllIconNode(){return g(`calcite-icon`,{icon:`list`,scale:`s`,slot:`content-end`})}_renderChevronIconNode(){let e=b(this.container)?`chevron-left`:`chevron-right`;return g(`calcite-icon`,{icon:e,scale:`s`,slot:`content-end`})}_renderCategory(e){let{count:t,name:n,value:r}=e,i=de(t);return g(`calcite-list-item`,{class:q.listItem,disabled:!t,key:r,label:n,onCalciteListItemSelect:()=>this._selectCategory(e)},g(`calcite-chip`,{label:i,scale:`s`,slot:`content-end`},i),this._renderChevronIconNode())}_renderRelatedFeature(e){let{itemDescriptionFieldName:t}=this.viewModel,n=e.title;e.description=t&&e.formattedAttributes?.global[t];let r=e.state===`loading`;return g(`calcite-list-item`,{class:this.classes(q.listItem,{[q.listItemHidden]:r}),description:he(e.description??``),key:e.uid,label:he(n),onCalciteListItemSelect:()=>this._selectRecord(e)},this._renderChevronIconNode())}_renderShowAllListItem(){return this.displayShowAllButton?g(`calcite-list-item`,{description:this.allItemsDescription,key:`show-all-item`,label:this.messages?.showAll,onCalciteListItemSelect:()=>this._showAllRecords()},this._renderShowAllIconNode()):null}_renderNoRelatedFeaturesMessage(){return g(`calcite-notice`,{icon:`information`,key:`no-related-features-message`,kind:`brand`,open:!0,scale:`s`,width:`full`},g(`div`,{slot:`message`},this.messages?.noRelatedFeatures))}_renderFeatureObserver(){return g(`div`,{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:q.featureObserver,key:`feature-observer`})}_renderList(){let{relatedFeatureViewModels:e,categories:t}=this.viewModel;return g(`calcite-list`,{displayMode:`flat`,label:this.messages?.relatedFeaturesList},t?.map(e=>this._renderCategory(e))??e.toArray().map(e=>this._renderRelatedFeature(e)),this._renderShowAllListItem())}_renderRelatedFeatures(){let{displayListItems:e}=this,{state:t}=this.viewModel;return g(`div`,{class:this.classes(q.listContainer,{[q.listContainerQuerying]:t===`querying`}),key:`list-container`},e?this._renderList():t===`ready`?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}_renderRelationshipNotFound(){return g(`calcite-notice`,{icon:`exclamation-mark-triangle`,key:`relationship-not-found`,kind:`danger`,open:!0,scale:`s`,width:`full`},g(`div`,{slot:`message`},this.messages?.relationshipNotFound))}_setupRelatedFeatureViewModels(){let{relatedFeatureViewModels:e}=this.viewModel,t=`related-feature-viewmodels`;this.removeHandles(t),e?.forEach(e=>{this.addHandles(D(()=>[e.title,e.state],()=>this.scheduleRender(),C),t)}),this.scheduleRender()}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,n=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:n,title:r,headingLevel:e})}async _handleRelatedFeatureObserverChange(){this._unobserveRelatedFeatureObserver();let{state:e,showAllEnabled:t}=this.viewModel;await l(0),this._relatedFeatureIntersectionObserverNode&&e===`ready`&&t&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)}_relatedFeatureIntersectionObserverCreated(e){this._relatedFeatureIntersectionObserverNode=e}_unobserveRelatedFeatureObserver(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}};T([a()],J.prototype,`_relatedFeatureIntersectionObserverNode`,void 0),T([a({readOnly:!0})],J.prototype,`displayShowAllButton`,null),T([a({readOnly:!0})],J.prototype,`displayListItems`,null),T([a({readOnly:!0})],J.prototype,`allItemsDescription`,null),T([a()],J.prototype,`description`,null),T([a()],J.prototype,`featureVisibleElements`,void 0),T([a()],J.prototype,`flowItems`,void 0),T([a()],J.prototype,`flowType`,void 0),T([a()],J.prototype,`headingLevel`,void 0),T([a()],J.prototype,`title`,null),T([a({type:K})],J.prototype,`viewModel`,void 0),T([a(),f(`esri/widgets/Feature/t9n/Feature`)],J.prototype,`messages`,void 0),T([a(),f(`esri/t9n/common`)],J.prototype,`messagesCommon`,void 0),T([a()],J.prototype,`visibleElements`,void 0),T([Ae(`visibleElements`)],J.prototype,`castVisibleElements`,null),J=mr=T([y(`esri.widgets.Feature.FeatureRelationship`)],J);var vr=`esri-feature-utility-network-associations`,yr=`${vr}__loading-container`,br={base:vr,listContainer:`${vr}__list`,loadingContainer:yr,loadingContainerSticky:`${yr}--sticky`},Y=class extends x{constructor(e,t){super(e,t),this._featureElementInfo=null,this.onSelectAssociationType=()=>{},this.flowType=`feature-utility-network-associations`,this.flowItems=null,this.parentFeatureViewModel=null,this.headingLevel=5,this.viewModel=new Lt,this.messages=null,this.messagesCommon=null,this.visibleElements=new It}initialize(){this._featureElementInfo=new N,this.addHandles([D(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),C)])}loadDependencies(){return se({icon:()=>r(()=>import(`./calcite-icon-gYn-WqYd.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),list:()=>r(()=>import(`./calcite-list-CHW8xZ33.js`),__vite__mapDeps([70,4,5,45,71,67,1,72,68,69,73,46,74,75,2,3,6,76,77,7,78,47,79,80])),"list-item":()=>r(()=>import(`./calcite-list-item-CPU34qgI.js`),__vite__mapDeps([81,4,5,45,67,1,82,83,80,72,2,68,69,3,6,84,85,86,46,77,87,74,88,89,90,7,47])),loader:()=>r(()=>import(`./calcite-loader-CQiQFcGp.js`),__vite__mapDeps([44,45,4,5,2,46,47])),notice:()=>r(()=>import(`./calcite-notice-_aiuU757.js`),__vite__mapDeps([91,4,5,45,67,1,2,3,6,84,46,7]))})}destroy(){this._featureElementInfo=Ge(this._featureElementInfo)}get description(){return this.viewModel.description}set description(e){this.viewModel.description=e}get title(){return this.viewModel.title}set title(e){this.viewModel.title=e}render(){let{state:e}=this.viewModel;return g(`div`,{class:this.classes(br.base,E.widget)},this._featureElementInfo?.render(),e===`loading`?this._renderLoading():e===`disabled`?this._renderAssociationNotFound():this._renderContent())}_renderStickyLoading(){return this.viewModel.state===`querying`?g(`div`,{class:br.loadingContainerSticky,key:`sticky-loader`},this._renderLoadingIcon()):null}_renderLoadingIcon(){return g(`calcite-loader`,{inline:!0,label:this.messagesCommon.loading})}_renderLoading(){return g(`div`,{class:br.loadingContainer,key:`loading-container`},this._renderLoadingIcon())}_renderAssociationNotFound(){return g(`calcite-notice`,{icon:`information`,key:`association-not-found`,kind:`info`,open:!0,scale:`s`,width:`full`},g(`div`,{slot:`message`},this.messages?.noAssociations))}_renderAssociationType(e){let{viewModel:t}=this,n=this._getAssociationTypeTitle(e);return g(`calcite-list-item`,{description:he(e.description),key:`association-type-${e.type}`,label:he(n),value:e.type,onCalciteListItemSelect:()=>this.onSelectAssociationType({viewModel:t,listType:e,title:n})},g(`calcite-icon`,{flipRtl:!0,icon:`chevron-right`,scale:`s`,slot:`content-end`}))}_renderAssociations(e){let{viewModel:t}=this;return t.source===`featureForm`||t.getFeatureCountForAssociationType(e.type)>0?this._renderAssociationType(e):void 0}_renderContent(){let{messages:e,viewModel:t}=this,{state:n,associationTypes:r}=t;return g(`div`,{class:br.listContainer,key:`list-container`},n===`ready`?g(`div`,null,g(`calcite-list`,{displayMode:`flat`,label:e?.associationsList},r.map(e=>this._renderAssociations(e)))):null,this._renderStickyLoading())}_getAssociationTypeTitle(e){let{messages:t}=this;if(e.title)return e.title;switch(e.type){case`attachment`:return t.associationsAttachments;case`connectivity`:return t.associationsConnectivity;case`structure`:return t.associationsStructure;case`content`:return t.associationsContents;case`container`:return t.associationsContainer}}_setupFeatureElementInfo(){let{headingLevel:e,visibleElements:t}=this,n=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo?.set({description:n,title:r,headingLevel:e})}};T([a({constructOnly:!0})],Y.prototype,`onSelectAssociationType`,void 0),T([a()],Y.prototype,`flowType`,void 0),T([a()],Y.prototype,`flowItems`,void 0),T([a()],Y.prototype,`parentFeatureViewModel`,void 0),T([a()],Y.prototype,`featureVisibleElements`,void 0),T([a()],Y.prototype,`description`,null),T([a()],Y.prototype,`headingLevel`,void 0),T([a()],Y.prototype,`title`,null),T([a({type:Lt})],Y.prototype,`viewModel`,void 0),T([a(),f(`esri/widgets/Feature/t9n/Feature`)],Y.prototype,`messages`,void 0),T([a(),f(`esri/t9n/common`)],Y.prototype,`messagesCommon`,void 0),T([a({type:It,nonNullable:!0})],Y.prototype,`visibleElements`,void 0),Y=T([y(`esri.widgets.Feature.FeatureUtilityNetworkAssociations`)],Y);var xr=class{constructor(e,t){this.preLayerQueryCallback=e,this.preRequestCallback=t,this.preLayerQueryCallback||=e=>{},this.preRequestCallback||(this.preLayerQueryCallback=e=>{})}},Sr,Cr=1,wr=`content-view-models`,Tr=`relationship-view-models`,Er=`association-view-models`,Dr={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0,utilityNetworkAssociationsContent:!0},X=class extends _(S){static{Sr=this}constructor(t){super(t),this._error=null,this._graphicChangedTask=null,this._evaluateExpressionAttributesTask=null,this._associationVMAbortController=null,this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Dr},this.content=null,this.contentViewModels=[],this.description=null,this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.graphic=null,this.lastEditInfo=null,this.location=null,this.relatedInfos=new Map,this.title=``,this.view=null,this._graphicChangedThrottled=ct(this._graphicChanged,()=>this.notifyChange(`waitingForContent`),Cr,this),this._isAllowedContentType=e=>{let{abilities:t}=this;return e.type===`attachments`&&!!t.attachmentsContent||e.type===`custom`&&!!t.customContent||e.type===`fields`&&!!t.fieldsContent||e.type===`media`&&!!t.mediaContent||e.type===`text`&&!!t.textContent||e.type===`expression`&&!!t.expressionContent||e.type===`relationship`&&!!t.relationshipContent||e.type===`utility-network-associations`&&!!t.utilityNetworkAssociationsContent},this._evaluateExpressionAttributesThrottled=ct(this._evaluateExpressionAttributes,()=>this.notifyChange(`waitingForContent`),Cr,this),this.addHandles([D(()=>[this.graphic,this._effectivePopupTemplate,this.abilities,this.timeZone],()=>this._graphicChangedThrottled(),C),e(()=>{if(!this._graphicChangedTask?.finished||this._graphicChangedTask.value==null)return null;let e=this._graphicChangedTask.value,t=e?.expressionInfos?.dependencies;return[e,t?.has(`view-scale`)?this.view?.scale:null,t?.has(`view-time-extent`)?this.view?.timeExtent?.start:null,t?.has(`view-time-extent`)?this.view?.timeExtent?.end:null]},([e])=>this._evaluateExpressionAttributesThrottled(e))])}initialize(){this.addHandles([this._graphicChangedThrottled,this._evaluateExpressionAttributesThrottled])}destroy(){this._clear(),this._graphicChangedTask=w(this._graphicChangedTask),this._evaluateExpressionAttributesTask=w(this._evaluateExpressionAttributesTask),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}static{this.interceptor=new xr(Ot,wt)}get _effectivePopupTemplate(){return this.graphic==null?null:this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)}get _fieldInfoMap(){return ut(Ft(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return lt(this.graphic)}castAbilities(e){return{...Dr,...e}}get isFeatureFromTable(){return this._sourceLayer?.isTable||!1}get state(){return this.graphic?this._error?`error`:this.waitingForContent?`loading`:`ready`:`disabled`}get spatialReference(){return this.view?.spatialReference??null}set spatialReference(e){this._override(`spatialReference`,e)}get timeZone(){return this.view?.timeZone??`system`}set timeZone(e){this._overrideIfSome(`timeZone`,e)}get map(){return this.view?.map||null}set map(e){this._override(`map`,e)}get waitingForContent(){let{_graphicChangedThrottled:e,_evaluateExpressionAttributesThrottled:t,_graphicChangedTask:n,_evaluateExpressionAttributesTask:r,_associationVMAbortController:i}=this;return e.hasPendingUpdates()||t.hasPendingUpdates()||n!=null&&!n.finished||r!=null&&!r.finished||!!i}setActiveMedia(e,t){let n=this.contentViewModels[e];n instanceof B&&n.setActiveMedia(t)}nextMedia(e){let t=this.contentViewModels[e];t instanceof B&&t.next()}previousMedia(e){let t=this.contentViewModels[e];t instanceof B&&t.previous()}async updateGeometry(){let{graphic:e,spatialReference:t,_sourceLayer:n}=this;await n?.load();let r=n?.objectIdField;if(!r||!e||!n)return;let i=e?.attributes?.[r];if(i==null)return;let a=[i];if(!e.geometry){let r=await pt({layer:n,graphic:e,outFields:[],objectIds:a,returnGeometry:!0,spatialReference:t}),i=r?.geometry;i&&(e.geometry=i)}}_clear(){this._set(`title`,``),this._set(`content`,null),this._set(`formattedAttributes`,null)}_graphicChanged(){this._evaluateExpressionAttributesTask=w(this._evaluateExpressionAttributesTask),this._graphicChangedTask=w(this._graphicChangedTask),this._graphicChangedTask=ge(async e=>{this._error=null,this._clear();let{graphic:t}=this;try{if(!t)return null;let{_sourceLayer:n,_effectivePopupTemplate:r}=this,i=this.spatialReference;await bt({graphic:t,popupTemplate:r,layer:n,spatialReference:i},{signal:e});let[{value:a},{value:o}]=await ce([this._getContent(),this._getTitle()]),[,{value:s}]=await ce([this._checkForRelatedFeatures({signal:e}),or(r?.expressionInfos,t)]);return{expressionInfos:s,content:a,title:o}}catch(e){throw Le(e)||(this._error=e,Ue.getLogger(this).error(`error`,`The popupTemplate could not be displayed for this feature.`,{error:e,graphic:t,popupTemplate:this._effectivePopupTemplate})),e}})}_compileContentElement(e,t){return e.type===`attachments`?this._compileAttachments(e,t):e.type===`custom`?this._compileCustom(e,t):e.type===`fields`?this._compileFields(e,t):e.type===`media`?this._compileMedia(e,t):e.type===`text`?this._compileText(e,t):e.type===`expression`?this._compileExpression(e,t):e.type===`relationship`?this._compileRelationship(e,t):e.type===`utility-network-associations`?this._compileUtilityNetworkAssociation(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((e,t)=>this._compileContentElement(e,t)).filter(p):typeof e==`string`?this._compileText(new Ne({text:e}),0).text:e}_destroyContentViewModels(){this.removeHandles(Tr),this.removeHandles(wr),this.contentViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set(`contentViewModels`,[])}_matchesFeature(e,t){let n=e?.graphic?.getObjectId(),r=t?.getObjectId();return n!=null&&r!=null&&n===r}_setRelatedFeaturesViewModels({relatedFeatureViewModels:e,relatedFeatures:t,map:n}){let{view:r,spatialReference:i,timeZone:a}=this;t?.filter(Boolean).forEach(t=>{e.some(e=>this._matchesFeature(e,t))||e.add(new Sr({abilities:{relationshipContent:!1},map:n,view:r,spatialReference:i,timeZone:a,graphic:t}))}),e.forEach(n=>{t?.find(e=>this._matchesFeature(n,e))||e.remove(n)})}_setExpressionContentVM(e,t){let n=this.formattedAttributes,{contentElement:r,contentElementViewModel:i}=e,a=r?.type;i&&a&&(a===`fields`&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:n}),i.set(this._createFieldsVMParams(r,t))),a===`media`&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:n}),i.set(this._createMediaVMParams(r,t))),a===`text`&&i.set(this._createTextVMParams(r)))}_compileRelationship(e,t){let{displayCount:n,orderByFields:r,relationshipId:i,title:a,description:o}=e,{_sourceLayer:s,graphic:c,map:l}=this;if(!Dt(s))return;let u=new K({displayCount:n,graphic:c,orderByFields:r,relationshipId:i,layer:s,map:l,...this._compileTitleAndDesc({title:a,description:o})});return this.contentViewModels[t]=u,this.addHandles(ne(()=>u.relatedFeatures,`change`,()=>this._setRelatedFeaturesViewModels(u)),Tr),e}_matchesGlobalFeature(e,t){return e.association.equals(t.association)}_setUpUtilityNetworkAssociationsViewModels(e,t,n){let{view:r,spatialReference:i,timeZone:a}=this;e.forEach((n,r)=>{let i=t.get(r);i?n.forEach(t=>{i.find(e=>this._matchesGlobalFeature(t,e))||(n.remove(t),n.length===0&&e.delete(r))}):(n.removeAll(),e.delete(r))}),t.forEach((t,o)=>{let s=e.get(o)||new De;t?.filter(Boolean).forEach((e,t)=>{if(!s.some(t=>this._matchesGlobalFeature(t,e))){let{association:o,feature:c,terminalName:l,title:u}=e;s.add({title:u,association:o,featureViewModel:new Sr({abilities:{utilityNetworkAssociationsContent:!1},map:n,view:r,spatialReference:i,timeZone:a,graphic:c}),terminalName:l},t)}}),e.set(o,s)})}_compileUtilityNetworkAssociation(e,t){let{displayCount:n,title:r,description:i,associationTypes:a}=e,{_sourceLayer:o,graphic:s,map:c}=this;if(!Mt(o))return;let l=new Lt({graphic:s,displayCount:n,associationTypes:a,layer:o,map:c,...this._compileTitleAndDesc({title:r,description:i})});return this.contentViewModels[t]=l,this.addHandles([D(()=>l.associationFeatures.values(),()=>this._setUpUtilityNetworkAssociationsViewModels(l.associationViewModels,l.associationFeatures,l.map))],Er),e}_compileExpression(e,t){let{expressionInfo:n}=e,{graphic:r,map:i,spatialReference:a,view:o,location:s}=this,c=new G({expressionInfo:n,graphic:r,interceptor:Sr.interceptor,map:i,spatialReference:a,view:o,location:s});return this.contentViewModels[t]=c,this.addHandles(D(()=>c.contentElementViewModel,()=>this._setExpressionContentVM(c,t),C),wr),e}_compileAttachments(e,t){let{graphic:n}=this,{description:r,title:i,orderByFields:a,attachmentKeywords:o,attachmentTypes:s}=e;return this.contentViewModels[t]=new M({attachmentKeywords:o,attachmentTypes:s,graphic:n,orderByFields:a,...this._compileTitleAndDesc({title:i,description:r})}),e}_compileCustom(e,t){let{graphic:n}=this,{creator:r,destroyer:i}=e;return this.contentViewModels[t]=new F({graphic:n,creator:r,destroyer:i}),e}_compileTitleAndDesc({title:e,description:t}){let{_fieldInfoMap:n,_sourceLayer:r,graphic:i,formattedAttributes:a}=this,o=i?.attributes,s=this._expressionAttributes,c=a.global;return{title:vt({attributes:o,fieldInfoMap:n,globalAttributes:c,expressionAttributes:s,layer:r,text:e}),description:vt({attributes:o,fieldInfoMap:n,globalAttributes:c,expressionAttributes:s,layer:r,text:t})}}_createFieldsVMParams(e,t){let n=this._effectivePopupTemplate,r=this.formattedAttributes,i={...r?.global,...r?.content[t]},a=!!e?.fieldInfos,o=e?.fieldInfos||n?.fieldInfos,s=o?.filter(({fieldName:e})=>!!e&&(jt(e)||_t(e)||i.hasOwnProperty(e))),c=n?.expressionInfos,{description:l,title:u}=e;return{attributes:i,expressionInfos:c,fieldInfos:s,isContentFieldInfos:a,graphic:this.graphic,layer:this._sourceLayer,...this._compileTitleAndDesc({title:u,description:l})}}_compileFields(e,t){let n=e.clone(),r=new L(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,n.fieldInfos=r.formattedFieldInfos.slice(),n}_createMediaVMParams(e,t){let{abilities:n,graphic:r,_fieldInfoMap:i,_effectivePopupTemplate:a,relatedInfos:o,_sourceLayer:s,_expressionAttributes:c}=this,l=this.formattedAttributes,u=r?.attributes??{},{description:d,mediaInfos:f,title:p}=e;return{abilities:{chartAnimation:n.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:u,graphic:r,layer:s,fieldInfoMap:i,formattedAttributes:{...l?.global,...l?.content[t]},expressionAttributes:c,mediaInfos:f,popupTemplate:a,relatedInfos:o,...this._compileTitleAndDesc({title:p,description:d})}}_compileMedia(e,t){let n=e.clone(),r=new B(this._createMediaVMParams(e,t));return n.mediaInfos=r.formattedMediaInfos.slice(),this.contentViewModels[t]=r,n}_createTextVMParams(e){let{graphic:t,_fieldInfoMap:n,_sourceLayer:r,_expressionAttributes:i}=this;if(e&&e.text){let a=t?.attributes??{},o=this.formattedAttributes?.global??{};e.text=vt({attributes:a,fieldInfoMap:n,globalAttributes:o,expressionAttributes:i,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){let n=e.clone();return this.contentViewModels[t]=new F(this._createTextVMParams(n)),n}_compileLastEditInfo(){let{_effectivePopupTemplate:e,_sourceLayer:t,graphic:n,timeZone:r}=this;if(!e)return;let{lastEditInfoEnabled:i}=e,a=t?.editFieldsInfo;return i&&a?ft(a,n?.attributes,r,t):void 0}_compileTitle(e){let{_fieldInfoMap:t,_sourceLayer:n,graphic:r,_expressionAttributes:i}=this,a=r?.attributes??{},o=this.formattedAttributes?.global??{};return vt({attributes:a,fieldInfoMap:t,globalAttributes:o,expressionAttributes:i,layer:n,text:e})}async _getTitle(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?mt({type:`title`,value:e?.title,event:{graphic:t}}):null}async _getContent(){let{_effectivePopupTemplate:e,graphic:t}=this;return t?mt({type:`content`,value:e?.content,event:{graphic:t}}):null}_evaluateExpressionAttributes({title:e,content:t,expressionInfos:n}){this._evaluateExpressionAttributesTask=w(this._evaluateExpressionAttributesTask),this._evaluateExpressionAttributesTask=ge(async r=>{let{graphic:i,map:a,view:o,spatialReference:s,location:c}=this;try{if(!i)return;let l;if(n!=null){let e=[];for(let[t,l]of n.expressions.entries())l==null?e.push(Promise.resolve([t,void 0])):e.push(l.evaluate({graphic:i,interceptor:Sr.interceptor,location:c,map:a,options:{signal:r},spatialReference:s,view:o}).then(e=>[t,typeof e==`string`?Wn(e):e]).catch(()=>[t,void 0]));l=Object.fromEntries(await Promise.all(e)),ye(r)}this._expressionAttributes=l,this._graphicExpressionAttributes={...i.attributes,...l},this._set(`formattedAttributes`,this._createFormattedAttributes(t)),this._set(`title`,this._compileTitle(e)),this._set(`lastEditInfo`,this._compileLastEditInfo()||null),this._set(`content`,this._compileContent(t)||null)}catch(e){Le(e)||(this._error=e,Ue.getLogger(this).error(`error`,`The popupTemplate could not be displayed for this feature.`,{error:e,graphic:i,popupTemplate:this._effectivePopupTemplate}))}})}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:n}){let{_effectivePopupTemplate:r,graphic:i,relatedInfos:a,_sourceLayer:o,_fieldInfoMap:s,_graphicExpressionAttributes:c,timeZone:l}=this;n.content[t]=xt({attributes:{...c,...e.attributes},fieldInfoMap:s,fieldInfos:r?.fieldInfos,graphic:i,layer:o,relatedInfos:a,timeZone:l})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:n}){if(e.fieldInfos){let{graphic:r,relatedInfos:i,_sourceLayer:a,_fieldInfoMap:o,_graphicExpressionAttributes:s,timeZone:c}=this;n.content[t]=xt({attributes:{...s,...e.attributes},fieldInfoMap:o,fieldInfos:e.fieldInfos,graphic:r,isContentFieldInfos:!0,layer:a,relatedInfos:i,timeZone:c})}}_createFormattedAttributes(e){let{_effectivePopupTemplate:t,graphic:n,relatedInfos:r,_sourceLayer:i,_fieldInfoMap:a,_graphicExpressionAttributes:o,timeZone:s}=this,c=t?.fieldInfos,l={global:xt({attributes:o,fieldInfoMap:a,fieldInfos:c,graphic:n,layer:i,relatedInfos:r,timeZone:s}),content:[]};return Array.isArray(e)&&e.forEach((e,t)=>{e.type===`fields`&&this._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:l}),e.type===`media`&&this._createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){let{graphic:t,_effectivePopupTemplate:n}=this;return this._queryRelatedInfos(t,Ft(n),e)}async _queryRelatedInfos(e,t,n){let{relatedInfos:r,_sourceLayer:i}=this;r.clear();let a=i?.associatedLayer==null?i:await i?.associatedLayer.load(n);if(!a||!e||!t.filter(e=>!!e.fieldName&&_t(e.fieldName))?.length)return;t.forEach(e=>this._configureRelatedInfo(e,a));let o=await jn({relatedInfos:r,layer:a},n);Object.keys(o).forEach(e=>{let t=r.get(e.toString()),n=o[e]?.value;t&&n&&(t.layerInfo=n.data)});let s=await Mn({graphic:e,relatedInfos:r,layer:a},n);Object.keys(s).forEach(e=>{wn(s[e]?.value,r.get(e.toString()))})}_configureRelatedInfo(e,t){let{relatedInfos:n}=this,r=yn(e.fieldName||``);if(!r)return;let{layerId:i,fieldName:a}=r;if(!i)return;let o=n.get(i.toString())||Cn(i,t);o&&(Nn({relatedInfo:o,fieldName:a,fieldInfo:e}),this.relatedInfos.set(i,o))}};T([a()],X.prototype,`_error`,void 0),T([a()],X.prototype,`_graphicChangedTask`,void 0),T([a()],X.prototype,`_evaluateExpressionAttributesTask`,void 0),T([a()],X.prototype,`_associationVMAbortController`,void 0),T([a({readOnly:!0})],X.prototype,`_effectivePopupTemplate`,null),T([a({readOnly:!0})],X.prototype,`_fieldInfoMap`,null),T([a({readOnly:!0})],X.prototype,`_sourceLayer`,null),T([a()],X.prototype,`abilities`,void 0),T([Ae(`abilities`)],X.prototype,`castAbilities`,null),T([a({readOnly:!0})],X.prototype,`content`,void 0),T([a({readOnly:!0})],X.prototype,`contentViewModels`,void 0),T([a()],X.prototype,`description`,void 0),T([a({type:Boolean})],X.prototype,`defaultPopupTemplateEnabled`,void 0),T([a({readOnly:!0})],X.prototype,`isFeatureFromTable`,null),T([a({readOnly:!0})],X.prototype,`state`,null),T([a({readOnly:!0})],X.prototype,`formattedAttributes`,void 0),T([a({type:qe})],X.prototype,`graphic`,void 0),T([a({readOnly:!0})],X.prototype,`lastEditInfo`,void 0),T([a({type:Ie})],X.prototype,`location`,void 0),T([a({readOnly:!0})],X.prototype,`relatedInfos`,void 0),T([a({type:Xe})],X.prototype,`spatialReference`,null),T([a()],X.prototype,`timeZone`,null),T([a({readOnly:!0})],X.prototype,`title`,void 0),T([a()],X.prototype,`map`,null),T([a({readOnly:!0})],X.prototype,`waitingForContent`,null),T([a()],X.prototype,`view`,void 0),X=Sr=T([y(`esri.widgets.Feature.FeatureViewModel`)],X);var Z=`esri-feature`,Q={base:Z,container:`${Z}__size-container`,title:`${Z}__title`,main:`${Z}__main-container`,btn:`${Z}__button`,icon:`${Z}__icon`,content:`${Z}__content`,contentNode:`${Z}__content-node`,contentNodeText:`${Z}__content-node--text`,contentElement:`${Z}__content-element`,text:`${Z}__text`,lastEditedInfo:`${Z}__last-edited-info`,fields:`${Z}__fields`,fieldHeader:`${Z}__field-header`,fieldData:`${Z}__field-data`,fieldDataDate:`${Z}__field-data--date`,loadingSpinnerContainer:`${Z}__loading-container`},Or=e=>{let t=e,n=class extends t{constructor(){super(...arguments),this.renderNodeContent=e=>v(e)&&!e.destroyed?g(`div`,{class:Q.contentNode,key:e},e.render()):e instanceof HTMLElement?g(`div`,{afterCreate:this._attachToNode,bind:e,class:Q.contentNode,key:e}):Oe(e)?g(`div`,{afterCreate:this._attachToNode,bind:e.domNode,class:Q.contentNode,key:e}):null}_attachToNode(e){let t=this;e.appendChild(t)}};return n=T([y(`esri.widgets.Feature.support.FeatureContentMixin`)],n),n},kr={title:!0,content:!0,lastEditedInfo:!0},$=class extends Or(x){constructor(e,t){super(e,t),this._contentWidgets=[],this.flowType=`feature`,this.flowItems=null,this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.visibleElements={...kr},this.viewModel=new X}initialize(){this.addHandles(D(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),C))}loadDependencies(){return se({notice:()=>r(()=>import(`./calcite-notice-_aiuU757.js`),__vite__mapDeps([91,4,5,45,67,1,2,3,6,84,46,7])),loader:()=>r(()=>import(`./calcite-loader-CQiQFcGp.js`),__vite__mapDeps([44,45,4,5,2,46,47]))})}destroy(){this._destroyContentWidgets()}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get defaultPopupTemplateEnabled(){return this.viewModel.defaultPopupTemplateEnabled}set defaultPopupTemplateEnabled(e){this.viewModel.defaultPopupTemplateEnabled=e}get isTable(){return this.viewModel.isFeatureFromTable}get icon(){return`polygon`}set icon(e){this._overrideIfSome(`icon`,e)}get label(){return this.messages?.widgetLabel??``}set label(e){this._overrideIfSome(`label`,e)}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get title(){return this.viewModel.title}castVisibleElements(e){return{...kr,...e}}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}setActiveMedia(e,t){return this.viewModel.setActiveMedia(e,t)}nextMedia(e){return this.viewModel.nextMedia(e)}previousMedia(e){return this.viewModel.previousMedia(e)}render(){let{state:e}=this.viewModel,t=g(`div`,{class:Q.container,key:`container`},this._renderTitle(),e===`error`?this._renderError():e===`loading`?this._renderLoading():this._renderContentContainer());return g(`div`,{class:this.classes(Q.base,E.widget)},t)}_renderError(){let{messagesCommon:e,messages:t,visibleElements:n}=this;return g(`calcite-notice`,{icon:`exclamation-mark-circle`,kind:`danger`,open:!0,scale:`s`},n.title?g(`div`,{key:`error-title`,slot:`title`},e.errorMessage):null,g(`div`,{key:`error-message`,slot:`message`},t.loadingError))}_renderLoading(){return g(`div`,{class:Q.loadingSpinnerContainer,key:`loading-container`},g(`calcite-loader`,{inline:!0,label:``}))}_renderContentContainer(){let{visibleElements:e}=this;return e.content?g(`div`,{class:Q.main},[this._renderContent(),this._renderLastEditInfo()]):null}_renderTitle(){let{visibleElements:e,title:t}=this;return e.title?g(Gt,{class:Q.title,innerHTML:t,level:this.headingLevel}):null}_renderContent(){let e=this.viewModel.content,t=`content`;if(!e)return null;if(Array.isArray(e))return e.length?g(`div`,{class:Q.contentNode,key:`${t}-content-elements`},e.map(this._renderContentElement,this)):null;if(typeof e==`string`){let e=this._contentWidgets[0];return!e||e.destroyed?null:g(`div`,{class:this.classes(Q.contentNode,Q.contentNodeText),key:`${t}-content`},e.render())}return this.renderNodeContent(e)}_renderContentElement(e,t){let{visibleElements:n}=this;if(typeof n.content!=`boolean`&&!n.content?.[e.type])return null;switch(e.type){case`attachments`:return this._renderAttachments(t);case`custom`:return this._renderCustom(e,t);case`fields`:return this._renderFields(t);case`media`:return this._renderMedia(t);case`text`:return this._renderText(e,t);case`expression`:return this._renderExpression(t);case`relationship`:return this._renderRelationship(t);case`utility-network-associations`:return this._renderAssociation(t);default:return null}}_renderAttachments(e){let t=this._contentWidgets[e];if(!t||t.destroyed)return null;let{state:n,attachmentInfos:r}=t.viewModel;return n===`loading`||r.length>0?g(`div`,{class:this.classes(Q.contentElement),key:this._buildKey(`attachments-element`,e)},t.render()):null}_renderRelationship(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?g(`div`,{class:Q.contentElement,key:this._buildKey(`relationship-element`,e)},t.render()):null}_renderAssociation(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?g(`div`,{class:Q.contentElement,key:this._buildKey(`utility-network-association-element`,e)},t.render()):null}_renderExpression(e){let t=this._contentWidgets[e];return t&&!t.destroyed&&t.viewModel.contentElement?g(`div`,{class:Q.contentElement,key:this._buildKey(`expression-element`,e)},t.render()):null}_renderCustom(e,t){let{creator:n}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:n?g(`div`,{class:Q.contentElement,key:this._buildKey(`custom-element`,t)},r.render()):null}_renderFields(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:g(`div`,{class:Q.contentElement,key:this._buildKey(`fields-element`,e)},t.render())}_renderMedia(e){let t=this._contentWidgets[e];return!t||t.destroyed?null:g(`div`,{class:Q.contentElement,key:this._buildKey(`media-element`,e)},t.render())}_renderLastEditInfo(){let{visibleElements:e,messages:t}=this,{lastEditInfo:n}=this.viewModel;if(!n||!e.lastEditedInfo)return null;let{date:r,user:i}=n,a=n.type===`edit`?i?t.lastEditedByUser:t.lastEdited:i?t.lastCreatedByUser:t.lastCreated,o=Ze(a,{date:r,user:i});return g(`div`,{class:this.classes(Q.lastEditedInfo,Q.contentElement),key:`edit-info-element`},o)}_renderText(e,t){let n=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:n?g(`div`,{class:this.classes(Q.contentElement,Q.text),key:this._buildKey(`text-element`,t)},r.render()):null}_buildKey(e,...t){return`${e}__${this.viewModel?.graphic?.uid||`0`}-${t.join(`-`)}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();let{headingLevel:e,visibleElements:t,flowItems:n,viewModel:i}=this,a=i?.content,{contentViewModels:o}=i;if(Array.isArray(a))a.forEach((a,s)=>{if(a.type===`attachments`&&(this._contentWidgets[s]=new P({displayType:a.displayType,headingLevel:t.title&&e<6?e+1:e,viewModel:o[s]})),a.type===`fields`&&(this._contentWidgets[s]=new R({viewModel:o[s]})),a.type===`media`&&(this._contentWidgets[s]=new W({viewModel:o[s]})),a.type===`text`&&(this._contentWidgets[s]=new I({viewModel:o[s]})),a.type===`custom`&&(this._contentWidgets[s]=new I({viewModel:o[s]})),a.type===`expression`&&(this._contentWidgets[s]=new ur({viewModel:o[s]})),a.type===`relationship`){let e=new J({flowItems:n,featureVisibleElements:t,viewModel:o[s]});this._contentWidgets[s]=e}if(a.type===`utility-network-associations`){let e=async e=>{let{viewModel:a,listType:o,title:s}=e;if(!n)return;a.activeAssociationType=o;let{default:c}=await r(async()=>{let{default:e}=await import(`./FeatureUtilityNetworkAssociationList-ivyBgDGW.js`);return{default:e}},__vite__mapDeps([103,4,5,64,101,102])),l=new c({viewModel:a,parentFeatureViewModel:i,listType:o,title:s,featureVisibleElements:t,description:i.title,flowItems:n});n.push(l)},a=new Y({flowItems:n,onSelectAssociationType:e,parentFeatureViewModel:i,featureVisibleElements:t,viewModel:o[s]});this._contentWidgets[s]=a}},this);else{let e=o[0];e&&!e.destroyed&&(this._contentWidgets[0]=new I({viewModel:e}))}this.scheduleRender()}};T([a()],$.prototype,`flowType`,void 0),T([a({type:qe})],$.prototype,`graphic`,null),T([a()],$.prototype,`defaultPopupTemplateEnabled`,null),T([a()],$.prototype,`flowItems`,void 0),T([a()],$.prototype,`headingLevel`,void 0),T([a({readOnly:!0})],$.prototype,`isTable`,null),T([a()],$.prototype,`icon`,null),T([a()],$.prototype,`label`,null),T([a({type:Ie})],$.prototype,`location`,null),T([a(),f(`esri/widgets/Feature/t9n/Feature`)],$.prototype,`messages`,void 0),T([a(),f(`esri/t9n/common`)],$.prototype,`messagesCommon`,void 0),T([a()],$.prototype,`spatialReference`,null),T([a()],$.prototype,`timeZone`,null),T([a({readOnly:!0})],$.prototype,`title`,null),T([a()],$.prototype,`visibleElements`,void 0),T([Ae(`visibleElements`)],$.prototype,`castVisibleElements`,null),T([a()],$.prototype,`map`,null),T([a()],$.prototype,`view`,null),T([a({type:X})],$.prototype,`viewModel`,void 0),$=T([y(`esri.widgets.Feature`)],$);export{Gt as a,X as i,Or as n,Ht as o,Q as r,$ as t};