import{$x as e,Gf as t,Kf as n,Qv as r,Rl as i,Tw as a,Uf as o,sS as s}from"./index-BN8X5Ryz.js";import{t as c}from"./earcut-CEMcWA4Z.js";import{o as l}from"./Indices-tJiSUK6w.js";import{b as u,f as d,y as f}from"./plane-Da5EsY0J.js";import{t as p}from"./deduplicate-D-tDe87s.js";function m(e,t,n){let r=h(g,e,t,n)?u(g):[0,0,1];return Math.abs(r[2])>Math.cos(a(80))?2:Math.abs(r[1])>Math.abs(r[0])?1:0}function h(t,n,r,a){let o=(e=>!Array.isArray(e[0]))(n)?(e,t)=>n[3*e+t]:(e,t)=>n[e][t],c=a?e(a)/s(a):1;return d(t,(e,t)=>i(e,o(t,0)*c,o(t,1)*c,o(t,2)),r)}var g=f();function _(e){let r=y(e.rings,e.hasZ,1,e.spatialReference),i=[],a=0,o=0;for(let e of r.polygons){let n=e.count,s=e.index,u=t(r.position,3*s,3*n),d=e.holeIndices.map(e=>e-s),f=l(c(u,d,3));i.push({position:u,faces:f}),a+=u.length,o+=f.length}let s=v(i,a,o),u=Array.isArray(s.position)?p(s.position,3,{originalIndices:s.faces}):p(s.position.buffer,6,{originalIndices:s.faces});return s.position=n(new Float64Array(u.buffer)),s.faces=u.indices,s}function v(e,t,n){if(e.length===1)return e[0];let r=o(t),i=Array(n),a=0,s=0,c=0;for(let t of e){for(let e=0;e<t.position.length;e++)r[a++]=t.position[e];for(let e of t.faces)i[s++]=e+c;c=a/3}return{position:r,faces:l(i)}}function y(e,t,n,r){let i=e.length,a=Array(i),s=Array(i),c=Array(i),l=e.reduce((e,t)=>e+t.length,0),u=0,d=0,f=0,p=o(3*l),m=0;for(let o=i-1;o>=0;o--){let l=e[o],h=n===1&&x(l,t,r);if(h&&i!==1)a[u++]=l;else{let e=l.length;for(let t=0;t<u;++t)e+=a[t].length;let n={index:m,pathLengths:Array(u+1),count:e,holeIndices:Array(u)};n.pathLengths[0]=l.length,l.length>0&&(c[f++]={index:m,count:l.length}),m=h?b(l,l.length-1,-1,p,m,l.length,t):b(l,0,1,p,m,l.length,t);for(let e=0;e<u;++e){let r=a[e];n.holeIndices[e]=m,n.pathLengths[e+1]=r.length,r.length>0&&(c[f++]={index:m,count:r.length}),m=b(r,0,1,p,m,r.length,t)}u=0,n.count>0&&(s[d++]=n)}}for(let e=0;e<u;++e){let n=a[e];n.length>0&&(c[f++]={index:m,count:n.length}),m=b(n,0,1,p,m,n.length,t)}return s.length=d,c.length=f,{position:p,polygons:s,outlines:c}}function b(e,t,n,r,i,a,o){i*=3;for(let s=0;s<a;++s){let a=e[t];r[i++]=a[0],r[i++]=a[1],r[i++]=o&&a[2]?a[2]:0,t+=n}return i/3}function x(e,t,n){if(!t)return!r(e);let i=e.length-1;switch(m(e,i,n)){case 0:return!r(e,1,2);case 1:return!r(e,0,2);case 2:return!r(e,0,1)}}export{y as n,m as r,_ as t};