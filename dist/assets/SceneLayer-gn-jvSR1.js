const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingSupport-DIqS6Asw.js","assets/editingSupport-DiW8cYcp.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/Mesh-B9frnmGL.js","assets/earcut-CEMcWA4Z.js","assets/vec3-B5yu4INg.js","assets/vec4-BLZ_ZPtE.js","assets/vectorStacks-Cuo89CNO.js","assets/quatf64-D37SEdPg.js","assets/quat-C8PgLo31.js","assets/Mesh-CfQb5rZ2.js","assets/computeTranslationToOriginAndRotation-0WDVmpJG.js","assets/projectPointToVector-BkRdoTqD.js","assets/spatialReferenceEllipsoidUtils-qw9wv8RL.js","assets/MeshComponent-BFk18JiH.js","assets/MeshMaterialMetallicRoughness-Bdr2gXmV.js","assets/meshCloneUtils-BXMzy817.js","assets/meshProperties-CbjLwdbT.js","assets/MeshLocalVertexSpace-vomIk0sx.js","assets/MeshTransform-BaPjlQwH.js","assets/axisAngleDegrees-DzAS4tF-.js","assets/MeshVertexAttributes-CBsb_nVo.js","assets/External-C55iwtd6.js","assets/vertexSpaceConversion-Dz87RqR7.js","assets/BufferView-BW77W5ev.js","assets/Util-BQgFCZvD.js","assets/meshVertexSpaceUtils-s2jLb8qI.js","assets/triangulationUtils-DNxIB1ux.js","assets/Indices-tJiSUK6w.js","assets/deduplicate-D-tDe87s.js","assets/plane-Da5EsY0J.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,A as n,Ai as r,B as i,BT as a,C as o,CE as s,Cr as c,D as l,Di as u,En as d,Ex as f,FC as p,FE as m,L as h,Lg as g,Ln as _,M as v,Mi as y,Ni as b,Od as ee,Pa as te,Pn as ne,Qp as x,Rh as S,S as C,Ua as re,VT as w,W as ie,WT as T,Yn as E,ZS as D,Zn as ae,_ as oe,aC as O,ba as se,ca as ce,cp as le,cv as ue,dT as de,dh as fe,fC as pe,fv as me,hv as k,iE as he,ip as ge,iw as A,jT as _e,ji as j,jp as M,k as N,kD as P,kw as F,lv as I,ma as ve,nh as L,oT as ye,pT as R,pa as be,pd as xe,pr as Se,qi as Ce,rh as we,rr as Te,sT as Ee,sp as De,tE as z,v as Oe,wi as ke,wp as B,xa as Ae,xr as je,zh as V}from"./index-BN8X5Ryz.js";import"./quatf64-D37SEdPg.js";import"./quat-C8PgLo31.js";import"./axisAngleDegrees-DzAS4tF-.js";import"./MeshTransform-BaPjlQwH.js";import"./plane-Da5EsY0J.js";import"./vectorStacks-Cuo89CNO.js";import"./projectPointToVector-BkRdoTqD.js";import"./computeTranslationToOriginAndRotation-0WDVmpJG.js";import"./spatialReferenceEllipsoidUtils-qw9wv8RL.js";import{n as Me}from"./capabilities-5-b9b9so.js";import{n as Ne}from"./SceneService-CV9CcpT-.js";import{i as Pe,n as Fe,r as H,t as Ie}from"./I3SLayerDefinitions-DCkrs9K5.js";import"./dehydratedPoint-CWZQBefp.js";import"./projectVectorToVector-DGzn2p7I.js";import"./featurePopupQueryUtils-BtodurzF.js";import"./I3SBinaryReader-CPmcprrx.js";import{t as Le}from"./I3SUtil-BFPXufgH.js";import"./symbolColorUtils-KqO0oQTm.js";import"./orientedBoundingBox-Bd4igSGQ.js";import"./Emissions.glsl-C_Yvv-sZ.js";import"./glsl-BMw-Ib6r.js";import"./Uniform-C_fuiTP5.js";import"./Float3DrawUniform-ua6q6ZtZ.js";import"./Float3PassUniform-SaBA6LBM.js";import"./FloatPassUniform-CSAt82xV.js";import"./Texture2DDrawUniform-jqrXjxoW.js";import"./Texture2DPassUniform-DFWoDpEL.js";import"./NoParameters-BDE7RvXT.js";import"./layerViewUtils-CJcMVuwG.js";import{n as Re,t as ze}from"./popupUtils-z3ynpNjO.js";import"./originUtils-CJnuu7mB.js";import"./resourceUtils-Bt8ctqoA.js";import"./resourceUtils-t_8WR2aj.js";import"./saveUtils-CEfw3trS.js";import{t as Be}from"./associatedFeatureServiceUtils-g0mrYesf.js";import"./memoize-Dl61_jt0.js";import{o as Ve,p as U,t as He}from"./elevationInfoUtils-uoMH3ofe.js";import{t as Ue}from"./lazyLayerLoader-CkIeKrgl.js";import{a as We,s as Ge,t as Ke}from"./meshSpatialReferenceScaleUtils-wsPB6tEL.js";var qe=Symbol(`isSceneGraphicOrigin`),W,Je=class extends se{get[(W=qe,ge)](){return this.layer}get[De](){return this.layer}get[Ae](){return this.layer}constructor(e){super(),this[W]=!0,this.type=`scene`,this.layer=e}get id(){return this.layer.id}};function G({associatedLayer:e,serviceUpdateTimeStamp:t}){let n=e?.editingInfo?.lastEditDate,r=e?.serverGens,i=n!=null,a=t!=null,o=i&&a&&t.lastUpdate!==n.getTime();return i&&(o||!a&&r?.minServerGen!==r?.serverGen)}var Ye=e=>{let t=e,n=class extends t{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){let e=this.associatedLayer?.timeInfo;if(e==null)return null;let t=e.clone();return B(t,this.fieldsIndex),t}set timeInfo(e){B(e,this.fieldsIndex),this._override(`timeInfo`,e)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(e){this._override(`timeExtent`,e)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(e){this._override(`timeOffset`,e)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(e){this._override(`datesInUnknownTimezone`,e)}async loadTimeInfoFromService(e){let{serviceTimeInfo:t}=this;if(t==null)return;let{startTimeField:n,endTimeField:r}=t;if(n==null&&r==null||G({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp}))return;let i=async t=>{let r=null;try{r=(await this.fetchStatistics?.(t,e))?.stats}catch{}if(r==null)return null;let{minTimeStr:i,min:a,maxTimeStr:o,max:s}=r,c=t===n?i??a:o??s;return c==null?null:new Date(c)},[a,o]=await Promise.all([i(n),i(r)]);if(n!=null&&a==null||r!=null&&o==null)return;let s=new V({start:a,end:o});this.setAtOrigin(`timeInfo`,new N({endField:r,startField:n,fullTimeExtent:s}),`service`)}};return P([a({type:N,json:{read:!1,write:!1}})],n.prototype,`timeInfo`,null),P([a({type:V,json:{read:!1,write:!1}})],n.prototype,`timeExtent`,null),P([a({type:te,json:{read:!1,write:!1}})],n.prototype,`timeOffset`,null),P([a({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],n.prototype,`datesInUnknownTimezone`,null),P([a({type:K,readOnly:!0,json:{read:{source:`timeInfo`}},clonable:!1})],n.prototype,`serviceTimeInfo`,void 0),n=P([w(`esri.layers.mixins.TemporalSceneLayer`)],n),n},K=class extends A{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};P([a({type:String})],K.prototype,`endTimeField`,void 0),P([a({type:String})],K.prototype,`startTimeField`,void 0),K=P([w(`esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo`)],K);var q=class extends A{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type=`rangeInfo`}};P([a({type:String,json:{read:!0,write:{isRequired:!0}}})],q.prototype,`name`,void 0),P([a({type:String,json:{read:!0,write:{isRequired:!0}}})],q.prototype,`field`,void 0),P([a({type:[Number],json:{read:!0,write:!0}})],q.prototype,`currentRangeExtent`,void 0),P([a({type:[Number],json:{read:!0,write:!0}})],q.prototype,`fullRangeExtent`,void 0),P([a({type:[`rangeInfo`],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],q.prototype,`type`,void 0),q=P([w(`esri.layers.support.RangeInfo`)],q);var J,Y=J=class extends A{constructor(e){super(e),this.spatialRelationship=`disjoint`,this.geometries=new L,this._geometriesSource=null}initialize(){this.addHandles(I(()=>this.geometries,`after-changes`,()=>this.geometries=this.geometries,ue))}readGeometries(e,t,n){Array.isArray(e)?this.geometries=L.fromJSON(e,n):n.origin!==`web-scene`&&n.origin!==`portal-item`||(this._geometriesSource={url:pe(e,n),context:n})}async loadGeometries(e,t){if(this._geometriesSource==null)return;let{url:n,context:r}=this._geometriesSource,i=await D(n,{responseType:`json`,signal:t?.signal}),a=e.toJSON(),o=i.data.map(e=>({...e,spatialReference:a}));this.geometries=L.fromJSON(o,r),this._geometriesSource=null}clone(){let e=new J({geometries:m(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};P([a({type:[`disjoint`,`contains`],nonNullable:!0,json:{write:{isRequired:!0}}})],Y.prototype,`spatialRelationship`,void 0),P([a({type:L,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),we({origins:[`web-scene`,`portal-item`],type:`resource`,prefix:`geometries`,contentAddressed:!0})],Y.prototype,`geometries`,void 0),P([T([`web-scene`,`portal-item`,`service`],`geometries`)],Y.prototype,`readGeometries`,null),Y=J=P([w(`esri.layers.support.SceneFilter`)],Y);var Xe=Y;async function Ze({fieldName:e,statisticsInfo:n,errorContext:r,fieldsIndex:i,path:a,customParameters:o,apiKey:s,signal:c}){if(n==null)throw new t(`${r}:no-cached-statistics`,`Cached statistics are not available for this layer`);let l=i.get(e);if(l==null)throw new t(`${r}:field-unexisting`,`Field '${e}' does not exist on the layer`);let u=n.find(e=>e.name===l.name);if(u==null)throw new t(`${r}:no-cached-statistics`,`Cached statistics for this attribute are not available`);let d=p(a,u.href),{data:f}=await D(d,{query:{f:`json`,...o,token:s},responseType:`json`,signal:c});return f}async function Qe(e){let t=[];for(let n of e)n.name.toLowerCase().endsWith(`.zip`)?t.push($e(n)):t.push(Promise.resolve(n));return(await Promise.all(t)).flat()}async function $e(t){let{BlobReader:n,ZipReader:r,BlobWriter:i}=await e(async()=>{let{BlobReader:e,ZipReader:t,BlobWriter:n}=await import(`./zipjs-wrapper-CsRqb_O9.js`);return{BlobReader:e,ZipReader:t,BlobWriter:n}},[]),a=[];return(await new r(new n(t)).getEntries()).forEach(e=>{if(e.directory||/^__MACOS/i.test(e.filename))return;let t=new i;a.push(e.getData(t).then(t=>new File([t],e.filename)))}),Promise.all(a)}var X=new Set([`3DObject`,`Point`]),Z=o(),Q=class extends Ye(Ce(Ne(be(h(v(n(re(ce(ve(F(S))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType=`ArcGISSceneServiceLayer`,this.type=`scene`,this.fields=null,this.graphicOrigin=new Je(this),this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new k,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.attributeTableTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}destroy(){this._set(`renderer`,null),this.associatedLayer=_e(this.associatedLayer)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){let n=this.getField(e)?.domain??null;return this.associatedLayer?Se(this.associatedLayer,e,t,n):n}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new d(this.fields)}readNodePages(e,t,n){return t.layerType===`Point`&&(e=t.pointNodePages),typeof e!=`object`||!e?null:H.fromJSON(e,n)}set elevationInfo(e){this._set(`elevationInfo`,e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return this.associatedLayer!=null&&je(this.associatedLayer)}get geometryType(){return et[this.profile]||`mesh`}set renderer(e){x(e,this.fieldsIndex),this._set(`renderer`,e)}readCachedDrawingInfo(e){return typeof e==`object`&&e||(e={}),e.color??=!1,e}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){e??=Me;let{query:t,queryRelated:n,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:a,supportsGeometryUpdate:o,supportsReturnServiceEditsInSourceSpatialReference:s},data:{supportsZ:c,supportsM:l,isVersioned:u,supportsAttachment:d},operations:{supportsEditing:f,supportsAdd:p,supportsUpdate:m,supportsDelete:h,supportsQuery:g,supportsQueryAttachments:_,supportsAsyncConvert3D:v}}=e,y=e.operations.supportsChangeTracking,b=!!this.associatedLayer?.infoFor3D;return{query:t,queryRelated:n,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:s,supportsRollbackOnFailure:i,supportsGeometryUpdate:b&&o,supportsUploadWithItemId:a},data:{supportsAttachment:d,supportsZ:c,supportsM:l,isVersioned:u},operations:{supportsQuery:g,supportsQueryAttachments:_,supportsEditing:f&&y,supportsAdd:b&&p&&y,supportsDelete:b&&h&&y,supportsUpdate:m&&y,supportsAsyncConvert3D:v}}}get editingEnabled(){return this._isOverridden(`editingEnabled`)?this._get(`editingEnabled`):this.associatedLayer?.editingEnabled??!1}set editingEnabled(e){this._overrideIfSome(`editingEnabled`,e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(t=>(t.type===`esriFieldTypeOID`&&(e=t.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(t=>(t.type===`esriFieldTypeGlobalID`&&(e=t.name),!!e)),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,t){let n=t.store.profile;return n!=null&&$[n]?$[n]:(s.getLogger(this).error(`Unknown or missing profile`,{profile:n,layer:this}),`mesh-pyramids`)}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(e){this._override(`useViewTime`,e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){let t=e?.signal;await this.loadFromPortal({supportedTypes:[`Scene Service`]},e).catch(Ee),await this._fetchService(t),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await this.loadTimeInfoFromService(e),await Oe(this,{origin:`service`},t),x(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(e)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){s.getLogger(this).error(`#_loadFilterGeometries()`,this,`Failed to load filter geometries. Geometry filter will not be applied for this layer.`,{error:e}),this.filter=null}}createQuery(){let e=new xe;return this.geometryType===`mesh`?this.capabilities.query.supportsReturnMesh&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||`1=1`,e.sqlFormat=`standard`,e.outFields=[`*`],e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatures(e||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=this,t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}async queryRelatedFeatures(e,n){if(await this.load(),!this.associatedLayer)throw new t(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});return this.associatedLayer.queryRelatedFeatures(e,n)}async queryRelatedFeaturesCount(e,n){if(await this.load(),!this.associatedLayer)throw new t(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(e,n)}async queryCachedAttributes(e,t){let n=M(this.fieldsIndex,await Re(this,ze(this)));return Le(this.parsedUrl?.path??``,this.attributeStorageInfo??[],e,t,n,this.apiKey,this.customParameters)}async queryCachedFeature(e,n){let r=await this.queryCachedAttributes(e,[n]);if(!r||r.length===0)throw new t(`scenelayer:feature-not-in-cached-data`,`Feature not found in cached data`);let i=new ee;return i.attributes=r[0],i.layer=this,i.sourceLayer=this,i.origin=this.graphicOrigin,i}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryAttachments(e,t))}getFieldUsageInfo(e){let t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(s.getLogger(this).error(`#getFieldUsageInfo()`,`Unavailable until layer is loaded`),t)}createPopupTemplate(e){return oe(this,e)}_getAssociatedLayerForQuery(){let e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new t(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});try{await this.associatedLayer.load()}catch(e){throw new t(`scenelayer:query-not-available`,`SceneLayer associated feature layer could not be loaded`,{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){return await this.load(t),await this.fetchStatistics(e,t)}async saveAs(e,t){return this._debouncedSaveOperations(1,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`scene`},e)}async save(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`scene`})}async applyEdits(n,r){let{applyEdits:i}=await e(async()=>{let{applyEdits:e}=await import(`./editingSupport-DIqS6Asw.js`);return{applyEdits:e}},__vite__mapDeps([0,1,2,3])),a=r;await this.load();let o=this.associatedLayer;if(!o)throw new t(`${this.type}-layer:not-editable`,`Service is not editable`);await o.load();let{globalIdField:s}=o,l=!!o.infoFor3D,u=a?.globalIdUsed??!0;if(l&&s==null)throw new t(`${this.type}-layer:not-editable`,`Valid globalIdField expected on editable SceneLayer`);if(l&&!u)throw new t(`${this.type}-layer:globalid-required`,`globalIdUsed must not be false for SceneLayer editing as globalIds are required.`);return O(o.url)&&l&&n.deleteFeatures!=null&&s!=null&&(a={...a,globalIdToObjectId:await c(o,n.deleteFeatures,s)}),i(this,o.source,n,a)}async uploadAssets(e,n){if(await this.load(),this.associatedLayer==null)throw new t(`${this.type}-layer:not-editable`,`Service is not editable`);return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,n)}async convertMesh(n,r){r??={};let i=e=>{throw s.getLogger(this).error(`.convertMesh()`,e.message),e};await this.load(r),this.infoFor3D||i(new t(`invalid:layer`,`SceneLayer has no capability for mesh conversion`));let a=await this.extractAndFilterFiles(n);R(r);let o=a.reduce((e,t)=>ae(this.infoFor3D,t)?e+1:e,0);o===0&&i(new We),o>1&&i(new Ge);let c=this.spatialReference,l=r.origin,u=await g(l??r.defaultOrigin??new f({x:0,y:0,z:0,spatialReference:c}),c,r),d=c.isGeographic?`local`:`georeferenced`,{default:p}=await e(async()=>{let{default:e}=await import(`./Mesh-B9frnmGL.js`);return{default:e}},__vite__mapDeps([4,5,6,2,3,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]));R(r);let m=p.createWithExternalSource(u,{type:`client`,files:a},{vertexSpace:d,transform:Ke(c),unitConversionDisabled:!0}),[h]=await this.uploadAssets([m],{...r,useAssetOrigin:!l});return h}async extractAndFilterFiles(e){await this.load();let t=this.infoFor3D;return t?(await Qe(e)).filter(e=>E(t,e)):e}validateLayer(e){if(e.layerType&&!X.has(e.layerType))throw new t(`scenelayer:layer-type-not-supported`,`SceneLayer does not support this layer type`,{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new t(`layer:service-version-not-supported`,`Service version is not supported.`,{serviceVersion:this.version.versionString,supportedVersions:`1.x, 2.x`});if(this.version.major>2)throw new t(`layer:service-version-too-new`,`Service version is too new.`,{serviceVersion:this.version.versionString,supportedVersions:`1.x, 2.x`});function n(e,n){let r=!1,i=!1;if(e==null)r=!0,i=!0;else{let t=n&&n.isGeographic;switch(e){case`east-north-up`:case`earth-centered`:r=!0,i=t;break;case`vertex-reference-frame`:r=!0,i=!t;break;default:r=!1}}if(!r)throw new t(`scenelayer:unsupported-normal-reference-frame`,`Normal reference frame is invalid.`);if(!i)throw new t(`scenelayer:incompatible-normal-reference-frame`,`Normal reference frame is incompatible with layer spatial reference.`)}n(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){let e=[];if(this.profile===`points`)e.push(`Point`);else{if(this.profile!==`mesh-pyramids`)throw new t(`scenelayer:unknown-profile`,`SceneLayer:save() encountered an unknown SceneLayer profile: `+this.profile);e.push(`3DObject`)}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(let e of this.fields){let t=!!this.attributeStorageInfo?.some(t=>t.name===e.name),n=!!this.associatedLayer?.fields?.some(t=>t&&e.name===t.name),r={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||n,supportsLayerQuery:n};this._fieldUsageInfo[e.name]=r}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPropertyOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(let t of this.associatedLayer.fields){let n=this.getField(t.name);n?(!n.domain&&t.domain&&(n.domain=t.domain.clone()),n.editable=t.editable,n.nullable=t.nullable,n.length=t.length):(e||=this.fields?this.fields.slice():[],e.push(t.clone()))}e&&this._set(`fields`,e)}_applyAssociatedLayerPropertyOverrides(){if(!this.associatedLayer)return;let e=[`popupTemplate`,`popupEnabled`,`attributeTableTemplate`],t=z(this);for(let n=0;n<e.length;n++){let r=e[n],i=this.originIdOf(r),a=this.associatedLayer.originIdOf(r);i<a&&(a===2||a===3)&&t.setAtOrigin(r,this.associatedLayer[r],a)}}_applyAssociatedLayerExtentOverride(){let e=this.associatedLayer?.getAtOrigin(`fullExtent`,`service`);this.associatedLayer?.infoFor3D==null||!e||!O(this.associatedLayer?.url)||!G(this)||z(this).setAtOrigin(`fullExtent`,e.clone(),2)}_applyAssociatedLayerPrivileges(){let e=this.associatedLayer;e&&(this._set(`userHasEditingPrivileges`,e.userHasEditingPrivileges),this._set(`userHasFullEditingPrivileges`,e.userHasFullEditingPrivileges),this._set(`userHasUpdateItemPrivileges`,e.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(e){if([`mesh-pyramids`,`points`].includes(this.profile))try{let{serverUrl:t,layerId:n,portalItem:r}=await Be(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e});this.associatedLayer=new(await(Ue.FeatureLayer()))({url:t,customParameters:this.customParameters,layerId:n,portalItem:r}),await this.associatedLayer.load()}catch(e){ye(e)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){let e=new AbortController;this.addHandles(he(e));try{await me(()=>this.popupEnabled&&this.popupTemplate!=null,e.signal)}catch(e){de(e);return}let t=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?s.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):s.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){let e=this.elevationInfo;this.profile===`mesh-pyramids`&&U(s.getLogger(this),He(`Mesh scene layers`,`relative-to-scene`,e)),U(s.getLogger(this),Ve(`Scene layers`,e))}async fetchStatistics(e,t){return await Ze({fieldName:e,statisticsInfo:this.statisticsInfo,errorContext:`scenelayer`,fieldsIndex:this.fieldsIndex,path:this.parsedUrl?.path??``,customParameters:this.customParameters,apiKey:this.apiKey,signal:t?.signal})}};P([a({types:{key:`type`,base:_,typeMap:{selection:i}},json:{origins:{"web-scene":{name:`layerDefinition.featureReduction`,write:{allowNull:!0}},"portal-item":{name:`layerDefinition.featureReduction`,write:{allowNull:!0}}}}})],Q.prototype,`featureReduction`,void 0),P([a({type:[q],json:{read:!1,origins:{"web-scene":{name:`layerDefinition.rangeInfos`,write:!0},"portal-item":{name:`layerDefinition.rangeInfos`,write:!0}}},clonable:!1})],Q.prototype,`rangeInfos`,void 0),P([a({json:{read:!1}})],Q.prototype,`associatedLayer`,void 0),P([a({type:[`show`,`hide`]})],Q.prototype,`listMode`,void 0),P([a({type:[`ArcGISSceneServiceLayer`]})],Q.prototype,`operationalLayerType`,void 0),P([a({json:{read:!1},readOnly:!0})],Q.prototype,`type`,void 0),P([a({...Z.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`fields`,void 0),P([a()],Q.prototype,`types`,null),P([a()],Q.prototype,`typeIdField`,null),P([a()],Q.prototype,`templates`,null),P([a()],Q.prototype,`formTemplate`,null),P([a({readOnly:!0})],Q.prototype,`graphicOrigin`,void 0),P([a({readOnly:!0,clonable:!1})],Q.prototype,`fieldsIndex`,null),P([a({type:Te,json:{read:{source:`layerDefinition.floorInfo`},write:{target:`layerDefinition.floorInfo`}}})],Q.prototype,`floorInfo`,void 0),P([a(Z.outFields)],Q.prototype,`outFields`,void 0),P([a({type:H,readOnly:!0,json:{read:!1},clonable:!1})],Q.prototype,`nodePages`,void 0),P([T(`service`,`nodePages`,[`nodePages`,`pointNodePages`])],Q.prototype,`readNodePages`,null),P([a({type:[Ie],readOnly:!0,clonable:!1})],Q.prototype,`materialDefinitions`,void 0),P([a({type:[Pe],readOnly:!0,clonable:!1})],Q.prototype,`textureSetDefinitions`,void 0),P([a({type:[Fe],readOnly:!0,clonable:!1})],Q.prototype,`geometryDefinitions`,void 0),P([a({readOnly:!0})],Q.prototype,`serviceUpdateTimeStamp`,void 0),P([a({readOnly:!0})],Q.prototype,`attributeStorageInfo`,void 0),P([a({readOnly:!0})],Q.prototype,`statisticsInfo`,void 0),P([a({type:k.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.excludeObjectIds`,write:{enabled:!0}}})],Q.prototype,`excludeObjectIds`,void 0),P([a({type:String,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],Q.prototype,`definitionExpression`,void 0),P([a({type:Xe,json:{name:`layerDefinition.polygonFilter`,write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Q.prototype,`filter`,void 0),P([a({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Q.prototype,`path`,void 0),P([a(j)],Q.prototype,`elevationInfo`,null),P([a({readOnly:!0,json:{read:!1}})],Q.prototype,`effectiveCapabilities`,null),P([a({readOnly:!0})],Q.prototype,`effectiveEditingEnabled`,null),P([a({type:String})],Q.prototype,`geometryType`,null),P([a(y)],Q.prototype,`labelsVisible`,void 0),P([a({type:[ne],json:{origins:{service:{name:`drawingInfo.labelingInfo`,read:{reader:C},write:!1}},name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:C},write:!0}})],Q.prototype,`labelingInfo`,void 0),P([a(u)],Q.prototype,`legendEnabled`,void 0),P([a({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:[`opacity`,`layerDefinition.drawingInfo.transparency`],reader(e,t){if(typeof e==`number`&&e>=0&&e<=1)return e;let n=t.layerDefinition?.drawingInfo?.transparency;return n===void 0?void 0:fe(n)}}},"portal-item":{write:!0},service:{read:!1}}}})],Q.prototype,`opacity`,void 0),P([a({type:[`Low`,`High`],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`priority`,void 0),P([a({type:[`Labels`],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`semantic`,void 0),P([a({types:ie,json:{origins:{service:{read:{source:`drawingInfo.renderer`}}},name:`layerDefinition.drawingInfo.renderer`,write:!0},value:null})],Q.prototype,`renderer`,null),P([a({json:{read:!1}})],Q.prototype,`cachedDrawingInfo`,void 0),P([T(`service`,`cachedDrawingInfo`)],Q.prototype,`readCachedDrawingInfo`,null),P([a({readOnly:!0,json:{read:!1}})],Q.prototype,`capabilities`,null),P([a({type:Boolean,json:{read:!1}})],Q.prototype,`editingEnabled`,null),P([a({readOnly:!0,json:{write:!1,read:!1}})],Q.prototype,`infoFor3D`,null),P([a({readOnly:!0,json:{write:!1,read:!1}})],Q.prototype,`relationships`,null),P([a(r)],Q.prototype,`popupEnabled`,void 0),P([a({type:le,json:{name:`popupInfo`,write:!0}})],Q.prototype,`popupTemplate`,void 0),P([a({readOnly:!0,json:{read:!1}})],Q.prototype,`defaultPopupTemplate`,null),P([a(ke)],Q.prototype,`attributeTableTemplate`,void 0),P([a({type:String,json:{read:!1}})],Q.prototype,`objectIdField`,void 0),P([T(`service`,`objectIdField`,[`objectIdField`,`fields`])],Q.prototype,`readObjectIdField`,null),P([a({type:String,json:{read:!1}})],Q.prototype,`globalIdField`,void 0),P([T(`service`,`globalIdField`,[`globalIdField`,`fields`])],Q.prototype,`readGlobalIdField`,null),P([a({readOnly:!0,type:String,json:{read:!1}})],Q.prototype,`displayField`,null),P([a({type:String,json:{read:!1}})],Q.prototype,`profile`,void 0),P([T(`service`,`profile`,[`store.profile`])],Q.prototype,`readProfile`,null),P([a({readOnly:!0,type:String,json:{origins:{service:{read:{source:`store.normalReferenceFrame`}}},read:!1}})],Q.prototype,`normalReferenceFrame`,void 0),P([a(b)],Q.prototype,`screenSizePerspectiveEnabled`,void 0),P([a({json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`serviceItemId`,void 0),P([a(l)],Q.prototype,`useViewTime`,null),Q=P([w(`esri.layers.SceneLayer`)],Q);var $={"mesh-pyramids":`mesh-pyramids`,meshpyramids:`mesh-pyramids`,"features-meshes":`mesh-pyramids`,points:`points`,"features-points":`points`,lines:`lines`,"features-lines":`lines`,polygons:`polygons`,"features-polygons":`polygons`},et={"mesh-pyramids":`mesh`,points:`point`},tt=Q;export{tt as default};