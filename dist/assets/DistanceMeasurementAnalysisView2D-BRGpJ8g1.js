import{$_ as e,Aw as t,BT as n,I_ as r,Od as i,Rd as a,Sg as o,VT as s,Vd as c,aT as l,dv as u,gT as d,kD as f,mv as p,pv as m,rE as h,tT as g,tp as _,wg as v}from"./index-BN8X5Ryz.js";import"./memoryEstimations-D_IbKyOk.js";import"./OptimizedGeometry-BQJ7w5VU.js";import"./Point2D-DJueHbCy.js";import"./Envelope2D-B7gkUj4e.js";import"./SpatialReference-CfUjvF_j.js";import"./Transformation2D-D07KwcEj.js";import"./SimpleGeometryCursor-BILtMaQf.js";import"./OperatorDefinitions-C5Pat-Jx.js";import"./jsonConverter-CoA5-zxu.js";import"./FlatGeometry-BsPiiSVP.js";import"./apiConverter-Dsm0pxcs.js";import"./geodeticCurveType-CcdKHJt5.js";import"./geodeticAreaOperator-B2LzXjd-.js";import"./operatorGeodeticDensify-0EE8Fc4Y.js";import{i as y,o as b}from"./geodeticDensifyOperator-B6xHg5VF.js";import{i as x,r as S}from"./geodeticLengthOperator-BdZS0ajo.js";import{n as C}from"./lengthOperator-DdV6vMS2.js";import"./operatorSimplify-BCW0XIAz.js";import{r as w}from"./simplifyOperator-C6TgASU6.js";import"./quatf64-D37SEdPg.js";import"./earcut-CEMcWA4Z.js";import"./plane-Da5EsY0J.js";import"./vectorStacks-Cuo89CNO.js";import"./projectPointToVector-BkRdoTqD.js";import"./spatialReferenceEllipsoidUtils-qw9wv8RL.js";import"./projectionZScaling-C8xhU_hX.js";import{i as T,r as E}from"./projectOperator-DWqbOm71.js";import"./dehydratedPoint-CWZQBefp.js";import"./projectVectorToVector-DGzn2p7I.js";import"./memoize-Dl61_jt0.js";import"./elevationInfoUtils-uoMH3ofe.js";import{r as D,s as O}from"./colorUtils-CzajW9E7.js";import{t as k}from"./GraphicsLayer-DBcl42yN.js";import"./ObjectStack-l5kM7JZu.js";import"./ray-LkJ58wpZ.js";import{t as A}from"./getDefaultUnitForView-DyZIV1hK.js";import{n as j,t as M}from"./ExclusiveOperationManager-D0f7Woil.js";import{n as N}from"./quantity-Co6flzuS.js";import"./unitFormatUtils-DIX5VDC2.js";import{a as P}from"./quantityFormatUtils-DorrZj0i.js";import{c as F,o as I,s as L}from"./geodesicUtils-D99LxQ6q.js";import{n as R,t as z}from"./SketchViewModel-BUSTPGCt.js";import"./isSupportedObject-CnaOA-Ng.js";import"./layerUtils-BZgsYerz.js";import"./SketchOptions-DjwJVzbR.js";import"./LineSnappingHint-CmFAetWF.js";import"./ParallelSnappingHint-CVYaPm-q.js";import"./snappingUtils-D3oTIKrZ.js";import"./vec3-B94Y7ih2.js";import"./sphere-d9-4vNcj.js";import"./constraints-Ch5tsKD8.js";import"./SnappingCandidate-DueCLuvH.js";import"./EdgeSnappingCandidate-CCg5Xb97.js";import"./DrapedEdgeSnappingCandidate-CqXt8QLN.js";import"./IntersectionSnappingHint-CvQZ8eWi.js";import"./IntersectionSnappingCandidate-C2uVyhEk.js";import"./LineSnappingCandidate-BNbhbOGH.js";import"./RightAngleTriangleSnappingCandidate-CqVuCsko.js";import"./RightAngleSnappingHint-tXLlHR_t.js";import"./viewUtils-GR2hLWLo.js";import"./viewUtils-H4dpIyqQ.js";import"./euclideanLengthMeasurementUtils-CvEUUrXw.js";import"./lineSegment-BudcKS0C.js";import"./triangle-46ad8nAb.js";import"./hitTestSelectUtils-DrV1belT.js";var B=N(1e5,`meters`);async function V(e,t){if(!e?.paths.length||!e.paths[0].length)return null;await T();let n=E(e,t);return n?n.spatialReference.isGeographic?L(n.spatialReference)?U(n):H(n):n.spatialReference.isWebMercator?H(n):W(n):null}async function H(e){await Promise.all([b(),x()]);let t=w(e);if(!t)return null;let n=y(t,B.value,{unit:B.unit});if(!n)return null;let r=S(t,{unit:`meters`});return{display:{outline:n},mode:`geodesic`,length:N(r,`meters`)}}function U(e){let t=w(e);if(!t)return null;let n=F(t,B.value),r=I([t],`meters`)[0];return{display:{outline:n},mode:`geodesic`,length:N(r,`meters`)}}function W(e){let t=w(e);if(!t)return null;let n=C(t,{unit:`meters`});return{display:{outline:t},mode:`euclidean`,length:N(n,`meters`)}}var G=class extends t{constructor(e){super(e),this._result=null,this._updatingHandles=new v,this._debouncedGetResult=g(async e=>{this._result=await V(e,this.view.spatialReference)})}initialize(){this.addHandles(m(()=>this.measurementViewData.analysis.geometry,e=>{this._updatingHandles.addPromise(d(this._debouncedGetResult(e)))},p))}destroy(){this._updatingHandles.destroy()}get result(){return this._result}get updating(){return this._updatingHandles.updating}};f([n()],G.prototype,`_result`,void 0),f([n()],G.prototype,`measurementViewData`,void 0),f([n()],G.prototype,`result`,null),f([n()],G.prototype,`updating`,null),f([n()],G.prototype,`view`,void 0),G=f([s(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementController`)],G);function K(e,t){let n=D(O(t,160),.5),r=O(e);return new _({data:{type:`CIMSymbolReference`,primitiveOverrides:[{type:`CIMPrimitiveOverride`,primitiveName:`textOverride`,propertyName:`TextString`,valueExpressionInfo:{type:`CIMExpressionInfo`,title:`Custom`,expression:`$feature.lengthText`,returnType:`Default`}}],symbol:{type:`CIMLineSymbol`,symbolLayers:[{type:`CIMVectorMarker`,enable:!0,size:10,colorLocked:!0,anchorPointUnits:`Relative`,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:`CIMMarkerGraphic`,geometry:{x:0,y:0},symbol:{type:`CIMTextSymbol`,fontFamilyName:`sans-serif`,height:14,horizontalAlignment:`Center`,offsetX:0,offsetY:0,symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,enable:!0,color:t.toArray()}]},haloSymbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,enable:!0,color:n.toArray()}]},haloSize:2,verticalAlignment:`Center`,flipAngle:90},primitiveName:`textOverride`}],scaleSymbolsProportionally:!0,respectFrame:!0,markerPlacement:{type:`CIMMarkerPlacementOnLine`,angleToLine:!0,offset:8,relativeTo:`LineMiddle`,startPointOffset:0}},{type:`CIMSolidStroke`,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[14,12],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],enable:!0,capStyle:`Butt`,joinStyle:`Round`,width:3.5,color:r.toArray()},{type:`CIMSolidStroke`,enable:!0,capStyle:`Butt`,joinStyle:`Round`,width:5,color:e.toArray()}]}}})}var q=class extends t{get _messages(){return this._messagesTask?.value}constructor(e){super(e),this._graphicsLayer=new k({listMode:`hide`,internal:!0}),this._updatingHandles=new v}initialize(){this.view.map?.add(this._graphicsLayer),this.addHandles(e(()=>this._updateMessageBundle())),this._updatingHandles.add(()=>({accentColor:this.view.effectiveTheme.accentColor,length:this.measurementViewData.result?.length,messages:this._messages,outline:this.measurementViewData.result?.display.outline,textColor:this.view.effectiveTheme.textColor,unit:this.measurementViewData.unit,visible:this.measurementViewData.visible}),({accentColor:e,length:t,messages:n,outline:r,textColor:a,unit:o,visible:s},c)=>{if(this._graphicsLayer.visible=s,!s)return;if(!n||!t||!r)return void this._graphicsLayer.graphics.destroyAll();let l=this._graphicsLayer.graphics.at(0),u=n&&t?P(n,t,o):``;if(l&&e.equals(c?.accentColor)&&a.equals(c?.textColor))return l.attributes.lengthText=u,void(l.geometry=r);this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new i({attributes:{lengthText:u},geometry:r,symbol:K(e,a)}))},u),this._updateMessageBundle()}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get updating(){return!this._graphicsLayer.loaded||!this._messagesTask?.finished||this._updatingHandles.updating}_updateMessageBundle(){return this._messagesTask?.abort(),this._messagesTask=o(()=>r(`esri/core/t9n/Units`)),this._messagesTask.promise}};f([n()],q.prototype,`_messages`,null),f([n()],q.prototype,`_messagesTask`,void 0),f([n()],q.prototype,`measurementViewData`,void 0),f([n()],q.prototype,`updating`,null),f([n()],q.prototype,`view`,void 0),q=f([s(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementLineVisualization`)],q);var J=class extends t{constructor(e){super(e),this._emptyFillSymbol=new a({color:null,outline:null}),this._graphicsLayer=new k({listMode:`hide`,internal:!0}),this._updatingHandles=new v}initialize(){this.view.map?.add(this._graphicsLayer),this._updatingHandles.add(()=>({geometry:this.measurementViewData.analysis.geometry}),({geometry:e})=>{if(!e)return void this._graphicsLayer.graphics.destroyAll();let t=this._graphicsLayer.graphics.at(0);t?t.geometry=e:(this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new i({geometry:e,symbol:this._emptyFillSymbol})))},u)}destroy(){this._emptyFillSymbol.destroy(),this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get graphic(){return this._graphicsLayer.graphics.at(0)}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded||this._updatingHandles.updating}};f([n()],J.prototype,`graphic`,null),f([n()],J.prototype,`graphicsLayer`,null),f([n()],J.prototype,`measurementViewData`,void 0),f([n()],J.prototype,`updating`,null),f([n()],J.prototype,`view`,void 0),J=f([s(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementManipulatorVisualization`)],J);var Y=class extends t{constructor(e){super(e),this._graphicsLayer=new k({listMode:`hide`,internal:!0})}initialize(){this.view.map?.add(this._graphicsLayer)}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded}};f([n()],Y.prototype,`graphicsLayer`,null),f([n()],Y.prototype,`measurementViewData`,void 0),f([n()],Y.prototype,`updating`,null),f([n()],Y.prototype,`view`,void 0),Y=f([s(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementSketchVisualization`)],Y);function X(e){return e?.type===`polyline`}var Z=class extends t{constructor(e){super(e),this._invisibleLineSymbol=new c({color:null,width:0}),this._operationManager=new M,this._updatingHandles=new v}initialize(){this._sketchViewModel=new z({defaultCreateOptions:{mode:`click`},defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{edgeOperation:`none`,shapeOperation:`none`},toggleToolOnClick:!1,tool:`reshape`},updateOnGraphicClick:!1,view:this.view}),this.addHandles([m(()=>({interactive:this.measurementViewData.interactive,visible:this.measurementViewData.visible}),({interactive:e,visible:t})=>{this._operationManager.stop(),t&&e&&this.reshape()}),m(()=>this.measurementViewData.snappingOptions,e=>{this._sketchViewModel&&(this._sketchViewModel.snappingOptions=e)},u),m(()=>this.view.effectiveTheme.accentColor,e=>{this._lineSymbol=new c({color:D(e,.3),width:2})},u)])}destroy(){this._invisibleLineSymbol.destroy(),this._lineSymbol?.destroy(),this._operationManager.destroy(),this._sketchViewModel?.destroy(),this._updatingHandles.destroy()}get state(){if(!this.measurementViewData.visible||!this._operationManager.currentOperationType)return`idle`;switch(this._operationManager.currentOperationType){case`place`:return`placing`;case`reshape`:return`reshaping`}}get updating(){return!this._sketchViewModel||this._sketchViewModel.updating||this._updatingHandles.updating}async place(e){return this._operationManager.start(`place`,async t=>{if(!this._sketchViewModel||!this.measurementViewData.sketchGraphicsLayer)return;let n=this._sketchViewModel.on(`create`,e=>{switch(e.state){case`active`:{let t=e.graphic?.geometry;t?.type===`polyline`&&(this.measurementViewData.analysis.geometry=t);break}case`cancel`:case`complete`:t.stop()}});t.handles.push(n,h(()=>{if(n.remove(),this._sketchViewModel?.cancel(),this.measurementViewData.sketchGraphicsLayer?.removeAll(),l(e))return t.reject();t.resolve({})})),this._sketchViewModel.polylineSymbol=this._invisibleLineSymbol,this._sketchViewModel.layer=this.measurementViewData.sketchGraphicsLayer,this._updatingHandles.addPromise(d(this._sketchViewModel.create(`polyline`)))})}async reshape(e){return this._operationManager.start(`reshape`,async t=>{if(!this._sketchViewModel)return;let n=()=>this._lineSymbol&&this._sketchViewModel&&this.measurementViewData.manipulatorGraphic&&this.measurementViewData.manipulatorGraphicsLayer?(this._sketchViewModel.polylineSymbol=this._lineSymbol,this._sketchViewModel.layer=this.measurementViewData.manipulatorGraphicsLayer,this._updatingHandles.addPromise(d(this._sketchViewModel.update(this.measurementViewData.manipulatorGraphic,{tool:`reshape`})))):Promise.resolve(),r=this._sketchViewModel.on(`update`,e=>{let r=e.graphics[0]?.geometry;this.measurementViewData.analysis.geometry=X(r)?r:null,e.state===`complete`&&(this.measurementViewData.interactive?n():t.stop())});t.handles.push(r,h(()=>{if(r.remove(),this._sketchViewModel?.cancel(),l(e))return t.reject();t.resolve()})),await n()})}};f([n()],Z.prototype,`_sketchViewModel`,void 0),f([n()],Z.prototype,`measurementViewData`,void 0),f([n()],Z.prototype,`state`,null),f([n()],Z.prototype,`updating`,null),f([n()],Z.prototype,`view`,void 0),Z=f([s(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementTool`)],Z);var Q=class extends j{constructor(e){super(e),this.analysis=null,this.snappingOptions=new R,this.type=`distance-measurement-view-2d`}initialize(){let{view:e}=this;this._lineVisualization=new q({view:e,measurementViewData:this}),this._controller=new G({view:e,measurementViewData:this}),this._manipulatorVisualization=new J({view:e,measurementViewData:this}),this._sketchVisualization=new Y({view:e,measurementViewData:this}),this._tool=new Z({view:e,measurementViewData:this})}destroy(){this._lineVisualization?.destroy(),this._controller?.destroy(),this._manipulatorVisualization?.destroy(),this._sketchVisualization?.destroy(),this._tool?.destroy()}get manipulatorGraphic(){return this._manipulatorVisualization?.graphic}get manipulatorGraphicsLayer(){return this._manipulatorVisualization?.graphicsLayer}get sketchGraphicsLayer(){return this._sketchVisualization?.graphicsLayer}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get result(){return this._controller?.result}get unit(){return this.analysis.unit??A(this.view)}get updating(){return(this._controller?.updating??!0)||(this._lineVisualization?.updating??!0)||(this._sketchVisualization?.updating??!0)||(this._tool?.updating??!0)}get visible(){return super.visible}set visible(e){super.visible=e}async place(e){return this._tool.place(e)}};f([n()],Q.prototype,`_lineVisualization`,void 0),f([n()],Q.prototype,`_controller`,void 0),f([n()],Q.prototype,`_manipulatorVisualization`,void 0),f([n()],Q.prototype,`_sketchVisualization`,void 0),f([n()],Q.prototype,`_tool`,void 0),f([n({constructOnly:!0})],Q.prototype,`analysis`,void 0),f([n()],Q.prototype,`manipulatorGraphic`,null),f([n()],Q.prototype,`manipulatorGraphicsLayer`,null),f([n()],Q.prototype,`sketchGraphicsLayer`,null),f([n({readOnly:!0})],Q.prototype,`result`,null),f([n({type:R,nonNullable:!0})],Q.prototype,`snappingOptions`,void 0),f([n({readOnly:!0})],Q.prototype,`type`,void 0),f([n({readOnly:!0})],Q.prototype,`unit`,null),f([n({readOnly:!0})],Q.prototype,`updating`,null),Q=f([s(`esri.views.2d.analysis.DistanceMeasurementAnalysisView2D`)],Q);var $=Q;export{$ as default};