const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mapImageLayerUtils-Di4QkDBj.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/originUtils-CJnuu7mB.js","assets/utils-BnryXVma.js","assets/saveUtils-CEfw3trS.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,$x as n,A as r,BT as i,L as a,Li as o,M as s,O as c,Rh as l,ST as u,TS as d,UT as f,Ua as p,VT as m,WT as h,W_ as g,Yh as _,ZS as v,_E as y,cS as b,ca as x,hv as S,j as C,kD as w,ma as T,oT as E,oa as D,pa as O,sT as k,tT as A,ua as j,vx as M,y as N,zh as P,zi as F}from"./index-BN8X5Ryz.js";import"./memoryEstimations-D_IbKyOk.js";import"./OptimizedGeometry-BQJ7w5VU.js";import"./OptimizedFeatureSet-CLjmRHYn.js";import"./featureConversionUtils-o9-cJXzl.js";import"./urlUtils-CW4cnJ3W.js";import{n as I}from"./imageBitmapUtils-CLE9aRyR.js";import"./pbf-CO6WFbVS.js";import"./pbfQueryUtils-CmJPTrN7.js";import"./queryUtils-8f7b9mi_.js";import"./query-BXrgTHrc.js";import"./executeForIds-Dq7stXFh.js";import"./executeQueryJSON-DJO3NDvM.js";import"./executeQueryPBF-i-SuhVUp.js";import"./QueryTask-6dVRoJFW.js";import{n as L,r as R,t as z}from"./SublayersOwner-B-_OpOb-.js";import{r as B}from"./sublayerUtils-Dk4DSA02.js";import"./floorFilterUtils-CPLVKkMB.js";import{t as V}from"./ExportImageParameters-BpzGm2mq.js";var H=class extends j(c(r(z(R(O(a(s(p(C(T(x(l)))))))))))){constructor(...t){super(...t),this._exportImageParameters=new V({layer:this}),this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.dpi=96,this.elevationInfo=new F({mode:`on-the-ground`}),this.gdbVersion=null,this.imageFormat=`png24`,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType=`ArcGISMapServiceLayer`,this.preferredTimeZone=null,this.sourceJSON=null,this.sublayers=null,this.type=`map-image`,this.url=null,this._debouncedSaveOperations=A(async(t,n,r)=>{let{save:i,saveAs:a}=await e(async()=>{let{save:e,saveAs:t}=await import(`./mapImageLayerUtils-Di4QkDBj.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5]));switch(t){case 0:return i(this,n);case 1:return a(this,r,n)}})}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`Map Service`]},e).catch(k).then(()=>this._fetchService(t))),Promise.resolve(this)}destroy(){this._exportImageParameters.destroy()}readImageFormat(e,t){let n=t.supportedImageFormatTypes;return n&&n.includes(`PNG32`)?`png32`:`png24`}get loaded(){return super.loaded}get portalItem(){return super.portalItem}set portalItem(e){super.portalItem=e}writeSublayers(e,t,n,r){if(!this.loaded||!e)return;let i=e.slice().reverse().flatten(({sublayers:e})=>e&&e.toArray().reverse()).toArray(),a=!1,o=u(r.origin),s;if(this.capabilities?.operations.supportsExportMap&&this.capabilities?.exportMap?.supportsDynamicLayers){if(o===3){let e=this.createSublayersForOrigin(`service`).sublayers;a=B(i,e,2)}else if(o>3){let e=this.createSublayersForOrigin(`portal-item`);a=B(i,e.sublayers,u(e.origin)),s=e.originWithPartialOverrides}}let c=[],l={writeSublayerStructure:a,...r,minimumWritableOrigin:s},d=a||this.hasVisibleLayersForOrigin(o);i.forEach(e=>{let t=e.write({},l);c.push(t),d||=e.originOf(`visible`)===`user`}),c.some(e=>Object.keys(e).length>1)&&(t.layers=c),d&&(t.visibleLayers=i.filter(e=>e.visible).map(e=>e.id))}createExportImageParameters(e,t,r,i){let a=i?.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian()),this._exportImageParameters.floors=i?.floors??null,this._exportImageParameters.scale=i?.scale||D({extent:e,width:t})*a;let o=this._exportImageParameters.toJSON(),s=!i?.rotation||this.version<10.3?{}:{rotation:-i.rotation},c=e?.spatialReference,l=d(c);if(i?.scale&&e){let r=e.width/t*(n(e?.spatialReference)*b);o.dpi=i.scale/r}o.dpi*=a;let u={};if(i?.timeExtent){let{start:e,end:t}=i.timeExtent.toJSON();u.time=e&&t&&e===t?``+e:`${e??`null`},${t??`null`}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(u.time=`null,null`);return{bbox:e?e.xmin+`,`+e.ymin+`,`+e.xmax+`,`+e.ymax:void 0,bboxSR:l,imageSR:l,size:t+`,`+r,...o,...s,...u}}async fetchImage(e,t,n,r){let{data:i}=await this._fetchImage(`image`,e,t,n,r);return i}async fetchImageBitmap(e,t,n,r){let{data:i,url:a}=await this._fetchImage(`blob`,e,t,n,r);return I(i,a,r?.signal)}async fetchRecomputedExtents(e={}){let t={...e,query:{returnUpdates:!0,f:`json`,...this.customParameters,token:this.apiKey}},{data:n}=await v(this.url,t),{extent:r,fullExtent:i,timeExtent:a}=n,o=r||i;return{fullExtent:o&&M.fromJSON(o),timeExtent:a&&P.fromJSON({start:a[0],end:a[1]})}}loadAll(){return _(this,e=>{e(this.allSublayers),e(this.subtables)})}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}serviceSupportsSpatialReference(e){return N(this,e)}async _fetchImage(e,n,r,i,a){let o={responseType:e,signal:a?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(n,r,i,a),f:`image`,...this.refreshParameters,...this.customParameters,token:this.apiKey}},s=this.parsedUrl.path+`/export`;if(o.query?.dynamicLayers!=null&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new t(`mapimagelayer:dynamiclayer-not-supported`,`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:o.query});try{let{data:e}=await v(s,o);return{data:e,url:s}}catch(e){throw E(e)?e:new t(`mapimagelayer:image-fetch-error`,`Unable to load image: ${s}`,{error:e})}}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:`service`,url:this.parsedUrl});let{data:t,ssl:n}=await v(this.parsedUrl.path,{query:{f:`json`,...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});n&&(this.url=this.url.replace(/^http:/i,`https:`)),this.sourceJSON=t,this.read(t,{origin:`service`,url:this.parsedUrl})}hasVisibleLayersForOrigin(e){return!(e==null||!this.sublayersSourceJSON[e]?.visibleLayers)}};w([i(g(`dateFieldsTimeReference`))],H.prototype,`dateFieldsTimeZone`,void 0),w([i({type:Boolean})],H.prototype,`datesInUnknownTimezone`,void 0),w([i()],H.prototype,`dpi`,void 0),w([i()],H.prototype,`elevationInfo`,void 0),w([i()],H.prototype,`gdbVersion`,void 0),w([i()],H.prototype,`imageFormat`,void 0),w([h(`imageFormat`,[`supportedImageFormatTypes`])],H.prototype,`readImageFormat`,null),w([i({json:{origins:{service:{read:{source:`maxImageHeight`}}}}})],H.prototype,`imageMaxHeight`,void 0),w([i({json:{origins:{service:{read:{source:`maxImageWidth`}}}}})],H.prototype,`imageMaxWidth`,void 0),w([i()],H.prototype,`imageTransparency`,void 0),w([i({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],H.prototype,`isReference`,void 0),w([i({json:{read:!1,write:!1}})],H.prototype,`labelsVisible`,void 0),w([i({type:[`ArcGISMapServiceLayer`]})],H.prototype,`operationalLayerType`,void 0),w([i({json:{read:!1,write:!1}})],H.prototype,`popupEnabled`,void 0),w([i(g(`preferredTimeReference`))],H.prototype,`preferredTimeZone`,void 0),w([i()],H.prototype,`sourceJSON`,void 0),w([i({type:S.ofType(L),json:{write:{ignoreOrigin:!0}}})],H.prototype,`sublayers`,void 0),w([f(`sublayers`,{layers:{type:[L]},visibleLayers:{type:[y]}})],H.prototype,`writeSublayers`,null),w([i({type:[`show`,`hide`,`hide-children`],json:{origins:{"portal-item":{read:!1,write:!1}}}})],H.prototype,`listMode`,void 0),w([i({json:{read:!1},readOnly:!0,value:`map-image`})],H.prototype,`type`,void 0),w([i(o)],H.prototype,`url`,void 0),H=w([m(`esri.layers.MapImageLayer`)],H);var U=H;export{U as default};