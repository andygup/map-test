const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Compositing.glsl-Cx07Mq3K.js","assets/Compositing.glsl-JUsSGFFM.js","assets/ScreenSpacePass.glsl-MQijsFL9.js","assets/glsl-B__sVAcg.js","assets/ReadDepth.glsl-DUk8QQwu.js","assets/index-CzMixifc.js","assets/index-CDgdHpAj.css","assets/Float2BindUniform-COpkFEGz.js","assets/Uniform-CfHWJqSg.js","assets/FloatPassUniform-D-_T45xB.js","assets/Texture2DPassUniform-wY08hxIn.js","assets/NoParameters-B66z9IwQ.js","assets/ShaderBuilder-Dbc4jYz7.js","assets/Laserlines.glsl-CNf-71Rp.js","assets/Laserlines.glsl-QH2C_Me0.js","assets/lineSegment-WEn1ku7V.js","assets/ObjectStack-DiVLRoBj.js","assets/vectorStacks-BQiry9fn.js","assets/quatf64-eO7UAs9K.js","assets/plane--nqwMDYx.js","assets/Laserline.glsl-DAk7UF9m.js","assets/CameraSpace.glsl-DZ0WgHSr.js","assets/Float4BindUniform-DtHi0dnJ.js","assets/Float3PassUniform-BIrLVK7_.js","assets/Texture2DBindUniform-BW-pj6EM.js","assets/Float2PassUniform-gY4yy6pK.js","assets/Float3BindUniform-DnRIK6cJ.js","assets/Float4PassUniform-CYWbrPzx.js","assets/FloatBindUniform-BPgZfINH.js","assets/LaserlinePath.glsl-CrCbRRXF.js","assets/LaserlinePath.glsl-B2vZQRm0.js","assets/Matrix4BindUniform-DNS5lGEU.js","assets/Matrix4PassUniform-9Utk6s1j.js","assets/ShadedColorMaterial.glsl-BlWmM5Tv.js","assets/ShadedColorMaterial.glsl-DsKzQjGL.js","assets/Transform.glsl-DMKMztkJ.js","assets/Slice.glsl-A8bL0Rkn.js","assets/Float3DrawUniform-UWnIK6YY.js","assets/AlphaCutoff-qYsC5qb0.js","assets/HighlightReadBitmap.glsl-yTX333eD.js","assets/TerrainDepthTest.glsl-BUpx6Cvv.js","assets/View.glsl-D5eT11ZQ.js","assets/OutputColorHighlightOLID.glsl-B38t8Aex.js","assets/Emissions.glsl-nadaueeL.js","assets/Texture2DDrawUniform-CV_1kucp.js","assets/SlicePlaneMaterial.glsl-B33FBNWz.js","assets/SlicePlaneMaterial.glsl-C8rhZAqU.js","assets/ImageMaterial.glsl-zPgAtEKl.js","assets/ImageMaterial.glsl-Du_1HWiA.js","assets/ObjectAndLayerIdColor.glsl-DLOlMhcf.js"])))=>i.map(i=>d[i]);
import{$T as e,$_ as t,$h as n,$u as r,Al as i,BS as a,Bf as o,Bm as s,Bx as c,Cb as l,Cl as u,DT as d,Db as f,Dm as p,Eb as m,Em as h,Ey as g,Fu as _,GC as v,Gg as ee,Hm as te,Il as ne,Im as re,Is as ie,JE as ae,JT as oe,Jg as se,Ml as y,Nb as ce,Nf as le,Nh as ue,Nl as b,Nm as de,Nu as fe,OT as x,Ob as pe,Og as me,Ol as S,Om as he,Ov as ge,Pg as _e,Pl as ve,Pm as ye,Q as be,Q_ as xe,Qh as Se,Qu as Ce,Rb as we,Rf as C,Rm as Te,Tf as Ee,Tl as De,UT as w,Vm as Oe,WT as T,Wm as ke,XC as Ae,XT as E,YE as je,Yh as Me,ZC as Ne,ZT as Pe,Z_ as Fe,_T as Ie,_b as Le,_w as Re,al as ze,bf as Be,c_ as D,cf as Ve,cl as He,df as Ue,dl as We,dw as Ge,et as Ke,ev as O,f_ as qe,fw as Je,gD as k,gT as Ye,gw as Xe,hT as Ze,hb as Qe,i_ as $e,iv as et,jl as tt,jm as nt,jw as rt,kT as it,kf as at,kl as ot,km as st,ll as ct,ml as lt,nt as ut,nv as A,nx as dt,of as ft,og as pt,ol as mt,ot as ht,ov as gt,pD as _t,pT as vt,pg as yt,px as bt,qC as xt,qh as St,rE as Ct,rS as wt,rg as Tt,rh as j,rl as M,rv as Et,sl as Dt,sv as Ot,tg as kt,tt as At,uD as jt,u_ as N,ul as Mt,vT as P,vl as F,vw as Nt,wm as Pt,wx as Ft,xb as It,yT as Lt,yl as I,zf as Rt,zi as zt,zm as Bt,zy as Vt}from"./index-CzMixifc.js";import"./memoryEstimations-C3WUBUZI.js";import"./OptimizedGeometry-5fDazGe-.js";import"./Point2D-BslC4Gs9.js";import"./Envelope2D-n2TB2v9l.js";import"./SpatialReference-BzfAMI5E.js";import"./Transformation2D-B6W9saMR.js";import"./SimpleGeometryCursor-BbFgAuic.js";import"./OperatorDefinitions-DoM9xd5U.js";import"./jsonConverter-CYYMdpyx.js";import"./apiConverter-BOyb99jX.js";import"./Distance2DCalculator-CXhBP-8I-DgwBxA-7.js";import"./distanceOperator-DtUZpUXI.js";import"./operatorSimplify-HaL4veBZ.js";import"./simplifyOperator-DqzqfbFt.js";import"./quatf64-eO7UAs9K.js";import{i as Ht}from"./quat-XKFzqP_i.js";import{c as Ut,s as Wt}from"./axisAngleDegrees-GaSk0_KM.js";import"./MeshLocalVertexSpace-Dfv_NBsU.js";import"./MeshTransform-BGwY5MT4.js";import{a as Gt}from"./meshVertexSpaceUtils-CrM2H6JB.js";import"./earcut-CsNwSYFA.js";import"./Indices-DELx3He_.js";import{A as Kt,a as qt,b as Jt,d as Yt,m as Xt,y as Zt}from"./plane--nqwMDYx.js";import{a as Qt,n as L,r as $t,t as R}from"./vectorStacks-BQiry9fn.js";import"./triangulationUtils-DZOlYzLu.js";import"./deduplicate-C8bQBzHi.js";import{n as en}from"./projectPointToVector-D72S8Uh5.js";import{n as tn}from"./computeTranslationToOriginAndRotation-DwwRDWAD.js";import{r as nn,x as rn}from"./BufferView-BPABY7if.js";import{a as an}from"./Util-YNFIi00s.js";import"./spatialReferenceEllipsoidUtils-b6wDfyu0.js";import"./types-DsLx34Br.js";import{n as on}from"./dehydratedPoint-CVzHYxaL.js";import{t as sn}from"./projectVectorToVector-CZxjcyx6.js";import{i as cn}from"./orientedBoundingBox-DQ8LQLAH.js";import{f as ln,h as un,i as dn,l as fn}from"./Emissions.glsl-nadaueeL.js";import"./glsl-B__sVAcg.js";import"./Uniform-CfHWJqSg.js";import"./Float3DrawUniform-UWnIK6YY.js";import"./Float3PassUniform-BIrLVK7_.js";import"./FloatPassUniform-D-_T45xB.js";import"./Texture2DDrawUniform-CV_1kucp.js";import"./Texture2DPassUniform-wY08hxIn.js";import{t as pn}from"./NoParameters-B66z9IwQ.js";import{_ as mn,b as hn,d as gn,f as _n,g as vn,l as yn,m as bn,n as xn,r as Sn,u as Cn,v as wn}from"./elevationInfoUtils-BcUBf70F.js";import{a as z,c as Tn,i as En,l as Dn,o as On,r as kn,s as An}from"./colorUtils-Btp0B-0Y.js";import"./cimSymbolUtils-Dwr_LmxD.js";import{s as jn}from"./utils-BroCumRv.js";import"./GraphicsLayer-CSZ-X1QF.js";import"./ObjectStack-DiVLRoBj.js";import{n as Mn,o as Nn,r as Pn,t as Fn}from"./ray-XqUMyuyU.js";import"./HUDIntersectorResult-BZpY5C1W.js";import"./videoUtils-CDhtaJ_j.js";import"./VertexAttributeLocations-DOYYzMyn.js";import"./VertexElementDescriptor-C9CNG143.js";import"./getDefaultUnitForView-hBFUzhgR.js";import{c as In,d as Ln,i as Rn,n as zn,r as Bn}from"./quantity-DI5We-W2.js";import"./unitFormatUtils-dqVr3yY8.js";import"./quantityFormatUtils-BugvT62a.js";import{a as Vn,i as Hn,r as Un,t as Wn}from"./geodesicUtils-DoIAZh7n.js";import{t as Gn}from"./isSupportedObject-B58JKqS1.js";import{t as Kn}from"./SketchOptions-CQ-6mB9z.js";import{s as qn,t as Jn,v as Yn,y as Xn}from"./LineSnappingHint-C4TfMb_L.js";import{n as Zn}from"./ParallelSnappingHint-V0i1PzO4.js";import"./snappingUtils-BVQZFw4z.js";import"./vec3-D7a6REBc.js";import"./sphere-DkSdrT5o.js";import"./constraints-CZ12pnWC.js";import"./IntersectionSnappingHint-GxnfNu8X.js";import"./RightAngleSnappingHint-DDG9ajUd.js";import{t as Qn}from"./viewUtils-D2qwRYoF.js";import{o as $n,r as er,s as tr}from"./euclideanLengthMeasurementUtils-D4gy5vyI.js";import{a as nr,c as rr,d as ir,i as ar,o as or,s as sr,u as cr}from"./lineSegment-WEn1ku7V.js";import"./triangle-B4dfMIWc.js";import"./createUtils-Ch7ggY8g.js";import{t as lr}from"./SegmentLabels-BWJ_0RkJ.js";import"./PointSnappingHint-BIIZt5I0.js";import{_ as ur,a as dr,b as fr,d as pr,g as mr,h as hr,m as gr,n as _r,t as vr,v as yr,y as br}from"./SnappingContext-Br57Azuv.js";import{C as xr,S as Sr,_ as Cr,b as wr,c as Tr,d as Er,f as Dr,g as Or,h as kr,i as Ar,l as jr,m as Mr,n as Nr,o as Pr,p as Fr,r as Ir,s as Lr,t as Rr,v as zr,w as Br,x as Vr,y as Hr}from"./editPlaneUtils-9oXcgntK.js";import{a as Ur,d as Wr,i as Gr,l as Kr,o as qr,s as Jr,u as Yr}from"./rotate-NWoJmiZJ.js";import"./dehydratedFeatureComparison-DeSHk9xR.js";import"./angularMeasurementUtils-y8pRcFCF.js";import"./ReactiveSet-DfOFugRV.js";import{a as Xr,i as Zr,n as Qr}from"./hydratedFeatures-Cj67oeX-.js";import{t as $r}from"./GraphicManipulator-DOyiRUxg.js";import"./drapedUtils-DHehJLfn.js";import{a as ei,i as ti,n as ni}from"./boundedPlane-BwWy0U6o.js";import"./VertexArrayObject-BCHCoUBc.js";import"./BufferObject-DizvMSTk.js";import{t as ri}from"./VertexBuffer-Dhf7DMaS.js";import"./vec3f32-BWuLbfSR.js";import"./ShaderBuilder-Dbc4jYz7.js";import{a as ii,c as ai,n as oi,r as si,u as ci}from"./renderState-DH1meWdn.js";import"./image-CSnYJraV.js";import{f as li,h as ui,m as di,n as fi,p as pi}from"./frustum-DHXawB8f.js";import{B as mi,D as hi,E as gi,F as _i,L as vi,N as yi,O as bi,P as B,R as xi,T as Si,V as Ci,_ as wi,b as Ti,c as Ei,k as Di,o as Oi,p as ki,t as Ai,u as ji,w as Mi,z as Ni}from"./DefaultBufferWriter-CAVJ0EqM.js";import{_ as V,b as Pi,f as Fi,l as Ii,m as Li,t as Ri,x as zi}from"./ElevationContext-RIB4rYIh.js";import{r as Bi}from"./MaterialUtil-BLN1UlUe.js";import"./Octree-Bwk-xF2H.js";import{a as Vi,c as Hi,l as Ui,p as Wi,s as Gi}from"./SceneLighting-Bd70zCMB.js";import"./ScreenSpacePass.glsl-MQijsFL9.js";import"./Float2BindUniform-COpkFEGz.js";import"./ReadDepth.glsl-DUk8QQwu.js";import{r as Ki,t as qi}from"./Compositing.glsl-JUsSGFFM.js";import{a as Ji,s as Yi}from"./FloatArray-DhcAaYJ8.js";import{c as Xi,d as Zi,f as Qi,h as $i,o as ea,p as ta,r as na,s as ra,u as ia}from"./DefaultLayouts-DnVLEhVX.js";import"./Laserline.glsl-DAk7UF9m.js";import"./Float4BindUniform-DtHi0dnJ.js";import"./CameraSpace.glsl-DZ0WgHSr.js";import"./Texture2DBindUniform-BW-pj6EM.js";import"./Float2PassUniform-gY4yy6pK.js";import"./Float3BindUniform-DnRIK6cJ.js";import"./Float4PassUniform-CYWbrPzx.js";import"./FloatBindUniform-BPgZfINH.js";import{n as aa,t as oa}from"./Laserlines.glsl-QH2C_Me0.js";import"./Matrix4BindUniform-DNS5lGEU.js";import"./Matrix4PassUniform-9Utk6s1j.js";import{t as sa}from"./LaserlinePath.glsl-B2vZQRm0.js";import"./FloatsPassUniform-Dhl7UDF5.js";import"./TextureOnly.glsl-B3pARRXz.js";import"./HighlightCellGridScreenSpacePass.glsl-BKkAmC25.js";import"./IntegerPassUniform-BWtfz08R.js";import"./HighlightDownsample.glsl-CKuf0GsQ.js";import"./HighlightReadBitmap.glsl-yTX333eD.js";import"./Float2DrawUniform-DrsJI05n.js";import"./HighlightApply.glsl-z0sIF5jH.js";import"./HighlightBlur.glsl-CbFN0SVI.js";import"./HighlightToSingle.glsl-NczMiEeh.js";import"./NestedMap-BEhJHzak.js";import"./Slice.glsl-A8bL0Rkn.js";import"./ObjectAndLayerIdColor.glsl-DLOlMhcf.js";import"./VisualVariables.glsl-BbHLNeev.js";import{t as ca}from"./AlphaCutoff-qYsC5qb0.js";import"./ScreenSizePerspective.glsl-BlmhzUp0.js";import"./View.glsl-D5eT11ZQ.js";import"./MarkerSizing.glsl-CtCvR4o9.js";import"./RibbonLine.glsl-B6EO8Ip1.js";import{t as la}from"./ManagedTexture-N0puH7JB.js";import{a as ua,i as da,n as fa,o as pa}from"./sdfPrimitives-CXbCDQbD.js";import"./PiUtils.glsl-D-ndpb0M.js";import"./TerrainDepthTest.glsl-BUpx6Cvv.js";import"./OutputColorHighlightOLID.glsl-B38t8Aex.js";import"./weather-CFcauIFR.js";import"./OverlayCompositing.glsl-BBFwctiS.js";import{D as ma,E as ha,O as ga,S as _a,c as va,d as ya,h as ba,l as xa,p as Sa,v as Ca,x as wa,y as Ta}from"./graphicUtils-D4vcxFBm.js";import"./VerticalOffset.glsl-sMlOSVvR.js";import"./HUDVisibility.glsl-nxRXaAOJ.js";import"./BooleanBindUniform-9cQHW2Mv.js";import"./HUDMaterial.glsl-iXgXHpJs.js";import"./Transform.glsl-DMKMztkJ.js";import"./VertexColor.glsl-D6K20lwp.js";import"./ColorMaterial.glsl-DTJVM4te.js";import{t as Ea}from"./ShadedColorMaterial.glsl-DsKzQjGL.js";import{n as Da,r as Oa,t as ka}from"./SelectedVertexTooltipInfo-B9aSkGLs.js";import{t as Aa}from"./TranslateTooltipInfo-D2gFtbk2.js";import"./TextureBackedBufferLayout-YNJ8l8Rr.js";import{n as ja}from"./SlicePlaneMaterial.glsl-C8rhZAqU.js";import"./RenderCoordsHelper-Bv0MDjbk.js";import{r as Ma}from"./ImageMaterial.glsl-Du_1HWiA.js";import{n as Na,r as Pa,t as Fa}from"./ExtentScaleTooltipInfo-Cm6csr5z.js";var Ia=class extends lr{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:n},r,i=Se()){let{spatialReference:a}=n.data.coordinateHelper;return Qn(r,a,t,e,La),e.state.camera.projectToScreen(La,i),i}getRing(e,t,n,r,i){let a=[];for(let e of t.parts[i].iterateVertices())a.push(r.toXYZ(e.pos,R.get()));if(i===0&&n!=null&&a.push(r.toXYZ(n,R.get())),a.length<2)return a;let o=a[0],s=a[a.length-1];return e.type===`polygon`&&a.length>2&&!He(o,s)&&a.push(o),a}};Ia=k([x(`esri.views.3d.interactive.SegmentLabels3D`)],Ia);var La=D(),Ra=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=2}destroy(){this._destroyResources()}get resources(){return this._resources?.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){this._renderGroup=e;let t=this._resources?.layerView;t&&(t.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?this._resources!=null&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources??this._createResources():this._destroyResources()}_createResources(){this._destroyResources();let e=this._resourceFactory.createResources(),t=new za({view:this._resourceFactory.view,renderGroup:this._renderGroup}),n=this._resourceFactory.view.overlayManager;this._resources={layerView:t,external:e,geometriesAdded:!1},n&&(this._resources.drapeSourceRenderer=n.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){if(this._resources==null)return;this._ensureRenderGeometriesRemoved();let e=this._resourceFactory.view.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){this._resources?.drapeSourceRenderer!=null&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){this._resources?.drapeSourceRenderer!=null&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,1),this._resources.geometriesAdded=!0))}},za=class extends ue(Re){constructor(e){super(e),this.drapeSourceType=1,this.updatePolicy=1,this.renderGroup=2}};k([d({constructOnly:!0})],za.prototype,`view`,void 0),k([d({readOnly:!0})],za.prototype,`drapeSourceType`,void 0),k([d()],za.prototype,`renderGroup`,void 0),za=k([x(`esri.views.3d.interactive.visualElements.DrapedVisualElementResources`)],za);var Ba=class{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this.forEachMaterial(t=>t?.setParameters({isDecoration:e}))}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=A(()=>e.view.ready,e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())})}applyProperties(e){let t=!1;for(let n in e)n in this&&(n===`attached`?t=!!e[n]:this[n]=e[n]);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view.stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}},Va=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return this._resources==null?null:this._resources.object}get resources(){return this._resources==null?null:this._resources.external}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();let e=this._resourceFactory.view.stage;if(this._resources==null||!e)return;let t=this._resources.object;t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer)}forEachMaterial(e){this._resources&&this._resourceFactory.forEachMaterial(this._resources.external,e)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();let e=this._resourceFactory,t=e.view,n=t.stage;if(!n)return;let r=new Pi(n,{pickable:!1,updatePolicy:1}),i=new zi({castShadow:!1}),a=e.createResources(i,r);r.add(i);let o=e.cameraChanged,s=o?A(()=>t.state.camera,e=>o(e),O):null;this._resources={layer:r,object:i,external:a,cameraHandle:s},this._syncVisible()}_destroyResources(){this._resources!=null&&(this._resources.layer.destroy(),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null)}_syncVisible(){this._resources!=null&&(this._resources.object.visible=this._visible)}},Ha=class extends Ba{constructor(e){super(e),this._isDraped=!1,this.object3dResources=new Va(this.createObject3DResourceFactory(e.view)),this.drapedResources=new Ra(this.createDrapedResourceFactory(e.view)),this.isDraped=e.isDraped??!1}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}forEachMaterial(e){this.object3dResources?.forEachMaterial(e),this.drapedResources?.forEachMaterial(e)}},Ua=class extends Vi{constructor(){super(...arguments),this.shader=new Gi(qi,()=>a(()=>import(`./Compositing.glsl-Cx07Mq3K.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])))}initializePipeline(e){let{blitMode:t,blendEmissive:n}=e;switch(t){case 0:case 3:return oi({colorWrite:ii,drawBuffers:Ci(0,n)});case 1:return oi({blending:ci,colorWrite:ii,drawBuffers:Ci(0,n)});default:return oi({blending:ai,colorWrite:ii,drawBuffers:Ci(0,n)})}}};Ua=k([x(`esri.views.3d.webgl-engine.shaders.CompositingTechnique`)],Ua);var Wa=class extends yi{constructor(){super(...arguments),this.blitMode=0,this.blendEmissive=!1,this.hasOpacityFactor=!1}};k([B({count:4})],Wa.prototype,`blitMode`,void 0),k([B()],Wa.prototype,`blendEmissive`,void 0),k([B()],Wa.prototype,`hasOpacityFactor`,void 0);var Ga=class{constructor(e,t=0){this._techniques=e,this._parameters=new Ki,this._configuration=new Wa,this._configuration.blitMode=t,e.precompile(Ua,this._configuration),this._configuration.hasOpacityFactor=!0,e.precompile(Ua,this._configuration),this._configuration.hasOpacityFactor=!1}blit(e,t,n,r){this.blitTexture(e,t.getTexture(),n,r)}blitTexture(e,t,n,r){e.bindFramebuffer(n.fbo),e.setClearColor(0,0,0,1),e.clear(16384),this._parameters.texture=t;let i=this._techniques.get(Ua,this._configuration);e.bindTechnique(i,r,this._parameters),e.screen.draw()}blend(e,t,n,r,i=1){this._configuration.hasOpacityFactor=i<1;let a=this._techniques.get(Ua,this._configuration);return!!a.compiled&&(e.bindFramebuffer(n.fbo),this._parameters.texture=t.getTexture(),this._parameters.opacity=i,e.bindTechnique(a,r,this._parameters),e.screen.draw(),!0)}},Ka=class{constructor(e){this._renderCoordsHelper=e,this._origin=D(),this._dirty=!1,this._count=0}set vertices(e){let t=le(3*e.length),n=0;for(let r of e)t[n++]=r[0],t[n++]=r[1],t[n++]=r[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){let e=this._buffers[0],t=3*Math.floor(e.length/3/2);S(this._origin,e[t],e[t+1],e[t+2])}else S(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){let t=this._ensureVAO(e);t!=null&&(e.bindVAO(t),e.drawArrays(ie.TRIANGLES,0,this._count))}dispose(){this._vao!=null&&this._vao.dispose()}get _layout(){return this._renderCoordsHelper.viewingMode===1?Xa:Za}_ensureVAO(e){return this._buffers==null?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){let n=this._createDataBuffer(t);return this._dirty=!1,new $i(e,new ri(e,Yi(this._layout),n))}_ensureVertexData(e,t){if(!this._dirty)return;let n=this._createDataBuffer(t);e.buffer()?.setData(n),this._dirty=!1}_createDataBuffer(e){let t=e.reduce((e,t)=>e+qa(t),0);this._count=t;let n=this._layout.createBuffer(t),r=this._origin,i=0,a=0,o=`startUp`in n?this._setUpVectors.bind(this,n):void 0;for(let t of e){for(let e=0;e<t.length;e+=3){let s=S(Ya,t[e],t[e+1],t[e+2]);e===0?a=this._renderCoordsHelper.getAltitude(s):this._renderCoordsHelper.setAltitude(s,a);let c=i+2*e;o?.(e,c,t,s);let l=I(Ya,s,r);if(e<t.length-3){for(let e=0;e<6;e++)n.start.setVec(c+e,l);n.extrude.setValues(c,0,-1),n.extrude.setValues(c+1,1,-1),n.extrude.setValues(c+2,1,1),n.extrude.setValues(c+3,0,-1),n.extrude.setValues(c+4,1,1),n.extrude.setValues(c+5,0,1)}if(e>0)for(let e=-6;e<0;e++)n.end.setVec(c+e,l)}i+=qa(t)}return n.buffer}_setUpVectors(e,t,n,r,i){let a=this._renderCoordsHelper.worldUpAtPosition(i,Ja);if(t<r.length-3)for(let t=0;t<6;t++)e.startUp.setVec(n+t,a);if(t>0)for(let t=-6;t<0;t++)e.endUp.setVec(n+t,a)}};function qa(e){return 3*(2*(e.length/3-1))}var Ja=D(),Ya=D(),Xa=Ji().vec3f(`start`).vec3f(`end`).vec2f(`extrude`).vec3f(`startUp`).vec3f(`endUp`),Za=Ji().vec3f(`start`).vec3f(`end`).vec2f(`extrude`),Qa=class extends pn{constructor(){super(...arguments),this.innerColor=N(1,1,1),this.innerWidth=1,this.glowColor=N(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=Je(6),this.pointDistanceOrigin=D(),this.pointDistanceTarget=D(),this.lineVerticalPlaneSegment=ir(),this.intersectsLineSegment=ir(),this.intersectsLineRadius=3,this.heightManifoldTarget=D(),this.lineStartWorld=D(),this.lineEndWorld=D()}},$a=class extends Vi{constructor(){super(...arguments),this.shader=new Gi(aa,()=>a(()=>import(`./Laserlines.glsl-CNf-71Rp.js`),__vite__mapDeps([13,14,5,6,15,16,17,18,19,20,4,7,8,3,21,22,23,9,24,10,2,25,26,27,28,12])))}};$a=k([x(`esri.views.3d.webgl-engine.effects.laserlines.LaserlineTechnique`)],$a);var eo=class extends Qa{constructor(){super(...arguments),this.origin=D()}},to=class extends Vi{constructor(e,t){super(e,t,no),this.shader=new Gi(sa,()=>a(()=>import(`./LaserlinePath.glsl-CrCbRRXF.js`),__vite__mapDeps([29,30,5,6,20,4,7,8,3,21,22,23,9,24,10,28,31,32,12])))}};to=k([x(`esri.views.3d.webgl-engine.effects.laserlines.LaserlinePathTechnique`)],to);var no=new Map([[`start`,0],[`end`,1],[`extrude`,2],[`startUp`,3],[`endUp`,4]]),ro=class extends yi{constructor(){super(...arguments),this.contrastControlEnabled=!1,this.spherical=!1}};k([B()],ro.prototype,`contrastControlEnabled`,void 0),k([B()],ro.prototype,`spherical`,void 0);var io=class extends ro{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1}};k([B()],io.prototype,`heightManifoldEnabled`,void 0),k([B()],io.prototype,`pointDistanceEnabled`,void 0),k([B()],io.prototype,`lineVerticalPlaneEnabled`,void 0),k([B()],io.prototype,`intersectsLineEnabled`,void 0);var ao=class extends Hi{constructor(e){super(e),this.isDecoration=!0,this.produces=Ui.LASERLINES,this.consumes={required:[Ui.LASERLINES,`normals`]},this.requireGeometryDepth=!0,this._configuration=new io,this._pathTechniqueConfiguration=new ro,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._passParameters=new eo;let t=e.view.stage.renderView.techniques,n=new ro;n.contrastControlEnabled=e.contrastControlEnabled,t.precompile(to,n)}initialize(){this._passParameters.renderCoordsHelper=this.view.renderCoordsHelper,this._pathTechniqueConfiguration.spherical=this.view.state.viewingMode===1,this._pathTechniqueConfiguration.contrastControlEnabled=this.contrastControlEnabled,this._techniques.precompile(to,this._pathTechniqueConfiguration),this._blit=new Ga(this._techniques,2)}destroy(){this._pathVerticalPlaneData=Ye(this._pathVerticalPlaneData),this._blit=null}get _techniques(){return this.view.stage.renderView.techniques}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this.requestRender(1))}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){y(this._passParameters.heightManifoldTarget,e),this.requestRender(1)}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this.requestRender(1))}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){y(this._passParameters.pointDistanceTarget,e),this.requestRender(1)}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){y(this._passParameters.pointDistanceOrigin,e),this.requestRender(1)}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this.requestRender(1))}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){cr(e,this._passParameters.lineVerticalPlaneSegment),this.requestRender(1)}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this.requestRender(1))}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){cr(e,this._passParameters.intersectsLineSegment),this.requestRender(1)}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this.requestRender(1))}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,this._pathVerticalPlaneData!=null&&this.requestRender(1))}set pathVerticalPlaneVertices(e){this._pathVerticalPlaneData??=new Ka(this._passParameters.renderCoordsHelper),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this.requestRender(1)}set pathVerticalPlaneBuffers(e){this._pathVerticalPlaneData??=new Ka(this._passParameters.renderCoordsHelper),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this.requestRender(1)}setParameters(e){Bi(this._passParameters,e)&&this.requestRender(1)}precompile(){this._acquireTechnique()}render(e){let t=e.find(({name:e})=>e===this.produces);if(this.isDecoration&&!this.bindParameters.decorations||this._blit==null)return t;let n=this.renderingContext,r=e.find(({name:e})=>e===`normals`);this._passParameters.normals=r?.getTexture();let i=()=>{(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(),this.pathVerticalPlaneEnabled&&this._renderPath()};if(!this.contrastControlEnabled)return n.bindFramebuffer(t.fbo),i(),t;this._passParameters.colors=t.getTexture();let a=this.fboCache.acquire(t.fbo.width,t.fbo.height,`laser lines`);return n.bindFramebuffer(a.fbo),n.setClearColor(0,0,0,0),n.clear(16640),i(),n.unbindTexture(t.getTexture()),this._blit.blend(n,a,t,this.bindParameters)||this.requestRender(1),a.release(),t}_acquireTechnique(){return this._configuration.heightManifoldEnabled=this.heightManifoldEnabled,this._configuration.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._configuration.pointDistanceEnabled=this.pointDistanceEnabled,this._configuration.intersectsLineEnabled=this.intersectsLineEnabled,this._configuration.contrastControlEnabled=this.contrastControlEnabled,this._configuration.spherical=this.view.state.viewingMode===1,this._techniques.get($a,this._configuration)}_renderUnified(){if(!this._updatePassParameters())return;let e=this._acquireTechnique();if(e.compiled){let t=this.renderingContext;t.bindTechnique(e,this.bindParameters,this._passParameters),t.screen.draw()}else this.requestRender(1)}_renderPath(){if(this._pathVerticalPlaneData==null)return;let e=this._techniques.get(to,this._pathTechniqueConfiguration);if(e.compiled){let t=this.renderingContext;this._passParameters.origin=this._pathVerticalPlaneData.origin,t.bindTechnique(e,this.bindParameters,this._passParameters),this._pathVerticalPlaneData.draw(t)}else this.requestRender(1)}_updatePassParameters(){if(!this._intersectsLineEnabled)return!0;let e=this.bindParameters.camera,t=this._passParameters;if(this._intersectsLineInfinite){if(ui(Pn(t.intersectsLineSegment.origin,t.intersectsLineSegment.vector),oo),oo.c0=-Number.MAX_VALUE,!fi(e.frustum,oo))return!1;pi(oo,t.lineStartWorld),di(oo,t.lineEndWorld)}else y(t.lineStartWorld,t.intersectsLineSegment.origin),b(t.lineEndWorld,t.intersectsLineSegment.origin,t.intersectsLineSegment.vector);return!0}get test(){}};k([d({constructOnly:!0})],ao.prototype,`contrastControlEnabled`,void 0),k([d()],ao.prototype,`isDecoration`,void 0),k([d()],ao.prototype,`produces`,void 0),k([d()],ao.prototype,`consumes`,void 0),ao=k([x(`esri.views.3d.webgl-engine.effects.laserlines.LaserLineRenderer`)],ao);var oo=li(),so=class extends Ba{constructor(e){super(e),this._angleCutoff=oa,this._style={},this._heightManifoldTarget=D(),this._heightManifoldEnabled=!1,this._intersectsLine=ir(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){e==null?this._heightManifoldEnabled=!1:(y(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0),this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(e==null)return void(this.intersectsLine=null);let t=this.view.renderCoordsHelper.worldUpAtPosition(e,co);this.intersectsLine=ar(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){e==null?this._intersectsLineEnabled=!1:(cr(e,this._intersectsLine),this._intersectsLineEnabled=!0),this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=e==null?null:cr(e),this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=e==null?null:{origin:qe(e.origin),target:e.target?qe(e.target):null},this._syncPointDistance(),this._syncRenderer()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._renderer&&(this._renderer.isDecoration=e)}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||this._pointDistanceLine!=null||this._pathVerticalPlaneBuffers!=null)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){this._renderer??(this._renderer=new ao({view:this.view,contrastControlEnabled:!0,isDecoration:this.isDecoration}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff())}_syncStyle(){this._renderer!=null&&this._renderer.setParameters(this._style)}_syncAngleCutoff(){this._renderer?.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){this._renderer!=null&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){this._renderer!=null&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){this._renderer!=null&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){this._renderer!=null&&(this._renderer.pathVerticalPlaneEnabled=this._pathVerticalPlaneBuffers!=null&&this.visible,this._pathVerticalPlaneBuffers!=null&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){this._renderer!=null&&(this._renderer.lineVerticalPlaneEnabled=this._lineVerticalPlaneSegment!=null&&this.visible,this._lineVerticalPlaneSegment!=null&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(this._renderer==null)return;let e=this._pointDistanceLine,t=e!=null;this._renderer.pointDistanceEnabled=t&&e.target!=null&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,e.target!=null&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){this._renderer!=null&&this.view.stage&&(this._renderer.destroy(),this._renderer=null)}forEachMaterial(){}},co=D(),lo=class extends Ha{constructor(e){super(e),this._ray=Mn(),this._isWorldDown=!1,this._start=D(),this._end=N(1,0,0),this._width=1,this._color=be(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=be(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=0,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=4,this._fadedExtensions=_o,this._laserline=new so({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:uo,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry(),forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:uo,recreateGeometry:e=>this._recreateDrapedGeometry(e),forEachMaterial:(e,t)=>t(e.material)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,y(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),I(this._end,e,this._end),Fn(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,mt(this._start,e)||(y(this._start,e),Fn(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,mt(this._end,e)||(y(this._end,e),Fn(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){ut(e,this._color)||(ht(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){ut(e,this._innerColor)||(ht(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){let t=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e!=null&&this._stippleOffColor!=null&&ut(e,this._stippleOffColor)||(this._stippleOffColor=e==null?null:Ke(e),this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&this._laserlineStyle!=null&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===8?4:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=e??_o,this.recreateGeometry()}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){let t=new V(this.materialParameters,this.view.state.isGlobal),n=[];return this._createObject3DGeometry(t,e,n),{material:t,geometries:n}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){let r=this._createGeometry(e);n.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){let e=new V(this.materialParameters,this.view.state.isGlobal);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){let t=this._createGeometry(e);return this._updateVerticesDraped(t),new Qi(t)}_createGeometry(e){let t=this.extensionType===3,n=t?[D(),D(),D(),D()]:[D(),D()];return Sa(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===3?this._updateLineSegmentFinite(ho):this._updateLineSegmentInfinite(this._extensionType,ho)}_updateLineSegmentFinite(e){return or(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){let n=this.view.state.camera;switch(ui(this._ray,fo),e){case 0:fo.c0=-Number.MAX_VALUE;break;case 1:case 2:{let e=this._ray.origin,t=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,`ground`)??0,n=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&n<t&&ne(fo.ray.direction,fo.ray.direction),this._extensionType===2&&t!=null&&(fo.c1=Math.abs(n-t));break}}if(!fi(n.frustum,fo))return this._updateLineSegmentFinite(t);let r=pi(fo,po),i=di(fo,mo);return or(r,i,t)}_updateVertexAttributesObject3D(e,t){let n=e.geometries[0].getMutableAttribute(`position`)?.data;if(!n)return;let r=0;for(let e of this._lineVertices(t))n[r++]=e[0],n[r++]=e[1],n[r++]=e[2];e.geometryVertexAttributeUpdated(e.geometries[0],`position`)}_updateVertexAttributesDraped(e,t){let n=e.getMutableAttribute(`position`)?.data;if(!n)return;let r=0;for(let e of this._lineVertices(t))n[r++]=e[0],n[r++]=e[1],n[r++]=-2;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===3?(yield rr(e,-this.fadedExtensions.start,po),yield rr(e,0,po),yield rr(e,1,po),yield rr(e,1+this.fadedExtensions.end,po)):(yield rr(e,0,po),yield rr(e,1,po))}};function uo(e){e.geometries=[]}var fo=li(),po=D(),mo=D(),ho=ir(),go=1/3,_o={start:go,end:go},vo=class extends Ha{constructor(e){super(e),this._location=D(),this._direction=N(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=be(1,0,1,1),this._renderOccluded=4,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:xo,recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry(),forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:So,recreateGeometry:e=>this._recreateDrapedGeometry(e),forEachMaterial:(e,t)=>t(e.material)}}get location(){return this._location}set location(e){mt(this._location,e)||(y(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){mt(this._direction,e)||(y(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){M(this._direction,I(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){ut(e,this._color)||(ht(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}_createObject3DResources(e){let t=new V(this.materialParameters,this.view.state.isGlobal),n=[];return this._createObject3DGeometry(t,e,n),{material:t,geometries:n}}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,n){let[r,i]=yo(e);t.addGeometry(r),t.addGeometry(i),n.push(r),n.push(i),this._updateVerticesObject3D(t)}_createDrapedResources(){let e=new V(this.materialParameters,this.view.state.isGlobal),t=A(()=>this.view.state.contentPixelRatio,()=>this.drapedResources.recreateGeometry());return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){let t=yo(e);return this._updateVerticesDraped(t),t.map(e=>new Qi(e))}_updateMaterial(){let{materialParameters:e}=this;this.object3dResources.resources?.material.setParameters(e),this.drapedResources.resources?.material.setParameters(e)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{let e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){let t=this.view.state.camera;t.projectToScreen(this.location,Do),b(Co,this.location,this.direction),t.projectToScreen(Co,Oo),pe(Oo,Le(Oo,Oo,Do)),this._updateVertexAttributesObject3D(t,e,0,Do,Oo,1),this._updateVertexAttributesObject3D(t,e,1,Do,Oo,-1)}_updateVertexAttributesObject3D(e,t,n,r,i,a){let o=t.geometries[n],s=o.getMutableAttribute(`position`)?.data;if(!s)return;let{start:c,end:l}=bo(i,r,a,this.offset,this.width,this.length);e.unprojectFromScreen(Me(c),Co),s[0]=Co[0],s[1]=Co[1],s[2]=Co[2],e.unprojectFromScreen(Me(l),Co),s[3]=Co[0],s[4]=Co[1],s[5]=Co[2],t.geometryVertexAttributeUpdated(o,`position`)}_updateVerticesDraped(e){let{view:{overlayManager:t,state:{contentPixelRatio:n}}}=this,{location:r,width:i,length:a,offset:o}=this,s=ko;s.spatialReference=t.spatialReference,s.x=r[0],s.y=r[1];let c=this.view.overlayPixelSizeInMapUnits(s)*n,l=i*c,u=a*c,d=o*c;this._updateVertexAttributesDraped(e[0],l,u,d,-1),this._updateVertexAttributesDraped(e[1],l,u,d,1)}_updateVertexAttributesDraped(e,t,n,r,i){let a=e.getMutableAttribute(`position`)?.data;if(!a)return;let{location:o,direction:s}=this,{start:c,end:l}=bo(s,o,i,r,t,n);a[0]=c[0],a[1]=c[1],a[2]=-2,a[3]=l[0],a[4]=l[1],a[5]=-2,e.invalidateBoundingInfo()}};function yo(e){return[Sa(e,[D(),D()]),Sa(e,[D(),D()])]}function bo(e,t,n,r,i,a){let o=It(wo,l(wo,e[1]*n,e[0]*-n),r+i/2),s=f(To,f(To,f(To,t,It(To,e,a/2)),o),o);return{start:s,end:f(Eo,s,It(Eo,e,-a))}}function xo(e){e.geometries.length=0}function So(e){e.pixelRatioHandle.remove(),e.geometries=[]}var Co=D(),wo=fe(),To=fe(),Eo=fe(),Do=Se(),Oo=Se(),ko=on(0,0,void 0,null),Ao=class extends Ba{constructor(e){super(e),this._resources=null,this._transform=C()}get object(){return this._resources==null?null:this._resources.object}get transform(){return this._transform}set transform(e){Te(this._transform,e),this._resources!=null&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(this._resources==null)return;let e=this._resources.object;e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible}createResources(){this.destroyResources();let e=this.view.stage;if(!e)return;let t=new Pi(e,{pickable:!1,updatePolicy:1}),n=new zi({castShadow:!1});n.transformation=this._transform,this.createExternalResources(),this.createGeometries(n),t.add(n),n.visible=this.visible,this._resources={layer:t,object:n}}destroyResources(){let e=this.view.stage;this._resources!=null&&e&&(this._resources.layer.destroy(),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){this._resources!=null&&(this._resources.object.visible=e)}},jo=class extends Ao{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=be(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive=`square`,this._outlineSize=1,this._outlineColor=be(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){let t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){ut(e,this._color)||(ht(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){ut(e,this._outlineColor)||(ht(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material?.setParameters(this._materialParameters)}_updateSizeAttribute(){let e=this.object;if(e==null)return;let t=e.geometries[0];if(t==null)return;let n=t.getMutableAttribute(`size`).data,r=this._geometrySize;n[0]=r,n[1]=r,e.geometryVertexAttributeUpdated(e.geometries[0],`size`)}get _materialParameters(){return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:ua(this._primitive),distanceFieldBoundingBox:pa,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:this._texture?.id,polygonOffset:!1,shaderPolygonOffset:0,drawAsLabel:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/da}createExternalResources(){this._texture=fa(this._primitive,this._preferredTextureSize),this._material=new xa(this._materialParameters,this.view.state.viewingMode===1);let e=this.view.stage;this._texture.load(e.renderView.renderingContext),e.addTexture(this._texture)}destroyExternalResources(){this._texture&&=(this.view.stage.removeTexture(this._texture),this._texture.dispose(),null),this._material=null}createGeometries(e){let t=this._createRenderGeometry();t!=null&&e.addGeometry(t)}forEachMaterial(e){e(this._material)}get _preferredTextureSize(){return Ge(2*this._geometrySize,16,128)}calculateMapBounds(e){let t=this.object?.geometries[0];if(!t)return!1;let n=t.attributes.get(`position`).data;return sn(n,this.view.renderCoordsHelper.spatialReference,Mo,this.view.spatialReference),ft(e,Mo),!0}_createRenderGeometry(){let{geometry:e,_material:t}=this;if(e==null||t==null)return null;let{renderCoordsHelper:n,elevationProvider:r}=this.view,i=Fi(e,r,Ri.fromElevationInfo(this.elevationInfo),n),a=S(R.get(),e.x,e.y,i),o=R.get();sn(a,e.spatialReference,o,n.spatialReference);let s=this._geometrySize;return ba(t,{position:o,size:[s,s],centerOffsetAndDistance:[0,0,0,1]})}},Mo=D(),No=class extends Ha{constructor(e){super(e),this._maxSize=0,this._position=D(),this._up=D(),this._right=D(),this._renderOccluded=4,this._color=be(1,0,0,1),this._outlineColor=be(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=16,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D(),forEachMaterial:(e,t)=>{t(e.outlineMaterial),t(e.quadMaterial)}}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:Po,forEachMaterial:(e,t)=>{t(e.outlineMaterial),t(e.quadMaterial)}}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateOutlineMaterial(),this._updateQuadMaterial()}get color(){return this._color}set color(e){ht(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){ht(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){let t=this._outlineSize===0!=(e===0);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:n}){this._maxSize=Math.min(ot(t,e),ot(t,n))/3,M(this._up,I(this._up,e,t)),M(this._right,I(this._right,n,t)),y(this._position,t),this.recreateGeometry()}_createObject3DResources(e){let t=new ia(this._quadMaterialParameters),n=this._outlineSize===0?void 0:new V(this._outlineMaterialParameters,this.view.state.isGlobal);return this._createObject3DGeometries(e,t,n),{quadMaterial:t,outlineMaterial:n}}_createObject3DGeometries(e,t,n){if(mt(this._up,$e)&&mt(this._right,$e))return;let r=this._createGeometries(t,n);for(let t of r)e.addGeometry(t);this._updateTransformObject3D(e)}_createDrapedResources(){let e=new ia(this._quadMaterialParameters),t=this._outlineSize===0?void 0:new V(this._outlineMaterialParameters,this.view.state.isGlobal),n=this._createGeometries(e,t).map(e=>new Qi(e));return this._setTransformDraped(n),{quadMaterial:e,outlineMaterial:t,geometries:n,pixelRatioHandle:A(()=>this.view.state.contentPixelRatio,()=>this.drapedResources.recreateGeometry())}}_createGeometries(e,t){let{up:n,right:r,corner:i}=this._getVertices(),a=Fo(n,r,i,e);return t?[a,Sa(t,[n,i,r])]:[a]}_getVertices(){let e=this._up,t=this._right,n=b(R.get(),e,t);return this.isDraped&&(e=y(R.get(),e),t=y(R.get(),t),e[2]=0,t[2]=0,n[2]=0),{up:e,right:t,corner:n}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(e=this.object3dResources.object){if(!e)return;let t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,n);Oe(Io,this._position),nt(Io,Io,[r,r,r]),e.transformation=Io}_setTransformDraped(e){if(e.length===0)return;let{view:{overlayManager:t,state:{contentPixelRatio:n}}}=this,{_position:r,_size:i}=this,a=y(R.get(),r);a[2]=-2;let o=Lo;o.spatialReference=t.spatialReference,o.x=a[0],o.y=a[1];let s=i*(this.view.overlayPixelSizeInMapUnits(o)*n),c=Math.min(this._maxSize,s);Oe(Io,a),nt(Io,Io,[c,c,1]);for(let t of e)t.transformation=Io}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){this.object3dResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters),this.drapedResources.resources?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){this.object3dResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters),this.drapedResources.resources?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}};function Po(e){e.pixelRatioHandle.remove(),e.geometries=[]}function Fo(e,t,n,r){return new Di(r,[[`position`,new cn([0,0,0,...t,...e,...n],[0,1,2,1,2,3],3,!0)]])}var Io=C(),Lo=on(0,0,void 0,null),Ro=class extends fr{sortUniqueHints(e){return e.sort((e,t)=>(t instanceof Jn?t.length:0)-(e instanceof Jn?e.length:0))}visualizeIntersectionPoint(e,t){let{spatialReference:n,view:r}=t,i=zo(t);return w(new jo({view:r,primitive:`circle`,geometry:Xn(e.intersectionPoint,n),elevationInfo:e.isDraped?xn:bn,size:20,outlineSize:2,color:i.intersectionPointColor,outlineColor:i.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){let{view:n,spatialReference:r}=t,i=zo(t),a=Bo(e.point,e.domain,t);return w(new jo({view:n,primitive:`circle`,geometry:Xn(a,r),elevationInfo:Vo(e),size:20,outlineSize:2,color:i.pointColor,outlineColor:i.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){let{view:n,spatialReference:r}=t,i=zo(t),a=Bo(e.lineStart,e.domain,t),o=Bo(e.lineEnd,e.domain,t);return w(Ho(e.type,a,o,r,Vo(e),n,i,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){let{view:n,spatialReference:r}=t,i=zo(t),{isDraped:a}=e,o=Vo(e),s=Bo(e.lineStart,e.domain,t),c=Bo(e.lineEnd,e.domain,t),l=Uo(s,r,o,n,a),u=Uo(c,r,o,n,a),d=Dt(u,l,u,.5),f=new vo({view:n,attached:!1,offset:Zn.parallelLineHintOffset,length:Zn.parallelLineHintLength,width:Zn.parallelLineHintWidth,color:i.parallelSignColor,location:d,renderOccluded:a?4:16,isDraped:a,renderGroup:3,isDecoration:!0});return f.setDirectionFromPoints(l,d),f.attached=!0,w(f)}visualizeRightAngleQuad(e,t){let{view:n,spatialReference:r}=t,i=zo(t),a=Vo(e),{isDraped:o}=e,s=Bo(e.previousVertex,e.domain,t),c=Bo(e.centerVertex,e.domain,t),l=Bo(e.nextVertex,e.domain,t),u=Uo(s,r,a,n,o),d=Uo(c,r,a,n,o),f=Uo(l,r,a,n,o);return w(new No({view:n,attached:!0,color:o?i.rightAngleColorDraped:i.rightAngleColor,renderOccluded:o?4:2,outlineRenderOccluded:o?4:16,outlineColor:i.rightAngleOutlineColor,outlineSize:Zn.rightAngleHintOutlineSize,size:Zn.rightAngleHintSize,isDraped:o,geometry:{previous:u,center:d,next:f},renderGroup:3,isDecoration:!0}))}};function zo(e){let{effectiveTheme:t}=e.view,n=j.toUnitRGBA(t.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:n,pointColor:r,pointOutlineColor:n,lineColor:n,lineOutlineColor:void 0,parallelSignColor:n,rightAngleColor:n,rightAngleColorDraped:j.toUnitRGBA(kn(t.accentColor,.5)),rightAngleOutlineColor:n}}function Bo(e,t,{selfSnappingZ:n,view:r,spatialReference:i}){return 2&t&&Yn(e)&&n!=null?qn(e,n,r,i):e}function Vo(e){return e.isDraped?xn:bn}function Ho(e,t,n,r,i,a,o,s=!1,c=!0,l=!0){let u=Uo(t,r,i,a,s),d=Uo(n,r,i,a,s),f=new lo({view:a,extensionType:3,start:u,end:d,isDraped:s,color:o.lineColor,renderOccluded:s?4:16,renderGroup:3,isDecoration:!0});switch(e){case 0:f.width=Zn.lineHintWidthTarget,f.fadedExtensions={start:0,end:Zn.lineHintFadedExtensions};break;case 2:f.width=Zn.lineHintWidthReference,f.fadedExtensions={start:0,end:0};break;case 1:f.width=Zn.lineHintWidthReference,f.fadedExtensions={start:c?Zn.lineHintFadedExtensions:0,end:l?Zn.lineHintFadedExtensions:0}}return f.attached=!0,f}function Uo(e,t,n,r,i){let a=D();if(i){let n=r.overlayManager.spatialReference;sn(e,t,a,n)}else Qn(e,t,n,r,a);return a}function Wo(e){let t=e.graphic;return t?[A(()=>`visible`in e?e.visible:e.displaying,e=>{e&&t.notifyMeshTransformChanged({action:0})},{...Et}),T(()=>t.notifyMeshTransformChanged({action:1}))]:[]}var Go=.3;function Ko(e,t){t&&Object.assign(e,t)}var qo=class{constructor(e){this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=16,this.color=e.accent}},Jo=class{constructor({colors:e,...t}){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=e.accent,this.outlineColor=e.outline,this.renderOccluded=16,this.hoverOutlineColor=e.selectedOutline,Ko(this,t)}applyColor(e){this._apply(this.color,e)}applyOutline(e){this._apply(this.outlineColor,e)}applyHoverOutline(e){this._apply(this.hoverOutlineColor,e)}_apply(e,t){t.setParameters({color:z(e),renderOccluded:this.renderOccluded})}},Yo=class{constructor({colors:e,...t}){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.renderOccluded=2,this.minSquaredEdgeLength=900,this.color=kn(e.accent,.5),this.hoverColor=e.accent,Ko(this,t)}applyColor(e){this._apply(this.color,e)}applyHover(e){this._apply(this.hoverColor,e)}_apply(e,t){t.setParameters({color:z(e),renderOccluded:this.renderOccluded})}},Xo=class{constructor(e){this.vertex=new Jo({colors:e,color:e.accent,outlineColor:e.outline}),this.edge=new Jo({colors:e,color:En(kn(e.accent,2/3),.5),outlineColor:kn(e.outline,.5),size:8,collisionPadding:8}),this.selected=new Jo({colors:e,color:e.selected,outlineColor:e.outline}),this.edgeOffset=new Yo({colors:e})}},Zo=class{constructor({colors:e,...t}){this.width=1.5,this.stipplePattern=Xi(3.3),this.falloff=0,this.innerWidth=1.5,this.renderOccluded=4,this.color=e.selected,this.stippleOffColor=e.outline,this.innerColor=e.selected,Ko(this,t)}apply(e){e.color=z(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=z(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=z(this.innerColor),e.renderOccluded=this.renderOccluded}},Qo=class{constructor({colors:e,...t}){this.size=4,this.outlineSize=1,this.shape=`square`,this.color=e.selected,this.outlineColor=e.outline,Ko(this,t)}apply(e){e.color=z(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=z(this.outlineColor),e.primitive=this.shape}},$o=class{constructor({colors:e,...t}){this.innerWidth=1,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Go,this.globalAlphaContrastBoost=1.5,this.radius=3,this.innerColor=e.selected,this.glowColor=e.accent,this.heightFillColor=e.accent,Ko(this,t)}apply(e,t=1){let n={glowColor:j.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:j.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t*this.glowColor.a,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};`style`in e?e.style=n:e.laserlineStyle=n}},es=class{constructor(e){this.outline=new Zo({colors:e,color:e.stippleOff,renderOccluded:8,stippleOffColor:e.stippleOn,innerWidth:0}),this.staged=new Zo({colors:e,color:e.stippleOn,renderOccluded:8,innerColor:e.stagedSolid,stippleOffColor:e.stippleOff}),this.shadowStyle=new $o({colors:e,globalAlpha:Go,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1})}},ts=class{constructor(e){this.outline=new Qo({colors:e,color:e.selected,outlineColor:e.outline,outlineSize:1,shape:`circle`,size:4}),this.shadowStyle=new $o({colors:e,globalAlpha:Go,glowColor:e.accent,glowFalloff:1.5,glowWidth:6,innerColor:e.selected,innerWidth:1,radius:2})}},ns=class extends Zo{constructor({colors:e,...t}){super({colors:e}),this.extensionType=2,Ko(this,t)}},rs=class{constructor(e){this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,this.lineObjects=new es(e),this.pointObjects=new ts(e),this.heightPlane=new $o({colors:e,globalAlpha:Go,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:1}),this.heightBox=new $o({colors:e,globalAlpha:Go,glowColor:e.accent,glowFalloff:8,glowWidth:8,innerColor:e.selected,innerWidth:0,heightFillColor:e.accent}),this.zVerticalLine=new ns({colors:e,color:kn(e.accent,5*Go/3),falloff:2,innerColor:kn(e.selected,0),renderOccluded:4,stipplePattern:null,width:5,extensionType:2})}},H=class extends Re{constructor(e){super(e)}get colors(){let e=this.getTheme().accentColor,t=e.a;return{accent:e,contrast:On(e),selected:j.fromArray([255,255,255,t]),selectedOutline:j.fromArray([255,255,255,t]),staged:j.fromArray([12,207,255,t]),stagedSolid:j.fromArray([12,207,255,1]),outline:j.fromArray([0,0,0,.5*t]),stippleOn:j.fromArray([255,255,255,1]),stippleOff:j.fromArray([0,0,0,.5])}}get visualElements(){return new rs(this.colors)}get manipulators(){return new Xo(this.colors)}get zManipulator(){return new qo(this.colors)}};k([d()],H.prototype,`colors`,null),k([d()],H.prototype,`visualElements`,null),k([d()],H.prototype,`manipulators`,null),k([d()],H.prototype,`zManipulator`,null),k([d()],H.prototype,`getTheme`,void 0),H=k([x(`esri.views.3d.interactive.editingTools.settings`)],H);var os=class extends Ha{constructor(e){super(e),this._attachmentOrigin=on(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new gt,this._geometry=null,this._width=1,this._color=be(1,0,1,1),this._innerWidth=0,this._innerColor=be(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=8,this._attachmentOrigin.spatialReference=e.view.spatialReference,this._laserline=new so({view:e.view,isDecoration:e.isDecoration}),this.applyProperties(e),this.attached=e.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:ss,recreateGeometry:(e,t)=>{e.geometries.length=0,this._recreateGeometry(t,e.material,e.geometries)},forEachMaterial:(e,t)=>t(e.material)}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:ss,recreateGeometry:e=>{e.geometries=this._createRenderGeometriesDraped(e.material),this._attachmentOriginChanged()},forEachMaterial:(e,t)=>t(e.material)}}get _laserlineAttached(){return this.attached&&this.visible&&this._laserlineStyle!=null&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(e){this._laserline.attached=this._laserlineAttached,e&&this._attachmentOriginChanged()}get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e,this._updateMaterial()}get geometry(){return this._geometry}set geometry(e){let t=this._isClosed;this._geometry=e,this.recreateGeometry(),t!==this._isClosed&&this._updateMaterial()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){ut(e,this._color)||(ht(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){ut(e,this._innerColor)||(ht(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){let t=e!=null!=(this._stipplePattern!=null);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&ut(e,this._stippleOffColor)||(this._stippleOffColor=e?Ke(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,e!=null&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;let e=this.object3dResources.resources?.geometries;if(!e||e.length===0)return null;S(ls,0,0,0);let t=0;for(let n of e)n.computeAttachmentOrigin(cs)&&(b(ls,ls,cs),t++);return t===0?null:(u(ls,ls,1/t),this.view.renderCoordsHelper.fromRenderCoords(ls,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){this.object3dResources.resources?.material.setParameters(this._materialParameters),this.drapedResources.resources?.material.setParameters(this._materialParameters)}get _isClosed(){return this.geometry!=null&&this.geometry.type===`polygon`}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:`round`,hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===8?4:this._renderOccluded}_recreateGeometry(e,t,n){this._createRenderGeometries(t,n);for(let t of n)e.addGeometry(t);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit(`attachment-origin-changed`)}_createObject3DResources(e){let t=new V(this._materialParameters,this.view.state.isGlobal),n=[];return this._recreateGeometry(e,t,n),{material:t,geometries:n}}_createDrapedResources(){let e=new V(this._materialParameters,this.view.state.isGlobal);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){let{geometry:t,view:n}=this,r=n.basemapTerrain.spatialReference;return t==null||r==null?[]:ea(t,r).lines.map(({position:t})=>{let i={overlayInfo:{spatialReference:r,renderCoordsHelper:n.renderCoordsHelper},attributeData:{position:t},removeDuplicateStartEnd:this._isClosed};return new Qi(ga(e,i))})}calculateMapBounds(e){if(this.object3dResources.resources==null)return!1;let t=this.view.renderCoordsHelper;for(let n of this.object3dResources.resources.geometries){let r=n.attributes.get(`position`),i=le(r.data.length);ee(r.data,t.spatialReference,0,i,this.view.spatialReference,0),ft(e,i)}return!0}_createRenderGeometries(e,t){let n=this.geometry;if(n==null)return;let r=ra(n,this.view.elevationProvider,this.view.renderCoordsHelper,Ri.fromElevationInfo(this.elevationInfo??new zt({mode:vn(n,null)}))),i=[];for(let{position:n,mapPositions:a}of r.lines){let r={mapPositions:a,attributeData:{position:n},removeDuplicateStartEnd:this._isClosed};t.push(ga(e,r)),i.push(n)}this._laserline.pathVerticalPlane=i}};function ss(e){e.geometries=[]}var cs=D(),ls=D();function us(e,t,n,r,i){let a=le(3*e.length),o=le(a.length);e.forEach((e,t)=>{a[3*t]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0});let s=Ii(a,t,0,o,0,a,0,a.length/3,n,r,i),c=s!=null;return{numVertices:e.length,position:a,mapPositions:o,projectionSuccess:c,sampledElevation:s}}var ds=class extends Vi{constructor(e,t){super(e,t,fs(t).locations),this.shader=new Gi(Ea,()=>a(()=>import(`./ShadedColorMaterial.glsl-BlWmM5Tv.js`),__vite__mapDeps([33,34,5,6,35,7,8,28,3,11,36,37,38,39,24,40,4,41,26,31,23,27,9,42,43,44,10,12])))}initializePipeline(e){let{oitPass:t,hasEmission:n,output:r,transparent:i,cullFace:a,shadingEnabled:o}=e,s=t===0,c=t===2;return oi({blending:fn(r)&&i?xi(t):null,culling:si(a),depthTest:{func:c?513:o?515:513},depthWrite:mi(e),drawBuffers:Ci(t,n),colorWrite:ii,polygonOffset:s||c?null:vi})}};function fs(e){let t=Ji().vec3f(`position`).vec3f(`normal`);return e.screenSizeEnabled&&t.vec3f(`offset`),t}ds=k([x(`esri.views.3d.webgl-engine.shaders.ShadedColorMaterialTechnique`)],ds);var ps=class extends bi{constructor(){super(...arguments),this.cullFace=0,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.textureCoordinateType=0,this.emissionSource=0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.draped=!1,this.overlayEnabled=!1,this.snowCover=!1}get discardInvisibleFragments(){return this.transparent}};k([B({count:3})],ps.prototype,`cullFace`,void 0),k([B()],ps.prototype,`transparent`,void 0),k([B()],ps.prototype,`writeDepth`,void 0),k([B()],ps.prototype,`screenSizeEnabled`,void 0),k([B()],ps.prototype,`shadingEnabled`,void 0),k([B()],ps.prototype,`terrainDepthTest`,void 0),k([B()],ps.prototype,`cullAboveTerrain`,void 0);var ms=class extends gi{constructor(e){super(e,gs),this._configuration=new ps,this.supportsEdges=!0,this._pp0=N(0,0,1),this._pp1=N(0,0,0),this.produces=new Map([[2,e=>e===8||ln(e)&&!this.parameters.transparent],[4,e=>ln(e)&&this.parameters.transparent&&this.parameters.writeDepth],[9,e=>ln(e)&&this.parameters.transparent&&!this.parameters.writeDepth]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest&&fn(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}get visible(){return this.parameters.color[3]>=ca}intersect(e,t,n,r,i,a){this._intersect(e,n,r,i,a)}intersectDraped(e,t,n,r){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this._intersect(e,t,this._pp0,this._pp1,r)}_intersect(e,t,n,r,i){if(this.parameters.screenSizeEnabled){let a=e.attributes.get(`offset`);Oi(e,t,n,r,{applyToVertex:(e,n,r,i)=>{let o=S(vs,a.data[3*i],a.data[3*i+1],a.data[3*i+2]),s=S(ys,e,n,r);return u(o,o,this.parameters.screenSizeScale*(t.camera?.computeScreenPixelSizeAt(o)??1)),b(s,s,o),[s[0],s[1],s[2]]},applyToAabb:e=>{let n=Ee(e,vs);return Ve(e,this.parameters.screenSizeScale*(t.camera?.computeScreenPixelSizeAt(n)??1))}},i)}else Oi(e,t,n,r,void 0,i)}createGLMaterial(e){return new hs(e)}createBufferWriter(){return new _s(fs(this.parameters))}},hs=class extends dn{beginSlot(e){return this.getTechnique(ds,e)}},gs=class extends hi{constructor(){super(...arguments),this.color=be(1,1,1,1),this.shadingTint=be(0,0,0,.25),this.shadingDirection=M(D(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.screenSizeEnabled=!1,this.shadingEnabled=!0}get transparent(){return this.color[3]<1||this.forceTransparentMode}},_s=class{constructor(e){this.layout=e}elementCount(e){return e.get(`position`).indices.length}write(e,t,n,r,i,a){let o=wi(n,r,this.layout,e,t,i,a),s=i.getField(`offset`,rn);if(s&&n.has(`offset`)){let e=n.get(`offset`);an(e.size===3),Si(e,t,s,a)}return o}},vs=D(),ys=D(),bs=class extends Ao{constructor(e){super(e),this.view=null,this._renderOccluded=4,this._vertices=null,this._spatialReference=null,this._color=At([1,127/255,0,1]),this._size=11,this._outlineColor=At([0,0,0,.5]),this._outlineSize=1,this._elevationInfo=null,this.applyProperties(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){ut(e,this._color)||(ht(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){ut(e,this._outlineColor)||(ht(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,screenSizeScale:this.size,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){let e=this.vertices;if(e==null||e.length===0)return[];let t=us(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,Ri.fromElevationInfo(this.elevationInfo)),n=[],r=t.numVertices,i=t.position;for(let e=0;e<r;++e){let t=S(xs,i[3*e],i[3*e+1],i[3*e+2]),r=Ss(this._vertexMaterial,.5,t),a=Ss(this._vertexOutlineMaterial,.5,t);n.push({vertexGeometry:r,vertexOutlineGeometry:a})}return n}createGeometries(e){let t=this._createRenderGeometries();for(let{vertexGeometry:n,vertexOutlineGeometry:r}of t)e.addGeometry(n),e.addGeometry(r)}createExternalResources(){this._vertexMaterial=new ms({...this._vertexMaterialParameters,writeDepth:!0,cullFace:2,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new ms({...this._vertexOutlineMaterialParameters,forceTransparentMode:!0,writeDepth:!0,cullFace:1,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}},xs=D();function Ss(e,t,n){return wa(e,t,16,16,{offset:n})}var Cs=class extends Sr{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this._settings=new H({getTheme:()=>this.view.effectiveTheme}),this.geometryType=null,this.type=`draw-3d`}initialize(){let{mode:e,offset:t,unit:n,featureExpressionInfo:r}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new zt({mode:e,offset:t,unit:n,featureExpressionInfo:r})}normalizeCtorArgs(e){if(!e.elevationInfo){let t=e.hasZ??!0;return{...e,elevationInfo:_n(t)}}return e}initializeGraphic(e){let{view:t}=this,n=this._createGraphicState=new Oa({graphic:e});return E([t.maskOccludee(e),t.trackGraphicState(n),A(()=>({element:this._outlineVisualElement,isDraped:n.isDraped}),({element:e,isDraped:t})=>{e&&(e.isDraped=t)},Et),Nt(()=>{Wr(this.tooltipInfos.mesh,this.geometryToPlace)}),this._setupLoadingIndicator(n),...Wo(n)])}makeDrawOperation(){let{geometryType:e}=this,t=e!==`circle`&&e!==`rectangle`;return new Lr({view:this.view,manipulators:this.manipulators,geometryType:xr(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Pr(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Ar(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Ro,segmentLabels:t?new Ia:null,labelOptions:this.sketchOptions.labels,isDraped:this._createGraphicState?this._createGraphicState.isDraped:mn(this.hasZ,this.elevationInfo)===`on-the-ground`,cursor:this.cursor,constraintsEnabled:!0,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils})}onActiveVertexChanged(e){let{view:t}=this;if(this._activeVertexVisualElement)return this._activeVertexVisualElement.vertices=[e],this._activeVertexVisualElement.recreate(),this._updateVerticalLineVisualElement(e),T();let n=this._settings,r=n.manipulators.vertex,i=new bs({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,size:r.size,outlineSize:r.outlineSize,renderOccluded:r.renderOccluded,attached:!1,isDecoration:!0});this._activeVertexVisualElement=i;let a=n.visualElements.zVerticalLine,o=new lo({view:t,extensionType:a.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4,isDecoration:!0});this._verticalLineVisualElement=o;let s=E([A(()=>n.visualElements.zVerticalLine,e=>e.apply(o),O),A(()=>({selectedColor:z(n.colors.selected),outlineColor:z(n.manipulators.vertex.outlineColor)}),({selectedColor:e,outlineColor:t})=>{i.color=e,i.outlineColor=t},O),T(()=>{this._activeVertexVisualElement=P(this._activeVertexVisualElement),this._verticalLineVisualElement=P(this._verticalLineVisualElement)})]);return i.attached=!0,this._updateVerticalLineVisualElement(e),s}_updateVerticalLineVisualElement(e){let t=this._verticalLineVisualElement;if(!t)return;let{renderCoordsHelper:n,elevationProvider:r}=this.view;S(Ts,e[0],e[1],e[2]),ws.setFromElevationInfo(this.elevationInfo),Ts[2]=Fi(Ts,r,ws,n),n.toRenderCoords(Ts,this.view.spatialReference,Ts)?(t.setStartEndFromWorldDownAtLocation(Ts),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(this._outlineVisualElement)return this._outlineVisualElement.geometry=e,T();let t=this.internalGraphicsLayer.elevationInfo,{view:n}=this,r=this._settings,i=new os({view:n,geometry:e,elevationInfo:t,isDraped:this._createGraphicState?this._createGraphicState.isDraped:mn(this.hasZ,t)===`on-the-ground`,attached:!1,isDecoration:!0});this._outlineVisualElement=i;let a=E([A(()=>r.visualElements.lineObjects.outline,e=>e.apply(i),O),A(()=>r.visualElements.lineObjects.shadowStyle,e=>e.apply(i),O),T(()=>{this._outlineVisualElement=P(this._outlineVisualElement)})]);return i.attached=!0,i.laserlineEnabled=!0,a}onRegularVerticesChanged(e){if(this._verticesVisualElement)return this._verticesVisualElement.vertices=e,T();let{view:t}=this,n=this._settings,r=n.manipulators.vertex,i=new bs({view:t,spatialReference:t.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,size:r.size,outlineSize:r.outlineSize,renderOccluded:r.renderOccluded,attached:!1,isDecoration:!0}),a=E([A(()=>({color:z(n.manipulators.vertex.color),outlineColor:z(n.manipulators.vertex.outlineColor)}),({color:e,outlineColor:t})=>{i.color=e,i.outlineColor=t},O),T(()=>{this._verticesVisualElement=P(this._verticesVisualElement)})]);return i.attached=!0,this._verticesVisualElement=i,a}updateGraphicGeometry(e){if(this.geometryType===`mesh`&&e?.type===`point`){let t=this.geometryToPlace;t?.centerAt(e),Wr(this.tooltipInfos.mesh,t);let n=this._graphic;t&&n.geometry===t||(n.geometry=t);return}super.updateGraphicGeometry(e)}_setupLoadingIndicator(e){let{drawOperation:n}=this;if(!this.geometryToPlace||e.displaying)return n.loading=!1,null;n.loading=!0;let r=T(()=>{n.loading=!1}),i,a=()=>{i&&cancelAnimationFrame(i)};return E([t(()=>e.displaying,()=>{a(),i=requestAnimationFrame(()=>r.remove())},{...Et,once:!0}),T(a),r])}};k([d({constructOnly:!0})],Cs.prototype,`elevationInfo`,void 0),k([d({constructOnly:!0})],Cs.prototype,`geometryType`,void 0),k([d()],Cs.prototype,`type`,void 0),k([d({constructOnly:!0})],Cs.prototype,`view`,void 0),Cs=k([x(`esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D`)],Cs);var ws=new Ri,Ts=D();function Es(e){let t=Ds(e);return _(Math.cos(t),Math.sin(t))}function Ds(e){if(e==null||e.type!==`polyline`&&e.type!==`polygon`)return 0;let t=e.type===`polyline`?e.paths:e.rings,n=ce();for(let e of t)for(let t=0;t<e.length-1;t++){let r=e[t],i=e[t+1],a=r[0]-i[0],o=r[1]-i[1];if(a*a+o*o>n)return Math.atan2(i[1]-r[1],i[0]-r[0])}return 0}function U(e){return e?.operations?.data.geometry}function Os(e,t){return ks(e?.data.coordinateHelper.hasZ(),t)}function ks(e,t){return!!e&&t.mode!==`on-the-ground`&&!Cn(t)}function As(e,t,n){function r(){let e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let i=!1;function a(e){i||=(i=!0,e(),!1)}function o({activeTooltipInfo:n,sketchOptions:r,scaleRotateTransform:i}){a(()=>{n&&(n.sketchOptions=r,Ns(n,t),Fs(n,i)),e.info=n})}return E([A(r,o,Et),A(()=>{let e=r(),{activeTooltipInfo:n}=e;if(n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:U(t)}},(e,n)=>{e&&n&&n.key!==e.key&&a(()=>js(t,e.context))},Fe),t.on(`committed`,()=>{queueMicrotask(()=>o(r()))}),Ur(e,{onBeforePaste:()=>{i=!0},onAfterPaste:()=>{js(t,r()),i=!1}})])}function js(e,{activeTooltipInfo:t,callbacks:n}){if(!t)return;n.onBeforeUpdate();let r=U(e);switch(r?.type){case`mesh`:Ms(t,r.origin,e,n),`orientation`in t&&`scale`in t&&Wr(t,r,n);break;case`point`:Ms(t,r,e,n)}}function Ms(e,t,n,r){let{dx:i,dy:a,dz:o}=qr(e,t);i===0&&a===0&&o===0||(r.onMoveStart(),n.operations?.move(i,a,o,0),r.onMove(i,a,o),r.onMoveStop())}function Ns(e,t){let n=U(t),r=n?.type;if(!e||!n||r!==`mesh`&&r!==`point`)return;let i=r===`mesh`,a=i?n.origin:n;e.setLocationFromPoint(a),Ps(e,a,t),e.type===`transform-mesh`&&i&&Yr(e,n),e.clearInputValues()}function Ps(e,t,n){e.elevation.actual=$n(t),e.elevation.visible=!!n.operations?.data.coordinateHelper.hasZ(),e.elevation.readOnly=!1,e.elevation.showAsZ=!0}function Fs(e,t){if(e?.type!==`transform-point`)return;if(!t)return e.orientation.actual=void 0,e.size.actual=void 0,e.orientation.visible=!1,void(e.size.visible=!1);let n=t.mode,{size:r,orientationClockwise:i}=t.adapter,{visualVariables:a}=e.sketchOptions.tooltips,o=a?.rotation,s=i!=null&&(n==null||n===`rotate`);e.orientation.actual=s?Bn(i,`radians`,`geographic`):void 0,e.orientation.precision=Is(o?.valueType),e.orientation.visible=s;let c=a?.size,l=r!=null&&(n==null||n===`scale`);e.size.actual=l?zn(r,c?.unit??`meters`):void 0,e.size.precision=Is(c?.valueType),e.size.visible=l}function Is(e){switch(e){case`integer`:case`long`:return 0;default:return null}}function Ls(e,t,r=Mn()){return Rs(e,n(t),r),M(r.direction,r.direction),r}function Rs(e,t,n){return zs(e,e.screenToRender(t,Tt(R.get())),n)}function zs(e,t,n){if(t==null)return null;let r=Tt(m(R.get(),t));if(r[2]=0,!e.unprojectFromRenderScreen(r,n.origin))return null;let i=Tt(m(R.get(),t));i[2]=1;let a=e.unprojectFromRenderScreen(i,R.get());return a==null?null:(I(n.direction,a,n.origin),n)}var W=class{constructor(e){this.metadata=void 0,this._camera=new Wi,this._elevation={offset:0,override:null},this.collisionType={type:`point`},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=C(),this._worldFrame=null,this._renderLocation=D(),this._renderLocationDirty=!0,this._location=new bt({x:0,y:0,z:0}),this._elevationAlignedLocation=new bt,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=0,this._focused=!1,this.events=new gt,this._screenLocation={screenPointArray:Se(),renderScreenPointArray:pt(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);let t=this.view.state?.camera;t&&this._camera.copyFrom(t)}destroy(){this._applyObjectTransform=nc,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?.stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),T(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){Bs(e)&&(this._screenLocationDirty=!0),Te(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||=C(),Vs(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&=null),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){Xr(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit(`location-update`,{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){Xr(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit(`location-update`,{location:this._location})}_updateElevationAlignedLocation(){let e=this._elevation.override==null?this.location.z||0:this._elevation.override;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=Qr(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit(`select-changed`,{action:e?`select`:`deselect`}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit(`focus-changed`,{action:!0===e?`focus`:`unfocus`}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if(Bs(this._modelTransform)){let t=this._calculateModelTransformOffset(ec);e=b(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;let r=n(e,Hs),i=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case`point`:if(Qe(this.screenLocation.screenPointArray,r)<i*i)return this.screenLocation.renderScreenPointArray[2]+a;break;case`line`:{let e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,qs),o=i*this.screenLocation.pixelSize,s=Rs(this._camera,r,Ws);if(s==null)return null;for(let t of e){if(t.length===0)continue;let e=ze(Ys,t[0],n);for(let r=1;r<t.length;r++){let i=ze(Xs,t[r],n),c=nr(or(e,i,Us),s);if(c!=null&&c<o*o){let t=b(R.get(),e,i);u(t,t,.5);let n=kt(R.get());if(this._camera.projectToRenderScreen(t,n))return n[2]+a}y(e,i)}}break}case`disc`:{let e=this.collisionType.direction,t=this.collisionType.offset??$e,n=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(n,qs),s=i*this.screenLocation.pixelSize,c=Rs(this._camera,r,Ws);if(c==null)return null;let l=Vt(Gs,o),u=Mt(Qs,e,l),d=ze($s,t,o);Xt(d,u,Js);let f=Zs;if(qt(Js,c,f)&&ve(f,d)<s*s)return this.screenLocation.renderScreenPointArray[2]+a;break}case`ribbon`:{let{paths:e,direction:t}=this.collisionType,n=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(n,qs),s=i*this._camera.computeScreenPixelSizeAt(this.renderLocation),c=Rs(this._camera,r,Ws);if(c==null)return null;let l=Vt(Gs,o),d=Mt(Qs,t,l),f=this._calculateModelTransformPosition($s);Xt(f,d,Js);let p=Zs;if(!qt(Js,c,p))break;for(let t of e){if(t.length===0)continue;let e=ze(Ys,t[0],o);for(let n=1;n<t.length;n++){let r=ze(Xs,t[n],o),i=sr(or(e,r,Us),p);if(i!=null&&i<s*s){let t=b(R.get(),e,r);u(t,t,.5);let n=kt(R.get());if(this._camera.projectToRenderScreen(t,n))return n[2]+a}y(e,r)}}break}default:jt(this.collisionType)}return null}attach(e={manipulator3D:{}}){let t=this._stage;if(!t)return;let n=e.manipulator3D;n.engineLayerId==null?(this._engineLayer=new Pi(t,{pickable:!1,updatePolicy:1}),n.engineLayerId=this._engineLayer.id):t?.getLayer&&(this._engineLayer=t.getLayer(n.engineLayerId)),n.engineLayerReferences=(n.engineLayerReferences||0)+1,this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),me(this._location.spatialReference,this.view.spatialReference)||(this.location=new bt({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){let t=e.manipulator3D;t.engineLayerReferences--;let n=t.engineLayerReferences===0;this._removeResourcesFromStage(),n&&(t.engineLayerId=null,P(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){_e(this.location,tc,e.spatialReference)&&dt(e.extent,tc)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if(this.elevationInfo==null)return;let e=null,t=0,n=gn(this.elevationInfo,this.location.spatialReference??this.view.elevationProvider.spatialReference);switch(this.elevationInfo.mode){case`on-the-ground`:e=Li(this.view.elevationProvider,this.location,`ground`)??0;break;case`relative-to-ground`:t=(Li(this.view.elevationProvider,this.location,`ground`)??0)+n;break;case`relative-to-scene`:t=(Li(this.view.elevationProvider,this.location,`scene`)??0)+n;break;case`absolute-height`:t=n}(t!==this._elevation.offset||e!==this._elevation.override)&&(this._elevation.offset=t,this._elevation.override=e)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();let e=this._getWorldToScreenObjectScale(),t=qs;if(!0===this.autoScaleRenderObjects){let n=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(n,t)}else this._calculateObjectTransform(e,t);let{objectsByState:n}=this._ensureEngineResources(),r=(this.focused?2:1)|(this.selected?8:4),i=this._noDisplayCount>0;for(let{stateMask:e,objects:a}of n){if(i){for(let e of a)e.visible=!1;continue}let n=!(15&e)||(r&e)===(15&e),o=!(65520&e)||(this.state&e)===(65520&e);if(n&&o)for(let e of a)e.visible=!0,e.transformation=t;else for(let e of a)e.visible=!1}}_ensureEngineResources(){if(this._engineResources==null){let e=this._engineLayer,t=[],n=new Set;this.renderObjects.forEach(({geometry:{material:e}})=>{n.has(e)||(t.push(e),n.add(e))});let r=new Map;this._renderObjects.forEach(e=>{let t=new zi({castShadow:!1,geometries:[e.geometry]}),n=r.get(e.stateMask)||[];n.push(t),r.set(e.stateMask,n)});let i=[];r.forEach((e,t)=>i.push({stateMask:t,objects:e})),this._engineResources={objectsByState:i,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){let e=this._stage;if(this._engineResourcesAddedToStage||this._engineResources==null||!e)return;let{objectsByState:t,layer:n}=this._engineResources;t.forEach(({objects:e})=>n.addMany(e)),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){let e=this._stage;if(!this._engineResourcesAddedToStage||this._engineResources==null||!e)return;let{objectsByState:t,layer:n}=this._engineResources;t.forEach(({objects:e})=>n.removeMany(e)),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e===`touch`?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){let t=this._getWorldToScreenObjectScale(),n=this._calculateObjectTransform(t,Ks);return S(e,n[12],n[13],n[14])}_calculateModelTransformOffset(e){let t=this._calculateModelTransformPosition(e);return I(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return te(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&he(t,t,this._worldFrame),he(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,this._applyObjectTransform!=null&&this._applyObjectTransform(t),t}get test(){}};function Bs(e){return e[12]!==0||e[13]!==0||e[14]!==0}function Vs(e,t,n){switch(e.viewingMode){case`local`:return Bt(n),!0;case`global`:{let r=wt(e.renderCoordsHelper.spatialReference);return se(t,0,Ys,0,r.radius),tn(Je(Ys[0]),Je(Ys[1]),n),!0}}}var Hs=Se(),Us=ir(),Ws=Mn(),Gs=g(),Ks=C(),qs=C(),Js=Zt(),Ys=D(),Xs=D(),Zs=D(),Qs=D(),$s=D(),ec=D(),tc=new bt({x:0,y:0,z:0,spatialReference:null}),nc=()=>{},rc=class{constructor(){this.grabbingState=0,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=0,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((e,t)=>{if(t===0&&(this.zManipulator=e),e instanceof W&&(e.selected&&(this.numSelected===0&&(this.firstSelected=e),this.numSelected++),this.firstGrabbedXY==null&&e.grabbing&&t===1&&(this.firstGrabbedXY=e)),e.grabbing)switch(this.grabbingState|=1,t){case 0:this.grabbingState|=2;break;case 1:this.grabbingState|=4}})}};function ic(e){let{object:t}=e,n=ac(e),r=[n,oc(e,n.visualElement)];return t.maskOccludee&&r.push(t.maskOccludee()),{visualElement:n.visualElement,remove:()=>oe(r)}}function ac(e){let{view:t,object:n}=e,r=U(n),i=new os({view:t,geometry:lc(r)?r:null,elevationInfo:n.elevationInfo,attached:!1,isDecoration:!0}),a=new H({getTheme:()=>t.effectiveTheme}),o=()=>{i.attached=n.visible},s=E([A(()=>a.visualElements.lineObjects.outline,e=>e.apply(i),O),A(()=>a.visualElements.lineObjects.shadowStyle,e=>e.apply(i),O),A(()=>n.visible,o),A(()=>n.isDraped,e=>{i.isDraped=e},O),n.on(`committed`,()=>{let e=U(n);i.geometry=lc(e)?e:null}),w(i)]);return o(),{visualElement:i,remove:()=>s.remove()}}function oc(e,t){let{object:n,view:r}=e,i=[],a=n.elevationInfo,o=a.mode===`on-the-ground`||!a.offset&&a.mode!==`absolute-height`,s=new rc,c=new H({getTheme:()=>r.effectiveTheme}),l=c.visualElements,u=new lo({view:r,extensionType:l.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4,isDecoration:!0}),d=Je(l.heightPlaneAngleCutoff),f=new so({view:r,attached:!1,angleCutoff:d,isDecoration:!0}),p=St(1);i.push(A(()=>({lineShadowStyle:c.visualElements.lineObjects.shadowStyle,pointShadowStyle:c.visualElements.pointObjects.shadowStyle,alpha:p.value}),({lineShadowStyle:e,pointShadowStyle:n,alpha:r})=>{e.apply(t,r),n.apply(u,r)},O));let m=St(1);i.push(A(()=>({heightPlane:c.visualElements.heightPlane,alpha:m.value}),({heightPlane:e,alpha:t})=>e.apply(f,t),O));let h=()=>{s.update(e);let r=U(n);if(!n.visible||o&&(n.isDraped||!lc(r)||!r.hasZ))return t.laserlineEnabled=!1,u.attached=!1,void(f.attached=!1);t.laserlineEnabled=!0,p.value=4&s.grabbingState?l.laserlineAlphaMultiplier:1,m.value=2&s.grabbingState?l.laserlineAlphaMultiplier:1,sc(u,s),cc(e,t,f,s)};i.push(A(()=>c.visualElements.zVerticalLine,e=>e.apply(u),O)),i.push(n.on(`committed`,h),A(()=>n.visible,h),t.events.on(`attachment-origin-changed`,h),w(u),w(f));let g=[],_=()=>{oe(g),g.length=0,e.forEachManipulator(e=>g.push(e.events.on(`grab-changed`,h))),e.forEachManipulator(e=>g.push(e.events.on(`select-changed`,h))),h()};return _(),i.push(e.onManipulatorsChanged(_),Pe(()=>E(g))),E(i)}function sc(e,t){let n=t.numSelected===1?t.firstSelected:t.numSelected>1&&t.firstGrabbedXY!=null?t.firstGrabbedXY:null;n==null?e.attached=!1:(e.setStartEndFromWorldDownAtLocation(n.renderLocation),e.attached=!0)}function cc(e,t,n,r){if(r.numSelected>0){S(uc,0,0,0);let t=0;e.forEachManipulator((e,n)=>{n===1&&e.selected&&e instanceof W&&(b(uc,uc,e.renderLocation),t++)}),t>0?(n.heightManifoldTarget=u(uc,uc,1/t),n.attached=!0):n.attached=!1}else{let r=t.attachmentOrigin;r!=null&&e.view.renderCoordsHelper.toRenderCoords(r,uc)?(n.heightManifoldTarget=uc,n.attached=!0):n.attached=!1}}function lc(e){return e!=null&&(e.type===`polygon`||e.type===`polyline`)}var uc=D();function dc(e){let t=[],n=pc(e,t);return fc(e,t,n),{visualElement:n,remove:()=>oe(t)}}function fc(e,t,n){let{view:r,object:i}=e,a=new H({getTheme:()=>r.effectiveTheme}),o=new lo({view:r,extensionType:a.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4,isDecoration:!0});t.push(A(()=>a.visualElements.zVerticalLine,e=>e.apply(o),O));let s=new so({view:r,intersectsLineInfinite:!0,attached:!1,isDecoration:!0}),c=Je(a.visualElements.heightPlaneAngleCutoff),l=new so({view:r,attached:!1,angleCutoff:c,isDecoration:!0}),u=i.elevationInfo,d=Ri.fromElevationInfo(u),f=u.mode===`on-the-ground`||!u.offset&&u.mode!==`absolute-height`,p=new rc,m=St(1);t.push(A(()=>({heightPlane:a.visualElements.heightPlane,alpha:m.value}),({heightPlane:e,alpha:t})=>e.apply(l,t),O));let h=St(1);t.push(A(()=>({shadowStyle:a.visualElements.pointObjects.shadowStyle,alpha:h.value}),({shadowStyle:e,alpha:t})=>e.apply(s,t),O));let g=()=>{p.update(e);let t=mc(U(i)),c=f&&(i.isDraped||t==null||!t.hasZ),u=!0;if(c||t==null)u=!1;else{wn(i.elevationInfo)&&(t=t.clone(),t.z=0);let e=Fi(t,r.elevationProvider,d,r.renderCoordsHelper);S(vc,t.x,t.y,e),sn(vc,t.spatialReference,vc,r.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(vc),s.intersectsWorldUpAtLocation=vc}m.value=2&p.grabbingState?a.visualElements.laserlineAlphaMultiplier:1;let g=at(yc);!c&&i.visible&&n.calculateMapBounds(g)&&sn(Ue(g,vc),r.spatialReference,vc,r.renderCoordsHelper.spatialReference)?(l.heightManifoldTarget=vc,l.attached=!0):l.attached=!1,h.value=4&p.grabbingState?a.visualElements.laserlineAlphaMultiplier:1;let _=u&&i.visible&&!c;s.attached=_,o.attached=_};t.push(A(()=>[i.visible,i.isDraped],g),i.on(`committed`,g)),e.forEachManipulator(e=>{t.push(e.events.on(`grab-changed`,g))}),t.push(w(s)),t.push(w(o)),t.push(w(l)),g()}function pc(e,t){let{view:n,object:r}=e,i=new jo({view:n,geometry:mc(U(r)),elevationInfo:r.elevationInfo,isDecoration:!0});return hc(e,i,t),t.push(w(i)),i}function mc(e){return e==null?null:e.type===`point`?e:e.type===`mesh`?e.origin.clone():null}function hc(e,t,n){let{view:r,object:i}=e,a=()=>{t.attached=i.visible},o=new H({getTheme:()=>r.effectiveTheme});gc(e,t,n),o.visualElements.pointObjects.outline.apply(t),n.push(A(()=>i.visible,a,O))}function gc(e,t,n){let{view:r,object:i}=e,a=null,o=e=>{a!=null&&(a.remove(),a=null),i.isDraped&&e!=null&&(a=_c(r,e,()=>{t.geometry=e}))},s=()=>{let e=mc(U(i));e!=null&&wn(i.elevationInfo)&&(e.z=0),o(e),t.geometry=e};n.push(i.on(`committed`,s),Pe(()=>a)),s()}function _c(e,t,n){let r=e.elevationProvider.spatialReference;en(t,vc,r);let i=vc[0],a=vc[1];return e.elevationProvider.on(`elevation-change`,e=>{we(e.extent,i,a)&&n()})}var vc=D(),yc=Be();function bc(e){switch(U(e.object)?.type){case`point`:case`mesh`:return dc(e);case`polygon`:case`polyline`:return ic(e);default:return null}}var xc=.02,Sc=47,Cc=.5,wc=5*Math.PI/12,Tc=1*Math.PI/3,Ec=.2,Dc=.3,Oc=class{constructor(){this._available=!0}set location(e){this._forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this._forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this._forEachManipulator3D(t=>t.elevationInfo=e)}get renderLocation(){let e;return this._forEachManipulator3D(t=>{e||=t.renderLocation}),e}set renderLocation(e){this._forEachManipulator3D(t=>t.renderLocation=e)}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D(t=>t.available=e)}get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}get selected(){return this.someManipulator(e=>e.selected)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(n=>{!t&&e(n)&&(t=!0)}),t}_forEachManipulator3D(e){this.forEachManipulator((t,n)=>{t instanceof W&&e(t,n)})}},kc=class extends Oc{constructor(){super(...arguments),this._interactive=!0}get interactive(){return this._interactive}set interactive(e){this._interactive!==e&&(this._interactive=e),this._updateManipulatorInteractivity()}_updateManipulatorInteractivity(){let e=!this.grabbing&&this._interactive;this.forEachManipulator(t=>{t.interactive=e||t.grabbing})}},G=class{constructor(e,t=0){this.geometry=e,this.stateMask=t}};function Ac(e,t){return Mc(e,()=>t)}function jc(e){return Mc(e,e=>e.plane)}function Mc(e,t){let r=D(),i=D(),a=!1;return o=>{let s=t(o);if(o.action===`start`){let t=n(o.screenStart,Me(Qt.get())),i=Rs(e.state.camera,t,Hc);i!=null&&(a=qt(s,i,r))}if(!a)return null;let c=n(o.screenEnd,Me(Qt.get())),l=Rs(e.state.camera,c,Hc);return l==null?null:qt(s,l,i)?{...o,renderStart:r,renderEnd:i,plane:s,ray:l}:null}}function Nc(e,t,n=0,r=null,i=null){let a=null;return o=>{if(o.action===`start`&&(a=e.sceneIntersectionHelper.intersectElevationFromScreen(Se(o.screenStart.x,o.screenStart.y),t,n,i),a!=null&&r!=null&&!_e(a,a,r))||a==null)return null;let s=e.sceneIntersectionHelper.intersectElevationFromScreen(Se(o.screenEnd.x,o.screenEnd.y),t,n,i);return s!=null&&(r==null||_e(s,s,r))?{...o,mapStart:a,mapEnd:s}:null}}function Pc(e,t,n,r=null,i=null){return Nc(e,n,hn(t,e,n),r,i)}function Fc(e,t,n,r){let i=n.toMap(e.screenStart);return i==null?null:Pc(t,i,n.elevationInfo,r)}function Ic(e,t){let n=Bc,r=Vc,i=Zt();e.renderCoordsHelper.worldUpAtPosition(t,n);let a=F(Jt(i),n,I(r,t,e.state.camera.eye));return F(a,a,n),Xt(t,a,i)}function Lc(e,t,n){let r=null,i=new jr;return i.next(Ac(e,Ic(e,t))).next(Rc(e,t)).next(zc(e,n)).next(e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,r=e}),e=>(r=null,i.execute(e),r)}function Rc(e,t){let n=D(),r=tt(t);e.renderCoordsHelper.worldUpAtPosition(t,n);let i=D(),a=D(),o=i=>(I(i,i,t),Kt(n,i,i),e.viewingMode===`global`&&tt(i)*Math.sign(We(n,i))<.001-r&&I(i,u(i,n,.001),t),b(i,i,t),i);return e=>(e.renderStart=o(y(i,e.renderStart)),e.renderEnd=o(y(a,e.renderEnd)),e)}function zc(e,t){let n=e.renderCoordsHelper;return e=>{let r=n.fromRenderCoords(e.renderStart,new bt({spatialReference:t})),i=n.fromRenderCoords(e.renderEnd,new bt({spatialReference:t}));return r!=null&&i!=null?{...e,mapStart:r,mapEnd:i}:null}}fe();var Bc=D(),Vc=D(),Hc=Mn();function Uc(e,t,n){let r=(n,r)=>{t({action:n,object:e,dxScreen:r.screenDeltaX,dyScreen:r.screenDeltaY})};return n((t,n,i)=>(n.next(e=>(e.action===`start`&&r(`start`,e),e)).next(kr(e)).next(e=>{switch(e.action){case`start`:case`update`:(e.translationX||e.translationY||e.translationZ)&&r(`update`,e);break;case`end`:r(`end`,e)}return e}),{steps:n,cancel:i=i.next(Or(e)).next(e=>(r(`end`,{screenDeltaX:0,screenDeltaY:0}),e))}))}function Wc(e){if(e?.axis==null)return 1;let{mapStart:t,mapEnd:n,axis:r}=e,i=[n.x-t.x,n.y-t.y];return i[0]*r[0]+i[1]*r[1]>0?1:-1}var Gc=class extends Oc{constructor(e){super(),this._handles=new Lt,this._arrowManipulatorInfos=[],this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new gt,this._tool=e.tool,this._view=e.view,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),e.radius!=null&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}set orthogonalAvailable(e){this._arrowManipulatorInfos.length>=3&&(this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e)}destroy(){this._handles=P(this._handles),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(let{manipulator:t}of this._arrowManipulatorInfos)e(t,1)}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return T();let r=t.operations.data.spatialReference,i=t.graphic;return Uc(t,n,n=>this.createDragPipeline((t,r,i,a,o)=>({steps:r,cancel:i}=e(t,r,i,a,o),n(t,r,i)),t.elevationInfo,r,i))}createDragPipeline(e,t,n,r){return E(this._arrowManipulatorInfos.map(({manipulator:i},a)=>zr(i,(i,o,s,c,l)=>{let u=o.next(e=>({...e,manipulatorType:1})).next(Dr(this._view,i.elevationAlignedLocation)).next(Pc(this._view,i.elevationAlignedLocation,t,n,r)).next(Cr(i.location,this.angle+(a+1)*Math.PI*.5)).next(Er());e(i,u,s,c,l)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},n){let r=this._radius/70,i=54*r,a=i*Math.sqrt(3)/2,o=ya(this._opaqueMaterial,a,i/2,i/2,xc);ma(o,Oe(L.get(),S(R.get(),0,-a/3,0))),e.renderObjects=[new G(o,2),new G(o.instantiate({material:this._transparentMaterial}),1)],e.radius=a/3*2*1.2;let s=Pt(L.get(),n*Math.PI/2),c=Oe(L.get(),S(R.get(),0,100*r,0));he(t,s,c)}_createManipulators(){for(let e=0;e<4;e++){let t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){let e=this.angle,t=s(L.get(),e,N(0,0,1));if(t==null)return;let n=st(L.get(),S(R.get(),this.displayScale,this.displayScale,this.displayScale)),r=he(L.get(),n,t);for(let e of this._arrowManipulatorInfos){let t=he(L.get(),r,e.transform);e.manipulator.modelTransform=t}}_createArrowManipulator(e){let t=new W({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:`disc`,direction:N(0,0,1)}}),n={manipulator:t,transform:C()};return this._updateArrowManipulator(n,e),this._handles.add(t.events.on(`drag`,e=>{this._updateAfterDrag&&e.action===`end`&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),n}_createMaterial(e=1){let t=new ia({cullFace:2,renderOccluded:2,isDecoration:!0});return this._handles.add(A(()=>j.toUnitRGBA(this._view.effectiveTheme.accentColor),n=>{n[3]*=e,t.setParameters({color:n})},O)),t}get test(){}},Kc=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let t=this._lastDragEvent.mapEnd,n=this._snap(this._lastDragEvent.screenEnd);if(n!=null){let r={action:`update`,mapStart:this._lastDragEvent.mapStart,mapEnd:!0===e?n:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this._next.execute(r)}}this._enabled=e}_snap(e){let t=this._view==null?null:this._view.toMap(e,{exclude:[]});return t!=null&&this._view!=null&&(t.z=hn(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){this._view=e,this._elevationInfo=t,this._lastDragEvent=null;let n=new jr;return this._next=n,[e=>{if(this._lastDragEvent=e.action===`end`?null:{...e},this._enabled){let t=this._snap(e.screenEnd);return t==null?null:{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}},n]}},qc=class extends Oc{constructor(e){super(),this._handles=new Lt,this._snapToScene=new Kc,this._scale=1,this._radius=70,this._view=e.view,this._tool=e.tool,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),e.snapToScene!=null&&(this.snapToScene=e.snapToScene),e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._handles=P(this._handles),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,1)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}get discManipulator(){return this._manipulator}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return T();let r=t.graphic,i=t.elevationInfo,a=t.operations.data.spatialReference;return Uc(t,n,t=>this.createDragPipeline((n,r,i,a,o)=>({steps:r,cancel:i}=e(n,r,i,a,o),t(n,r,i)),i,a,r))}createDragPipeline(e,t,n,r){let i=this._view;return zr(this._manipulator,(a,o,s,c,l)=>{let u=o.next(Dr(i,a.elevationAlignedLocation)).next(Pc(i,a.elevationAlignedLocation,t,n,r)).next(...this._snapToScene.createDragEventPipelineStep(i,t)).next(e=>({...e,manipulatorType:1})).next(Er());e(a,u,s,c,l)})}_updateManipulatorTransform(){let e=st(L.get(),S(R.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){let e=this._view;this._manipulator=new W({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:`disc`,direction:N(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){let e=ha(this._discMaterial,xc,1,128,N(0,0,1),N(0,0,0));e.transformation=st(C(),N(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new G(e,2),new G(e.instantiate({material:this._discMaterialTransparent}),1)],this._manipulator.radius=80*(this._radius/70)}_createMaterial(e=1){let t=new ia({cullFace:2,renderOccluded:2,isDecoration:!0});return this._handles.add(A(()=>j.toUnitRGBA(this._view.effectiveTheme.accentColor),n=>{n[3]*=e,t.setParameters({color:n})},O)),t}get test(){}};function Jc(e,t=4,n=!0){let r=An(e),i=!(e[3]<1);return n?new ms({color:r,writeDepth:i,cullFace:2,renderOccluded:t,isDecoration:!0}):new ia({color:r,writeDepth:i,cullFace:2,renderOccluded:t,isDecoration:!0})}function Yc(e,t=4){let n=An(e);return new ia({color:n,writeDepth:!0,cullFace:1,renderOccluded:t,isDecoration:!0})}var Xc=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1}),Zc=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function Qc(e,t,n,r){let i=I(R.get(),e,n),a=$c(i,F(R.get(),r,i),n,L.get());de(a,a);let o=ze(R.get(),t,a);return Math.atan2(o[1],o[0])}function $c(e,t,n,r){let i=M(R.get(),e),a=M(R.get(),t),o=F(R.get(),i,a);return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=0,r[4]=a[0],r[5]=a[1],r[6]=a[2],r[7]=0,r[8]=o[0],r[9]=o[1],r[10]=o[2],r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function el(e,t){let n=e.getViewForGraphic(t);return n!=null&&`computeAttachmentOrigin`in n?n.computeAttachmentOrigin(t,e.spatialReference):null}function tl(e,t){let n=t.origin;n==null?nl(e,U(t)):e.elevationAlignedLocation=n}function nl(e,t){if(t==null)return;let n=t.type===`mesh`?t.origin:va(t);n!=null&&(e.location=Zr(n))}var rl=class extends Oc{constructor(e){super(),this._radius=70,this.events=new gt,this._tool=e.tool,this._view=e.view;let t=new H({getTheme:()=>this._view.effectiveTheme});this._settings=t,e.radius!=null&&(this._radius=e.radius);let n=this._view.effectiveTheme.accentColor;this._materials={materialUnfocused:Jc(il(n,1,.25),1),materialFocused:Jc(il(n,1,0),1),materialOccludedUnfocused:Jc(il(n,.7,0),t.zManipulator.renderOccluded),materialOccludedFocused:Jc(il(n,.85,0),t.zManipulator.renderOccluded)},this._themeHandle=A(()=>this._view.effectiveTheme.accentColor,e=>{let t=il(e,1,.25),n=il(e,1,0),r=il(e,.7,0),i=il(e,.85,0),{materialUnfocused:a,materialFocused:o,materialOccludedUnfocused:s,materialOccludedFocused:c}=this._materials;a.setParameters({color:t}),o.setParameters({color:n}),s.setParameters({color:r}),c.setParameters({color:i})}),this._createManipulator(),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this._themeHandle=vt(this._themeHandle),this._manipulator.applyObjectTransform=cl,this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,0)}createManipulatedObjectDragPipeline(e,t,n){if(!t.operations)return T();let r=t.operations.data.spatialReference;return Uc(t,n,t=>this.createDragPipeline((n,r,i,a,o)=>({steps:r,cancel:i}=e(n,r,i,a,o),t(n,r,i)),r))}createDragPipeline(e,t){let n=this._view;return zr(this._manipulator,(r,i,a,o,s)=>{let c=i.next(e=>({...e,manipulatorType:0})).next(Lc(n,r.renderLocation,t)).next(Er());e(r,c,a,o,s)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){let e=this._settings,t=this._radius/70,n=e.zManipulator.height*t,r=e.zManipulator.coneHeight*t,i=e.zManipulator.coneWidth*t,a=e.zManipulator.width*t,o=[N(0,0,0),N(0,0,n)],s=[N(0,0,0),N(0,0,n+r)],c=(()=>{let e=C();return ye(e,e,[0,0,n]),re(e,e,Math.PI/2),e})(),{materialUnfocused:l,materialFocused:u,materialOccludedUnfocused:d,materialOccludedFocused:f}=this._materials,p=Ta(l,o,a/2,16,!1),m=Ca(l,r,i/2,16,!1);m.transformation=c,this._manipulator.renderObjects=[new G(m,1),new G(p,1),new G(m.instantiate({material:u}),2),new G(p.instantiate({material:u}),2),new G(m.instantiate({material:d}),1),new G(p.instantiate({material:d}),1),new G(m.instantiate({material:f}),2),new G(p.instantiate({material:f}),2)],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:`line`,paths:[s]}}_createManipulator(){let e=this._view,t=new W({view:e,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:`ns-resize`,elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=t=>{let n=e.state.camera,r=al;e.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,r);let i=lt(n.eye,r),a=n.computeRenderPixelSizeAtDist(i),o=I(ol,r,n.eye);M(o,o);let s=sl;e.renderCoordsHelper.worldUpAtPosition(al,s);let c=Math.abs(We(o,s)),l=F(ol,o,s),d=F(ol,l,s),f=Ge(c,.01,1),p=1-Math.sqrt(1-f*f)/f/n.fullWidth,m=this._settings,h=this._radius/70,g=m.zManipulator.width*h;u(d,M(d,d),(1/p-1)*i+a*g),t[12]-=ol[0],t[13]-=ol[1],t[14]-=ol[2]},this._manipulator=t,this._updateManipulator()}get test(){}};function il(e,t,n){let r=Tn(e,n);return r.a*=t,j.toUnitRGBA(r)}var al=D(),ol=D(),sl=D(),cl=()=>{},ll=class extends kc{constructor(e){super(),this._handles=new Lt;let{tool:t,view:n,snapToScene:r,radius:i}=e;this._view=n,this.xyManipulation=new qc({tool:t,view:n,snapToScene:r,radius:i}),this.xyAxisManipulation=new Gc({tool:t,view:n,radius:i}),this.zManipulation=new rl({tool:t,view:n,radius:i}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(e=>this._handles.add(e.events.on(`grab-changed`,()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createManipulatedObjectDragPipeline(e,t,n){return E([this.xyManipulation.createManipulatedObjectDragPipeline((t,n,r,i,a)=>e(0,t,n,r,i,a),t,n),this.xyAxisManipulation.createManipulatedObjectDragPipeline((t,n,r,i,a)=>e(1,t,n,r,i,a),t,n),this.zManipulation.createManipulatedObjectDragPipeline((t,n,r,i,a)=>e(2,t,n,r,i,a),t,n)])}createDragPipeline(e,t,n,r){return E([this.xyManipulation.createDragPipeline((t,n,r,i,a)=>e(0,t,n,r,i,a),t,n,r),this.xyAxisManipulation.createDragPipeline((t,n,r,i,a)=>e(1,t,n,r,i,a),t,n,r),this.zManipulation.createDragPipeline((t,n,r,i,a)=>e(2,t,n,r,i,a),n)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,1)),this.xyAxisManipulation.forEachManipulator(t=>e(t,1)),this.zManipulation.forEachManipulator(t=>e(t,0))}get _xyAxisVisible(){let e=this.xyManipulation.someManipulator(e=>e.focused)||this.xyAxisManipulation.someManipulator(e=>e.focused);return this._view.inputManager&&this._view.inputManager.latestPointerInfo?.type===`touch`||e}_autoHideXYAxis(){let e=this.xyAxisManipulation,n=this.xyManipulation;if(_t(`esri-mobile`))return;let r=[];n.forEachManipulator(e=>r.push(e)),e.forEachManipulator(e=>r.push(e));let i=()=>{let t=[];this._xyAxisVisible||e.forEachManipulator(e=>t.push(e.disableDisplay())),this._handles.remove(ul),this._handles.add(t,ul)};for(let e of r)this._handles.add(e.events.on(`focus-changed`,i));this._view.inputManager&&this._handles.add(t(()=>this._view.inputManager?.latestPointerInfo?.type,i)),i()}static radiusForSymbol(e){let t=e!=null&&e.type===`point-3d`&&e.symbolLayers;return t&&t.some(e=>e.type===`icon`)?Sc:70}},ul=`disable-xy-axis-display`,dl=class extends Oc{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._object=e.object,this._manipulator=this._object.createManipulator?.({selectable:!0,cursor:`move`}),this.forEachManipulator(e=>this._tool.manipulators.add(e))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){this._manipulator&&e(this._manipulator,1)}createManipulatedObjectDragPipeline(e){return Uc(this._object,e,e=>this.createDragPipeline(e))}createDragPipeline(e){if(!this._manipulator)return T();let t=this._view;return zr(this._manipulator,(n,r,i,a,o)=>{let s=this._object.operations?.data.spatialReference,c=r.next(e=>s?e:null).next(Fc(o,t,this._object,s)).next(Vr()).next(Er());e(n,c,i,a,o)})}},fl=class extends Gr{constructor(e){super(e),this.type=`translate-xy`,this.distance=Rn}};k([d()],fl.prototype,`type`,void 0),k([d()],fl.prototype,`distance`,void 0),fl=k([x(`esri.views.interactive.tooltip.infos.TranslateXYTooltipInfo`)],fl);var pl=class extends Gr{constructor(e){super(e),this.type=`translate-z`,this.distance=Rn}clear(){this.distance=Rn}};k([d()],pl.prototype,`type`,void 0),k([d()],pl.prototype,`distance`,void 0),pl=k([x(`esri.views.interactive.tooltip.infos.TranslateZTooltipInfo`)],pl);var ml=class{constructor(e){this.objects=e,this.type=`move-start`}},hl=class{constructor(e,t,n){this.dx=e,this.dy=t,this.objects=n,this.type=`move`}},gl=class{constructor(e){this.objects=e,this.type=`move-stop`}},_l=Symbol(`manipulators`),vl=Symbol(`tooltips`),K=class extends Br{constructor(e){super(e),this._infos=new Map,this.events=new gt,this.objects=new et,this.enableZ=!0,this.sketchOptions=new Kn,this.type=`move-3d`,this._latestTooltipInfo=null,this._translateTooltipInfo=null,this._translateXYTooltipInfo=null,this._translateZTooltipInfo=null,this._updatingHandles=new yt,this._moveManipulation=null}initialize(){let{view:e}=this;this.tooltip=Kr(()=>({view:e,options:this.sketchOptions.tooltips})),this.addHandles([this.objects.on(`change`,e=>{e.removed.forEach(e=>this.removeHandles(e)),this._updateObjectInfos(e),this._setupFastTransformUpdates(e.added),this._refreshManipulators()}),this.objects.on(`change`,()=>this._connectTooltips())]);let t=this.objects.toArray();this._updateObjectInfos({added:t,removed:[]}),this._setupFastTransformUpdates(t),this._refreshManipulators(),this._connectTooltips(),this.finishToolCreation()}destroy(){this.tooltip=P(this.tooltip),this._moveManipulation=P(this._moveManipulation),this._set(`view`,null),this._updatingHandles.destroy()}onInputEvent(e){if(!this.destroyed&&!Jr(e,this.tooltip))return super.onInputEvent(e)}get updating(){return this._updatingHandles.updating}get _shouldShowMovePointTooltip(){let{objects:e}=this;if(e.length!==1)return!1;let t=U(e.at(0))?.type;return t===`point`||t===`mesh`}get activeTooltipInfo(){return this._shouldShowMovePointTooltip?this._movePointTooltipInfo:this._latestTooltipInfo}reset(){}_updateObjectInfos({added:e,removed:t}){for(let t of e){if(Gn(t)!==0)continue;let e=new bl(t);this._infos.set(t,e)}for(let e of t)this._infos.delete(e)}_setupFastTransformUpdates(e){for(let t of e){let e=this._infos.get(t);this.addHandles(Wo(e.object),t)}}_refreshManipulators(){if(this.removeHandles(_l),this._moveManipulation=P(this._moveManipulation),this.manipulators.removeAll(),this._infos.size===0)return;let e=Array.from(this._infos.values());this._createManipulators(e),this._createVisualElements(e),this._updateMoveManipulation(e)}_createManipulators(e){for(let t of e){let n=t.object;t.manipulationXY=new dl({tool:this,view:this.view,object:n}),t.manipulationXY.forEachManipulator(e=>{this.addHandles([e.events.on(`immediate-click`,e=>{this.events.emit(`immediate-click`,{...e,object:n}),e.stopPropagation()}),e.events.on(`grab-changed`,({action:e})=>{e===`start`?this._showTooltip(0):this._hideTooltip()})],_l)}),this.addHandles(t.manipulationXY.createDragPipeline((t,n,r,i)=>this._buildDragEventPipeline(e,0,t,n,r,i)),_l)}this._createMoveManipulation(e)}_createMoveManipulation(e){let t=new ll({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:e.length===1?ll.radiusForSymbol(e[0].object.graphic?.symbol):70});this._moveManipulation=t,t.elevationInfo={mode:`absolute-height`,offset:0},t.forEachManipulator(e=>{this.addHandles(e.events.on(`immediate-click`,n=>{let r=this.objects.at(0);!t.zManipulation.hasManipulator(e)&&this.objects.length===1&&r&&this.events.emit(`immediate-click`,{...n,object:r}),n.stopPropagation()}),_l)});let n=e=>t=>{this.addHandles([t.events.on(`focus-changed`,({action:t})=>{t===`focus`?this._showTooltip(e):this._hideTooltip()}),t.events.on(`grab-changed`,()=>{this._latestTooltipInfo&&(this._latestTooltipInfo.distance=Rn)})],_l)};this._moveManipulation.xyManipulation.forEachManipulator(n(0)),this._moveManipulation.xyAxisManipulation.forEachManipulator(n(1)),this._moveManipulation.zManipulation.forEachManipulator(n(2));let r=()=>this._updateMoveManipulation(e);for(let t of e)this.addHandles([t.object.on(`committed`,r),A(()=>t.object.visible,r)],_l);let i=e[e.length-1];this.addHandles(i.object.on(`committed`,()=>this._updateMoveManipulationAngle(i)),_l);let{object:a}=i,{operations:o}=a;if(o){let n=a.graphic;this.addHandles(t.createDragPipeline((t,n,r,i,a)=>this._buildDragEventPipeline(e,t,n,r,i,a),a.elevationInfo,o.data.spatialReference,n),_l)}this._updateMoveManipulationAngle(i)}_createVisualElements(e){for(let t of e){let n=t.object,r=bc({view:this.view,object:n,forEachManipulator:e=>{t.manipulationXY?.forEachManipulator(e),this._moveManipulation?.forEachManipulator(e)},onManipulatorsChanged:()=>T()});r!=null&&(t.geometryRepresentation=r.visualElement,t.geometryRepresentation instanceof os&&this.addHandles([t.geometryRepresentation.events.on(`attachment-origin-changed`,()=>{t.object.isDraped||this._updateMoveManipulation(e)}),A(()=>t.object.isDraped,()=>this._updateMoveManipulation(e))],_l),this.addHandles(r,_l))}}_updateMoveManipulationAngle(e){this._moveManipulation&&(this._moveManipulation.angle=Ds(U(e.object)))}_updateMoveManipulation(e){let t=on(0,0,0,this.view.spatialReference),n=0,r=!1,i=this._moveManipulation;if(i){for(let i of e){if(!i.object.visible)continue;this.enableZ&&Os(i.object.operations,i.object.elevationInfo)&&(r=!0);let e=i.geometryRepresentation instanceof os&&!i.object.isDraped?i.geometryRepresentation.attachmentOrigin:i.object.origin;if(e!=null){let{x:r,y:i,z:a}=e;t.x+=r,t.y+=i,a&&(t.z??=0,t.z+=a),n++}}n>0?(t.x/=n,t.y/=n,t.z??=0,t.z/=n,i.location=t,i.xyManipulation.available=!0,i.xyAxisManipulation.available=!0,i.zManipulation.available=r):i.available=!1}}_buildDragEventPipeline(e,t,n,r,i,a){let o=[],s=[],c=null,l=null,u=()=>{for(let e of o)e.dragging=!1;o.length=0,s.length=0,c=null,l=null,this._moveManipulation&&(this._moveManipulation.interactive=!0)};if(e.length===1&&t===0){let t=e[0].object;({steps:r,cancel:i}=this._buildSnappingPipelineSteps(t,t.elevationInfo,r,i,a))}return i=i.next(e=>l?.(e)).next(()=>(s.length&&this.events.emit(`move-stop`,new gl(s)),this.destroyed||u(),null)),{steps:r=r.next(t=>{if(t.action===`start`){o.length=0,s.length=0;for(let t of e)t.dragging||!t.manipulationXY?.hasManipulator(n)&&t.manipulationXY?.grabbing||(o.push(t),s.push(t.object),t.dragging=!0);if(s.length!==0&&(this._moveManipulation&&(this._moveManipulation.interactive=!1),c=Fr(s),l=wr(s),this._emitRecordUndo(),this.events.emit(`move-start`,new ml(s)),this.destroyed))return null}return s.length===0?null:t}).next(e=>c?.(e)).next(e=>(this._updateMoveTooltip(t,e),e)).next(e=>{switch(e.action){case`start`:case`update`:if(e.translationX||e.translationY||e.translationZ){let t=this.view.toScreen(e.mapStart),n=this.view.toScreen(e.mapEnd);if(!t||!n)return null;let r=n.x-t.x,i=n.y-t.y;if(this.events.emit(`move`,new hl(r,i,s)),this.destroyed)return null}break;case`end`:if(this.events.emit(`move-stop`,new gl(s)),this.destroyed)return null;u()}return null}),cancel:i}}_connectTooltips(){let e;if(this.removeHandles(vl),this._shouldShowMovePointTooltip){let t=this.objects.at(0),{events:n}=this;this._movePointTooltipInfo??=new Da({viewType:this.view.type,sketchOptions:this.sketchOptions});let r={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),n.emit(`move-start`,new ml([t]))},onMove:()=>n.emit(`move`,new hl(0,0,[t])),onMoveStop:()=>n.emit(`move-stop`,new gl([t])),onRotateStart:()=>{},onRotate:()=>{},onRotateStop:()=>{},onScaleStart:()=>{},onScale:()=>{},onScaleStop:()=>{}};e=As(this.tooltip,t,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this._movePointTooltipInfo,callbacks:r}))}else e=A(()=>this.sketchOptions.tooltips.effectiveEnabled?this._latestTooltipInfo:null,e=>{this.tooltip.info=e},Et);this.addHandles(e,vl)}_showTooltip(e){this._shouldShowMovePointTooltip||this._updateMoveTooltip(e)}_hideTooltip(){this._shouldShowMovePointTooltip||(this.tooltip?.clear(),this._latestTooltipInfo=null)}_updateMoveTooltip(e,t){if(this._shouldShowMovePointTooltip)return;let{sketchOptions:n,autoLengthMeasurementUtils:r}=this;switch(e){case 0:this._latestTooltipInfo=this._translateTooltipInfo??=new Aa({sketchOptions:n}),xl(this._latestTooltipInfo,t,(e,t)=>r.autoDistanceBetweenPoints2D(yl(e),yl(t)));break;case 1:this._latestTooltipInfo=this._translateXYTooltipInfo??=new fl({sketchOptions:n}),xl(this._latestTooltipInfo,t,(e,n)=>In(r.autoDistanceBetweenPoints2D(yl(e),yl(n)),Wc(t)));break;case 2:this._latestTooltipInfo=this._translateZTooltipInfo??=new pl({sketchOptions:n}),xl(this._latestTooltipInfo,t,tr)}this._latestTooltipInfo.sketchOptions=n}_emitRecordUndo(){let e=this.objects.toArray().map(e=>e.createUndoRecord?.()).filter(ae);e.length>0&&this.events.emit(`record-undo`,{updates:e})}_buildSnappingPipelineSteps(e,t,n,r,i){let a=U(e);if(a==null||a.type!==`point`&&a.type!==`mesh`)return{steps:n,cancel:r};let o=(a.type===`point`?a:a.origin).clone(),s=new vr({elevationInfo:t,pointer:i,editGeometryOperations:_r.fromGeometry(o,this.view.state.viewingMode),visualizer:new Ro,excludeFeature:e.graphic}),c=this.snappingManager,{snappingStep:l,cancelSnapping:u}=Tr({snappingContext:s,snappingManager:c,updatingHandles:this._updatingHandles});return r=r.next(u),{steps:n=n.next(t=>(o.z=Sn(this.view,o,e.elevationInfo,{mode:`absolute-height`,offset:0}),{...t,snapOrigin:s.coordinateHelper.pointToVector(o)})).next(...l),cancel:r}}};k([d({constructOnly:!0,nonNullable:!0})],K.prototype,`view`,void 0),k([d({constructOnly:!0})],K.prototype,`autoLengthMeasurementUtils`,void 0),k([d()],K.prototype,`objects`,void 0),k([d({constructOnly:!0,nonNullable:!0})],K.prototype,`enableZ`,void 0),k([d({constructOnly:!0,type:Kn})],K.prototype,`sketchOptions`,void 0),k([d({constructOnly:!0})],K.prototype,`snappingManager`,void 0),k([d()],K.prototype,`type`,void 0),k([d()],K.prototype,`updating`,null),k([d()],K.prototype,`_latestTooltipInfo`,void 0),k([d()],K.prototype,`_shouldShowMovePointTooltip`,null),k([d()],K.prototype,`activeTooltipInfo`,null),K=k([x(`esri.views.3d.interactive.editingTools.move.MoveTool3D`)],K);var yl=Ct(bt),bl=class{constructor(e){this.object=e,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1}};function xl(e,t,n){if(t==null||t.action===`end`)return void(e.distance=Rn);let{mapStart:r,mapEnd:i}=t;e.distance=n(r,i)??Rn}function Sl(e,t,n){let r=n.mode===`on-the-ground`?1:0;return new dr(e,r,t,0)}function Cl(e,t,n){let r=D();if(!e.renderCoordsHelper.toRenderCoords(t,r))return null;let i=wl(e,t,Jt(n.plane)),a=wl(e,t,n.edgeDirection);if(i==null||a==null)return null;let o=F(D(),i,a);return Xt(r,o,Zt())}function wl(e,t,n){let r=on(t.x+n[0],t.y+n[1],t.z+n[2],t.spatialReference),i=D(),a=D();return e.renderCoordsHelper.toRenderCoords(t,i)&&e.renderCoordsHelper.toRenderCoords(r,a)?ct(a,i,a):null}function Tl(e,t,n){let r=Jt(e),i=ct(D(),t,n),a=F(D(),i,r),o=F(D(),i,a);return Rt(i[0],i[1],i[2],0,a[0],a[1],a[2],0,o[0],o[1],o[2],0,0,0,0,1)}function El(e,t,n){let r=n.projectToRenderScreen(e,pt()),i=n.projectToRenderScreen(t,pt());return r!=null&&i!=null?De(I(r,r,i)):0}function Dl(e,t,n,r){let{elevationInfo:i,operations:a}=n;if(!a||!e)return null;let o=r.manipulator.elevationAlignedLocation,s=hn(o,t,i),c=t.sceneIntersectionHelper.intersectElevationFromScreen(Se(e.x,e.y),i,s);return c&&_e(c,c,a.data.spatialReference)?c:null}function Ol(e,t,n,{data:{coordinateHelper:r,spatialReference:a}}){let o=Ln(e,`meters`),s=c(a),l=Math.sign(o*n.selectedArrow),u=Wn(a),d=Jt(n.plane),f=r.pointToXYZ(t),p=D();i(p,f,d,l*(kl/s));let m=o*n.selectedArrow/s;if(!u||!sn(f,a,f,u)||!sn(p,a,p,u))return m;let h=new Un;if(Vn(h,f,p,u),Hn(p,f,h.azimuth,o,u),!sn(p,u,p,a))return m;let g=p[0]-t.x,_=p[1]-t.y,v=Math.sqrt(g*g+_*_)*l,[ee,te]=d,ne=Math.sqrt(ee*ee+te*te);return ne===0?0:v/ne}var kl=10,Al=class extends Gr{constructor(e){super(e),this.type=`reshape-edge-offset`,this.distance=mr({lockable:!1}),this.area=hr({visible:!1}),this.totalLength=br({visible:!1})}get allFields(){return[this.distance,this.area,this.totalLength]}};k([d()],Al.prototype,`type`,void 0),k([d()],Al.prototype,`distance`,void 0),k([d()],Al.prototype,`area`,void 0),k([d()],Al.prototype,`totalLength`,void 0),k([d()],Al.prototype,`allFields`,null),Al=k([x(`esri.views.interactive.tooltip.infos.ReshapeEdgeOffsetTooltipInfo`)],Al);function jl(e,t){let n=t?.type;return{edgeOffset:new Al({sketchOptions:e,viewType:n}),movePoint:new Da({sketchOptions:e,viewType:n}),selectedVertex:new ka({sketchOptions:e,viewType:n}),translate:new Aa({sketchOptions:e,viewType:n}),translateXY:new fl({sketchOptions:e,viewType:n}),translateZ:new pl({sketchOptions:e,viewType:n})}}function Ml(e,t,n){function r(){let e=n(),t=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:t}}let i=!1;function a(e){i||=(i=!0,e(),!1)}function o(n){a(()=>{Fl(t,n),e.info=n.activeTooltipInfo})}return E([A(r,o,Et),A(()=>{let e=r(),{activeTooltipInfo:n}=e;if(n&&`key`in n)return{context:e,activeTooltipInfo:n,key:n.key,geometry:U(t)}},(e,n)=>{e&&n&&n.key!==e.key&&a(()=>Nl(t,e.context))},Fe),t.on(`committed`,()=>o(r())),Ur(e,{onBeforePaste:()=>{i=!0},onAfterPaste:()=>{Nl(t,r()),i=!1}})])}function Nl(e,{activeTooltipInfo:t,selectedVertexManipulatorInfo:n,callbacks:r}){if(!t)return;r.onBeforeReshape();let i=U(e);switch(i?.type){case`mesh`:t.type===`move-point`&&Ms(t,i.origin,e,r);break;case`point`:t.type===`move-point`&&Ms(t,i,e,r);break;case`polyline`:case`polygon`:t.type===`selected-vertex`&&Pl(t,n,e,r)}}function Pl(e,t,n,r){if(!t)return;let{dx:i,dy:a,dz:o}=qr(e,t.manipulator.location);i===0&&a===0&&o===0||(r.onReshapeStart(),n.operations?.moveVertices([t.handle],i,a,o,0),r.onReshape(),r.onReshapeStop())}function Fl(e,t){let{activeTooltipInfo:n,selectedVertexManipulatorInfo:r,sketchOptions:i}=t;if(n)switch(n.sketchOptions=i,n?.type){case`move-point`:Ns(n,e);break;case`selected-vertex`:Il(n,r,e,t)}}function Il(e,t,n,{automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:i}){if(!e||e.type!==`selected-vertex`)return;let a=t?.manipulator.location;e.setLocationFromPoint(a),Ps(e,a,n);let o=n.operations?.data.geometry;switch(o?.type){case`polygon`:e.geometryType=`polygon`,e.totalLength.visible=!1,e.area.actual=r.autoArea2D(o);break;case`polyline`:e.geometryType=`polyline`,e.totalLength.actual=i.autoLength2D(o),e.area.visible=!1}}var Ll=Ct(bt);function Rl(e,t,{sketchOptions:n,tooltipInfos:r,automaticLengthMeasurementUtils:i}){let a=null;switch(e){case 0:a=r.translate,zl(a,t,(e,t)=>i.autoDistanceBetweenPoints2D(Ll(e),Ll(t)));break;case 1:a=r.translateXY,zl(a,t,(e,n)=>In(i.autoDistanceBetweenPoints2D(Ll(e),Ll(n)),Wc(t)));break;case 2:a=r.translateZ,zl(a,t,tr)}return a.sketchOptions=n,a}function zl(e,t,n){if(t!=null&&t.action!==`end`){let{mapStart:r,mapEnd:i}=t;e.distance=n(r,i)??Rn}else e.distance=Rn}function Bl({operations:e},t,{sketchOptions:n,tooltipInfos:r,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:a}){let o=r.edgeOffset;if(o.distance.committed=null,t!=null&&t.signedDistance!=null&&t.action!==`end`&&e!=null){let n=e.data.coordinateHelper,{start:r,end:i}=t.operation.clampedStartAndEnd(t.mapEnd),s=a.autoDistance2D(r,i,n.spatialReference),c=Math.sign(t.signedDistance*t.operation.selectedArrow);o.distance.actual=s==null?null:In(s,c)}else o.distance.actual=Rn;let s=e?.data.geometry;switch(o.area.actual=null,o.area.visible=!1,o.totalLength.actual=null,o.totalLength.visible=!1,s?.type){case`polygon`:o.area.actual=i.autoArea2D(s),o.area.visible=!0;break;case`polyline`:o.totalLength.actual=a.autoLength2D(s),o.totalLength.visible=!0}return o.sketchOptions=n,o}var Vl={Left:0,Middle:1,Right:2,Back:3,Forward:4,Undefined:-1},Hl=Symbol(),q=class extends Re{get _operations(){return this.object.operations}constructor(e){super(e),this._selectedIndex=0,this._manipulatorHandles=new Lt,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=0,this._pendingEdgeOffsetInfo=null,this._updatingHandles=new yt,this._recreatingManipulators=!1,this._settings=new H({getTheme:()=>this.view.effectiveTheme}),this.events=new gt,this.activeTooltipInfo=null,this._vertexLaserLineVisualElement=null,this._tooltipCallbacks={onBeforeReshape:()=>this.tool.endDrag(),onReshapeStart:()=>this._updateEventState(2),onReshape:()=>this.events.emit(`reshape`,{type:`reshape`,object:this.object}),onReshapeStop:()=>this._updateEventState(0,{forceEnd:!0}),onMoveStart:()=>this._updateEventState(1),onMove:()=>this.events.emit(`move`,{type:`move`,object:this.object,dx:0,dy:0}),onMoveStop:()=>this._updateEventState(0,{forceEnd:!0})}}initialize(){let{view:e}=this,t=this._settings.manipulators,n=t.vertex;this.tooltipInfos=jl(this._sketchOptions,e),this._vertexManipulatorMaterial=Jc(z(n.color),n.renderOccluded),this._vertexManipulatorOutlineMaterial=Yc(z(n.outlineColor),n.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Yc(z(n.hoverOutlineColor),n.renderOccluded);let r=t.edge;this._edgeManipulatorMaterial=Jc(z(r.color),r.renderOccluded),this._edgeManipulatorOutlineMaterial=Yc(z(r.outlineColor),r.renderOccluded);let i=t.edgeOffset;this._edgeOffsetManipulatorMaterial=Jc(z(i.color),i.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=Jc(z(i.hoverColor),i.renderOccluded,!1);let a=t.selected;this._selectedManipulatorMaterial=Jc(z(a.color),a.renderOccluded),this._selectedManipulatorOutlineMaterial=Yc(z(a.outlineColor),a.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Yc(z(a.hoverOutlineColor),a.renderOccluded),this.tooltip=Kr(()=>({view:e,options:this._sketchOptions.tooltips})),this.addHandles([A(()=>{let e=this._settings.manipulators;return{vertexSettings:e.vertex,edgeSettings:e.edge,edgeOffsetSettings:e.edgeOffset,selectedSettings:e.selected}},({vertexSettings:e,edgeSettings:t,edgeOffsetSettings:n,selectedSettings:r})=>{e.applyColor(this._vertexManipulatorMaterial),e.applyOutline(this._vertexManipulatorOutlineMaterial),e.applyHoverOutline(this._vertexManipulatorHoverOutlineMaterial),t.applyColor(this._edgeManipulatorMaterial),t.applyOutline(this._edgeManipulatorOutlineMaterial),n.applyColor(this._edgeOffsetManipulatorMaterial),n.applyHover(this._edgeOffsetManipulatorHoverMaterial),r.applyColor(this._selectedManipulatorMaterial),r.applyOutline(this._selectedManipulatorOutlineMaterial),r.applyHoverOutline(this._selectedManipulatorHoverOutlineMaterial)}),A(()=>this.object.visible,e=>{for(let t of this._manipulatorInfos)t.manipulator.available=e,ql(t)&&(t.edgeManipulator.available=e)}),A(()=>this._numGrabbing+this._numDragging===0,e=>this._toggleAutoHideManipulators(e)),A(()=>({labels:this._segmentLabels,enabled:this._sketchOptions.labels.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:e,enabled:t,edgeOffsetEnabled:n})=>{e!=null&&(e.visible=t,e.edgeDistance=n?`far`:`default`)},O),Ml(this.tooltip,this.object,()=>this._tooltipsContext),A(()=>this.tooltip.mode,(e,t)=>{t===`input`&&e!==`input`&&this._resetTooltip()}),xe(()=>this._operations,`vertex-update`,e=>this._updateManipulatorPositions(e.vertices),{onListenerAdd:()=>this._recreateManipulators()}),xe(()=>this._operations?.data,`change`,e=>{e.operation!==`undo`&&e.operation!==`redo`||this._recreateManipulators()})])}destroy(){this._removeManipulators(),this._updatingHandles.destroy(),this._segmentLabels=P(this._segmentLabels),this.tooltip=P(this.tooltip)}get updating(){return this._updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get automaticAreaMeasurementUtils(){return this.tool.automaticAreaMeasurementUtils}get automaticLengthMeasurementUtils(){return this.tool.automaticLengthMeasurementUtils}get object(){return this.tool.object}get enableZShape(){return this.tool.enableZShape}get enableDeleteVertices(){return this.tool.enableDeleteVertices}get enableZVertex(){return this.tool.enableZVertex}get autoHideManipulators(){return this.tool.autoHideManipulators}get enableMoveObject(){return this.tool.enableMoveObject}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _sketchOptions(){return this.tool.sketchOptions}get _accentColor(){return this.view.effectiveTheme.accentColor}enterInputModeIfAvailable(e){return e.type===`key-down`&&e.key===r.enterInputMode&&(this.activeTooltipInfo?.type===`reshape-edge-offset`?this._enterInputModeDuringEdgeOffset(e):!!Jr(e,this.tooltip)&&(this.tool.endDrag(),!0))}removeSelectedVertices(){let e=this._manipulatorInfos.filter(e=>e.manipulator.selected&&e.type===`vertex`);return this._removeVertices(e),e.length}onManipulatorSelectionChanged(){this.events.emit(`manipulators-changed`)}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=P(this._moveManipulation),this._objectMoveManipulation=P(this._objectMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(e){if(this._operations==null)return;let t=this.object.elevationInfo;for(let{vertices:n,segments:r,index:i}of this._operations.data.parts){let a=e?.byPartIndex.get(i);for(let e of n){let n=a?.has(e.index);this._createVertexOrEdgeManipulator(e,t,n)}for(let e of r)e.type===`line`&&this._createVertexOrEdgeManipulator(e,t)}this._createObjectMoveManipulation(),this._createMoveManipulation(t),this._createVisualElements()}recordUndo(e){this._operations?.recordUndo(e)}get canRedo(){return this._operations?.canRedo??!1}get canUndo(){return this._operations?.canUndo??!1}redo(){return this._operations?.redo()}undo(){return this.events.emit(`undo`),this._operations?.undo()}_recreateManipulators(){if(!this._recreatingManipulators){if(this._recreatingManipulators=!0,this._removeManipulators(),this._resetTooltip(),this._operations&&this._segmentLabels?.context?.editGeometryOperations===this._operations||(this._segmentLabels=P(this._segmentLabels)),this._createManipulators(),!this._segmentLabels&&this._operations){let e=this._sketchOptions.labels;this._segmentLabels=new Ia({context:{view:this.view,editGeometryOperations:this._operations,elevationInfo:this.object.elevationInfo,labelOptions:e,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},visible:e.enabled})}this._recreatingManipulators=!1}}_perObjectManipulatorDragAction(e,t){if(t.action===`end`)return t;let n=0,r=[],i=this._manipulatorInfos.some(e=>e.type===`vertex`&&e.manipulator.selected),a=e===1&&i;for(let e of this._manipulatorInfos)e.type===`vertex`&&(e.manipulator.grabbing||a&&!e.manipulator.selected||r.push(e),n++);if(this._moveVertices(r,t),r.length===n){if(this._updateEventState(1),this.destroyed)return t;this.events.emit(`move`,{type:`move`,dx:t.screenDeltaX,dy:t.screenDeltaY,object:this.object})}else{if(this._updateEventState(2),this.destroyed)return t;this.events.emit(`reshape`,{type:`reshape`,object:this.object})}return t}_toggleAutoHideManipulators(e){this.autoHideManipulators&&(e?this.removeHandles(Hl):this.tool.manipulators.forEach(({manipulator:e})=>{let t=e.disableDisplay?.();t&&this.addHandles(t,Hl)}))}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((e,t)=>t.type===`vertex`&&t.manipulator.selected?e+1:e,0)>1}_perVertexManipulatorDragAction(e){if(this._updateEventState(2),this.destroyed)return;let{mapDeltaX:t,mapDeltaY:n,mapDeltaZ:r}=e;if(!t&&!n&&!r)return;let i=[];for(let t of this._manipulatorInfos)t.type===`vertex`&&(t.manipulator.selected&&!t.manipulator.grabbing||t===e.info)&&i.push(t);this._moveVertices(i,e,1),this.events.emit(`reshape`,{type:`reshape`,object:this.object})}_updateEventState(e,t={}){if(e===this._reshapeEventState)return!1;switch(e){case 0:if(!t.forceEnd&&(this._numGrabbing!==0||this._numDragging!==0))return!1;switch(this._reshapeEventState){case 1:this.events.emit(`move`,{type:`move-stop`,dx:0,dy:0,object:this.object});break;case 2:this.events.emit(`reshape`,{type:`reshape-stop`,object:this.object})}break;case 1:switch(this._reshapeEventState){case 0:this.events.emit(`move`,{type:`move-start`,dx:0,dy:0,object:this.object});break;case 2:this.events.emit(`reshape`,{type:`reshape-stop`,object:this.object}),this.destroyed||this.events.emit(`move`,{type:`move-start`,dx:0,dy:0,object:this.object})}break;case 2:switch(this._reshapeEventState){case 0:this.events.emit(`reshape`,{type:`reshape-start`,object:this.object});break;case 1:this.events.emit(`move`,{type:`move-stop`,dx:0,dy:0,object:this.object}),this.destroyed||this.events.emit(`reshape`,{type:`reshape-start`,object:this.object})}}if(this.destroyed)return!1;let n=this._reshapeEventState!==e;return this._reshapeEventState=e,n}_createObjectMoveManipulation(){let{tool:e,view:t,object:n,_operations:r}=this;if(r){if(this._objectMoveManipulation=new dl({tool:e,view:t,object:n}),this.enableMoveObject){let e=null;this._manipulatorHandles.add(this._objectMoveManipulation.createDragPipeline((t,n,i)=>{n.next(e=>this._trackNumDragging(e)).next(t=>(t.action===`start`&&(e=r.createUndoGroup()),t)).next(e=>this._perObjectManipulatorDragAction(0,e)).next(e=>(this._updateTranslateObjectTooltip(0,e),e)).next(t=>{t.action===`end`&&(this._resetTooltip(),e=vt(e))}),i.next(()=>this._onDragCancel(!0,()=>e=vt(e)))})),this._objectMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(e,!1)))}else this._objectMoveManipulation.forEachManipulator(e=>{e.grabbable=!1,e.cursor=null});this._objectMoveManipulation.forEachManipulator(e=>this._manipulatorHandles.add(e.events.on(`immediate-click`,e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.events.emit(`immediate-click`,{...e,object:this.object}),e.stopPropagation()})))}}_createMoveManipulation(e){let{object:t,tool:n,view:r,_operations:i}=this;if(!i)return;this._moveManipulation=new ll({tool:n,view:r,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Os(t.operations,t.elevationInfo),snapToScene:!1,radius:ll.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator(e=>this.addHandles([e.events.on(`immediate-click`,t=>{this._moveManipulation.zManipulation.hasManipulator(e)||this._manipulatorInfos.some(e=>e.manipulator.selected)||this.events.emit(`immediate-click`,{...t,object:this.object}),t.stopPropagation()}),this._watchAndUpdateGrabState(e,!1)]));let a=e=>t=>{this.addHandles([t.events.on(`focus-changed`,({action:t})=>{t===`focus`?this._updateTranslateTooltip(e):this._resetTooltip()})])};this._moveManipulation.xyManipulation.forEachManipulator(a(0)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(1)),this._moveManipulation.zManipulation.forEachManipulator(a(2)),this._moveManipulation.elevationInfo={mode:`absolute-height`,offset:0};let o=i.data.spatialReference;this.addHandles([this._moveManipulation.createDragPipeline((r,a,o,s,c)=>{let{snappingStep:l,cancelSnapping:u}=Tr({predicate:e=>!!e.info,snappingManager:n.snappingManager,snappingContext:new vr({editGeometryOperations:i,elevationInfo:e,pointer:c,excludeFeature:t.graphic,visualizer:new Ro}),updatingHandles:this._updatingHandles,useZ:!1});return s=s.next(e=>(this._onDragCancel(),e)).next(u),{steps:o=o.next(e=>this._trackNumDragging(e)).next(e=>{let t=this._manipulatorInfos.filter(e=>e.type===`vertex`&&e.manipulator.selected);return e.manipulatorType===1&&t.length===1?{...e,info:t[0],snapOrigin:t[0].handle.pos}:e}).next(Mr(this.view,e,t.graphic??void 0)).next(...l).next(Vr()).next(e=>this._perObjectManipulatorDragAction(1,e)).next(e=>(this._updateTranslateTooltip(r,e),e)),cancel:s}},e,o,t.graphic),A(()=>t.visible,()=>this._updateMoveManipulationPosition(),O),t.on(`committed`,()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),A(()=>t.isDraped,e=>{this._updateMoveManipulationPosition();let t=`align-move-manipulation`;e?this.addHandles(this.view.elevationProvider.on(`elevation-change`,()=>this._updateMoveManipulationPosition()),t):this.removeHandles(t)},O)])}_createVisualElements(){let{object:e,view:t}=this,n=bc({view:t,object:e,forEachManipulator:e=>{if(!this.destroyed&&!this._recreatingManipulators){this._objectMoveManipulation.forEachManipulator(e),this._moveManipulation.forEachManipulator(e);for(let t of this._manipulatorInfos)e(t.manipulator,1)}},onManipulatorsChanged:e=>this.events.on(`manipulators-changed`,e)});n!=null&&(this._outlineVisualElement=n.visualElement instanceof os?n.visualElement:null);let r=this._outlineVisualElement;if(r!=null){let t=()=>{e.isDraped||this._updateMoveManipulationPosition()};this._manipulatorHandles.add(xe(()=>r.events,`attachment-origin-changed`,t,{onListenerAdd:t}))}this._manipulatorHandles.add(n)}_createEdgeOffsetManipulator(e,t=this.object.elevationInfo){let n=this.view,r=this._operations;if(e.part.vertices.length<=2||!r)return null;let i=r.data.spatialReference,a=this._settings.manipulators.edgeOffset,o=a.size/2,s=o+a.collisionPadding,c=o/s,l=c/2,u=c*Math.sqrt(3)/2,{height:d,offset:f}=a,p=this._edgeOffsetManipulatorMaterial;this._edgeOffsetManipulatorGeometryInside||=ya(p,u,l,l,d,f),this._edgeOffsetManipulatorGeometryOutside||=ya(p,-u,l,l,d,-f);let m=[new G(this._edgeOffsetManipulatorGeometryInside.instantiate(),1),new G(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),2),new G(this._edgeOffsetManipulatorGeometryOutside.instantiate(),1),new G(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),2)],h=new W({view:n,renderObjects:m,elevationInfo:t.mode!==`on-the-ground`||jn(this.object.graphic?.symbol)?{mode:`absolute-height`,offset:0}:t,worldOriented:!1,focusMultiplier:1,radius:s,available:this.object.visible,collisionType:{type:`disc`,direction:N(0,0,1)},collisionPriority:1,metadata:{deleting:!1},location:Kl(i)}),g=new W({view:n,worldSized:!0,worldOriented:!1,available:this.object.visible,collisionPriority:-10,cursor:this.enableMoveObject?`move`:`default`,metadata:{deleting:!1},location:Kl(i)}),_={manipulator:h,handle:e,locationUpdateHandle:null,type:`edge`,selectedIndex:0,edgeManipulator:g,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(_,a.minSquaredEdgeLength);let v=()=>this._updateEdgeOffsetManipulator(_);v(),_.locationUpdateHandle=E([e.leftVertex,e.rightVertex].map(e=>this._getManipulatorInfoFromHandle(e)?.manipulator.events.on(`location-update`,v)));let ee=e=>{this._manipulatorInfos.some(e=>e.manipulator.selected)?this._clearSelection():this.events.emit(`immediate-click`,{...e,object:this.object}),e.stopPropagation()};return this._manipulatorHandles.add([_.locationUpdateHandle,this._watchAndUpdateGrabState(h,!0),this._watchAndUpdateGrabState(g,!0),zr(h,this._createEdgeOffsetPipeline(_,t,r)),zr(g,this._createEdgePipeline(_,t,r)),g.events.on(`immediate-click`,ee),h.events.on(`immediate-click`,ee),h.events.on(`focus-changed`,()=>this._resetTooltip()),h.events.on(`grab-changed`,({screenPoint:e,action:t})=>{_.grabMapPoint=t===`start`?Dl(e,this.view,this.object,_):null})],h),this._manipulatorInfos.push(_),this.manipulators.addMany([h,g]),this.events.emit(`manipulators-changed`),_}_autoHideEdgeOffsetManipulator(e,t){let n=e.manipulator,r=e.edgeManipulator,i=()=>{e.visibilityHandle=vt(e.visibilityHandle);let i=this._getManipulatorInfoFromHandle(e.handle.leftVertex),a=this._getManipulatorInfoFromHandle(e.handle.rightVertex),o=i!=null&&a!=null&&El(i.manipulator.renderLocation,a.manipulator.renderLocation,this.view.state.camera)<t;(!n.focused&&!r.focused||o)&&(n.grabbable=!o,r.grabbable=!o,e.visibilityHandle=E([n.disableDisplay(),T(()=>{n.grabbable=!0,r.grabbable=this.enableMoveObject})]))};this._manipulatorHandles.add([n.events.on(`focus-changed`,i),r.events.on(`focus-changed`,i),T(()=>{vt(e.visibilityHandle),r.metadata.deleting=!0,this.manipulators.remove(r)})],n),i()}_updateEdgeOffsetManipulator(e){if(!this._operations)return;this._updateManipulatorPosition(e);let{coordinateHelper:t}=this._operations.data,n=Cl(this.view,e.manipulator.elevationAlignedLocation,Sl(t,e.handle,e.manipulator.elevationInfo)),r=this._getManipulatorInfoFromHandle(e.handle.leftVertex),i=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(r==null||i==null)return;let a=r.manipulator.renderLocation,s=i.manipulator.renderLocation,c=n==null?o:Tl(n,a,s);e.manipulator.modelTransform=c,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=c;let l=tt(I(Yl,a,s))/2;e.edgeManipulator.collisionType={type:`line`,paths:[[[-l,0,0],[l,0,0]]]}}_createEdgePipeline(e,t,n){return(r,i,a,o)=>{if(o===`touch`)this._createEdgeOffsetPipeline(e,t,n)(r,i,a);else if(this.enableMoveObject){let e=this.object.graphic,o=n.data.spatialReference,{elevationAlignedLocation:s}=r;i.next(e=>this._trackNumDragging(e)).next(Dr(this.view,s)).next(Pc(this.view,s,t,o,e)).next(Er()).next(Vr()).next(e=>this._perObjectManipulatorDragAction(0,e)).next(e=>(this._updateTranslateObjectTooltip(0,e),e)).next(e=>{e.action===`end`&&this._resetTooltip()}),a.next(()=>this._onDragCancel(!r.metadata.deleting))}}}_createEdgeOffsetPipeline(e,t,n){return(r,i,a)=>{let o=this._pendingEdgeOffsetInfo;if(o?.manipulatorInfo===e&&o.mode!==`drag`)return void a.execute({action:`cancel`});this._clearSelection();let{initializeStep:s,cleanup:c}=this._initializeEdgeOffset(e,t,n,a),l=this._applyEdgeOffsetStep(e);i.next(e=>this._trackNumDragging(e)).next(Dr(this.view,r.elevationAlignedLocation)).next(s).next(jc(this.view)).next(zc(this.view,n.data.spatialReference)).next(Vr()).next(Ul()).next(e=>this._pendingEdgeOffsetInfo?e:l(e)).next(e=>{e.action!==`end`||this._pendingEdgeOffsetInfo||c()}),a.next(()=>{this._exitEdgeOffsetInputMode(),r.metadata.deleting||(c(),this._onDragCancel())})}}_initializeEdgeOffset(e,t,n,r){let{view:i,object:a}=this,o=Sl(n.data.coordinateHelper,e.handle,t),s=n.createUndoGroup(),c=Cl(i,e.manipulator.elevationAlignedLocation,o),l;this._splitEdgesBeforeEdgeOffset(e,o),this._selectEdgeOffsetArrow(e,o);let u=()=>{this._cleanEdgeOffsetCollapsedEdges(e,n),l=vt(l)},d=this.events.on(`undo`,u);return l=E([this._initializeEdgeOffsetVisualElement(e,a,t,n),s,d,this._connectEdgeOffsetTooltip(e,o,n,()=>{r.execute({action:`cancel`})})]),{initializeStep:e=>o==null||c==null?(u(),null):{...e,operation:o,plane:c},cleanup:u}}_initializeEdgeOffsetVisualElement(e,t,n,r){let i=()=>new ge({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:r.data.spatialReference}),a=new os({view:this.view,isDraped:t.isDraped,geometry:i(),elevationInfo:n,width:this._settings.visualElements.lineObjects.outline.width,attached:!1,isDecoration:!0}),o=E([A(()=>({color:this._accentColor,draped:t.isDraped}),({color:e,draped:t})=>{a.color=z(e),a.isDraped=t},Et),t.on(`committed`,()=>{a.geometry=i()}),w(a)]);return a.attached=!0,o}_applyEdgeOffsetStep(e){return t=>(this.destroyed||t.operation==null||!this._operations||(this._updateEventState(2),t.signedDistance==null?this._resetTooltip():((t.mapDeltaX||t.mapDeltaY||t.mapDeltaZ)&&(this._offsetEdge(e,t.operation,t.signedDistance),this.events.emit(`reshape`,{type:`reshape`,object:this.object})),this._updateEdgeOffsetTooltip(t))),t)}_cleanEdgeOffsetCollapsedEdges(e,t){let n=e.handle.leftVertex.leftSegment?.leftVertex,r=e.handle.leftVertex,i=e.handle.rightVertex.rightSegment?.rightVertex,a=e.handle.rightVertex,o=t.data.coordinateHelper,s=this.view.pixelSizeAt(o.vectorToDehydratedPoint(r.pos),o.spatialReference),c=[];if(n&&o.distance(n.pos,r.pos)<Xl){let e=this._getManipulatorInfoFromHandle(r);e!=null&&c.push(e)}if(o.distance(r.pos,a.pos)<s||i&&o.distance(i.pos,a.pos)<Xl){let e=this._getManipulatorInfoFromHandle(a);e!=null&&c.push(e)}c.length&&this._removeVertices(c)}_enterInputModeDuringEdgeOffset(e){let t=this._findActiveEdgeOffsetManipulatorInfo();return!!t&&!!Jr(e,this.tooltip)&&(t.manipulator.dragging?(this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:`drag`},!0):(this._clearSelection(),this._pendingEdgeOffsetInfo={manipulatorInfo:t,mode:`hover`},this._connectEdgeOffsetTooltipOnHover(t),!0))}_exitEdgeOffsetInputMode(){this.tooltip&&(this._pendingEdgeOffsetInfo=null,this._resetTooltip(),this.tooltip.exitInputMode())}_findActiveEdgeOffsetManipulatorInfo(){return this._manipulatorInfos.filter(ql).find(({manipulator:e})=>e.hovering||e.grabbing||e.dragging)}_connectEdgeOffsetTooltipOnHover(e){let{_operations:t,object:n}=this;if(!t)return;let{elevationInfo:r}=n,i=Sl(t.data.coordinateHelper,e.handle,r);this._selectEdgeOffsetArrow(e,i),this.addHandles([this._initializeEdgeOffsetVisualElement(e,n,r,t),this._connectEdgeOffsetTooltip(e,i,t,()=>{this.removeHandles(i),this._exitEdgeOffsetInputMode()})],i)}_splitEdgesBeforeEdgeOffset(e,t){if(t.requiresSplitEdgeLeft){let t=this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftSegment);t!=null&&this._splitEdgeManipulator(t,1)}if(t.requiresSplitEdgeRight){let t=this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightSegment);t!=null&&this._splitEdgeManipulator(t,0)}}_selectEdgeOffsetArrow(e,t){let n=e.grabMapPoint??Dl(this.view.inputManager?.latestPointerInfo?.location,this.view,this.object,e);n&&t.selectArrowFromStartPoint(n)}_connectEdgeOffsetTooltip(e,n,r,i){let a=()=>this.tooltipInfos.edgeOffset.distance.actual,o=t=>{i(),queueMicrotask(()=>{this.view.focus();let i=r.createUndoGroup();this._tooltipCallbacks.onReshapeStart?.(),this._splitEdgesBeforeEdgeOffset(e,n),this._offsetEdge(e,n,Ol(t,e.manipulator.location,n,r)),this._tooltipCallbacks.onReshape?.(),this._tooltipCallbacks.onReshapeStop?.(),this._cleanEdgeOffsetCollapsedEdges(e,r),i.remove()})},s=()=>{let e=a();e==null?i():o(e)};return E([t(()=>this.tooltip&&!this.tooltip.focused,()=>s(),Fe),this.tooltip.on(`discard`,i),this.tooltip.on(`commit`,e=>{e.type===`commit-and-exit`&&s()})])}_createVertexOrEdgeManipulator(e,t=this.object.elevationInfo,n=!1){let r=this.view,i=this._operations,a=this._settings;if(!i)return null;let o=i.data.type,s=i.data.spatialReference;if(e.type===`line`){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,t);if(!this.enableMidpoints)return null}if(this._vertexManipulatorGeometry==null||this._vertexManipulatorOutlineGeometry==null){let{size:e,outlineSize:t}=Wl(a.manipulators.vertex);this._vertexManipulatorGeometry=wa(this._vertexManipulatorMaterial,e,16,16),this._vertexManipulatorOutlineGeometry=wa(this._vertexManipulatorOutlineMaterial,t,16,16)}if(this._edgeManipulatorGeometry==null||this._edgeManipulatorOutlineGeometry==null){let{size:e,outlineSize:t}=Wl(a.manipulators.edge);this._edgeManipulatorGeometry=wa(this._edgeManipulatorMaterial,e,16,16),this._edgeManipulatorOutlineGeometry=wa(this._edgeManipulatorOutlineMaterial,t,16,16)}let c=o===`point`||o===`mesh`?[]:[new G(this._vertexManipulatorGeometry.instantiate(),4|Zl),new G(this._vertexManipulatorOutlineGeometry.instantiate(),5|Zl),new G(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),6|Zl),new G(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),8),new G(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),9),new G(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),10)];this.enableMidpoints&&c.push(new G(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),6|Ql),new G(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),6|Ql),new G(this._edgeManipulatorGeometry.instantiate(),5|Ql),new G(this._edgeManipulatorOutlineGeometry.instantiate(),5|Ql));let l=new W({view:r,renderObjects:c,elevationInfo:t,focusMultiplier:1,touchMultiplier:1,available:this.object.visible,metadata:{deleting:!1},location:Kl(s)});l.selected=n,this._setTypeSpecificManipulatorSettings(l,e,t);let u=e.type===`vertex`?{manipulator:l,handle:e,type:`vertex`,selectedIndex:0}:{manipulator:l,handle:e,locationUpdateHandle:null,type:`edge`,selectedIndex:0};if(this._manipulatorInfos.push(u),this.manipulators.add(l),this._updateManipulatorPosition(u),u.type===`edge`){let e=[];for(let t of[u.handle.leftVertex,u.handle.rightVertex]){let n=this._getManipulatorInfoFromHandle(t);n!=null&&e.push(n.manipulator.events.on(`location-update`,()=>this._updateManipulatorPosition(u)))}u.locationUpdateHandle=E(e),this._manipulatorHandles.add(u.locationUpdateHandle,l)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(l,!0),l);let d=zr(l,(e,n,a,o)=>{let c=null,{snappingStep:l,cancelSnapping:d}=Tr({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new vr({editGeometryOperations:i,elevationInfo:t,pointer:o,excludeFeature:this.object.graphic,visualizer:new Ro}),updatingHandles:this._updatingHandles,useZ:!1});a=a.next(t=>(this._onDragCancel(!e.metadata.deleting,()=>c=vt(c)),t)).next(d);let{elevationAlignedLocation:f}=e,p=this.object.graphic??void 0;n.next(e=>this._trackNumDragging(e)).next(e=>{if(e.action===`start`&&i&&(c=i.createUndoGroup()),u.type===`edge`){let t=this._splitEdgeManipulator(u);return{...e,info:t,snapOrigin:t.handle.pos}}return{...e,info:u,snapOrigin:u.handle.pos}}).next(Dr(r,f)).next(Pc(r,f,t,s,p)).next(Mr(r,t,p)).next(...l).next(Vr()).next(e=>{this._perVertexManipulatorDragAction(e),e.action===`end`&&(c=vt(c)),this._resetTooltip()})});return this._manipulatorHandles.add([d,l.events.on(`immediate-click`,e=>this._manipulatorClickCallback(e,u)),l.events.on(`select-changed`,()=>{u.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition(),this._resetTooltip()}),l.events.on(`focus-changed`,()=>{this._resetTooltip()})],l),this.events.emit(`manipulators-changed`),u}_trackNumDragging(e){switch(e.action){case`start`:this._numDragging++;break;case`end`:this._numDragging--}return e}_onDragCancel(e=!0,t){switch(this._numDragging--,e&&this.undo(),this.tool.snappingManager?.doneSnapping(),this._resetTooltip(),this._reshapeEventState){case 0:break;case 1:this.events.emit(`move`,{type:`move`,dx:0,dy:0,object:this.object});break;case 2:this.events.emit(`reshape`,{type:`reshape`,object:this.object})}t?.(),this.destroyed||this._updateEventState(0)}_setTypeSpecificManipulatorSettings(e,t,n){let r=this._settings;switch(t.type){case`vertex`:{e.state=Zl,e.selectable=!0,e.cursor=`move`,e.collisionPriority=2;let{size:t,collisionPadding:i}=r.manipulators.vertex;e.radius=t/2+i,e.elevationInfo=n;let a=this._operations?.data.type;e.interactive=a!=null&&a!==`point`&&a!==`mesh`;break}case`line`:{e.state=Ql,e.selectable=!1,e.cursor=`copy`,e.collisionPriority=-1;let{size:t,collisionPadding:i}=r.manipulators.edge;e.radius=t/2+i,e.elevationInfo=n.mode!==`on-the-ground`||jn(this.object.graphic?.symbol)?{mode:`absolute-height`,offset:0}:n;break}}}_watchAndUpdateGrabState(e,t){return e.events.on(`grab-changed`,n=>{this._onGrabStateChanged(e,t,n.action,n.pointerType)})}_onGrabStateChanged(e,t,n,r=`mouse`){if(!this._recreatingManipulators){if(n===`start`)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(0),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(r!==`touch`||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(e=>{let{manipulator:t}=e,n=this._operations?.data.type;t.interactive=t.grabbing||!this._numGrabbing&&n!=null&&n!==`point`&&n!==`mesh`,ql(e)&&(e.edgeManipulator.interactive=e.edgeManipulator.grabbing||!this._numGrabbing)}),this._objectMoveManipulation.forEachManipulator(e=>{e.interactive=e.grabbing||!this._numGrabbing}))}}_clearSelection(){for(let e of this._manipulatorInfos)e.manipulator.grabbing||(e.manipulator.selected=!1);this._pendingEdgeOffsetInfo=null}_updateSelection(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.events.emit(`manipulators-changed`))}_removeManipulator(e){e!=null&&(e.manipulator.metadata.deleting=!0,this.manipulators.remove(e.manipulator),this._manipulatorHandles.remove(e.manipulator),je(this._manipulatorInfos,e),this.events.emit(`manipulators-changed`),this._resetTooltip())}_getManipulatorInfoFromHandle(e){return this._manipulatorInfos.find(t=>t.handle===e)}_updateManipulatorPositions(e){for(let t of e)this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(t))}_updateManipulatorPosition(e){let t=this._operations;if(e!=null&&t){if(e.type===`vertex`)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,Jl),e.manipulator.grabbing&&this._vertexLaserLineVisualElement!=null&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if(e.type===`edge`){let n=this._getManipulatorInfoFromHandle(e.handle.leftVertex),r=this._getManipulatorInfoFromHandle(e.handle.rightVertex);if(n==null||r==null)return;let i=n.manipulator,a=r.manipulator;if(e.manipulator.elevationInfo?.mode===`on-the-ground`){let n=i.location,r=a.location,o=.5,s=n.x+o*(r.x-n.x),c=n.y+o*(r.y-n.y),l=n.hasZ&&r.hasZ?0:void 0;e.manipulator.location=on(s,c,l,t.data.spatialReference)}else Dt(Yl,i.renderLocation,a.renderLocation,.5),e.manipulator.renderLocation=Yl}}}_splitEdgeManipulator(e,t=.5){let n=this._operations,r=n.splitSegment(e.handle,t).createdVertex;e.locationUpdateHandle=vt(e.locationUpdateHandle);let i=this.object.elevationInfo,a;this.enableEdgeOffset?(this._removeManipulator(e),a=this._createVertexOrEdgeManipulator(r)):(a=e,a.handle=r,a.type=`vertex`,this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,i)),r.leftSegment?.type===`line`&&this._createVertexOrEdgeManipulator(r.leftSegment),r.rightSegment?.type===`line`&&this._createVertexOrEdgeManipulator(r.rightSegment),this._updateManipulatorPosition(a),this.enableEdgeOffset||this._resetTooltip(),this._updateSelection(e.manipulator);let o=this._updateEventState(2),s=n.data.coordinateHelper.vectorToArray(a.handle.pos),c=n.data.parts.indexOf(r.part);return this.events.emit(`vertex-add`,{type:`vertex-add`,object:this.object,vertices:[{coordinates:s,componentIndex:c,vertexIndex:r.index}],added:s}),o&&this._updateEventState(0),a}_updateMoveManipulationPosition(){let e=S(Yl,0,0,0),t=0,n=!1,r=null,i=null;for(let a of this._manipulatorInfos)a.type===`vertex`&&(a.manipulator.selected?(t++,b(e,e,a.manipulator.renderLocation),r==null||a.selectedIndex>r.selectedIndex?(i=r,r=a):(i==null||a.selectedIndex>i.selectedIndex)&&(i=a)):n=!0);let a=this.object,o=this._operations?.data.geometry;if(t===0){let e=a.visible&&this.enableMoveObject;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e,this._moveManipulation.zManipulation.available=e&&this.enableZShape&&Os(this._operations,a.elevationInfo),this._moveManipulation.angle=Ds(o),this._moveManipulation.radius=ll.radiusForSymbol(a.graphic?.symbol)}else{let e=a.visible;this._moveManipulation.xyManipulation.available=e,this._moveManipulation.xyAxisManipulation.available=e,this._moveManipulation.zManipulation.available=e&&this.enableZVertex&&Os(this._operations,this.object.elevationInfo),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=e&&t!==1;let n=0;if(r!=null){let e=r.handle.pos,t=i==null?r.handle.leftSegment?.leftVertex?r.handle.leftSegment.leftVertex.pos:null:i.handle.pos,a=i==null&&r.handle.rightSegment?.rightVertex?r.handle.rightSegment.rightVertex.pos:null;t&&a?this._moveManipulation.xyAxisManipulation.available=!1:t?n=Gl(t,e):a&&(n=Gl(e,a))}this._moveManipulation.angle=n,this._moveManipulation.radius=Sc}t!==0&&n?(u(e,e,1/t),Jl.spatialReference=this._operations.data.spatialReference,Jl.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(e,Jl),this._moveManipulation.elevationAlignedLocation=Jl):this._outlineVisualElement==null||this.object.isDraped||this._outlineVisualElement.attachmentOrigin==null?tl(this._moveManipulation,this.object):this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin}_removeVertices(e){let t=[],n=this._operations;if(n){for(let r of e){let e=r.handle.part;if(r.type===`vertex`&&n.canRemoveVertex(e)){t.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftSegment)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightSegment));let i=n.removeVertices([r.handle]),a=i.removedVertices?.[0].createdSegment;a&&a.type===`line`?this._createVertexOrEdgeManipulator(a):this.enableEdgeOffset&&e.vertices.length<=2&&this._removeManipulator(this._getManipulatorInfoFromHandle(e.segments[0]))}}if(t.length>0){let e=t.map(e=>{let t=n.data.parts.indexOf(e.part);return{coordinates:n.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:e.index}}),r=this._updateEventState(2);if(this.destroyed||(this.events.emit(`vertex-remove`,{type:`vertex-remove`,object:this.object,removed:e.map(e=>e.coordinates),vertices:e}),this.destroyed)||r&&(this._updateEventState(0),this.destroyed))return;this._updateMoveManipulationPosition()}}}_moveVertices(e,t,n=t.action===`start`?0:1){let r=this._operations;if(r){e.length>0&&r.moveVertices(e.map(e=>e.handle),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);for(let t of e)this._updateManipulatorPosition(t)}}_offsetEdge(e,t,n){if(!this._operations)return;let r=t.clone();r.distance=n,this._operations.updateVertices([e.handle.leftVertex,e.handle.rightVertex],r),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}_manipulatorClickCallback(e,t){e.shiftKey||this._clearSelection(),t.type===`vertex`&&(t.manipulator.selected=!t.manipulator.selected,this.enableDeleteVertices&&e.button===Vl.Right&&this._removeVertices([t])),t.type===`edge`&&e.button===Vl.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}_updateTranslateTooltip(e,t){this._defaultTooltipInfo==null?this._updateTranslateObjectTooltip(e,t):this._resetTooltip()}_updateTranslateObjectTooltip(e,t){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=Rl(e,t,this._tooltipsContext))}_updateEdgeOffsetTooltip(e){this._pendingEdgeOffsetInfo||(this.activeTooltipInfo=Bl(this.object,e,this._tooltipsContext))}_resetTooltip(){let e=this.activeTooltipInfo;if(this._pendingEdgeOffsetInfo&&e?.type===`reshape-edge-offset`)return;let t=null;t=this._pendingEdgeOffsetInfo||this._findActiveEdgeOffsetManipulatorInfo()!=null?Bl(this.object,null,this._tooltipsContext):this._defaultTooltipInfo,t!==e&&(e!=null&&t!=null&&this.tooltip.mode===`input`||(this.activeTooltipInfo=t))}get _defaultTooltipInfo(){switch(this._operations?.data.type){case`polyline`:case`polygon`:return this._selectedVertexManipulatorInfo?this.tooltipInfos.selectedVertex:null;case`point`:case`mesh`:return this.tooltipInfos.movePoint;default:return null}}get _selectedVertexManipulatorInfo(){let e=this._manipulatorInfos.filter(e=>e.type===`vertex`&&e.manipulator.selected);return e.length===1?e[0]:null}get _tooltipsContext(){let{tooltipInfos:e,activeTooltipInfo:t,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:r}=this;return{sketchOptions:this._sketchOptions,tooltipInfos:e,activeTooltipInfo:t,selectedVertexManipulatorInfo:this._selectedVertexManipulatorInfo,callbacks:this._tooltipCallbacks,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:r}}get test(){}};function Ul(){return e=>{let{operation:t,mapEnd:n}=e;return t==null||n==null?e:{...e,signedDistance:t.signedDistanceToPoint(n)}}}function Wl(e){let t=e.size/2,n=t+e.collisionPadding;return{size:t/n,outlineSize:(t+e.outlineSize)/n}}function Gl(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}function Kl(e){return new bt({x:0,y:0,z:0,spatialReference:e})}function ql(e){return e.type===`edge`&&`edgeManipulator`in e}k([d()],q.prototype,`_numGrabbing`,void 0),k([d()],q.prototype,`_numDragging`,void 0),k([d()],q.prototype,`_pendingEdgeOffsetInfo`,void 0),k([d()],q.prototype,`_operations`,null),k([d()],q.prototype,`_segmentLabels`,void 0),k([d({constructOnly:!0})],q.prototype,`tool`,void 0),k([d()],q.prototype,`tooltip`,void 0),k([d()],q.prototype,`activeTooltipInfo`,void 0),k([d({readOnly:!0})],q.prototype,`updating`,null),k([d()],q.prototype,`manipulators`,null),k([d()],q.prototype,`view`,null),k([d()],q.prototype,`automaticAreaMeasurementUtils`,null),k([d()],q.prototype,`automaticLengthMeasurementUtils`,null),k([d()],q.prototype,`object`,null),k([d()],q.prototype,`enableZShape`,null),k([d()],q.prototype,`enableDeleteVertices`,null),k([d()],q.prototype,`enableZVertex`,null),k([d()],q.prototype,`autoHideManipulators`,null),k([d()],q.prototype,`enableMoveObject`,null),k([d()],q.prototype,`enableMidpoints`,null),k([d()],q.prototype,`enableEdgeOffset`,null),k([d()],q.prototype,`_sketchOptions`,null),k([d()],q.prototype,`_accentColor`,null),k([d()],q.prototype,`_tooltipsContext`,null),q=k([x(`esri.views.3d.interactive.editingTools.reshape.ReshapeOperation`)],q);var Jl=on(0,0,void 0,Ft.WGS84),Yl=D(),Xl=1e-6,Zl=16,Ql=32,J=class extends Br{constructor(e){super(e),this._reshapeOperation=null,this.events=new gt,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveObject=!0,this.enableDeleteVertices=!0,this.autoHideManipulators=!1,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type=`reshape-3d`,this.sketchOptions=new Kn,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){let e=this._reshapeOperation=new q({tool:this});this.addHandles([e.events.on(`reshape`,e=>this.events.emit(`reshape`,e)),e.events.on(`move`,e=>this.events.emit(`move`,e)),e.events.on(`vertex-add`,e=>this.events.emit(`vertex-add`,e)),e.events.on(`vertex-remove`,e=>this.events.emit(`vertex-remove`,e)),e.events.on(`immediate-click`,e=>this.events.emit(`immediate-click`,{...e,object:this.object})),this.view.on(`pointer-down`,[`Shift`],e=>e.stopPropagation())]),this.finishToolCreation()}destroy(){this._reshapeOperation=P(this._reshapeOperation)}get updating(){return((this.object.updating??!1)||this._reshapeOperation?.updating||this.snappingManager?.updating)??!1}get activeTooltipInfo(){return this._reshapeOperation?.activeTooltipInfo??null}get tooltip(){return this._reshapeOperation?.tooltip??null}onManipulatorSelectionChanged(){this._reshapeOperation?.onManipulatorSelectionChanged()}recordUndo(e,t){this._reshapeOperation?.recordUndo({apply:e,undo:t,accumulate:()=>!1})}get canUndo(){return this._reshapeOperation?.canUndo??!1}undo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.undo()}get canRedo(){return this._reshapeOperation?.canRedo??!1}redo(){this.snappingManager?.doneSnapping(),this._reshapeOperation?.redo()}onInputEvent(e){let t=this._reshapeOperation;t&&!t.enterInputModeIfAvailable(e)&&this.enableDeleteVertices&&e.type===`key-down`&&Ce.delete.includes(e.key)&&t.removeSelectedVertices()>0&&e.stopPropagation()}reset(){}};k([d()],J.prototype,`_reshapeOperation`,void 0),k([d({constructOnly:!0})],J.prototype,`view`,void 0),k([d({constructOnly:!0})],J.prototype,`automaticAreaMeasurementUtils`,void 0),k([d({constructOnly:!0})],J.prototype,`automaticLengthMeasurementUtils`,void 0),k([d({constructOnly:!0})],J.prototype,`object`,void 0),k([d()],J.prototype,`enableZShape`,void 0),k([d()],J.prototype,`enableZVertex`,void 0),k([d()],J.prototype,`enableMoveObject`,void 0),k([d()],J.prototype,`enableDeleteVertices`,void 0),k([d()],J.prototype,`autoHideManipulators`,void 0),k([d()],J.prototype,`enableMidpoints`,void 0),k([d()],J.prototype,`enableEdgeOffset`,void 0),k([d()],J.prototype,`type`,void 0),k([d({type:Kn})],J.prototype,`sketchOptions`,void 0),k([d()],J.prototype,`snappingManager`,void 0),k([d()],J.prototype,`updating`,null),k([d()],J.prototype,`activeTooltipInfo`,null),k([d()],J.prototype,`tooltip`,null),k([d()],J.prototype,`automaticManipulatorSelection`,void 0),J=k([x(`esri.views.3d.interactive.editingTools.reshape.ReshapeTool3D`)],J);var Y=class extends Re{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([t(()=>{let e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null},({interactionState:e})=>{this._updateMeshRotation(e)},Fe),t(()=>{let e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null},({interactionState:e})=>{this._updateMeshSize(e)},Fe)])}get geometry(){let e=U(this.object);return e?.type===`mesh`?e:null}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){let e=this.geometry?.transform;if(e==null)return this._interactionState?.angle??0;let t=Wt(e.rotation)[2];return Math.abs(t)>.999999?Je(Ut(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){let e=new $l({angle:this.angle});this._interactionState=e;let t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(e){let{geometry:t}=this;if(t==null)return;let{angle:n,previousAngle:r}=e;e.previousAngle=n;let i=Ne(n-r);t.rotate(0,0,i)}_updateMeshSize(e){let{geometry:t}=this;if(t==null)return;let{scale:n,previousScale:r}=e;e.previousScale=n;let i=n/r;t.scale(i)}};k([d({constructOnly:!0})],Y.prototype,`object`,void 0),k([d()],Y.prototype,`geometry`,null),k([d({constructOnly:!0})],Y.prototype,`viewingMode`,void 0),k([d()],Y.prototype,`initialAngle`,null),k([d()],Y.prototype,`angle`,null),k([d()],Y.prototype,`angleClockwise`,null),k([d()],Y.prototype,`relativeAngle`,null),k([d()],Y.prototype,`relativeAngleClockwise`,null),k([d()],Y.prototype,`scale`,null),k([d()],Y.prototype,`_interactionState`,void 0),Y=k([x(`esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter`)],Y);var $l=class extends Re{get state(){let{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};k([d()],$l.prototype,`angle`,void 0),k([d()],$l.prototype,`initialAngle`,void 0),k([d()],$l.prototype,`previousAngle`,void 0),k([d()],$l.prototype,`previousScale`,void 0),k([d()],$l.prototype,`scale`,void 0),k([d()],$l.prototype,`state`,null),$l=k([x(`esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState`)],$l);var X=class extends Re{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(t(()=>this._interactionState==null?null:this._interactionState.state,e=>{this._updateSymbol(e)},Fe))}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){return this._interactionState==null?this._orientationReferenceSymbolLayer==null?0:eu(this._orientationReferenceSymbolLayer.heading??0):this._interactionState.angle}get angleClockwise(){return-this.angle}get orientation(){return this.angle}get orientationClockwise(){return this.angleClockwise}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}get size(){let e=this._sizeReferenceSymbolLayer;if(e==null)return null;let t=this.findLayerView(),n=this._graphicSymbol;if(t==null||n==null||n.type!==`point-3d`)return null;let r=t.getSymbolLayerSize(n,e);if(`size`in r&&r.size!=null)return r.size;let i=this.sizeAxis;return!(`width`in r)||r.width==null||i!=null&&i!==`width`&&i!==`all`&&i!==`width-and-depth`?!(`depth`in r)||e.depth==null||i!=null&&i!==`depth`&&i!==`all`&&i!==`width-and-depth`?!(`height`in r)||e.height==null||i!=null&&i!==`height`&&i!==`all`?null:r.height:r.depth:r.width}get _sizeReferenceSymbolLayer(){let e=this._graphicSymbol;return e==null||e.symbolLayers.length===0?null:e.symbolLayers.find(e=>e.type===`object`)}get _orientationReferenceSymbolLayer(){let e=this._graphicSymbol;return e==null||e.symbolLayers.length===0?null:e.symbolLayers.find(e=>e.type===`object`&&e.heading!=null)}get _graphicSymbol(){return this.graphic?.symbol!=null&&this.graphic.symbol.type===`point-3d`?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){let e=this._graphicSymbol,t=this.findLayerView();if(this._interactionState!=null||e==null||t==null)return tu;let n=e.symbolLayers.map(n=>n.type===`object`?t.getSymbolLayerSize(e,n):null).toArray(),r=e.clone(),i=this.angle,a=new nu({originalSymbol:r,angle:i,initialSizes:n});this._interactionState=a;let o=()=>{this._interactionState=null};return{state:a,done:o,cancel:()=>{this._graphicSymbol=r,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:n=>{t=n.symbol,n.symbol=e},redo:n=>{e=n.symbol,n.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:n,initialSizes:r}){let i=this._graphicSymbol;if(i==null||i.type!==`point-3d`)return;let a=i.clone(),o=-Ne(t-this.initialAngle),s=!1;this._forEachObjectSymbolLayerPair(n,a,(t,n,i)=>{let a=(t.heading??0)+o;n.heading!==a&&(n.heading=a,s=!0);let c=r[i];if(c!=null&&`width`in c){c.width=this.sizeFilter(c.width),c.height=this.sizeFilter(c.height),c.depth=this.sizeFilter(c.depth);let t=c.width*e;n.width!==t&&(n.width=t,s=!0);let r=c.depth*e;n.depth!==r&&(n.depth=r,s=!0);let i=c.height*e;n.height!==i&&(n.height=i,s=!0)}}),s&&(this._graphicSymbol=a)}_forEachObjectSymbolLayerPair(e,t,n){e.symbolLayers.forEach((e,r)=>{let i=t.symbolLayers.at(r);e.type===`object`&&i.type===`object`&&n(e,i,r)})}};function eu(e){return-Je(e)}k([d()],X.prototype,`initialAngle`,null),k([d()],X.prototype,`angle`,null),k([d()],X.prototype,`angleClockwise`,null),k([d()],X.prototype,`orientation`,null),k([d()],X.prototype,`orientationClockwise`,null),k([d()],X.prototype,`relativeAngle`,null),k([d()],X.prototype,`relativeAngleClockwise`,null),k([d()],X.prototype,`scale`,null),k([d()],X.prototype,`size`,null),k([d()],X.prototype,`sizeAxis`,void 0),k([d({constructOnly:!0})],X.prototype,`graphic`,void 0),k([d()],X.prototype,`_interactionState`,void 0),k([d({constructOnly:!0})],X.prototype,`findLayerView`,void 0),k([d({constructOnly:!0})],X.prototype,`sizeFilter`,void 0),k([d()],X.prototype,`_sizeReferenceSymbolLayer`,null),k([d()],X.prototype,`_orientationReferenceSymbolLayer`,null),k([d()],X.prototype,`_graphicSymbol`,null),X=k([x(`esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter`)],X);var tu={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}},nu=class extends Re{get state(){let{originalSymbol:e,angle:t,initialAngle:n,scale:r,initialSizes:i}=this;return{originalSymbol:e,angle:t,initialAngle:n,scale:r,initialSizes:i}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}};k([d()],nu.prototype,`originalSymbol`,void 0),k([d()],nu.prototype,`angle`,void 0),k([d()],nu.prototype,`initialAngle`,void 0),k([d()],nu.prototype,`initialSizes`,void 0),k([d()],nu.prototype,`scale`,void 0),k([d()],nu.prototype,`state`,null),nu=k([x(`esri.views.3d.interactive.editingTools.transform.ScaleRotateObjectSymbol3DAdapter.InteractionState`)],nu);var Z={ScaleIn:32,ScaleOut:64,RotateLeft:128,RotateRight:256,Unlocked:1024,DelayedFocused:2048},ru=class extends Re{get angle(){return this.adapter.angle}get scale(){return this.adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}get updating(){return!!this._activeAnimation}constructor(e){super(e),this.mode=null,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new gt,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>this._scaleRotateDragData?.mode===`scale`?this.adapter.scale:1}initialize(){this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this.addHandles([A(()=>{let{adapter:e}=this;return[e.angle,e.scale]},()=>this._updateManipulatorTransform())])}destroy(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=null,this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null}startAnimation(e){this.cancelActiveAnimation(),e.start();let t=rt({update:({deltaTime:t})=>{e.update(t)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){this._activeAnimation?.frameTask.remove(),this._activeAnimation=P(this._activeAnimation)}forEachManipulator(e){e(this._ringManipulator,4)}_createManipulator(){let e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);let t=this.tool.object,n=zr(e,(e,n,r)=>{this._scaleRotateDragData=null;let i=this.adapter.startInteraction(),a={mode:`none`,origin:qe(e.renderLocation),initialAngle:this.adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=a,this._updateDragState();let o=R.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(e.renderLocation,o),n.next(Ac(this.tool.view,Xt(e.renderLocation,o,Zt()))).next(e=>{let n=Jt(e.plane),r=Qc(e.renderStart,e.renderEnd,a.origin,n),o=Ae.shortestSignedDiff(a.angle,r);a.angleDir=Ge(a.angleDir+o,-.3,Dc),a.angle=r;let s=iu(a,e),c=s-this.adapter.scale;if(a.scaleDir=Ge(a.scaleDir+c,-.2,.2),this._onScaleChanged(),a.mode===`none`){let n=this.mode||au(e,e.plane,a.origin,this.tool.view.state.camera);if(n!=null){switch(n){case`rotate`:this.tool.events.emit(`rotate-start`,{object:t,angle:0}),this.tool.events.emit(`record-undo`,{updates:[this.adapter.createUndoRecord()]});break;case`scale`:this.tool.events.emit(`scale-start`,{object:t,xScale:1,yScale:1}),this.tool.events.emit(`record-undo`,{updates:[this.adapter.createUndoRecord()]})}a.mode=n}}switch(a.mode){case`rotate`:i.state.angle=a.initialAngle+r;break;case`scale`:i.state.scale=s,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),e.action){case`start`:case`update`:switch(a.mode){case`rotate`:this.tool.events.emit(`rotate`,{object:t,angle:Ne(a.angle)});break;case`scale`:this.tool.events.emit(`scale`,{object:t,xScale:s,yScale:s})}break;case`end`:switch(a.mode){case`rotate`:this.tool.events.emit(`rotate-stop`,{object:t,angle:Ne(a.angle)});break;case`scale`:this.tool.events.emit(`scale-stop`,{object:t,xScale:s,yScale:s})}}return e.action===`end`&&(this.startAnimation(su(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),i.done()),e}),r.next(()=>{if(i.cancel(),this._scaleRotateDragData!=null){switch(this._scaleRotateDragData.mode){case`none`:break;case`rotate`:this.tool.events.emit(`rotate-stop`,{object:t,angle:0});break;case`scale`:this.tool.events.emit(`scale-stop`,{object:t,xScale:1,yScale:1})}this.startAnimation(su(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}})});this.addHandles([n,e.events.on(`focus-changed`,e=>{e.action===`focus`?this.startAnimation(cu(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),e.events.on(`immediate-click`,e=>{e.stopPropagation()}),A(()=>this.tool.object.visible,e=>this._ringManipulator.available=e,O)])}_onScaleChanged(){this.events.emit(`scale-changed`),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(Z.DelayedFocused,this.getFocused())}_updateDragState(){if(this._ringManipulator.updateStateEnabled(Z.Unlocked,!(this._scaleRotateDragData!=null&&this._scaleRotateDragData?.mode!==`none`)),this._scaleRotateDragData!=null)switch(this._scaleRotateDragData.mode){case`rotate`:this._ringManipulator.updateStateEnabled(Z.ScaleIn|Z.ScaleOut,!1),this._ringManipulator.updateStateEnabled(Z.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(Z.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case`scale`:this._ringManipulator.updateStateEnabled(Z.RotateLeft|Z.RotateRight,!1),this._ringManipulator.updateStateEnabled(Z.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(Z.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(Z.ScaleIn|Z.ScaleOut|Z.RotateLeft|Z.RotateRight,!1)}_updateManipulatorTransform(){let e=s(L.get(),this.adapter.angle,N(0,0,1));if(e==null)return;let t=this.getScale(),n=st(L.get(),S(R.get(),t,t,t));this._ringManipulator.modelTransform=he(L.get(),n,e)}_createRingManipulator(){let e=(e,t,n)=>{let r=[],i=Math.ceil(128*(t-e)/(2*Math.PI));for(let a=0;a<i+1;a++){let o=e+a*(t-e)/i;r.push(N(n*Math.cos(o),n*Math.sin(o),0))}return r},t=t=>e(0,2*Math.PI,t),n=e=>[[-e/2,0],[e/2,0],[e/2,Cc/2],[-e/2,Cc/2]],r=this._createMaterial(1),i=(e,t,i=r)=>_a(i,n(t),e,[],[],!1),a=t(160),o=i(a,24),s={left:[],right:[]},c=[];for(let t=0;t<2;t++){let n=t*Math.PI-Math.PI/4,a=Math.PI/2-wc,o=n+a,l=n+Math.PI/2-a,u=e(o,l,190),d=i(u,9);c.push(u),c.push(e(o,l,213-24/2)),s.left.push(d),s.right.push(d.instantiate());for(let e=0;e<2;e++){let t=e===0,n=C();if(t){nt(n,n,[1,-1,1]),p(n,n,-o,[0,0,1]);let e=Math.round(Ec*(u.length-1));n[12]=u[e][0],n[13]=u[e][1],n[14]=u[e][2]}else{p(n,n,l,[0,0,1]);let e=Math.round((1-Ec)*(u.length-1));n[12]=u[e][0],n[13]=u[e][1],n[14]=u[e][2]}let i=ya(r,60,0,23,Cc);ma(i,n),(t?s.left:s.right).push(i)}}let l=[];for(let t=0;t<2;t++){let n=t*Math.PI-Math.PI/4,r=Math.PI/2-Tc,a=n+r,o=n+Math.PI/2-r,s=e(a,o,213);l.push(i(s,9))}let u=this._createMaterial(.66),d=this._createMaterial(.5),f=this._createMaterial(.33),m=t(190),h=t(213),g=i(m,9,u),_=i(h,9,f),v=t(130),ee=t(107),te=i(v,9,u),ne=i(ee,9,f),re=[new G(o,Z.DelayedFocused),new G(o.instantiate({material:d}),0)];this.mode&&this.mode!==`scale`||(re=re.concat([...l.map(e=>new G(e,Z.DelayedFocused|Z.Unlocked)),new G(g,Z.DelayedFocused|Z.ScaleIn),new G(_,Z.DelayedFocused|Z.ScaleIn),new G(te,Z.DelayedFocused|Z.ScaleOut),new G(ne,Z.DelayedFocused|Z.ScaleOut)])),this.mode&&this.mode!==`rotate`||(re=re.concat([...s.right.map(e=>new G(e.instantiate(),Z.DelayedFocused|Z.Unlocked)),...s.left.map(e=>new G(e,Z.DelayedFocused|Z.RotateLeft)),...s.right.map(e=>new G(e,Z.DelayedFocused|Z.RotateRight))]));let ie=[a,...c];return new W({view:this.tool.view,renderObjects:re,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:this.tool.object.elevationInfo,collisionType:{type:`ribbon`,paths:ie,direction:N(0,0,1)}})}_createMaterial(e){let t=new ia({cullFace:2,renderOccluded:2,isDecoration:!0});return this.addHandles(A(()=>Dn(this.tool.view.effectiveTheme.accentColor,e),e=>t.setParameters({color:e}),O)),t}get test(){}};function iu(e,t){let n=I(R.get(),t.renderStart,e.origin),r=I(R.get(),t.renderEnd,e.origin),i=tt(n),a=tt(r);return i===0?0:a/i}function au(e,t,n,r){let{renderStart:i,renderEnd:a}=e,o=ou(i,r,R.get()),s=ou(a,r,R.get());if(ve(o,s)<100)return null;let c=I(R.get(),i,n),l=F(R.get(),c,Jt(t)),u=i,d=b(R.get(),u,l),f=ou(n,r,R.get()),p=o,m=ou(d,r,R.get()),h=I(R.get(),m,p),g=I(R.get(),o,f),_=Pn(p,h),v=Pn(f,g);return Nn(_,s)<Nn(v,s)?`rotate`:`scale`}function ou(e,t,n){return t.projectToScreen(e,lu),S(n,lu[0],lu[1],0)}function su(e,t){let n=null,r=1,i=()=>r;return{start:()=>{r=e.getScale(),n=e.getScale,e.getScale=i,t()},update:e=>(r+=((r+1)/2-r)*Math.min(e*3,1),t(),Math.abs(r-1)<.01?1:0),destroy:()=>{n&&(e.getScale=n),t()}}}function cu(e,t,n){let r=0,i=null,a=()=>!1;return{start:()=>{i=e.getFocused,e.getFocused=a,r=0,t()},update:e=>(r+=e,!i?.()||r>=n.delayMs?1:0),destroy:()=>{i&&(e.getFocused=i),t()}}}k([d({constructOnly:!0})],ru.prototype,`tool`,void 0),k([d({constructOnly:!0})],ru.prototype,`adapter`,void 0),k([d({constructOnly:!0})],ru.prototype,`sketchOptions`,void 0),k([d()],ru.prototype,`mode`,void 0),k([d()],ru.prototype,`_activeAnimation`,void 0),k([d()],ru.prototype,`updating`,null),ru=k([x(`esri.views.3d.interactive.editingTools.transform.ScaleRotateTransform`)],ru);var lu=Se(),uu=class extends pr(Gr){constructor(e){super(e),this.type=`transform-mesh`,this.orientation=gr(),this.scale=ur(),this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic,orientation:this.orientation.actual,scale:this.scale.actual}}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};k([d()],uu.prototype,`key`,null),k([d()],uu.prototype,`allFields`,null),uu=k([x(`esri.views.interactive.tooltip.infos.TransformMeshTooltipInfo`)],uu);var du=class extends pr(Gr){constructor(e){super(e),this.type=`transform-point`,this.orientation=gr({readOnly:!0}),this.size=yr({readOnly:!0}),this.allFields.forEach(e=>{e.lockable=!1,e.setActual(null)})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.size]}};k([d()],du.prototype,`allFields`,null),du=k([x(`esri.views.interactive.tooltip.infos.TransformPointTooltipInfo`)],du);var Q=class extends Br{constructor(e){super(e),this.events=new gt,this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.sketchOptions=new Kn,this.type=`transform-3d`,this._updatingHandles=new yt,this._scaleRotate=null}initialize(){let{events:e,object:t,view:n}=this;this.tooltip=Kr(()=>({view:n,options:this.sketchOptions.tooltips})),this._moveManipulation=new ll({tool:this,view:n,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Os(t.operations,t.elevationInfo),radius:ll.radiusForSymbol(t.graphic?.symbol)}),this._moveManipulation.forEachManipulator(t=>this.addHandles(t.events.on(`immediate-click`,t=>{e.emit(`immediate-click`,{...t,object:this.object}),t.stopPropagation()})));let r=t.elevationInfo;if(this._moveManipulation.elevationInfo=r,this.addHandles(Wo(t)),this._moveManipulation.createManipulatedObjectDragPipeline((e,i,a,o,s)=>{if(e===0){let{snappingStep:e,cancelSnapping:i}=Tr({snappingContext:new vr({elevationInfo:r,pointer:s,editGeometryOperations:_r.fromGeometry(new bt({spatialReference:t.operations?.data.spatialReference}),n.state.viewingMode),visualizer:new Ro,excludeFeature:t.graphic}),snappingManager:this.snappingManager,updatingHandles:this._updatingHandles,useZ:!1});o=o.next(i),a=a.next(Hr(this.view,r)).next(...e)}return{steps:a,cancel:o}},t,t=>{let{action:n,object:r,dxScreen:i,dyScreen:a}=t,o={object:r,dxScreen:i,dyScreen:a};switch(n){case`start`:this._emitRecordUndo(),e.emit(`translate-start`,o);break;case`update`:e.emit(`translate`,o);break;case`end`:e.emit(`translate-stop`,o)}}),this._moveManipulation.angle=this._scaleRotate==null?0:this._scaleRotate.angle,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.addHandles(A(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){let e=this.enableScaling&&this.enableRotation?null:this.enableScaling?`scale`:`rotate`;this._scaleRotate=new ru({tool:this,mode:e,adapter:this._scaleRotateAdapter,sketchOptions:this.sketchOptions}),this.addHandles(this._scaleRotate.events.on(`scale-changed`,()=>this._onScaleChanged()))}this.addHandles([bc({view:this.view,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>T()}),t.on(`committed`,()=>this._onGeometryChanged()),this._hideManipulatorsForObjectState(),A(()=>n.scale,()=>this._updateMoveAngle())].filter(ae)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(e=>{e instanceof W&&this.addHandles(e.events.on(`grab-changed`,()=>this._updateManipulatorsInteractive()))});let i=n?.type,{sketchOptions:a}=this;this._meshTooltipInfo=new uu({viewType:i,sketchOptions:a}),this._pointTooltipInfo=new du({viewType:i,sketchOptions:a});let o={object:t,dxScreen:0,dyScreen:0},s={onBeforeUpdate:()=>this.endDrag(),onMoveStart:()=>{this._emitRecordUndo(),e.emit(`translate-start`,{...o})},onMove:()=>e.emit(`translate`,{...o}),onMoveStop:()=>e.emit(`translate-stop`,{...o}),onRotateStart:n=>{this._emitRecordUndo(),e.emit(`rotate-start`,{object:t,angle:n})},onRotate:n=>e.emit(`rotate`,{object:t,angle:n}),onRotateStop:n=>e.emit(`rotate-stop`,{object:t,angle:n}),onScaleStart:(n,r)=>{this._emitRecordUndo(),e.emit(`scale-start`,{object:t,xScale:n,yScale:r})},onScale:(n,r)=>e.emit(`scale`,{object:t,xScale:n,yScale:r}),onScaleStop:(n,r)=>e.emit(`scale-stop`,{object:t,xScale:n,yScale:r})};this.addHandles(As(this.tooltip,this.object,()=>({sketchOptions:this.sketchOptions,activeTooltipInfo:this.activeTooltipInfo,callbacks:s,scaleRotateTransform:this._scaleRotate}))),this.finishToolCreation()}destroy(){this.tooltip.destroy(),this._moveManipulation.destroy(),this._scaleRotate=P(this._scaleRotate),this._scaleRotateAdapter=P(this._scaleRotateAdapter),this._updatingHandles.destroy(),this._set(`view`,null),this._set(`object`,null)}onInputEvent(e){if(!this.destroyed&&!Jr(e,this.tooltip))return super.onInputEvent(e)}_updateManipulatorsInteractive(){this._scaleRotate!=null&&(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return U(this.object)?.type===`mesh`?new Y({object:this.object,viewingMode:this.view.state.viewingMode}):new X({graphic:this.object.graphic,sizeFilter:e=>this._enforceNonZeroSize(e),findLayerView:()=>this.view.allLayerViews.find(e=>e.layer===this.object.graphic?.layer),sizeAxis:this.sketchOptions?.tooltips?.visualVariables?.size?.axis??null})}_forEachManipulator(e){this._moveManipulation?.forEachManipulator(e),this._scaleRotate?.forEachManipulator(e)}_hideManipulatorsForObjectState(){return A(()=>this.object.visible,e=>{this._forEachManipulator(t=>t.available=e),this._moveManipulation.zManipulation.available=e&&this.enableZ&&Os(this.object.operations,this.object.elevationInfo)})}_emitRecordUndo(){this.events.emit(`record-undo`,{updates:[this.object.createUndoRecord()]})}set snapToScene(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set(`snapToScene`,e)}get updating(){return this._updatingHandles.updating||!!this._scaleRotate?.updating}get activeTooltipInfo(){return U(this.object)?.type===`mesh`?this._meshTooltipInfo:this._pointTooltipInfo}set location(e){this._moveManipulation.location=e,this._scaleRotate&&(this._scaleRotate.location=e)}set elevationAlignedLocation(e){this._moveManipulation.elevationAlignedLocation=e,this._scaleRotate&&(this._scaleRotate.elevationAlignedLocation=e)}reset(){}onHide(){this._scaleRotate?.cancelActiveAnimation()}_onScaleChanged(){this._scaleRotate!=null&&(this._moveManipulation.displayScale=this._scaleRotate.getScale())}_updateMoveAngle(){let{view:e}=this,t=e.state.viewingMode===2||e.scale<1e6;this._moveManipulation.angle=t?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){tl(this,this.object)}_enforceNonZeroSize(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}get test(){}};k([d({constructOnly:!0,nonNullable:!0})],Q.prototype,`view`,void 0),k([d({constructOnly:!0,nonNullable:!0})],Q.prototype,`object`,void 0),k([d({constructOnly:!0,nonNullable:!0})],Q.prototype,`enableZ`,void 0),k([d()],Q.prototype,`enableRotation`,void 0),k([d()],Q.prototype,`enableScaling`,void 0),k([d({constructOnly:!0,type:Kn})],Q.prototype,`sketchOptions`,void 0),k([d({value:!1})],Q.prototype,`snapToScene`,null),k([d({constructOnly:!0})],Q.prototype,`snappingManager`,void 0),k([d({readOnly:!0})],Q.prototype,`type`,void 0),k([d({readOnly:!0})],Q.prototype,`updating`,null),k([d()],Q.prototype,`activeTooltipInfo`,null),Q=k([x(`esri.views.3d.interactive.editingTools.transform.TransformTool3D`)],Q);var fu=class extends Xe(v){constructor(e){super(e),this.type=`plane`,this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(e){return this.heading===e.heading&&this.tilt===e.tilt&&this.width===e.width&&this.height===e.height&&Ze(this.position,e.position)}};k([d({type:[`plane`],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],fu.prototype,`type`,void 0),k([d({type:bt,json:{write:{isRequired:!0}}})],fu.prototype,`position`,void 0),k([d({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),it(t=>xt.normalize(e(t),0,!0))],fu.prototype,`heading`,void 0),k([d({type:Number,nonNullable:!0,range:{min:0,max:360},json:{write:{isRequired:!0}}}),it(t=>xt.normalize(e(t),0,!0))],fu.prototype,`tilt`,void 0),k([d({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],fu.prototype,`width`,void 0),k([d({type:Number,nonNullable:!0,range:{min:0},json:{write:{isRequired:!0}}})],fu.prototype,`height`,void 0),fu=k([x(`esri.analysis.SlicePlane`)],fu),be(0,0,0,.04),_t(`mac`);var pu=1.15,mu=1.15;Math.cos(Je(45)),Math.cos(Je(5));var hu=22.5,gu=2.25,_u=.3;C();var vu=class extends Vi{constructor(e,t){super(e,t,na.locations),this.shader=new Gi(ja,()=>a(()=>import(`./SlicePlaneMaterial.glsl-B33FBNWz.js`),__vite__mapDeps([45,46,41,5,6,26,8,37,28,31,27,9,3,12])))}initializePipeline(){return oi({blending:ai,depthTest:{func:513},colorWrite:ii})}};vu=k([x(`esri.views.3d.webgl-engine.shaders.SlicePlaneMaterialTechnique`)],vu);function yu(e,t){return $c(e.basis1,e.basis2,e.origin,t)}function bu(e,t,n,r){let i=t.worldUpAtPosition(e.origin,R.get()),a=R.get();switch(n){case 1:y(a,i);break;case 2:y(a,e.basis1)}return Xt(e.origin,a,r)}function xu(e,t,n,r){let i=tt(r.basis1),a=tt(r.basis2),o=Su(r),s=Cu(r),c=S(R.get(),0,0,0);b(c,u(R.get(),r.basis1,t.direction[0]),u(R.get(),r.basis2,t.direction[1])),b(c,r.origin,c);let l=0,d=1;if(wu(t))t.direction[0]===1&&t.direction[1]===-1?l=Tu:t.direction[0]===1&&t.direction[1]===1?l=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(l=3*Math.PI/2),d=s;else{let e=t.direction[0]===0?2:1;l=e===1?Tu:0,d=(e===1?a:i)-o}let f=Pt(L.get(),l);nt(f,f,S(R.get(),d,d,d)),he(f,n,f),f[12]=0,f[13]=0,f[14]=0,e.modelTransform=f,e.renderLocation=c}function Su(e){let t=tt(e.basis1),n=tt(e.basis2);return _u*Math.min(t,n)}function Cu(e){return Su(e)}function wu(e){return e.direction[0]!==0&&e.direction[1]!==0}Mn();var Tu=Math.PI/2,Eu=class extends W{constructor(e,t){let n=new V({width:1,renderOccluded:4,isDecoration:!0},e.state.isGlobal),r=new ia({cullFace:2,renderOccluded:16,isDecoration:!0}),i=new ia({cullFace:2,renderOccluded:16,isDecoration:!0}),a=new ia({cullFace:2,renderOccluded:16,isDecoration:!0}),o=new ia({writeDepth:!1,cullFace:1,renderOccluded:2,isDecoration:!0});super({view:e,...Du({offsetMode:t,tubeMaterial:r,tipMaterial:i,capMaterial:a,outlineMaterial:o,calloutMaterial:n})}),this._themeHandle=A(()=>e.effectiveTheme.accentColor,e=>{let t=On(e),s=j.toUnitRGBA(e),c=j.toUnitRGBA(t),l=j.toUnitRGBA(j.blendColors(t,e,.4)),u=j.toUnitRGBA(j.blendColors(t,e,.14));n.setParameters({color:s}),r.setParameters({color:u}),i.setParameters({color:c}),a.setParameters({color:l}),o.setParameters({color:s})},O)}destroy(){this._themeHandle.remove(),super.destroy()}};function Du({offsetMode:e,tubeMaterial:t,tipMaterial:n,capMaterial:r,outlineMaterial:i,calloutMaterial:a}){let o=e===0?40:0,s=[N(o,0,-48/2),N(o,0,48/2)],c=Au(s),l=Ou({vertices:s,padding:0,materials:{tube:t,tip:n,cap:r}}),u=Ou({vertices:s,padding:gu,materials:{tube:i,tip:i,cap:i}}),d=Sa(a,[[o,0,0],[o-40,0,0]]),f=Sa(a,[[o,0,0],[o-40,0,0]]);return{renderObjects:[...l.normal.map(e=>new G(e,17)),...u.normal.map(e=>new G(e,17)),new G(d,49),...l.focused.map(e=>new G(e,18)),...u.focused.map(e=>new G(e,18)),new G(f,50)],autoScaleRenderObjects:!1,collisionType:{type:`line`,paths:[c]},collisionPriority:1,radius:11,state:16}}function Ou({vertices:e,padding:t,materials:n}){let r=r=>{let i=e.slice(),a=I(R.get(),i[0],i[1]);M(a,a);let o=I(R.get(),i[i.length-1],i[i.length-2]);if(M(o,o),t>0){let e=u(D(),o,-t);i[i.length-1]=b(e,e,i[i.length-1]);let n=u(D(),a,-t);i[0]=b(n,n,i[0])}let s=r?mu:1,c=hu*s,l=11*s,d=Bt(L.get());if(t>0){let e=c/4,n=S(R.get(),0,e,0),r=1+t/e;ye(d,d,n),nt(d,d,S(R.get(),r,r,r)),ye(d,d,u(n,n,-1/r))}let f=Bt(C()),p=N(0,1,0),m=h(C(),Ht($t.get(),p,o));m[12]=i[i.length-1][0],m[13]=i[i.length-1][1],m[14]=i[i.length-1][2],he(m,m,d);let g=n.tube,_=ku(3*(r?pu:1)+t,i,g);_.transformation=f;let v=[_],ee=n.tip,te=Ca(ee,c,l,24,!1,!1,!0);te.transformation=m,v.push(te);let ne=n.cap,re=Ca(ne,c,l,24,!1,!0,!1);re.transformation=m,v.push(re);let ie=h(C(),Ht($t.get(),p,a));return ie[12]=i[0][0],ie[13]=i[0][1],ie[14]=i[0][2],he(ie,ie,d),v.push(te.instantiate({transformation:ie})),v.push(re.instantiate({transformation:ie})),v};return{normal:r(!1),focused:r(!0)}}function ku(e,t,n){let r=[];for(let t=0;t<12;t++){let n=t/12*2*Math.PI;r.push([Math.cos(n)*e,Math.sin(n)*e])}return _a(n,r,t,[],[],!1)}function Au(e,t){let n=I(D(),e[e.length-1],e[e.length-2]);M(n,n),u(n,n,hu),b(n,n,e[e.length-1]);{let t=I(D(),e[0],e[1]);return M(t,t),u(t,t,hu),b(t,t,e[0]),[t,...e,n]}}var ju=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t,n){this._tool=e,this._bounds=t,this._automaticLengthMeasurementUtils=n,this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null;let r=this._tool,i=r.view;this.moveXYObjectManipulation=new dl({view:i,tool:r,object:this._object}),r.addHandles(this._createMoveXYObjectDragPipeline()),this.moveZManipulator=new Eu(i,0),this.moveZManipulator.state|=32,r.manipulators.add(this.moveZManipulator),r.addHandles(this._createMoveZDragPipeline()),r.addHandles(r.events.on(`translate-stop`,()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null}))}destroy(){this.moveXYObjectManipulation.destroy(),this._tool.manipulators.remove(this.moveZManipulator),this.moveZManipulator.destroy()}forEachManipulator(e){this.moveXYObjectManipulation.forEachManipulator(e),e(this.moveZManipulator,0)}updateManipulators(e,t){let n=this.moveZManipulator,r=ke(L.get(),e,Math.PI);r[12]=0,r[13]=0,r[14]=0,n.modelTransform=r,n.renderLocation=I(R.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.moveXYObjectManipulation.grabbing||this.moveXYObjectManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():null}_computeMoveXYTooltipInfo(){let e=this._tool,t=this._moveXYTooltipInfo??=new Aa({sketchOptions:e.sketchOptions});if(this.moveXYObjectManipulation.dragging){let n=this._bounds,r=n.mapBoundsStart.origin,i=n.mapBounds.origin,{renderSpatialReference:a}=e.view;if(!a)return null;let o=this._automaticLengthMeasurementUtils.autoDistance2D(r,i,a);if(o==null)return null;t.distance=o}else t.distance=Rn;return t}_computeMoveZTooltipInfo(){let e=this._tool,t=this._moveZTooltipInfo??=new pl({sketchOptions:e.sketchOptions});if(this.moveZManipulator.dragging){let n=this._bounds,r=n.mapBoundsStart.origin,i=n.mapBounds.origin,{renderSpatialReference:a}=e.view;if(!a)return null;let o=er(r,i,a);if(o==null)return null;t.distance=o}else t.distance=Rn;return t}_createMoveXYObjectDragPipeline(){return this.moveXYObjectManipulation.createDragPipeline((e,t,n)=>this._buildMoveDragPipeline(t,n))}_createMoveZDragPipeline(){if(!this._operations)return T();let e=this._operations.data.spatialReference;return zr(this.moveZManipulator,(t,n,r)=>{let i=qe(t.renderLocation),a=n.next(Lc(this._tool.view,i,e)).next(Er());this._buildMoveDragPipeline(a,r)})}_buildMoveDragPipeline(e,t){let{_tool:n,_object:r}=this;e.next(e=>(e.action===`start`&&(n.inputState={type:`move`},this._bounds.backupMapBounds(),n.events.emit(`translate-start`,{object:r,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e)).next(Vr()).next(this._updateGeometry()).next(e=>{let t={object:r,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case`start`:case`update`:(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||(e.mapEnd.z??0)-(e.mapStart.z??0))&&n.events.emit(`translate`,t);break;case`end`:n.inputState=null,n.events.emit(`translate-stop`,t)}return e}),t.next(()=>{n.inputState!=null&&n.events.emit(`translate-stop`,{object:r,dxScreen:0,dyScreen:0}),n.cancelDrag()})}_updateGeometry(){let e=this._tool;return t=>{if(e.inputState==null||e.inputState.type!==`move`)return t;let n=t.action===`start`?0:1;if(this._operations){let e=this._operations.move(t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,n);this._bounds.updateMapBoundsFromOperation(e)}return t}}},Mu=`theme-style`;function Nu(e,t){return Lu(Iu(Pu(Fu(e),t)),t.size)}function Pu(e,{accentColor:t,contrastColor:n}){let r=t.toHex(),i=t.a,a=n.toHex(),o=n.a,s=e.getElementsByTagNameNS(`http://www.w3.org/2000/svg`,`style`).namedItem(Mu);return s&&(s.innerHTML=`\n      .contrast-fill { fill: ${a}; fill-opacity: ${o}; }\n      .contrast-stroke { stroke: ${a}; stroke-opacity: ${o};  }\n      .accent-fill { fill: ${r}; fill-opacity: ${i}; }\n      .accent-stroke { stroke: ${r}; stroke-opacity:  ${i}; }`),e}function Fu(e){let t=e.split(`,`)[1],n=atob(t);return new DOMParser().parseFromString(n,`image/svg+xml`)}function Iu(e){let t=new XMLSerializer().serializeToString(e);return`data:image/svg+xml;base64,${btoa(t)}`}function Lu(e,t){let n=new Image(t,t);return n.src=e,n}var Ru=`data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSI1NiIgZmlsbD0ibm9uZSI+PHN0eWxlIGlkPSJ0aGVtZS1zdHlsZSI+LmNvbnRyYXN0LWZpbGx7ZmlsbDojZmZmfS5jb250cmFzdC1zdHJva2V7c3Ryb2tlOiNmZmZ9LmFjY2VudC1maWxse2ZpbGw6I2ZmN2YwMDtmaWxsLW9wYWNpdHk6LjV9PC9zdHlsZT48cGF0aCBkPSJNMjggMGEyOCAyOCAwIDEgMSAwIDU2IDI4IDI4IDAgMCAxIDAtNTYiIGNsYXNzPSJhY2NlbnQtZmlsbCIvPjxwYXRoIHN0cm9rZS13aWR0aD0iNC45OSIgZD0iTTIwLjA1IDQwLjg2YTE1LjA1IDE1LjA1IDAgMCAwIDE3LjE0LTEuNSAxNS4wNSAxNS4wNSAwIDAgMCA0LjQ3LTE2LjY1IDE1LjA1IDE1LjA1IDAgMCAwLTIyLjcyLTcuMTUgMTUuMDUgMTUuMDUgMCAwIDAtNS41IDcuMTUiIGNsYXNzPSJjb250cmFzdC1zdHJva2UiLz48cGF0aCBkPSJtMTAuOTcgMzUuNTcgNS4zOCAxMi4wNyA3Ljc5LTEzLjQ3eiIgY2xhc3M9ImNvbnRyYXN0LWZpbGwiLz48L3N2Zz4=`,zu=64;function Bu(e,t){let{accentColor:n,contrastColor:r,preMultiplyAlpha:i}=t;return e.fromData(`heading-rotate:[accent:${n},contrast:${r},size:${zu}]`,()=>new la(Nu(Ru,{accentColor:n,contrastColor:r,size:zu}),{mipmap:!0,reloadable:!0,preMultiplyAlpha:i}))}function Vu(e){return!!e.update}var Hu=class extends Vi{constructor(e,t){super(e,t,Uu(t).locations),this.shader=new Gi(Ma,()=>a(()=>import(`./ImageMaterial.glsl-zPgAtEKl.js`),__vite__mapDeps([47,48,35,5,6,7,8,28,3,11,36,37,49,38,39,24,40,4,41,26,31,9,10,42,43,23,44,12])))}_getPipelineState(e,t){let{oitPass:n,output:r,hasEmission:i,hasOccludees:a,cullFace:o}=e;return oi({blending:fn(r)?xi(n,!0):null,culling:si(o),depthTest:_i(n),depthWrite:mi(e),drawBuffers:Ci(n,i),colorWrite:ii,stencilWrite:a?ji:null,stencilTest:a?t?ki:Ei:null,polygonOffset:Ni(e)})}initializePipeline(e){return this._occludeePipeline=this._getPipelineState(e,!0),this._getPipelineState(e,!1)}getPipeline(e,t){return t?this._occludeePipeline:super.getPipeline(e)}};function Uu(e){let t=na;return e.perspectiveInterpolation&&(t=t.clone().f32(`perspectiveDivide`)),t}Hu=k([x(`esri.views.3d.webgl-engine.shaders.ImageMaterialTechnique`)],Hu);var Wu=class extends bi{constructor(e){super(),this.draped=e,this.cullFace=0,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.perspectiveInterpolation=!0,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.snowCover=!1}};k([B({count:3})],Wu.prototype,`cullFace`,void 0),k([B()],Wu.prototype,`enableOffset`,void 0),k([B()],Wu.prototype,`writeDepth`,void 0),k([B()],Wu.prototype,`hasOccludees`,void 0),k([B()],Wu.prototype,`terrainDepthTest`,void 0),k([B()],Wu.prototype,`cullAboveTerrain`,void 0),k([B()],Wu.prototype,`perspectiveInterpolation`,void 0);var Gu=class extends Zi{constructor(e){super(e,Ju),this.supportsEdges=!0,this.visible=!0,this.produces=new Map([[2,e=>un(e)],[4,e=>fn(e)&&this.parameters.writeDepth],[9,e=>fn(e)&&!this.parameters.writeDepth],[19,e=>fn(e)||un(e)]]),this._configuration=new Wu(e.draped)}dispose(){this.setParameters({texture:void 0})}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.enableOffset,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.perspectiveInterpolation=this.parameters.perspectiveInterpolation,this._configuration}createGLMaterial(e){return new Ku(e)}createBufferWriter(){return new qu(Uu(this.parameters))}},Ku=class extends dn{constructor(e){super({...e,...e.material.parameters}),this.parameters=e;let t=this._material.parameters.managedTexture;Vu(t)&&e.textures.updater.add(t)}dispose(){this.parameters.textures.updater.remove(this._material.parameters.managedTexture)}beginSlot(e){return this.getTechnique(Hu,e)}},qu=class extends Ai{write(e,t,n,r,i,a){for(let r of this.layout.fields.keys()){let o=n.get(r);if(o)if(r===`perspectiveDivide`){an(o.size===1);let e=i.getField(r,nn);e&&Ti(o,e,a)}else Mi(r,o,e,t,i,a)}return null}},Ju=class extends hi{constructor(e,t){super(),this.managedTexture=e,this.draped=t,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=0,this.opacity=1,this.perspectiveInterpolation=!1}get texture(){return this.managedTexture.texture}},Yu=class extends W{constructor(e,t){let n=kn(e.effectiveTheme.accentColor,.5),r=On(e.effectiveTheme.accentColor),i=t(n,r),a=new Gu({draped:!1,managedTexture:i.managedTexture,writeDepth:!1,renderOccluded:16,isDecoration:!0}),o=Xc.calloutWidth,s=new V({width:o,renderOccluded:4,isDecoration:!0},e.state.isGlobal);super({view:e,...Xu({imageMaterial:a,calloutMaterial:s})}),this._material=a,this._textureHandle=i,this._themeHandle=A(()=>e.effectiveTheme.accentColor,e=>{let n=kn(e,.5),r=On(e),i=this._textureHandle;this._textureHandle=t(n,r),a.setParameters({managedTexture:this._textureHandle.managedTexture}),i?.release(),s.setParameters({color:j.toUnitRGBA(e)})},O)}destroy(){this._textureHandle=Ie(this._textureHandle),this._themeHandle.remove(),this._material.dispose(),super.destroy()}};function Xu({imageMaterial:e,calloutMaterial:t}){let{focusMultiplier:n,calloutLength:r,discRadius:i}=Xc,a=i*n,o=(e,t)=>{let n=[0,1,2,2,3,0];return new Di(t,[[`position`,new cn([r-e,-e,0,r+e,-e,0,r+e,e,0,r-e,e,0],n,3,!0)],[`uv0`,new cn([0,0,1,0,1,1,0,1],n,2,!0)]])},s=Sa(t,[[0,0,0],[r-i,0,0]]),c=Sa(t,[[0,0,0],[r-a,0,0]]);return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:`disc`,direction:[0,0,1],offset:[r,0,0]},focusMultiplier:n,radius:i,renderObjects:[new G(o(i,e),17),new G(s,17),new G(o(a,e),18),new G(c,18)],state:16}}var Zu=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}constructor(e,t,n){this._tool=e,this._bounds=t,this._snapRotation=n,this._rotateTooltipInfo=null,this._startAngle=0,this._endAngle=0;let r=this._tool,i=r.view,a=!i.stage?.renderView.renderingContext.driverTest.svgPremultipliesAlpha.result;this.rotateManipulator=new Yu(i,(e,t)=>Bu(i.stage.textures,{accentColor:e,contrastColor:t,preMultiplyAlpha:a})),r.addHandles([this.rotateManipulator.events.on(`grab-changed`,e=>this._onGrabChanged(e)),this._createRotateDragPipeline(this.rotateManipulator)]),r.manipulators.add(this.rotateManipulator),r.addHandles([r.events.on(`rotate-start`,e=>this._startAngle=e.angle),r.events.on(`rotate`,e=>this._endAngle=e.angle),r.events.on(`rotate-stop`,()=>{this._startAngle=0,this._endAngle=0})])}destroy(){this._tool.manipulators.remove(this.rotateManipulator),this.rotateManipulator.destroy()}forEachManipulator(e){e(this.rotateManipulator,3)}updateManipulators(e,t){let n=this._bounds.mapBounds.plane[2]<0?Math.PI:0,r=re(L.get(),e,n);r[12]=0,r[13]=0,r[14]=0,this.rotateManipulator.modelTransform=r,this.rotateManipulator.renderLocation=b(R.get(),t.origin,t.basis1)}getUpdatedTooltipInfo(){return this.rotateManipulator.focused?this._computeRotateTooltipInfo():null}_computeRotateTooltipInfo(){let e=this._rotateTooltipInfo??=new Pa({sketchOptions:this._tool.sketchOptions});return e.angle=this._startAngle-this._endAngle,e}_onGrabChanged({action:e,screenPoint:t}){let n=this._tool,r=this._bounds;if(e!==`start`||!t)return;let i=bu(r.displayBounds,n.view.renderCoordsHelper,1,Zt()),a=Ls(n.view.state.camera,t);qt(i,a,R.get())&&(r.backupMapBounds(),n.inputState={type:`rotate`,rotatePlane:i})}_createRotateDragPipeline(e){let{_tool:t,_object:n}=this;return zr(e,(e,r,i)=>{let a=t.inputState;a!=null&&(r.next(e=>(e.action===`start`&&t.events.emit(`rotate-start`,{object:n,angle:0}),e)).next(Ac(t.view,a.rotatePlane)).next(this._renderPlaneToAngle()).next(...this._snapRotation()).next(this._updateGeometry()).next(e=>{let r={object:n,angle:Ne(e.rotateAngle)};switch(e.action){case`start`:case`update`:t.events.emit(`rotate`,r);break;case`end`:t.inputState=null,t.events.emit(`rotate-stop`,r)}return e}),i.next(()=>{t.inputState!=null&&t.events.emit(`rotate-stop`,{object:n,angle:0}),t.cancelDrag()}))})}_renderPlaneToAngle(){return e=>{let t=Qc(e.renderStart,e.renderEnd,this._bounds.displayBounds.origin,Jt(e.plane));return{...e,rotateAngle:t}}}_updateGeometry(){let e=this._bounds;return t=>{let n=y(D(),e.mapBoundsStart.origin),r=t.action===`start`?0:1;if(this._operations){let i=this._operations.rotate(n,t.rotateAngle,r,1);ei(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(i)}return t}}},Qu=class extends W{constructor(e,t){let n=wu(t),r=n?4:1,i=r*2,a={renderOccluded:4,isDecoration:!0},o=new V({...a,width:r},e.state.isGlobal),s=new V({...a,width:i},e.state.isGlobal),c=new V({...a,width:1},e.state.isGlobal);super({view:e,...Zc,...$u({isCorner:n,unfocusedMaterial:o,focusedMaterial:s,outlineMaterial:c})}),this._themeHandle=A(()=>e.effectiveTheme.accentColor,e=>{let t=j.toUnitRGBA(e);o.setParameters({color:t}),s.setParameters({color:t}),c.setParameters({color:t})},O)}destroy(){this._themeHandle.remove(),super.destroy()}};function $u({isCorner:e,unfocusedMaterial:t,focusedMaterial:n,outlineMaterial:r}){let i=e?[N(1,0,0),N(0,0,0),N(0,1,0)]:[N(1,0,0),N(-1,0,0)];return{renderObjects:[new G(Sa(t,i),17),new G(Sa(n,i),18),new G(Sa(r,i),32)],collisionType:{type:`line`,paths:[i]},radius:e?6:4,state:16}}var ed=class{constructor(e,t){this._tool=e,this.mapBounds=ni(),this.mapBoundsStart=ni(),this.displayBounds=ni(),e.addHandles(xe(()=>e.object,`modified-externally`,()=>this._resetMapBounds(),{onListenerAdd:()=>this._resetMapBounds()})),this._onDisplayBoundsChanged=t}get displayBoundsMargin(){let{view:e,object:t}=this._tool,n=U(t),r=e.pointsOfInterest?.centerOnSurfaceFrequent.location??n?.extent?.center;return r?td*e.pixelSizeAt(r):0}backupMapBounds(){ei(this.mapBounds,this.mapBoundsStart)}updateDisplayBounds(){this._calculateDisplayBounds(),this._onDisplayBoundsChanged?.()}updateMapBoundsFromOperation(e){Ir(e,this.mapBounds),this.updateDisplayBounds()}updateMapBoundsFromOperationInverse(e){Nr(e,this.mapBounds),this.updateDisplayBounds()}_resetMapBounds(){this._calculateMapBounds(),this.updateDisplayBounds()}_calculateMapBounds(){let{view:e,attachmentOrigin:t,object:n}=this._tool,r=n.operations?.data;if(!r)return;let i=r.geometry;this.spatialReference=i.spatialReference;let a=Es(i);It(a,a,-1);let o=t?e.pixelSizeAt(t,i.spatialReference):0,s=nd*o,c=r.coordinateHelper.hasZ()&&n.elevationInfo.mode!==`on-the-ground`;Rr(a,r,s,this.mapBounds,c)}_calculateDisplayBounds(){let{view:e,attachmentOrigin:t}=this._tool,n=t?.z??Fi(this.mapBounds.origin,e.elevationProvider,Ri.fromElevationInfo(this._tool.object.elevationInfo),e.renderCoordsHelper);rd(this.mapBounds,n??0,e.renderCoordsHelper,this.spatialReference,this.displayBoundsMargin,this.displayBounds)}},td=10,nd=80;function rd(e,t,n,r,i=0,a){a||=ni();let o=R.get();b(o,e.origin,e.basis1),b(o,o,e.basis2),n.toRenderCoords(o,r,o);let s=R.get();b(s,e.origin,e.basis1),I(s,s,e.basis2),n.toRenderCoords(s,r,s);let c=R.get();I(c,e.origin,e.basis1),I(c,c,e.basis2),n.toRenderCoords(c,r,c);let l=R.get();I(l,e.origin,e.basis1),b(l,l,e.basis2),n.toRenderCoords(l,r,l),b(a.origin,o,s),b(a.origin,a.origin,c),b(a.origin,a.origin,l),u(a.origin,a.origin,.25),I(o,o,a.origin),I(s,s,a.origin),I(c,c,a.origin),I(l,l,a.origin);let d=Dt(R.get(),o,s,.5),f=Dt(R.get(),c,l,.5);u(f,f,-1),Dt(a.basis1,d,f,.5);let p=Dt(R.get(),o,l,.5),m=Dt(R.get(),s,c,.5);u(m,m,-1),Dt(a.basis2,p,m,.5);let h=F(R.get(),a.basis1,a.basis2);F(a.basis2,h,a.basis1),M(a.basis1,a.basis1);let g=Math.max(Math.abs(We(a.basis1,o)),Math.abs(We(a.basis1,s)),Math.abs(We(a.basis1,c)),Math.abs(We(a.basis1,l)));M(a.basis2,a.basis2);let _=Math.max(Math.abs(We(a.basis2,o)),Math.abs(We(a.basis2,s)),Math.abs(We(a.basis2,c)),Math.abs(We(a.basis2,l)));u(a.basis1,a.basis1,g+i),u(a.basis2,a.basis2,_+i);let v=y(R.get(),e.origin);return v[2]=t,n.toRenderCoords(v,r,v),Xt(v,h,a.plane),Yt(a.plane,a.origin,a.origin),ti(a),a}function id(e,t,n,r){return I(cd,I(cd,e.origin,e.basis1),e.basis2),i(sd,cd,e.basis1,2),i(od,sd,e.basis2,2),i(ad,cd,e.basis2,2),cd[2]=sd[2]=od[2]=ad[2]=t,Na({topLeft:ad,topRight:od,bottomRight:sd,bottomLeft:cd,spatialReference:n,automaticLengthMeasurementUtils:r})}var ad=D(),od=D(),sd=D(),cd=D(),ld=class{get _object(){return this._tool.object}get _operations(){return this._object.operations}get zMax(){if(!this._zMaxDirty||!this._operations)return this._zMax;let e=this._operations.data;if(e.geometry.hasZ){let t=e.coordinateHelper;this._zMax=-1/0;for(let n of e.parts)for(let e of n.vertices){let n=t.getZ(e.pos)??0;this._zMax=Math.max(n,this._zMax)}}else this._zMax=0;return this._zMaxDirty=!1,this._zMax}constructor(e,t,n){this._tool=e,this._bounds=t,this._preserveAspectRatioStep=n,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._displayBoundsStart=ni(),this._displayBoundsMarginStart=0,this._zMax=0,this._zMaxDirty=!0;let r=this._tool,i=r.view;this.resizeManipulators=this._resizeHandles.map(e=>{let t=new Qu(i,e);return r.addHandles([t.events.on(`grab-changed`,e=>this._onGrabChanged(e)),this._createResizeDragPipeline(t,e)]),t}),r.manipulators.addMany(this.resizeManipulators),this._operations&&r.addHandles(this._operations.data.on(`change`,()=>{r.inputState?.type!==`resize`&&(this._zMaxDirty=!0)}))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){this.resizeManipulators.forEach(t=>e(t,2))}updateManipulators(e,t){this.resizeManipulators.forEach((n,r)=>{xu(n,this._resizeHandles[r],e,t)})}getUpdatedTooltipInfo(){if(!this.resizeManipulators.some(e=>e.focused))return null;let e=this._tooltipInfo??=new Fa({sketchOptions:this._tool.sketchOptions}),t=id(this._bounds.mapBounds,this.zMax,this._bounds.spatialReference,this._tool.automaticLengthMeasurementUtils);return t&&(e.xSize=t.xSize,e.ySize=t.ySize),this.resizeManipulators.some(e=>e.dragging)||(e.xScale=1,e.yScale=1),e}_onGrabChanged({action:e,screenPoint:t}){let n=this._tool,r=this._bounds;if(e!==`start`||!t)return;let i=Ls(n.view.state.camera,t);qt(r.displayBounds.plane,i,R.get())&&(r.backupMapBounds(),ei(r.displayBounds,this._displayBoundsStart),this._displayBoundsMarginStart=r.displayBoundsMargin,n.inputState={type:`resize`})}_createResizeDragPipeline(e,t){let{_tool:n,_object:r}=this;return zr(e,(e,i,a)=>{n.inputState!=null&&(i.next(e=>(e.action===`start`&&n.events.emit(`scale-start`,{object:r,xScale:1,yScale:1}),{...e,handle:t})).next(Ac(n.view,this._displayBoundsStart.plane)).next(this._renderPlaneToFactors()).next(...this._preserveAspectRatioStep()).next(this._updateGeometry()).next(e=>{let t=this._tooltipInfo;t&&(t.xScale=e.factor1,t.yScale=e.factor2);let i={object:r,xScale:e.factor1,yScale:e.factor2};switch(e.action){case`start`:case`update`:n.events.emit(`scale`,i);break;case`end`:n.inputState=null,n.events.emit(`scale-stop`,i)}return e}),a.next(()=>{n.inputState!=null&&n.events.emit(`scale-stop`,{object:r,xScale:1,yScale:1}),n.cancelDrag()}))})}_renderPlaneToFactors(){let e=this._bounds;return t=>{let n=this._displayBoundsStart,r=t.handle.direction,a=e.displayBoundsMargin,o=this._displayBoundsMarginStart,s=y(R.get(),n.origin);i(s,s,n.basis1,-r[0]),i(s,s,n.basis2,-r[1]);let c=I(R.get(),t.renderEnd,s),l=I(R.get(),t.renderStart,s),u=wu(t.handle),d=Cu(n),f=Cu(e.displayBounds)/d,p=(e,t)=>{if(e===0)return 1;let n=tt(t),r=.5*e*We(t,c)/n,i=r<0?-1:1;u&&(r+=(n-.5*e*We(t,l)/n)*i*f);let s=n<1.5*o?1:ud;return n=Math.max(n-o,ud),i>0&&(r-=a),i*Math.max(i*(r/n),s)};return{...t,factor1:p(r[0],n.basis1),factor2:p(r[1],n.basis2)}}}_updateGeometry(){let e=this._bounds;return t=>{let n=y(D(),e.mapBoundsStart.origin);i(n,n,e.mapBoundsStart.basis1,-t.handle.direction[0]),i(n,n,e.mapBoundsStart.basis2,-t.handle.direction[1]);let r=l(fe(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);pe(r,r);let a=t.action===`start`?0:1;if(this._operations){let i=this._operations.scale(n,r,t.factor1,t.factor2,a,1);ei(e.mapBoundsStart,e.mapBounds),e.updateMapBoundsFromOperation(i)}return t}}},ud=1e-6,dd=class{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let t={...this._lastDragEvent,action:`update`};e&&fd(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;let e=new jr;return this._next=e,[e=>(this._lastDragEvent=e.action===`end`?null:{...e},this._enabled&&fd(e),e),e]}get test(){}};function fd(e){let t=wu(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.handle.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}var pd=class{constructor(){this._lastDragEvent=null,this._next=null,this.incrementRadians=Je(5),this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null&&this._next!=null){let t={...this._lastDragEvent,action:`update`};e&&this._adjustRotation(t),this._next.execute(t)}this._enabled=e}createDragEventPipelineStep(){this._lastDragEvent=null;let e=new jr;return this._next=e,[e=>(this._lastDragEvent=e.action===`end`?null:{...e},this._enabled&&this._adjustRotation(e),e),e]}_adjustRotation(e){e.rotateAngle=Math.round(e.rotateAngle/this.incrementRadians)*this.incrementRadians}},$=class extends Br{get updating(){return!!this.object.updating}constructor(e){super(e),this.events=new gt,this.enableZ=!0,this.enableScaling=!0,this.enableRotation=!0,this.sketchOptions=new Kn,this._preserveAspectRatio=new dd,this._snapRotation=new pd,this.grabbing=!1,this.inputState=null,this._attachmentOrigin=null,this.type=`transform-3d`,this._outlineVisualElement=null}initialize(){let{view:e,object:t}=this,n=this._bounds=new ed(this,()=>this._updateManipulators());this._extentMove=new ju(this,n,this.automaticLengthMeasurementUtils),this._extentScale=new ld(this,n,()=>this._preserveAspectRatio.createDragEventPipelineStep()),this._extentRotate=new Zu(this,n,()=>this._snapRotation.createDragEventPipelineStep()),this.addHandles([A(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._extentMove.moveZManipulator,0)),A(()=>this.enableScaling,()=>this._extentScale.forEachManipulator(e=>this._updateManipulatorAvailability(e,2))),A(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._extentRotate.rotateManipulator,3))]),this._updateManipulators(),this._updateAllManipulatorAvailability();let r=bc({view:e,object:t,forEachManipulator:e=>this._forEachManipulator(e),onManipulatorsChanged:()=>T()});if(r!=null){let{visualElement:e}=r;e instanceof os&&(this._outlineVisualElement=e,this.addHandles(e.events.on(`attachment-origin-changed`,()=>this._bounds.updateDisplayBounds()))),this.addHandles(r)}this.addHandles([t.on(`committed`,()=>this._onGeometryChanged()),A(()=>this.object.visible,()=>this._updateAllManipulatorAvailability()),A(()=>this.object.isDraped,()=>this._graphicDrapedChanged(),O),A(()=>e.pointsOfInterest?.centerOnSurfaceFrequent.location,()=>n.updateDisplayBounds())]),this._forEachManipulator(e=>{this.addHandles(e.events.on(`grab-changed`,()=>{this.grabbing=e.grabbing,this._updateAllManipulatorAvailability()}))}),this._forEachManipulator((e,n)=>{this.addHandles(e.events.on(`immediate-click`,e=>{n===1&&this.events.emit(`immediate-click`,{...e,object:t}),e.stopPropagation()}))}),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._extentMove.destroy(),this._extentScale.destroy(),this._extentRotate.destroy(),this.tooltip.destroy(),this._set(`view`,null),this._set(`object`,null)}_initializeTooltip(){let{view:e}=this;this.tooltip=Kr(()=>({view:e,options:this.sketchOptions.tooltips}));let t=()=>{this.tooltip.info=this._getUpdatedTooltipInfo()};this.addHandles([A(()=>this.sketchOptions.tooltips.effectiveEnabled,t),A(()=>this.preserveAspectRatio,t)]),this._forEachManipulator(e=>{this.addHandles([e.events.on([`focus-changed`,`grab-changed`],t),e.events.on(`drag`,e=>{e.action===`cancel`?this.tooltip.clear():t()})])})}_getUpdatedTooltipInfo(){return this.sketchOptions.tooltips.effectiveEnabled?this._extentMove.getUpdatedTooltipInfo()??this._extentScale.getUpdatedTooltipInfo()??this._extentRotate.getUpdatedTooltipInfo():null}_onGeometryChanged(){this._bounds.updateDisplayBounds()}_graphicDrapedChanged(){this.removeHandles(md),this._bounds.updateDisplayBounds(),this.object.isDraped&&this.addHandles(this.view.elevationProvider.on(`elevation-change`,e=>{this._attachmentOrigin!=null&&we(e.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._bounds.updateDisplayBounds()}),md)}_updateManipulators(){if(!this.visible)return;let e=this._bounds.displayBounds,t=yu(e,L.get());this._extentMove.updateManipulators(t,e),this._extentScale.updateManipulators(t,e),this._extentRotate.updateManipulators(t,e)}_updateAllManipulatorAvailability(){this._forEachManipulator((e,t)=>this._updateManipulatorAvailability(e,t))}_updateManipulatorAvailability(e,t){let n=this.grabbing&&!e.grabbing;if(e.interactive=!n,e instanceof W){let r=this.object.visible,i=this.enableZ&&Os(this.object.operations,this.object.elevationInfo);switch(t){case 3:e.available=r&&this.enableRotation;break;case 2:e.available=r&&(this.enableScaling||this.enableRotation||i),e.interactive=!n&&this.enableScaling,e.state=this.enableScaling?16:32;break;case 0:e.available=r&&i;break;default:e.available=r}}}_forEachManipulator(e){this._extentMove.forEachManipulator(e),this._extentScale.forEachManipulator(e),this._extentRotate.forEachManipulator(e)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(e){this._preserveAspectRatio.enabled=e,this._set(`preserveAspectRatio`,e)}get snapRotation(){return this._snapRotation.enabled}set snapRotation(e){this._snapRotation.enabled=e,this._set(`snapRotation`,e)}get attachmentOrigin(){return this._attachmentOrigin=(this.object.isDraped?null:this._outlineVisualElement?.attachmentOrigin)??this.object.origin??U(this.object)?.extent?.center,this._attachmentOrigin}reset(){}cancelDrag(){if(this.canUndo){let e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}this.inputState=null}get canUndo(){return!!this.object.operations?.canUndo}undo(){if(this.inputState!=null)this.view.activeTool=null;else if(this.canUndo){let e=this.object.operations?.undo();e&&this._bounds.updateMapBoundsFromOperationInverse(e)}}get canRedo(){return!!this.object.operations?.canRedo}redo(){if(this.canRedo){let e=this.object.operations?.redo();e&&this._bounds.updateMapBoundsFromOperation(e)}}get test(){}};k([d()],$.prototype,`updating`,null),k([d({constructOnly:!0,nonNullable:!0})],$.prototype,`view`,void 0),k([d({constructOnly:!0})],$.prototype,`automaticLengthMeasurementUtils`,void 0),k([d({constructOnly:!0,nonNullable:!0})],$.prototype,`object`,void 0),k([d()],$.prototype,`enableZ`,void 0),k([d()],$.prototype,`enableScaling`,void 0),k([d()],$.prototype,`enableRotation`,void 0),k([d({constructOnly:!0,type:Kn})],$.prototype,`sketchOptions`,void 0),k([d()],$.prototype,`preserveAspectRatio`,null),k([d()],$.prototype,`snapRotation`,null),k([d()],$.prototype,`grabbing`,void 0),k([d()],$.prototype,`inputState`,void 0),k([d({readOnly:!0})],$.prototype,`type`,void 0),k([d()],$.prototype,`tooltip`,void 0),$=k([x(`esri.views.3d.interactive.editingTools.transform.ExtentTransformTool`)],$);var md=`draped-elevation-changes`;function hd(e){return e!=null&&e.type===`mesh`?gd(e):_d(e)}function gd(e){return Gt(e.vertexSpace)?vd(e,e.transform,e.vertexSpace):yd(e)}function _d(e){let t=e,n=null;return{undo(e){n=e.geometry,e.geometry=t},redo(e){t=e.geometry,e.geometry=n}}}function vd(e,t,n){let r=t?.clone(),i=qe(n.origin),a=null,o=null;return{undo:()=>{a=e.transform?.clone(),o=qe(n.origin),e.transform=r,e.vertexSpace.origin=i},redo:()=>{r=e.transform?.clone(),i=qe(n.origin),e.transform=a,e.vertexSpace.origin=o}}}function yd(e){let t,n=e.vertexAttributes.clonePositional();return{undo:()=>{t=e.vertexAttributes.clonePositional(),e.vertexAttributes=n},redo:()=>{n=e.vertexAttributes.clonePositional(),e.vertexAttributes=t}}}var bd=Symbol(),xd=class extends Ot{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return yn(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return el(this.view,this.graphic)}constructor(e){super(e),this._updatingHandles=new yt}destroy(){this._operations=P(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new Oa({graphic:this.graphic}),this._graphicState.on(`changed`,()=>this.emit(`committed`)),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add(()=>this.graphic.geometry,e=>{let t=this._operations?.data.geometry;if(e!==t){if(!e||e?.type===`multipoint`||e?.type===`extent`)return P(this._operations),this.removeHandles(bd),void(this._operations=null);if(this._operations?.trySetGeometry(e))this.emit(`modified-externally`);else{P(this._operations),this.removeHandles(bd);let t=_r.fromGeometry(e,this.view.state.viewingMode);this._operations=t,this.addHandles(t.data.on(`change`,()=>this.graphic.geometry=t.data.geometry),bd)}}},Et))}createManipulator(e){return new $r({view:this.view,graphic:this.graphic,...e})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){this.graphic.geometry?.type===`mesh`&&this.graphic.notifyMeshTransformChanged({action:2})}toMap(e){return this.view.toMap(e,{include:[this.graphic]})}createUndoRecord(){let{graphic:{geometry:e}}=this;return hd(e)}};k([d({constructOnly:!0})],xd.prototype,`view`,void 0),k([d({constructOnly:!0})],xd.prototype,`graphic`,void 0),k([d()],xd.prototype,`_operations`,void 0),k([d()],xd.prototype,`operations`,null),k([d()],xd.prototype,`updating`,null),xd=k([x(`esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic`)],xd);export{Cs as DrawGraphicTool3D,$ as ExtentTransformTool,xd as ManipulatedObject3DGraphic,K as MoveTool3D,J as ReshapeTool3D,Q as TransformTool3D};