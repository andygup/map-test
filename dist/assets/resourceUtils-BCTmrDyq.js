const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/resourceUtils-CX-wX1sR.js","assets/resourceUtils-BiMcW5zN.js","assets/index-CZ4oMP1N.js","assets/index-CDgdHpAj.css"])))=>i.map(i=>d[i]);
import{$m as e,BS as t,BT as n,Ww as r,Xw as i,eT as a}from"./index-CZ4oMP1N.js";import{i as o,s}from"./resourceUtils-BiMcW5zN.js";async function c(e,t,n){let r=await u(e,t,n);await d(r,t,n)}async function l(e,t,n,r,i){let a=await u(n,r,i);await e.update({data:t}),await d(a,r,i)}async function u(i,c,l){if(!c?.resources)return;let u=c.portalItem===i.portalItem?new Set(i.paths):new Set;i.paths.length=0,i.portalItem=c.portalItem;let d=new Set(c.resources.toKeep.map(e=>e.resource.path)),f=new Set,p=[];d.forEach(e=>{u.delete(e),i.paths.push(e)});let m=[],h=[],g=[];for(let t of c.resources.toUpdate)if(u.delete(t.resource.path),d.has(t.resource.path)||f.has(t.resource.path)){let{resource:n,content:r,finish:a}=t,c=o(n,e());i.paths.push(c.path),m.push({resource:c,content:await s(r),compress:t.compress}),a&&g.push(()=>a(c))}else{i.paths.push(t.resource.path),h.push({resource:t.resource,content:await s(t.content),compress:t.compress});let e=t.finish;e&&g.push(()=>e(t.resource)),f.add(t.resource.path)}for(let e of c.resources.toAdd)if(i.paths.push(e.resource.path),u.has(e.resource.path))u.delete(e.resource.path);else{m.push({resource:e.resource,content:await s(e.content),compress:e.compress});let t=e.finish;t&&g.push(()=>t(e.resource))}if(m.length||h.length){let{addOrUpdateResources:e}=await t(async()=>{let{addOrUpdateResources:e}=await import(`./resourceUtils-CX-wX1sR.js`);return{addOrUpdateResources:e}},__vite__mapDeps([0,1,2,3]));await e(c.portalItem,m,`add`,l),await e(c.portalItem,h,`update`,l)}if(g.forEach(e=>e()),p.length===0)return u;let _=await r(p);if(a(l),_.length>0)throw new n(`save:resources`,`Failed to save one or more resources`,{errors:_});return u}async function d(e,t,n){if(!e||!t.portalItem)return;let r=[];for(let i of e){let e=t.portalItem.resourceFromPath(i);r.push(e.portalItem.removeResource(e,n))}await i(r)}export{c as n,l as t};