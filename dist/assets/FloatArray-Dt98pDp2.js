import{Ns as e,tD as t}from"./index-BN8X5Ryz.js";import{A as n,B as r,C as i,D as a,E as o,F as s,H as c,I as l,L as u,N as d,O as f,P as p,R as m,S as h,T as g,V as _,W as v,_ as y,a as b,b as x,c as S,d as C,f as w,g as T,h as E,i as D,j as O,l as k,m as A,n as j,o as M,p as N,r as P,s as ee,t as te,u as F,v as I,w as L,x as R,y as z,z as B}from"./BufferView-BW77W5ev.js";import{a as V}from"./Util-BQgFCZvD.js";import{t as H}from"./types-BEunqM4i.js";import{n as U}from"./VertexAttributeLocations-BScEla0R.js";import{t as W}from"./VertexElementDescriptor-Cl_nC_ty.js";function G(e,t=0){let n=e.stride;return Array.from(e.fields.keys()).map(r=>{let i=e.fields.get(r),a=i.constructor.ElementCount,o=K(i.constructor.ElementType),s=i.offset,c=i.optional?.glNormalized??!1,l=i.optional?.integer??!1;return new W(r,a,o,s,n,c,t,l)})}function K(t){switch(t){case`u8`:return e.UNSIGNED_BYTE;case`u16`:return e.UNSIGNED_SHORT;case`u32`:return e.UNSIGNED_INT;case`i8`:return e.BYTE;case`i16`:return e.SHORT;case`i32`:return e.INT;case`f16`:return e.HALF_FLOAT;case`f32`:return e.FLOAT;default:throw Error(`BufferType not supported in WebGL`)}}var q=class e{constructor(e,t){this.layout=e,this.buffer=typeof t==`number`?new ArrayBuffer(t*e.stride):t;for(let t of e.fields.keys()){let n=e.fields.get(t);this[t]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){let n=this[e];return n&&n.elementCount===t.ElementCount&&n.elementType===t.ElementType?n:null}slice(t,n){return new e(this.layout,this.buffer.slice(t*this.stride,n*this.stride))}copyFrom(e,t=0,n=0,r=e.count){let i=this.stride;if(i%4==0){let a=new Uint32Array(e.buffer,t*i,r*i/4);new Uint32Array(this.buffer,n*i,r*i/4).set(a)}else{let a=new Uint8Array(e.buffer,t*i,r*i);new Uint8Array(this.buffer,n*i,r*i).set(a)}return this}get usedMemory(){return this.byteLength}dispose(){}},J=class e{constructor(e){this._stride=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(e=>this._fields.set(e[0],{...e[1],constructor:ne(e[1].constructor)})))}freeze(){return this}get locations(){return U(G(this))}vec2f16(e,t){return this._appendField(e,v?M:j,t),this}vec2f(e,t){return this._appendField(e,j,t),this}vec2f64(e,t){return this._appendField(e,A,t),this}vec3f16(e,t){return this._appendField(e,v?f:R,t),this}vec3f(e,t){return this._appendField(e,R,t),this}vec3f64(e,t){return this._appendField(e,B,t),this}vec4f16(e,t){return this._appendField(e,v?ee:F,t),this}vec4f(e,t){return this._appendField(e,F,t),this}vec4f64(e,t){return this._appendField(e,N,t),this}mat3f(e,t){return this._appendField(e,O,t),this}mat3f64(e,t){return this._appendField(e,d,t),this}mat4f(e,t){return this._appendField(e,h,t),this}mat4f64(e,t){return this._appendField(e,T,t),this}vec4u8(e,t){return this._appendField(e,c,t),this}f16(e,t){return this._appendField(e,v?_:P,t),this}f32(e,t){return this._appendField(e,P,t),this}f64(e,t){return this._appendField(e,r,t),this}u8(e,t){return this._appendField(e,x,t),this}u16(e,t){return this._appendField(e,D,t),this}i8(e,t){return this._appendField(e,I,t),this}vec2i8(e,t){return this._appendField(e,z,t),this}vec2i16(e,t){return this._appendField(e,o,t),this}vec2u8(e,t){return this._appendField(e,p,t),this}vec2u16(e,t){return this._appendField(e,b,t),this}vec4u16(e,t){return this._appendField(e,k,t),this}vec4i16(e,t){return this._appendField(e,a,t),this}u32(e,t){return this._appendField(e,C,t),this}_appendField(e,t,n){this._fields.has(e)&&V(!1,`${e} already added to vertex buffer layout`);let r=t.ElementCount*H(t.ElementType),i=this._stride;this._fields.set(e,{constructor:t,size:r,offset:i,optional:n}),this._alignFields()}_alignFields(){let e=0,t=1;this._fields.forEach(n=>{let r=H(n.constructor.ElementType);e=Math.floor((e+r-1)/r)*r,n.offset=e,e+=n.size,t=Math.max(t,r)}),e=Math.floor((e+t-1)/t)*t,this._stride=e}createBuffer(e){return new q(this,e)}createView(e){return new q(this,e)}clone(){let t=new e;return t._stride=this._stride,t._fields=new Map,this._fields.forEach((e,n)=>t._fields.set(n,e)),t.BufferType=this.BufferType,t}get stride(){return this._stride}get fields(){return this._fields}};function Y(){return new J}var X=class{constructor(e){this.fields=[],e.fields.forEach((e,t)=>{let n={...e,constructor:Q(e.constructor)};this.fields.push([t,n])}),this.stride=e.stride}},Z=[P,j,R,F,O,h,r,A,B,N,d,T,x,p,s,c,D,b,S,k,C,w,E,y,I,z,i,L,g,o,te,a,n,m,u,l];function Q(e){return`${e.ElementType}_${e.ElementCount}`}function ne(e){return $.get(e)}var $=new Map;Z.forEach(e=>$.set(Q(e),e));function re(e,t=!1){return e<=1024?t?Array(e).fill(0):Array(e):new Float32Array(e)}function ie(e){return(Array.isArray(e)?e.length:e.byteLength/8)<=1024?Array.from(e):new Float32Array(e)}function ae(e,t,n){return Array.isArray(e)?e.slice(t,t+n):e.subarray(t,t+n)}export{Y as a,J as i,ae as n,X as o,re as r,G as s,ie as t};