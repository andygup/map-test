import{$T as e,A as t,Ai as n,C as r,CE as i,Di as a,ED as o,JT as s,L as ee,Lx as c,Mi as l,O as u,P as d,Pn as f,QT as p,Qh as te,Qp as m,R as h,Rh as g,S as ne,T as _,U as v,UT as y,Ua as re,Ui as ie,WT as b,_ as x,ba as S,bd as C,ca as w,cp as T,dC as E,ha as D,hv as O,ip as k,jE as A,kD as j,kw as M,pT as N,pd as P,pv as F,sp as I,ta as L,ua as R,vx as z,wp as B,xa as V,ya as H}from"./index-BN8X5Ryz.js";import"./QueueProcessor-D6ozkjY6.js";import"./locationUtils-DIRJcjU5.js";import{a as U,n as W,o as G,s as K,t as q}from"./parquetUtils-C6neaXu0.js";import"./parquet-CCCEcOEs.js";var J=Symbol(`isParquetGraphicOrigin`),Y,ae=class extends S{get[(Y=J,k)](){return this.layer}get[I](){return this.layer}get[V](){return this.layer}constructor(e){super(),this[Y]=!0,this.type=`parquet`,this.layer=e}get id(){return this.layer.id}},X=class extends te{constructor(e){super(e),this.type=`parquet`}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){this._connection?.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{i.getLogger(this).warn(`Failed to update customParameters`)})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:t?.signal})}async queryFeatures(e,t={}){let n=await this.queryFeaturesJSON(e,{signal:t?.signal});return D.fromJSON(n)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:t?.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:t?.signal})}async queryExtent(e,t){if(this.layer.geometryEncoding==null)return i.getLogger(this).warn(`Tried to queryExtent, but source does not have a geometry. Returning null extent.`),{count:0,extent:null};let n=await this._proxy.queryExtent(e.toJSON(),{signal:t?.signal});return{count:n.count,extent:z.fromJSON(n.extent)}}async _initialize(e){this._connection=await H(`ParquetSourceWorker`,{strategy:`dedicated`,signal:e,registryTarget:this}),N(e),this._proxy=this._connection.createInvokeProxy();let{layerDefinition:t,capabilities:n}=await this._proxy.load({urls:this.layer.urls.items,fields:this.layer.fields?.map(e=>e.toJSON()),geometryType:this.layer.geometryType?q(this.layer.geometryType):null,spatialReference:this.layer.spatialReference?.toJSON(),geometryEncoding:this.layer.geometryEncoding?.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});N(e),this.sourceJSON=t,this.capabilities=n}};j([p()],X.prototype,`type`,void 0),j([p({constructOnly:!0})],X.prototype,`layer`,void 0),j([p()],X.prototype,`sourceJSON`,void 0),j([p()],X.prototype,`capabilities`,void 0),X=j([s(`esri.layers.graphics.sources.ParquetSource`)],X);var Z=r(),Q=`__OBJECTID`,oe={types:{key:`type`,base:K,typeMap:{wkb:U,location:G}},json:{name:`layerDefinition.geometryEncoding`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:`geometryEncoding`}}}}},$=class extends L(h(ie(R(d(u(t(ee(re(w(M(g))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.geometryEncoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ae(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=Q,this.operationalLayerType=`ParquetLayer`,this.outFields=null,this.persistenceEnabled=!!o(`parquetlayer-persistence-enabled`),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title=`Parquet`,this.type=`parquet`,this.urls=new O}destroy(){this.source?.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([F(()=>this.urls,e=>this.source?.updateFiles(e.items)),F(()=>this.customParameters,e=>this.source?.setCustomParameters(e))]),this}get capabilities(){return this.source?.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,n,r){let i=e.filter(e=>!(e.name===Q&&e.type===`oid`)).map(e=>e.toJSON(r));A(n,i,t)}get isTable(){return this.geometryEncoding==null&&this.displayOptimization==null}set renderer(e){m(e,this.fieldsIndex),this._set(`renderer`,e)}readUrls(e){return new O(e.type===`files`?e.urls:[])}writeUrls(t,n,r,i){let a=[];if(t?.length){i={blockedRelativeUrls:i?.blockedRelativeUrls};for(let e of t)e=E(e,i),e&&a.push(e)}a.length?n.source={type:`files`,urls:a}:i.messages?.push(new e(`parquet-layer:missing-urls`,`Missing or empty 'urls'`,{layer:this}))}createPopupTemplate(e){return x(this,e)}createQuery(){let e=new P;return e.returnGeometry=!0,e.outFields=[`*`],e}async createSource(e){let t=new X({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();let n=await this.source.queryFeatures(this._normalizeQuery(e),t),r=this.graphicOrigin;if(n?.features)for(let e of n.features)e.layer=e.sourceLayer=this,e.origin=r;return n}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){return P.from(e)??this.createQuery()}async _load(e){let t=await this.createSource(e);this._set(`source`,t),this.read(t.sourceJSON,{origin:`service`}),this.revert([`fields`,`timeInfo`],`service`),m(this.renderer,this.fieldsIndex),B(this.timeInfo,this.fieldsIndex),this.spatialReference??=c.WGS84}};j([p({readOnly:!0,json:{read:!1,write:!1}})],$.prototype,`capabilities`,null),j([p({type:String})],$.prototype,`copyright`,void 0),j([p({readOnly:!0})],$.prototype,`defaultPopupTemplate`,null),j([p()],$.prototype,`displayOptimization`,void 0),j([p({type:[C],json:{name:`layerDefinition.fields`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`fields`}}}})],$.prototype,`fields`,void 0),j([y(`fields`)],$.prototype,`writeFields`,null),j([p(Z.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),j([p(oe)],$.prototype,`geometryEncoding`,void 0),j([p({type:z,json:{name:`extent`}})],$.prototype,`fullExtent`,void 0),j([p({type:W.apiValues,json:{name:`layerDefinition.geometryType`,read:{reader:W.read},write:{writer:W.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:`geometryType`,reader:W.read}}}}})],$.prototype,`geometryType`,void 0),j([p({readOnly:!0,clonable:!1})],$.prototype,`graphicOrigin`,void 0),j([p(l)],$.prototype,`labelsVisible`,void 0),j([p({type:[f],json:{name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:ne},write:!0}})],$.prototype,`labelingInfo`,void 0),j([p(a)],$.prototype,`legendEnabled`,void 0),j([p()],$.prototype,`file`,void 0),j([p({type:String,readOnly:!0})],$.prototype,`objectIdField`,void 0),j([p({type:[`ParquetLayer`]})],$.prototype,`operationalLayerType`,void 0),j([p(Z.outFields)],$.prototype,`outFields`,void 0),j([p(n)],$.prototype,`popupEnabled`,void 0),j([p({type:T,json:{name:`popupInfo`,write:!0}})],$.prototype,`popupTemplate`,void 0),j([p({types:v,json:{name:`layerDefinition.drawingInfo.renderer`,write:!0,origins:{service:{read:{source:`drawingInfo.renderer`}}}}})],$.prototype,`renderer`,null),j([p({type:X,readOnly:!0,cast:null,json:{read:!1}})],$.prototype,`source`,void 0),j([p({type:c,json:{name:`layerDefinition.spatialReference`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:`extent.spatialReference`}}}}})],$.prototype,`spatialReference`,void 0),j([p({type:[_]})],$.prototype,`templates`,void 0),j([p()],$.prototype,`title`,void 0),j([p({json:{read:!1},readOnly:!0})],$.prototype,`type`,void 0),j([p({type:O.ofType(String),json:{name:`source`,write:{isRequired:!0,ignoreOrigin:!0}}})],$.prototype,`urls`,void 0),j([b(`urls`)],$.prototype,`readUrls`,null),j([y(`urls`)],$.prototype,`writeUrls`,null),$=j([s(`esri.layers.ParquetLayer`)],$);var se=$;export{se as default};