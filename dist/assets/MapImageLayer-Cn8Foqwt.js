const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/mapImageLayerUtils-D-mWrzQJ.js","assets/index-ByaFsVj4.js","assets/index-DiFef-Um.css","assets/originUtils-BJaUzj5W.js","assets/utils-rHaxpeMj.js","assets/saveUtils-BB0-rUbr.js"])))=>i.map(i=>d[i]);
import{A as e,AT as t,BS as n,BT as r,Bx as i,DT as a,Dh as o,Ha as s,Hw as c,Jw as l,L as u,Li as d,M as f,N_ as p,O as m,OT as h,Oh as g,RS as _,Rh as v,Yx as y,ax as b,ca as x,fS as S,gD as C,iE as w,iv as T,j as E,jT as D,lT as O,ma as k,oa as A,pa as j,qw as M,ua as N,y as P,zi as F}from"./index-ByaFsVj4.js";import"./memoryEstimations-C5pKF3kD.js";import"./OptimizedGeometry-DX91by73.js";import"./OptimizedFeatureSet-DAaREXtE.js";import"./featureConversionUtils-C045qQF5.js";import"./urlUtils-7tPnOsRB.js";import{n as I}from"./imageBitmapUtils-CDy5KH6H.js";import"./pbf-DnDg_mXE.js";import"./pbfQueryUtils-DJL2m9Vo.js";import"./queryUtils-DQiwQ8xJ.js";import"./query-CshbOYjT.js";import"./executeForIds-l9FUF4hj.js";import"./executeQueryJSON-BmD8vxfs.js";import"./executeQueryPBF-D_cgHlZg.js";import"./QueryTask-DN5wVWiO.js";import{n as L,r as R,t as z}from"./SublayersOwner-BNEBM6Vd.js";import{r as B}from"./sublayerUtils-CdLiCppr.js";import"./floorFilterUtils-CQ-SmVM_.js";import{t as V}from"./ExportImageParameters-BU-oXeYM.js";var H=class extends N(m(e(z(R(j(u(f(s(E(k(x(o)))))))))))){constructor(...e){super(...e),this._exportImageParameters=new V({layer:this}),this.dateFieldsTimeZone=null,this.datesInUnknownTimezone=!1,this.dpi=96,this.elevationInfo=new F({mode:`on-the-ground`}),this.gdbVersion=null,this.imageFormat=`png24`,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType=`ArcGISMapServiceLayer`,this.preferredTimeZone=null,this.sourceJSON=null,this.sublayers=null,this.type=`map-image`,this.url=null,this._debouncedSaveOperations=c(async(e,t,r)=>{let{save:i,saveAs:a}=await n(async()=>{let{save:e,saveAs:t}=await import(`./mapImageLayerUtils-D-mWrzQJ.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5]));switch(e){case 0:return i(this,t);case 1:return a(this,r,t)}})}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`Map Service`]},e).catch(l).then(()=>this._fetchService(t))),Promise.resolve(this)}destroy(){this._exportImageParameters.destroy()}readImageFormat(e,t){let n=t.supportedImageFormatTypes;return n&&n.includes(`PNG32`)?`png32`:`png24`}get loaded(){return super.loaded}get portalItem(){return super.portalItem}set portalItem(e){super.portalItem=e}writeSublayers(e,t,n,r){if(!this.loaded||!e)return;let i=e.slice().reverse().flatten(({sublayers:e})=>e&&e.toArray().reverse()).toArray(),a=!1,o=O(r.origin),s;if(this.capabilities?.operations.supportsExportMap&&this.capabilities?.exportMap?.supportsDynamicLayers){if(o===3){let e=this.createSublayersForOrigin(`service`).sublayers;a=B(i,e,2)}else if(o>3){let e=this.createSublayersForOrigin(`portal-item`);a=B(i,e.sublayers,O(e.origin)),s=e.originWithPartialOverrides}}let c=[],l={writeSublayerStructure:a,...r,minimumWritableOrigin:s},u=a||this.hasVisibleLayersForOrigin(o);i.forEach(e=>{let t=e.write({},l);c.push(t),u||=e.originOf(`visible`)===`user`}),c.some(e=>Object.keys(e).length>1)&&(t.layers=c),u&&(t.visibleLayers=i.filter(e=>e.visible).map(e=>e.id))}createExportImageParameters(e,t,n,r){let a=r?.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian()),this._exportImageParameters.floors=r?.floors??null,this._exportImageParameters.scale=r?.scale||A({extent:e,width:t})*a;let o=this._exportImageParameters.toJSON(),s=!r?.rotation||this.version<10.3?{}:{rotation:-r.rotation},c=e?.spatialReference,l=S(c);if(r?.scale&&e){let n=e.width/t*(i(e?.spatialReference)*y);o.dpi=r.scale/n}o.dpi*=a;let u={};if(r?.timeExtent){let{start:e,end:t}=r.timeExtent.toJSON();u.time=e&&t&&e===t?``+e:`${e??`null`},${t??`null`}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(u.time=`null,null`);return{bbox:e?e.xmin+`,`+e.ymin+`,`+e.xmax+`,`+e.ymax:void 0,bboxSR:l,imageSR:l,size:t+`,`+n,...o,...s,...u}}async fetchImage(e,t,n,r){let{data:i}=await this._fetchImage(`image`,e,t,n,r);return i}async fetchImageBitmap(e,t,n,r){let{data:i,url:a}=await this._fetchImage(`blob`,e,t,n,r);return I(i,a,r?.signal)}async fetchRecomputedExtents(e={}){let t={...e,query:{returnUpdates:!0,f:`json`,...this.customParameters,token:this.apiKey}},{data:n}=await _(this.url,t),{extent:r,fullExtent:i,timeExtent:a}=n,o=r||i;return{fullExtent:o&&b.fromJSON(o),timeExtent:a&&g.fromJSON({start:a[0],end:a[1]})}}loadAll(){return v(this,e=>{e(this.allSublayers),e(this.subtables)})}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}serviceSupportsSpatialReference(e){return P(this,e)}async _fetchImage(e,t,n,i,a){let o={responseType:e,signal:a?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(t,n,i,a),f:`image`,...this.refreshParameters,...this.customParameters,token:this.apiKey}},s=this.parsedUrl.path+`/export`;if(o.query?.dynamicLayers!=null&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new r(`mapimagelayer:dynamiclayer-not-supported`,`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:o.query});try{let{data:e}=await _(s,o);return{data:e,url:s}}catch(e){throw M(e)?e:new r(`mapimagelayer:image-fetch-error`,`Unable to load image: ${s}`,{error:e})}}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:`service`,url:this.parsedUrl});let{data:t,ssl:n}=await _(this.parsedUrl.path,{query:{f:`json`,...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});n&&(this.url=this.url.replace(/^http:/i,`https:`)),this.sourceJSON=t,this.read(t,{origin:`service`,url:this.parsedUrl})}hasVisibleLayersForOrigin(e){return!(e==null||!this.sublayersSourceJSON[e]?.visibleLayers)}};C([a(p(`dateFieldsTimeReference`))],H.prototype,`dateFieldsTimeZone`,void 0),C([a({type:Boolean})],H.prototype,`datesInUnknownTimezone`,void 0),C([a()],H.prototype,`dpi`,void 0),C([a()],H.prototype,`elevationInfo`,void 0),C([a()],H.prototype,`gdbVersion`,void 0),C([a()],H.prototype,`imageFormat`,void 0),C([D(`imageFormat`,[`supportedImageFormatTypes`])],H.prototype,`readImageFormat`,null),C([a({json:{origins:{service:{read:{source:`maxImageHeight`}}}}})],H.prototype,`imageMaxHeight`,void 0),C([a({json:{origins:{service:{read:{source:`maxImageWidth`}}}}})],H.prototype,`imageMaxWidth`,void 0),C([a()],H.prototype,`imageTransparency`,void 0),C([a({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],H.prototype,`isReference`,void 0),C([a({json:{read:!1,write:!1}})],H.prototype,`labelsVisible`,void 0),C([a({type:[`ArcGISMapServiceLayer`]})],H.prototype,`operationalLayerType`,void 0),C([a({json:{read:!1,write:!1}})],H.prototype,`popupEnabled`,void 0),C([a(p(`preferredTimeReference`))],H.prototype,`preferredTimeZone`,void 0),C([a()],H.prototype,`sourceJSON`,void 0),C([a({type:T.ofType(L),json:{write:{ignoreOrigin:!0}}})],H.prototype,`sublayers`,void 0),C([t(`sublayers`,{layers:{type:[L]},visibleLayers:{type:[w]}})],H.prototype,`writeSublayers`,null),C([a({type:[`show`,`hide`,`hide-children`],json:{origins:{"portal-item":{read:!1,write:!1}}}})],H.prototype,`listMode`,void 0),C([a({json:{read:!1},readOnly:!0,value:`map-image`})],H.prototype,`type`,void 0),C([a(d)],H.prototype,`url`,void 0),H=C([h(`esri.layers.MapImageLayer`)],H);var U=H;export{U as default};