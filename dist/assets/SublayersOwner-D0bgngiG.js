const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FeatureLayer-YCRMlWvA.js","assets/index-CzMixifc.js","assets/index-CDgdHpAj.css"])))=>i.map(i=>d[i]);
import{AT as e,Ai as t,Ar as n,BS as r,BT as i,Bn as a,DT as o,En as s,F as c,Ga as l,HT as u,Ha as d,Hp as f,I as p,Ia as m,Jp as h,Nh as g,OT as _,Pi as ee,Pn as te,Qf as ne,RS as v,Ri as re,SC as y,SE as b,U as ie,Vh as ae,W as oe,Y_ as se,Z_ as x,_ as ce,_v as S,aE as le,ax as C,ba as w,cC as ue,cd as T,eT as E,er as de,gD as D,hu as fe,iE as O,iv as k,jT as A,kT as pe,lT as j,ld as M,nE as me,nv as N,pD as he,qS as P,rE as ge,rd as _e,rr as ve,tE as F,uE as I,uT as L,ud as ye,w as be,wr as xe,wx as R,x as Se,xa as z,xd as Ce}from"./index-CzMixifc.js";import{t as we}from"./QueryTask-CVh9qxsU.js";import{n as Te}from"./sublayerUtils-CdLiCppr.js";var Ee=e=>{let n=e,r=class extends n{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=void 0,this._allLayersAndTablesMap=null}readCapabilities(e,t){let n=t.capabilities&&t.capabilities.split(`,`).map(e=>e.toLowerCase().trim());if(!n)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};let r=this.type,i=r!==`tile`&&!!t.supportsDynamicLayers,a=n.includes(`query`),o=n.includes(`map`),s=!!t.exportTilesAllowed,c=n.includes(`tilemap`),u=n.includes(`data`),d=r!==`tile`&&(!t.tileInfo||i),f=r!==`tile`&&(!t.tileInfo||i),p=r!==`tile`,m=r!==`tile`&&i&&t.currentVersion>=11.1,h=t.cimVersion?l.parse(t.cimVersion):null,g=h?.greaterEqual(1,4)??!1,_=h?.greaterEqual(2,0)??!1;return{operations:{supportsExportMap:o,supportsExportTiles:s,supportsIdentify:a,supportsQuery:u,supportsTileMap:c},exportMap:o?{supportsArcadeExpressionForLabeling:g,supportsCIMSymbols:_,supportsDynamicLayers:i,supportsSublayerOrderBy:m,supportsSublayerDefinitionExpression:f,supportsSublayerVisibility:d,supportsSublayersChanges:p}:null,exportTiles:s?{maxExportTilesCount:+t.maxExportTilesCount}:null}}readVersion(e,t){let n=t.currentVersion;return n||=t.hasOwnProperty(`capabilities`)||t.hasOwnProperty(`tables`)?10:t.hasOwnProperty(`supportedImageFormatTypes`)?9.31:9.3,n}async fetchRelatedService(e){let t=this.portalItem;if(!t||!m(t))return null;this._relatedFeatureServicePromise||=t.fetchRelatedItems({relationshipType:`Service2Service`,direction:`reverse`},e).then(e=>e.find(e=>e.type===`Feature Service`)??null,()=>null);let n=await this._relatedFeatureServicePromise;return E(e),n?{itemId:n.id,url:n.url}:null}async fetchSublayerInfo(e,t){let{source:n}=e;if(this?.portalItem&&this.type===`tile`&&n?.type===`map-layer`&&m(this.portalItem)&&e.originIdOf(`url`)<2){let r=await this.fetchRelatedService(t);r&&(e.url=y(r.url,n.mapLayerId.toString()),e.layerItemId=r.itemId)}let{url:r}=e,i;if(n.type===`data-layer`)i=(await v(r,{responseType:`json`,query:{f:`json`,...this.customParameters,token:this.apiKey},...t})).data;else{let a=e.id;n?.type===`map-layer`&&(a=n.mapLayerId);try{i=(await this.fetchAllLayersAndTables(t)).get(a)}catch{}if(r&&e.originIdOf(`url`)>2)try{let e=await this._fetchAllLayersAndTablesFromService(r),t=P(r)?.sublayer??n.mapLayerId,a=structuredClone(e.get(t));if(a!=null){for(let e of[`drawingInfo`,`maxScale`,`minScale`,`name`])delete a[e];i={...i,...a}}}catch{}}return i}async fetchAllLayersAndTables(e){return this._fetchAllLayersAndTablesFromService(this.parsedUrl?.path,e)}async _fetchAllLayersAndTablesFromService(e,t){await this.load(t),this._allLayersAndTablesMap||=new Map;let n=P(e),r=le(this._allLayersAndTablesMap,n?.url.path,()=>v(y(n?.url.path,`/layers`),{responseType:`json`,query:{f:`json`,...this.customParameters,token:this.apiKey}}).then(e=>{let t=new Map,{layers:n,tables:r}=e.data,i=[...n??[],...r??[]];for(let e of i)t.set(e.id,e);return{result:t}},e=>({error:e}))),i=await r;if(E(t),`result`in i)return i.result;throw i.error}};return D([o({readOnly:!0})],r.prototype,`capabilities`,void 0),D([A(`service`,`capabilities`,[`capabilities`,`cimVersion`,`currentVersion`,`exportTilesAllowed`,`maxExportTilesCount`,`supportsDynamicLayers`,`tileInfo`])],r.prototype,`readCapabilities`,null),D([o({json:{read:{source:`copyrightText`}}})],r.prototype,`copyright`,void 0),D([o({type:C})],r.prototype,`fullExtent`,void 0),D([o(ee)],r.prototype,`id`,void 0),D([o({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:`showLegend`},write:{target:`showLegend`}}})],r.prototype,`legendEnabled`,void 0),D([o(t)],r.prototype,`popupEnabled`,void 0),D([o({type:R})],r.prototype,`spatialReference`,void 0),D([o({readOnly:!0})],r.prototype,`version`,void 0),D([A(`service`,`version`,[`currentVersion`,`capabilities`,`tables`,`supportedImageFormatTypes`])],r.prototype,`readVersion`,null),r=D([_(`esri.layers.mixins.ArcGISMapService`)],r),r},De=Symbol(`isMapImageGraphicOriginSymbol`),B,Oe=class extends w{get[(B=De,z)](){return this.layer}constructor(e,t){super(),this[B]=!0,this.type=`map-image`,this.layer=e,this.sublayer=t}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},ke=Symbol(`isTileGraphicOriginSymbol`),V,Ae=class extends w{get[(V=ke,z)](){return this.layer}constructor(e,t){super(),this[V]=!0,this.type=`tile`,this.layer=e,this.sublayer=t}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},H;function U(e){return e?.type===`esriSMS`}function W(e,t,n){let r=n.minimumWritableOrigin||n.origin;return!!r&&e.originIdOf(t)>=j(r)}function G(e,t,n){let r=W(this,t,n);return{ignoreOrigin:!0,allowNull:r,enabled:!!n&&n.layer?.type===`map-image`&&(n.writeSublayerStructure||r)}}function K(e,t,n){return{enabled:!!n&&n.layer?.type===`tile`&&(W(this,t,n)||this._isOverridden(t))}}function q(e,t,n){return{ignoreOrigin:!0,enabled:n&&n.writeSublayerStructure||!1}}function J(e,t,n){return{ignoreOrigin:!0,enabled:!!n?.writeSublayerStructure&&this.originIdOf(t)>2}}function Y(e,t,n){return{ignoreOrigin:!0,enabled:!!n&&(n.writeSublayerStructure||W(this,t,n))}}var je=0,Me=new Set([`layer`,`parent`,`loaded`,`loadStatus`,`loadError`,`loadWarnings`]),X=class extends d(g(ae)){static{H=this}constructor(e){super(e),this.attributeTableTemplate=null,this.capabilities=void 0,this.maxScaleRange={minScale:0,maxScale:0},this.fields=null,this.fullExtent=null,this.geometryType=null,this.globalIdField=null,this.isTable=!1,this.legendEnabled=!0,this.objectIdField=null,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.spatialReference=null,this.title=null,this.typeIdField=null,this.type=`sublayer`,this.types=null,this._lastParsedUrl=null}async load(e){return this.addResolvingPromise(this.reload(e)),this}readCapabilities(e,t){t=t.layerDefinition||t;let{attachment:n,operations:{supportsQuery:r,supportsQueryAttachments:i},query:{supportsFormatPBF:o,supportsOrderBy:s,supportsPagination:c},data:{supportsAttachment:l},queryRelated:u}=a(t,this.url);return{attachment:{supportsOrderByFields:n?.supportsOrderByFields??!1,supportsResize:n?.supportsResize??!1,supportsTypeWildcard:n?.supportsTypeWildcard??!1},exportMap:{supportsModification:!!t.canModifyLayer},operations:{supportsQuery:r,supportsQueryAttachments:i},data:{supportsAttachment:l},query:{supportsFormatPBF:o,supportsOrderBy:s,supportsPagination:c},queryRelated:u}}get defaultPopupTemplate(){return this.createPopupTemplate()}set definitionExpression(e){this._setAndNotifyLayer(`definitionExpression`,e)}get effectiveScaleRange(){let{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}readMaxScaleRange(e,t){return{minScale:(t=t.layerDefinition||t).minScale??0,maxScale:t.maxScale??0}}get fieldsIndex(){return new s(this.fields||[])}set floorInfo(e){this._setAndNotifyLayer(`floorInfo`,e)}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(let e of t.fields)if(e.type===`esriFieldTypeGlobalID`)return e.name}}get graphicOrigin(){if(!this.layer)return null;switch(this.layer.type){case`tile`:return new Ae(this.layer,this);case`map-image`:return new Oe(this.layer,this)}}get id(){return this._get(`id`)??je++}set id(e){this._get(`id`)!==e&&(!1===this.layer?.capabilities?.exportMap?.supportsDynamicLayers?this._logLockedError(`id`,`capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'`):this._set(`id`,e))}readIsTable(e,t){return t.type===`Table`}set labelingInfo(e){this._setAndNotifyLayer(`labelingInfo`,e)}writeLabelingInfo(e,t,n,r){e&&e.length&&(t.layerDefinition={drawingInfo:{labelingInfo:e.map(e=>e.write({},r))}})}set labelsVisible(e){this._setAndNotifyLayer(`labelsVisible`,e)}set layer(e){this._set(`layer`,e),this.sublayers?.forEach(t=>t.layer=e)}set listMode(e){this._set(`listMode`,e)}set minScale(e){this._setAndNotifyLayer(`minScale`,e)}readMinScale(e,t){return t.minScale||t.layerDefinition?.minScale||0}set maxScale(e){this._setAndNotifyLayer(`maxScale`,e)}readMaxScale(e,t){return t.maxScale||t.layerDefinition?.maxScale||0}readObjectIdFieldFromService(e,t){return(t=t.layerDefinition||t).objectIdField?t.objectIdField:t.fields?.find(e=>e.type===`esriFieldTypeOID`)?.name}set opacity(e){this._setAndNotifyLayer(`opacity`,e)}readOpacity(e,t){let{layerDefinition:n}=t;return 1-.01*(n?.transparency??n?.drawingInfo?.transparency??0)}writeOpacity(e,t,n,r){t.layerDefinition={drawingInfo:{transparency:100-100*e}}}set orderBy(e){this._setAndNotifyLayer(`orderBy`,e)}writeParent(e,t){this.parent&&this.parent!==this.layer?t.parentLayerId=me(this.parent.id):t.parentLayerId=-1}get queryTask(){if(!this.layer)return null;let{capabilities:e,fieldsIndex:t,layer:n,url:r}=this,{spatialReference:i}=n,a=`gdbVersion`in n?n.gdbVersion:void 0,o=he(`featurelayer-pbf`)&&e?.query.supportsFormatPBF;return new we({fieldsIndex:t,gdbVersion:a,pbfSupported:o,queryAttachmentsSupported:e?.operations?.supportsQueryAttachments??!1,sourceSpatialReference:i,url:r})}set renderer(e){if(f(e,this.fieldsIndex),e){for(let t of e.symbols)if(Ce(t)){I.getLogger(this).warn(`Sublayer renderer should use 2D symbols`);break}}this._setAndNotifyLayer(`renderer`,e)}get source(){return this._get(`source`)||new M({mapLayerId:this.id})}set source(e){this._setAndNotifyLayer(`source`,e)}get sublayers(){return this._get(`sublayers`)}set sublayers(e){this._handleSublayersChange(e,this._get(`sublayers`)),this._set(`sublayers`,e)}castSublayers(e){return ge(k.ofType(H),e)}writeSublayers(e,t,n){this.sublayers?.length&&(t[n]=this.sublayers.map(e=>e.id).toArray().reverse())}readTitle(e,t){return t.layerDefinition?.name??t.name}readTypeIdField(e,t){let n=(t=t.layerDefinition||t).typeIdField;if(n&&t.fields){n=n.toLowerCase();let e=t.fields.find(e=>e.name.toLowerCase()===n);e&&(n=e.name)}return n}get url(){let e=this.layer?.parsedUrl??this._lastParsedUrl,t=this.source;if(!e)return null;if(this._lastParsedUrl=e,t?.type===`map-layer`)return`${e.path}/${t.mapLayerId}`;let n={layer:JSON.stringify({source:this.source})};return`${e.path}/dynamicLayer?${ue(n)}`}set url(e){this._overrideIfSome(`url`,e)}set visible(e){this._setAndNotifyLayer(`visible`,e)}writeVisible(e,t,n,r){t[n]=this.getAtOrigin(`defaultVisibility`,`service`)||e}clone(){let{store:e}=u(this),t=new H;return u(t).store=e.clone(Me),this.commitProperty(`url`),t._lastParsedUrl=this._lastParsedUrl,t}createPopupTemplate(e){return ce(this,e)}createQuery(){return new _e({returnGeometry:!0,where:this.definitionExpression||`1=1`})}async createFeatureLayer(){if(this.sublayers)return null;let e=(await r(async()=>{let{default:e}=await import(`./FeatureLayer-YCRMlWvA.js`);return{default:e}},__vite__mapDeps([0,1,2]))).default,{layer:t,url:n}=this,a;if(n&&this.originIdOf(`url`)>2)a=new e({url:n});else{if(!t?.parsedUrl)throw new i(`createFeatureLayer:missing-information`,`Cannot create a FeatureLayer without a url or a parent layer`);{let n=t.parsedUrl;a=new e({url:n.path}),n&&this.source&&(this.source.type===`map-layer`?a.layerId=this.source.mapLayerId:a.dynamicDataSource=this.source)}}return t?.refreshInterval!=null&&(a.refreshInterval=t.refreshInterval),this.definitionExpression&&(a.definitionExpression=this.definitionExpression),this.floorInfo&&(a.floorInfo=b(this.floorInfo)),this.originIdOf(`labelingInfo`)>2&&(a.labelingInfo=b(this.labelingInfo)),this.originIdOf(`labelsVisible`)>0&&(a.labelsVisible=this.labelsVisible),this.originIdOf(`legendEnabled`)>0&&(a.legendEnabled=this.legendEnabled),this.originIdOf(`visible`)>0&&(a.visible=this.visible),this.originIdOf(`minScale`)>0&&(a.minScale=this.minScale),this.originIdOf(`maxScale`)>0&&(a.maxScale=this.maxScale),this.originIdOf(`opacity`)>0&&(a.opacity=this.opacity),this.originIdOf(`popupTemplate`)>0&&(a.popupTemplate=b(this.popupTemplate)),this.originIdOf(`renderer`)>2&&(a.renderer=b(this.renderer)),this.source?.type===`data-layer`&&(a.dynamicDataSource=this.source.clone()),this.originIdOf(`title`)>0&&(a.title=this.title),t?.type===`map-image`&&t.originIdOf(`customParameters`)>0&&(a.customParameters=t.customParameters),t?.type===`tile`&&t.originIdOf(`customParameters`)>0&&(a.customParameters=t.customParameters),a}getField(e){return this.fieldsIndex.get(e)}getFeatureType(e){return xe(this.types,this.typeIdField,e)}getFieldDomain(e,t){let n=t?.feature,r=this.getFeatureType(n);if(r){let t=r.domains&&r.domains[e];if(t&&t.type!==`inherited`)return t}return this._getLayerDomain(e)}async queryAttachments(e,t){await this.load();let r=n.from(e),a=this.capabilities;if(!a?.data?.supportsAttachment)throw new i(`queryAttachments:not-supported`,`this layer doesn't support attachments`);let{attachmentTypes:o,objectIds:s,globalIds:c,num:l,size:u,start:d,where:f}=r;if(!a?.operations?.supportsQueryAttachments&&(o?.length>0||c?.length>0||u?.length>0||l||d||f))throw new i(`queryAttachments:option-not-supported`,`when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported`,r);if(!(s?.length||c?.length||f))throw new i(`queryAttachments:invalid-query`,`'objectIds', 'globalIds', or 'where' are required to perform attachment query`,r);return!a?.attachment?.supportsOrderByFields&&r.orderByFields?.length&&(r=r.clone(),r.orderByFields=null),this.queryTask.executeAttachmentQuery(r,t)}async queryFeatureCount(e=this.createQuery(),t){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new i(`queryFeatureCount:not-supported`,`this layer doesn't support queries.`);if(!this.url)throw new i(`queryFeatureCount:not-supported`,`this layer has no url.`);let n=this.layer?.apiKey;return await this.queryTask.executeForCount(e,{...t,query:{...this.layer?.customParameters,token:n}})}async queryFeatures(e=this.createQuery(),t){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new i(`queryFeatures:not-supported`,`this layer doesn't support queries.`);if(!this.url)throw new i(`queryFeatures:not-supported`,`this layer has no url.`);let n=await this.queryTask.execute(e,{...t,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(n?.features){let e=this.graphicOrigin;for(let t of n.features)t.sourceLayer=this,t.origin=e}return n}async queryObjectIds(e=this.createQuery(),t){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new i(`queryObjectIds:not-supported`,`this layer doesn't support queries.`);if(!this.url)throw new i(`queryObjectIds:not-supported`,`this layer has no url.`);let n=this.layer?.apiKey;return await this.queryTask.executeForIds(e,{...t,query:{...this.layer?.customParameters,token:n}})}async queryRelatedFeatures(e,t){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new i(`queryRelatedFeatures:not-supported`,`this layer doesn't support queries.`);if(!this.url)throw new i(`queryRelatedFeatures:not-supported`,`this layer has no url.`);let n=this.layer?.apiKey;return await this.queryTask.executeRelationshipQuery(e,{...t,query:{...this.layer?.customParameters,token:n}})}async queryRelatedFeaturesCount(e,t){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new i(`queryRelatedFeaturesCount:not-supported`,`this layer doesn't support queries.`);if(!this.capabilities.queryRelated.supportsCount)throw new i(`queryRelatedFeaturesCount:not-supported`,`this layer doesn't support query related counts.`);if(!this.url)throw new i(`queryRelatedFeaturesCount:not-supported`,`this layer has no url.`);let n=this.layer?.apiKey;return await this.queryTask.executeRelationshipQueryForCount(e,{...t,query:{...this.layer?.customParameters,token:n}})}async reload(e){if(this.loadStatus===`not-loaded`)return this.load(e).then(()=>{});let{layer:t,url:n}=this;if(!t&&!n)throw new i(`sublayer:missing-layer`,`Sublayer can't be loaded without being part of a layer`,{sublayer:this});let r=t?await t.fetchSublayerInfo(this,e):(await v(n,{query:{f:`json`},...e})).data;r&&(this.sourceJSON={...this.sourceJSON,...r},this.read({layerDefinition:r},{origin:`service`,layer:t,url:fe(n)}))}toExportImageJSON(e){let t={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,type:`mapLayer`}},n=h(e,this.definitionExpression);n!=null&&(t.definitionExpression=n);let r=[`renderer`,`labelingInfo`,`opacity`,`labelsVisible`].reduce((e,t)=>(e[t]=this.originIdOf(t),e),{});if(Object.keys(r).some(e=>r[e]>2)){let e=t.drawingInfo={};if(r.renderer>2&&(e.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>2&&(e.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>2)if(this.labelingInfo){!this.loaded&&this.labelingInfo?.some(e=>!e.labelPlacement)&&I.getLogger(this).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.`,{sublayer:this});let t=this.labelingInfo;this.geometryType!=null&&(t=Se(this.labelingInfo,S.toJSON(this.geometryType))),e.showLabels=!0,e.labelingInfo=t.filter(e=>e.labelPlacement).map(e=>e.toJSON({origin:`service`,layer:this.layer}))}else e.showLabels=!1;r.opacity>2&&(e.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(e.renderer)}return(this.layer?.capabilities?.exportMap?.supportsSublayerOrderBy??!1)&&this.originIdOf(`orderBy`)>2&&(t.orderBy=this.orderBy?.map(e=>e.toJSON())??null),t}_assignDefaultSymbolColors(e){this._forEachSimpleMarkerSymbols(e,e=>{e.color||e.style!==`esriSMSX`&&e.style!==`esriSMSCross`||(e.outline?.color?e.color=e.outline.color:e.color=[0,0,0,0])})}_forEachSimpleMarkerSymbols(e,t){if(e){let n=(`uniqueValueInfos`in e?e.uniqueValueInfos:`classBreakInfos`in e?e.classBreakInfos:null)??[];for(let e of n)U(e.symbol)&&t(e.symbol);`symbol`in e&&U(e.symbol)&&t(e.symbol),`defaultSymbol`in e&&U(e.defaultSymbol)&&t(e.defaultSymbol)}}_setAndNotifyLayer(e,t){let n=this.layer,r=this._get(e),i,a;switch(e){case`definitionExpression`:case`floorInfo`:i=`supportsSublayerDefinitionExpression`;break;case`minScale`:case`maxScale`:case`visible`:i=`supportsSublayerVisibility`;break;case`labelingInfo`:case`labelsVisible`:case`opacity`:case`renderer`:case`source`:i=`supportsDynamicLayers`,a=`supportsModification`;break;case`orderBy`:i=`supportsSublayerOrderBy`,a=`supportsModification`}let o=u(this).getDefaultOrigin();if(o!==`service`){if(i&&!1===this.layer?.capabilities?.exportMap?.[i])return void this._logLockedError(e,`capability not available 'layer.capabilities.exportMap.${i}'`);if(a&&!1===this.capabilities?.exportMap[a])return void this._logLockedError(e,`capability not available 'capabilities.exportMap.${a}'`)}e!==`source`||this.loadStatus===`not-loaded`?(this._set(e,t),o!==`service`&&r!==t&&n?.emit&&n.emit(`sublayer-update`,{propertyName:e,target:this})):this._logLockedError(e,`'source' can't be changed after calling sublayer.load()`)}_handleSublayersChange(e,t){t&&(t.forEach(e=>{e.parent=null,e.layer=null}),this.removeAllHandles()),e&&(e.forEach(e=>{e.parent=this,e.layer=this.layer}),this.addHandles([e.on(`after-add`,({item:e})=>{e.parent=this,e.layer=this.layer}),e.on(`after-remove`,({item:e})=>{e.parent=null,e.layer=null}),e.on(`before-changes`,e=>{(this.layer?.capabilities?.exportMap?.supportsSublayersChanges??1)||(I.getLogger(this).error(new i(`sublayer:sublayers-non-modifiable`,`Sublayer can't be added, moved, or removed from the layer's sublayers`,{sublayer:this,layer:this.layer})),e.preventDefault())})]))}_logLockedError(e,t){let{layer:n,declaredClass:r}=this;I.getLogger(r).error(new i(`sublayer:locked`,`Property '${String(e)}' can't be changed on Sublayer from the layer '${n?.id}'`,{reason:t,sublayer:this,layer:n}))}_getLayerDomain(e){return this.fieldsIndex.get(e)?.domain??null}static{this.test={isMapImageLayerOverridePolicy:e=>e===J||e===q||e===G,isTileImageLayerOverridePolicy:e=>e===K}}};D([o({type:re,json:{name:`attributeTableInfo`,write:{overridePolicy:G},origins:{"web-scene":{write:!1}}}})],X.prototype,`attributeTableTemplate`,void 0),D([o({readOnly:!0})],X.prototype,`capabilities`,void 0),D([A(`service`,`capabilities`,[`layerDefinition.canModifyLayer`,`layerDefinition.capabilities`])],X.prototype,`readCapabilities`,null),D([o()],X.prototype,`defaultPopupTemplate`,null),D([o({type:String,value:null,json:{name:`layerDefinition.definitionExpression`,write:{allowNull:!0,overridePolicy:G}}})],X.prototype,`definitionExpression`,null),D([o({readOnly:!0})],X.prototype,`effectiveScaleRange`,null),D([A(`service`,`maxScaleRange`,[`minScale`,`maxScale`])],X.prototype,`readMaxScaleRange`,null),D([o({type:[ye],json:{origins:{service:{read:{source:`layerDefinition.fields`}}}}})],X.prototype,`fields`,void 0),D([o({readOnly:!0})],X.prototype,`fieldsIndex`,null),D([o({type:ve,value:null,json:{name:`layerDefinition.floorInfo`,read:{source:`layerDefinition.floorInfo`},write:{target:`layerDefinition.floorInfo`,overridePolicy:G},origins:{"web-scene":{read:!1,write:!1}}}})],X.prototype,`floorInfo`,null),D([o({type:C,json:{read:{source:`layerDefinition.extent`}}})],X.prototype,`fullExtent`,void 0),D([o({type:S.apiValues,json:{origins:{service:{name:`layerDefinition.geometryType`,read:{reader:S.read}}}}})],X.prototype,`geometryType`,void 0),D([o({type:String})],X.prototype,`globalIdField`,void 0),D([A(`service`,`globalIdField`,[`layerDefinition.globalIdField`,`layerDefinition.fields`])],X.prototype,`readGlobalIdFieldFromService`,null),D([o({readOnly:!0})],X.prototype,`graphicOrigin`,null),D([o({type:O,json:{write:{ignoreOrigin:!0}}})],X.prototype,`id`,null),D([o({readOnly:!0})],X.prototype,`isTable`,void 0),D([A(`service`,`isTable`,[`type`])],X.prototype,`readIsTable`,null),D([o({value:null,type:[te],json:{read:{source:`layerDefinition.drawingInfo.labelingInfo`},write:{target:`layerDefinition.drawingInfo.labelingInfo`,overridePolicy:J}}})],X.prototype,`labelingInfo`,null),D([e(`labelingInfo`)],X.prototype,`writeLabelingInfo`,null),D([o({type:Boolean,value:!0,json:{read:{source:`layerDefinition.drawingInfo.showLabels`},write:{target:`layerDefinition.drawingInfo.showLabels`,overridePolicy:q}}})],X.prototype,`labelsVisible`,null),D([o({value:null})],X.prototype,`layer`,null),D([o({type:String,json:{write:{overridePolicy:K}}})],X.prototype,`layerItemId`,void 0),D([o({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:`showLegend`},write:{target:`showLegend`,overridePolicy:Y}}})],X.prototype,`legendEnabled`,void 0),D([o({type:[`show`,`hide`,`hide-children`],value:`show`,json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],X.prototype,`listMode`,null),D([o({type:Number,value:0,json:{write:{overridePolicy:q}}})],X.prototype,`minScale`,null),D([A(`minScale`,[`minScale`,`layerDefinition.minScale`])],X.prototype,`readMinScale`,null),D([o({type:Number,value:0,json:{write:{overridePolicy:q}}})],X.prototype,`maxScale`,null),D([A(`maxScale`,[`maxScale`,`layerDefinition.maxScale`])],X.prototype,`readMaxScale`,null),D([o()],X.prototype,`objectIdField`,void 0),D([A(`service`,`objectIdField`,[`layerDefinition.objectIdField`,`layerDefinition.fields`])],X.prototype,`readObjectIdFieldFromService`,null),D([o({type:Number,value:1,json:{write:{target:`layerDefinition.drawingInfo.transparency`,overridePolicy:q}}})],X.prototype,`opacity`,null),D([A(`opacity`,[`layerDefinition.drawingInfo.transparency`,`layerDefinition.transparency`])],X.prototype,`readOpacity`,null),D([e(`opacity`)],X.prototype,`writeOpacity`,null),D([o({value:null,type:[p],json:{name:`layerDefinition.orderBy`,read:{reader:c},write:{overridePolicy:G},origins:{"web-scene":{read:!1,write:!1}}}})],X.prototype,`orderBy`,null),D([o({json:{type:O,write:{target:`parentLayerId`,writerEnsuresNonNull:!0,overridePolicy:q}}})],X.prototype,`parent`,void 0),D([e(`parent`)],X.prototype,`writeParent`,null),D([o({type:Boolean,value:!0,json:{read:{source:`disablePopup`,reader:(e,t)=>!t.disablePopup},write:{target:`disablePopup`,overridePolicy:Y,writer(e,t,n){t[n]=!e}}}})],X.prototype,`popupEnabled`,void 0),D([o({type:ne,json:{read:{source:`popupInfo`},write:{target:`popupInfo`,overridePolicy:Y}}})],X.prototype,`popupTemplate`,void 0),D([o({readOnly:!0})],X.prototype,`queryTask`,null),D([o({type:[de],readOnly:!0,json:{origins:{service:{read:{source:`layerDefinition.relationships`}}}}})],X.prototype,`relationships`,void 0),D([o({types:ie,value:null,json:{name:`layerDefinition.drawingInfo.renderer`,write:{overridePolicy:J},origins:{"web-scene":{types:oe,name:`layerDefinition.drawingInfo.renderer`,write:{overridePolicy:J}}}}})],X.prototype,`renderer`,null),D([o({types:{key:`type`,base:null,typeMap:{"data-layer":T,"map-layer":M}},cast(e){if(e){if(`mapLayerId`in e)return F(M,e);if(`dataSource`in e)return F(T,e)}return e},json:{name:`layerDefinition.source`,write:{overridePolicy:q}}})],X.prototype,`source`,null),D([o()],X.prototype,`sourceJSON`,void 0),D([o({type:R,json:{origins:{service:{read:{source:`layerDefinition.extent.spatialReference`}}}}})],X.prototype,`spatialReference`,void 0),D([o({value:null,json:{type:[O],write:{target:`subLayerIds`,allowNull:!0,overridePolicy:q}}})],X.prototype,`sublayers`,null),D([pe(`sublayers`)],X.prototype,`castSublayers`,null),D([e(`sublayers`)],X.prototype,`writeSublayers`,null),D([o({type:String,json:{name:`name`,write:{overridePolicy:Y}}})],X.prototype,`title`,void 0),D([A(`service`,`title`,[`name`,`layerDefinition.name`])],X.prototype,`readTitle`,null),D([o({type:String})],X.prototype,`typeIdField`,void 0),D([o({json:{read:!1},readOnly:!0,value:`sublayer`})],X.prototype,`type`,void 0),D([A(`typeIdField`,[`layerDefinition.typeIdField`])],X.prototype,`readTypeIdField`,null),D([o({type:[be],json:{origins:{service:{read:{source:`layerDefinition.types`}}}}})],X.prototype,`types`,void 0),D([o({type:String,json:{name:`layerUrl`,write:{overridePolicy:K}}})],X.prototype,`url`,null),D([o({type:Boolean,value:!0,json:{read:{source:`defaultVisibility`},write:{target:`defaultVisibility`,overridePolicy:q}}})],X.prototype,`visible`,null),D([e(`visible`)],X.prototype,`writeVisible`,null),X=H=D([_(`esri.layers.support.Sublayer`)],X);function Z(e,t){let n=[],r={};return e&&e.forEach(e=>{let i=new X;if(i.read(e,t),r[i.id]=i,e.parentLayerId!=null&&e.parentLayerId!==-1){let t=r[e.parentLayerId];t.sublayers||=[],t.sublayers.unshift(i)}else n.unshift(i)}),n}var Q=k.ofType(X);function $(e,t){e&&e.forEach(e=>{t(e),e.sublayers&&e.sublayers.length&&$(e.sublayers,t)})}var Ne=e=>{let t=e,n=class extends t{constructor(...e){super(...e),this.allSublayers=new se({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.sublayersSourceJSON={2:{},3:{},4:{},5:{},6:{}},this.subtables=null,this.addHandles([N(()=>this.sublayers,(e,t)=>this._handleSublayersChange(e,t),x),N(()=>this.subtables,(e,t)=>this._handleSublayersChange(e,t),x)])}destroy(){this.allSublayers.destroy()}readSublayers(e,t){if(!t||!e)return;let{sublayersSourceJSON:n}=this,r=j(t.origin);if(r<2||(n[r]={context:t,visibleLayers:e.visibleLayers||n[r].visibleLayers,layers:e.layers||n[r].layers},r>2))return;this._set(`serviceSublayers`,this.createSublayersForOrigin(`service`).sublayers);let{sublayers:i,origin:a}=this.createSublayersForOrigin(`web-document`),o=u(this);o.setDefaultOrigin(a),this._set(`sublayers`,new Q(i)),o.setDefaultOrigin(`user`)}findSublayerById(e){return this.allSublayers.find(t=>t.id===e)}createServiceSublayers(){return this.createSublayersForOrigin(`service`).sublayers}createSublayersForOrigin(e){let t,n=j(e===`web-document`?`web-map`:e),r=2,i=this.sublayersSourceJSON[2].layers,a=this.sublayersSourceJSON[2].context,o=null,s=[3,4,5].filter(e=>e<=n);for(let e of s){let t=this.sublayersSourceJSON[e];Te(t.layers)&&(r=e,i=t.layers,a=t.context,t.visibleLayers&&(o={visibleLayers:t.visibleLayers,context:t.context}))}let c=[3,4,5].filter(e=>e>r&&e<=n),l=null;for(let e of c){let{layers:n,visibleLayers:r,context:i}=this.sublayersSourceJSON[e];n&&(l={layers:n,context:i},t??=e),r&&(o={visibleLayers:r,context:i})}let u=Z(i,a),d=new Map,f=new Set;if(l)for(let e of l.layers)d.set(e.id,e);if(o?.visibleLayers)for(let e of o.visibleLayers)f.add(e);return $(u,e=>{l&&e.read(d.get(e.id),l.context),o&&e.read({defaultVisibility:f.has(e.id)},o.context)}),{origin:L(r),originWithPartialOverrides:t?L(t):null,sublayers:new Q({items:u})}}read(e,t){super.read(e,t),this.readSublayers(e,t)}_handleSublayersChange(e,t){t&&(t.forEach(e=>{e.parent=null,e.layer=null}),this.removeHandles(`sublayers-owner`)),e&&(e.forEach(e=>{e.parent=this,e.layer=this}),this.addHandles([e.on(`after-add`,({item:e})=>{e.parent=this,e.layer=this}),e.on(`after-remove`,({item:e})=>{e.parent=null,e.layer=null})],`sublayers-owner`),this.type===`tile`&&this.addHandles(e.on(`before-changes`,e=>{I.getLogger(`esri.layers.TileLayer`).error(new i(`tilelayer:sublayers-non-modifiable`,`Sublayer can't be added, moved, or removed from the layer's sublayers`,{layer:this})),e.preventDefault()}),`sublayers-owner`))}};return D([o({readOnly:!0})],n.prototype,`allSublayers`,void 0),D([o({readOnly:!0,type:k.ofType(X)})],n.prototype,`serviceSublayers`,void 0),D([o({value:null,type:Q,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],n.prototype,`sublayers`,void 0),D([o({readOnly:!0})],n.prototype,`sublayersSourceJSON`,void 0),D([o({type:Q,json:{read:{source:`tables`}}})],n.prototype,`subtables`,void 0),n=D([_(`esri.layers.mixins.SublayersOwner`)],n),n};export{X as n,Ee as r,Ne as t};