import{$h as e,Cy as t,DT as n,Dy as r,Ey as i,Fg as a,Jr as o,OT as s,Og as c,Qh as l,Sy as u,Z_ as d,_w as f,c_ as p,gD as m,hb as h,ig as g,kl as _,ky as v,ly as y,nv as b,ov as x,zi as S}from"./index-ByaFsVj4.js";import{n as C}from"./projectPointToVector-DjmX75N6.js";import{s as w}from"./elevationInfoUtils-CyQsBf6_.js";import{t as T}from"./drapedUtils-EsGgYHzF.js";function E(e,n,r,i,a,o,s,c){let l=n??r.leftVertex.pos,d=u(e)?t(l,e):e,[f,p,m,h,g,_,v]=d.a,b=g??0,x=_??Math.hypot(f[0]-p[0],f[1]-p[1]),S=v??1,C=D(i[0],i[1],a[0],a[1],o[0],o[1],s,c);return y(l,{a:[f,p,m,h,b,x,S]},C)}function D(e,t,n,a,o,s,c,l){let u=r(1,0,0,0,1,0,-e,-t,1),d=c-1,f=r(n*n*d+1,a*n*d,0,n*a*d,a*a*d+1,0,0,0,1),p=l-1,m=r(o*o*p+1,s*o*p,0,o*s*p,s*s*p+1,0,0,0,1),h=r(1,0,0,0,1,0,e,t,1),g=i();return v(g,f,u),v(g,m,g),v(g,h,g),g}function O(e){let t=0,n=0,r=0;return e?(e.type===`cim`&&e.data.symbol&&`symbolLayers`in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map(e=>{e.type===`CIMVectorMarker`&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),e.size!=null&&e.size>r&&(r=e.size))}),t=g(t),n=g(n),r=g(r),{offsetX:t,offsetY:n,size:r}):{offsetX:t,offsetY:n,size:r}}var k=class extends f{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set(`graphic`,e),this.attachSymbolChanged()}get elevationInfo(){let{layer:e}=this.graphic,t=e&&`elevationInfo`in e?e.elevationInfo:null,n=w(this.graphic),r=t?t.offset:0;return new S({mode:n,offset:r})}set focusedSymbol(e){e!==this._get(`focusedSymbol`)&&(this._set(`focusedSymbol`,e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get(`grabbing`)&&(this._set(`grabbing`,e),this._updateGraphicSymbol())}set hovering(e){e!==this._get(`hovering`)&&(this._set(`hovering`,e),this._updateGraphicSymbol())}set selected(e){e!==this._get(`selected`)&&(this._set(`selected`,e),this._updateGraphicSymbol(),this.events.emit(`select-changed`,{action:e?`select`:`deselect`}))}get _focused(){return this._get(`hovering`)||this._get(`grabbing`)}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new x,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set(`view`,null)}intersectionDistance(e){let t=this.graphic;if(!1===t.visible)return null;let n=t.geometry;if(n==null)return null;let r=this._get(`focusedSymbol`),i=r??t.symbol;return this.view.type===`2d`?this._intersectDistance2D(this.view,e,n,i):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=b(()=>this.graphic?.symbol,e=>{e!=null&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},d)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,n,r,i){if((i||=o(r))==null)return null;let s=this._circleCollisionCache;if(r.type===`point`&&i.type===`cim`&&i.data.symbol?.type===`CIMPointSymbol`&&i.data.symbol.symbolLayers){let{offsetX:a,offsetY:o,size:s}=O(i),c=e(n,j),l=s/2,u=t.toScreen(r),d=u.x+a,f=u.y+o;return h(c,[d,f])<l*l?1:null}if(r.type!==`point`||i.type!==`simple-marker`)return T(n,r,t)?1:null;if(s==null||!s.originalPoint.equals(r)){let e=r,n=t.spatialReference;if(c(e.spatialReference,n)){let t=a(e,n);s={originalPoint:e.clone(),mapPoint:t,radiusPx:g(i.size)},this._circleCollisionCache=s}}if(s!=null){let r=e(n,j),a=t.toScreen?.(s.mapPoint);if(!a)return null;let o=s.radiusPx,c=a.x+g(i.xoffset),l=a.y-g(i.yoffset);return h(r,[c,l])<o*o?1:null}return null}_intersectDistance3D(e,t,n){let r=e.toMap(t,{include:[n]});return r&&C(r,A,e.renderSpatialReference)?_(A,e.state.camera.eye):null}};m([n({constructOnly:!0,nonNullable:!0})],k.prototype,`graphic`,null),m([n()],k.prototype,`elevationInfo`,null),m([n({constructOnly:!0,nonNullable:!0})],k.prototype,`view`,void 0),m([n({value:null})],k.prototype,`focusedSymbol`,null),m([n({constructOnly:!0})],k.prototype,`layer`,void 0),m([n()],k.prototype,`interactive`,void 0),m([n()],k.prototype,`selectable`,void 0),m([n()],k.prototype,`grabbable`,void 0),m([n({value:!1})],k.prototype,`grabbing`,null),m([n()],k.prototype,`dragging`,void 0),m([n()],k.prototype,`hovering`,null),m([n({value:!1})],k.prototype,`selected`,null),m([n()],k.prototype,`cursor`,void 0),k=m([s(`esri.views.interactive.GraphicManipulator`)],k);var A=p(),j=l();export{E as i,O as n,D as r,k as t};