import{$T as e,BT as t,ED as n,Lx as r,Qh as i,UT as a,VT as o,WT as s,ba as c,bd as l,g as u,ha as d,ip as f,kC as p,kD as m,lC as h,pd as g,sT as _,sp as v,tT as y,uC as b,vx as x,wi as S,xa as C,ya as w,zi as T}from"./index-BN8X5Ryz.js";import"./QueryEngineCapabilities-CxeEdoTy.js";import{i as E}from"./clientSideDefaults-Iizf0eUh.js";var D=Symbol(`isCSVGraphicOrigin`),O,k=class extends c{get[(O=D,f)](){return this.layer}get[v](){return this.layer}get[C](){return this.layer}constructor(e){super(),this[O]=!0,this.type=`csv`,this.layer=e}get id(){return this.layer.id}},A=class extends i{constructor(e){super(e),this.type=`csv`,this.refresh=y(async e=>{await this.load();let{extent:t,timeExtent:n}=await this._connection.invoke(`refresh`,e);return t&&(this.sourceJSON.extent=t),n&&(this.sourceJSON.timeInfo.timeExtent=[n.start,n.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){await this.load(t);let n=await this._connection.invoke(`queryFeatures`,e?e.toJSON():null,t);return d.fromJSON(n)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._connection.invoke(`queryFeatures`,e?e.toJSON():null,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._connection.invoke(`queryFeatureCount`,e?e.toJSON():null,t)}async queryObjectIds(e,t={}){return await this.load(t),this._connection.invoke(`queryObjectIds`,e?e.toJSON():null,t)}async queryExtent(e,t={}){await this.load(t);let n=await this._connection.invoke(`queryExtent`,e?e.toJSON():null,t);return{count:n.count,extent:x.fromJSON(n.extent)}}async querySnapping(e,t={}){return await this.load(t),this._connection.invoke(`querySnapping`,e,t)}async queryAttributeBins(e,t={}){return await this.load(),this._connection.invoke(`queryAttributeBins`,e?e.toJSON():null,t)}async _startWorker(e){this._connection=await w(`CSVSourceWorker`,{strategy:n(`feature-layers-workers`)?`dedicated`:`local`,signal:e,registryTarget:this});let{url:t,delimiter:r,fields:i,latitudeField:a,longitudeField:o,spatialReference:s,timeInfo:c}=this.loadOptions,l=await this._connection.invoke(`load`,{url:t,customParameters:this.customParameters,parsingOptions:{delimiter:r,fields:i?.map(e=>e.toJSON()),latitudeField:a,longitudeField:o,spatialReference:s?.toJSON(),timeInfo:c?.toJSON()}},{signal:e});this.locationInfo=l.locationInfo,this.sourceJSON=l.layerDefinition,this.delimiter=l.delimiter}};m([t()],A.prototype,`type`,void 0),m([t()],A.prototype,`loadOptions`,void 0),m([t()],A.prototype,`customParameters`,void 0),m([t()],A.prototype,`locationInfo`,void 0),m([t()],A.prototype,`sourceJSON`,void 0),m([t()],A.prototype,`delimiter`,void 0),A=m([o(`esri.layers.graphics.sources.CSVSource`)],A);function j(t,n){throw new e(n,`CSVLayer (title: ${t.title}, id: ${t.id}) cannot be saved to a portal item`)}var M=class extends u{constructor(...e){super(...e),this.geometryType=`point`,this.capabilities=E(!1,!1),this.delimiter=null,this.editingEnabled=!1,this.fields=null,this.graphicOrigin=new k(this),this.latitudeField=null,this.locationType=`coordinates`,this.longitudeField=null,this.operationalLayerType=`CSV`,this.outFields=[`*`],this.path=null,this.spatialReference=r.WGS84,this.source=null,this.type=`csv`}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}load(e){let t=e==null?null:e.signal,n=this.loadFromPortal({supportedTypes:[`CSV`],supportsData:!1},e).catch(_).then(async()=>this.initLayerProperties(await this.createGraphicsSource(t)));return this.addResolvingPromise(n),Promise.resolve(this)}get portalItem(){return super.portalItem}set portalItem(e){super.portalItem=e}set fieldConfigurations(e){}get fieldConfigurations(){}get isTable(){return this.loaded&&this.geometryType==null}readWebMapLabelsVisible(e,t){return t.showLabels==null?!!t.layerDefinition?.drawingInfo?.labelingInfo:t.showLabels}writePopupTemplate(e,t,n,r){e&&(t[n]=e.toJSON(r))}set url(e){if(!e)return void this._set(`url`,e);let t=p(e);this._set(`url`,t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async createGraphicsSource(e){let t=new A({loadOptions:{delimiter:this.delimiter,fields:this.fields,latitudeField:this.latitudeField??void 0,longitudeField:this.longitudeField??void 0,spatialReference:this.spatialReference??void 0,timeInfo:this.timeInfo??void 0,url:this.url},customParameters:this.customParameters??void 0});return this._set(`source`,t),await t.load({signal:e}),this.read({locationInfo:t.locationInfo,columnDelimiter:t.delimiter},{origin:`service`,url:this.parsedUrl}),t}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(g.from(e)||this.createQuery())).then(e=>{if(e?.features)for(let t of e.features)t.layer=t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(g.from(e)||this.createQuery())}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(g.from(e)||this.createQuery()))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(g.from(e)||this.createQuery()))}read(e,t){super.read(e,t),t?.origin===`service`&&this.revert([`latitudeField`,`longitudeField`],`service`)}write(e,t){return super.write(e,{...t,writeLayerSchema:!0})}clone(){throw new e(`csv-layer:clone`,`CSVLayer (title: ${this.title}, id: ${this.id}) cannot be cloned`)}async save(e){return j(this,`csv-layer:save`)}async saveAs(e,t){return j(this,`csv-layer:save-as`)}async hasDataChanged(){try{let{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return t!=null&&this.read(t,{origin:`service`,url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}_verifyFields(){}_verifySource(){}_hasMemorySource(){return!1}};m([t(S)],M.prototype,`attributeTableTemplate`,void 0),m([t({type:T})],M.prototype,`elevationInfo`,void 0),m([t({readOnly:!0,json:{read:!1,write:!1}})],M.prototype,`capabilities`,void 0),m([t({type:[`,`,` `,`;`,`|`,`	`],json:{read:{source:`columnDelimiter`},write:{target:`columnDelimiter`,ignoreOrigin:!0}}})],M.prototype,`delimiter`,void 0),m([t({readOnly:!0,type:Boolean,json:{origins:{"web-scene":{read:!1,write:!1}}}})],M.prototype,`editingEnabled`,void 0),m([t({json:{write:!1}})],M.prototype,`fieldConfigurations`,null),m([t({type:[l],json:{read:{source:`layerDefinition.fields`},write:{target:`layerDefinition.fields`}}})],M.prototype,`fields`,void 0),m([t({readOnly:!0})],M.prototype,`graphicOrigin`,void 0),m([t({type:Boolean,readOnly:!0})],M.prototype,`isTable`,null),m([s(`web-map`,`labelsVisible`,[`layerDefinition.drawingInfo.labelingInfo`,`showLabels`])],M.prototype,`readWebMapLabelsVisible`,null),m([t({type:String,json:{read:{source:`locationInfo.latitudeFieldName`},write:{target:`locationInfo.latitudeFieldName`,ignoreOrigin:!0}}})],M.prototype,`latitudeField`,void 0),m([t({type:[`show`,`hide`]})],M.prototype,`listMode`,void 0),m([t({type:[`coordinates`],json:{read:{source:`locationInfo.locationType`},write:{target:`locationInfo.locationType`,ignoreOrigin:!0,isRequired:!0}}})],M.prototype,`locationType`,void 0),m([t({type:String,json:{read:{source:`locationInfo.longitudeFieldName`},write:{target:`locationInfo.longitudeFieldName`,ignoreOrigin:!0}}})],M.prototype,`longitudeField`,void 0),m([t({type:[`CSV`]})],M.prototype,`operationalLayerType`,void 0),m([t()],M.prototype,`outFields`,void 0),m([t({type:String,json:{origins:{"web-scene":{read:!1,write:!1}},read:!1,write:!1}})],M.prototype,`path`,void 0),m([a(`popupTemplate`)],M.prototype,`writePopupTemplate`,null),m([t({type:r})],M.prototype,`spatialReference`,void 0),m([t({json:{read:!1},cast:null,type:A,readOnly:!0})],M.prototype,`source`,void 0),m([t({json:{read:!1},value:`csv`,readOnly:!0})],M.prototype,`type`,void 0),m([t({json:{read:h,write:{isRequired:!0,ignoreOrigin:!0,writer:b}}})],M.prototype,`url`,null),M=m([o(`esri.layers.CSVLayer`)],M);var N=M;export{N as default};