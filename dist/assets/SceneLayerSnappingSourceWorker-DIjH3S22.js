import{Al as e,Cl as t,Nl as n,OT as r,c_ as i,eT as a,f_ as o,gD as s,kl as c,yw as l}from"./index-ByaFsVj4.js";import"./quatf64-eO7UAs9K.js";import"./Indices-CZ754tYW.js";import"./plane-Dmhe_zL4.js";import"./vectorStacks-DhZu7qGn.js";import"./deduplicate-BsMx4rdl.js";import"./BufferView-DuUrcLgU.js";import"./Util-uF9mYnOn.js";import"./types-DsLx34Br.js";import"./ObjectStack-C2IlraSC.js";import"./ray-CUcS4KDu.js";import"./VertexAttributeLocations-BMy2FGBT.js";import"./VertexElementDescriptor-C9CNG143.js";import"./vec3-DP8KhY5h.js";import{t as u}from"./sphere-BCy4W-Wa.js";import{d,o as f,r as p}from"./lineSegment-DXWFDhyj.js";import"./frustum-B2u2I-AJ.js";import{t as m}from"./Octree-C-gqD-Ls.js";import"./FloatArray-CclVVn1u.js";import"./TextureBackedBufferLayout-BKch40yL.js";import"./Normals-DayQW_Jq.js";import{t as h}from"./edgeProcessing-Dad_A-0R.js";var g=1e3;function _(r,i,a){let o=new u;return t(o.center,r,.5),e(o.center,o.center,i,.5),o.radius=c(o.center,r),n(o.center,o.center,a),o}var v=class{constructor(e,t,n){this.objectId=e,this.target=t,this.distance=n}},y=class extends v{constructor(e,t,n){super(e,t,n),this.type=`vertex`}},b=class extends v{constructor(e,t,n,r,i){super(e,t,n),this.start=r,this.end=i,this.type=`edge`}},x=class{constructor(){this._idToComponent=new Map,this._components=new m(e=>e.bounds),this._edges=new m(e=>e.bounds),this._tmpLineSegment=d(),this._tmpP1=i(),this._tmpP2=i(),this._tmpP3=i(),this.remoteClient=null}async fetchCandidates(e,t){await Promise.resolve(),a(t);let n=e;n.mbs=new u(e.mbsJSON),await this._ensureEdgeLocations(n,t);let r=[];return this._edges.forEachNeighbor(e=>(this._addCandidates(n,e,r),r.length<g),n.mbs),{result:{candidates:r}}}async _ensureEdgeLocations(e,t){let n=[];if(this._components.forEachNeighbor(e=>{if(e.info==null){let{id:t,uid:r}=e;n.push({id:t,uid:r})}return!0},e.mbs),!n.length)return;let r={components:n},i=await this.remoteClient.invoke(`fetchAllEdgeLocations`,r,t??{});for(let e of i.components)this._setFetchEdgeLocations(e)}async add(e){let t=new w(e.id,new u(e.bounds));return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){let t=this._idToComponent.get(e.id);if(t){let e=[];this._edges.forEachNeighbor(n=>(n.component===t&&e.push(n),!0),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){let t=this._idToComponent.get(e.id);if(t==null||e.uid!==t.uid)return;let n=h.createView(e.locations),r=Array(n.count),a=i(),o=i();for(let i=0;i<n.count;i++){n.position0.getVec(i,a),n.position1.getVec(i,o);let s=_(a,o,e.origin);r[i]=new T(t,i,s)}this._edges.add(r);let{objectIds:s,origin:c}=e;t.info={locations:n,objectIds:s,origin:c}}_addCandidates(e,t,r){let{info:i}=t.component,{origin:a,objectIds:o}=i,s=i.locations,c=s.position0.getVec(t.index,this._tmpP1),l=s.position1.getVec(t.index,this._tmpP2);n(c,c,a),n(l,l,a);let u=o[s.componentIndex.get(t.index)];this._addEdgeCandidate(e,u,c,l,r),C(e,u,c,r),C(e,u,l,r)}_addEdgeCandidate(e,t,n,r,i){if(!e.returnEdge)return;let a=e.mbs.center,s=f(n,r,this._tmpLineSegment),l=p(s,a,this._tmpP3);e.mbs.contains(l)&&i.push(new b(t,o(l),c(a,l),o(n),o(r)))}};x=s([r(`esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker`)],x);var S=x;function C(e,t,n,r){e.returnVertex&&e.mbs.contains(n)&&r.push(new y(t,o(n),c(e.mbs.center,n)))}var w=class{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=l()}},T=class{constructor(e,t,n){this.component=e,this.index=t,this.bounds=n}};export{S as default};