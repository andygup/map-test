import{RS as e,SC as t,du as n,gC as r,ga as i}from"./index-CzMixifc.js";import{t as a}from"./urlUtils-7tPnOsRB.js";import{t as o}from"./pbfQueryUtils-Dy8pLZgd.js";import{t as s}from"./queryUtils-ByyjBzze.js";var c=`Layer does not support extent calculation.`;function l(e,t,n){return s(e,t,n)}async function u(e,t,n,r,a){let o=t.timeExtent?.isEmpty?{features:[]}:await _(e,t,`json`,r,void 0,a);return i(t,n,o),o}async function d(e,t,n,r,i){if(t.timeExtent?.isEmpty)return n.createFeatureResult();let a=await f(e,t,r,i);return o(a,n)}function f(e,t,n,r){return _(e,t,`pbf`,n,void 0,r)}function p(e,t,n,r){return t.timeExtent?.isEmpty?Promise.resolve({objectIds:[]}):_(e,t,`json`,n,{returnIdsOnly:!0},r)}async function m(e,t,n,r){return t.timeExtent?.isEmpty?0:(await _(e,t,`json`,n,{returnIdsOnly:!0,returnCountOnly:!0},r)).count}async function h(e,t,n){if(t.timeExtent?.isEmpty)return{count:0,extent:null};let r=await _(e,t,`json`,n,{returnExtentOnly:!0,returnCountOnly:!0});if(r.hasOwnProperty(`extent`))return r;let i=typeof e==`string`?e:e.path;if(/\/imageserver\/?$/i.test(i)&&r.hasOwnProperty(`count`)){let i=await _(e,t,`json`,n,{returnExtentOnly:!0});return{count:r.count,extent:i.extent}}if(r.features||r.hasOwnProperty(`count`))throw Error(c);return r}function g(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;let n={...e,returnUniqueIdsOnly:!0};return delete n.returnIdsOnly,n}async function _(t,n,r,i={},a={},o={}){let s=await v(t,n,r,i,a,o),c=r===`json`?`json`:`array-buffer`;return e(s.url,{responseType:c,...s.options}).then(({data:e})=>e)}async function v(e,i,o,s,c={},u={}){let d=typeof e==`string`?r(e):e,f=i.geometry?[i.geometry]:[],p=await n(f,null,{signal:s.signal}),m=p?.[0];if(m!=null){let e=i.clone();e.geometry=m.clone(),i=e}let h=a({...d.query,f:o,...g(c,u),...l(i,c,u)});return s={...s,query:{...h,...s.query}},new y(t(d.path,b(i,c)?`query3d`:`query`),s)}var y=class{constructor(e,t){this.url=e,this.options=t}};function b(e,t){return e.formatOf3DObjects!=null&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}export{m as a,p as i,f as n,u as o,d as r,h as t};