const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/featureLayerUtils-DES9h-C2.js","assets/index-CzMixifc.js","assets/index-CDgdHpAj.css","assets/originUtils-CL6wvYk_.js","assets/utils-WUTqSxls.js","assets/saveUtils-BKglk9b-.js","assets/fetchService-DOhU8MGQ.js","assets/FeatureLayerSource-BNTS3C1K.js","assets/quatf64-eO7UAs9K.js","assets/quat-XKFzqP_i.js","assets/memoryEstimations-C3WUBUZI.js","assets/pbf-Dny0go3N.js","assets/MeshLocalVertexSpace-Dfv_NBsU.js","assets/MeshTransform-BGwY5MT4.js","assets/axisAngleDegrees-GaSk0_KM.js","assets/External-BGzO9MR2.js","assets/meshVertexSpaceUtils-CrM2H6JB.js","assets/OptimizedFeatureSet-D4F9ObY_.js","assets/OptimizedGeometry-5fDazGe-.js","assets/applyEditsUtils-CvqjBc8C.js","assets/editingSupport-Dl7cyYJi.js","assets/QueryEngineCapabilities-COyCnRVj.js","assets/featureConversionUtils-VvJ2pauf.js","assets/FeatureLayerSource-CHB6lCCO.js","assets/QueryTask-CVh9qxsU.js","assets/executeForIds-D5xadeH1.js","assets/query-BeU-rNp1.js","assets/urlUtils-7tPnOsRB.js","assets/pbfQueryUtils-Dy8pLZgd.js","assets/queryUtils-ByyjBzze.js","assets/executeQueryJSON-BmDY9cVm.js","assets/executeQueryPBF-Brhxo-EH.js","assets/clientSideDefaults-4m0UtucK.js"])))=>i.map(i=>d[i]);
import{$r as e,$w as t,A as n,AT as r,Ai as i,Ar as a,BS as o,BT as s,C as c,DT as l,Dh as u,Di as d,Dr as ee,Fi as te,Ha as f,Hp as p,Hr as m,Hw as ne,IT as re,JS as ie,Jf as ae,Jp as h,Jw as oe,L as se,M as g,Mi as ce,Mn as le,Nh as ue,O as de,OT as _,Pi as fe,Pn as pe,Qf as me,Qp as he,Qr as ge,Rh as _e,Ri as ve,Rn as ye,S as be,SE as v,Sa as xe,T as y,Tr as Se,Vh as Ce,Z_ as we,Zf as Te,Zr as Ee,_ as b,_r as x,aE as S,ar as C,b as w,ba as T,ca as E,cr as D,fr as De,gD as O,gr as Oe,gw as k,hr as ke,ir as Ae,iv as A,j as je,jT as j,jr as Me,k as Ne,ka as M,ki as Pe,lr as Fe,ma as Ie,mp as Le,mr as Re,nv as ze,or as Be,pa as N,qi as Ve,rd as P,sr as He,ta as Ue,uE as F,ua as We,ur as Ge,vE as Ke,vT as qe,vi as Je,vr as Ye,wx as Xe,xa as Ze,xr as Qe,y as $e,yr as I}from"./index-CzMixifc.js";import{u as et}from"./colorUtils-Btp0B-0Y.js";import{r as tt}from"./cimSymbolUtils-Dwr_LmxD.js";import{a as nt,n as rt}from"./utils-BroCumRv.js";var L={key:`type`,base:Je,errorContext:`renderer`,typeMap:{simple:m,"unique-value":Me,"class-breaks":le}},R=re({types:L});function it(e,t){let n=e.drawingInfo?.renderer,r=n?R(n,e,t):null;if(r?.type===`simple`)return nt(r.symbol,null)?r.symbol.clone():null}var at=[`#ed5151`,`#149ece`,`#a7c636`,`#9e559c`,`#fc921f`,`#ffde3e`,`#f789d8`,`#b7814a`,`#3caf99`,`#6b6bd6`,`#b54779`,`#7f7f7f`];function ot(e,t){return et(at,e,{offset:!0,shuffle:!0}).reverse().map(e=>{let n=t.clone();return n.type===`cim`?tt(n,e):rt(n,e),new m({symbol:n})})}var st=Symbol(`isSubtypeGroupGraphicOriginSymbol`),z,ct=class extends T{get[(z=st,ae)](){return this.sublayer}get[Te](){return this.sublayer}get[Ze](){return this.layer}constructor(e){super(),this[z]=!0,this.type=`subtype-group`,this.sublayer=e}get layer(){return this.sublayer.parent}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},B=c(),lt=0;function V(e,t){let n=e.json.write;return typeof n!=`object`&&(n=e.json.write={}),n.ignoreOrigin=!0,t?.spatialOnly&&(n.layerContainerTypes=M),e}function H(e){let t={write:{ignoreOrigin:!0}};return e?.name&&(t.name=e.name),typeof t.write==`object`&&(e?.spatialOnly&&(t.write.layerContainerTypes=M),e?.target&&(t.write.target=e.target)),t}function ut(e){return new m({symbol:dt(e)})}function dt(t){switch(t){case`point`:case`multipoint`:return Ee.clone();case`polyline`:return e.clone();case`polygon`:case`multipatch`:return ge.clone();default:return null}}function ft(e,t){return!!t&&e?.type===`unique-value`&&e.field!=null&&e.field.toLowerCase()===t.toLowerCase()&&!e.field2&&!e.field3&&!e.valueExpression}function U(e,t){return e==null?null:t.subtypes?.find(t=>t.code===e)}function pt(e,t){let n=null;switch(t.geometryType){case`esriGeometryPoint`:case`esriGeometryMultipoint`:n=`point`;break;case`esriGeometryPolyline`:n=`line`;break;case`esriGeometryPolygon`:case`esriGeometryMultiPatch`:n=`polygon`;break;default:t.type,n=null}let r={},i=U(e,t);if(i!=null){let{defaultValues:e}=i;for(let t in e)r[t]=e[t]}return r[t.subtypeField]=e,new y({name:`New Feature`,drawingTool:n,prototype:{attributes:r}})}var W=class extends f(k(ue(Ce))){constructor(e){super(e),this.attributeTableTemplate=null,this.charts=null,this.editingEnabled=!0,this.fieldOverrides=null,this.fieldsIndex=null,this.formTemplate=null,this.graphicOrigin=new ct(this),this.id=`${Date.now().toString(16)}-subtype-sublayer-${lt++}`,this.type=`subtype-sublayer`,this.labelsVisible=!0,this.labelingInfo=null,this.layerType=`ArcGISFeatureLayer`,this.legendEnabled=!0,this.listMode=`show`,this.minScale=0,this.maxScale=0,this.opacity=1,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.subtypeCode=null,this.templates=null,this.title=null,this.visible=!0}load(e){return p(this.renderer,this.fieldsIndex),Promise.resolve(this)}get _titleCreator(){let e=this._get(`_titleCreator`);return qe(e),new w({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,displayField:this.parent?.displayField??``,fields:this.fields,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}get capabilities(){return this.parent?.capabilities}get effectiveCapabilities(){return this.parent?.effectiveCapabilities}get effectiveEditingEnabled(){let{parent:e}=this;return e?e.effectiveEditingEnabled&&this.editingEnabled:this.editingEnabled}get elevationInfo(){return this.parent?.elevationInfo}get featureTitleFields(){return[...this._titleCreator.requiredFields]}writeFieldOverrides(e,t,n){let{fields:r,parent:i}=this,a;if(r){a=[];let e=0;r.forEach(({name:t,alias:n,editable:r,visible:o})=>{if(!o)return;let s=i?.fields?.find(e=>e.name===t);if(!s)return;let c={name:t},l=!1;n!==s.alias&&(c.alias=n,l=!0),r!==s.editable&&(c.editable=r,l=!0),a.push(c),l&&e++}),e===0&&a.length===r.length&&(a=null)}else a=v(e);a?.length&&Ke(n,a,t)}get fields(){let{parent:e,fieldOverrides:t,subtypeCode:n}=this,r=e?.fields;if(!e||!r?.length)return null;let{subtypes:i,subtypeField:a}=e,o=i?.find(e=>e.code===n),s=o?.defaultValues,c=o?.domains,l=[];for(let e of r){let r=e.clone(),{name:i}=r,o=t?.find(e=>e.name===i);if(r.visible=!t?.length||!!o,o){let{alias:e,editable:t}=o;e&&(r.alias=e),!1===t&&(r.editable=!1)}let u=s?.[i]??null;r.defaultValue=i===a?n:u;let d=c?.[i]??null;r.domain=i===a?null:d?d.type===`inherited`?r.domain:d.clone():null,l.push(r)}return l}get floorInfo(){return this.parent?.floorInfo}get isTable(){return!!this.parent?.isTable}get geometryType(){return this.parent?.geometryType}get globalIdField(){return this.parent?this.parent.globalIdField:(F.getLogger(this).error(q(`globalIdField`)),null)}get effectiveScaleRange(){let{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}get objectIdField(){return this.parent||F.getLogger(this).error(q(`objectIdField`)),this.parent?.objectIdField}get defaultPopupTemplate(){return this.createPopupTemplate()}get relationships(){return this.parent?.relationships}set renderer(e){p(e,this.fieldsIndex),this._override(`renderer`,e)}get renderer(){if(this._isOverridden(`renderer`))return this._get(`renderer`);let{parent:e}=this;return e&&!e.isTable&&e.geometryType!==`mesh`?ut(e.geometryType):null}readRendererFromService(e,t,n){if(t.type===`Table`)return null;let r=t.drawingInfo?.renderer,i=R(r,t,n),a,{subtypeCode:o}=this;if(o!=null&&ft(i,t.subtypeField)){let e=i.uniqueValueInfos?.find(({value:e})=>(e=typeof e==`number`?String(e):e)===String(o));e&&(a=new m({symbol:e.symbol}))}else i?.type!==`simple`||i.visualVariables?.length||(a=i);return a}readRenderer(e,t,n){let r=t?.layerDefinition?.drawingInfo?.renderer;if(r)return R(r,t,n)||void 0}get spatialReference(){return this.parent?.spatialReference??Xe.WGS84}get subtypeField(){return this.parent?.subtypeField}readTemplatesFromService(e,t){return[pt(this.subtypeCode,t)]}readTitleFromService(e,t){let n=U(this.subtypeCode,t);return n==null?null:n.name}get url(){return this.parent?.url}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}async addAttachment(e,t){let{parent:n}=this;if(!n)throw q(`addAttachment`);if(e.getAttribute(n.subtypeField)!==this.subtypeCode)throw new s(`subtype-sublayer:addAttachment`,`The feature provided does not belong to this SubtypeSublayer`);return n.addAttachment(e,t)}async updateAttachment(e,t,n){let{parent:r}=this;if(!r)throw q(`updateAttachment`);if(e.getAttribute(r.subtypeField)!==this.subtypeCode)throw new s(`subtype-sublayer:updateAttachment`,`The feature provided does not belong to this SubtypeSublayer`);return r.updateAttachment(e,t,n)}async deleteAttachments(e,t){let{parent:n}=this;if(!n)throw q(`deleteAttachments`);if(e.getAttribute(n.subtypeField)!==this.subtypeCode)throw new s(`subtype-sublayer:deleteAttachments`,`The feature provided does not belong to this SubtypeSublayer`);return n.deleteAttachments(e,t)}async applyEdits(e,t){if(!this.parent)throw q(`applyEdits`);return this.parent.applyEdits(e,t)}createPopupTemplate(e){let t=this,{parent:n,fields:r,title:i}=this;if(n){let{displayField:e,editFieldsInfo:a,objectIdField:o}=n;t={displayField:e,editFieldsInfo:a,fields:r,objectIdField:o,title:i}}return b(t,e)}createQuery(){if(!this.parent)throw q(`createQuery`);let e=x(this.parent),t=`${this.parent.subtypeField}=${this.subtypeCode}`;return e.where=h(t,this.parent.definitionExpression),e}getFeatureTitle(e,t){return this._titleCreator.getTitle(this,e,t)}getFeatureTitles(e,t){return this._titleCreator.getTitles(this,e,t)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains&&this.parent){let t=I(this.parent,e);if(t)return t}return this._getLayerDomain(e)}async queryAttachments(e,t){let n=await this.load();if(!n.parent)throw q(`queryAttachments`);let r=e instanceof a?e.clone():new a(e);return r.where=K(r.where,n.parent.subtypeField,n.subtypeCode),n.parent.queryAttachments(r,t)}async queryFeatureCount(e,t){let n=await this.load();if(!n.parent)throw q(`queryFeatureCount`);return n.parent.queryFeatureCount(G(n.parent,n,e),t)}async queryFeatures(e,t){let n=await this.load();if(!n.parent)throw q(`queryFeatures`);return n.parent.queryFeatures(G(n.parent,n,e),t)}async queryObjectIds(e,t){let n=await this.load();if(!n.parent)throw q(`queryObjectIds`);return n.parent.queryObjectIds(G(n.parent,n,e),t)}async queryRelatedFeatures(e,t){let n=await this.load();if(!n.parent)throw q(`queryRelatedFeatures`);return n.parent.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){let n=await this.load();if(!n.parent)throw q(`queryRelatedFeaturesCount`);return n.parent.queryRelatedFeaturesCount(e,t)}_getLayerDomain(e){let t=this.fieldsIndex.get(e);return t?t.domain:null}};O([l({clonable:!1,readOnly:!0})],W.prototype,`_titleCreator`,null),O([l({type:ve,json:H({name:`attributeTableInfo`})})],W.prototype,`attributeTableTemplate`,void 0),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`capabilities`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`effectiveCapabilities`,null),O([l({json:H()})],W.prototype,`charts`,void 0),O([l({type:Boolean,nonNullable:!0,json:H({name:`enableEditing`})})],W.prototype,`editingEnabled`,void 0),O([l({type:Boolean,readOnly:!0})],W.prototype,`effectiveEditingEnabled`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`elevationInfo`,null),O([l({clonable:!1,readOnly:!0})],W.prototype,`featureTitleFields`,null),O([l({json:{name:`layerDefinition.fieldOverrides`,origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],W.prototype,`fieldOverrides`,void 0),O([r(`fieldOverrides`)],W.prototype,`writeFieldOverrides`,null),O([l({...B.fields,readOnly:!0,json:{read:!1}})],W.prototype,`fields`,null),O([l(B.fieldsIndex)],W.prototype,`fieldsIndex`,void 0),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`floorInfo`,null),O([l({type:xe,json:H({name:`formInfo`})})],W.prototype,`formTemplate`,void 0),O([l({readOnly:!0,clonable:!1})],W.prototype,`graphicOrigin`,void 0),O([l({type:String,clonable:!1,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],W.prototype,`id`,void 0),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`isTable`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`geometryType`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`globalIdField`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`type`,void 0),O([l(V(v(ce)))],W.prototype,`labelsVisible`,void 0),O([l({type:[pe],json:{name:`layerDefinition.drawingInfo.labelingInfo`,origins:{service:{read:!1}},read:{reader:be},write:{ignoreOrigin:!0,layerContainerTypes:M}}})],W.prototype,`labelingInfo`,void 0),O([l({type:[`ArcGISFeatureLayer`],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,layerContainerTypes:M}}})],W.prototype,`layerType`,void 0),O([l(V(v(d)))],W.prototype,`legendEnabled`,void 0),O([l({type:[`show`,`hide`]})],W.prototype,`listMode`,void 0),O([l((()=>{let e=v(Pe);return e.json.origins.service.read=!1,V(e,{spatialOnly:!0})})())],W.prototype,`minScale`,void 0),O([l((()=>{let e=v(te);return e.json.origins.service.read=!1,V(e,{spatialOnly:!0})})())],W.prototype,`maxScale`,void 0),O([l({readOnly:!0})],W.prototype,`effectiveScaleRange`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`objectIdField`,null),O([l({type:Number,range:{min:0,max:1},nonNullable:!0,json:H({spatialOnly:!0})})],W.prototype,`opacity`,void 0),O([l({clonable:!1})],W.prototype,`parent`,void 0),O([l(V(v(i)))],W.prototype,`popupEnabled`,void 0),O([l({type:me,json:H({name:`popupInfo`})})],W.prototype,`popupTemplate`,void 0),O([l({readOnly:!0})],W.prototype,`defaultPopupTemplate`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`relationships`,null),O([l({types:L,json:H({target:`layerDefinition.drawingInfo.renderer`,spatialOnly:!0})})],W.prototype,`renderer`,null),O([j(`service`,`renderer`,[`drawingInfo.renderer`,`subtypeField`,`type`])],W.prototype,`readRendererFromService`,null),O([j(`renderer`,[`layerDefinition.drawingInfo.renderer`])],W.prototype,`readRenderer`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`spatialReference`,null),O([l({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],W.prototype,`subtypeCode`,void 0),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`subtypeField`,null),O([l({type:[y],json:H({name:`layerDefinition.templates`})})],W.prototype,`templates`,void 0),O([j(`service`,`templates`,[`geometryType`,`subtypeField`,`subtypes`,`type`])],W.prototype,`readTemplatesFromService`,null),O([l({type:String,json:H()})],W.prototype,`title`,void 0),O([j(`service`,`title`,[`subtypes`])],W.prototype,`readTitleFromService`,null),O([l({readOnly:!0,json:{read:!1}})],W.prototype,`url`,null),O([l({readOnly:!0})],W.prototype,`userHasUpdateItemPrivileges`,null),O([l({type:Boolean,nonNullable:!0,json:H({name:`visibility`,spatialOnly:!0})})],W.prototype,`visible`,void 0),W=O([_(`esri.layers.support.SubtypeSublayer`)],W);var G=(e,t,n)=>{if(!n)return t.createQuery();let r=P.from(n);return r.where=K(r.where,e.subtypeField,t.subtypeCode),r},K=(e,t,n)=>{let r=RegExp(`${t}\\s*=\\s*\\d+`),i=`${t}=${n}`,a=e??``;return r.test(a)?a.replace(r,i):h(i,a)},q=e=>new s(`subtype-sublayer:parent-missing`,`This sublayer must have a parent SubtypeGroupLayer in order to use ${e}`),J=`SubtypeGroupLayer`;function Y(e,t){return new s(`layer:unsupported`,`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function X(e,t){let n=[];for(let r of e){let e=new W;e.read(r,t),n.push(e)}return n}var Z=c();function Q(){return{name:`layerType`,read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0}}}var $=class extends ye(Ue(Ve(We(de(n(je(N(se(g(f(E(Ie(k(u)))))))))))))){constructor(...e){super(...e),this._sublayerLookup=new Map,this.fields=null,this.fieldsIndex=null,this.outFields=null,this.sublayers=new(A.ofType(W)),this.useUniqueColorsForSublayers=!0,this.supportedSourceTypes=new Set([`Feature Layer`,`Table`]),this.timeInfo=null,this.title=`Layer`,this.type=`subtype-group`,this._debouncedSaveOperations=ne(async(e,t,n)=>{let{save:r,saveAs:i}=await o(async()=>{let{save:e,saveAs:t}=await import(`./featureLayerUtils-DES9h-C2.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5,6]));switch(e){case 0:return r(this,t);case 1:return i(this,n,t)}}),this.addHandles(ze(()=>this.sublayers,(e,t)=>this._handleSublayersChange(e,t),we))}destroy(){this.source?.destroy()}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}load(e){let t=e==null?null:e.signal,n=this.loadFromPortal({supportedTypes:[`Feature Service`]},e).catch(oe).then(async()=>{if(!this.url)throw new s(`subtype-grouplayer:missing-url-or-source`,`SubtypeGroupLayer must be created with either a url or a portal item`);if(this.layerId==null)throw new s(`subtype-grouplayer:missing-layerid`,`layerId is required for a SubtypeGroupLayer created with url`);this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>Ge(this,`load`,e));return this.addResolvingPromise(n),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty(`definitionExpression`),this.commitProperty(`timeExtent`),this.commitProperty(`timeOffset`),this.commitProperty(`geometryType`),this.commitProperty(`gdbVersion`),this.commitProperty(`historicMoment`),this.commitProperty(`returnZ`),this.commitProperty(`capabilities`),this.commitProperty(`returnM`),(this._get(`createQueryVersion`)??0)+1}get editingEnabled(){return this.loaded&&this.capabilities!=null&&this.capabilities.operations.supportsEditing&&this.userHasEditingPrivileges}get effectiveEditingEnabled(){return Qe(this)}get operationalLayerType(){return this.isTable?`SubtypeGroupTable`:`SubtypeGroupLayer`}set source(e){this._get(`source`)!==e&&this._set(`source`,e)}readTitleFromService(e,{name:t}){return this.url?ie(this.url,t):t}async addAttachment(e,t){let n=await Fe(this,e,t,J);return this.lastEditsEventDate=new Date,n}async updateAttachment(e,t,n){let r=await ke(this,e,t,n,J);return this.lastEditsEventDate=new Date,r}async applyEdits(e,t){return Se(this,e,t)}async createGraphicsSource(e){let{default:n}=await t(o(()=>import(`./FeatureLayerSource-BNTS3C1K.js`),__vite__mapDeps([7,8,9,1,2,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32])),e);return new n({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:e})}createQuery(){let e=x(this),t=this.sublayers.map(e=>e.subtypeCode);return e.where=h(`${this.subtypeField} IN (${t.join(`,`)})`,this.definitionExpression),e}async deleteAttachments(e,t){let n=await ee(this,e,t,J);return this.lastEditsEventDate=new Date,n}async fetchRecomputedExtents(e){return Re(this,e,J)}findSublayerForFeature(e){let t=this.fieldsIndex.get(this.subtypeField),n=e.attributes[t.name];return this.findSublayerForSubtypeCode(n)}findSublayerForSubtypeCode(e){return this._sublayerLookup.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains){let t=I(this,e);if(t)return t}let n=Oe(this,t?.feature);if(n){let t=n.domains?.[e];return t?.type===`inherited`?this._getLayerDomain(e):t}return this._getLayerDomain(e)}loadAll(){return _e(this,e=>{e(this.sublayers)})}async queryAttachments(e,t){return Ae(this,e,t,J)}async queryFeatures(e,t){let n=await this.load(),r=P.from(e)??n.createQuery(),i=r.outFields??[];i.includes(this.subtypeField)||(i.push(this.subtypeField),r.outFields=i);let a=await n.source.queryFeatures(r,t);if(a?.features)for(let e of a.features)e.origin=this.findSublayerForFeature(e)?.graphicOrigin,e.layer=e.sourceLayer=this.findSublayerForFeature(e);return a}async queryObjectIds(e,t){return(await De(this,e,t,J)).filter(he)}async queryFeatureCount(e,t){return D(this,e,t,J)}async queryExtent(e,t){return He(this,e,t,J)}async queryRelatedFeatures(e,t){return Ye(this,e,t,J)}async queryRelatedFeaturesCount(e,t){return Be(this,e,t,J)}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}write(e,t){let{origin:n,layerContainerType:r,messages:i}=t;if(this.isTable){if(n===`web-scene`||n===`web-map`&&r!==`tables`)return i?.push(Y(this,`using a table source cannot be written to web scenes and web maps`)),null}else if(this.loaded&&n===`web-map`&&r===`tables`)return i?.push(Y(this,`using a non-table source cannot be written to tables in web maps`)),null;return this.sublayers?.length?super.write(e,t):(i?.push(new s(`web-document-write:invalid-property`,`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' has invalid value for 'sublayers' property. 'sublayers' collection should contain at least one sublayer`,{layer:this})),null)}serviceSupportsSpatialReference(e){return!!this.loaded&&$e(this,e)}async getFeatureTitle(e,t){let n=this.findSublayerForFeature(e);return n?await n.getFeatureTitle(e,t):this._getFeatureTitleForUnknownSublayer(e)}async getFeatureTitles(e,t){let n=new Map,r=new Map,i=[r];return e.forEach(e=>{let t=this.findSublayerForFeature(e);if(t)S(n,t,()=>[]).push(e);else{let t=e.getObjectId()??e.attributes[this.objectIdField];r.set(t,this._getFeatureTitleForUnknownSublayer(e))}}),(await Promise.all(Array.from(n).map(([e,n])=>e.getFeatureTitles(n,t)))).forEach(e=>i.push(e)),new Map(i.flatMap(e=>[...e]))}get featureTitleFields(){let e=new Set;for(let t of this.sublayers){let n=t.featureTitleFields;for(let t of n)e.add(t)}return[...e]}_getLayerDomain(e){let t=this.fieldsIndex.get(e);return t?t.domain:null}_initLayerProperties(e){this._set(`source`,e);let{sourceJSON:t}=e;if(t&&(this.sourceJSON=t,this.read(t,{origin:`service`,url:this.parsedUrl})),!this.subtypes?.length)throw new s(`subtype-grouplayer:missing-subtypes`,`SubtypeGroupLayer must be created using a layer with subtypes`);this._verifyFields(),Le(this.timeInfo,this.fieldsIndex)}async hasDataChanged(){return C(this)}_verifyFields(){let e=this.parsedUrl?.path??`undefined`;this.objectIdField||console.log(`SubtypeGroupLayer: 'objectIdField' property is not defined (url: `+e+`)`),this.isTable||e.search(/\/FeatureServer\//i)!==-1||this.fields?.some(e=>e.type===`geometry`)||console.log(`SubtypeGroupLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: `+e+`)`)}_handleSublayersChange(e,t){t&&(t.forEach(e=>{e.parent=null}),this.removeHandles(`sublayers-owner`),this._sublayerLookup.clear()),e&&(e.forEach(e=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)}),this.addHandles([e.on(`after-add`,({item:e})=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)}),e.on(`after-remove`,({item:e})=>{e.parent=null,this._sublayerLookup.delete(e.subtypeCode)})],`sublayers-owner`))}_getFeatureTitleForUnknownSublayer(e){let{displayField:t,fieldsIndex:n,objectIdField:r}=this;if(t&&n.has(t))return e.attributes[n.get(t).name]??``;let i=e.getObjectId();return i==null?r&&n.has(r)?e.attributes[n.get(r).name]??``:``:i.toString()}};O([l({readOnly:!0})],$.prototype,`createQueryVersion`,null),O([l({readOnly:!0})],$.prototype,`editingEnabled`,null),O([l({readOnly:!0})],$.prototype,`effectiveEditingEnabled`,null),O([l({...Z.fields,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],$.prototype,`fields`,void 0),O([l(Z.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),O([l(fe)],$.prototype,`id`,void 0),O([l({type:[`show`,`hide`,`hide-children`],json:{origins:{"portal-item":{read:!1,write:!1}}}})],$.prototype,`listMode`,void 0),O([l({type:[`SubtypeGroupLayer`,`SubtypeGroupTable`],json:{...Q(),origins:{"web-document":Q(),"portal-item":Q()}}})],$.prototype,`operationalLayerType`,null),O([l(Z.outFields)],$.prototype,`outFields`,void 0),O([l({clonable:!1})],$.prototype,`source`,null),O([l({type:A.ofType(W),json:{origins:{service:{read:{source:`subtypes`,reader(e,t,n){let r=null;if(this.useUniqueColorsForSublayers){let i=it(t,n);r=i?ot(e.length,i):null}let i=e.map(({code:e},i)=>{let a=new W({subtypeCode:e});a.read(t,n);let o=r?.[i];return o&&a.read({drawingInfo:{renderer:o.toJSON()}},n),a});return new(A.ofType(W))(i)}}}},read:{source:[`layers`,`tables`],reader(e,t,n){let r;return t.layerType===`SubtypeGroupLayer`&&t.layers?.length?r=X(t.layers,n):t.layerType===`SubtypeGroupTable`&&t.tables?.length&&(r=X(t.tables,n)),new(A.ofType(W))(r)}},write:{ignoreOrigin:!0,writer(e,t,n,r){let i=[];for(let t of e){let e=t.write({},r);i.push(e)}this.isTable?t.tables=i:t.layers=i}}}})],$.prototype,`sublayers`,void 0),O([l()],$.prototype,`useUniqueColorsForSublayers`,void 0),O([l({type:Ne})],$.prototype,`timeInfo`,void 0),O([l({json:{origins:{"portal-item":{write:{enabled:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}}}})],$.prototype,`title`,void 0),O([j(`service`,`title`,[`name`])],$.prototype,`readTitleFromService`,null),O([l({json:{read:!1}})],$.prototype,`type`,void 0),O([l({clonable:!1,readOnly:!0})],$.prototype,`featureTitleFields`,null),$=O([_(`esri.layers.SubtypeGroupLayer`)],$);var mt=$;export{mt as default};