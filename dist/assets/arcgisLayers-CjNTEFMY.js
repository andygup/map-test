const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GroupLayer-Cn0hE2Yu.js","assets/index-ByaFsVj4.js","assets/index-DiFef-Um.css","assets/loadUtils-Bozh8QCP.js","assets/associatedFeatureServiceUtils-C4oO8OzZ.js","assets/fetchService-CCC5nmQq.js","assets/layersCreator-phzbHAh0.js","assets/lazyLayerLoader-C-gbeYPV.js","assets/portalLayers-CvrwHVn9.js","assets/tagSymbols-CNjeVVdC.js","assets/saveUtils-BB0-rUbr.js"])))=>i.map(i=>d[i]);
import{BS as e,BT as t,Eh as n,FC as r,KS as i,gC as a,mh as o,qS as s}from"./index-ByaFsVj4.js";import{t as c}from"./associatedFeatureServiceUtils-C4oO8OzZ.js";import{n as l,r as u,t as d}from"./fetchService-CCC5nmQq.js";import{t as f}from"./lazyLayerLoader-C-gbeYPV.js";var p={FeatureLayer:!0,SceneLayer:!0,VideoLayer:!0};async function m(t){let{properties:n,url:r}=t,i={...n,url:r},a=await v(r,n?.customParameters),{Constructor:o,layerId:s,sourceJSON:c,parsedUrl:l,layers:u,tables:d}=a;if(u.length+d.length===0)return s!=null&&(i.layerId=s),c!=null&&(i.sourceJSON=c),new o(i);let f=new(await(e(async()=>{let{default:e}=await import(`./GroupLayer-Cn0hE2Yu.js`);return{default:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])))).default({title:l.title});return await _(f,a,i),f}function h(e,t){return e?e.find(({id:e})=>e===t):null}function g(e,t,n,r,i){let a={...i,layerId:t};return e!=null&&(a.url=e),n!=null&&(a.sourceJSON=n),`sublayerTitleMode`in r.prototype&&(a.sublayerTitleMode=`service-name`),new r(a)}async function _(e,t,n){let r=t.sublayerConstructorProvider;for(let{id:i,serverUrl:a}of t.layers){let o=h(t.sublayerInfos,i),s=g(a,i,o,(o&&r?.(o))??t.Constructor,n);e.add(s)}if(t.tables.length){let r=await C(`FeatureLayer`);t.tables.forEach(({id:i,serverUrl:a})=>{let o=g(a,i,h(t.tableInfos,i),r,n);e.tables.add(o)})}}async function v(e,r){let i=s(e);if(i??=await y(e,r),i==null)throw new t(`arcgis-layers:url-mismatch`,"The url '${url}' is not a valid arcgis resource",{url:e});let{serverType:a,sublayer:c}=i,d,f={FeatureServer:`FeatureLayer`,KnowledgeGraphServer:`KnowledgeGraphLayer`,StreamServer:`StreamLayer`,VectorTileServer:`VectorTileLayer`,VideoServer:`VideoLayer`},m=a===`FeatureServer`,h=a===`SceneServer`,g={parsedUrl:i,Constructor:null,layerId:m||h?c??void 0:void 0,layers:[],tables:[]};switch(a){case`MapServer`:if(c!=null){let{type:n}=await u(e,{customParameters:r});switch(d=`FeatureLayer`,n){case`Catalog Layer`:d=`CatalogLayer`;break;case`Catalog Dynamic Group Layer`:throw new t(`arcgis-layers:unsupported`,`fromUrl() not supported for "${n}" layers`)}}else d=await w(e,r)?`TileLayer`:`MapImageLayer`;break;case`ImageServer`:{let t=await u(e,{customParameters:r}),{tileInfo:n,cacheType:i}=t;d=n?n?.format?.toUpperCase()!==`LERC`||i&&i.toLowerCase()!==`elevation`?`ImageryTileLayer`:`ElevationLayer`:`ImageryLayer`;break}case`SceneServer`:{let e=await u(i.url.path,{customParameters:r});if(d=`SceneLayer`,e){let t=e?.layers;if(e?.layerType===`Voxel`)d=`VoxelLayer`;else if(t?.length){let e=t[0]?.layerType;e!=null&&n[e]!=null&&(d=n[e])}}break}case`3DTilesServer`:throw new t(`arcgis-layers:unsupported`,`fromUrl() not supported for 3DTiles layers`);case`FeatureServer`:if(d=`FeatureLayer`,c!=null){let t=await u(e,{customParameters:r});g.sourceJSON=t,g.preferredUrl=o(),d=l(t.type)}break;default:d=f[a]}if(p[d]&&c==null){let t=await x(e,a,r);if(m&&(g.preferredUrl=t.preferredUrl,g.sublayerInfos=t.layerInfos,g.tableInfos=t.tableInfos),t.layers.length+t.tables.length!==1)g.layers=t.layers,g.tables=t.tables,m&&t.layerInfos?.length&&(g.sublayerConstructorProvider=await T(t.layerInfos));else if(m||h){let e=t.layerInfos?.[0]??t.tableInfos?.[0];if(g.layerId=t.layers[0]?.id??t.tables[0]?.id,g.sourceJSON=e,m){let t=e?.type;d=l(t)}}}return g.Constructor=await C(d),g}async function y(e,t){let n=await u(e,{customParameters:t}),o=null,s=null,c=n.type;if(c===`Feature Layer`||c===`Table`?(o=`FeatureServer`,s=n.id??null):c===`indexedVector`?o=`VectorTileServer`:n.hasOwnProperty(`mapName`)?o=`MapServer`:n.hasOwnProperty(`bandCount`)&&n.hasOwnProperty(`pixelSizeX`)?o=`ImageServer`:n.hasOwnProperty(`maxRecordCount`)&&n.hasOwnProperty(`allowGeometryUpdates`)?o=`FeatureServer`:n.hasOwnProperty(`streamUrls`)?o=`StreamServer`:b(n)?(o=`SceneServer`,s=n.id):n.hasOwnProperty(`layers`)&&b(n.layers?.[0])&&(o=`SceneServer`),!o)return null;let l=s==null?null:i(e);return{title:l!=null&&n.name||r(e),serverType:o,sublayer:s,url:{path:l==null?a(e).path:l.serviceUrl}}}function b(e){return e!=null&&e.hasOwnProperty(`store`)&&e.hasOwnProperty(`id`)&&typeof e.id==`number`}async function x(e,t,n){let r,i,a,s=!1;switch(t){case`FeatureServer`:{let t=await d(e,{customParameters:n});a=o(e,{preferredHost:t.preferredHost}),s=!!t.layersJSON,r=t.layersJSON||t.serviceJSON;break}case`SceneServer`:{let t=await S(e,n);r=t.serviceInfo,i=t.tableServerUrl;break}default:r=await u(e,{customParameters:n})}let c=r?.layers,l=r?.tables;return{preferredUrl:a,layers:c?.map(e=>({id:e.id})).reverse()||[],tables:l?.map(e=>({serverUrl:i,id:e.id})).reverse()||[],layerInfos:s?c:[],tableInfos:s?l:[]}}async function S(e,t){let n=await u(e,{customParameters:t});if(!n.layers?.[0])return{serviceInfo:n};try{let{serverUrl:r}=await c(e),i=await u(r,{customParameters:t}).catch(()=>null);return i&&(n.tables=i.tables),{serviceInfo:n,tableServerUrl:r}}catch{return{serviceInfo:n}}}async function C(e){return(0,f[e])()}async function w(e,t){return(await u(e,{customParameters:t})).tileInfo}async function T(e){if(!e.length)return;let t=new Set,n=[];for(let{type:r}of e)t.has(r)||(t.add(r),n.push(C(l(r))));let r=await Promise.all(n),i=new Map;return Array.from(t).forEach((e,t)=>{i.set(e,r[t])}),e=>i.get(e.type)}export{m as fromUrl};