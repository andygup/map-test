import{$_ as e,Aw as t,BT as n,I_ as r,Od as i,Rd as a,Sg as o,VT as s,Vd as c,aT as l,dv as u,gT as d,kD as f,mv as ee,pv as p,rE as m,tT as h,tp as g,wg as _,zv as v}from"./index-BN8X5Ryz.js";import"./memoryEstimations-D_IbKyOk.js";import"./OptimizedGeometry-BQJ7w5VU.js";import"./Point2D-DJueHbCy.js";import"./Envelope2D-B7gkUj4e.js";import"./SpatialReference-CfUjvF_j.js";import"./Transformation2D-D07KwcEj.js";import"./SimpleGeometryCursor-BILtMaQf.js";import"./OperatorDefinitions-C5Pat-Jx.js";import"./jsonConverter-CoA5-zxu.js";import"./FlatGeometry-BsPiiSVP.js";import"./apiConverter-Dsm0pxcs.js";import"./geodeticCurveType-CcdKHJt5.js";import{i as te,r as ne}from"./geodeticAreaOperator-B2LzXjd-.js";import"./operatorGeodeticDensify-0EE8Fc4Y.js";import{i as y,o as b}from"./geodeticDensifyOperator-B6xHg5VF.js";import{i as x,r as S}from"./geodeticLengthOperator-BdZS0ajo.js";import{t as re}from"./areaOperator-CNwgdHIl.js";import{n as C}from"./lengthOperator-DdV6vMS2.js";import"./operatorSimplify-BCW0XIAz.js";import{r as w}from"./simplifyOperator-C6TgASU6.js";import"./quatf64-D37SEdPg.js";import"./earcut-CEMcWA4Z.js";import"./plane-Da5EsY0J.js";import"./vectorStacks-Cuo89CNO.js";import"./projectPointToVector-BkRdoTqD.js";import"./spatialReferenceEllipsoidUtils-qw9wv8RL.js";import"./projectionZScaling-C8xhU_hX.js";import{i as T,r as E}from"./projectOperator-DWqbOm71.js";import"./dehydratedPoint-CWZQBefp.js";import"./projectVectorToVector-DGzn2p7I.js";import"./memoize-Dl61_jt0.js";import"./elevationInfoUtils-uoMH3ofe.js";import{r as D,s as O}from"./colorUtils-CzajW9E7.js";import{t as k}from"./GraphicsLayer-DBcl42yN.js";import"./ObjectStack-l5kM7JZu.js";import"./ray-LkJ58wpZ.js";import{t as ie}from"./getDefaultUnitForView-DyZIV1hK.js";import{n as ae,t as A}from"./ExclusiveOperationManager-D0f7Woil.js";import{n as j,s as M}from"./quantity-Co6flzuS.js";import"./unitFormatUtils-DIX5VDC2.js";import{r as N}from"./quantityFormatUtils-DorrZj0i.js";import{c as P,n as F,o as I,s as L}from"./geodesicUtils-D99LxQ6q.js";import{n as R,t as z}from"./SketchViewModel-BUSTPGCt.js";import"./isSupportedObject-CnaOA-Ng.js";import"./layerUtils-BZgsYerz.js";import"./SketchOptions-DjwJVzbR.js";import"./LineSnappingHint-CmFAetWF.js";import"./ParallelSnappingHint-CVYaPm-q.js";import"./snappingUtils-D3oTIKrZ.js";import"./vec3-B94Y7ih2.js";import"./sphere-d9-4vNcj.js";import"./constraints-Ch5tsKD8.js";import"./SnappingCandidate-DueCLuvH.js";import"./EdgeSnappingCandidate-CCg5Xb97.js";import"./DrapedEdgeSnappingCandidate-CqXt8QLN.js";import"./IntersectionSnappingHint-CvQZ8eWi.js";import"./IntersectionSnappingCandidate-C2uVyhEk.js";import"./LineSnappingCandidate-BNbhbOGH.js";import"./RightAngleTriangleSnappingCandidate-CqVuCsko.js";import"./RightAngleSnappingHint-tXLlHR_t.js";import"./viewUtils-GR2hLWLo.js";import"./viewUtils-H4dpIyqQ.js";import"./euclideanLengthMeasurementUtils-CvEUUrXw.js";import"./lineSegment-BudcKS0C.js";import"./triangle-46ad8nAb.js";import"./hitTestSelectUtils-DrV1belT.js";function B(e){let t=D(e,.2);return new g({data:{type:`CIMSymbolReference`,symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,color:t.toArray()}]}}})}function V(e){return new g({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{type:`CIMSolidStroke`,capStyle:`Butt`,width:2,color:e.toArray()}]}}})}function H(e){let t=D(O(e,160),.5);return new g({data:{type:`CIMSymbolReference`,primitiveOverrides:[{type:`CIMPrimitiveOverride`,primitiveName:`textOverride`,propertyName:`TextString`,valueExpressionInfo:{type:`CIMExpressionInfo`,title:`Custom`,expression:`$feature.areaText`,returnType:`Default`}}],symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMVectorMarker`,colorLocked:!0,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:`CIMMarkerGraphic`,geometry:{x:0,y:0},symbol:{type:`CIMTextSymbol`,fontFamilyName:`sans-serif`,height:14,horizontalAlignment:`Center`,symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,color:e.toArray()}]},haloSymbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,color:t.toArray()}]},haloSize:1.5,verticalAlignment:`Center`},primitiveName:`textOverride`}],scaleSymbolsProportionally:!0,respectFrame:!0,markerPlacement:{type:`CIMMarkerPlacementPolygonCenter`}}]}}})}var U=class extends t{get _messages(){return this._messagesTask?.value}constructor(e){super(e),this._graphicsLayer=new k({listMode:`hide`,internal:!0}),this._updatingHandles=new _}initialize(){this.view.map?.add(this._graphicsLayer),this.addHandles(e(()=>this._updateMessageBundle())),this._updatingHandles.add(()=>({accentColor:this.view.effectiveTheme.accentColor,area:this.measurementViewData.result?.area,fill:this.measurementViewData.result?.display.fill,messages:this._messages,outline:this.measurementViewData.result?.display.outline,textColor:this.view.effectiveTheme.textColor,unit:this.measurementViewData.unit,visible:this.measurementViewData.visible}),({accentColor:e,area:t,fill:n,messages:r,outline:a,textColor:o,unit:s,visible:c},l)=>{if(this._graphicsLayer.visible=c,!c)return;if(!(t&&n&&r&&a))return void this._graphicsLayer.graphics.destroyAll();let u=r&&t?N(r,t,s):null;if(this._graphicsLayer.graphics.length===3&&e.equals(l?.accentColor)&&o.equals(l?.textColor)){let[e,t,r]=this._graphicsLayer.graphics.toArray();e.geometry=n,t.geometry=a,r.attributes.areaText=u,r.geometry=n;return}this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.addMany([new i({geometry:n,symbol:B(e)}),new i({geometry:a,symbol:V(e)}),new i({attributes:{areaText:u},geometry:n,symbol:H(o)})])},u),this._updateMessageBundle()}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get updating(){return!this._graphicsLayer.loaded||!this._messagesTask?.finished||this._updatingHandles.updating}_updateMessageBundle(){return this._messagesTask?.abort(),this._messagesTask=o(()=>r(`esri/core/t9n/Units`)),this._messagesTask.promise}};f([n()],U.prototype,`_messages`,null),f([n()],U.prototype,`_messagesTask`,void 0),f([n()],U.prototype,`measurementViewData`,void 0),f([n()],U.prototype,`updating`,null),f([n()],U.prototype,`view`,void 0),U=f([s(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementAreaVisualization`)],U);var W=j(1e5,`meters`);async function G(e,t){if(!e?.rings.length||!e.rings[0].length)return null;await T();let n=E(e,t);return n?n.spatialReference.isGeographic?L(n.spatialReference)?q(n):K(n):n.spatialReference.isWebMercator?K(n):oe(n):null}async function K(e){await Promise.all([te(),b(),x()]);let t=w(e);if(!t)return null;let n=J(t),r=y(t,W.value,{unit:W.unit});if(!r)return null;let i=y(n,W.value,{unit:W.unit});if(!i)return null;let a=S(t,{unit:`meters`}),o=ne(t,{unit:`square-meters`});return{area:M(o,`square-meters`),display:{fill:r,outline:i},mode:`geodesic`,perimeter:j(a,`meters`)}}function q(e){let t=w(e);if(!t)return null;let n=J(t),r=P(t,W.value),i=P(n,W.value),a=I([t],`meters`)[0],o=F([t],`square-meters`)[0];return{area:M(o,`square-meters`),display:{fill:r,outline:i},mode:`geodesic`,perimeter:j(a,`meters`)}}function oe(e){let t=w(e);if(!t)return null;let n=J(t),r=C(n,{unit:`meters`}),i=re(t,{unit:`square-meters`});return{area:M(i,`square-meters`),display:{fill:t,outline:n},mode:`euclidean`,perimeter:j(r,`meters`)}}function J(e){return new v({spatialReference:e.spatialReference,paths:e.rings})}var Y=class extends t{constructor(e){super(e),this._result=null,this._updatingHandles=new _,this._debouncedGetResult=h(async e=>{this._result=await G(e,this.view.spatialReference)})}initialize(){this.addHandles(p(()=>this.measurementViewData.analysis.geometry,e=>{this._updatingHandles.addPromise(d(this._debouncedGetResult(e)))},ee))}destroy(){this._updatingHandles.destroy()}get result(){return this._result}get updating(){return this._updatingHandles.updating}};f([n()],Y.prototype,`_result`,void 0),f([n()],Y.prototype,`measurementViewData`,void 0),f([n()],Y.prototype,`result`,null),f([n()],Y.prototype,`updating`,null),f([n()],Y.prototype,`view`,void 0),Y=f([s(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementController`)],Y);var X=class extends t{constructor(e){super(e),this._emptyFillSymbol=new a({color:null,outline:null}),this._graphicsLayer=new k({listMode:`hide`,internal:!0}),this._updatingHandles=new _}initialize(){this.view.map?.add(this._graphicsLayer),this._updatingHandles.add(()=>({geometry:this.measurementViewData.analysis.geometry}),({geometry:e})=>{if(!e)return void this._graphicsLayer.graphics.destroyAll();let t=this._graphicsLayer.graphics.at(0);t?t.geometry=e:(this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new i({geometry:e,symbol:this._emptyFillSymbol})))},u)}destroy(){this._emptyFillSymbol.destroy(),this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get graphic(){return this._graphicsLayer.graphics.at(0)}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded||this._updatingHandles.updating}};f([n()],X.prototype,`graphic`,null),f([n()],X.prototype,`graphicsLayer`,null),f([n()],X.prototype,`measurementViewData`,void 0),f([n()],X.prototype,`updating`,null),f([n()],X.prototype,`view`,void 0),X=f([s(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementManipulatorVisualization`)],X);var Z=class extends t{constructor(e){super(e),this._graphicsLayer=new k({listMode:`hide`,internal:!0})}initialize(){this.view.map?.add(this._graphicsLayer)}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded}};f([n()],Z.prototype,`graphicsLayer`,null),f([n()],Z.prototype,`measurementViewData`,void 0),f([n()],Z.prototype,`updating`,null),f([n()],Z.prototype,`view`,void 0),Z=f([s(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementSketchVisualization`)],Z);function se(e){return e?.type===`polygon`}var Q=class extends t{constructor(e){super(e),this._invisibleAreaSymbol=new a({color:null,outline:null}),this._operationManager=new A,this._updatingHandles=new _}initialize(){this._sketchViewModel=new z({defaultCreateOptions:{mode:`click`},defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{edgeOperation:`none`,shapeOperation:`none`},toggleToolOnClick:!1,tool:`reshape`},updateOnGraphicClick:!1,view:this.view}),this.addHandles([p(()=>({interactive:this.measurementViewData.interactive,visible:this.measurementViewData.visible}),({interactive:e,visible:t})=>{this._operationManager.stop(),t&&e&&this.reshape()}),p(()=>this.measurementViewData.snappingOptions,e=>{this._sketchViewModel&&(this._sketchViewModel.snappingOptions=e)},u),p(()=>this.view.effectiveTheme.accentColor,e=>{this._areaSymbol=new a({color:D(e,.3),outline:new c({color:e,width:2})})},u)])}destroy(){this._areaSymbol?.destroy(),this._invisibleAreaSymbol.destroy(),this._operationManager.destroy(),this._sketchViewModel?.destroy(),this._updatingHandles.destroy()}get state(){if(!this.measurementViewData.visible||!this._operationManager.currentOperationType)return`idle`;switch(this._operationManager.currentOperationType){case`place`:return`placing`;case`reshape`:return`reshaping`}}get updating(){return!this._sketchViewModel||this._sketchViewModel.updating||this._updatingHandles.updating}async place(e){return this._operationManager.start(`place`,async t=>{if(!this._sketchViewModel||!this.measurementViewData.sketchGraphicsLayer)return;let n=this._sketchViewModel.on(`create`,e=>{switch(e.state){case`active`:{let t=e.graphic?.geometry;t?.type===`polygon`&&(this.measurementViewData.analysis.geometry=t);break}case`cancel`:case`complete`:t.stop()}});t.handles.push(n,m(()=>{if(n.remove(),this._sketchViewModel?.cancel(),this.measurementViewData.sketchGraphicsLayer?.removeAll(),l(e))return t.reject();t.resolve({})})),this._sketchViewModel.polygonSymbol=this._invisibleAreaSymbol,this._sketchViewModel.layer=this.measurementViewData.sketchGraphicsLayer,this._updatingHandles.addPromise(d(this._sketchViewModel.create(`polygon`)))})}async reshape(e){return this._operationManager.start(`reshape`,async t=>{if(!this._sketchViewModel)return;let n=()=>this._areaSymbol&&this._sketchViewModel&&this.measurementViewData.manipulatorGraphic&&this.measurementViewData.manipulatorGraphicsLayer?(this._sketchViewModel.polygonSymbol=this._areaSymbol,this._sketchViewModel.layer=this.measurementViewData.manipulatorGraphicsLayer,this._updatingHandles.addPromise(d(this._sketchViewModel.update(this.measurementViewData.manipulatorGraphic,{tool:`reshape`})))):Promise.resolve(),r=this._sketchViewModel.on(`update`,e=>{let r=e.graphics[0]?.geometry;this.measurementViewData.analysis.geometry=se(r)?r:null,e.state===`complete`&&(this.measurementViewData.interactive?n():t.stop())});t.handles.push(r,m(()=>{if(r.remove(),this._sketchViewModel?.cancel(),l(e))return t.reject();t.resolve()})),await n()})}};f([n()],Q.prototype,`_sketchViewModel`,void 0),f([n()],Q.prototype,`measurementViewData`,void 0),f([n()],Q.prototype,`state`,null),f([n()],Q.prototype,`updating`,null),f([n()],Q.prototype,`view`,void 0),Q=f([s(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementTool`)],Q);var $=class extends ae{constructor(e){super(e),this.analysis=null,this.snappingOptions=new R,this.type=`area-measurement-view-2d`}initialize(){let{view:e}=this;this._areaVisualization=new U({view:e,measurementViewData:this}),this._controller=new Y({view:e,measurementViewData:this}),this._manipulatorVisualization=new X({view:e,measurementViewData:this}),this._sketchVisualization=new Z({view:e,measurementViewData:this}),this._tool=new Q({view:e,measurementViewData:this})}destroy(){this._areaVisualization?.destroy(),this._controller?.destroy(),this._manipulatorVisualization?.destroy(),this._sketchVisualization?.destroy(),this._tool?.destroy()}get manipulatorGraphic(){return this._manipulatorVisualization?.graphic}get manipulatorGraphicsLayer(){return this._manipulatorVisualization?.graphicsLayer}get sketchGraphicsLayer(){return this._sketchVisualization?.graphicsLayer}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get result(){return this._controller?.result}get unit(){return this.analysis.unit??ie(this.view)}get updating(){return(this._areaVisualization?.updating??!0)||(this._controller?.updating??!0)||(this._sketchVisualization?.updating??!0)||(this._tool?.updating??!0)}get visible(){return super.visible}set visible(e){super.visible=e}async place(e){return this._tool.place(e)}};f([n()],$.prototype,`_areaVisualization`,void 0),f([n()],$.prototype,`_controller`,void 0),f([n()],$.prototype,`_manipulatorVisualization`,void 0),f([n()],$.prototype,`_sketchVisualization`,void 0),f([n()],$.prototype,`_tool`,void 0),f([n({constructOnly:!0})],$.prototype,`analysis`,void 0),f([n()],$.prototype,`manipulatorGraphic`,null),f([n()],$.prototype,`manipulatorGraphicsLayer`,null),f([n()],$.prototype,`sketchGraphicsLayer`,null),f([n({readOnly:!0})],$.prototype,`result`,null),f([n({type:R,nonNullable:!0})],$.prototype,`snappingOptions`,void 0),f([n({readOnly:!0})],$.prototype,`type`,void 0),f([n({readOnly:!0})],$.prototype,`unit`,null),f([n({readOnly:!0})],$.prototype,`updating`,null),$=f([s(`esri.views.2d.analysis.AreaMeasurementAnalysisView2D`)],$);var ce=$;export{ce as default};