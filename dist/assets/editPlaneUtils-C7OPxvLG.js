import{Bl as e,Bx as t,Cb as n,Cl as r,DT as i,Db as a,Fg as o,Fl as s,Gx as c,Hw as l,JE as u,Jx as d,Lw as f,Ml as p,Nl as m,OT as h,Ol as g,Qh as _,SE as v,Vl as y,Vr as b,WT as x,Z_ as S,_b as C,_w as w,bb as ee,c_ as te,dg as ne,dw as re,eg as ie,fT as ae,gD as T,hT as oe,i_ as se,iv as ce,nv as E,ov as le,pT as ue,pg as de,px as fe,qx as pe,rE as me,rT as he,rv as ge,sv as _e,tv as ve,u_ as ye,ub as be,vT as D,vb as xe,vd as Se,vw as Ce,wx as we,xb as Te,yb as Ee,yl as De}from"./index-ByaFsVj4.js";import{n as Oe}from"./meshVertexSpaceUtils-D9WJf86L.js";import{a as O}from"./vectorStacks-DhZu7qGn.js";import{n as ke}from"./dehydratedPoint-CVzHYxaL.js";import{t as Ae}from"./projectVectorToVector-BnpPb96u.js";import{S as je,b as Me,f as Ne,i as Pe,l as Fe,m as Ie,r as Le,x as Re}from"./elevationInfoUtils-CyQsBf6_.js";import{t as ze}from"./GraphicsLayer-DwoVChbR.js";import{d as Be,f as Ve,i as k,n as He,r as Ue,t as A}from"./quantity-b_p_m453.js";import{t as We}from"./geodesicUtils-Dvm-3luO.js";import{i as Ge,t as Ke}from"./SketchOptions-QYfkQRrC.js";import{d as j,f as qe,p as Je}from"./LineSnappingHint-3ZzJwo5I.js";import{s as Ye}from"./snappingUtils-C_5v3bem.js";import{a as Xe,d as Ze,i as Qe,l as $e,n as et,r as tt,s as nt,u as rt}from"./constraints-CFQ1UrIW.js";import{t as it}from"./euclideanLengthMeasurementUtils-DIbCzEM_.js";import{a as at,c as ot,i as st,n as ct,o as lt,r as ut,s as dt,t as ft}from"./createUtils-3b89FeCM.js";import{_ as pt,c as mt,d as M,f as ht,h as gt,i as _t,l as vt,m as yt,n as bt,o as xt,p as St,r as Ct,s as wt,t as Tt,u as Et,y as Dt}from"./SnappingContext-BSHa6eQl.js";import{c as Ot,i as N,l as kt,s as At,u as jt,y as Mt}from"./rotate-BnySm23F.js";import{n as Nt,t as P}from"./dehydratedFeatureComparison-S5E2zKzh.js";import{a as Pt,n as Ft,r as F,s as It}from"./angularMeasurementUtils-g0-pmZ8Q.js";import{t as Lt}from"./ReactiveSet-u4MbrV3A.js";import{a as Rt,n as zt}from"./hydratedFeatures-4dblZlCy.js";import{i as Bt,n as Vt}from"./boundedPlane-C7yz49Rx.js";var Ht={UndoRedoUpdating:`Cannot perform operation whilst undo redo is updating`,UndoInvalidError:`There are no items to Undo`,RedoInvalidError:`There are no items to Redo`,ApplyInvalidError:`Cannot apply an item that is already applied`},I=class extends Error{constructor(){super(Ht.UndoRedoUpdating),this.type=`undo-redo-updating-error`}},Ut=class extends Error{constructor(){super(Ht.UndoInvalidError),this.type=`undo-redo-undo-error`}},Wt=class extends Error{constructor(){super(Ht.RedoInvalidError),this.type=`undo-redo-redo-error`}},L=class extends w{constructor(){super(...arguments),this._stack=new ce,this._stackPosition=-1,this._updatingHandles=new de}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new Ut;if(this.updating)throw new I;let e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(1),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Wt;if(this.updating)throw new I;let e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new Wt;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new I;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new I;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await ve(()=>!this.updating);let n=new ce;for(let t=0;t<this._stack.length;t++){let r=this._stack.getItemAt(t);r&&(r.tag===e?(r.destroy(),t===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(r))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(e=!1){if(this.updating&&!e)throw new I;await ve(()=>!this.updating),this._drainStack()}};T([i()],L.prototype,`_stack`,void 0),T([i()],L.prototype,`_stackPosition`,void 0),T([i()],L.prototype,`updating`,null),T([i({readOnly:!0})],L.prototype,`canUndo`,null),T([i({readOnly:!0})],L.prototype,`hasUndo`,null),T([i({readOnly:!0})],L.prototype,`canRedo`,null),T([i({readOnly:!0})],L.prototype,`hasRedo`,null),L=T([h(`esri.UndoRedo`)],L);var Gt=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function R(e,t,n){if(e==null)return`noTool`;switch(e){case`point`:return Kt();case`multipoint`:return`multipoint`;case`polyline`:return qt(t,n);case`polygon`:return Jt(t,n);case`rectangle`:case`circle`:return Yt(t,n);default:return}}function Kt(e){return`point`}function qt(e,t){let n=e!=null&&e.type===`polyline`&&e.paths.length?e.paths[0].length:0;return t===`freehand`?n<2?`freehandStart`:`freehandEnd`:n<2?`polylineZeroVertices`:`polylineOneVertex`}function Jt(e,t){let n=e!=null&&e.type===`polygon`&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case`freehand`:return`freehandStart`;case`hybrid`:return`polygonZeroVerticesHybrid`;default:return`polygonZeroVertices`}else if(n<4)return t===`freehand`?`freehandEnd`:`polygonOneVertex`;return`polygonTwoVertices`}function Yt(e,t){if((e!=null&&e.type===`polygon`&&e.rings.length?e.rings[0].length:0)<3)switch(t){case`freehand`:return`freehandStart`;case`click`:return`shapeStartClick`;default:return`shapeStartHybrid`}switch(t){case`freehand`:return`freehandEnd`;case`click`:return`shapeEndClick`;default:return`shapeEndHybrid`}}function Xt(e,n){let r=e?.geometry;if(!e||r?.type!==`mesh`||!n)return;let{renderCoordsHelper:i,elevationProvider:a}=n,{camera:o}=n.state,{extent:s}=r,{center:c,spatialReference:l}=s,u=t(l),f=d(l),p=t(i.spatialReference),m=s.width*u,h=s.height*f,_=(s.zmax??0)*f,v=_-(s.zmin??0)*f,y=Math.max(m,h,v)/p,{x:b,y:x}=c,S=c.z??0;g(en,b,x,S),i.toRenderCoords(en,l,en);let C=y/o.computeScreenPixelSizeAt(en);if(C>Math.min(o.width,o.height)/o.pixelRatio*Qt)return`meshTooClose`;if(C<Zt)return`meshTooFar`;let w=Fe(e),{absoluteZ:ee}=Re(b,x,_,l,n,w);return ee<(a.getElevation(b,x,S,l,`ground`)??0)*f+v*$t?`meshUnderground`:`mesh`}var Zt=20,Qt=1,$t=.1,en=te();function tn(e,t,n,r,i,a){let o=`geodesic`,s=We(n),c=j();return Je(e,t,r,c),c[2]=0,s&&Ae(c,n,c,s)||(o=`euclidean`,s=n),{mode:o,view:t,elevationInfo:r,hasZ:i,directionMode:a,spatialReference:e.spatialReference,measurementSR:s,origin:c}}function nn(e,t,n){if(t==null||e==null)return;let r=pe(n.measurementSR);if(r==null)return;let i=fn(e,n);if(i==null)return;let a=Be(t,r);return new $e(i,a)}function rn(e,t,n,r){if(n==null||e==null)return;let i=fn(e,r);if(i==null)return;let a=F(n),o=e=>{if(e==null)return;let t=j(),n=Ue(e,`degrees`,`geographic`);return Ft(t,i,r.measurementSR,10,n,r.mode)?new rt(i,t):void 0},s=()=>{if(t!=null&&e!=null)return F(Pt(t,e))};switch(r.directionMode){case`absolute`:return o(a);case`relative`:{let e=s();return e==null?void 0:o(e+a)}case`relative-bilateral`:{let e=s();return e==null?void 0:Qe([o(e+a),o(e-a)])}}}function an(e,t){let n=mn(e,t);return n==null?void 0:new Ze(n)}function on(e,t,n){let{context:r,longitude:i,latitude:a,direction:o,distance:s,elevation:c}=n;if(i!=null||a!=null||s!=null||c!=null||o!=null){if(i!=null||a!=null){let e=F(i),t=F(a),n=mn(c,r);return new tt(e,t,n)}return sn(e,t,n)}}function sn(e,t,{context:n,direction:r,distance:i,elevation:a}){if(t==null)return an(a,n);let{view:o,elevationInfo:s,measurementSR:c}=n,l=Je(t,o,s);if(!c||!Ae(l,t.spatialReference,gn,c))return;let[u,d]=gn,f=i==null?void 0:Be(i,`meters`),p=F(r),m=mn(a,n),h=e=>{let t=new et([u,d],c,f,m,e);return f==null||e==null||m==null&&n.hasZ?t:new Xe(t.closestTo(l))};if(p==null)return h(void 0);let g=()=>{if(e!=null&&t!=null)return F(Pt(e,t))};switch(n.directionMode){case`absolute`:return h(p);case`relative`:{let e=g();return e==null?void 0:h(e+p)}case`relative-bilateral`:{let e=g();return e==null?void 0:Qe([h(e+p),h(e-p)])}}}function cn(e){return e.context.mode===`geodesic`?on(null,null,e):un(e)}function ln(e,t,n){let{context:r,x:i,y:a,distance:o,direction:s,elevation:c}=n;return r.mode===`geodesic`?on(t,e,n):i!=null||a!=null?un(n):dn([nn(e,o,r),rn(e,t,s,r),an(c,r)])}function un({x:e,y:t,elevation:n,context:r}){vn.x=e?.value??0,vn.y=t?.value??0,vn.spatialReference=r.spatialReference;let i=fn(vn,r,_n);return new tt(e!=null&&i!=null?i[0]:void 0,t!=null&&i!=null?i[1]:void 0,mn(n,r))}function dn(e){let t;for(let n of e)n&&(t=t?.intersect(n)??n);return t}function fn(e,t,n=j()){let{view:r,elevationInfo:i,measurementSR:a,origin:o,mode:s}=t;if(Je(e,r,i,n),Ae(n,e.spatialReference,n,a))return s!==`geodesic`&&De(n,n,o),n}function pn(e,t,n,r){let{view:i,measurementSR:a,spatialReference:o,origin:s,mode:c}=n;if(c===`geodesic`?p(z,e):m(z,e,s),Ae(z,a,z,o))return qe(z,i,t,n,r)}function mn(e,t){return hn(e,t)?.value??void 0}function hn(e,{view:t,origin:n,elevationInfo:r,hasZ:i,measurementSR:a}){if(e==null||!i)return;let o=c(a);if(o==null)return;let[s,l]=n,u=Be(e,o),d=t?.type===`3d`?Pe(t,s,l,u,a,r):u;return d==null?void 0:He(d,o)}var gn=j(),_n=j(),z=j(),vn=ke(0,0,0,we.WGS84),B=class extends N{constructor(e){super(e),this.type=`draw-circle`,this.radius=null,this.xSize=null,this.ySize=null,this.area=A}get allFields(){return[]}};T([i()],B.prototype,`type`,void 0),T([i()],B.prototype,`radius`,void 0),T([i()],B.prototype,`xSize`,void 0),T([i()],B.prototype,`ySize`,void 0),T([i()],B.prototype,`area`,void 0),T([i()],B.prototype,`helpMessage`,void 0),T([i()],B.prototype,`allFields`,null),B=T([h(`esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo`)],B);var V=class extends M(N){constructor(e){super(e),this.type=`draw-mesh`,this.orientation=yt({lockable:!1}),this.scale=pt({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};T([i()],V.prototype,`helpMessage`,void 0),T([i()],V.prototype,`allFields`,null),V=T([h(`esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo`)],V);var H=class extends M(N){constructor(e){super(e),this.type=`draw-multipoint`}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};T([i()],H.prototype,`helpMessage`,void 0),T([i()],H.prototype,`allFields`,null),H=T([h(`esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo`)],H);var U=class extends M(N){constructor(e){super(e),this.type=`draw-point`}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};T([i()],U.prototype,`helpMessage`,void 0),T([i()],U.prototype,`allFields`,null),U=T([h(`esri.views.interactive.tooltip.infos.DrawPointTooltipInfo`)],U);var W=class extends M(N){constructor(e){super(e),this.type=`draw-polygon`,this.direction=St(),this.distance=ht(),this.area=gt(),this.xyMode=`direction-distance`}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};T([i()],W.prototype,`xyMode`,void 0),T([i()],W.prototype,`helpMessage`,void 0),T([i()],W.prototype,`allFields`,null),W=T([h(`esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo`)],W);var G=class extends M(N){constructor(e){super(e),this.type=`draw-polyline`,this.direction=St(),this.distance=ht(),this.totalLength=Dt(),this.xyMode=`direction-distance`}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};T([i()],G.prototype,`helpMessage`,void 0),T([i()],G.prototype,`xyMode`,void 0),T([i()],G.prototype,`allFields`,null),G=T([h(`esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo`)],G);var K=class extends N{constructor(e){super(e),this.type=`draw-rectangle`,this.xSize=k,this.ySize=k,this.area=A}get allFields(){return[]}};T([i()],K.prototype,`type`,void 0),T([i()],K.prototype,`xSize`,void 0),T([i()],K.prototype,`ySize`,void 0),T([i()],K.prototype,`area`,void 0),T([i()],K.prototype,`helpMessage`,void 0),T([i()],K.prototype,`allFields`,null),K=T([h(`esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo`)],K);function yn(e,t){return{point:new U({sketchOptions:t,viewType:e}),multipoint:new H({sketchOptions:t,viewType:e}),polyline:new G({sketchOptions:t,viewType:e}),polygon:new W({sketchOptions:t,viewType:e}),mesh:new V({sketchOptions:t,viewType:e}),rectangle:new K({sketchOptions:t}),circle:new B({sketchOptions:t})}}function bn(e){let{directionOptions:t,geometryType:n,sketchOptions:r,tooltipInfos:i}=e,a=t=>{let n=Un(e).mode,r=i[t].elevation;n===`relative-to-ground`||n===`relative-to-scene`||n===`on-the-ground`?r.lock(Wn(e)):r.unlock()},o=e=>{if(t){let n=i[e].direction;n.committed=t.angle,n.unlockOnVertexPlacement=!1,r.values.directionMode=t.mode}};switch(n){case`polygon`:case`polyline`:a(n),o(n);break;case`point`:case`mesh`:a(n)}}function xn(e,t){let{drawOperation:n,view:r}=t,i=Cn(t),a=Un(t);if(r.type===`2d`||!e||a.mode!==`absolute-height`||n?.numCommittedVertices!==1||!i||i.type!==`draw-polyline`&&i.type!==`draw-polygon`||i.elevation.locked)return;let[o,s,c]=e,l=Hn(o,s,c,a,t);l!=null&&i.elevation.lock(l)}function Sn(e){Cn(e)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function Cn({geometryType:e,graphic:t,tooltipInfos:n}){return t?.geometry?.type===wn[e]||e===`circle`||e===`rectangle`?n[e]:null}var wn={point:`point`,multipoint:`multipoint`,mesh:`mesh`,polyline:`polyline`,polygon:`polygon`,circle:`polygon`,rectangle:`polygon`,freehandPolygon:`polygon`,freehandPolyline:`polyline`,text:`point`};function Tn(e,t){switch(e?.type){case`draw-point`:En(e,t);break;case`draw-multipoint`:Dn(e,t);break;case`draw-polyline`:An(e,t);break;case`draw-polygon`:jn(e,t);break;case`draw-rectangle`:Fn(e,t);break;case`draw-circle`:In(e,t);break;case`draw-mesh`:On(e,t)}}function En(e,t){let n=t.graphic?.geometry;n?.type===`point`&&(kn(e,t),e.helpMessage=R(`point`,n,t.drawOperation.drawingMode))}function Dn(e,t){let n=t.graphic?.geometry;n?.type===`multipoint`&&(kn(e,t),e.helpMessage=R(`multipoint`,n,t.drawOperation.drawingMode))}function On(e,t){let{graphic:n,view:r}=t,i=n?.geometry;r.type!==`3d`||i&&i.type!==`mesh`||(kn(e,t),i&&jt(e,i),e.helpMessage=Xt(n,r))}function kn(e,t){let{drawOperation:n,view:r,sketchOptions:i}=t,{cursorVertex:a,hasZ:o}=n;e.sketchOptions=i,e.viewType=r.type,e.setLocationFromPoint(a,q(t)),e.setElevationFromPoint(a,{hasZ:o}),n.constraints=a?{context:Gn(a,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}:void 0}function An(e,t){let{createOperationGeometry:n,drawOperation:r,automaticLengthMeasurementUtils:i}=t,a=n==null?null:n.full;a&&a.type!==`polyline`||(Nn(e,t),e.totalLength.actual=r.lastVertex?(a?i.autoLength2D(a):null)??k:null,e.helpMessage=R(`polyline`,a,t.drawOperation.drawingMode))}function jn(e,t){let{createOperationGeometry:n,drawOperation:r}=t,i=n==null?null:n.full;i&&i.type!==`polygon`||(Nn(e,t),e.area.actual=r.lastVertex?(i?t.automaticAreaMeasurementUtils.autoArea2D(i):null)??A:null,e.helpMessage=R(`polygon`,i,t.drawOperation.drawingMode))}var Mn=me(fe);function Nn(e,t){let{drawOperation:n,sketchOptions:r,view:i,automaticLengthMeasurementUtils:a}=t,{cursorVertex:o,lastVertex:s,secondToLastVertex:c,hasZ:l}=n,u=r.values.effectiveDirectionMode;e.sketchOptions=r,e.viewType=i.type;let d=s&&o?a.autoDistanceBetweenPoints2D(Mn(s),Mn(o))??k:null;e.distance.actual=d,e.distance.readOnly=s==null;let f=s!==null&&(u===`absolute`||c);if(e.direction.actual=null,e.direction.readOnly=!f,f&&o){let t=It(c,s,o,u);e.direction.actual=t??Ve}e.setLocationFromPoint(o,q(t)),e.setElevationFromPoint(o,{hasZ:l});let p=Pn(s,t);e.xyMode=p,e.direction.visible=p===`direction-distance`,e.distance.visible=p===`direction-distance`,e.effectiveX.visible=p===`coordinates`,e.effectiveY.visible=p===`coordinates`;let m=o??s;n.constraints=m?{context:Gn(m,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function Pn(e,{sketchOptions:t}){let n=t.tooltips.xyMode;return n===`auto`?e?`direction-distance`:`coordinates`:n}function Fn(e,t){e.sketchOptions=t.sketchOptions,e.xSize=Rn(t),e.ySize=zn(t),e.area=Ln(t),e.helpMessage=R(`rectangle`,t.graphic?.geometry,t.drawOperation.drawingMode)}function In(e,t){let{forceUniformSize:n,sketchOptions:r}=t;e.sketchOptions=r,e.radius=n?Bn(t):null,e.xSize=n?null:Rn(t),e.ySize=n?null:zn(t),e.area=Ln(t),e.helpMessage=R(`circle`,t.graphic?.geometry,t.drawOperation.drawingMode)}function Ln(e){let t=e.createOperationGeometry?.full;return t?.type===`polygon`?e.automaticAreaMeasurementUtils.autoArea2D(t)??A:A}function Rn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){let n=e?.rectangle?.midpoints;return(n==null?null:t.autoDistanceBetweenPoints2D(n.left,n.right))??k}function zn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){let n=e?.rectangle?.midpoints;return(n==null?null:t.autoDistanceBetweenPoints2D(n.top,n.bottom))??k}function Bn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){return(e?.circle?.center!=null&&e.circle.edge!=null?t.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??k}function Vn(e){let{geometryType:t,tooltipInfos:n}=e;switch(t){case`point`:case`multipoint`:case`mesh`:case`polyline`:case`polygon`:{let r=n[t].elevation.committed;return r?Be(r,`meters`)/d(q(e)):void 0}default:return}}function Hn(e,t,n,r,i){let{view:a,drawOperation:o}=i;if(a.type!==`3d`||!o)return;n??=0;let s=q(i),c=Un(i),l=Pe(a,e,t,n,s,c,r);return it(l,s)??Wn(i)}function Un(e){return e.drawOperation.elevationInfo??Ie}function q(e){return e.drawOperation.coordinateHelper.spatialReference}function Wn(e){let t=d(q(e));return He(e.defaultZ*t,`meters`)}function Gn(e,t){return tn(e,t.view,q(t),Un(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var Kn=class{constructor(){this._isToolEditable=!0,this._manipulators=new ce,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){this.addMany([e],t)}addMany(e,t=0){for(let n of e){let e={manipulator:n,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){let e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,e=>{t(e)})}forEach(e){for(let t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){let e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let n=null,r=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:i,attached:a})=>{if(!a||!i.interactive)return;let o=i.intersectionDistance(e,t);o!=null&&o<r&&(r=o,n=i)}),n}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||=(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),!0)}_detachManipulator(e){if(!e.attached)return;let t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===2||(this._isToolEditable?e.visibilityPredicate===0:e.visibilityPredicate===1)}},J=class extends _e{constructor(e){super(e),this.manipulators=new Kn,this.automaticManipulatorSelection=!0,this.multiTouchEnabled=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[1,!0],[0,!0]]),this._creationFinishedResolver=f()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get(`visible`)!==e&&(this._set(`visible`,e),this._syncVisible())}get editable(){return this.getEditableFlag(0)}set editable(e){this.setEditableFlag(0,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set(`view`,null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit(`cancel`)}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===0&&this.notifyChange(`editable`),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){let e=this.view.inputManager.latestPointerInfo?.location;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:n})=>{n.dragging&&(t=!0,n.events.emit(`drag`,{action:`end`,start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set(`created`,!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};T([i({constructOnly:!0})],J.prototype,`view`,void 0),T([i({readOnly:!0})],J.prototype,`active`,null),T([i({value:!0})],J.prototype,`visible`,null),T([i({value:!0})],J.prototype,`editable`,null),T([i({readOnly:!0})],J.prototype,`manipulators`,void 0),T([i({readOnly:!0})],J.prototype,`updating`,null),T([i()],J.prototype,`cursor`,null),T([i({readOnly:!0})],J.prototype,`automaticManipulatorSelection`,void 0),T([i({readOnly:!0})],J.prototype,`multiTouchEnabled`,void 0),T([i()],J.prototype,`hasFocusedManipulators`,null),T([i()],J.prototype,`hasGrabbedManipulators`,void 0),T([i()],J.prototype,`hasHoveredManipulators`,void 0),T([i()],J.prototype,`firstGrabbedManipulator`,void 0),T([i({readOnly:!0})],J.prototype,`created`,void 0),T([i({readOnly:!0})],J.prototype,`removeIncompleteOnCancel`,void 0),J=T([h(`esri.views.interactive.InteractiveToolBase`)],J);var Y=class extends J{constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Ke}initialize(){let{view:e}=this;this.internalGraphicsLayer=new ze({listMode:`hide`,internal:!0,title:`DrawGraphicTool layer`}),this.view.map.layers.add(this.internalGraphicsLayer);let t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=yn(e.type,this.sketchOptions);let n=kt(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=n,bn(this._tooltipsContext),this._coordinateFormatterLoadTask=ne(()=>Mt()),this.addHandles([t.on(`vertex-add`,e=>this.onVertexAdd(e)),t.on(`vertex-remove`,e=>this.onVertexRemove(e)),t.on(`vertex-update`,e=>this.onVertexUpdate(e)),t.on(`cursor-update`,e=>this.onCursorUpdate(e)),t.on(`cursor-remove`,()=>this._updateGraphic()),t.on(`complete`,e=>this.onComplete(e)),this._coordinateFormatterLoadTask,n.on(`paste`,e=>Ot(e,this.activeTooltipInfo)),E(()=>this.cursor,e=>{t.cursor=e},ge),Ce(()=>{let{activeTooltipInfo:e,sketchOptions:t}=this;Tn(e,this._tooltipsContext),n.info=t.tooltips.effectiveEnabled?e:null}),Ce(()=>{t.constraintZ=Vn(this._tooltipsContext)},S)]),this.finishToolCreation(),t.initializePointer()}destroy(){this.drawOperation=D(this.drawOperation),this.tooltip=D(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=D(this.internalGraphicsLayer),this._set(`view`,null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){let{defaultZ:e,directionOptions:t,drawOperation:n,forceUniformSize:r,geometryType:i,graphic:a,sketchOptions:o,tooltipInfos:s,view:c,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:u}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:e,directionOptions:t,drawOperation:n,forceUniformSize:r,geometryType:i,graphic:a,sketchOptions:o,tooltipInfos:s,view:c,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:u}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set(`centered`,e),this._updateGraphic()}get cursor(){return this._get(`cursor`)}set cursor(e){this._set(`cursor`,e)}set enabled(e){this.drawOperation.interactive=e,this._set(`enabled`,e)}set forceUniformSize(e){this._set(`forceUniformSize`,e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set(`graphicSymbol`,e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){let t=this.drawOperation;t&&(t.drawingMode=e),this._set(`mode`,e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){let{view:{type:e,map:t}}=this;return e===`2d`&&t&&`undoRedo`in t&&t.undoRedo instanceof L?t.undoRedo:null}set undoRedo(e){this._override(`undoRedo`,e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||At(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&bn(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(X.outline),this.removeHandles(X.regularVertices),this.removeHandles(X.activeVertex),this.removeHandles(X.activeEdge),this.removeHandles(qn)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;let t=new Se({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange(`graphic`),this.addHandles(x(()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)}),qn),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(this.drawOperation==null)return;let{coordinateHelper:t,view:n,visualizationCursorVertex:r,lastVertex:i,committedVertices:a,geometryIncludingUncommittedVertices:o,numCommittedVertices:s}=this.drawOperation;if(!(s>0||r!=null))return;let c=e.operationComplete?a:o,l=c.length,u=r==null?null:t.pointToArray(r),d=this._drawSpatialReference,f=n.type===`3d`&&n.viewingMode===`global`,p=new Gt;p.committedVertices=a,p.cursorVertex=u;let{geometryType:m}=this;switch(m){case`point`:case`mesh`:p.full=t.arrayToPoint(c[0]);break;case`multipoint`:p.full=l>0?ft(c,d):null;break;case`polyline`:case`polygon`:l>0&&(p.full=m===`polygon`?ct([c],d,f,!0):at([c],d,f),p.cursorEdge=u!=null&&i&&!P(r,i)?at([[u,t.pointToArray(i)]],d,f):null,p.outline=l>1?p.full:null);break;case`circle`:case`rectangle`:{if(p.committedVertices=p.cursorVertex=null,!l)break;let t=ot(n,c[0]),r=c[0],i=t.makeMapPoint(r[0]+Yn*n.resolution,r[1]);m===`circle`?l===1&&e.operationComplete?p.circle=lt([r,i],t,!0):l===2&&(this.forceUniformSize?p.circle=lt(c,t,this.centered):p.rectangle=dt(c,t,this.centered)):l===1&&e.operationComplete?p.rectangle=st([r,i],t,!0):l===2&&(p.rectangle=this.forceUniformSize?st(c,t,this.centered):ut(c,t,this.centered)),p.full=p.circle==null?p.rectangle?.geometry:p.circle.geometry,p.outline=p.full?.type===`polygon`?p.full:null;break}default:return null}return p}initializeGraphic(e){return x()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){let e=this._getCreateOperationGeometry({operationComplete:!0});e!=null&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit(`complete`,{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit(`cursor-update`,e)}onDeactivate(){let{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return x()}onCursorEdgeChanged(e){return x()}onVertexAdd(e){Sn(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||xn(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit(`vertex-add`,e)}onVertexRemove(e){Sn(this._tooltipsContext),this._updateGraphic(),this.emit(`vertex-remove`,e)}onVertexUpdate(e){this._updateGraphic(),this.emit(`vertex-update`,e)}_updateGraphic(){let e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e==null?this._destroyAllVisualizations():(e.cursorEdge==null?this.removeHandles(X.activeEdge):this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),X.activeEdge),e.outline==null?this.removeHandles(X.outline):this.addHandles(this.onOutlineChanged(e.outline),X.outline),e.committedVertices==null?this.removeHandles(X.regularVertices):this.addHandles(this.onRegularVerticesChanged(e.committedVertices),X.regularVertices),e.cursorVertex==null?this.removeHandles(X.activeVertex):this.addHandles(this.onActiveVertexChanged(e.cursorVertex),X.activeVertex),e.full==null?this.removeHandles(qn):this._createOrUpdateGraphic(e.full))}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?Cn(this._tooltipsContext):null}};T([i()],Y.prototype,`_coordinateFormatterLoadTask`,void 0),T([i()],Y.prototype,`_createOperationGeometry`,void 0),T([i()],Y.prototype,`_tooltipsContext`,null),T([i({value:!0})],Y.prototype,`centered`,null),T([i()],Y.prototype,`cursor`,null),T([i({nonNullable:!0})],Y.prototype,`defaultZ`,void 0),T([i({constructOnly:!0})],Y.prototype,`directionOptions`,void 0),T([i()],Y.prototype,`drawOperation`,void 0),T([i()],Y.prototype,`elevationLockOnVertexAddDisabled`,void 0),T([i({value:!0})],Y.prototype,`enabled`,null),T([i({value:!0})],Y.prototype,`forceUniformSize`,null),T([i({constructOnly:!0})],Y.prototype,`geometryType`,void 0),T([i()],Y.prototype,`graphic`,null),T([i({constructOnly:!0})],Y.prototype,`graphicProperties`,void 0),T([i()],Y.prototype,`graphicSymbol`,null),T([i({constructOnly:!0})],Y.prototype,`hasZ`,void 0),T([i({constructOnly:!0})],Y.prototype,`geometryToPlace`,void 0),T([i()],Y.prototype,`mode`,null),T([i()],Y.prototype,`snappingManager`,void 0),T([i()],Y.prototype,`snapToScene`,void 0),T([i()],Y.prototype,`tooltip`,void 0),T([i()],Y.prototype,`tooltipInfos`,void 0),T([i({constructOnly:!0,type:Ke})],Y.prototype,`sketchOptions`,void 0),T([i()],Y.prototype,`updating`,null),T([i({constructOnly:!0,nonNullable:!0})],Y.prototype,`view`,void 0),T([i({constructOnly:!0})],Y.prototype,`automaticAreaMeasurementUtils`,void 0),T([i({constructOnly:!0})],Y.prototype,`automaticLengthMeasurementUtils`,void 0),T([i({constructOnly:!0})],Y.prototype,`undoRedo`,null),T([i()],Y.prototype,`activeTooltipInfo`,null),Y=T([h(`esri.views.draw.DrawGraphicTool`)],Y);var qn=Symbol(`create-operation-graphic`),X={outline:Symbol(`outline-visual`),regularVertices:Symbol(`regular-vertices-visual`),activeVertex:Symbol(`active-vertex-visual`),activeEdge:Symbol(`active-edge-visual`)};function Jn(e){switch(e){case`point`:case`polyline`:case`polygon`:case`multipoint`:return e;case`circle`:case`rectangle`:return`segment`;case`mesh`:return`point`}}var Yn=48,Xn=`click`,Z=class extends w{constructor(e){super(e),this.events=new le,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};T([i()],Z.prototype,`interactive`,void 0),T([i()],Z.prototype,`selectable`,void 0),T([i()],Z.prototype,`cursor`,void 0),T([i()],Z.prototype,`grabbing`,void 0),T([i()],Z.prototype,`grabbable`,void 0),T([i()],Z.prototype,`consumesClicks`,void 0),T([i()],Z.prototype,`grabbableForEvent`,void 0),T([i()],Z.prototype,`dragging`,void 0),T([i()],Z.prototype,`hovering`,void 0),T([i()],Z.prototype,`selected`,void 0),Z=T([h(`esri.views.draw.LegacyDrawManipulator`)],Z);function Zn(e,t){let n=null,r=null;return i=>{if(i.action===`cancel`)return void(r!=null&&(r.execute({action:`cancel`}),n=null,r=null));let a={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};i.action===`start`&&n==null&&(n=new pr,r=new pr,t(e,n,r,i.pointerType,a)),n?.execute(a),i.action===`end`&&n!=null&&(n=null,r=null)}}function Qn(e,t){return e.events.on(`drag`,Zn(e,t))}function $n(e,t){let n=[e.x,e.y,e.z??0],r=t,i=[Math.cos(r),Math.sin(r)],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(a===0)return null;i[0]/=a,i[1]/=a;let o=e=>{let t=(e.x-n[0])*i[0]+(e.y-n[1])*i[1];e.x=n[0]+t*i[0],e.y=n[1]+t*i[1]};return e=>(o(e.mapStart),o(e.mapEnd),{...e,axis:i})}function er(e){let t=null,n=lr();return r=>{if(r.action===`start`&&(t=nr(e,r.mapStart.spatialReference)),t==null)return null;let i=n(r);if(!i)return null;let{translationX:a,translationY:o,translationZ:s}=i;return t.move(a,o,s,r.action),i}}function tr(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():o(e,t)}function nr(e,t){let n=e.operations;if(!n)return null;let r=n.data.geometry,i=zt(t);if(r.spatialReference.equals(i))return rr(e,n,()=>{});if(r.type!==`mesh`){let t=tr(r,i);if(t==null)return null;let a=r.spatialReference,s=bt.fromGeometry(t,n.viewingMode);return rr(e,s,()=>{let e=s.data.geometry,t=o(e,a);n.trySetGeometry(t)})}if(Oe(r)){let t=tr(r.origin,i);if(!t)return null;let a=r.spatialReference,s=bt.fromGeometry(t,n.viewingMode);return rr(e,n,()=>{let e=o(s.data.geometry,a),t=e.x-r.origin.x,i=e.y-r.origin.y,c=(e.z??0)-(r.origin.z??0);n.move(t,i,c)})}return null}function rr(e,t,n){let r=0,i=0,a=0;return{move:(o,s,c,l)=>{l===`start`&&(r=0,i=0,a=0);let u=o-r,d=s-i,f=c-a;t.move(u,d,f),r+=u,i+=d,a+=f,n(),l===`end`&&e.endInteraction?.()}}}function ir(e,t=null,n){let r=null,i=t==null||e.spatialReference?.equals(t)?e=>e:e=>e==null?e:o(e,t),a={exclude:[],...n};return t=>{if(t.action===`start`&&(r=i(e.toMap(t.screenStart,a))),r==null)return null;let n=i(e.toMap(t.screenEnd,a));return n==null?null:{...t,mapStart:r,mapEnd:n}}}function ar(e){let t=e.map(e=>er(e)).filter(u),n=lr();return e=>{let r=n(e);return t.forEach(t=>t(e)),r}}function or(e){let t=e.operations?.createResetState();return e=>(t?.remove(),e)}function sr(e){let t=e.map(e=>or(e)).filter(e=>e!=null);return e=>(t.forEach(t=>t(e)),e)}function cr(){let e=0,t=0,n=0;return r=>{r.action===`start`&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z??0);let i=r.mapEnd.x-e,a=r.mapEnd.y-t,o=(r.mapEnd.z??0)-n;return e=r.mapEnd.x,t=r.mapEnd.y,n=r.mapEnd.z,{...r,mapDeltaX:i,mapDeltaY:a,mapDeltaZ:o,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function lr(){let e=0,t=0,n=0;return r=>{r.action===`start`&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z??0);let i=r.mapEnd.x-e,a=r.mapEnd.y-t,o=(r.mapEnd.z??0)-n;return{...r,translationX:i,translationY:a,translationZ:o}}}function ur(){let e=0,t=0;return n=>{n.action===`start`&&(e=n.screenStart.x,t=n.screenStart.y);let r=n.screenEnd.x-e,i=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:r,screenDeltaY:i}}}function dr(e,t){let n=null,r=0,i=0;return a=>{if(a.action===`start`&&(n=e.toScreen?.(t),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(r=a.screenStart.x-n.x,i=a.screenStart.y-n.y))),n==null)return null;let o=re(a.screenEnd.x-r,0,e.width),s=re(a.screenEnd.y-i,0,e.height),c=ie(o,s);return a.screenStart=n,a.screenEnd=c,a}}var fr=()=>{},pr=class e{constructor(){this.execute=fr}next(t,n=new e){return t!=null&&(this.execute=e=>{let r=t(e);r!=null&&n.execute(r)}),n}};function mr(e,t,n=[]){if(e.type===`2d`)return e=>e;let r=null;return i=>{i.action===`start`&&(r=e.toMap(i.screenStart,{exclude:n}),r!=null&&(r.z=Me(r,e,t)));let a=e.toMap(i.screenEnd,{exclude:n});a!=null&&(a.z=Me(a,e,t));let o=r!=null&&a!=null?{sceneStart:r,sceneEnd:a}:null;return{...i,scenePoints:o}}}function hr(e,t,n){let r=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,`scene`)??0,i=Rt(e);return i.z=r,i.hasZ=!0,i.z=Me(i,t,n),i}function gr(e,t){if(e.type===`2d`)return e=>e;let n=null;return r=>{r.action===`start`&&(n=hr(r.mapStart,e,t));let i=hr(r.mapEnd,e,t),a=n!=null&&i!=null?{sceneStart:n,sceneEnd:i}:null;return{...r,scenePoints:a}}}function _r({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:r,useZ:i=!0}){let a=new pr;if(t==null)return{snappingStep:[Er,a],cancelSnapping:Er};let o,s=null,c=null,l=null,u=()=>{s=ae(s),t.doneSnapping(),c?.frameTask.remove(),c=null,o=ue(o),l=null},d=vr(t,i,a),f=null,p=null,m=null;return{snappingStep:[a=>{if(!e(a))return a;let{action:h}=a;if(h===`start`){let{info:e}=a,r=yr(t.view);if(c=br(n,a,r),c.context.selfSnappingZ=null,!i&&e!=null){let t=Tr(n.coordinateHelper,e.handle.part);t!=null&&(c.context.selfSnappingZ={value:t,elevationInfo:n.elevationInfo??Ie})}}if(c!=null){let{context:e,originalScenePos:n,originalPos:u}=c,{mapEnd:g,mapStart:_,scenePoints:v}=a,y=xr(u,Cr(g,_)),b=Cr(_,u),x={...a,action:`update`},S=c.context,C=Sr(n,v),w=t.update({point:y,scenePoint:C,context:e});if(m=w,wr(g,w,b,i),f=y,p=C,h!==`end`){let{frameTask:e}=c;s??=new AbortController,l=t=>{r.addPromise(he(d({frameTask:e,event:x,context:S,point:y,scenePoint:C,delta:b,getLastState:()=>({point:f,scenePoint:p,updatePoint:t.forceUpdate?null:m})},s.signal)))},l({forceUpdate:!1}),o??=E(()=>t.options.effectiveEnabled,()=>l?.({forceUpdate:!0}))}}return h===`end`&&u(),a},a],cancelSnapping:e=>(u(),e)}}function vr(e,t,n){return l(async({frameTask:r,point:i,scenePoint:a,context:o,event:s,delta:c,getLastState:l},u)=>{let d=await r.schedule(()=>e.snap({point:i,scenePoint:a,context:o,signal:u}),u);if(d.valid){let a=await r.schedule(()=>d.apply(),u),f=l();f.point!=null&&i!==f.point&&(a=e.update({point:f.point,scenePoint:f.scenePoint,context:o})),f.updatePoint!=null&&P(a,f.updatePoint)||(wr(s.mapEnd,a,c,t),n.execute(s))}})}function yr(t){return t.type===`3d`?t.resourceController.scheduler.registerTask(y.SNAPPING):e}function br(e,t,n){return{context:new Tt({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info==null?null:t.info.handle,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin==null?t.mapStart:e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin),originalScenePos:t.scenePoints==null?null:t.scenePoints.sceneStart,frameTask:n}}function xr(e,[t,n,r]){let i=Rt(e);return i.x+=t,i.y+=n,i.hasZ&&(i.z+=r),i}function Sr(e,t){return e==null||t==null?null:xr(e,Cr(t.sceneEnd,t.sceneStart))}function Cr(e,t){let n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function wr(e,t,[n,r,i],a){e.x=t.x+n,e.y=t.y+r,a&&e.hasZ&&t.hasZ&&(e.z=t.z+i)}function Tr(e,t){if(!e.hasZ())return null;let n=t.vertices,r=null;for(let t of n){let n=e.getZ(t.pos);if(r!=null&&n!=null&&Math.abs(n-r)>1e-6)return null;r??=n}return r}function Er(e){return e}var Q=class extends w{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=l(async(e,t,n,r)=>{let i=this._frameTask;if(i==null)return;let a=await i.schedule(()=>t.snap({...e,context:n,signal:r}),r);a.valid&&await i.schedule(()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))},r)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){let t=this.view.type===`3d`?this.view?.resourceController?.scheduler:null;this._frameTask=t==null?e:t.registerTask(y.SNAPPING)}destroy(){this._abortController=ae(this._abortController),this._frameTask=ue(this._frameTask)}update(e,t,n){this._snapPoints=e;let{point:r,scenePoint:i}=e,a=t.update({point:r,scenePoint:i,context:n});return this.stagedPoint=a,a}async snap(e,t,n){let{point:r,scenePoint:i}=e;return this.stagedPoint=t.update({point:r,scenePoint:i,context:n}),this._snapPoints=e,this._abortController??=new AbortController,this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=ae(this._abortController),this._snapPoints=null}};T([i({constructOnly:!0})],Q.prototype,`view`,void 0),T([i()],Q.prototype,`stagedPoint`,null),T([i()],Q.prototype,`constrainResult`,void 0),T([i()],Q.prototype,`_stagedPoint`,void 0),Q=T([h(`esri.views.interactive.snapping.SnappingOperation`)],Q);var Dr=`progress`,Or=Symbol(),kr=Symbol(),$=class extends _e{constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Lt,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new de,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=je(cn),this._getPolylineOrPolygonConstraint=je(ln),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Ge,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo??(this.elevationInfo=Ne(!!e.hasZ))}initializePointer(){let e=this.view.inputManager?.latestPointerInfo;e!=null&&this._updatePointer(e.location,e.id,e.type)}initialize(){let{geometryType:e,view:t}=this,n=t.spatialReference,r=`viewingMode`in t.state?t.state.viewingMode:2,i=e===`segment`||e===`multipoint`?`polyline`:e;this.coordinateHelper=Et(this.hasZ,this.hasM,n),this._editGeometryOperations=new bt(new vt(i,this.coordinateHelper),r),this._snappingOperation=new Q({view:t}),this.addHandles([E(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:e,constraint:t},n)=>{let{snappingOptions:r}=this;if(r&&(r.forceDisabled=t!=null&&nt(t)),n!=null&&e===n.stagedPoint&&t!==n.constraint)return this._onKeyboardBasedChange();this._processCursor(e??this._screenToMap(this._stagedScreenPoint))},{equals:(e,t)=>e.stagedPoint===t.stagedPoint&&oe(e.constraint,t.constraint)}),E(()=>this.view.viewpoint,(e,t)=>{e&&t&&b(e,t)&&this._onKeyboardBasedChange()})]),this._activePart=new mt(n,r),this._editGeometryOperations.data.parts.push(this._activePart);let a=this.segmentLabels;a!=null&&(a.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},this.addHandles(E(()=>this.labelOptions.enabled,e=>{a.visible=e},ge))),this.addHandles(this._editGeometryOperations.on([`vertex-add`,`vertex-update`,`vertex-remove`],e=>{let t=e.vertices.map(e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)})),n=t.map(e=>e.coordinates),r=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.getFirstVertex()?.pos)??null;P(r,this.firstVertex)||(this.firstVertex=r);let i=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.getLastVertex()?.pos)??null;P(i,this.lastVertex)||(this.lastVertex=i);let a=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.segments.at(-1)?.leftVertex?.pos)??null;switch(P(a,this.secondToLastVertex)||(this.secondToLastVertex=a),this._processCursor(this.cursorVertex),e.type){case`vertex-add`:this.emit(e.type,{...e,added:n,vertices:t});break;case`vertex-update`:this.emit(e.type,{...e,updated:n,vertices:t});break;case`vertex-remove`:this.emit(e.type,{...e,removed:n,vertices:t})}}));let o=this._manipulator=new Z({consumesClicks:!1,grabbableForEvent:e=>this.drawingMode!==`click`||e.pointerType===`touch`&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(o),o.grabbable=e!==`point`&&e!==`multipoint`,this.addHandles([o.events.on(`immediate-click`,e=>this._onImmediateClick(e)),o.events.on(`immediate-double-click`,e=>this._onImmediateDoubleClick(e)),E(()=>this.drawingMode,()=>{this.removeHandles(Or),this.addHandles(this._createManipulatorDragPipeline(o),Or)},ge),E(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:e})=>{o.cursor=e},ge)]),Ye(this,()=>{let e=this.view.inputManager.latestPointerInfo?.type??`mouse`,t=this._getSnappingContext(e);if(this.snappingManager!=null){let e=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,t);this._updatingHandles.addPromise(he(e))}})}destroy(){D(this.segmentLabels),D(this._snappingOperation),this._editGeometryOperations=D(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){let{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){let e=this._updateAndGetEffectiveDrawSurface();return this.view.type===`3d`&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activePart.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){let{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case`point`:case`multipoint`:return this._getPointConstraint(e);case`polygon`:case`polyline`:return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set(`drawingMode`,e??`click`)}get effectiveCursor(){return this.loading?Dr:this._hideDefaultCursor?null:this.cursor||`crosshair`}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activePart.vertices.length}get snappingOptions(){return this.snappingManager==null?null:this.snappingManager.options}get cursorVertex(){return this._get(`cursorVertex`)}get visualizationCursorVertex(){return this._stagedPointerType===`mouse`?this.cursorVertex:null}get committableVertex(){let{cursorVertex:e,lastVertex:t,firstVertex:n,geometryType:r}=this;return r===`polygon`&&Nt(e,n)||Nt(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){let{committedVertices:e,committableVertex:t,coordinateHelper:n}=this,r=e.slice();return t!=null&&r.push(n.pointToArray(t)),r}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();let{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e),this._activePart)}complete(e){let t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();let{geometryType:n,numCommittedVertices:r}=this,i=n===`multipoint`&&r===0||n===`polyline`&&r<2||n===`polygon`&&r<3;n!==`segment`&&n!==`point`||this.commitStagedVertex(),this._createOperationCompleted=!i,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit(`complete`,{vertices:this.committedVertices.map((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e})),aborted:t,type:`complete`}))}onInputEvent(e){switch(e.type){case`pointer-down`:this._pointerDownStates.add(e.pointerId);break;case`pointer-up`:this._pointerDownStates.delete(e.pointerId)}switch(e.type){case`pointer-move`:return this._onPointerMove(e);case`hold`:return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){let t=v(this.cursorVertex),n=v(e),r=n&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(n)??n),i=this._snapToClosingVertex(r),a=this._applyConstraints(i);Nt(t,a)||(this._set(`cursorVertex`,a),this.segmentLabels?.set(`stagedVertex`,a==null?null:this.coordinateHelper.pointToVector(a)),a==null||this._stagedPointerType!==`mouse`?this.emit(`cursor-remove`):this.emit(`cursor-update`,{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activePart.vertices.length,coordinates:this.coordinateHelper.pointToArray(a)}],operation:`apply`,type:`vertex-update`}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!==`polygon`||this.numCommittedVertices<=2)return e;let t=this._mapToScreen(e);if(!t)return e;let n=this._activePart;return this._vertexWithinPointerDistance(n.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case`click`:return this._createManipulatorDragPipelineClick(e);case`freehand`:return this._createManipulatorDragPipelineFreehand(e);case`hybrid`:return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return Qn(e,(e,t,n,r)=>{let i=r===`touch`&&this._snappingEnabled;if(this.isCompleted||!i)return;let{snappingStep:a,cancelSnapping:o}=_r({predicate:()=>i,snappingManager:this.snappingManager,snappingContext:new Tt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next(e=>(i&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),e)).next(o),t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._processCursor(e.mapStart),(this.geometryType===`segment`||i&&!this.numCommittedVertices)&&this.commitStagedVertex()),e)).next(mr(this.view,this.elevationInfo)).next(...a).next(e=>(i&&(this._processCursor(e.mapEnd),e.action===`end`&&this.commitStagedVertex()),e)).next(e=>(e.action===`end`&&(this._stagedPointerType!==`mouse`&&this._snappingOperation.abort(),this.geometryType!==`segment`&&this.geometryType!==`point`||this.complete()),e))})}_createManipulatorDragPipelineFreehand(e){return Qn(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._snappingOperation.abort(),this.committableVertex??this._processCursor(e.mapStart),this.geometryType===`segment`&&this.commitStagedVertex()),e)).next(e=>{switch(e.action){case`start`:case`update`:this._processCursor(e.mapEnd),this.geometryType!==`polygon`&&this.geometryType!==`polyline`||this.commitStagedVertex();break;case`end`:this.complete()}return e})})}_createManipulatorDragPipelineHybrid(e){return Qn(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),kr),this._processCursor(e.mapStart),this.commitStagedVertex()),e)).next(e=>{switch(e.action){case`start`:case`update`:this._processCursor(e.mapEnd),this.geometryType!==`polygon`&&this.geometryType!==`polyline`||this.commitStagedVertex();break;case`end`:this._stagedPointerType!==`mouse`&&this._snappingOperation.abort(),this.removeHandles(kr),this.geometryType!==`segment`&&this.geometryType!==`point`||this.complete()}return e})})}get _drawAtFixedElevation(){let{constraintsEnabled:e,constraintZ:t,geometryType:n,numCommittedVertices:r}=this;return e?t!=null||n===`segment`&&r>0:(n===`segment`||n===`polygon`)&&r>0}_updateAndGetEffectiveDrawSurface(){let{constraintsEnabled:e,coordinateHelper:t,drawSurface:n,elevationDrawSurface:r,snapToSceneEnabled:i}=this;if(r==null)return n;if(!this.hasZ)return r.defaultZ=null,r;let a=this.elevationInfo?.mode,o=this.defaultZ,s=e||a===`absolute-height`;return i!=null&&(s=i),a===`on-the-ground`&&(s=!1),this._drawAtFixedElevation&&(o=(e?this.constraintZ:null)??t.getZ(this._activePart.vertices[0].pos),s=!1),s?n:(r.defaultZ=o,r)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode===`click`&&e.pointerType===`touch`&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType===`mouse`&&e.button===2||this._manipulator.dragging))try{let{drawingMode:t,geometryType:n}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;let r=this._screenToMap(e.screenPoint);if(r==null||r==null||t===`freehand`&&n!==`point`&&n!==`multipoint`)return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(r),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!==`mouse`&&this._processCursor(null),(t===`freehand`&&this.geometryType!==`multipoint`||n===`point`||n===`segment`&&this.numCommittedVertices===2||n===`segment`&&t===`hybrid`&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType===`point`||(this.complete(),e.stopPropagation())}_onPointerMove(e){let t=ie(e.x,e.y);this._updatePointer(t,e.pointerId,e.pointerType)&&e.stopPropagation()}_updatePointer(e,t,n){return this._stagedScreenPoint=e,this._stagedPointerType=n,this._stagedPointerId=t,this._isDragging?(this._snappingOperation.abort(),!1):(this._processCursorMovementRelativeToSurface(e,n),!0)}_onKeyboardBasedChange(){this._stagedPointerType===`mouse`&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){let n=this._snappingOperation,r=this._screenToMap(e),i=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(r==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;let a=this.snappingManager;if(a==null)return this._processCursor(r),void n.abort();let o=this._getSnappingContext(t);this._updatingHandles.addPromise(he(n.snap({point:r,scenePoint:i},a,o)))}_applyConstraints(e){let{_constraint:t,constraints:n}=this;if(!e||!n||!t)return e;let{context:r}=n,i=fn(e,r),a=i?t.closestTo(i):void 0;if(!a)return e;let o=pn(a,e,r),s=this.view.type===`2d`||r.elevationInfo.mode!==`absolute-height`;return o!=null&&s&&this.constraintZ!=null&&this.hasZ&&(o.z=this.constraintZ),o}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action===`start`&&(e=this._screenToMap(t.screenStart)),e==null)return null;let n=this._screenToMap(t.screenEnd);return n==null?null:{...t,mapStart:e,mapEnd:n}}}_vertexWithinPointerDistance(e,t){let n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return n!=null&&Ar(n,t,25)}_getSnappingContext(e){let t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new Tt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t==null?null:{value:t,elevationInfo:this.elevationInfo},drawConstraints:this.constraints})}};function Ar(e,t,n){let r=e.x-t.x,i=e.y-t.y;return r*r+i*i<=n}T([i()],$.prototype,`_hideDefaultCursor`,void 0),T([i()],$.prototype,`_stagedPointerId`,void 0),T([i()],$.prototype,`_isDragging`,null),T([i()],$.prototype,`_snappingOperation`,void 0),T([i()],$.prototype,`_snappingEnabled`,null),T([i({constructOnly:!0})],$.prototype,`graphic`,void 0),T([i()],$.prototype,`constraintsEnabled`,void 0),T([i()],$.prototype,`constraints`,void 0),T([i()],$.prototype,`_constraint`,null),T([i()],$.prototype,`constraintZ`,void 0),T([i()],$.prototype,`defaultZ`,void 0),T([i()],$.prototype,`isDraped`,void 0),T([i({constructOnly:!0})],$.prototype,`automaticLengthMeasurementUtils`,void 0),T([i({value:Xn})],$.prototype,`drawingMode`,null),T([i({constructOnly:!0})],$.prototype,`elevationDrawSurface`,void 0),T([i({constructOnly:!0})],$.prototype,`elevationInfo`,void 0),T([i({constructOnly:!0,type:Ge})],$.prototype,`labelOptions`,void 0),T([i({constructOnly:!0})],$.prototype,`geometryType`,void 0),T([i({constructOnly:!0})],$.prototype,`hasM`,void 0),T([i({constructOnly:!0})],$.prototype,`hasZ`,void 0),T([i()],$.prototype,`cursor`,void 0),T([i()],$.prototype,`effectiveCursor`,null),T([i()],$.prototype,`loading`,void 0),T([i({constructOnly:!0})],$.prototype,`manipulators`,void 0),T([i({constructOnly:!0})],$.prototype,`drawSurface`,void 0),T([i({constructOnly:!0})],$.prototype,`segmentLabels`,void 0),T([i({constructOnly:!0})],$.prototype,`snappingManager`,void 0),T([i({constructOnly:!0})],$.prototype,`snappingVisualizer`,void 0),T([i()],$.prototype,`snapToSceneEnabled`,void 0),T([i({readOnly:!0})],$.prototype,`cursorVertex`,null),T([i({readOnly:!0})],$.prototype,`visualizationCursorVertex`,null),T([i()],$.prototype,`committableVertex`,null),T([i()],$.prototype,`firstVertex`,void 0),T([i()],$.prototype,`lastVertex`,void 0),T([i()],$.prototype,`secondToLastVertex`,void 0),T([i()],$.prototype,`updating`,null),T([i({constructOnly:!0})],$.prototype,`view`,void 0),$=T([h(`esri.views.draw.DrawOperation`)],$);var jr=class{constructor(e,t,n,r=null){this._elevationInfo=e,this.defaultZ=t,this._view=n,this._excludeGraphics=r}screenToMap(e){let{defaultZ:t,_view:n}=this,r=n.sceneIntersectionHelper.intersectElevationFromScreen(_(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return t==null&&r!=null&&(r.z=void 0),r}mapToScreen(e){let t=ke(e.x,e.y,Le(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){let{defaultZ:t}=this;return t!=null&&e.z!==t&&((e=Rt(e)).z=t),e}},Mr=class{constructor(e,t,n=[]){this.view=e,this.elevationInfo=t,this.exclude=n}screenToMap(e){let t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return t!=null&&(t.z=Me(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return this.elevationInfo!=null&&(t=ke(e.x,e.y,Le(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}},Nr=class{constructor(e,t=!1,n=0){this.view=e,this.hasZ=t,this.defaultZ=n,this.mapToScreen=t=>e.toScreen(t),this.screenToMap=t?t=>{let r=e.toMap(t);return r.z=n,r}:t=>e.toMap(t)}constrainZ(e){let{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=Rt(e)).z=t),e}};(class e{screenToMap(t){let{x:n,y:r}=t;return new fe({x:n,y:r,spatialReference:e.spatialReference})}mapToScreen(e){return ie(e.x,e.y)}constrainZ(e){return e}static{this.spatialReference=new we}});function Pr(e,t){return Ir(e,t,!1)}function Fr(e,t){return Ir(e,t,!0)}function Ir(e,t,n){if(e instanceof wt){if(e.operation instanceof xt)return Lr(e.operation,t,n),!0;if(e.operation instanceof _t)return Rr(e.operation,t,n),!0;if(e.operation instanceof Ct)return zr(e.operation,t,n),!0}return!1}function Lr(e,t,n=!1){let r=n?-1:1,i=ye(r*e.dx,r*e.dy,r*e.dz);m(t.origin,t.origin,i),Bt(t)}function Rr(e,t,n=!1){let r=n?-e.angle:e.angle;s(t.basis1,t.basis1,se,r),s(t.basis2,t.basis2,se,r),Bt(t)}function zr(e,t,n=!1){let i=n?1/e.factor1:e.factor1,a=n?1/e.factor2:e.factor2;r(t.basis1,t.basis1,i),r(t.basis2,t.basis2,a),ee(t.origin,t.origin,e.origin,e.axis1,i),ee(t.origin,t.origin,e.origin,e.axis2,a),Bt(t)}function Br(e,t,r,i,o=!1){i||=Vt();let s=n(O.get(),e[1],-e[0]),c=n(O.get(),1/0,1/0),l=n(O.get(),-1/0,-1/0),u=O.get(),d=t.allVerticesUnordered;d.forEach(({pos:t})=>{n(u,Ee(e,t),Ee(s,t)),xe(c,c,u),be(l,l,u)});let f=1e-6,p=n(O.get(),l[0]-c[0]<f?r/2:0,l[1]-c[1]<f?r/2:0);C(c,c,p),a(l,l,p);let h=o?d.reduce((e,t)=>e+(t.pos[2]??0),0)/d.length:0;return Te(i.basis1,e,(l[0]-c[0])/2),Te(i.basis2,s,(l[1]-c[1])/2),g(i.origin,c[0]*e[0]+c[1]*s[0],c[0]*e[1]+c[1]*s[1],h),m(i.origin,i.origin,i.basis1),m(i.origin,i.origin,i.basis2),Bt(i),i}export{Jn as C,Y as S,$n as _,Nr as a,sr as b,_r as c,ur as d,dr as f,or as g,er as h,jr as i,pr as l,mr as m,Fr as n,Mr as o,ar as p,Pr as r,$ as s,Br as t,ir as u,Qn as v,J as w,cr as x,gr as y};