const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/featureLayerUtils-ChRwWwyR.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/originUtils-CJnuu7mB.js","assets/utils-BnryXVma.js","assets/saveUtils-CEfw3trS.js","assets/fetchService-DUyN7SUy.js","assets/FeatureLayerSource-CkQek-Sk.js","assets/quatf64-D37SEdPg.js","assets/quat-C8PgLo31.js","assets/memoryEstimations-D_IbKyOk.js","assets/pbf-CO6WFbVS.js","assets/MeshLocalVertexSpace-vomIk0sx.js","assets/MeshTransform-BaPjlQwH.js","assets/axisAngleDegrees-DzAS4tF-.js","assets/External-C55iwtd6.js","assets/meshVertexSpaceUtils-s2jLb8qI.js","assets/OptimizedFeatureSet-CLjmRHYn.js","assets/OptimizedGeometry-BQJ7w5VU.js","assets/applyEditsUtils-CPVhCOou.js","assets/editingSupport-DiW8cYcp.js","assets/QueryEngineCapabilities-CxeEdoTy.js","assets/featureConversionUtils-o9-cJXzl.js","assets/FeatureLayerSource-Cwg0TQ9n.js","assets/QueryTask-6dVRoJFW.js","assets/executeForIds-Dq7stXFh.js","assets/query-BXrgTHrc.js","assets/urlUtils-CW4cnJ3W.js","assets/pbfQueryUtils-CmJPTrN7.js","assets/queryUtils-8f7b9mi_.js","assets/executeQueryJSON-DJO3NDvM.js","assets/executeQueryPBF-i-SuhVUp.js","assets/clientSideDefaults-Iizf0eUh.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,$r as n,A as r,Ai as i,Ar as a,BT as o,C as s,CE as c,Di as l,Dr as u,FE as d,Fi as ee,Hr as f,L as te,Lx as ne,M as re,Mi as ie,Mn as ae,O as oe,Pi as se,Pn as ce,Qh as le,Qp as p,Qr as ue,Rh as de,Ri as fe,Rn as pe,S as me,Sa as he,T as m,Tr as ge,UT as _e,Ua as h,VT as g,WT as _,Wh as ve,YT as ye,Yh as be,Zr as xe,_ as Se,_r as v,ar as Ce,b as we,ba as Te,cC as y,ca as b,cm as x,cp as S,cr as C,cv as w,fT as T,fr as E,gr as D,hr as O,hv as k,im as A,ip as Ee,ir as De,j as Oe,jE as ke,jT as Ae,jr as je,k as Me,kD as j,ka as M,ki as Ne,kw as N,lr as Pe,ma as Fe,mr as Ie,or as Le,pa as Re,pd as P,pv as F,qi as ze,sT as Be,sp as Ve,sr as He,tT as Ue,ta as We,ua as Ge,ur as Ke,vE as qe,vi as Je,vr as Ye,wp as Xe,xa as Ze,xr as Qe,y as $e,yr as I}from"./index-BN8X5Ryz.js";import{c as et}from"./colorUtils-CzajW9E7.js";import{r as tt}from"./cimSymbolUtils-CLt57XQ8.js";import{a as nt,n as rt}from"./utils-BGjabRH0.js";var L={key:`type`,base:Je,errorContext:`renderer`,typeMap:{simple:f,"unique-value":je,"class-breaks":ae}},R=ye({types:L});function it(e,t){let n=e.drawingInfo?.renderer,r=n?R(n,e,t):null;if(r?.type===`simple`)return nt(r.symbol,null)?r.symbol.clone():null}var at=[`#ed5151`,`#149ece`,`#a7c636`,`#9e559c`,`#fc921f`,`#ffde3e`,`#f789d8`,`#b7814a`,`#3caf99`,`#6b6bd6`,`#b54779`,`#7f7f7f`];function ot(e,t){return et(at,e,{offset:!0,shuffle:!0}).reverse().map(e=>{let n=t.clone();return n.type===`cim`?tt(n,e):rt(n,e),new f({symbol:n})})}var st=Symbol(`isSubtypeGroupGraphicOriginSymbol`),z,ct=class extends Te{get[(z=st,Ee)](){return this.sublayer}get[Ve](){return this.sublayer}get[Ze](){return this.layer}constructor(e){super(),this[z]=!0,this.type=`subtype-group`,this.sublayer=e}get layer(){return this.sublayer.parent}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},B=s(),lt=0;function V(e,t){let n=e.json.write;return typeof n!=`object`&&(n=e.json.write={}),n.ignoreOrigin=!0,t?.spatialOnly&&(n.layerContainerTypes=M),e}function H(e){let t={write:{ignoreOrigin:!0}};return e?.name&&(t.name=e.name),typeof t.write==`object`&&(e?.spatialOnly&&(t.write.layerContainerTypes=M),e?.target&&(t.write.target=e.target)),t}function ut(e){return new f({symbol:dt(e)})}function dt(e){switch(e){case`point`:case`multipoint`:return xe.clone();case`polyline`:return n.clone();case`polygon`:case`multipatch`:return ue.clone();default:return null}}function ft(e,t){return!!t&&e?.type===`unique-value`&&e.field!=null&&e.field.toLowerCase()===t.toLowerCase()&&!e.field2&&!e.field3&&!e.valueExpression}function U(e,t){return e==null?null:t.subtypes?.find(t=>t.code===e)}function pt(e,t){let n=null;switch(t.geometryType){case`esriGeometryPoint`:case`esriGeometryMultipoint`:n=`point`;break;case`esriGeometryPolyline`:n=`line`;break;case`esriGeometryPolygon`:case`esriGeometryMultiPatch`:n=`polygon`;break;default:t.type,n=null}let r={},i=U(e,t);if(i!=null){let{defaultValues:e}=i;for(let t in e)r[t]=e[t]}return r[t.subtypeField]=e,new m({name:`New Feature`,drawingTool:n,prototype:{attributes:r}})}var W=class extends h(N(ve(le))){constructor(e){super(e),this.attributeTableTemplate=null,this.charts=null,this.editingEnabled=!0,this.fieldOverrides=null,this.fieldsIndex=null,this.formTemplate=null,this.graphicOrigin=new ct(this),this.id=`${Date.now().toString(16)}-subtype-sublayer-${lt++}`,this.type=`subtype-sublayer`,this.labelsVisible=!0,this.labelingInfo=null,this.layerType=`ArcGISFeatureLayer`,this.legendEnabled=!0,this.listMode=`show`,this.minScale=0,this.maxScale=0,this.opacity=1,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.subtypeCode=null,this.templates=null,this.title=null,this.visible=!0}load(e){return p(this.renderer,this.fieldsIndex),Promise.resolve(this)}get _titleCreator(){let e=this._get(`_titleCreator`);return Ae(e),new we({fieldsIndex:this.fieldsIndex,objectIdField:this.objectIdField,displayField:this.parent?.displayField??``,fields:this.fields,effectivePopupTemplate:this.popupTemplate??this.defaultPopupTemplate})}get capabilities(){return this.parent?.capabilities}get effectiveCapabilities(){return this.parent?.effectiveCapabilities}get effectiveEditingEnabled(){let{parent:e}=this;return e?e.effectiveEditingEnabled&&this.editingEnabled:this.editingEnabled}get elevationInfo(){return this.parent?.elevationInfo}get featureTitleFields(){return[...this._titleCreator.requiredFields]}writeFieldOverrides(e,t,n){let{fields:r,parent:i}=this,a;if(r){a=[];let e=0;r.forEach(({name:t,alias:n,editable:r,visible:o})=>{if(!o)return;let s=i?.fields?.find(e=>e.name===t);if(!s)return;let c={name:t},l=!1;n!==s.alias&&(c.alias=n,l=!0),r!==s.editable&&(c.editable=r,l=!0),a.push(c),l&&e++}),e===0&&a.length===r.length&&(a=null)}else a=d(e);a?.length&&ke(n,a,t)}get fields(){let{parent:e,fieldOverrides:t,subtypeCode:n}=this,r=e?.fields;if(!e||!r?.length)return null;let{subtypes:i,subtypeField:a}=e,o=i?.find(e=>e.code===n),s=o?.defaultValues,c=o?.domains,l=[];for(let e of r){let r=e.clone(),{name:i}=r,o=t?.find(e=>e.name===i);if(r.visible=!t?.length||!!o,o){let{alias:e,editable:t}=o;e&&(r.alias=e),!1===t&&(r.editable=!1)}let u=s?.[i]??null;r.defaultValue=i===a?n:u;let d=c?.[i]??null;r.domain=i===a?null:d?d.type===`inherited`?r.domain:d.clone():null,l.push(r)}return l}get floorInfo(){return this.parent?.floorInfo}get isTable(){return!!this.parent?.isTable}get geometryType(){return this.parent?.geometryType}get globalIdField(){return this.parent?this.parent.globalIdField:(c.getLogger(this).error(q(`globalIdField`)),null)}get effectiveScaleRange(){let{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}get objectIdField(){return this.parent||c.getLogger(this).error(q(`objectIdField`)),this.parent?.objectIdField}get defaultPopupTemplate(){return this.createPopupTemplate()}get relationships(){return this.parent?.relationships}set renderer(e){p(e,this.fieldsIndex),this._override(`renderer`,e)}get renderer(){if(this._isOverridden(`renderer`))return this._get(`renderer`);let{parent:e}=this;return e&&!e.isTable&&e.geometryType!==`mesh`?ut(e.geometryType):null}readRendererFromService(e,t,n){if(t.type===`Table`)return null;let r=t.drawingInfo?.renderer,i=R(r,t,n),a,{subtypeCode:o}=this;if(o!=null&&ft(i,t.subtypeField)){let e=i.uniqueValueInfos?.find(({value:e})=>(e=typeof e==`number`?String(e):e)===String(o));e&&(a=new f({symbol:e.symbol}))}else i?.type!==`simple`||i.visualVariables?.length||(a=i);return a}readRenderer(e,t,n){let r=t?.layerDefinition?.drawingInfo?.renderer;if(r)return R(r,t,n)||void 0}get spatialReference(){return this.parent?.spatialReference??ne.WGS84}get subtypeField(){return this.parent?.subtypeField}readTemplatesFromService(e,t){return[pt(this.subtypeCode,t)]}readTitleFromService(e,t){let n=U(this.subtypeCode,t);return n==null?null:n.name}get url(){return this.parent?.url}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}async addAttachment(e,n){let{parent:r}=this;if(!r)throw q(`addAttachment`);if(e.getAttribute(r.subtypeField)!==this.subtypeCode)throw new t(`subtype-sublayer:addAttachment`,`The feature provided does not belong to this SubtypeSublayer`);return r.addAttachment(e,n)}async updateAttachment(e,n,r){let{parent:i}=this;if(!i)throw q(`updateAttachment`);if(e.getAttribute(i.subtypeField)!==this.subtypeCode)throw new t(`subtype-sublayer:updateAttachment`,`The feature provided does not belong to this SubtypeSublayer`);return i.updateAttachment(e,n,r)}async deleteAttachments(e,n){let{parent:r}=this;if(!r)throw q(`deleteAttachments`);if(e.getAttribute(r.subtypeField)!==this.subtypeCode)throw new t(`subtype-sublayer:deleteAttachments`,`The feature provided does not belong to this SubtypeSublayer`);return r.deleteAttachments(e,n)}async applyEdits(e,t){if(!this.parent)throw q(`applyEdits`);return this.parent.applyEdits(e,t)}createPopupTemplate(e){let t=this,{parent:n,fields:r,title:i}=this;if(n){let{displayField:e,editFieldsInfo:a,objectIdField:o}=n;t={displayField:e,editFieldsInfo:a,fields:r,objectIdField:o,title:i}}return Se(t,e)}createQuery(){if(!this.parent)throw q(`createQuery`);let e=v(this.parent),t=`${this.parent.subtypeField}=${this.subtypeCode}`;return e.where=A(t,this.parent.definitionExpression),e}getFeatureTitle(e,t){return this._titleCreator.getTitle(this,e,t)}getFeatureTitles(e,t){return this._titleCreator.getTitles(this,e,t)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains&&this.parent){let t=I(this.parent,e);if(t)return t}return this._getLayerDomain(e)}async queryAttachments(e,t){let n=await this.load();if(!n.parent)throw q(`queryAttachments`);let r=e instanceof a?e.clone():new a(e);return r.where=K(r.where,n.parent.subtypeField,n.subtypeCode),n.parent.queryAttachments(r,t)}async queryFeatureCount(e,t){let n=await this.load();if(!n.parent)throw q(`queryFeatureCount`);return n.parent.queryFeatureCount(G(n.parent,n,e),t)}async queryFeatures(e,t){let n=await this.load();if(!n.parent)throw q(`queryFeatures`);return n.parent.queryFeatures(G(n.parent,n,e),t)}async queryObjectIds(e,t){let n=await this.load();if(!n.parent)throw q(`queryObjectIds`);return n.parent.queryObjectIds(G(n.parent,n,e),t)}async queryRelatedFeatures(e,t){let n=await this.load();if(!n.parent)throw q(`queryRelatedFeatures`);return n.parent.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){let n=await this.load();if(!n.parent)throw q(`queryRelatedFeaturesCount`);return n.parent.queryRelatedFeaturesCount(e,t)}_getLayerDomain(e){let t=this.fieldsIndex.get(e);return t?t.domain:null}};j([o({clonable:!1,readOnly:!0})],W.prototype,`_titleCreator`,null),j([o({type:fe,json:H({name:`attributeTableInfo`})})],W.prototype,`attributeTableTemplate`,void 0),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`capabilities`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`effectiveCapabilities`,null),j([o({json:H()})],W.prototype,`charts`,void 0),j([o({type:Boolean,nonNullable:!0,json:H({name:`enableEditing`})})],W.prototype,`editingEnabled`,void 0),j([o({type:Boolean,readOnly:!0})],W.prototype,`effectiveEditingEnabled`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`elevationInfo`,null),j([o({clonable:!1,readOnly:!0})],W.prototype,`featureTitleFields`,null),j([o({json:{name:`layerDefinition.fieldOverrides`,origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],W.prototype,`fieldOverrides`,void 0),j([_e(`fieldOverrides`)],W.prototype,`writeFieldOverrides`,null),j([o({...B.fields,readOnly:!0,json:{read:!1}})],W.prototype,`fields`,null),j([o(B.fieldsIndex)],W.prototype,`fieldsIndex`,void 0),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`floorInfo`,null),j([o({type:he,json:H({name:`formInfo`})})],W.prototype,`formTemplate`,void 0),j([o({readOnly:!0,clonable:!1})],W.prototype,`graphicOrigin`,void 0),j([o({type:String,clonable:!1,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],W.prototype,`id`,void 0),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`isTable`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`geometryType`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`globalIdField`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`type`,void 0),j([o(V(d(ie)))],W.prototype,`labelsVisible`,void 0),j([o({type:[ce],json:{name:`layerDefinition.drawingInfo.labelingInfo`,origins:{service:{read:!1}},read:{reader:me},write:{ignoreOrigin:!0,layerContainerTypes:M}}})],W.prototype,`labelingInfo`,void 0),j([o({type:[`ArcGISFeatureLayer`],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,layerContainerTypes:M}}})],W.prototype,`layerType`,void 0),j([o(V(d(l)))],W.prototype,`legendEnabled`,void 0),j([o({type:[`show`,`hide`]})],W.prototype,`listMode`,void 0),j([o((()=>{let e=d(Ne);return e.json.origins.service.read=!1,V(e,{spatialOnly:!0})})())],W.prototype,`minScale`,void 0),j([o((()=>{let e=d(ee);return e.json.origins.service.read=!1,V(e,{spatialOnly:!0})})())],W.prototype,`maxScale`,void 0),j([o({readOnly:!0})],W.prototype,`effectiveScaleRange`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`objectIdField`,null),j([o({type:Number,range:{min:0,max:1},nonNullable:!0,json:H({spatialOnly:!0})})],W.prototype,`opacity`,void 0),j([o({clonable:!1})],W.prototype,`parent`,void 0),j([o(V(d(i)))],W.prototype,`popupEnabled`,void 0),j([o({type:S,json:H({name:`popupInfo`})})],W.prototype,`popupTemplate`,void 0),j([o({readOnly:!0})],W.prototype,`defaultPopupTemplate`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`relationships`,null),j([o({types:L,json:H({target:`layerDefinition.drawingInfo.renderer`,spatialOnly:!0})})],W.prototype,`renderer`,null),j([_(`service`,`renderer`,[`drawingInfo.renderer`,`subtypeField`,`type`])],W.prototype,`readRendererFromService`,null),j([_(`renderer`,[`layerDefinition.drawingInfo.renderer`])],W.prototype,`readRenderer`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`spatialReference`,null),j([o({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],W.prototype,`subtypeCode`,void 0),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`subtypeField`,null),j([o({type:[m],json:H({name:`layerDefinition.templates`})})],W.prototype,`templates`,void 0),j([_(`service`,`templates`,[`geometryType`,`subtypeField`,`subtypes`,`type`])],W.prototype,`readTemplatesFromService`,null),j([o({type:String,json:H()})],W.prototype,`title`,void 0),j([_(`service`,`title`,[`subtypes`])],W.prototype,`readTitleFromService`,null),j([o({readOnly:!0,json:{read:!1}})],W.prototype,`url`,null),j([o({readOnly:!0})],W.prototype,`userHasUpdateItemPrivileges`,null),j([o({type:Boolean,nonNullable:!0,json:H({name:`visibility`,spatialOnly:!0})})],W.prototype,`visible`,void 0),W=j([g(`esri.layers.support.SubtypeSublayer`)],W);var G=(e,t,n)=>{if(!n)return t.createQuery();let r=P.from(n);return r.where=K(r.where,e.subtypeField,t.subtypeCode),r},K=(e,t,n)=>{let r=RegExp(`${t}\\s*=\\s*\\d+`),i=`${t}=${n}`,a=e??``;return r.test(a)?a.replace(r,i):A(i,a)},q=e=>new t(`subtype-sublayer:parent-missing`,`This sublayer must have a parent SubtypeGroupLayer in order to use ${e}`),J=`SubtypeGroupLayer`;function Y(e,n){return new t(`layer:unsupported`,`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${n}`,{layer:e})}function X(e,t){let n=[];for(let r of e){let e=new W;e.read(r,t),n.push(e)}return n}var Z=s();function Q(){return{name:`layerType`,read:{enabled:!0},write:{enabled:!0,ignoreOrigin:!0,isRequired:!0}}}var $=class extends pe(We(ze(Ge(oe(r(Oe(Re(te(re(h(b(Fe(N(de)))))))))))))){constructor(...t){super(...t),this._sublayerLookup=new Map,this.fields=null,this.fieldsIndex=null,this.outFields=null,this.sublayers=new(k.ofType(W)),this.useUniqueColorsForSublayers=!0,this.supportedSourceTypes=new Set([`Feature Layer`,`Table`]),this.timeInfo=null,this.title=`Layer`,this.type=`subtype-group`,this._debouncedSaveOperations=Ue(async(t,n,r)=>{let{save:i,saveAs:a}=await e(async()=>{let{save:e,saveAs:t}=await import(`./featureLayerUtils-ChRwWwyR.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5,6]));switch(t){case 0:return i(this,n);case 1:return a(this,r,n)}}),this.addHandles(F(()=>this.sublayers,(e,t)=>this._handleSublayersChange(e,t),w))}destroy(){this.source?.destroy()}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}load(e){let n=e==null?null:e.signal,r=this.loadFromPortal({supportedTypes:[`Feature Service`]},e).catch(Be).then(async()=>{if(!this.url)throw new t(`subtype-grouplayer:missing-url-or-source`,`SubtypeGroupLayer must be created with either a url or a portal item`);if(this.layerId==null)throw new t(`subtype-grouplayer:missing-layerid`,`layerId is required for a SubtypeGroupLayer created with url`);this._initLayerProperties(await this.createGraphicsSource(n))}).then(()=>Ke(this,`load`,e));return this.addResolvingPromise(r),Promise.resolve(this)}get createQueryVersion(){return this.commitProperty(`definitionExpression`),this.commitProperty(`timeExtent`),this.commitProperty(`timeOffset`),this.commitProperty(`geometryType`),this.commitProperty(`gdbVersion`),this.commitProperty(`historicMoment`),this.commitProperty(`returnZ`),this.commitProperty(`capabilities`),this.commitProperty(`returnM`),(this._get(`createQueryVersion`)??0)+1}get editingEnabled(){return this.loaded&&this.capabilities!=null&&this.capabilities.operations.supportsEditing&&this.userHasEditingPrivileges}get effectiveEditingEnabled(){return Qe(this)}get operationalLayerType(){return this.isTable?`SubtypeGroupTable`:`SubtypeGroupLayer`}set source(e){this._get(`source`)!==e&&this._set(`source`,e)}readTitleFromService(e,{name:t}){return this.url?y(this.url,t):t}async addAttachment(e,t){let n=await Pe(this,e,t,J);return this.lastEditsEventDate=new Date,n}async updateAttachment(e,t,n){let r=await O(this,e,t,n,J);return this.lastEditsEventDate=new Date,r}async applyEdits(e,t){return ge(this,e,t)}async createGraphicsSource(t){let{default:n}=await T(e(()=>import(`./FeatureLayerSource-CkQek-Sk.js`),__vite__mapDeps([7,8,9,1,2,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32])),t);return new n({layer:this,supportedSourceTypes:this.supportedSourceTypes}).load({signal:t})}createQuery(){let e=v(this),t=this.sublayers.map(e=>e.subtypeCode);return e.where=A(`${this.subtypeField} IN (${t.join(`,`)})`,this.definitionExpression),e}async deleteAttachments(e,t){let n=await u(this,e,t,J);return this.lastEditsEventDate=new Date,n}async fetchRecomputedExtents(e){return Ie(this,e,J)}findSublayerForFeature(e){let t=this.fieldsIndex.get(this.subtypeField),n=e.attributes[t.name];return this.findSublayerForSubtypeCode(n)}findSublayerForSubtypeCode(e){return this._sublayerLookup.get(e)}getFieldDomain(e,t){if(!t?.excludeImpliedDomains){let t=I(this,e);if(t)return t}let n=D(this,t?.feature);if(n){let t=n.domains?.[e];return t?.type===`inherited`?this._getLayerDomain(e):t}return this._getLayerDomain(e)}loadAll(){return be(this,e=>{e(this.sublayers)})}async queryAttachments(e,t){return De(this,e,t,J)}async queryFeatures(e,t){let n=await this.load(),r=P.from(e)??n.createQuery(),i=r.outFields??[];i.includes(this.subtypeField)||(i.push(this.subtypeField),r.outFields=i);let a=await n.source.queryFeatures(r,t);if(a?.features)for(let e of a.features)e.origin=this.findSublayerForFeature(e)?.graphicOrigin,e.layer=e.sourceLayer=this.findSublayerForFeature(e);return a}async queryObjectIds(e,t){return(await E(this,e,t,J)).filter(x)}async queryFeatureCount(e,t){return C(this,e,t,J)}async queryExtent(e,t){return He(this,e,t,J)}async queryRelatedFeatures(e,t){return Ye(this,e,t,J)}async queryRelatedFeaturesCount(e,t){return Le(this,e,t,J)}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}write(e,n){let{origin:r,layerContainerType:i,messages:a}=n;if(this.isTable){if(r===`web-scene`||r===`web-map`&&i!==`tables`)return a?.push(Y(this,`using a table source cannot be written to web scenes and web maps`)),null}else if(this.loaded&&r===`web-map`&&i===`tables`)return a?.push(Y(this,`using a non-table source cannot be written to tables in web maps`)),null;return this.sublayers?.length?super.write(e,n):(a?.push(new t(`web-document-write:invalid-property`,`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' has invalid value for 'sublayers' property. 'sublayers' collection should contain at least one sublayer`,{layer:this})),null)}serviceSupportsSpatialReference(e){return!!this.loaded&&$e(this,e)}async getFeatureTitle(e,t){let n=this.findSublayerForFeature(e);return n?await n.getFeatureTitle(e,t):this._getFeatureTitleForUnknownSublayer(e)}async getFeatureTitles(e,t){let n=new Map,r=new Map,i=[r];return e.forEach(e=>{let t=this.findSublayerForFeature(e);if(t)qe(n,t,()=>[]).push(e);else{let t=e.getObjectId()??e.attributes[this.objectIdField];r.set(t,this._getFeatureTitleForUnknownSublayer(e))}}),(await Promise.all(Array.from(n).map(([e,n])=>e.getFeatureTitles(n,t)))).forEach(e=>i.push(e)),new Map(i.flatMap(e=>[...e]))}get featureTitleFields(){let e=new Set;for(let t of this.sublayers){let n=t.featureTitleFields;for(let t of n)e.add(t)}return[...e]}_getLayerDomain(e){let t=this.fieldsIndex.get(e);return t?t.domain:null}_initLayerProperties(e){this._set(`source`,e);let{sourceJSON:n}=e;if(n&&(this.sourceJSON=n,this.read(n,{origin:`service`,url:this.parsedUrl})),!this.subtypes?.length)throw new t(`subtype-grouplayer:missing-subtypes`,`SubtypeGroupLayer must be created using a layer with subtypes`);this._verifyFields(),Xe(this.timeInfo,this.fieldsIndex)}async hasDataChanged(){return Ce(this)}_verifyFields(){let e=this.parsedUrl?.path??`undefined`;this.objectIdField||console.log(`SubtypeGroupLayer: 'objectIdField' property is not defined (url: `+e+`)`),this.isTable||e.search(/\/FeatureServer\//i)!==-1||this.fields?.some(e=>e.type===`geometry`)||console.log(`SubtypeGroupLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: `+e+`)`)}_handleSublayersChange(e,t){t&&(t.forEach(e=>{e.parent=null}),this.removeHandles(`sublayers-owner`),this._sublayerLookup.clear()),e&&(e.forEach(e=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)}),this.addHandles([e.on(`after-add`,({item:e})=>{e.parent=this,this._sublayerLookup.set(e.subtypeCode,e)}),e.on(`after-remove`,({item:e})=>{e.parent=null,this._sublayerLookup.delete(e.subtypeCode)})],`sublayers-owner`))}_getFeatureTitleForUnknownSublayer(e){let{displayField:t,fieldsIndex:n,objectIdField:r}=this;if(t&&n.has(t))return e.attributes[n.get(t).name]??``;let i=e.getObjectId();return i==null?r&&n.has(r)?e.attributes[n.get(r).name]??``:``:i.toString()}};j([o({readOnly:!0})],$.prototype,`createQueryVersion`,null),j([o({readOnly:!0})],$.prototype,`editingEnabled`,null),j([o({readOnly:!0})],$.prototype,`effectiveEditingEnabled`,null),j([o({...Z.fields,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],$.prototype,`fields`,void 0),j([o(Z.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),j([o(se)],$.prototype,`id`,void 0),j([o({type:[`show`,`hide`,`hide-children`],json:{origins:{"portal-item":{read:!1,write:!1}}}})],$.prototype,`listMode`,void 0),j([o({type:[`SubtypeGroupLayer`,`SubtypeGroupTable`],json:{...Q(),origins:{"web-document":Q(),"portal-item":Q()}}})],$.prototype,`operationalLayerType`,null),j([o(Z.outFields)],$.prototype,`outFields`,void 0),j([o({clonable:!1})],$.prototype,`source`,null),j([o({type:k.ofType(W),json:{origins:{service:{read:{source:`subtypes`,reader(e,t,n){let r=null;if(this.useUniqueColorsForSublayers){let i=it(t,n);r=i?ot(e.length,i):null}let i=e.map(({code:e},i)=>{let a=new W({subtypeCode:e});a.read(t,n);let o=r?.[i];return o&&a.read({drawingInfo:{renderer:o.toJSON()}},n),a});return new(k.ofType(W))(i)}}}},read:{source:[`layers`,`tables`],reader(e,t,n){let r;return t.layerType===`SubtypeGroupLayer`&&t.layers?.length?r=X(t.layers,n):t.layerType===`SubtypeGroupTable`&&t.tables?.length&&(r=X(t.tables,n)),new(k.ofType(W))(r)}},write:{ignoreOrigin:!0,writer(e,t,n,r){let i=[];for(let t of e){let e=t.write({},r);i.push(e)}this.isTable?t.tables=i:t.layers=i}}}})],$.prototype,`sublayers`,void 0),j([o()],$.prototype,`useUniqueColorsForSublayers`,void 0),j([o({type:Me})],$.prototype,`timeInfo`,void 0),j([o({json:{origins:{"portal-item":{write:{enabled:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}}}})],$.prototype,`title`,void 0),j([_(`service`,`title`,[`name`])],$.prototype,`readTitleFromService`,null),j([o({json:{read:!1}})],$.prototype,`type`,void 0),j([o({clonable:!1,readOnly:!0})],$.prototype,`featureTitleFields`,null),$=j([g(`esri.layers.SubtypeGroupLayer`)],$);var mt=$;export{mt as default};