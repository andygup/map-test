import{am as e,dm as t,lm as n,om as r,q_ as i,vn as a,wn as o}from"./index-BN8X5Ryz.js";import"./ImmutableArray-C3KNQCVd.js";import{X as s,it as c,lt as l,nt as u,s as d,v as f,y as p}from"./Dictionary-Db5-uVgu.js";import"./shared-Bq4SQ-mm.js";import"./number-bRvGjlJj.js";import{t as m}from"./containerUtils-BDF13TJN.js";import{i as h,t as g}from"./WhereClause-CATd9kVz.js";import{t as _}from"./fieldStats-BspZIJTx.js";async function v(e,t,r,i){if(r.length===1){if(n(r[0]))return _(e,r[0],l(r[1],-1));if(u(r[0]))return _(e,r[0].toArray(),l(r[1],-1))}else if(r.length===2){if(n(r[0]))return _(e,r[0],l(r[1],-1));if(u(r[0]))return _(e,r[0].toArray(),l(r[1],-1));if(d(r[0])){let n=await r[0].load(),a=await b(g.create(r[1],{fieldsIndex:n.getFieldsIndex(),timeZone:n.dateFieldsTimeZoneDefaultUTC}),i,t);return y(t,await r[0].calculateStatistic(e,a,l(r[2],1e3),t.abortSignal))}}else if(r.length===3&&d(r[0])){let n=await r[0].load(),a=await b(g.create(r[1],{fieldsIndex:n.getFieldsIndex(),timeZone:n.dateFieldsTimeZoneDefaultUTC}),i,t);return y(t,await r[0].calculateStatistic(e,a,l(r[2],1e3),t.abortSignal))}return _(e,r,-1)}function y(t,n){return h.isTimestampOffset(n)?a.fromReaderAsTimeStampOffset(n.toStorageFormat()):e(n)?a.dateJSAndZoneToArcadeDate(n,p(t)):i.isDateTime(n)?a.dateTimeToArcadeDate(n):n}async function b(e,t,n){let r=e.getVariables();if(r.length>0){let i={};for(let e of r)i[e]=t.evaluateIdentifier(n,{name:e});e.parameters=i}return e}function x(e){e.mode===`async`&&(e.functions.stdev=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>v(`stdev`,t,i,e))},e.functions.variance=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>v(`variance`,t,i,e))},e.functions.average=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>v(`mean`,t,i,e))},e.functions.mean=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>v(`mean`,t,i,e))},e.functions.sum=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>v(`sum`,t,i,e))},e.functions.min=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>v(`min`,t,i,e))},e.functions.max=function(t,n){return e.standardFunctionAsync(t,n,(n,r,i)=>v(`max`,t,i,e))},e.functions.count=function(t,i){return e.standardFunctionAsync(t,i,async(e,a,c)=>{if(s(c,1,1,t,i),c[0]==null)return 0;if(d(c[0]))return c[0].count(e.abortSignal);if(n(c[0])||r(c[0]))return c[0].length;if(u(c[0]))return c[0].length();if(f(c[0]))return c[0].entryCount();throw new o(t,`InvalidParameter`,i)})},e.functions.isempty=function(n,r){return e.standardFunctionAsync(n,r,async(e,n,r)=>{if(s(r,1,2,e,n),r.length>=2&&!t(r[1]))throw new o(e,`InvalidParameter`,n);return l(r[1],!1)?d(r[0])?await r[0].isEmpty(e.abortSignal):m(r[0]):c(r[0])})})}export{x as registerFunctions};