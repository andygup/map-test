import{$x as e,Ab as t,Aw as n,BT as r,Db as i,ET as a,Ex as o,FE as s,Fb as c,Gl as l,Hl as u,Jr as d,Kg as f,Lx as p,Mb as m,Nb as h,Nl as g,OT as ee,Od as _,Rl as v,Sb as y,Sg as te,TT as b,Ul as x,VT as S,Vr as ne,Xl as re,Xw as ie,Zl as ae,_v as oe,cv as se,dg as ce,fv as le,gE as ue,gT as de,h_ as fe,hg as C,hv as pe,iS as me,jT as w,jb as he,jw as ge,kD as T,kb as _e,kl as ve,lg as ye,mv as be,oS as xe,pv as E,rE as Se,sD as Ce,sS as we,tT as Te,ug as Ee,vv as De,wg as Oe,ww as ke,x_ as Ae,y_ as je,zb as Me,zg as Ne,zi as Pe,zl as Fe}from"./index-BN8X5Ryz.js";import{n as Ie}from"./meshVertexSpaceUtils-s2jLb8qI.js";import{a as D}from"./vectorStacks-Cuo89CNO.js";import{n as Le}from"./projectPointToVector-BkRdoTqD.js";import{n as Re}from"./dehydratedPoint-CWZQBefp.js";import{t as ze}from"./projectVectorToVector-DGzn2p7I.js";import{t as Be}from"./memoize-Dl61_jt0.js";import{b as Ve,f as He,i as Ue,l as We,m as Ge,r as Ke,s as qe,x as Je}from"./elevationInfoUtils-uoMH3ofe.js";import{t as Ye}from"./GraphicsLayer-DBcl42yN.js";import{d as Xe,f as Ze,i as O,n as Qe,r as $e,t as k}from"./quantity-Co6flzuS.js";import{t as et}from"./geodesicUtils-D99LxQ6q.js";import{i as tt,t as nt}from"./SketchOptions-DjwJVzbR.js";import{d as A,f as rt,p as it}from"./LineSnappingHint-CmFAetWF.js";import{s as at}from"./snappingUtils-D3oTIKrZ.js";import{a as ot,d as st,i as ct,l as lt,n as ut,r as dt,s as ft,u as pt}from"./constraints-Ch5tsKD8.js";import{t as mt}from"./euclideanLengthMeasurementUtils-CvEUUrXw.js";import{a as ht,c as gt,i as _t,n as vt,o as yt,r as bt,s as xt,t as St}from"./createUtils-BVlp8HHH.js";import{_ as Ct,c as wt,d as j,f as Tt,h as Et,i as Dt,l as Ot,m as kt,n as At,o as jt,p as Mt,r as Nt,s as Pt,t as Ft,u as It,y as Lt}from"./SnappingContext-CJ1Obe6m.js";import{c as Rt,i as M,l as zt,s as Bt,u as Vt,y as Ht}from"./rotate-Drb-fn66.js";import{n as Ut,t as N}from"./dehydratedFeatureComparison-BCFMkftR.js";import{a as Wt,n as Gt,r as P,s as Kt}from"./angularMeasurementUtils-DQYnovl-.js";import{t as qt}from"./ReactiveSet-CN-U9t41.js";import{a as Jt,n as Yt}from"./hydratedFeatures-Cf3ay5ZM.js";import{t as Xt}from"./drapedUtils-BaZZPZSM.js";import{i as Zt,n as Qt}from"./boundedPlane-DKHNKWJN.js";var $t={UndoRedoUpdating:`Cannot perform operation whilst undo redo is updating`,UndoInvalidError:`There are no items to Undo`,RedoInvalidError:`There are no items to Redo`,ApplyInvalidError:`Cannot apply an item that is already applied`},F=class extends Error{constructor(){super($t.UndoRedoUpdating),this.type=`undo-redo-updating-error`}},en=class extends Error{constructor(){super($t.UndoInvalidError),this.type=`undo-redo-undo-error`}},tn=class extends Error{constructor(){super($t.RedoInvalidError),this.type=`undo-redo-redo-error`}},I=class extends n{constructor(){super(...arguments),this._stack=new pe,this._stackPosition=-1,this._updatingHandles=new Oe}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new en;if(this.updating)throw new F;let e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(1),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new tn;if(this.updating)throw new F;let e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new tn;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new F;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new F;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await le(()=>!this.updating);let n=new pe;for(let t=0;t<this._stack.length;t++){let r=this._stack.getItemAt(t);r&&(r.tag===e?(r.destroy(),t===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(r))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(e=!1){if(this.updating&&!e)throw new F;await le(()=>!this.updating),this._drainStack()}};T([r()],I.prototype,`_stack`,void 0),T([r()],I.prototype,`_stackPosition`,void 0),T([r()],I.prototype,`updating`,null),T([r({readOnly:!0})],I.prototype,`canUndo`,null),T([r({readOnly:!0})],I.prototype,`hasUndo`,null),T([r({readOnly:!0})],I.prototype,`canRedo`,null),T([r({readOnly:!0})],I.prototype,`hasRedo`,null),I=T([S(`esri.UndoRedo`)],I);var nn=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function L(e,t,n){if(e==null)return`noTool`;switch(e){case`point`:return rn();case`multipoint`:return`multipoint`;case`polyline`:return an(t,n);case`polygon`:return on(t,n);case`rectangle`:case`circle`:return sn(t,n);default:return}}function rn(e){return`point`}function an(e,t){let n=e!=null&&e.type===`polyline`&&e.paths.length?e.paths[0].length:0;return t===`freehand`?n<2?`freehandStart`:`freehandEnd`:n<2?`polylineZeroVertices`:`polylineOneVertex`}function on(e,t){let n=e!=null&&e.type===`polygon`&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case`freehand`:return`freehandStart`;case`hybrid`:return`polygonZeroVerticesHybrid`;default:return`polygonZeroVertices`}else if(n<4)return t===`freehand`?`freehandEnd`:`polygonOneVertex`;return`polygonTwoVertices`}function sn(e,t){if((e!=null&&e.type===`polygon`&&e.rings.length?e.rings[0].length:0)<3)switch(t){case`freehand`:return`freehandStart`;case`click`:return`shapeStartClick`;default:return`shapeStartHybrid`}switch(t){case`freehand`:return`freehandEnd`;case`click`:return`shapeEndClick`;default:return`shapeEndHybrid`}}function cn(t,n){let r=t?.geometry;if(!t||r?.type!==`mesh`||!n)return;let{renderCoordsHelper:i,elevationProvider:a}=n,{camera:o}=n.state,{extent:s}=r,{center:c,spatialReference:l}=s,u=e(l),d=we(l),f=e(i.spatialReference),p=s.width*u,m=s.height*d,h=(s.zmax??0)*d,g=h-(s.zmin??0)*d,ee=Math.max(p,m,g)/f,{x:_,y}=c,te=c.z??0;v(fn,_,y,te),i.toRenderCoords(fn,l,fn);let b=ee/o.computeScreenPixelSizeAt(fn);if(b>Math.min(o.width,o.height)/o.pixelRatio*un)return`meshTooClose`;if(b<ln)return`meshTooFar`;let x=We(t),{absoluteZ:S}=Je(_,y,h,l,n,x);return S<(a.getElevation(_,y,te,l,`ground`)??0)*d+g*dn?`meshUnderground`:`mesh`}var ln=20,un=1,dn=.1,fn=je();function pn(e,t,n,r,i,a){let o=`geodesic`,s=et(n),c=A();return it(e,t,r,c),c[2]=0,s&&ze(c,n,c,s)||(o=`euclidean`,s=n),{mode:o,view:t,elevationInfo:r,hasZ:i,directionMode:a,spatialReference:e.spatialReference,measurementSR:s,origin:c}}function mn(e,t,n){if(t==null||e==null)return;let r=xe(n.measurementSR);if(r==null)return;let i=Cn(e,n);if(i==null)return;let a=Xe(t,r);return new lt(i,a)}function hn(e,t,n,r){if(n==null||e==null)return;let i=Cn(e,r);if(i==null)return;let a=P(n),o=e=>{if(e==null)return;let t=A(),n=$e(e,`degrees`,`geographic`);return Gt(t,i,r.measurementSR,10,n,r.mode)?new pt(i,t):void 0},s=()=>{if(t!=null&&e!=null)return P(Wt(t,e))};switch(r.directionMode){case`absolute`:return o(a);case`relative`:{let e=s();return e==null?void 0:o(e+a)}case`relative-bilateral`:{let e=s();return e==null?void 0:ct([o(e+a),o(e-a)])}}}function gn(e,t){let n=Tn(e,t);return n==null?void 0:new st(n)}function _n(e,t,n){let{context:r,longitude:i,latitude:a,direction:o,distance:s,elevation:c}=n;if(i!=null||a!=null||s!=null||c!=null||o!=null){if(i!=null||a!=null){let e=P(i),t=P(a),n=Tn(c,r);return new dt(e,t,n)}return vn(e,t,n)}}function vn(e,t,{context:n,direction:r,distance:i,elevation:a}){if(t==null)return gn(a,n);let{view:o,elevationInfo:s,measurementSR:c}=n,l=it(t,o,s);if(!c||!ze(l,t.spatialReference,Dn,c))return;let[u,d]=Dn,f=i==null?void 0:Xe(i,`meters`),p=P(r),m=Tn(a,n),h=e=>{let t=new ut([u,d],c,f,m,e);return f==null||e==null||m==null&&n.hasZ?t:new ot(t.closestTo(l))};if(p==null)return h(void 0);let g=()=>{if(e!=null&&t!=null)return P(Wt(e,t))};switch(n.directionMode){case`absolute`:return h(p);case`relative`:{let e=g();return e==null?void 0:h(e+p)}case`relative-bilateral`:{let e=g();return e==null?void 0:ct([h(e+p),h(e-p)])}}}function yn(e){return e.context.mode===`geodesic`?_n(null,null,e):xn(e)}function bn(e,t,n){let{context:r,x:i,y:a,distance:o,direction:s,elevation:c}=n;return r.mode===`geodesic`?_n(t,e,n):i!=null||a!=null?xn(n):Sn([mn(e,o,r),hn(e,t,s,r),gn(c,r)])}function xn({x:e,y:t,elevation:n,context:r}){kn.x=e?.value??0,kn.y=t?.value??0,kn.spatialReference=r.spatialReference;let i=Cn(kn,r,On);return new dt(e!=null&&i!=null?i[0]:void 0,t!=null&&i!=null?i[1]:void 0,Tn(n,r))}function Sn(e){let t;for(let n of e)n&&(t=t?.intersect(n)??n);return t}function Cn(e,t,n=A()){let{view:r,elevationInfo:i,measurementSR:a,origin:o,mode:s}=t;if(it(e,r,i,n),ze(n,e.spatialReference,n,a))return s!==`geodesic`&&ve(n,n,o),n}function wn(e,t,n,r){let{view:i,measurementSR:a,spatialReference:o,origin:s,mode:c}=n;if(c===`geodesic`?u(R,e):x(R,e,s),ze(R,a,R,o))return rt(R,i,t,n,r)}function Tn(e,t){return En(e,t)?.value??void 0}function En(e,{view:t,origin:n,elevationInfo:r,hasZ:i,measurementSR:a}){if(e==null||!i)return;let o=me(a);if(o==null)return;let[s,c]=n,l=Xe(e,o),u=t?.type===`3d`?Ue(t,s,c,l,a,r):l;return u==null?void 0:Qe(u,o)}var Dn=A(),On=A(),R=A(),kn=Re(0,0,0,p.WGS84),z=class extends M{constructor(e){super(e),this.type=`draw-circle`,this.radius=null,this.xSize=null,this.ySize=null,this.area=k}get allFields(){return[]}};T([r()],z.prototype,`type`,void 0),T([r()],z.prototype,`radius`,void 0),T([r()],z.prototype,`xSize`,void 0),T([r()],z.prototype,`ySize`,void 0),T([r()],z.prototype,`area`,void 0),T([r()],z.prototype,`helpMessage`,void 0),T([r()],z.prototype,`allFields`,null),z=T([S(`esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo`)],z);var B=class extends j(M){constructor(e){super(e),this.type=`draw-mesh`,this.orientation=kt({lockable:!1}),this.scale=Ct({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};T([r()],B.prototype,`helpMessage`,void 0),T([r()],B.prototype,`allFields`,null),B=T([S(`esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo`)],B);var V=class extends j(M){constructor(e){super(e),this.type=`draw-multipoint`}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};T([r()],V.prototype,`helpMessage`,void 0),T([r()],V.prototype,`allFields`,null),V=T([S(`esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo`)],V);var H=class extends j(M){constructor(e){super(e),this.type=`draw-point`}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};T([r()],H.prototype,`helpMessage`,void 0),T([r()],H.prototype,`allFields`,null),H=T([S(`esri.views.interactive.tooltip.infos.DrawPointTooltipInfo`)],H);var U=class extends j(M){constructor(e){super(e),this.type=`draw-polygon`,this.direction=Mt(),this.distance=Tt(),this.area=Et(),this.xyMode=`direction-distance`}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};T([r()],U.prototype,`xyMode`,void 0),T([r()],U.prototype,`helpMessage`,void 0),T([r()],U.prototype,`allFields`,null),U=T([S(`esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo`)],U);var W=class extends j(M){constructor(e){super(e),this.type=`draw-polyline`,this.direction=Mt(),this.distance=Tt(),this.totalLength=Lt(),this.xyMode=`direction-distance`}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};T([r()],W.prototype,`helpMessage`,void 0),T([r()],W.prototype,`xyMode`,void 0),T([r()],W.prototype,`allFields`,null),W=T([S(`esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo`)],W);var G=class extends M{constructor(e){super(e),this.type=`draw-rectangle`,this.xSize=O,this.ySize=O,this.area=k}get allFields(){return[]}};T([r()],G.prototype,`type`,void 0),T([r()],G.prototype,`xSize`,void 0),T([r()],G.prototype,`ySize`,void 0),T([r()],G.prototype,`area`,void 0),T([r()],G.prototype,`helpMessage`,void 0),T([r()],G.prototype,`allFields`,null),G=T([S(`esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo`)],G);function An(e,t){return{point:new H({sketchOptions:t,viewType:e}),multipoint:new V({sketchOptions:t,viewType:e}),polyline:new W({sketchOptions:t,viewType:e}),polygon:new U({sketchOptions:t,viewType:e}),mesh:new B({sketchOptions:t,viewType:e}),rectangle:new G({sketchOptions:t}),circle:new z({sketchOptions:t})}}function jn(e){let{directionOptions:t,geometryType:n,sketchOptions:r,tooltipInfos:i}=e,a=t=>{let n=er(e).mode,r=i[t].elevation;n===`relative-to-ground`||n===`relative-to-scene`||n===`on-the-ground`?r.lock(tr(e)):r.unlock()},o=e=>{if(t){let n=i[e].direction;n.committed=t.angle,n.unlockOnVertexPlacement=!1,r.values.directionMode=t.mode}};switch(n){case`polygon`:case`polyline`:a(n),o(n);break;case`point`:case`mesh`:a(n)}}function Mn(e,t){let{drawOperation:n,view:r}=t,i=Pn(t),a=er(t);if(r.type===`2d`||!e||a.mode!==`absolute-height`||n?.numCommittedVertices!==1||!i||i.type!==`draw-polyline`&&i.type!==`draw-polygon`||i.elevation.locked)return;let[o,s,c]=e,l=$n(o,s,c,a,t);l!=null&&i.elevation.lock(l)}function Nn(e){Pn(e)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function Pn({geometryType:e,graphic:t,tooltipInfos:n}){return t?.geometry?.type===Fn[e]||e===`circle`||e===`rectangle`?n[e]:null}var Fn={point:`point`,multipoint:`multipoint`,mesh:`mesh`,polyline:`polyline`,polygon:`polygon`,circle:`polygon`,rectangle:`polygon`,freehandPolygon:`polygon`,freehandPolyline:`polyline`,text:`point`};function In(e,t){switch(e?.type){case`draw-point`:Ln(e,t);break;case`draw-multipoint`:Rn(e,t);break;case`draw-polyline`:Vn(e,t);break;case`draw-polygon`:Hn(e,t);break;case`draw-rectangle`:Kn(e,t);break;case`draw-circle`:qn(e,t);break;case`draw-mesh`:zn(e,t)}}function Ln(e,t){let n=t.graphic?.geometry;n?.type===`point`&&(Bn(e,t),e.helpMessage=L(`point`,n,t.drawOperation.drawingMode))}function Rn(e,t){let n=t.graphic?.geometry;n?.type===`multipoint`&&(Bn(e,t),e.helpMessage=L(`multipoint`,n,t.drawOperation.drawingMode))}function zn(e,t){let{graphic:n,view:r}=t,i=n?.geometry;r.type!==`3d`||i&&i.type!==`mesh`||(Bn(e,t),i&&Vt(e,i),e.helpMessage=cn(n,r))}function Bn(e,t){let{drawOperation:n,view:r,sketchOptions:i}=t,{cursorVertex:a,hasZ:o}=n;e.sketchOptions=i,e.viewType=r.type,e.setLocationFromPoint(a,K(t)),e.setElevationFromPoint(a,{hasZ:o}),n.constraints=a?{context:nr(a,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}:void 0}function Vn(e,t){let{createOperationGeometry:n,drawOperation:r,automaticLengthMeasurementUtils:i}=t,a=n==null?null:n.full;a&&a.type!==`polyline`||(Wn(e,t),e.totalLength.actual=r.lastVertex?(a?i.autoLength2D(a):null)??O:null,e.helpMessage=L(`polyline`,a,t.drawOperation.drawingMode))}function Hn(e,t){let{createOperationGeometry:n,drawOperation:r}=t,i=n==null?null:n.full;i&&i.type!==`polygon`||(Wn(e,t),e.area.actual=r.lastVertex?(i?t.automaticAreaMeasurementUtils.autoArea2D(i):null)??k:null,e.helpMessage=L(`polygon`,i,t.drawOperation.drawingMode))}var Un=ue(o);function Wn(e,t){let{drawOperation:n,sketchOptions:r,view:i,automaticLengthMeasurementUtils:a}=t,{cursorVertex:o,lastVertex:s,secondToLastVertex:c,hasZ:l}=n,u=r.values.effectiveDirectionMode;e.sketchOptions=r,e.viewType=i.type;let d=s&&o?a.autoDistanceBetweenPoints2D(Un(s),Un(o))??O:null;e.distance.actual=d,e.distance.readOnly=s==null;let f=s!==null&&(u===`absolute`||c);if(e.direction.actual=null,e.direction.readOnly=!f,f&&o){let t=Kt(c,s,o,u);e.direction.actual=t??Ze}e.setLocationFromPoint(o,K(t)),e.setElevationFromPoint(o,{hasZ:l});let p=Gn(s,t);e.xyMode=p,e.direction.visible=p===`direction-distance`,e.distance.visible=p===`direction-distance`,e.effectiveX.visible=p===`coordinates`,e.effectiveY.visible=p===`coordinates`;let m=o??s;n.constraints=m?{context:nr(m,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function Gn(e,{sketchOptions:t}){let n=t.tooltips.xyMode;return n===`auto`?e?`direction-distance`:`coordinates`:n}function Kn(e,t){e.sketchOptions=t.sketchOptions,e.xSize=Yn(t),e.ySize=Xn(t),e.area=Jn(t),e.helpMessage=L(`rectangle`,t.graphic?.geometry,t.drawOperation.drawingMode)}function qn(e,t){let{forceUniformSize:n,sketchOptions:r}=t;e.sketchOptions=r,e.radius=n?Zn(t):null,e.xSize=n?null:Yn(t),e.ySize=n?null:Xn(t),e.area=Jn(t),e.helpMessage=L(`circle`,t.graphic?.geometry,t.drawOperation.drawingMode)}function Jn(e){let t=e.createOperationGeometry?.full;return t?.type===`polygon`?e.automaticAreaMeasurementUtils.autoArea2D(t)??k:k}function Yn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){let n=e?.rectangle?.midpoints;return(n==null?null:t.autoDistanceBetweenPoints2D(n.left,n.right))??O}function Xn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){let n=e?.rectangle?.midpoints;return(n==null?null:t.autoDistanceBetweenPoints2D(n.top,n.bottom))??O}function Zn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){return(e?.circle?.center!=null&&e.circle.edge!=null?t.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??O}function Qn(e){let{geometryType:t,tooltipInfos:n}=e;switch(t){case`point`:case`multipoint`:case`mesh`:case`polyline`:case`polygon`:{let r=n[t].elevation.committed;return r?Xe(r,`meters`)/we(K(e)):void 0}default:return}}function $n(e,t,n,r,i){let{view:a,drawOperation:o}=i;if(a.type!==`3d`||!o)return;n??=0;let s=K(i),c=er(i),l=Ue(a,e,t,n,s,c,r);return mt(l,s)??tr(i)}function er(e){return e.drawOperation.elevationInfo??Ge}function K(e){return e.drawOperation.coordinateHelper.spatialReference}function tr(e){let t=we(K(e));return Qe(e.defaultZ*t,`meters`)}function nr(e,t){return pn(e,t.view,K(t),er(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var rr=class{constructor(){this._isToolEditable=!0,this._manipulators=new pe,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){this.addMany([e],t)}addMany(e,t=0){for(let n of e){let e={manipulator:n,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){let e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,e=>{t(e)})}forEach(e){for(let t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){let e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let n=null,r=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:i,attached:a})=>{if(!a||!i.interactive)return;let o=i.intersectionDistance(e,t);o!=null&&o<r&&(r=o,n=i)}),n}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||=(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),!0)}_detachManipulator(e){if(!e.attached)return;let t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===2||(this._isToolEditable?e.visibilityPredicate===0:e.visibilityPredicate===1)}},q=class extends De{constructor(e){super(e),this.manipulators=new rr,this.automaticManipulatorSelection=!0,this.multiTouchEnabled=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[1,!0],[0,!0]]),this._creationFinishedResolver=ie()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get(`visible`)!==e&&(this._set(`visible`,e),this._syncVisible())}get editable(){return this.getEditableFlag(0)}set editable(e){this.setEditableFlag(0,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set(`view`,null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit(`cancel`)}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===0&&this.notifyChange(`editable`),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){let e=this.view.inputManager.latestPointerInfo?.location;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:n})=>{n.dragging&&(t=!0,n.events.emit(`drag`,{action:`end`,start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set(`created`,!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};T([r({constructOnly:!0})],q.prototype,`view`,void 0),T([r({readOnly:!0})],q.prototype,`active`,null),T([r({value:!0})],q.prototype,`visible`,null),T([r({value:!0})],q.prototype,`editable`,null),T([r({readOnly:!0})],q.prototype,`manipulators`,void 0),T([r({readOnly:!0})],q.prototype,`updating`,null),T([r()],q.prototype,`cursor`,null),T([r({readOnly:!0})],q.prototype,`automaticManipulatorSelection`,void 0),T([r({readOnly:!0})],q.prototype,`multiTouchEnabled`,void 0),T([r()],q.prototype,`hasFocusedManipulators`,null),T([r()],q.prototype,`hasGrabbedManipulators`,void 0),T([r()],q.prototype,`hasHoveredManipulators`,void 0),T([r()],q.prototype,`firstGrabbedManipulator`,void 0),T([r({readOnly:!0})],q.prototype,`created`,void 0),T([r({readOnly:!0})],q.prototype,`removeIncompleteOnCancel`,void 0),q=T([S(`esri.views.interactive.InteractiveToolBase`)],q);var J=class extends q{constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new nt}initialize(){let{view:e}=this;this.internalGraphicsLayer=new Ye({listMode:`hide`,internal:!0,title:`DrawGraphicTool layer`}),this.view.map.layers.add(this.internalGraphicsLayer);let t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=An(e.type,this.sketchOptions);let n=zt(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=n,jn(this._tooltipsContext),this._coordinateFormatterLoadTask=te(()=>Ht()),this.addHandles([t.on(`vertex-add`,e=>this.onVertexAdd(e)),t.on(`vertex-remove`,e=>this.onVertexRemove(e)),t.on(`vertex-update`,e=>this.onVertexUpdate(e)),t.on(`cursor-update`,e=>this.onCursorUpdate(e)),t.on(`cursor-remove`,()=>this._updateGraphic()),t.on(`complete`,e=>this.onComplete(e)),this._coordinateFormatterLoadTask,n.on(`paste`,e=>Rt(e,this.activeTooltipInfo)),E(()=>this.cursor,e=>{t.cursor=e},be),ge(()=>{let{activeTooltipInfo:e,sketchOptions:t}=this;In(e,this._tooltipsContext),n.info=t.tooltips.effectiveEnabled?e:null}),ge(()=>{t.constraintZ=Qn(this._tooltipsContext)},se)]),this.finishToolCreation(),t.initializePointer()}destroy(){this.drawOperation=w(this.drawOperation),this.tooltip=w(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=w(this.internalGraphicsLayer),this._set(`view`,null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){let{defaultZ:e,directionOptions:t,drawOperation:n,forceUniformSize:r,geometryType:i,graphic:a,sketchOptions:o,tooltipInfos:s,view:c,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:u}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:e,directionOptions:t,drawOperation:n,forceUniformSize:r,geometryType:i,graphic:a,sketchOptions:o,tooltipInfos:s,view:c,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:u}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set(`centered`,e),this._updateGraphic()}get cursor(){return this._get(`cursor`)}set cursor(e){this._set(`cursor`,e)}set enabled(e){this.drawOperation.interactive=e,this._set(`enabled`,e)}set forceUniformSize(e){this._set(`forceUniformSize`,e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set(`graphicSymbol`,e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){let t=this.drawOperation;t&&(t.drawingMode=e),this._set(`mode`,e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){let{view:{type:e,map:t}}=this;return e===`2d`&&t&&`undoRedo`in t&&t.undoRedo instanceof I?t.undoRedo:null}set undoRedo(e){this._override(`undoRedo`,e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||Bt(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&jn(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(Y.outline),this.removeHandles(Y.regularVertices),this.removeHandles(Y.activeVertex),this.removeHandles(Y.activeEdge),this.removeHandles(ir)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;let t=new _({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange(`graphic`),this.addHandles(Se(()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)}),ir),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(this.drawOperation==null)return;let{coordinateHelper:t,view:n,visualizationCursorVertex:r,lastVertex:i,committedVertices:a,geometryIncludingUncommittedVertices:o,numCommittedVertices:s}=this.drawOperation;if(!(s>0||r!=null))return;let c=e.operationComplete?a:o,l=c.length,u=r==null?null:t.pointToArray(r),d=this._drawSpatialReference,f=n.type===`3d`&&n.viewingMode===`global`,p=new nn;p.committedVertices=a,p.cursorVertex=u;let{geometryType:m}=this;switch(m){case`point`:case`mesh`:p.full=t.arrayToPoint(c[0]);break;case`multipoint`:p.full=l>0?St(c,d):null;break;case`polyline`:case`polygon`:l>0&&(p.full=m===`polygon`?vt([c],d,f,!0):ht([c],d,f),p.cursorEdge=u!=null&&i&&!N(r,i)?ht([[u,t.pointToArray(i)]],d,f):null,p.outline=l>1?p.full:null);break;case`circle`:case`rectangle`:{if(p.committedVertices=p.cursorVertex=null,!l)break;let t=gt(n,c[0]),r=c[0],i=t.makeMapPoint(r[0]+or*n.resolution,r[1]);m===`circle`?l===1&&e.operationComplete?p.circle=yt([r,i],t,!0):l===2&&(this.forceUniformSize?p.circle=yt(c,t,this.centered):p.rectangle=xt(c,t,this.centered)):l===1&&e.operationComplete?p.rectangle=_t([r,i],t,!0):l===2&&(p.rectangle=this.forceUniformSize?_t(c,t,this.centered):bt(c,t,this.centered)),p.full=p.circle==null?p.rectangle?.geometry:p.circle.geometry,p.outline=p.full?.type===`polygon`?p.full:null;break}default:return null}return p}initializeGraphic(e){return Se()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){let e=this._getCreateOperationGeometry({operationComplete:!0});e!=null&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit(`complete`,{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit(`cursor-update`,e)}onDeactivate(){let{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return Se()}onCursorEdgeChanged(e){return Se()}onVertexAdd(e){Nn(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Mn(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit(`vertex-add`,e)}onVertexRemove(e){Nn(this._tooltipsContext),this._updateGraphic(),this.emit(`vertex-remove`,e)}onVertexUpdate(e){this._updateGraphic(),this.emit(`vertex-update`,e)}_updateGraphic(){let e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e==null?this._destroyAllVisualizations():(e.cursorEdge==null?this.removeHandles(Y.activeEdge):this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),Y.activeEdge),e.outline==null?this.removeHandles(Y.outline):this.addHandles(this.onOutlineChanged(e.outline),Y.outline),e.committedVertices==null?this.removeHandles(Y.regularVertices):this.addHandles(this.onRegularVerticesChanged(e.committedVertices),Y.regularVertices),e.cursorVertex==null?this.removeHandles(Y.activeVertex):this.addHandles(this.onActiveVertexChanged(e.cursorVertex),Y.activeVertex),e.full==null?this.removeHandles(ir):this._createOrUpdateGraphic(e.full))}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?Pn(this._tooltipsContext):null}};T([r()],J.prototype,`_coordinateFormatterLoadTask`,void 0),T([r()],J.prototype,`_createOperationGeometry`,void 0),T([r()],J.prototype,`_tooltipsContext`,null),T([r({value:!0})],J.prototype,`centered`,null),T([r()],J.prototype,`cursor`,null),T([r({nonNullable:!0})],J.prototype,`defaultZ`,void 0),T([r({constructOnly:!0})],J.prototype,`directionOptions`,void 0),T([r()],J.prototype,`drawOperation`,void 0),T([r()],J.prototype,`elevationLockOnVertexAddDisabled`,void 0),T([r({value:!0})],J.prototype,`enabled`,null),T([r({value:!0})],J.prototype,`forceUniformSize`,null),T([r({constructOnly:!0})],J.prototype,`geometryType`,void 0),T([r()],J.prototype,`graphic`,null),T([r({constructOnly:!0})],J.prototype,`graphicProperties`,void 0),T([r()],J.prototype,`graphicSymbol`,null),T([r({constructOnly:!0})],J.prototype,`hasZ`,void 0),T([r({constructOnly:!0})],J.prototype,`geometryToPlace`,void 0),T([r()],J.prototype,`mode`,null),T([r()],J.prototype,`snappingManager`,void 0),T([r()],J.prototype,`snapToScene`,void 0),T([r()],J.prototype,`tooltip`,void 0),T([r()],J.prototype,`tooltipInfos`,void 0),T([r({constructOnly:!0,type:nt})],J.prototype,`sketchOptions`,void 0),T([r()],J.prototype,`updating`,null),T([r({constructOnly:!0,nonNullable:!0})],J.prototype,`view`,void 0),T([r({constructOnly:!0})],J.prototype,`automaticAreaMeasurementUtils`,void 0),T([r({constructOnly:!0})],J.prototype,`automaticLengthMeasurementUtils`,void 0),T([r({constructOnly:!0})],J.prototype,`undoRedo`,null),T([r()],J.prototype,`activeTooltipInfo`,null),J=T([S(`esri.views.draw.DrawGraphicTool`)],J);var ir=Symbol(`create-operation-graphic`),Y={outline:Symbol(`outline-visual`),regularVertices:Symbol(`regular-vertices-visual`),activeVertex:Symbol(`active-vertex-visual`),activeEdge:Symbol(`active-edge-visual`)};function ar(e){switch(e){case`point`:case`polyline`:case`polygon`:case`multipoint`:return e;case`circle`:case`rectangle`:return`segment`;case`mesh`:return`point`}}var or=48,sr=`click`,X=class extends n{constructor(e){super(e),this.events=new oe,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};T([r()],X.prototype,`interactive`,void 0),T([r()],X.prototype,`selectable`,void 0),T([r()],X.prototype,`cursor`,void 0),T([r()],X.prototype,`grabbing`,void 0),T([r()],X.prototype,`grabbable`,void 0),T([r()],X.prototype,`consumesClicks`,void 0),T([r()],X.prototype,`grabbableForEvent`,void 0),T([r()],X.prototype,`dragging`,void 0),T([r()],X.prototype,`hovering`,void 0),T([r()],X.prototype,`selected`,void 0),X=T([S(`esri.views.draw.LegacyDrawManipulator`)],X);function cr(e,t){let n=null,r=null;return i=>{if(i.action===`cancel`)return void(r!=null&&(r.execute({action:`cancel`}),n=null,r=null));let a={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};i.action===`start`&&n==null&&(n=new wr,r=new wr,t(e,n,r,i.pointerType,a)),n?.execute(a),i.action===`end`&&n!=null&&(n=null,r=null)}}function lr(e,t){return e.events.on(`drag`,cr(e,t))}function ur(e,t){let n=[e.x,e.y,e.z??0],r=t,i=[Math.cos(r),Math.sin(r)],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(a===0)return null;i[0]/=a,i[1]/=a;let o=e=>{let t=(e.x-n[0])*i[0]+(e.y-n[1])*i[1];e.x=n[0]+t*i[0],e.y=n[1]+t*i[1]};return e=>(o(e.mapStart),o(e.mapEnd),{...e,axis:i})}function dr(e){let t=null,n=br();return r=>{if(r.action===`start`&&(t=pr(e,r.mapStart.spatialReference)),t==null)return null;let i=n(r);if(!i)return null;let{translationX:a,translationY:o,translationZ:s}=i;return t.move(a,o,s,r.action),i}}function fr(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():f(e,t)}function pr(e,t){let n=e.operations;if(!n)return null;let r=n.data.geometry,i=Yt(t);if(r.spatialReference.equals(i))return mr(e,n,()=>{});if(r.type!==`mesh`){let t=fr(r,i);if(t==null)return null;let a=r.spatialReference,o=At.fromGeometry(t,n.viewingMode);return mr(e,o,()=>{let e=o.data.geometry,t=f(e,a);n.trySetGeometry(t)})}if(Ie(r)){let t=fr(r.origin,i);if(!t)return null;let a=r.spatialReference,o=At.fromGeometry(t,n.viewingMode);return mr(e,n,()=>{let e=f(o.data.geometry,a),t=e.x-r.origin.x,i=e.y-r.origin.y,s=(e.z??0)-(r.origin.z??0);n.move(t,i,s)})}return null}function mr(e,t,n){let r=0,i=0,a=0;return{move:(o,s,c,l)=>{l===`start`&&(r=0,i=0,a=0);let u=o-r,d=s-i,f=c-a;t.move(u,d,f),r+=u,i+=d,a+=f,n(),l===`end`&&e.endInteraction?.()}}}function hr(e,t=null,n){let r=null,i=t==null||e.spatialReference?.equals(t)?e=>e:e=>e==null?e:f(e,t),a={exclude:[],...n};return t=>{if(t.action===`start`&&(r=i(e.toMap(t.screenStart,a))),r==null)return null;let n=i(e.toMap(t.screenEnd,a));return n==null?null:{...t,mapStart:r,mapEnd:n}}}function gr(e){let t=e.map(e=>dr(e)).filter(Ce),n=br();return e=>{let r=n(e);return t.forEach(t=>t(e)),r}}function _r(e){let t=e.operations?.createResetState();return e=>(t?.remove(),e)}function vr(e){let t=e.map(e=>_r(e)).filter(e=>e!=null);return e=>(t.forEach(t=>t(e)),e)}function yr(){let e=0,t=0,n=0;return r=>{r.action===`start`&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z??0);let i=r.mapEnd.x-e,a=r.mapEnd.y-t,o=(r.mapEnd.z??0)-n;return e=r.mapEnd.x,t=r.mapEnd.y,n=r.mapEnd.z,{...r,mapDeltaX:i,mapDeltaY:a,mapDeltaZ:o,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function br(){let e=0,t=0,n=0;return r=>{r.action===`start`&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z??0);let i=r.mapEnd.x-e,a=r.mapEnd.y-t,o=(r.mapEnd.z??0)-n;return{...r,translationX:i,translationY:a,translationZ:o}}}function xr(){let e=0,t=0;return n=>{n.action===`start`&&(e=n.screenStart.x,t=n.screenStart.y);let r=n.screenEnd.x-e,i=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:r,screenDeltaY:i}}}function Sr(e,t){let n=null,r=0,i=0;return a=>{if(a.action===`start`&&(n=e.toScreen?.(t),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(r=a.screenStart.x-n.x,i=a.screenStart.y-n.y))),n==null)return null;let o=ke(a.screenEnd.x-r,0,e.width),s=ke(a.screenEnd.y-i,0,e.height),c=ce(o,s);return a.screenStart=n,a.screenEnd=c,a}}var Cr=()=>{},wr=class e{constructor(){this.execute=Cr}next(t,n=new e){return t!=null&&(this.execute=e=>{let r=t(e);r!=null&&n.execute(r)}),n}};function Tr(e,t,n=[]){if(e.type===`2d`)return e=>e;let r=null;return i=>{i.action===`start`&&(r=e.toMap(i.screenStart,{exclude:n}),r!=null&&(r.z=Ve(r,e,t)));let a=e.toMap(i.screenEnd,{exclude:n});a!=null&&(a.z=Ve(a,e,t));let o=r!=null&&a!=null?{sceneStart:r,sceneEnd:a}:null;return{...i,scenePoints:o}}}function Er(e,t,n){let r=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,`scene`)??0,i=Jt(e);return i.z=r,i.hasZ=!0,i.z=Ve(i,t,n),i}function Dr(e,t){if(e.type===`2d`)return e=>e;let n=null;return r=>{r.action===`start`&&(n=Er(r.mapStart,e,t));let i=Er(r.mapEnd,e,t),a=n!=null&&i!=null?{sceneStart:n,sceneEnd:i}:null;return{...r,scenePoints:a}}}function Or({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:r,useZ:i=!0}){let o=new wr;if(t==null)return{snappingStep:[Lr,o],cancelSnapping:Lr};let s,c=null,l=null,u=null,d=()=>{c=b(c),t.doneSnapping(),l?.frameTask.remove(),l=null,s=a(s),u=null},f=kr(t,i,o),p=null,m=null,h=null;return{snappingStep:[a=>{if(!e(a))return a;let{action:o}=a;if(o===`start`){let{info:e}=a,r=Ar(t.view);if(l=jr(n,a,r),l.context.selfSnappingZ=null,!i&&e!=null){let t=Ir(n.coordinateHelper,e.handle.part);t!=null&&(l.context.selfSnappingZ={value:t,elevationInfo:n.elevationInfo??Ge})}}if(l!=null){let{context:e,originalScenePos:n,originalPos:d}=l,{mapEnd:g,mapStart:ee,scenePoints:_}=a,v=Mr(d,Pr(g,ee)),y=Pr(ee,d),te={...a,action:`update`},b=l.context,x=Nr(n,_),S=t.update({point:v,scenePoint:x,context:e});if(h=S,Fr(g,S,y,i),p=v,m=x,o!==`end`){let{frameTask:e}=l;c??=new AbortController,u=t=>{r.addPromise(de(f({frameTask:e,event:te,context:b,point:v,scenePoint:x,delta:y,getLastState:()=>({point:p,scenePoint:m,updatePoint:t.forceUpdate?null:h})},c.signal)))},u({forceUpdate:!1}),s??=E(()=>t.options.effectiveEnabled,()=>u?.({forceUpdate:!0}))}}return o===`end`&&d(),a},o],cancelSnapping:e=>(d(),e)}}function kr(e,t,n){return Te(async({frameTask:r,point:i,scenePoint:a,context:o,event:s,delta:c,getLastState:l},u)=>{let d=await r.schedule(()=>e.snap({point:i,scenePoint:a,context:o,signal:u}),u);if(d.valid){let a=await r.schedule(()=>d.apply(),u),f=l();f.point!=null&&i!==f.point&&(a=e.update({point:f.point,scenePoint:f.scenePoint,context:o})),f.updatePoint!=null&&N(a,f.updatePoint)||(Fr(s.mapEnd,a,c,t),n.execute(s))}})}function Ar(e){return e.type===`3d`?e.resourceController.scheduler.registerTask(ae.SNAPPING):re}function jr(e,t,n){return{context:new Ft({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info==null?null:t.info.handle,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin==null?t.mapStart:e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin),originalScenePos:t.scenePoints==null?null:t.scenePoints.sceneStart,frameTask:n}}function Mr(e,[t,n,r]){let i=Jt(e);return i.x+=t,i.y+=n,i.hasZ&&(i.z+=r),i}function Nr(e,t){return e==null||t==null?null:Mr(e,Pr(t.sceneEnd,t.sceneStart))}function Pr(e,t){let n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function Fr(e,t,[n,r,i],a){e.x=t.x+n,e.y=t.y+r,a&&e.hasZ&&t.hasZ&&(e.z=t.z+i)}function Ir(e,t){if(!e.hasZ())return null;let n=t.vertices,r=null;for(let t of n){let n=e.getZ(t.pos);if(r!=null&&n!=null&&Math.abs(n-r)>1e-6)return null;r??=n}return r}function Lr(e){return e}var Z=class extends n{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=Te(async(e,t,n,r)=>{let i=this._frameTask;if(i==null)return;let a=await i.schedule(()=>t.snap({...e,context:n,signal:r}),r);a.valid&&await i.schedule(()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))},r)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){let e=this.view.type===`3d`?this.view?.resourceController?.scheduler:null;this._frameTask=e==null?re:e.registerTask(ae.SNAPPING)}destroy(){this._abortController=b(this._abortController),this._frameTask=a(this._frameTask)}update(e,t,n){this._snapPoints=e;let{point:r,scenePoint:i}=e,a=t.update({point:r,scenePoint:i,context:n});return this.stagedPoint=a,a}async snap(e,t,n){let{point:r,scenePoint:i}=e;return this.stagedPoint=t.update({point:r,scenePoint:i,context:n}),this._snapPoints=e,this._abortController??=new AbortController,this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=b(this._abortController),this._snapPoints=null}};T([r({constructOnly:!0})],Z.prototype,`view`,void 0),T([r()],Z.prototype,`stagedPoint`,null),T([r()],Z.prototype,`constrainResult`,void 0),T([r()],Z.prototype,`_stagedPoint`,void 0),Z=T([S(`esri.views.interactive.snapping.SnappingOperation`)],Z);var Rr=`progress`,zr=Symbol(),Br=Symbol(),Q=class extends De{constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new qt,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Oe,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=Be(yn),this._getPolylineOrPolygonConstraint=Be(bn),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new tt,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo??(this.elevationInfo=He(!!e.hasZ))}initializePointer(){let e=this.view.inputManager?.latestPointerInfo;e!=null&&this._updatePointer(e.location,e.id,e.type)}initialize(){let{geometryType:e,view:t}=this,n=t.spatialReference,r=`viewingMode`in t.state?t.state.viewingMode:2,i=e===`segment`||e===`multipoint`?`polyline`:e;this.coordinateHelper=It(this.hasZ,this.hasM,n),this._editGeometryOperations=new At(new Ot(i,this.coordinateHelper),r),this._snappingOperation=new Z({view:t}),this.addHandles([E(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:e,constraint:t},n)=>{let{snappingOptions:r}=this;if(r&&(r.forceDisabled=t!=null&&ft(t)),n!=null&&e===n.stagedPoint&&t!==n.constraint)return this._onKeyboardBasedChange();this._processCursor(e??this._screenToMap(this._stagedScreenPoint))},{equals:(e,t)=>e.stagedPoint===t.stagedPoint&&ee(e.constraint,t.constraint)}),E(()=>this.view.viewpoint,(e,t)=>{e&&t&&ne(e,t)&&this._onKeyboardBasedChange()})]),this._activePart=new wt(n,r),this._editGeometryOperations.data.parts.push(this._activePart);let a=this.segmentLabels;a!=null&&(a.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},this.addHandles(E(()=>this.labelOptions.enabled,e=>{a.visible=e},be))),this.addHandles(this._editGeometryOperations.on([`vertex-add`,`vertex-update`,`vertex-remove`],e=>{let t=e.vertices.map(e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)})),n=t.map(e=>e.coordinates),r=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.getFirstVertex()?.pos)??null;N(r,this.firstVertex)||(this.firstVertex=r);let i=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.getLastVertex()?.pos)??null;N(i,this.lastVertex)||(this.lastVertex=i);let a=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.segments.at(-1)?.leftVertex?.pos)??null;switch(N(a,this.secondToLastVertex)||(this.secondToLastVertex=a),this._processCursor(this.cursorVertex),e.type){case`vertex-add`:this.emit(e.type,{...e,added:n,vertices:t});break;case`vertex-update`:this.emit(e.type,{...e,updated:n,vertices:t});break;case`vertex-remove`:this.emit(e.type,{...e,removed:n,vertices:t})}}));let o=this._manipulator=new X({consumesClicks:!1,grabbableForEvent:e=>this.drawingMode!==`click`||e.pointerType===`touch`&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(o),o.grabbable=e!==`point`&&e!==`multipoint`,this.addHandles([o.events.on(`immediate-click`,e=>this._onImmediateClick(e)),o.events.on(`immediate-double-click`,e=>this._onImmediateDoubleClick(e)),E(()=>this.drawingMode,()=>{this.removeHandles(zr),this.addHandles(this._createManipulatorDragPipeline(o),zr)},be),E(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:e})=>{o.cursor=e},be)]),at(this,()=>{let e=this.view.inputManager.latestPointerInfo?.type??`mouse`,t=this._getSnappingContext(e);if(this.snappingManager!=null){let e=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,t);this._updatingHandles.addPromise(de(e))}})}destroy(){w(this.segmentLabels),w(this._snappingOperation),this._editGeometryOperations=w(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){let{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){let e=this._updateAndGetEffectiveDrawSurface();return this.view.type===`3d`&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activePart.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){let{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case`point`:case`multipoint`:return this._getPointConstraint(e);case`polygon`:case`polyline`:return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set(`drawingMode`,e??`click`)}get effectiveCursor(){return this.loading?Rr:this._hideDefaultCursor?null:this.cursor||`crosshair`}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activePart.vertices.length}get snappingOptions(){return this.snappingManager==null?null:this.snappingManager.options}get cursorVertex(){return this._get(`cursorVertex`)}get visualizationCursorVertex(){return this._stagedPointerType===`mouse`?this.cursorVertex:null}get committableVertex(){let{cursorVertex:e,lastVertex:t,firstVertex:n,geometryType:r}=this;return r===`polygon`&&Ut(e,n)||Ut(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){let{committedVertices:e,committableVertex:t,coordinateHelper:n}=this,r=e.slice();return t!=null&&r.push(n.pointToArray(t)),r}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();let{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e),this._activePart)}complete(e){let t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();let{geometryType:n,numCommittedVertices:r}=this,i=n===`multipoint`&&r===0||n===`polyline`&&r<2||n===`polygon`&&r<3;n!==`segment`&&n!==`point`||this.commitStagedVertex(),this._createOperationCompleted=!i,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit(`complete`,{vertices:this.committedVertices.map((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e})),aborted:t,type:`complete`}))}onInputEvent(e){switch(e.type){case`pointer-down`:this._pointerDownStates.add(e.pointerId);break;case`pointer-up`:this._pointerDownStates.delete(e.pointerId)}switch(e.type){case`pointer-move`:return this._onPointerMove(e);case`hold`:return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){let t=s(this.cursorVertex),n=s(e),r=n&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(n)??n),i=this._snapToClosingVertex(r),a=this._applyConstraints(i);Ut(t,a)||(this._set(`cursorVertex`,a),this.segmentLabels?.set(`stagedVertex`,a==null?null:this.coordinateHelper.pointToVector(a)),a==null||this._stagedPointerType!==`mouse`?this.emit(`cursor-remove`):this.emit(`cursor-update`,{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activePart.vertices.length,coordinates:this.coordinateHelper.pointToArray(a)}],operation:`apply`,type:`vertex-update`}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!==`polygon`||this.numCommittedVertices<=2)return e;let t=this._mapToScreen(e);if(!t)return e;let n=this._activePart;return this._vertexWithinPointerDistance(n.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case`click`:return this._createManipulatorDragPipelineClick(e);case`freehand`:return this._createManipulatorDragPipelineFreehand(e);case`hybrid`:return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return lr(e,(e,t,n,r)=>{let i=r===`touch`&&this._snappingEnabled;if(this.isCompleted||!i)return;let{snappingStep:a,cancelSnapping:o}=Or({predicate:()=>i,snappingManager:this.snappingManager,snappingContext:new Ft({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next(e=>(i&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),e)).next(o),t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._processCursor(e.mapStart),(this.geometryType===`segment`||i&&!this.numCommittedVertices)&&this.commitStagedVertex()),e)).next(Tr(this.view,this.elevationInfo)).next(...a).next(e=>(i&&(this._processCursor(e.mapEnd),e.action===`end`&&this.commitStagedVertex()),e)).next(e=>(e.action===`end`&&(this._stagedPointerType!==`mouse`&&this._snappingOperation.abort(),this.geometryType!==`segment`&&this.geometryType!==`point`||this.complete()),e))})}_createManipulatorDragPipelineFreehand(e){return lr(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._snappingOperation.abort(),this.committableVertex??this._processCursor(e.mapStart),this.geometryType===`segment`&&this.commitStagedVertex()),e)).next(e=>{switch(e.action){case`start`:case`update`:this._processCursor(e.mapEnd),this.geometryType!==`polygon`&&this.geometryType!==`polyline`||this.commitStagedVertex();break;case`end`:this.complete()}return e})})}_createManipulatorDragPipelineHybrid(e){return lr(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Br),this._processCursor(e.mapStart),this.commitStagedVertex()),e)).next(e=>{switch(e.action){case`start`:case`update`:this._processCursor(e.mapEnd),this.geometryType!==`polygon`&&this.geometryType!==`polyline`||this.commitStagedVertex();break;case`end`:this._stagedPointerType!==`mouse`&&this._snappingOperation.abort(),this.removeHandles(Br),this.geometryType!==`segment`&&this.geometryType!==`point`||this.complete()}return e})})}get _drawAtFixedElevation(){let{constraintsEnabled:e,constraintZ:t,geometryType:n,numCommittedVertices:r}=this;return e?t!=null||n===`segment`&&r>0:(n===`segment`||n===`polygon`)&&r>0}_updateAndGetEffectiveDrawSurface(){let{constraintsEnabled:e,coordinateHelper:t,drawSurface:n,elevationDrawSurface:r,snapToSceneEnabled:i}=this;if(r==null)return n;if(!this.hasZ)return r.defaultZ=null,r;let a=this.elevationInfo?.mode,o=this.defaultZ,s=e||a===`absolute-height`;return i!=null&&(s=i),a===`on-the-ground`&&(s=!1),this._drawAtFixedElevation&&(o=(e?this.constraintZ:null)??t.getZ(this._activePart.vertices[0].pos),s=!1),s?n:(r.defaultZ=o,r)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode===`click`&&e.pointerType===`touch`&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType===`mouse`&&e.button===2||this._manipulator.dragging))try{let{drawingMode:t,geometryType:n}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;let r=this._screenToMap(e.screenPoint);if(r==null||r==null||t===`freehand`&&n!==`point`&&n!==`multipoint`)return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(r),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!==`mouse`&&this._processCursor(null),(t===`freehand`&&this.geometryType!==`multipoint`||n===`point`||n===`segment`&&this.numCommittedVertices===2||n===`segment`&&t===`hybrid`&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType===`point`||(this.complete(),e.stopPropagation())}_onPointerMove(e){let t=ce(e.x,e.y);this._updatePointer(t,e.pointerId,e.pointerType)&&e.stopPropagation()}_updatePointer(e,t,n){return this._stagedScreenPoint=e,this._stagedPointerType=n,this._stagedPointerId=t,this._isDragging?(this._snappingOperation.abort(),!1):(this._processCursorMovementRelativeToSurface(e,n),!0)}_onKeyboardBasedChange(){this._stagedPointerType===`mouse`&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){let n=this._snappingOperation,r=this._screenToMap(e),i=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(r==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;let a=this.snappingManager;if(a==null)return this._processCursor(r),void n.abort();let o=this._getSnappingContext(t);this._updatingHandles.addPromise(de(n.snap({point:r,scenePoint:i},a,o)))}_applyConstraints(e){let{_constraint:t,constraints:n}=this;if(!e||!n||!t)return e;let{context:r}=n,i=Cn(e,r),a=i?t.closestTo(i):void 0;if(!a)return e;let o=wn(a,e,r),s=this.view.type===`2d`||r.elevationInfo.mode!==`absolute-height`;return o!=null&&s&&this.constraintZ!=null&&this.hasZ&&(o.z=this.constraintZ),o}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action===`start`&&(e=this._screenToMap(t.screenStart)),e==null)return null;let n=this._screenToMap(t.screenEnd);return n==null?null:{...t,mapStart:e,mapEnd:n}}}_vertexWithinPointerDistance(e,t){let n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return n!=null&&Vr(n,t,25)}_getSnappingContext(e){let t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new Ft({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t==null?null:{value:t,elevationInfo:this.elevationInfo},drawConstraints:this.constraints})}};function Vr(e,t,n){let r=e.x-t.x,i=e.y-t.y;return r*r+i*i<=n}T([r()],Q.prototype,`_hideDefaultCursor`,void 0),T([r()],Q.prototype,`_stagedPointerId`,void 0),T([r()],Q.prototype,`_isDragging`,null),T([r()],Q.prototype,`_snappingOperation`,void 0),T([r()],Q.prototype,`_snappingEnabled`,null),T([r({constructOnly:!0})],Q.prototype,`graphic`,void 0),T([r()],Q.prototype,`constraintsEnabled`,void 0),T([r()],Q.prototype,`constraints`,void 0),T([r()],Q.prototype,`_constraint`,null),T([r()],Q.prototype,`constraintZ`,void 0),T([r()],Q.prototype,`defaultZ`,void 0),T([r()],Q.prototype,`isDraped`,void 0),T([r({constructOnly:!0})],Q.prototype,`automaticLengthMeasurementUtils`,void 0),T([r({value:sr})],Q.prototype,`drawingMode`,null),T([r({constructOnly:!0})],Q.prototype,`elevationDrawSurface`,void 0),T([r({constructOnly:!0})],Q.prototype,`elevationInfo`,void 0),T([r({constructOnly:!0,type:tt})],Q.prototype,`labelOptions`,void 0),T([r({constructOnly:!0})],Q.prototype,`geometryType`,void 0),T([r({constructOnly:!0})],Q.prototype,`hasM`,void 0),T([r({constructOnly:!0})],Q.prototype,`hasZ`,void 0),T([r()],Q.prototype,`cursor`,void 0),T([r()],Q.prototype,`effectiveCursor`,null),T([r()],Q.prototype,`loading`,void 0),T([r({constructOnly:!0})],Q.prototype,`manipulators`,void 0),T([r({constructOnly:!0})],Q.prototype,`drawSurface`,void 0),T([r({constructOnly:!0})],Q.prototype,`segmentLabels`,void 0),T([r({constructOnly:!0})],Q.prototype,`snappingManager`,void 0),T([r({constructOnly:!0})],Q.prototype,`snappingVisualizer`,void 0),T([r()],Q.prototype,`snapToSceneEnabled`,void 0),T([r({readOnly:!0})],Q.prototype,`cursorVertex`,null),T([r({readOnly:!0})],Q.prototype,`visualizationCursorVertex`,null),T([r()],Q.prototype,`committableVertex`,null),T([r()],Q.prototype,`firstVertex`,void 0),T([r()],Q.prototype,`lastVertex`,void 0),T([r()],Q.prototype,`secondToLastVertex`,void 0),T([r()],Q.prototype,`updating`,null),T([r({constructOnly:!0})],Q.prototype,`view`,void 0),Q=T([S(`esri.views.draw.DrawOperation`)],Q);var Hr=class{constructor(e,t,n,r=null){this._elevationInfo=e,this.defaultZ=t,this._view=n,this._excludeGraphics=r}screenToMap(e){let{defaultZ:t,_view:n}=this,r=n.sceneIntersectionHelper.intersectElevationFromScreen(ye(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return t==null&&r!=null&&(r.z=void 0),r}mapToScreen(e){let t=Re(e.x,e.y,Ke(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){let{defaultZ:t}=this;return t!=null&&e.z!==t&&((e=Jt(e)).z=t),e}},Ur=class{constructor(e,t,n=[]){this.view=e,this.elevationInfo=t,this.exclude=n}screenToMap(e){let t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return t!=null&&(t.z=Ve(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return this.elevationInfo!=null&&(t=Re(e.x,e.y,Ke(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}},Wr=class{constructor(e,t=!1,n=0){this.view=e,this.hasZ=t,this.defaultZ=n,this.mapToScreen=t=>e.toScreen(t),this.screenToMap=t?t=>{let r=e.toMap(t);return r.z=n,r}:t=>e.toMap(t)}constrainZ(e){let{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=Jt(e)).z=t),e}};(class e{screenToMap(t){let{x:n,y:r}=t;return new o({x:n,y:r,spatialReference:e.spatialReference})}mapToScreen(e){return ce(e.x,e.y)}constrainZ(e){return e}static{this.spatialReference=new p}});function Gr(e){let t=0,n=0,r=0;return e?(e.type===`cim`&&e.data.symbol&&`symbolLayers`in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map(e=>{e.type===`CIMVectorMarker`&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),e.size!=null&&e.size>r&&(r=e.size))}),t=C(t),n=C(n),r=C(r),{offsetX:t,offsetY:n,size:r}):{offsetX:t,offsetY:n,size:r}}var $=class extends n{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set(`graphic`,e),this.attachSymbolChanged()}get elevationInfo(){let{layer:e}=this.graphic,t=e&&`elevationInfo`in e?e.elevationInfo:null,n=qe(this.graphic),r=t?t.offset:0;return new Pe({mode:n,offset:r})}set focusedSymbol(e){e!==this._get(`focusedSymbol`)&&(this._set(`focusedSymbol`,e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get(`grabbing`)&&(this._set(`grabbing`,e),this._updateGraphicSymbol())}set hovering(e){e!==this._get(`hovering`)&&(this._set(`hovering`,e),this._updateGraphicSymbol())}set selected(e){e!==this._get(`selected`)&&(this._set(`selected`,e),this._updateGraphicSymbol(),this.events.emit(`select-changed`,{action:e?`select`:`deselect`}))}get _focused(){return this._get(`hovering`)||this._get(`grabbing`)}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new oe,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set(`view`,null)}intersectionDistance(e){let t=this.graphic;if(!1===t.visible)return null;let n=t.geometry;if(n==null)return null;let r=this._get(`focusedSymbol`),i=r??t.symbol;return this.view.type===`2d`?this._intersectDistance2D(this.view,e,n,i):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=E(()=>this.graphic?.symbol,e=>{e!=null&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},se)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,n,r){if((r||=d(n))==null)return null;let a=this._circleCollisionCache;if(n.type===`point`&&r.type===`cim`&&r.data.symbol?.type===`CIMPointSymbol`&&r.data.symbol.symbolLayers){let{offsetX:a,offsetY:o,size:s}=Gr(r),c=Ee(t,qr),l=s/2,u=e.toScreen(n),d=u.x+a,f=u.y+o;return i(c,[d,f])<l*l?1:null}if(n.type!==`point`||r.type!==`simple-marker`)return Xt(t,n,e)?1:null;if(a==null||!a.originalPoint.equals(n)){let t=n,i=e.spatialReference;if(Ne(t.spatialReference,i)){let e=f(t,i);a={originalPoint:t.clone(),mapPoint:e,radiusPx:C(r.size)},this._circleCollisionCache=a}}if(a!=null){let n=Ee(t,qr),o=e.toScreen?.(a.mapPoint);if(!o)return null;let s=a.radiusPx,c=o.x+C(r.xoffset),l=o.y-C(r.yoffset);return i(n,[c,l])<s*s?1:null}return null}_intersectDistance3D(e,t,n){let r=e.toMap(t,{include:[n]});return r&&Le(r,Kr,e.renderSpatialReference)?Fe(Kr,e.state.camera.eye):null}};T([r({constructOnly:!0,nonNullable:!0})],$.prototype,`graphic`,null),T([r()],$.prototype,`elevationInfo`,null),T([r({constructOnly:!0,nonNullable:!0})],$.prototype,`view`,void 0),T([r({value:null})],$.prototype,`focusedSymbol`,null),T([r({constructOnly:!0})],$.prototype,`layer`,void 0),T([r()],$.prototype,`interactive`,void 0),T([r()],$.prototype,`selectable`,void 0),T([r()],$.prototype,`grabbable`,void 0),T([r({value:!1})],$.prototype,`grabbing`,null),T([r()],$.prototype,`dragging`,void 0),T([r()],$.prototype,`hovering`,null),T([r({value:!1})],$.prototype,`selected`,null),T([r()],$.prototype,`cursor`,void 0),$=T([S(`esri.views.interactive.GraphicManipulator`)],$);var Kr=je(),qr=ye();function Jr(e,t){return Xr(e,t,!1)}function Yr(e,t){return Xr(e,t,!0)}function Xr(e,t,n){if(e instanceof Pt){if(e.operation instanceof jt)return Zr(e.operation,t,n),!0;if(e.operation instanceof Dt)return Qr(e.operation,t,n),!0;if(e.operation instanceof Nt)return $r(e.operation,t,n),!0}return!1}function Zr(e,t,n=!1){let r=n?-1:1,i=Ae(r*e.dx,r*e.dy,r*e.dz);x(t.origin,t.origin,i),Zt(t)}function Qr(e,t,n=!1){let r=n?-e.angle:e.angle;l(t.basis1,t.basis1,fe,r),l(t.basis2,t.basis2,fe,r),Zt(t)}function $r(e,t,n=!1){let r=n?1/e.factor1:e.factor1,i=n?1/e.factor2:e.factor2;g(t.basis1,t.basis1,r),g(t.basis2,t.basis2,i),m(t.origin,t.origin,e.origin,e.axis1,r),m(t.origin,t.origin,e.origin,e.axis2,i),Zt(t)}function ei(e,n,r,i,a=!1){i||=Qt();let o=c(D.get(),e[1],-e[0]),s=c(D.get(),1/0,1/0),l=c(D.get(),-1/0,-1/0),u=D.get(),d=n.allVerticesUnordered;d.forEach(({pos:n})=>{c(u,he(e,n),he(o,n)),t(s,s,u),y(l,l,u)});let f=1e-6,p=c(D.get(),l[0]-s[0]<f?r/2:0,l[1]-s[1]<f?r/2:0);_e(s,s,p),Me(l,l,p);let m=a?d.reduce((e,t)=>e+(t.pos[2]??0),0)/d.length:0;return h(i.basis1,e,(l[0]-s[0])/2),h(i.basis2,o,(l[1]-s[1])/2),v(i.origin,s[0]*e[0]+s[1]*o[0],s[0]*e[1]+s[1]*o[1],m),x(i.origin,i.origin,i.basis1),x(i.origin,i.origin,i.basis2),Zt(i),i}export{yr as C,q as E,vr as S,ar as T,dr as _,Gr as a,lr as b,Ur as c,wr as d,hr as f,Tr as g,gr as h,$ as i,Q as l,Sr as m,Yr as n,Hr as o,xr as p,Jr as r,Wr as s,ei as t,Or as u,_r as v,J as w,Dr as x,ur as y};