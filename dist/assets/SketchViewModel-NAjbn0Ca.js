const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-B1pilCWl.js","assets/index-CZ4oMP1N.js","assets/index-CDgdHpAj.css","assets/ObjectStack-CBI5g-Qc.js","assets/vectorStacks-FfDNcZoS.js","assets/quatf64-BJJPhW0N.js","assets/vec3-zq4-AU_O.js","assets/sphere-9YfqUkuX.js","assets/plane-Bg1a5O73.js","assets/ray-CWXoVP-g.js","assets/memoize-BNsZjv91.js","assets/quantity-CPor8qMe.js","assets/geodesicUtils-CbiJFASl.js","assets/projectPointToVector-HYpbaZqA.js","assets/projectVectorToVector-DX3Yd1qf.js","assets/dehydratedPoint-rdg1UAtQ.js","assets/elevationInfoUtils-9csVBlEH.js","assets/viewUtils-BwKx9qtR.js","assets/constraints-Bf0IRs4G.js","assets/LineSnappingHint-BOeMI0cS.js","assets/ParallelSnappingHint-C_mSlwpq.js","assets/LineSnappingCandidate-BsncFUer.js","assets/SnappingCandidate-B4WtOFZq.js","assets/RightAngleTriangleSnappingCandidate-CRITbc5W.js","assets/RightAngleSnappingHint-BXbBqf-p.js","assets/viewUtils-D9SUkhqu.js","assets/snappingUtils-Od8uWW_a.js","assets/angularMeasurementUtils-DzYsrBw4.js","assets/GridSnappingEngine-BfAz1O9G.js","assets/gridUtils-CbplE56Q.js","assets/IntersectionSnappingCandidate-b5Urq9uN.js","assets/IntersectionSnappingHint-CdcMZxUs.js","assets/FeatureSnappingEngine-CcS139gf.js","assets/mapCollectionUtils-_kTr84uj.js","assets/floorFilterUtils-TMZ7AjwL.js","assets/DrapedEdgeSnappingCandidate-BWx5lQgf.js","assets/EdgeSnappingCandidate-BfgKjc_Z.js","assets/layerViewUtils-RSw-QNoB.js","assets/geometryEngine-CazvDkG4.js","assets/_commonjsHelpers-BCEO1LKV.js","assets/geometryEngineBase-BrM_fHSa.js","assets/editingTools-BmjIjJ1L.js","assets/editPlaneUtils-BV-yWTYi.js","assets/boundedPlane-C8nQBQLB.js","assets/lineSegment-BJ2rgalW.js","assets/ReactiveSet-Jf4MiUGe.js","assets/createUtils-BdtfcpTy.js","assets/distanceOperator-CYf0gmY_.js","assets/Distance2DCalculator-CXhBP-8I-CqzpU8vR.js","assets/SpatialReference-HLIf1Z5k.js","assets/Envelope2D-Cwxt0azx.js","assets/Point2D-7VmvyXN4.js","assets/OperatorDefinitions-CscAnk1m.js","assets/SimpleGeometryCursor-5wFw2ZZo.js","assets/Transformation2D-CPSmiNnd.js","assets/apiConverter-BH2GqpH4.js","assets/jsonConverter-CbeIyOFG.js","assets/OptimizedGeometry-hOUTi-cB.js","assets/memoryEstimations-DQOvnrRz.js","assets/simplifyOperator-CdQI_hSF.js","assets/operatorSimplify-CKtdefMF.js","assets/quat-BszBv_-H.js","assets/rotate-CRgbbiZK.js","assets/quantityFormatUtils-DJ98D30D.js","assets/unitFormatUtils-3ZxnJ6-6.js","assets/MeshTransform-mXzx59gA.js","assets/axisAngleDegrees-B_kvpSNV.js","assets/meshVertexSpaceUtils-CsTvVRUI.js","assets/MeshLocalVertexSpace-OEvelzSD.js","assets/getDefaultUnitForView-BwZf47ZU.js","assets/GraphicsLayer-Bx8Nz7ax.js","assets/dehydratedFeatureComparison-Uk3aLNrk.js","assets/hydratedFeatures-B670wkRA.js","assets/drapedUtils-BIPbWxSw.js","assets/SnappingContext-BtkpPzK4.js","assets/curveOperationUtils-Be_6553J.js","assets/PointSnappingHint-DvioR9Jz.js","assets/euclideanLengthMeasurementUtils-C9WB-wbk.js","assets/spatialReferenceEllipsoidUtils-B0E4spY0.js","assets/SketchOptions-Dp8M5XoK.js","assets/colorUtils-DJOs5VE1.js","assets/cimSymbolUtils-Q6FkyqJB.js","assets/SnappingVisualizer2D-CvimaA4v.js","assets/drawUtils-JVK9yFCX.js","assets/hitTestSelectUtils-DQf3EOGe.js","assets/editingTools-Biga_mU-.js","assets/ColorMaterial.glsl-Cdxxi9i2.js","assets/Transform.glsl-LjRXb9GP.js","assets/Float2BindUniform-C046qJa3.js","assets/Uniform-D2x0fAcR.js","assets/FloatBindUniform-DmTbQwNg.js","assets/glsl-CQsgM67j.js","assets/NoParameters-D8vOu4I5.js","assets/Slice.glsl-B4UNza77.js","assets/Float3DrawUniform-CdNiRdHS.js","assets/VisualVariables.glsl-DPoFF9eG.js","assets/FloatsPassUniform-yzynPlDB.js","assets/AlphaCutoff-BxDXdpVQ.js","assets/HighlightReadBitmap.glsl-cy3SD0WQ.js","assets/Texture2DBindUniform-DU-6Ejb6.js","assets/Float3PassUniform-tY0I44AO.js","assets/Float4PassUniform-BlgtXzb0.js","assets/ObjectAndLayerIdColor.glsl-xqs4IH1X.js","assets/VertexColor.glsl-DVDp3fwI.js","assets/TerrainDepthTest.glsl-DLAwRTt4.js","assets/ReadDepth.glsl-CSPikWKN.js","assets/View.glsl-DCHnRtrH.js","assets/Float3BindUniform-CTBiVhme.js","assets/Matrix4BindUniform-DS27O9oA.js","assets/OutputColorHighlightOLID.glsl-BZElqToO.js","assets/Emissions.glsl-D75sJPX5.js","assets/FloatPassUniform-DkGcNskm.js","assets/Texture2DDrawUniform-_ATT3Du-.js","assets/Texture2DPassUniform-DbQ0ICoe.js","assets/ShaderBuilder-D3cV1oap.js","assets/Compositing.glsl-Boy8xCvS.js","assets/ScreenSpacePass.glsl-DOjTinpP.js","assets/HUDMaterial.glsl-BqTlEc9K.js","assets/HUDVisibility.glsl-e56UpBL8.js","assets/VerticalOffset.glsl-CD0ss13J.js","assets/ScreenSizePerspective.glsl-D8mo4yes.js","assets/BooleanBindUniform-_2Zs0Oiv.js","assets/Float4BindUniform-DsRDgU9t.js","assets/Float2PassUniform-DUjW63UW.js","assets/HighlightApply.glsl-CvivNaSD.js","assets/HighlightDownsample.glsl-C4UAj6v_.js","assets/HighlightCellGridScreenSpacePass.glsl-SS-SFvgQ.js","assets/IntegerPassUniform-Bc4jwiiu.js","assets/Float2DrawUniform-aR5RLpeA.js","assets/HighlightBlur.glsl-BeYrwKnv.js","assets/HighlightToSingle.glsl-Bf1qRLQ8.js","assets/ImageMaterial.glsl-CIRY8bNI.js","assets/LaserlinePath.glsl-Dc63A4oD.js","assets/Laserline.glsl-Cz-61y4R.js","assets/CameraSpace.glsl-6Z1q9G0l.js","assets/Matrix4PassUniform-JGr7b2hu.js","assets/Laserlines.glsl-CX-LV_0M.js","assets/OverlayCompositing.glsl-BzV-Npum.js","assets/RibbonLine.glsl-Cen5G4Qg.js","assets/MarkerSizing.glsl-6EXRj3G4.js","assets/PiUtils.glsl-BTnoJadg.js","assets/ShadedColorMaterial.glsl-DkAR_1GP.js","assets/SlicePlaneMaterial.glsl-CG4pdlh3.js","assets/TextureOnly.glsl-9MXRi8S3.js","assets/SceneLighting-DFVSfk4c.js","assets/frustum-Dz51AK3u.js","assets/orientedBoundingBox-CzNbshh-.js","assets/computeTranslationToOriginAndRotation-Cm78hfIp.js","assets/HUDIntersectorResult-CPKd33dL.js","assets/VertexAttributeLocations-CfzeuYMz.js","assets/VertexElementDescriptor-ju-1bdWe.js","assets/renderState-Be6uDhGv.js","assets/earcut-BF1-mB58.js","assets/NestedMap-D5qGZL0n.js","assets/vec3f32-B2H3-fiA.js","assets/RenderCoordsHelper-CTjMliQt.js","assets/graphicUtils-BW24Jhcf.js","assets/FloatArray-DqATud34.js","assets/BufferView-D7rgY_ku.js","assets/Util-BF0TzZHY.js","assets/types-D4cna6kF.js","assets/Indices-BME9aaDP.js","assets/DefaultBufferWriter-BXwy9hB-.js","assets/triangle-_uWz9WdI.js","assets/MaterialUtil-QJlc_rwl.js","assets/SegmentLabels-Cxtef3rz.js","assets/deduplicate-DAw_n_cX.js","assets/triangulationUtils-BlqOiLV7.js","assets/videoUtils-Cwi_sthm.js","assets/ManagedTexture-MMKE_FPf.js","assets/image-D9NkN0IP.js","assets/utils-Cuuurg5i.js","assets/DefaultLayouts-tuXT9snh.js","assets/weather--8ZTL_jU.js","assets/ElevationContext-CNTqCoLi.js","assets/Octree-XJBZsigF.js","assets/TextureBackedBufferLayout-CRYrdH8z.js","assets/BufferObject-q8zuTMny.js","assets/VertexArrayObject-DEfjd5y-.js","assets/VertexBuffer-xVpphTb4.js","assets/isSupportedObject-Ccal0viz.js","assets/SelectedVertexTooltipInfo-DiXgQg-u.js","assets/sdfPrimitives-BLSDVil_.js","assets/ExtentScaleTooltipInfo-B7AM6BOO.js","assets/TranslateTooltipInfo-DM5mdylE.js","assets/GraphicsLayerView3D-DcDUhmwm.js","assets/DefaultMaterial.glsl-B_7BDQY3.js","assets/ReadShadowMap.glsl-Dwb5mPt6.js","assets/MixExternalColor.glsl-G62irSUg.js","assets/SnowCover.glsl-C9VUzrAA.js","assets/SSAO.glsl-CieOBHuS.js","assets/SSAOBlur.glsl-DEwR3tk9.js","assets/Normals.glsl-C_GiWNRp.js","assets/LineCallout.glsl-BJ8mHe9M.js","assets/RealisticTree.glsl-C3WDO8M8.js","assets/PooledRBush-kIuSXR8J.js","assets/quantizationUtils-CGy9nkLl.js","assets/OptimizedFeatureSet-CTIqq8fn.js","assets/optimizedFeatureQueryEngineAdapter-DdSTa-WE.js","assets/dehydratedFeatures-8DNmK2px.js","assets/featureConversionUtils-_DSSMFQ2.js","assets/pointUtils-Dz4Bisuv.js","assets/primitiveObjectSymbolUtils-frpHRDK8.js","assets/Intersector-CuU_DZjQ.js","assets/symbolColorUtils-aHvrhrl1.js","assets/DefaultMaterial-BF2zOTJE.js","assets/LayerView-2jeNRFkG.js","assets/popupUtils-Bb88Y0DD.js","assets/highlightOptionsUtils-C8mtOR7S.js","assets/GraphicMover-cbOIw3pX.js","assets/GraphicMover-hSwpU3iR.js","assets/layerUtils-VowzydxH.js","assets/Box-BJMxLmGq.js","assets/settings-BhdpCzpE.js","assets/Reshape-BzfolmAL.js","assets/devEnvironmentUtils-Dd-UzSlS.js","assets/symbolUtils-B6-qgP3q.js","assets/webStyleSymbolUtils-CccoPLb0.js"])))=>i.map(i=>d[i]);
import{$E as e,$_ as t,$w as n,Ag as r,Al as i,BS as a,BT as o,DT as s,Dd as c,Dg as l,Ed as u,Fg as d,Gh as f,Gv as p,JE as m,Kw as h,Md as g,OT as _,Od as ee,Og as v,Ol as te,Ov as ne,Q_ as re,Qu as y,Tl as ie,Wx as ae,XT as oe,Xu as se,YT as b,Yd as ce,Z_ as le,_S as ue,_w as de,c_ as x,dg as fe,eT as pe,fT as me,gD as S,iv as C,jd as he,nv as w,pg as ge,qu as _e,rS as ve,rT as ye,rv as T,sv as be,tT as xe,tv as Se,uE as Ce,vT as E,vy as we,wd as D,wg as Te,yh as Ee}from"./index-CZ4oMP1N.js";import{i as De,r as Oe}from"./geodeticAreaOperator-CbAaN6Nl.js";import{i as ke,r as Ae}from"./geodeticLengthOperator-CWQiiddx.js";import{t as je}from"./earcut-BF1-mB58.js";import{b as Me,p as Ne,v as Pe,x as Fe}from"./plane-Bg1a5O73.js";import{t as Ie}from"./projectVectorToVector-DX3Yd1qf.js";import{m as Le}from"./elevationInfoUtils-9csVBlEH.js";import{t as Re}from"./GraphicsLayer-Bx8Nz7ax.js";import{n as O,s as k}from"./quantity-CPor8qMe.js";import{a as ze,n as Be,o as Ve,r as He}from"./geodesicUtils-CbiJFASl.js";import{t as Ue}from"./isSupportedObject-Ccal0viz.js";import{r as We}from"./layerUtils-VowzydxH.js";import{i as Ge,n as Ke,r as qe,t as Je}from"./SketchOptions-Dp8M5XoK.js";import{f as Ye,g as Xe,p as A}from"./LineSnappingHint-BOeMI0cS.js";import{n as j}from"./ParallelSnappingHint-C_mSlwpq.js";import{l as Ze,r as Qe,s as $e}from"./snappingUtils-Od8uWW_a.js";import{t as et}from"./EdgeSnappingCandidate-BfgKjc_Z.js";import{t as tt}from"./DrapedEdgeSnappingCandidate-BWx5lQgf.js";import{t as M}from"./IntersectionSnappingCandidate-b5Urq9uN.js";import{t as nt}from"./LineSnappingCandidate-BsncFUer.js";import{n as rt,t as it}from"./RightAngleTriangleSnappingCandidate-CRITbc5W.js";import{n as at,t as ot}from"./viewUtils-D9SUkhqu.js";import{a as st,c as ct,i as lt,n as ut,u as dt}from"./euclideanLengthMeasurementUtils-C9WB-wbk.js";import{n as ft}from"./triangle-_uWz9WdI.js";import{t as pt}from"./hitTestSelectUtils-DQf3EOGe.js";function mt(e){switch(e){case 0:break;case 1:return`not owned by a graphics layer`;case 2:return`no geometry`;case 3:return`the geometry type is not supported`;case 4:return`the symbol type is not supported`}return``}function ht(e){return gt(e).result}function gt(e){if(e.graphic&&e.graphic.layer?.type!==`graphics`)return{result:1};if(!e.operations)return{result:2};let t=e.operations.data.type,n=e.operations.data.geometry;return t===`point`||t===`mesh`||t===`polyline`||t===`polygon`?{result:0,geometry:n}:{result:3}}function _t(e){if(e.layer?.type!==`graphics`)return 1;if(e.geometry==null)return 2;switch(e.geometry.type){case`point`:break;case`polygon`:case`polyline`:case`multipoint`:case`extent`:case`mesh`:return 0;default:return 3}let t=e.symbol!=null&&e.symbol.type===`point-3d`&&e.symbol.symbolLayers;return t&&t.some(e=>e.type===`object`)?0:4}var N=class extends de{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new C}};S([s({constructOnly:!0})],N.prototype,`layer`,void 0),S([s()],N.prototype,`enabled`,void 0),S([s()],N.prototype,`updating`,void 0),S([s()],N.prototype,`availability`,void 0),S([s()],N.prototype,`sublayerSources`,void 0),N=S([_(`esri.views.interactive.snapping.FeatureSnappingLayerSource`)],N);var P=class extends de{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new C,this.distance=j.distance,this.touchSensitivityMultiplier=j.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){let t=this.featureSources;t.some(vt)&&Ce.getLogger(this).warnOnce(`Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.`);let n=t.filter(bt),r=this._get(`_effectiveFeatureSources`)?.filter(vt)??new C;for(let e of n){let t=r.find(t=>t.layer===e.layer.parent);if(t)t.sublayerSources.includes(e)||t.sublayerSources.add(e);else if(e.layer.parent){let t=new N({layer:e.layer.parent});t.sublayerSources.add(e),r.add(t)}}for(let e of r){let t=e.sublayerSources.filter(e=>!n.includes(e));e.sublayerSources.removeMany(t)}r.removeMany(r.filter(e=>e.sublayerSources.length===0));let i=t.filter(yt),a=this._get(`_effectiveFeatureSources`)??new C,{added:o,removed:s}=e(a.toArray(),[...i,...r]);return a.removeMany(s),a.addMany(o),a}};function vt(e){return e.layer.type===`subtype-group`}function yt(e){return e.layer.type!==`subtype-group`}function bt(e){return e.layer.type===`subtype-sublayer`}S([s()],P.prototype,`enabled`,void 0),S([s()],P.prototype,`enabledToggled`,void 0),S([s()],P.prototype,`forceDisabled`,void 0),S([s()],P.prototype,`selfEnabled`,void 0),S([s()],P.prototype,`featureEnabled`,void 0),S([s()],P.prototype,`gridEnabled`,void 0),S([s()],P.prototype,`attributeRulesEnabled`,void 0),S([s({type:C.ofType(N)})],P.prototype,`featureSources`,void 0),S([s()],P.prototype,`distance`,void 0),S([s()],P.prototype,`touchSensitivityMultiplier`,void 0),S([s({readOnly:!0})],P.prototype,`effectiveEnabled`,null),S([s({readOnly:!0})],P.prototype,`effectiveGridEnabled`,null),S([s({readOnly:!0})],P.prototype,`effectiveSelfEnabled`,null),S([s({readOnly:!0})],P.prototype,`effectiveFeatureEnabled`,null),S([s({readOnly:!0})],P.prototype,`_effectiveFeatureSources`,null),P=S([_(`esri.views.interactive.snapping.SnappingOptions`)],P);function xt(e){let{spatialReference:t}=e,n=we(e);return dt(t,n?kt:Ot,kt,e)}function St(e,t){if(!ue(e.spatialReference,t.spatialReference))return null;let{spatialReference:n}=e;return F[0]=e.x,F[1]=e.y,F[2]=e.hasZ?e.z:0,I[0]=t.x,I[1]=t.y,I[2]=t.hasZ?t.z:0,Ct(F,I,n)}function Ct(e,t,n){return dt(n,Et,Dt,e,t,n)}var wt={geodesicLength:xt,geodesicDistanceBetweenPoints:St,geodesicDistance:Ct};async function Tt(){return await ke(),wt}function Et(e,t,n){return O(ze(jt,e,t,n).distance,`meters`)}function Dt(e,t,n){return O(Ae(At(e,t,n),{unit:`meters`}),`meters`)}function Ot(e){return O(Ve([e],`meters`)[0],`meters`)}function kt(e){return O(Ae(e,{unit:`meters`}),`meters`)}function At(e,t,n){return new ne({spatialReference:n,paths:[[[...e],[...t]]]})}var jt=new He,F=x(),I=x(),L=class extends be{constructor(e){super(e),this.options=new P,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([w(()=>{let{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:r,effectiveGridEnabled:i}=this.options;return{selfEnabled:n,featureEnabled:r,gridEnabled:this.view.type===`2d`&&i,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit(`changed`)),this._loadTask?.abort(),this._loadTask=fe(n=>this._updateEngines(e,t,n))},T),w(()=>this.options,e=>{for(let t of this._engines)t.options=e},le)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();let r=this._engineCache,i=await Promise.allSettled([e.featureEnabled&&!r.has(`feature`)?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!r.has(`self`)?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!r.has(`grid`)?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(let e of i)e.status===`fulfilled`&&e.value?.engine.destroy();else{for(let e of i)e.status===`fulfilled`&&e.value&&r.set(e.value.type,e.value.engine);this._engines=Array.from(r.values())}}async _createSelfSnappingEngine(e){let[{SelfSnappingEngine:t},n]=await Promise.all([a(()=>import(`./SelfSnappingEngine-B1pilCWl.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])),Tt()]);return pe(e),{type:`self`,engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:n})}}async _createGridSnappingEngine(e){let{view:t}=this;if(t.type!==`2d`)return;let{GridSnappingEngine:n}=await a(async()=>{let{GridSnappingEngine:e}=await import(`./GridSnappingEngine-BfAz1O9G.js`);return{GridSnappingEngine:e}},__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,12,15,16,29,18,19,30,22,31,21,26]));return pe(e),{type:`grid`,engine:new n({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){let{FeatureSnappingEngine:t}=await a(async()=>{let{FeatureSnappingEngine:e}=await import(`./FeatureSnappingEngine-CcS139gf.js`);return{FeatureSnappingEngine:e}},__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,33,10,12,15,34,16,17,18,19,35,36,22,25,24,26,37]));pe(e);let{view:n,options:r}=this,{spatialReference:i}=n;return{type:`feature`,engine:new t({view:n,options:r,spatialReference:i})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){let{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return Lt(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){let{point:t,context:n}=e;this._removeVisualization();let r=this._currentMainCandidate;if(r==null)return t;let i=this._selectUpdateInput(e);if(i==null)return t;let{spatialReference:a}=n,o=d(i,a);if(o==null)return t;let{view:s}=this,{elevationInfo:c,visualizer:l}=n,u=[],f=A(o,s,c),p=r.constraint.closestTo(f);if(!this._arePointsWithinScreenThreshold(f,p,n)||!Pt(r,n.drawConstraints))return this._resetSnappingState(),t;r.targetPoint=Xe(p),u.push(...r.hints);for(let e of this._currentOtherActiveCandidates)Pt(e,n.drawConstraints)&&(e.targetPoint=Xe(p),u.push(...e.hints));return l!=null&&this.addHandles(l.draw(u,{spatialReference:a,elevationInfo:Rt(n),view:s,selfSnappingZ:n.selfSnappingZ}),Mt),Ye(p,s,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(Mt)}async _snapSinglePoint({point:e,context:t,signal:n}){let{view:r}=this,{elevationInfo:i}=t,a=A(e,r,i),o=await this._fetchCandidates(a,3,t,n);return this._createSnapResult(a,0,o,r,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:i}){let{view:a}=this,{coordinateHelper:o,elevationInfo:s,spatialReference:c}=n;await r(t.spatialReference,c);let l=d(t,c),u=A(l,a,s),f=await this._fetchCandidates(u,1,n,i);if(f.length>0){let e=await this._fetchCandidates(u,2,n,i);return this._createSnapResult(u,1,[...f,...e],a,l,n,i)}let p=A(e,a,s),m=await this._fetchCandidates(p,2,n,i);return this._createSnapResult(p,0,m,a,{z:o.hasZ()&&e.hasZ?e.z??0:void 0,m:o.hasM()&&e.hasM?e.m??0:void 0},n,i)}async _fetchCandidates(e,t,n,r){return(await Promise.all(this._engines.map(i=>i.fetchCandidates(e,t,n,r)))).flat()}_createSnapResult(e,t,n,r,i,a,o){return{get valid(){return!h(o)},apply:()=>{let{spatialReference:o}=a,{snappedPoint:s,hints:c}=this._processCandidates(e,t,n,a);return this._removeVisualization(),a.visualizer!=null&&this.addHandles(a.visualizer.draw(c,{spatialReference:o,elevationInfo:Le,view:r,selfSnappingZ:a.selfSnappingZ}),Mt),Ye(s,r,i,a)}}}_processCandidates(e,t,n,r){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Ze(e,n);let i=this._currentMainCandidate;if(i!=null){let a=Ft(i,n);if(a>=0){if(!(n[a]instanceof M))return this._intersectWithOtherCandidates(a,n,e,t,r);if(this._arePointsWithinScreenThreshold(e,i.targetPoint,r))return this._updateSnappingCandidate(i,t,n,r)}}return this._intersectWithOtherCandidates(0,n,e,t,r)}_intersectWithOtherCandidates(e,t,n,r,i){let{coordinateHelper:a}=i,o=t[e],s=[];for(let r=0;r<t.length;++r){if(r===e)continue;let i=t[r],c=o.constraint.intersect(i.constraint);if(c)for(let e of c.closestPoints(o.targetPoint))s.push([new M(Xe(e),o,i,i.isDraped),this._squaredScreenDistance(n,e,a)])}return s.length>0&&(s.sort((e,t)=>e[1]-t[1]),s[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(s[0][0],r,t,i):Pt(o,i.drawConstraints)?this._updateSnappingCandidate(o,r,t,i):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;let i=this._currentMainCandidate.targetPoint,a=[];a.push(...e.hints);for(let t of n){if(e instanceof M){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;let n=t.constraint.closestTo(i);this._squaredScreenDistance(n,i,r.coordinateHelper)<Nt()&&(t.targetPoint=i,this._currentOtherActiveCandidates.push(t),a.push(...t.hints))}return{snappedPoint:i,hints:a}}_squaredPointProximityThreshold(e){return e===`touch`?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return Qe(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return ot(e,t.spatialReference,Le,this.view)}get test(){}};S([s({constructOnly:!0})],L.prototype,`view`,void 0),S([s()],L.prototype,`options`,void 0),S([s({readOnly:!0})],L.prototype,`updating`,null),S([s()],L.prototype,`_loadTask`,void 0),S([s()],L.prototype,`_engines`,void 0),S([s()],L.prototype,`_squaredMouseProximityThreshold`,null),S([s()],L.prototype,`_squaredTouchProximityThreshold`,null),L=S([_(`esri.views.interactive.snapping.SnappingManager`)],L);var Mt=`visualization-handle`;function Nt(){return j.satisfiesConstraintScreenThreshold*j.satisfiesConstraintScreenThreshold}function Pt(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof tt||e instanceof et||e instanceof nt||e instanceof rt||e instanceof it)&&(!(e instanceof at)||t.direction==null&&e.selfSnappingType===1)}function Ft(e,t){return e instanceof M?It(t,e.first)>=0&&It(t,e.second)>=0?0:-1:It(t,e)}function It(e,t){let n=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){n=r;break}return n}function Lt(e){return e.scenePoint!=null}function Rt({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Le:t}function zt(e,t=R()){return Vt(e,t)}function Bt(e,t=R()){return Vt(e,t,!1)}function Vt(e,t,n=e.hasZ){let r=ct(e.spatialReference),a=ae(r);if(a==null)return null;let o=(e,t)=>!(t.length<2)&&(te(e,t[0],t[1],n&&t[2]||0),!0),s=0;for(let n of e.rings){let a=n.length;if(a<3)continue;let{positionsWorldCoords:c}=t;for(;c.length<a;)c.push(x());let l=Ht,u=te(Ut,0,0,0),d=1/a;for(let t=0;t<a;t++){if(!o(l,n[t])||!Ie(l,e.spatialReference,c[t],r))return null;i(u,u,c[t],d)}let f=Fe(c[0],c[1],u,Pe());if(ie(Me(f))===0)continue;for(let e=0;e<a;e++)Ne(f,u,c[e],c[e]);let p=Wt(c);for(let e=0;e<p.length;e+=3)s+=ft(c[p[e]],c[p[e+1]],c[p[e+2]])}return k(s,a)}var Ht=x(),Ut=x();function R(){return{positionsWorldCoords:[]}}function Wt(e){return je(Gt(e),[],2)}function Gt(e){let t=new Float64Array(2*e.length);for(let n=0;n<e.length;++n){let r=e[n],i=2*n;t[i]=r[0],t[i+1]=r[1]}return t}var Kt=e=>({geodesicArea(t){let{spatialReference:n}=t,r=we(t);return dt(n,r?Xt:Jt,r?Xt:t=>Yt(e,t),t)}});async function qt(){let e=await a(()=>import(`./geometryEngine-CazvDkG4.js`),__vite__mapDeps([38,1,2,39,40]));return await De(),Kt(e)}function Jt(e){return k(Math.abs(Be([e],`square-meters`)[0]),`square-meters`)}function Yt(e,t){try{return k(Math.abs(e.geodesicArea(t,`square-meters`)),`square-meters`)}catch{return null}}function Xt(e){return k(Oe(e,{unit:`square-meters`,curveType:`geodesic`}),`square-meters`)}var Zt=e=>({autoAreaByElevationMode(t,n,r=R()){return n===`on-the-ground`?e.geodesicArea(t)??Bt(t,r):zt(t,r)},autoArea2D(e,t=R()){return this.autoAreaByElevationMode(e,`on-the-ground`,t)}}),Qt=null;async function z(){return Qt||=Zt(await qt()),Qt}function $t(e){return{autoLength2D:t=>e.geodesicLength(t)??ut(t),autoDistanceBetweenPoints2D:(t,n)=>e.geodesicDistanceBetweenPoints(t,n)??st(t,n),autoDistance2D:(t,n,r)=>(V[0]=t[0],V[1]=t[1],V[2]=t.length===3?t[2]:0,H[0]=n[0],H[1]=n[1],H[2]=n.length===3?n[2]:0,e.geodesicDistance(V,H,r)??lt(V,H,r))}}async function B(){return $t(await Tt())}var V=x(),H=x(),en=class{constructor(e){this.layer=e}get elevationInfo(){return this.layer.elevationInfo}add(e){this.layer.add(e)}addMany(e){this.layer.addMany(e)}onGraphicsChange(e){let{layer:t}=this;return re(()=>t.graphics,`change`,t=>e(t))}has(e){return e.layer===this.layer}remove(e){this.layer.remove(e)}removeMany(e){this.layer.removeMany(e)}removeAll(){this.layer.removeAll()}};S([s()],en.prototype,`elevationInfo`,null);var tn=class{constructor(e){this.layer=e}get elevationInfo(){}add(e,t){(this._getSublayerForCreateTool(t)??this._getSublayerForGraphic(e))?.add(e)}addMany(e,t){if(t){let n=this._getSublayerForCreateTool(t);if(n)return void n.addMany(e)}e.forEach(e=>this._getSublayerForGraphic(e)?.add(e))}onGraphicsChange(e){let{layer:t}=this;if(t.sublayers?.length)return oe(t.sublayers?.toArray().map(t=>re(()=>t.graphics,`change`,t=>e(t))))}has(e){let{layer:t}=this;return e.layer===t||e.sourceLayer===t||!!t.sublayers?.some(t=>e.layer===t||e.sourceLayer===t)}remove(e){this._getSublayerForGraphic(e)?.remove(e)}removeMany(e){e.forEach(e=>this._getSublayerForGraphic(e)?.remove(e))}removeAll(){this.layer.sublayers?.forEach(e=>e.removeAll())}_getSublayerForCreateTool(e){let{layer:t}=this;switch(e){case`point`:return t.pointLayer;case`polyline`:return t.polylineLayer;case`polygon`:return t.polygonLayer;case`multipoint`:return t.multipointLayer;case`text`:return t.textLayer}}_getSublayerForGraphic(e){let{layer:t}=this;if(e?.geometry)switch(e.geometry.type){case`point`:return e.symbol?.type===`text`?t.textLayer:t.pointLayer;case`polyline`:return t.polylineLayer;case`polygon`:return t.polygonLayer;case`multipoint`:return t.multipointLayer}}};S([s()],tn.prototype,`elevationInfo`,null);var U=class extends be{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){let{activeComponent:e}=this;if(!e)return null;switch(e.type){case`graphic-mover`:case`move-3d`:return`move`;case`box`:case`transform-3d`:return`transform`;case`reshape`:case`reshape-3d`:return`reshape`;case`draw-2d`:return e.graphicSymbol?.type===`text`?`text`:e.geometryType;case`draw-3d`:return e.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit(`complete`)}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){let e=this.activeComponent;e&&(e.type!==`box`&&e.type!==`reshape`&&e.type!==`graphic-mover`||e.refresh())}set undo(e){this._set(`undo`,()=>{this.canUndo()&&e()})}set redo(e){this._set(`redo`,()=>{this.canRedo()&&e()})}};S([s()],U.prototype,`activeComponent`,void 0),S([s()],U.prototype,`cancelled`,void 0),S([s()],U.prototype,`history`,void 0),S([s()],U.prototype,`tool`,null),S([s()],U.prototype,`type`,void 0),S([s()],U.prototype,`canUndo`,null),S([s()],U.prototype,`canRedo`,null),S([s()],U.prototype,`onEnd`,void 0),S([s()],U.prototype,`undo`,null),S([s()],U.prototype,`redo`,null),S([s()],U.prototype,`toggleTool`,void 0),S([s()],U.prototype,`addToSelection`,void 0),S([s()],U.prototype,`removeFromSelection`,void 0),U=S([_(`esri.widgets.Sketch.support.OperationHandle`)],U);var W=class extends U{};S([s()],W.prototype,`activeComponent`,void 0),W=S([_(`esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle`)],W);var G=class extends U{};S([s()],G.prototype,`activeComponent`,void 0),G=S([_(`esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle`)],G);function nn(e,t){return t===`freehandPolygon`||t===`freehandPolyline`?`freehand`:e??(t===`rectangle`||t===`circle`?`hybrid`:`click`)}function rn(e){switch(e){case`freehandPolygon`:return`polygon`;case`freehandPolyline`:return`polyline`;case`text`:return`point`;default:return e}}function an(e){if(e.length>1)return!1;let t=e.at(0)?.geometry;return t?.type===`point`||t?.type===`multipoint`&&t.points.length<2}var on={defaultZ:0},K={reshapeOptions:{edgeOperation:`split`,shapeOperation:`move`,vertexOperation:`move`,enableCreateCurveFromStraightEdge:!0},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:_e},tool:`transform`},q=Symbol(),sn=Symbol(),J=class extends be{constructor(e){super(e),this._defaultSnappingManager=null,this._internalGraphicsLayer=new Re({listMode:`hide`,internal:!0,title:`SVM Internal`}),this._operationHandle=null,this._updatingHandles=new ge,this._viewHandlesKey=`viewHandles`,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new c({style:`circle`,size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new ee({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new he({color:[130,130,130,1],width:2}),this.meshSymbol=new g({symbolLayers:new C([new ce])}),this.updateGraphics=new C,this.updateOnGraphicClick=!0,this.creationMode=`single`,this.vertexSymbol=new c({style:`circle`,size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Je,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{let{_layerAdapter:e}=this;if(this.removeHandles(sn),!e)return;let t=[e.onGraphicsChange(e=>this._onLayerGraphicsChangeCallback(e)),w(()=>e.elevationInfo,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer&&(this._internalGraphicsLayer.elevationInfo=e))},T)].filter(m);this.addHandles(t,sn)},this._originalPopupEnabled=null,this.defaultCreateOptions=on,this.defaultUpdateOptions=K,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new P,this.textSymbol=new u({text:`text`})}initialize(){this.addHandles([re(()=>this.view?.map?.layers,`change`,e=>{this.layer&&e.removed.includes(this.layer)&&this.cancel()}),w(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),T),w(()=>this.view,e=>{this._defaultSnappingManager=E(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new L({view:e,options:this.snappingOptions})),e.type===`2d`?a(()=>import(`./editingTools-BmjIjJ1L.js`),__vite__mapDeps([41,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,12,62,63,64,65,66,67,68,69,27,14,13,15,70,71,72,73,16,74,75,19,20,31,76,24,77,78,79,18,7,6,26,80,81,82,83,84])):e.type===`3d`&&(a(()=>import(`./editingTools-Biga_mU-.js`),__vite__mapDeps([85,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,12,62,63,64,65,66,67,68,69,27,14,13,15,70,71,72,73,16,74,75,19,20,31,76,24,77,78,79,18,7,6,26,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,80,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,81,171,172,173,174,175,176,177,178,179,180,17,181,182,183,184])),a(()=>import(`./GraphicsLayerView3D-DcDUhmwm.js`),__vite__mapDeps([185,1,2,186,87,88,89,90,91,92,187,110,94,100,111,112,113,97,98,99,140,107,122,188,93,95,96,101,102,189,190,116,105,134,123,114,191,128,144,7,4,5,6,8,9,3,13,14,15,145,44,146,61,147,78,148,149,150,151,121,106,108,127,135,164,103,119,120,192,104,109,117,118,193,194,138,139,154,195,10,58,157,158,159,160,156,161,67,68,72,162,163,196,197,57,198,71,199,200,168,169,170,201,174,175,202,203,204,205,179,177,16,182,206,37,207,208]))))},T),w(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),$e(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=E(this._defaultSnappingManager),this._set(`snappingManager`,null),this._set(`view`,null),this._updatingHandles.destroy(),this.emit(`destroy`)}get _layerAdapter(){let{layer:e}=this;switch(e?.type){case`graphics`:return new en(e);case`map-notes`:return new tn(e);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type===`create`&&this._operationHandle.activeComponent&&`mode`in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){let{activeComponent:e,destroyed:t}=this,n=!t&&e&&`tooltip`in e?e.tooltip:null;return n?.visible?n:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!==`draw-3d`&&this.activeComponent.type!==`draw-2d`?this._get(`createGraphic`):this.activeComponent.graphic}get defaultCreateOptions(){return this._get(`defaultCreateOptions`)}set defaultCreateOptions(e){this._set(`defaultCreateOptions`,{...on,...e})}get defaultUpdateOptions(){return this._get(`defaultUpdateOptions`)}set defaultUpdateOptions(e){this._set(`defaultUpdateOptions`,{...K,...e,reshapeOptions:{...K.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...K.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get textSymbol(){return this._get(`textSymbol`)}set textSymbol(e){this._set(`textSymbol`,e)}get snappingOptions(){return this.snappingManager?.options??this._get(`snappingOptions`)}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set(`snappingOptions`,e)}get snappingManager(){return this._isOverridden(`snappingManager`)&&this._get(`snappingManager`),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden(`snappingManager`)||(this._defaultSnappingManager=E(this._defaultSnappingManager)),this._override(`snappingManager`,e);else{let{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new L({options:this.snappingOptions,view:e})),this._clearOverride(`snappingManager`)}}get state(){let e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?`active`:e?`ready`:`disabled`}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get(`view`)}set view(e){let n=this._get(`view`);if(n){let{container:e,map:t}=n;e&&this._clearCursor(),t?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}let r=`view-ready`;this.removeHandles(r),e&&this.addHandles(t(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},T),r),this._set(`view`,e)}addGraphic(e){this._layerAdapter?.add(e)}addGraphics(e){this._layerAdapter?.addMany(e)}hasGraphic(e){return!!this._layerAdapter?.has(e)}removeGraphic(e){this._layerAdapter?.remove(e)}removeGraphics(e){this._layerAdapter?.removeMany(e)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=me(this._moduleLoaderAbortController),this._viewReadyAbortController=me(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){let{state:e,updateGraphics:t}=this;if(e===`active`&&t.length){let{activeTool:e}=this,n=t.toArray();this.removeGraphics(n),this.cancel(),this._emitDeleteEvent({graphics:n,tool:e})}}duplicate(){if(this.state===`active`&&this.updateGraphics.length){let e=this.updateGraphics.map(e=>e.clone()).toArray();return this.addGraphics(e),this.emit(`duplicate`,{graphics:e,type:`duplicate`}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();let{view:n,layer:r}=this;if(!n||this.state===`disabled`)throw r||this._logMissingLayer(),xe();if(n.activeTool!=null&&(n.activeTool=null),!e)return void this._logError(`sketch:missing-parameter`,`Missing parameter 'tool'.`);We(n,this._internalGraphicsLayer);let i=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(i==null||this.destroyed)return void n.map?.remove(this._internalGraphicsLayer);i.on(`complete`,()=>{if(i===this._operationHandle){let n=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set(`createGraphic`,null),this.view?.map?.remove(this._internalGraphicsLayer),i.cancelled||n==null||this.addGraphic(n),this._sketchContinuationFlag=!1,this.emit(`create`,{graphic:n,state:r?`cancel`:`complete`,tool:e,toolEventInfo:null,type:`create`}),r||this._sketchContinuationFlag)return;let{creationMode:a}=this;if(a===`continuous`){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(ye(this.create(e,t)))}else a===`update`&&n&&this._updatingHandles.addPromise(ye(this.update([n])))}}),this._operationHandle=i,n.ready&&n.focus()}async place(e,t){return await e.load(),this.create(`mesh`,{mode:`click`,hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();let{layer:n,view:r,state:i}=this;if(!r||i===`disabled`)throw n||this._logMissingLayer(),xe();r.activeTool!=null&&(r.activeTool=null);let a=Array.isArray(e)?e:[e];if(e==null||!a?.length)return void this._logError(`sketch:missing-parameter`,`Missing parameter 'graphics'.`);if(a.some(e=>this.hasGraphic(e)?e.geometry==null&&(this._logError(`sketch:invalid-parameter`,`Parameter 'graphics' contains one or more graphics with an unsupported geometry.`),!0):(this._logError(`sketch:invalid-parameter`,`Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer.`),!0)))return;let o=await this._updatingHandles.addPromise(this._setupUpdateOperation(a,t));this.destroyed||o==null||$(o)||(We(r,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,t),this.emit(`update`,{graphics:a,state:`start`,aborted:!1,tool:o.tool,toolEventInfo:null,type:`update`}))}async _updateSpatialReference(e){let t=this.view;if(t){e=Array.isArray(e)?e:[e];for(let n of e)n.geometry==null||n.geometry.type===`mesh`||ue(n.geometry.spatialReference,t.spatialReference)||(v(n.geometry.spatialReference,t.spatialReference)||l()||await Te(),n.geometry=d(n.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){let t=this.view;if(!t)return this._logMissingView(),null;if(t.type===`2d`){let n=[];t.map.allLayers.forEach(e=>{e.type!==`vector-tile`&&e.type!==`imagery`||n.push(e)});let r=await t.hitTest(e,{exclude:n});return pt(r.results)}let n=[t.map.ground];t.map.allLayers.forEach(e=>{Ee(e)&&n.push(e)});let r=await t.hitTest(e,{exclude:n});if(r.results.length>0){let e=r.results[0];if(e!=null&&e.type===`graphic`&&e.graphic&&(!r.ground.mapPoint||t.map.ground.opacity<1||r.ground.distance-(e.distance??0)>-Math.min(3*r.ground.distance,t.viewingMode===`global`?ve(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:1/0)))return e}return null}_generateViewHandles(e){return[e.on(`immediate-click`,async e=>{let t=this.state===`active`&&this._operationHandle?.type===`create`;this.state!==`disabled`&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},f.WIDGET)]}async _handleImmediateClick(e){let t=await e.defer(()=>this._getFirstHit(se(e))),n=null;if(t!=null){let r=t.graphic;this.updateGraphics.includes(r)||this.hasGraphic(r)?(e.stopPropagation(),n=r):this.view?.type!==`2d`||this._isComponentGraphic(r)||this.state!==`active`||this.cancel()}else this.state===`active`&&this.cancel();n==null||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){let n=this.view;if(!n)return this._logMissingView(),null;let r={hasZ:n.type===`3d`,...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,n,r);return i==null?null:(n.tools.add(i),n.activeTool=i,this._setupCreateOperationHandle(i,e))}async _setupDrawGraphicTool(e,t,n){if(e===`multipoint`&&t.type===`3d`)return this._logError(`sketch:create`,`Multipoint geometries are not supported in SceneView.`),null;if(!t)return this._logMissingView(),null;let{cursor:r,defaultZ:i,hasZ:a,geometryToPlace:o,graphicProperties:s,mode:c,preserveAspectRatio:l}=n,u=nn(c,e),d=rn(e),f=n?.optionsPerTool?.has(e)?n.optionsPerTool.get(e):{},p=f?.preserveAspectRatio??l??e!==`rectangle`,m={centered:e!==`rectangle`&&!(e===`circle`&&!p),cursor:r,defaultZ:i,forceUniformSize:p,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:o,geometryType:d,mode:u,graphicSymbol:n.graphicSymbol??this._getGraphicSymbolFromTool(e),hasZ:a,snappingManager:this.snappingManager,snapToScene:!1,view:t,...f};return t.type===`2d`?this._makeDrawGraphicTool2D(m):this._makeDrawGraphicTool3D(m)}async _makeDrawGraphicTool2D(e){let[t,n,r]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-BmjIjJ1L.js`),__vite__mapDeps([41,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,12,62,63,64,65,66,67,68,69,27,14,13,15,70,71,72,73,16,74,75,19,20,31,76,24,77,78,79,18,7,6,26,80,81,82,83,84]))),z(),B()]);return $(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:un(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:r})}async _makeDrawGraphicTool3D(e){let[t,n,r]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-Biga_mU-.js`),__vite__mapDeps([85,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,12,62,63,64,65,66,67,68,69,27,14,13,15,70,71,72,73,16,74,75,19,20,31,76,24,77,78,79,18,7,6,26,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,80,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,81,171,172,173,174,175,176,177,178,179,180,17,181,182,183,184]))),z(),B()]);return $(t)||this.destroyed?null:new t.module.DrawGraphicTool3D({...e,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:n,automaticLengthMeasurementUtils:r})}_setupCreateOperationHandle(e,t){let n=this.view;if(!n)return this._logMissingView(),null;let r=null,i=e.forceUniformSize,a=e.centered,o=[n.on(`key-down`,t=>{if(t.key===y.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===y.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==y.vertexAdd||t.repeat)t.key===y.undo?(t.stopPropagation(),s.undo()):t.key===y.redo?(t.stopPropagation(),s.redo()):t.key!==y.constraint||e.geometryType!==`rectangle`&&e.geometryType!==`circle`||t.repeat?t.key===y.center&&(t.repeat||(e.centered=!a,t.stopPropagation())):(e.forceUniformSize=!i,t.stopPropagation());else{let n=e.drawOperation.geometryType;n!==`polyline`&&n!==`polygon`&&n!==`multipoint`||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},f.WIDGET),n.on(`key-up`,t=>{t.key===y.pan?e.enabled=!0:t.key!==y.constraint||e.geometryType!==`rectangle`&&e.geometryType!==`circle`?t.key===y.center&&(e.centered=a,t.stopPropagation()):(e.forceUniformSize=i,t.stopPropagation())},f.WIDGET),e.on(`vertex-add`,t=>{switch(r=r==null?`start`:`active`,t.operation){case`apply`:this.emit(`create`,{graphic:e.graphic,state:r,tool:this.activeTool,toolEventInfo:t,type:`create`});break;case`undo`:this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case`redo`:this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on(`cursor-update`,t=>{e.drawOperation.numCommittedVertices>0&&this.emit(`create`,{graphic:e.graphic,state:`active`,tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:`cursor-update`},type:`create`})}),e.on(`vertex-remove`,t=>{switch(t.operation){case`apply`:this.emit(`create`,{graphic:e.graphic,state:`active`,tool:this.activeTool,toolEventInfo:t,type:`create`});break;case`undo`:this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case`redo`:this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on(`complete`,e=>{this._set(`createGraphic`,e.graphic),r=`complete`,e.aborted?s&&s.cancel():s&&s.complete()}),w(()=>this._getGraphicSymbolFromTool(t),t=>{e.graphicSymbol=t})],s=new W({activeComponent:e,type:`create`,onEnd:()=>{b(o),n.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return s}_getGraphicSymbolFromTool(e){switch(e){case`point`:case`multipoint`:return this.pointSymbol;case`polyline`:case`freehandPolyline`:return this.polylineSymbol;case`circle`:case`rectangle`:case`polygon`:case`freehandPolygon`:return this.polygonSymbol;case`mesh`:return this.meshSymbol;case`text`:return this.textSymbol}}async _setupUpdateOperation(e,t){let{view:n}=this;if(!n)return this._logMissingView(),null;let r={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}},i=r.tool??K.tool;if(this.removeGraphics(e),this.addGraphics(e),n.type===`3d`){if(e.length===0)return null;switch(i){case`move`:return this._setupMove3DOperation(e,r,n,i);case`reshape`:return e.length>1?(this._logError(`sketch:reshape-multiple`,`Reshape operation does not support multiple graphics.`),null):this._setupReshape3DOperation(e[0],r,n);case`transform`:return this._setupGraphicTransform3DOperation(e,r,n)}}switch(i){case`move`:return this._setupMove2DOperation(e,r,n);case`reshape`:return e.length>1?(this._logError(`sketch:reshape-multiple`,`Reshape operation does not support multiple graphics.`),null):this._setupTransformOrReshape2DOperation(e,i,r,n);case`transform`:return an(e)&&(i=`reshape`),this._setupTransformOrReshape2DOperation(e,i,r,n)}}async _setupMove3DOperation(e,t,n,r,i=!1){let[o,s]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-Biga_mU-.js`),__vite__mapDeps([85,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,12,62,63,64,65,66,67,68,69,27,14,13,15,70,71,72,73,16,74,75,19,20,31,76,24,77,78,79,18,7,6,26,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,80,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,81,171,172,173,174,175,176,177,178,179,180,17,181,182,183,184]))),B()]);if($(o))return o;let{ManipulatedObject3DGraphic:c,MoveTool3D:l}=o.module,u=new Map,d=()=>{u.forEach(e=>e.destroy()),u.clear()};for(let t of e){let e=new c({view:n,graphic:t}),r=Ue(e);if(r!==0)return d(),this._logError(`sketch:move`,`Move operation not supported for provided graphic(s) (${mt(r)}).`),null;u.set(t,e)}let p=new l({view:n,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:s});n.tools.add(p),p.objects.addMany(Array.from(u.values())),i||this.updateGraphics.addMany(e);let m=[],h=new G({activeComponent:p,tool:r,type:`update`,onEnd:()=>{b(m),Q(n,p),d()},undo:()=>{fn(this.view,p),Y(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{X(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:e=>{this.updateGraphics.push(e);let t=new c({view:n,graphic:e});u.set(e,t),p.objects.push(t),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);if(h.history.undo.forEach(e=>e.updates.splice(t,1)),h.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),this.updateGraphics.length===0)return void h.complete();let n=u.get(e);n&&(p.objects.remove(n),n.destroy(),u.delete(e))},toggleTool:async()=>{if(this.updateGraphics.length!==1||!1===t.toggleToolOnClick||r!==`transform`)return;let e=this.updateGraphics.at(0),i=await this._setupReshape3DOperation(e,t,n,!0);i&&!$(i)&&(h.onEnd(),h.destroy(),this._setUpdateOperationHandle(i,t))}});return m.push(...this._getHandlesForComponent(h,t),n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(h,e,t),f.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(h,e)},f.WIDGET)),h}_setupGraphicTransform3DOperation(e,t,n,r=!1){if(e.length===1&&_t(e[0])===0){let i=e[0],a=i.geometry;if(a!=null&&(a.type===`point`||a.type===`mesh`))return this._setupPointTransform3DOperation(i,t,n);if(a!=null&&(a.type===`polygon`||a.type===`polyline`))return this._setupPolyTransform3DOperation(i,t,n,r)}return this._setupMove3DOperation(e,t,n,`transform`,r)}async _setupPointTransform3DOperation(e,t,n){let r=`transform`,{enableRotation:i,enableScaling:o,enableZ:s}=t,c=await this._requireModule(a(()=>import(`./editingTools-Biga_mU-.js`),__vite__mapDeps([85,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,12,62,63,64,65,66,67,68,69,27,14,13,15,70,71,72,73,16,74,75,19,20,31,76,24,77,78,79,18,7,6,26,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,80,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,81,171,172,173,174,175,176,177,178,179,180,17,181,182,183,184])));if($(c))return c;let{TransformTool3D:l,ManipulatedObject3DGraphic:u}=c.module,d=new u({graphic:e,view:n}),p=new l({object:d,view:n,enableRotation:i,enableScaling:o,enableZ:s,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});n.tools.add(p),this.updateGraphics.add(e);let m=[],h=new G({activeComponent:p,tool:r,type:`update`,onEnd:()=>{b(m),Q(n,p),d.destroy()},undo:()=>{fn(this.view,p),Y(h,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r})},redo:()=>{X(h,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),h.onEnd(),h.destroy();let r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,`transform`,!0);$(r)||this._setUpdateOperationHandle(r,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),h.complete()},toggleTool:()=>{}});return m.push(...this._getHandlesForComponent(h,t),n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(h,e,t),f.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(h,e)},f.WIDGET)),h}async _setupPolyTransform3DOperation(e,t,n,r=!1){let i=`transform`,{enableRotation:o,enableScaling:s,enableZ:c,preserveAspectRatio:l}=t,[u,d]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-Biga_mU-.js`),__vite__mapDeps([85,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,12,62,63,64,65,66,67,68,69,27,14,13,15,70,71,72,73,16,74,75,19,20,31,76,24,77,78,79,18,7,6,26,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,80,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,81,171,172,173,174,175,176,177,178,179,180,17,181,182,183,184]))),B()]);if($(u))return u;let{ManipulatedObject3DGraphic:p,ExtentTransformTool:m}=u.module,h=this.view?.inputManager?.isModifierKeyDown(y.constraint),g=new p({view:n,graphic:e}),_=new m({object:g,view:n,enableRotation:o,enableScaling:s,enableZ:c,preserveAspectRatio:!!l!=!!h,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});n.tools.add(_),r||this.updateGraphics.add(e);let ee=[],v=new G({activeComponent:_,tool:i,type:`update`,onEnd:()=>{b(ee),Q(n,_),g.destroy()},canUndo:()=>!_.destroyed&&_.canUndo,undo:()=>{_.destroyed||(_.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!_.destroyed&&_.canRedo,redo:()=>{_.destroyed||(_.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),v.onEnd(),v.destroy();let r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,`transform`,!0);$(r)||this._setUpdateOperationHandle(r,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),v.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||!1===t.toggleToolOnClick)return;let r=await this._setupReshape3DOperation(e,t,n,!0);r&&!$(r)&&(v.onEnd(),v.destroy(),this._setUpdateOperationHandle(r,t))}});return ee.push(...this._getHandlesForComponent(v,t),n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(v,e,t),f.WIDGET),n.on(`key-down`,e=>this._getCommonUpdateOperationKeyDownHandlers(v,e),f.WIDGET),n.on(`key-down`,e=>{e.key!==y.constraint||e.repeat||(_.preserveAspectRatio=!_.preserveAspectRatio,e.stopPropagation())},f.WIDGET),n.on(`key-up`,e=>{e.key===y.constraint&&(_.preserveAspectRatio=!_.preserveAspectRatio,e.stopPropagation())},f.WIDGET)),v}async _setupMove2DOperation(e,t,n){let r=`move`;this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let i=await this._getGraphicMover(e,t,n);if($(i))return i;let a=new G({activeComponent:i,tool:r,type:`update`,onEnd:()=>{this._clearCursor(),b(c),b(s),i.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{let e=this.updateGraphics.toArray();Y(a,e),a.refreshComponent(),this._emitUndoEvent({graphics:e,tool:r})},redo:()=>{let e=this.updateGraphics.toArray();X(a,e),a.refreshComponent(),this._emitRedoEvent({graphics:e,tool:r})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),i.graphics=this.updateGraphics.toArray(),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);a.history.undo.forEach(e=>e.updates.splice(t,1)),a.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);let n=this.updateGraphics.toArray();this.emit(`update`,{graphics:n,state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),this.updateGraphics.length===0?a.complete():i.graphics=n}}),o=!1,s=[n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(a,e,t),f.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(a,e),e.key!==y.constraint||e.repeat||(o=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},f.WIDGET),n.on(`key-up`,e=>{e.key===y.constraint&&o&&(o=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},f.WIDGET)],c=this._getHandlesForComponent(a,t);return a}async _setupReshape3DOperation(e,t,n,r=!1){let i=`reshape`,[o,s,c]=await Promise.all([this._requireModule(a(()=>import(`./editingTools-Biga_mU-.js`),__vite__mapDeps([85,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,12,62,63,64,65,66,67,68,69,27,14,13,15,70,71,72,73,16,74,75,19,20,31,76,24,77,78,79,18,7,6,26,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,80,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,81,171,172,173,174,175,176,177,178,179,180,17,181,182,183,184]))),z(),B()]);if($(o))return o;let{ManipulatedObject3DGraphic:l,ReshapeTool3D:u}=o.module,d=new l({view:n,graphic:e}),p=ht(d);if(p!==0)return d.destroy(),this._logError(`sketch:reshape`,`Reshape operation not supported for provided graphic(s) (${mt(p)}).`),null;let m=t.reshapeOptions,h=new u({view:n,object:d,enableZVertex:t.enableZ&&m?.vertexOperation===`move`,enableZShape:t.enableZ&&m?.shapeOperation===`move`,enableMoveObject:m?.shapeOperation===`move`||m?.shapeOperation===`move-xy`,enableMidpoints:m?.edgeOperation===`split`,enableEdgeOffset:m?.edgeOperation===`offset`,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:s,automaticLengthMeasurementUtils:c});n.tools.add(h),r||this.updateGraphics.add(d.graphic);let g=[],_=new G({activeComponent:h,tool:i,type:`update`,onEnd:()=>{b(g),Q(n,h),d.destroy()},canUndo:()=>!h.destroyed&&h.canUndo,undo:()=>{h.destroyed||(h.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},canRedo:()=>!h.destroyed&&h.canRedo,redo:()=>{h.destroyed||(h.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),_.onEnd(),_.destroy();let r=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,n,`transform`,!0);$(r)||this._setUpdateOperationHandle(r,t)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),_.complete()},toggleTool:async()=>{if(!1===t.toggleToolOnClick)return;_.onEnd(),_.destroy();let e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,n,!0);$(e)||this._setUpdateOperationHandle(e,t)}});return g.push(...this._getHandlesForComponent(_,t),n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(_,e,t),f.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(_,e)},f.WIDGET)),_}async _setupTransformOrReshape2DOperation(e,t,n,r){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let i=t===`transform`?await this._getBox(e,n,r):await this._getReshape(e,n,r);if($(i))return i;let a=new G({activeComponent:i,type:`update`,onEnd:()=>{b(s),b(o),a.activeComponent&&!a.activeComponent.destroyed&&a.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Y(a,this.updateGraphics.toArray()),a.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a.tool})},redo:()=>{X(a,this.updateGraphics.toArray()),a.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a.tool})},addToSelection:async e=>{let t=a.activeComponent;if(t?.type===`reshape`){let t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),a.onEnd(),a.destroy();let i=await this._setupTransformOrReshape2DOperation(t,`transform`,n,r);if($(i))return;this._setUpdateOperationHandle(i,n)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),a.resetHistory();this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);a.history.undo.forEach(e=>e.updates.splice(t,1)),a.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);let n=this.updateGraphics.toArray();n.length===0?a.complete():an(n)?a.toggleTool():a.activeComponent.graphics=n,this.emit(`update`,{graphics:n,state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;let e=this.updateGraphics.at(0),t=e.geometry;if(t!=null&&(a.tool===`reshape`&&t.type===`point`||a.tool===`transform`&&t.type===`extent`))return;let i=null;a.tool===`transform`?i=await this._getReshape([e],n,r):a.tool===`reshape`&&(i=await this._getBox([e],n,r)),$(i)||(a.activeComponent?.destroy(),a.activeComponent=i,a.activeComponent&&(b(s),s=this._getHandlesForComponent(a,n)))}}),o=[r.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(a,e,n),f.WIDGET),r.on(`key-down`,e=>{if(this._getCommonUpdateOperationKeyDownHandlers(a,e),e.key===y.constraint&&!e.repeat&&a){let e=a.activeComponent;e?.type===`box`&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},f.WIDGET),r.on(`key-up`,e=>{if(e.key===y.constraint&&a){let e=a.activeComponent;e?.type===`box`&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},f.WIDGET)],s=this._getHandlesForComponent(a,n);return a}async _getGraphicMover(e,t,n){let{enableMoveAllGraphics:r,highlightOptions:i}=t,o=await this._requireModule(a(()=>import(`./GraphicMover-cbOIw3pX.js`),__vite__mapDeps([209,70,1,2,210,83,75,211,37])));return $(o)?o:new o.module.default({enableMoveAllGraphics:r,highlightName:i?.name,highlightsEnabled:!!i?.enabled,indicatorsEnabled:!1,graphics:e,view:n,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:n})=>{this._displayCursor(`grabbing`),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move-start`},type:`update`})},onGraphicMove:({dx:e,dy:t,graphic:n})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move`},type:`update`}),onGraphicMoveStop:({dx:e,dy:t,graphic:n})=>{this._displayCursor(`pointer`),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move-stop`},type:`update`})},onGraphicPointerOver:()=>this._displayCursor(`move`),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(e,t,n){let{enableRotation:r,enableScaling:i,highlightOptions:o,preserveAspectRatio:s}=t,[c,l]=await Promise.all([this._requireModule(a(()=>import(`./Box-BJMxLmGq.js`),__vite__mapDeps([212,1,2,5,61,10,11,63,64,62,65,66,67,68,69,27,12,14,13,15,70,210,83,75,211,37,213,79,183,184]))),B()]);if($(c))return c;let u=this.view?.inputManager?.isModifierKeyDown(y.constraint);return new c.module.default({graphics:e,enableRotation:r,enableScaling:i,highlightName:o?.name,highlightsEnabled:!!o?.enabled,preserveAspectRatio:!!s!=!!u,layer:this._internalGraphicsLayer,view:n,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:l,callbacks:{onMoveStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onMove:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onMoveStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScaleStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScale:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScaleStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotateStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotate:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotateStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`})}})}async _getReshape(e,t,n){let{highlightOptions:r,reshapeOptions:i}=t,o=i?.edgeOperation===`split`,s=i?.shapeOperation===`move`,c=!!i?.enableCreateCurveFromStraightEdge,[l,u,d]=await Promise.all([this._requireModule(a(()=>import(`./Reshape-BzfolmAL.js`),__vite__mapDeps([214,1,2,49,50,51,52,53,54,4,5,80,215,61,10,58,11,63,64,56,57,62,65,66,67,68,69,27,12,14,13,15,55,78,8,70,16,81,171,216,217,82,74,75,19,20,31,76,24,77,181,210,83,211,37,213,79,184]))),z(),B()]);return $(l)?l:new l.module.default({enableMidpoints:o,enableMovement:s,enableCurveOnMidpoint:c,graphic:e[0],highlightName:r?.name,highlightsEnabled:!!r?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:u,automaticLengthMeasurementUtils:d,view:n,callbacks:{onReshapeStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onReshape:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onReshapeStop:({mover:e,type:t})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:`update`}),onMoveStart:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onMove:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onMoveStop:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onVertexAdd:({added:e,type:t,vertices:n})=>{let r=e.map(e=>p(e.geometry));this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:r,vertices:n,type:t},type:`update`})},onVertexRemove:({removed:e,type:t,vertices:n})=>{let r=e.map(e=>p(e.geometry));this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{removed:r,vertices:n,type:t},type:`update`})}}})}_getHandlesForComponent(e,t){let n=e.activeComponent;if(!n)return[];switch(n.type){case`graphic-mover`:return[n.on(`graphic-click`,({graphic:n,viewEvent:r})=>{r.native?.shiftKey&&t.multipleSelectionEnabled&&(r.stopPropagation(),e.removeFromSelection(n))}),n.on(`graphic-move-start`,t=>e.addToHistory(Z(t.allGraphics)))];case`box`:return[n.on(`graphic-click`,n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),n.on(`move-start`,t=>e.addToHistory(Z(t.graphics))),n.on(`rotate-start`,t=>e.addToHistory(Z(t.graphics))),n.on(`scale-start`,t=>e.addToHistory(Z(t.graphics)))];case`reshape`:return[n.on(`graphic-click`,n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),n.on(`move-start`,t=>e.addToHistory(Z([t.mover]))),n.on(`reshape-start`,t=>e.addToHistory(Z([t.graphic]))),n.on(`vertex-add`,t=>e.addToHistory(Z([t.oldGraphic]))),n.on(`vertex-remove`,t=>e.addToHistory(Z([t.oldGraphic])))];case`move-3d`:return[n.events.on(`record-undo`,({updates:t})=>{e.addToHistory({updates:t})}),n.events.on(`move-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move-start`},type:`update`})}),n.events.on(`move`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move`},type:`update`})}),n.events.on(`move-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move-stop`},type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case`transform-3d`:return[n.events.on(`record-undo`,({updates:t})=>{e.addToHistory({updates:t})}),n.events.on(`translate-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move-start`},type:`update`})}),n.events.on(`translate-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move-stop`},type:`update`})}),n.events.on(`rotate-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate-start`},type:`update`})}),n.events.on(`rotate-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate-stop`},type:`update`})}),n.events.on(`scale-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale-start`},type:`update`})}),n.events.on(`scale-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale-stop`},type:`update`})}),n.events.on(`translate`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move`},type:`update`})}),n.events.on(`rotate`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate`},type:`update`})}),n.events.on(`scale`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale`},type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case`reshape-3d`:return[n.events.on(`reshape`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:`update`})}),n.events.on(`move`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:`update`})}),n.events.on(`vertex-add`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:e,type:`update`})}),n.events.on(`vertex-remove`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:e,type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,n){let{graphic:r,viewEvent:i}=n;return i.native?.shiftKey&&this.hasGraphic(r)?(i.stopPropagation(),e.removeFromSelection(r)):t.toggleToolOnClick?(i.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;let n=this.view?.map;this._disablePopup(t),e.on(`complete`,()=>{if(e===this._operationHandle){let r=this.updateGraphics.toArray(),i=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),n&&n.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit(`update`,{graphics:r,state:`complete`,aborted:e.cancelled,tool:i,toolEventInfo:null,type:`update`})}})}async _getCommonUpdateOperationClickHandlers(e,t,n){let r=se(t),i=await t.defer(()=>this._getFirstHit(r));if(i==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([i.graphic],e,n))return void t.stopPropagation();this.updateGraphics.includes(i.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,n){let r=!!n.multipleSelectionEnabled;return e.some(e=>e!=null&&!(!r||!this.hasGraphic(e))&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;let n=t.key;n===y.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):n===y.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):n===y.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&y.delete.includes(n)&&this._onDeleteKey(t)}_onDeleteKey(e){this._operationHandle&&this._operationHandle.type===`update`&&this.activeComponent!=null&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&=(this.view?.map?.remove(this._internalGraphicsLayer),E(this._internalGraphicsLayer))}_isComponentGraphic(e){let{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type===`draw-2d`&&t.graphic===e||(t.type===`box`||t.type===`reshape`)&&t.isUIGraphic(e))}_clearCursor(){this.removeHandles(q)}_displayCursor(e){this.removeHandles(q),this.view?.container&&e!=null&&this.addHandles(this.view.acquireCursor(e,`high`),q)}_logError(e,t,n){Ce.getLogger(this).error(new o(e,t,n))}async _requireModule(e){let t=new AbortController;this._moduleLoaderAbortController=t;let n=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:`aborted`}:{module:n}}_emitUndoEvent(e){this.emit(`undo`,{...e,type:`undo`})}_emitRedoEvent(e){this.emit(`redo`,{...e,type:`redo`})}_emitDeleteEvent(e){this.emit(`delete`,{...e,type:`delete`})}_onLayerGraphicsChangeCallback(e){if(this._operationHandle!=null){let{updateGraphics:t}=this;for(let n of e.removed)if(t.includes(n)){if(!(t.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(n)}}}get test(){}wait(){return Se(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!==`3d`||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){let e=this.view;e?(me(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await n(Se(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError(`sketch:missing-property`,ln(`view`))}_logMissingLayer(){this._logError(cn,ln(`layer`))}};S([s()],J.prototype,`_defaultSnappingManager`,void 0),S([s()],J.prototype,`_layerAdapter`,null),S([s()],J.prototype,`_operationHandle`,void 0),S([s({readOnly:!0})],J.prototype,`_updatingHandles`,void 0),S([s({readOnly:!0})],J.prototype,`activeTool`,null),S([s({readOnly:!0})],J.prototype,`activeCreateToolDrawMode`,null),S([s()],J.prototype,`activeTooltip`,null),S([s({types:D})],J.prototype,`activeFillSymbol`,void 0),S([s()],J.prototype,`activeLineSymbol`,void 0),S([s()],J.prototype,`activeVertexSymbol`,void 0),S([s()],J.prototype,`allowDeleteKey`,void 0),S([s({readOnly:!0})],J.prototype,`createGraphic`,null),S([s()],J.prototype,`defaultCreateOptions`,null),S([s()],J.prototype,`defaultUpdateOptions`,null),S([s({type:Ge,nonNullable:!0})],J.prototype,`labelOptions`,null),S([s()],J.prototype,`layer`,void 0),S([s({types:D})],J.prototype,`pointSymbol`,void 0),S([s({types:D})],J.prototype,`polygonSymbol`,void 0),S([s({types:D})],J.prototype,`polylineSymbol`,void 0),S([s()],J.prototype,`meshSymbol`,void 0),S([s({type:u})],J.prototype,`textSymbol`,null),S([s({type:P,nonNullable:!0})],J.prototype,`snappingOptions`,null),S([s()],J.prototype,`snappingManager`,null),S([s({readOnly:!0})],J.prototype,`state`,null),S([s({type:qe,nonNullable:!0})],J.prototype,`tooltipOptions`,null),S([s({readOnly:!0})],J.prototype,`updateGraphics`,void 0),S([s()],J.prototype,`updateOnGraphicClick`,void 0),S([s()],J.prototype,`updating`,null),S([s()],J.prototype,`creationMode`,void 0),S([s({type:Ke,nonNullable:!0})],J.prototype,`valueOptions`,null),S([s({types:D})],J.prototype,`vertexSymbol`,void 0),S([s({value:null})],J.prototype,`view`,null),S([s({constructOnly:!0,type:Je})],J.prototype,`sketchOptions`,void 0),J=S([_(`esri.widgets.Sketch.SketchViewModel`)],J);var cn=`sketch:missing-property`,ln=e=>`Property '${e}' is missing on SketchViewModel.`;function un(e){return e===`polygon`||e===`rectangle`||e===`circle`}function Y(e,t){dn(`undo`,e.history.undo,e.history.redo,t)}function X(e,t){dn(`redo`,e.history.redo,e.history.undo,t)}function dn(e,t,n,r){let i=t.pop();if(!i)return;let a=i.updates,o=[];r.forEach((t,n)=>{let r=a[n];r!=null&&(`geometry`in r&&r.geometry!=null&&(o.push({geometry:t.geometry}),t.geometry=r.geometry),`symbol`in r&&r.symbol!=null&&(o.push({symbol:t.symbol}),t.symbol=r.symbol),`undo`in r&&(o.push(r),r[e](t)))}),n.push({updates:o})}function fn(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function Z(e){return{updates:e.map(({geometry:e})=>e?.type===`mesh`?{geometry:e.cloneShallow()}:{geometry:e})}}function Q(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function $(e){return`requireError`in e&&e.requireError===`aborted`}export{P as n,N as r,J as t};