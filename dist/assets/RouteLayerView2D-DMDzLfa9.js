const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RouteLayerInteraction-CbNHXByJ.js","assets/index-CZ4oMP1N.js","assets/index-CDgdHpAj.css","assets/measures-CvGGokgB.js","assets/Distance2DCalculator-CXhBP-8I-CqzpU8vR.js","assets/SpatialReference-HLIf1Z5k.js","assets/Envelope2D-Cwxt0azx.js","assets/Point2D-7VmvyXN4.js","assets/OperatorDefinitions-CscAnk1m.js","assets/SimpleGeometryCursor-5wFw2ZZo.js","assets/Transformation2D-CPSmiNnd.js","assets/OperatorProximity-D5FJ67Oq.js","assets/distanceOperator-CYf0gmY_.js","assets/apiConverter-BH2GqpH4.js","assets/jsonConverter-CbeIyOFG.js","assets/OptimizedGeometry-hOUTi-cB.js","assets/memoryEstimations-DQOvnrRz.js","assets/earcut-BF1-mB58.js","assets/geodeticAreaOperator-CbAaN6Nl.js","assets/geodeticCurveType-DoJa853C.js","assets/geodeticLengthOperator-CWQiiddx.js","assets/proximityOperator-DR4Uj50N.js","assets/ObjectStack-CBI5g-Qc.js","assets/vectorStacks-FfDNcZoS.js","assets/quatf64-BJJPhW0N.js","assets/colorUtils-DJOs5VE1.js","assets/vec3-zq4-AU_O.js","assets/sphere-9YfqUkuX.js","assets/plane-Bg1a5O73.js","assets/ray-CWXoVP-g.js","assets/memoize-BNsZjv91.js","assets/quantity-CPor8qMe.js","assets/geodesicUtils-CbiJFASl.js","assets/projectionZScaling-DAQiVc32.js","assets/projectOperator-CfopyaTY.js","assets/projectPointToVector-HYpbaZqA.js","assets/projectVectorToVector-DX3Yd1qf.js","assets/dehydratedPoint-rdg1UAtQ.js","assets/spatialReferenceEllipsoidUtils-B0E4spY0.js","assets/lineSegment-BJ2rgalW.js","assets/triangle-_uWz9WdI.js","assets/GraphicsLayer-Bx8Nz7ax.js","assets/Stop-D2HmBER2.js","assets/networkEnums-QOpSLZcw.js","assets/elevationInfoUtils-9csVBlEH.js","assets/SketchViewModel-NAjbn0Ca.js","assets/isSupportedObject-Ccal0viz.js","assets/layerUtils-VowzydxH.js","assets/SketchOptions-Dp8M5XoK.js","assets/LineSnappingHint-BOeMI0cS.js","assets/ParallelSnappingHint-C_mSlwpq.js","assets/DrapedEdgeSnappingCandidate-BWx5lQgf.js","assets/constraints-Bf0IRs4G.js","assets/EdgeSnappingCandidate-BfgKjc_Z.js","assets/SnappingCandidate-B4WtOFZq.js","assets/IntersectionSnappingCandidate-b5Urq9uN.js","assets/IntersectionSnappingHint-CdcMZxUs.js","assets/LineSnappingCandidate-BsncFUer.js","assets/RightAngleTriangleSnappingCandidate-CRITbc5W.js","assets/RightAngleSnappingHint-BXbBqf-p.js","assets/viewUtils-D9SUkhqu.js","assets/viewUtils-BwKx9qtR.js","assets/snappingUtils-Od8uWW_a.js","assets/euclideanLengthMeasurementUtils-C9WB-wbk.js","assets/hitTestSelectUtils-DQf3EOGe.js"])))=>i.map(i=>d[i]);
import{BS as e,DT as t,JE as n,OT as r,WT as i,Y_ as a,ev as o,gD as s,iv as c,nv as l,rv as u}from"./index-CZ4oMP1N.js";import"./memoryEstimations-DQOvnrRz.js";import"./OptimizedGeometry-hOUTi-cB.js";import"./OptimizedFeatureSet-CTIqq8fn.js";import"./featureConversionUtils-_DSSMFQ2.js";import"./streamLayerUtils-82UmlW-3.js";import"./QueueProcessor-BtMHt_WC.js";import"./earcut-BF1-mB58.js";import"./layerViewUtils-RSw-QNoB.js";import"./colorUtils-DJOs5VE1.js";import"./networkEnums-QOpSLZcw.js";import"./timeSupport-DTr00ezP.js";import"./queryUtils-DcyDFw5_.js";import"./quantizationUtils-CGy9nkLl.js";import"./normalizeUtilsSync-3fP05dGa.js";import{i as d,r as f,t as p}from"./RouteInfo-BK89lE3E.js";import{i as m,n as h,r as g,t as _}from"./Stop-D2HmBER2.js";import"./GeometryUtils-Dmca5Xm4.js";import"./VertexAttributeLocations-CfzeuYMz.js";import"./VertexElementDescriptor-ju-1bdWe.js";import"./labelPoint-vGsL2GFc.js";import"./callExpressionWithCursor-BmfrFX6I.js";import"./FeatureMetadata-i54qdN5K.js";import"./CIMSymbolHelper-l5sn5wJj.js";import"./rasterizingUtils-CKtfcOpu.js";import"./Rect-BhUrWpQm.js";import"./BoundingBox-CLkiiRfJ.js";import"./BidiEngine-BrFXRv7y.js";import"./callExpressionWithFeature-D55aOczd.js";import"./OverrideHelper-BhCM0ayL.js";import"./FeatureCommandQueue-CjFmAvd1.js";import"./config-BSvujflG.js";import"./dehydratedFeatureComparison-Uk3aLNrk.js";import"./WGLContainer-D_aBMsnu.js";import"./utils-DS5dbHj4.js";import"./ProgramTemplate-BXau1qoF.js";import"./VertexArrayObject-DEfjd5y-.js";import"./BufferObject-q8zuTMny.js";import"./VertexBuffer-xVpphTb4.js";import"./vec3f32-B2H3-fiA.js";import"./Container-BuEih3Ua.js";import"./GraphShaderModule-D5RCsL2_.js";import"./FramebufferObject-BhBPSr-C.js";import"./ShaderBuilder-D3cV1oap.js";import{t as v}from"./LayerView2D-BsKgTWnO.js";import{t as y}from"./LayerView-2jeNRFkG.js";import"./UpdateTracking2D-BiwypiBP.js";import"./TechniqueInstance-B37K-FPt.js";import"./TileContainer-B6yQthEI.js";import"./constants-BuH6TGxi.js";import"./utils-Czjlo_U1.js";import{t as b}from"./highlightOptionsUtils-C8mtOR7S.js";import"./AGraphicContainer-BjvRrdle.js";import{t as x}from"./GraphicContainer-Dcpg9zYN.js";import"./ComputedAttributeStorage-B3XSA2BQ.js";import{t as S}from"./GraphicsView2D-CPqKya-9.js";import"./dehydratedFeatures-8DNmK2px.js";var C=[`route-info`,`direction-line`,`direction-point`,`polygon-barrier`,`polyline-barrier`,`point-barrier`,`stop`],w={graphic:null,property:null,oldValue:null,newValue:null};function T(e){return e instanceof d||e instanceof f||e instanceof m||e instanceof g||e instanceof h||e instanceof p||e instanceof _}function E(e){return c.isCollection(e)&&e.length&&T(e.at(0))}function D(e){return Array.isArray(e)&&e.length>0&&T(e[0])}var O=class extends v(y){constructor(){super(...arguments),this._graphics=new c,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map,this._interaction=null,this._loadInteractionPromise=null,this.interactive=!1}get _routeItems(){return new a({getCollections:()=>this.layer&&!this.destroyed?[this.layer.routeInfo?new c([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]:[]})}initialize(){this.addHandles(l(()=>{let{interactive:e,suspended:t}=this;return{interactive:e,suspended:t}},({interactive:e,suspended:t})=>{let n=e&&!t;n&&this._getInteractionLoadPromise().then(e=>{e.enabled=this.interactive&&!this.suspended}),this._interaction&&(this._interaction.enabled=n)},u)),this._updatingHandles.addOnCollectionChange(()=>this._routeItems,e=>this._routeItemsChanged(e),o)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get(`_routeItems`)?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView(),this._interaction?.enabled&&(this._interaction.enabled=!1)}get selectedNetworkFeatures(){return this._interaction?.selectedNetworkFeatures??null}async create(e){return this._interaction?.create(e)}delete(){this._interaction?.delete()}async fetchPopupFeaturesAtLocation(e,t){return this._graphicsView.hitTest(e).filter(({popupTemplate:e})=>!!e)}highlight(e,t){let r;r=T(e)?[this._getNetworkFeatureUid(e)]:D(e)?e.map(e=>this._getNetworkFeatureUid(e)):E(e)?e.map(e=>this._getNetworkFeatureUid(e)).toArray():[e.uid];let a=r.filter(n);if(!a.length)return i();let o=b(t);return this._addHighlights(a,o),i(()=>this._removeHighlights(a,o))}async hitTest(e,t){if(this.suspended)return null;let r=this._graphicsView.hitTest(e).filter(n).map(e=>this._networkGraphicMap.get(e));if(!r.length)return null;let{layer:i}=this;return r.reverse().map(t=>({type:`route`,layer:i,mapPoint:e,networkFeature:t}))}isUpdating(){return this._graphicsView.updating}moveEnd(){}remove(e){this._interaction?.remove(e)}update(e){this._graphicsView.processUpdate(e)}viewChange(){this._graphicsView.viewChange()}_createGraphic(e){let t=e.toGraphic();return t.layer=this.layer,t.sourceLayer=this.layer,t}_createGraphicsView(){let e=this.view,t=()=>this.requestUpdate(),n=new x(e.featuresTilingScheme);this._graphicsView=new S({container:n,graphics:this._graphics,requestUpdateCallback:t,view:e}),this.container.addChild(n),this._processHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(e){let t=this._networkGraphicMap.get(e);return C.indexOf(t.type)}_getInteractionLoadPromise(){return this._loadInteractionPromise||(this._loadInteractionPromise=this._loadInteraction(),this._updatingHandles.addPromise(this._loadInteractionPromise)),this._loadInteractionPromise}_getNetworkFeatureUid(e){return this._networkFeatureMap.has(e)?this._networkFeatureMap.get(e).uid:null}async _loadInteraction(){let{layer:t,view:n}=this,{RouteLayerInteraction:r}=await e(async()=>{let{RouteLayerInteraction:e}=await import(`./RouteLayerInteraction-CbNHXByJ.js`);return{RouteLayerInteraction:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64]));return this._interaction=new r({view:n,layer:t}),this._interaction}_routeItemsChanged(e){if(e.removed.length){this._graphics.removeMany(e.removed.map(e=>{let t=this._networkFeatureMap.get(e);return this._networkFeatureMap.delete(e),this._networkGraphicMap.delete(t),t}));for(let t of e.removed)this.removeHandles(t)}if(e.added.length){this._graphics.addMany(e.added.map(e=>{let t=this._createGraphic(e);return t.symbol==null?null:(this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),t)}).filter(n));for(let t of e.added)this.addHandles([l(()=>t.geometry,(e,n)=>{this._updateGraphic(t,`geometry`,e,n)}),l(()=>t.symbol,(e,n)=>{this._updateGraphic(t,`symbol`,e,n)}),l(()=>t.popupTemplate,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).popupTemplate=e)}),l(()=>t.toGraphic().attributes,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).attributes=e)})],t);this._graphics.sort((e,t)=>this._getDrawOrder(e)-this._getDrawOrder(t))}}_updateGraphic(e,t,n,r){if(!this._networkFeatureMap.has(e)){let t=this._createGraphic(e);this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),this._graphics.add(t);return}let i=this._networkFeatureMap.get(e);i[t]=n,w.graphic=i,w.property=t,w.oldValue=r,w.newValue=n,this._graphicsView.graphicUpdateHandler(w)}_processHighlight(){let e=this._getHighlights();this._graphicsView?.setHighlight(e)}};s([t()],O.prototype,`_routeItems`,null),s([t()],O.prototype,`_interaction`,void 0),s([t()],O.prototype,`interactive`,void 0),s([t({readOnly:!0})],O.prototype,`selectedNetworkFeatures`,null),O=s([r(`esri.views.2d.layers.RouteLayerView2D`)],O);var k=O;export{k as default};