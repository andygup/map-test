import{$S as e,$T as t,CD as n,CE as r,Hm as i,Jf as a,KC as o,Ka as s,Lm as c,Ls as l,NE as u,Ns as d,Rm as f,Vm as p,Wm as m,XS as h,YC as g,Zf as _,Zw as v,qC as y,vE as b,zC as x}from"./index-BN8X5Ryz.js";import{t as S}from"./quatf64-D37SEdPg.js";import{c as C}from"./quat-C8PgLo31.js";import{E as w,F as T,H as E,P as D,a as O,b as ee,c as te,d as k,f as ne,i as A,l as j,n as M,u as N,x as P,y as F}from"./BufferView-BW77W5ev.js";import{i as I,n as L,r as re,t as ie}from"./resourceUtils-BhD6CfOV.js";function R(e,t){let n=e.count;t||=new e.TypedArrayConstructor(n);for(let r=0;r<n;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,makeDense:R},Symbol.toStringTag,{value:`Module`}));function z(e={}){return{color:[1,1,1],opacity:1,alphaMode:`OPAQUE`,alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclusion:!0,colorTexture:null,normalTexture:null,occlusionTexture:null,emissiveTexture:null,emissiveStrengthKHR:null,metallicRoughnessTexture:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:`multiply`,...e}}function B(e,t={}){return{data:e,parameters:{wrap:{s:10497,t:10497,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}var V;function H(){return V??=(async()=>{let{default:t}=await e(async()=>{let{default:e}=await import(`./draco_mesh_decoder-MnmKzGfN.js`);return{default:e}},[]);return await t({locateFile:e=>h(`esri/libs/dracoMeshDecoder/${e}`)})})(),V}var U=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){let e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){let t=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,t,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}},W={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},G={pbrMetallicRoughness:W,emissiveFactor:[0,0,0],alphaMode:`OPAQUE`,alphaCutoff:.5,doubleSided:!1},K={ESRI_externalColorMixMode:`tint`,ESRI_receiveShadows:!0,ESRI_receiveAmbientOcclusion:!0},q=(e={})=>{let t={...W,...e.pbrMetallicRoughness},n=J({...K,...e.extras});return{...G,...e,pbrMetallicRoughness:t,extras:n}};function J(e){switch(e.ESRI_externalColorMixMode){case`multiply`:case`tint`:case`ignore`:case`replace`:break;default:n(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode=`tint`}return e}var Y={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497},ae=e=>({...Y,...e});function oe(e){let t,n;return e.replace(/^(.*\/)?([^/]*)$/,(e,r,i)=>(t=r||``,n=i||``,``)),{dirPart:t,filePart:n}}var X={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562},se=class e{constructor(e,n,r,i){if(this._context=e,this.uri=n,this.json=r,this._glbBuffer=i,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._dracoBuffersSize=0,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=[`KHR_texture_basisu`,`KHR_texture_transform`,`KHR_draco_mesh_compression`,`KHR_materials_emissive_strength`],this._baseUri=oe(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new t(`gltf-loader-unsupported-feature`,`Scenes must be defined.`);if(r.meshes==null)throw new t(`gltf-loader-unsupported-feature`,`Meshes must be defined`);if(r.nodes==null)throw new t(`gltf-loader-unsupported-feature`,`Nodes must be defined.`);this._computeNodeParents()}static async load(n,r,i){if(g(r)){let t=y(r);if(t&&t.mediaType!==`model/gltf-binary`)try{let i=JSON.parse(t.isBase64?atob(t.data):t.data);return new e(n,r,i)}catch{}let i=o(r);if(e._isGLBData(i))return this._fromGLBData(n,r,i)}if(pe.test(r)||i?.expectedType===`gltf`){let t=await n.loadJSON(r,i);return new e(n,r,t)}let a=await n.loadBinary(r,i);if(e._isGLBData(a))return this._fromGLBData(n,r,a);if(me.test(r)||i?.expectedType===`glb`)throw new t(`gltf-loader-invalid-glb`,`This is not a valid glb file.`);let s=await n.loadJSON(r,i);return new e(n,r,s)}static _isGLBData(e){if(e==null)return!1;let t=new U(e);return t.remainingBytes()>=4&&t.readUint32()===X.MAGIC}static async _fromGLBData(t,n,r){let i=await e._parseGLBData(r);return new e(t,n,i.json,i.binaryData)}static async _parseGLBData(e){let n=new U(e);if(n.remainingBytes()<12)throw new t(`gltf-loader-error`,`glb binary data is insufficiently large.`);let i=n.readUint32(),a=n.readUint32(),o=n.readUint32();if(i!==X.MAGIC)throw new t(`gltf-loader-error`,`Magic first 4 bytes do not fit to expected glb value.`);if(e.byteLength<o)throw new t(`gltf-loader-error`,`glb binary data is smaller than header specifies.`);if(a!==2)throw new t(`gltf-loader-unsupported-feature`,`An unsupported glb container version was detected. Only version 2 is supported.`);let s,c,l=0;for(;n.remainingBytes()>=8;){let e=n.readUint32(),i=n.readUint32();if(l===0){if(i!==X.CHUNK_TYPE_JSON)throw new t(`gltf-loader-error`,`First glb chunk must be JSON.`);if(e<0)throw new t(`gltf-loader-error`,`No JSON data found.`);s=await L(n.readUint8Array(e))}else if(l===1){if(i!==X.CHUNK_TYPE_BIN)throw new t(`gltf-loader-unsupported-feature`,`Second glb chunk expected to be BIN.`);c=n.readUint8Array(e)}else r.getLogger(`esri.views.3d.glTF`).warn(`[Unsupported Feature] More than 2 glb chunks detected. Skipping.`);l+=1}if(!s)throw new t(`gltf-loader-error`,`No glb JSON chunk detected.`);return{json:s,binaryData:c}}async getBuffer(e,n){let r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new t(`gltf-loader-error`,`glb buffer not present`);return this._glbBuffer}let i=await this._getBufferLoader(e,n);if(i.byteLength!==r.byteLength)throw new t(`gltf-loader-error`,`Buffer byte lengths should match.`);return i}async _getBufferLoader(e,t){let n=this._bufferLoaders.get(e);if(n)return n;let r=this.json.buffers[e].uri,i=this._context.loadBinary(this._resolveUri(r),t).then(e=>new Uint8Array(e));return this._bufferLoaders.set(e,i),i}_validateAccessor(e){if(!this.json.accessors)throw new t(`gltf-loader-unsupported-feature`,`Accessors missing.`);let n=this.json.accessors[e];if(n.type in[`MAT2`,`MAT3`,`MAT4`])throw new t(`gltf-loader-unsupported-feature`,`AttributeType ${n.type} is not supported`);return n}_getComponentInfo(e,t){let n=ue[e.type],r=t?.componentType||e.componentType,i=de[r];return{componentType:r,componentCount:n,componentByteSize:i,denseByteStride:n*i}}getDracoAccessor(e,t){let n=this._validateAccessor(e),r=t.accessorInfos.get(e),{componentType:i,componentCount:a,componentByteSize:o,denseByteStride:s}=this._getComponentInfo(n,r);return{raw:t.data.buffer,byteStride:s,byteOffset:t.data.byteOffset+(r?.byteOffset||0),entryCount:r?.count??n.count,isDenselyPacked:!0,componentCount:a,componentByteSize:o,componentType:i,min:n.min,max:n.max,normalized:!!n.normalized}}async getAccessor(e,n){let r=this._validateAccessor(e);if(r?.bufferView==null)throw new t(`gltf-loader-unsupported-feature`,`Some accessor does not specify a bufferView.`);let{componentCount:i,componentByteSize:a,denseByteStride:o}=this._getComponentInfo(r),s=this.json.bufferViews[r.bufferView],c=await this.getBuffer(s.buffer,n),l=s.byteStride||o;return{raw:c.buffer,byteStride:l,byteOffset:c.byteOffset+(s.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:l===o,componentCount:i,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,t,n){if(e.indices==null)return;let r=e.indices,i=n?this.getDracoAccessor(r,n):await this.getAccessor(r,t);if(i.isDenselyPacked)switch(i.componentType){case d.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case d.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case d.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case d.UNSIGNED_BYTE:return R(Q(ee,i));case d.UNSIGNED_SHORT:return R(Q(A,i));case d.UNSIGNED_INT:return R(Q(k,i))}}async getPositionData(e,n,r){if(e.attributes.POSITION==null)throw new t(`gltf-loader-unsupported-feature`,`No POSITION vertex data found.`);let i=e.attributes.POSITION,a=r?this.getDracoAccessor(i,r):await this.getAccessor(i,n);if(a.componentType!==d.FLOAT)throw new t(`gltf-loader-unsupported-feature`,`Expected type FLOAT for POSITION vertex attribute, but found `+u(d,a.componentType));if(a.componentCount!==3)throw new t(`gltf-loader-unsupported-feature`,`POSITION vertex attribute must have 3 components, but found `+a.componentCount.toFixed());return Q(P,a)}async getNormalData(e,n,r){if(e.attributes.NORMAL==null)throw new t(`gltf-loader-error`,`No NORMAL vertex data found.`);let i=e.attributes.NORMAL,a=r?this.getDracoAccessor(i,r):await this.getAccessor(i,n);if(a.componentType!==d.FLOAT)throw new t(`gltf-loader-unsupported-feature`,`Expected type FLOAT for NORMAL vertex attribute, but found `+u(d,a.componentType));if(a.componentCount!==3)throw new t(`gltf-loader-unsupported-feature`,`NORMAL vertex attribute must have 3 components, but found `+a.componentCount.toFixed());return Q(P,a)}async getTangentData(e,n,r){if(e.attributes.TANGENT==null)throw new t(`gltf-loader-error`,`No TANGENT vertex data found.`);let i=e.attributes.TANGENT,a=r?this.getDracoAccessor(i,r):await this.getAccessor(i,n);if(a.componentType!==d.FLOAT)throw new t(`gltf-loader-unsupported-feature`,`Expected type FLOAT for TANGENT vertex attribute, but found `+u(d,a.componentType));if(a.componentCount!==4)throw new t(`gltf-loader-unsupported-feature`,`TANGENT vertex attribute must have 4 components, but found `+a.componentCount.toFixed());return Q(N,a)}async getTextureCoordinates(e,n,r){if(e.attributes.TEXCOORD_0==null)throw new t(`gltf-loader-error`,`No TEXCOORD_0 vertex data found.`);let i=e.attributes.TEXCOORD_0,a=r?this.getDracoAccessor(i,r):await this.getAccessor(i,n);if(a.componentCount!==2)throw new t(`gltf-loader-unsupported-feature`,`TEXCOORD_0 vertex attribute must have 2 components, but found `+a.componentCount.toFixed());if(a.componentType===d.FLOAT)return Q(M,a);if(!a.normalized)throw new t(`gltf-loader-unsupported-feature`,`Integer component types are only supported for a normalized accessor for TEXCOORD_0.`);return fe(a)}async getVertexColors(e,n,r){if(e.attributes.COLOR_0==null)throw new t(`gltf-loader-error`,`No COLOR_0 vertex data found.`);let i=e.attributes.COLOR_0,a=r?this.getDracoAccessor(i,r):await this.getAccessor(i,n);if(a.componentCount!==4&&a.componentCount!==3)throw new t(`gltf-loader-unsupported-feature`,`COLOR_0 attribute must have 3 or 4 components, but found `+a.componentCount.toFixed());if(a.componentCount===4){if(a.componentType===d.FLOAT)return Q(N,a);if(a.componentType===d.UNSIGNED_BYTE)return Q(E,a);if(a.componentType===d.UNSIGNED_SHORT)return Q(j,a)}else if(a.componentCount===3){if(a.componentType===d.FLOAT)return Q(P,a);if(a.componentType===d.UNSIGNED_BYTE)return Q(T,a);if(a.componentType===d.UNSIGNED_SHORT)return Q(te,a)}throw new t(`gltf-loader-unsupported-feature`,`Unsupported component type for COLOR_0 attribute: `+u(d,a.componentType))}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,t,n,r){let i=e.material?this._materialCache.get(e.material):void 0;if(!i){let a=e.material==null?q():q(this.json.materials[e.material]),o=a.pbrMetallicRoughness,s=this.hasVertexColors(e),c=this.getTexture(o.baseColorTexture,t),l=this.getTexture(a.normalTexture,t),u=n?this.getTexture(a.occlusionTexture,t):void 0,d=r?this.getTexture(a.emissiveTexture,t):void 0,f=n?this.getTexture(o.metallicRoughnessTexture,t):void 0,p=e.material==null?-1:e.material;i={alphaMode:a.alphaMode,alphaCutoff:a.alphaCutoff,color:o.baseColorFactor,doubleSided:!!a.doubleSided,colorTexture:await c,normalTexture:await l,name:a.name,id:p,occlusionTexture:await u,emissiveTexture:await d,emissiveFactor:a.emissiveFactor,emissiveStrengthKHR:a.extensions?.KHR_materials_emissive_strength?.emissiveStrength,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await f,hasVertexColors:s,ESRI_externalColorMixMode:a.extras.ESRI_externalColorMixMode,colorTextureTransform:o?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:a.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:a.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:a.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:o?.metallicRoughnessTexture?.extensions?.KHR_texture_transform,receiveAmbientOcclusion:a.extras.ESRI_receiveAmbientOcclusion,receiveShadows:a.extras.ESRI_receiveShadows}}return i}async decode(e,n){let r=e.extensions?.KHR_draco_mesh_compression;if(!r)return;if(e.indices==null)throw new t(`gltf-loader-error`,`Found Draco compressed primitive without indices.`);let i=this.json.bufferViews[r.bufferView],a=await this.getBuffer(i.buffer,n),o=(await H()).decode(new Uint8Array(a.buffer,a.byteOffset+(i.byteOffset||0),i.byteLength));this._bufferLoaders.delete(i.buffer);let s=new Map([[e.indices,o.indices],[e.attributes.POSITION,o.positions]]);return e.attributes.TEXCOORD_0&&s.set(e.attributes.TEXCOORD_0,o.uvs),e.attributes.NORMAL&&s.set(e.attributes.NORMAL,o.normals),e.attributes.COLOR_0&&s.set(e.attributes.COLOR_0,o.colors),e.attributes.TANGENT&&s.set(e.attributes.TANGENT,o.tangents),this._dracoBuffersSize+=o.buffer.byteLength,{data:o.buffer,accessorInfos:s}}async getTexture(e,n){if(!e)return;if((e.texCoord||0)!==0)throw new t(`gltf-loader-unsupported-feature`,`Only TEXCOORD with index 0 is supported.`);let r=e.index,i=this.json.textures[r],a=ae(i.sampler==null?{}:this.json.samplers[i.sampler]),o=$(i),s=this.json.images[o],c=await this._loadTextureImageData(r,i,n);return b(this._textureCache,r,()=>{let e=e=>e===33071||e===33648||e===10497,n=e=>{throw new t(`gltf-loader-error`,`Unexpected TextureSampler WrapMode: ${e}`)};return{data:c,wrapS:e(a.wrapS)?a.wrapS:n(a.wrapS),wrapT:e(a.wrapT)?a.wrapT:n(a.wrapT),minFilter:a.minFilter,name:s.name,id:r}})}getNodeTransform(e){if(e===void 0)return ce;let t=this._nodeTransformCache.get(e);if(!t){let n=this.getNodeTransform(this._getNodeParent(e)),r=this.json.nodes[e];r.matrix?t=f(a(),n,r.matrix):r.translation||r.rotation||r.scale?(t=_(n),r.translation&&m(t,t,r.translation),r.rotation&&(Z[3]=C(Z,r.rotation),c(t,t,Z[3],Z)),r.scale&&p(t,t,r.scale)):t=_(n),this._nodeTransformCache.set(e,t)}return t}_resolveUri(e){return x(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){let e=s.parse(this.json.asset.version,`glTF`);le.validate(e)}_checkRequiredExtensionsSupported(){let e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(e=>this._supportedExtensions.includes(e)))throw new t(`gltf-loader-unsupported-feature`,`gltf loader was not able to load unsupported feature. Required extensions: `+e.extensionsRequired.join(`, `))}_computeNodeParents(){this.json.nodes.forEach((e,t)=>{e.children&&e.children.forEach(e=>{this._nodeParentMap.set(e,t)})})}async _loadTextureImageData(e,t,n){let r=this._textureLoaders.get(e);if(r)return r;let i=this._createTextureLoader(t,n);return this._textureLoaders.set(e,i),i}async _createTextureLoader(e,n){let r=$(e),i=this.json.images[r];if(i.uri){if(i.uri.endsWith(`.ktx2`)){let e=await this._context.loadBinary(this._resolveUri(i.uri),n);return new ie(new Uint8Array(e))}return this._context.loadImage(this._resolveUri(i.uri),n)}if(i.bufferView==null)throw new t(`gltf-loader-unsupported-feature`,`Image bufferView must be defined.`);if(i.mimeType==null)throw new t(`gltf-loader-unsupported-feature`,`Image mimeType must be defined.`);let a=this.json.bufferViews[i.bufferView],o=await this.getBuffer(a.buffer,n);if(a.byteStride!=null)throw new t(`gltf-loader-unsupported-feature`,`byteStride not supported for image buffer`);let s=o.byteOffset+(a.byteOffset||0);return re(new Uint8Array(o.buffer,s,a.byteLength),i.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;let e=await v(Array.from(this._bufferLoaders.values())),t=await v(Array.from(this._textureLoaders.values()));return e.reduce((e,t)=>e+(t?.byteLength??0),0)+this._dracoBuffersSize+t.reduce((e,t)=>e+(t?I(t)?t.data.byteLength:t.width*t.height*4:0),0)}},ce=i(a(),Math.PI/2),le=new s(2,0,`glTF`),Z=S(),ue={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},de={[d.BYTE]:1,[d.UNSIGNED_BYTE]:1,[d.SHORT]:2,[d.UNSIGNED_SHORT]:2,[d.HALF_FLOAT]:2,[d.FLOAT]:4,[d.INT]:4,[d.UNSIGNED_INT]:4};function fe(e){switch(e.componentType){case d.BYTE:return new F(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case d.UNSIGNED_BYTE:return new D(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case d.SHORT:return new w(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case d.UNSIGNED_SHORT:return new O(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case d.UNSIGNED_INT:return new ne(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case d.FLOAT:return new M(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)}}function Q(e,t){return new e(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*(t.entryCount-1)+t.componentByteSize*t.componentCount)}function $(e){if(e.extensions?.KHR_texture_basisu!=null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new t(`gltf-loader-unsupported-feature`,`Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.`)}var pe=/\.gltf$/i,me=/\.glb$/i,he=0;async function ge(e,t,n={},i=!0,a=!0){let o=await se.load(e,t,n),s=`gltf_`+ he++,c={lods:[],materials:new Map,textures:new Map,meta:_e(o)},d=!(!o.json.asset.extras||o.json.asset.extras.ESRI_type!==`symbolResource`),f=o.json.asset.extras?.ESRI_webstyleSymbol?.webstyle,p=new Map,m=!1;await ve(o,async(e,t,d,f)=>{let h=p.get(d)??0;p.set(d,h+1);let g=e.mode===void 0?l.TRIANGLES:e.mode,v=g===l.TRIANGLES||g===l.TRIANGLE_STRIP||g===l.TRIANGLE_FAN?g:null;if(v==null)return void r.getLogger(`esri.views.3d.glTF`).warn(`[Unsupported Feature] Unsupported primitive mode (`+u(l,g)+`). Skipping primitive.`);if(!o.hasPositions(e))return void r.getLogger(`esri.views.3d.glTF`).warn(`Skipping primitive without POSITION vertex attribute.`);let y=await o.decode(e,n);m||=!!y;let b=o.getPositionData(e,n,y),x=o.getMaterial(e,n,i,a),S=o.hasNormals(e)?o.getNormalData(e,n,y):null,C=o.hasTangents(e)?o.getTangentData(e,n,y):null,w=o.hasTextureCoordinates(e)?o.getTextureCoordinates(e,n,y):null,T=o.hasVertexColors(e)?o.getVertexColors(e,n,y):null,E=o.getIndexData(e,n,y),D={name:f,transform:_(t),attributes:{position:await b,normal:S?await S:null,texCoord0:w?await w:null,color:T?await T:null,tangent:C?await C:null},indices:await E,primitiveType:v,material:be(c,await x,s)},O=null;c.meta?.ESRI_lod!=null&&c.meta.ESRI_lod.metric===`screenSpaceRadius`&&(O=c.meta.ESRI_lod.thresholds[d]),c.lods[d]=c.lods[d]||{parts:[],name:f,lodThreshold:O},c.lods[d].parts[h]=D});for(let e of c.lods)e.parts=e.parts.filter(e=>!!e);let h=await o.getLoadedBuffersSize();return{model:c,meta:{isEsriSymbolResource:d,uri:o.uri,ESRI_webstyle:f,isDracoDecompressed:m},customMeta:{},usedMemory:h}}function _e(e){let t=e.json,n=null;return t.nodes.forEach(e=>{let t=e.extras;t!=null&&(t.ESRI_proxyEllipsoid||t.ESRI_lod)&&(n=t)}),n}async function ve(e,t){let n=e.json,i=n.scenes[n.scene||0].nodes,a=i.length>1,o=[];for(let e of i){let t=n.nodes[e];o.push(s(e,0)),ye(t)&&!a&&t.extensions.MSFT_lod.ids.forEach((e,t)=>s(e,t+1))}async function s(i,a){let c=n.nodes[i],l=e.getNodeTransform(i);if(c.weights!=null&&r.getLogger(`esri.views.3d.glTF`).warn(`[Unsupported Feature] Morph targets are not supported.`),c.mesh!=null){let e=n.meshes[c.mesh];for(let n of e.primitives)o.push(t(n,l,a,e.name))}for(let e of c.children||[])o.push(s(e,a))}await Promise.all(o)}function ye(e){return e.extensions?.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function be(e,t,n){let r=t=>{let r=`${n}_tex_${t&&t.id}${t?.name?`_`+t.name:``}`;if(t&&!e.textures.has(r)){let n=B(t.data,{wrap:{s:t.wrapS,t:t.wrapT},mipmap:xe.has(t.minFilter),noUnpackFlip:!0});e.textures.set(r,n)}return r},i=`${n}_mat_${t.id}_${t.name}`;if(!e.materials.has(i)){let n=z({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,colorTexture:t.colorTexture?r(t.colorTexture):void 0,normalTexture:t.normalTexture?r(t.normalTexture):void 0,occlusionTexture:t.occlusionTexture?r(t.occlusionTexture):void 0,emissiveTexture:t.emissiveTexture?r(t.emissiveTexture):void 0,metallicRoughnessTexture:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],emissiveStrengthKHR:t.emissiveStrengthKHR,colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor,receiveShadows:t.receiveShadows,receiveAmbientOcclusion:t.receiveAmbientOcclusion});e.materials.set(i,n)}return i}var xe=new Set([9987,9985]);export{ge as t};