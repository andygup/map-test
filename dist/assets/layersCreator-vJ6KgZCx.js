import{ED as e,Kh as t,hv as n,v as r}from"./index-BN8X5Ryz.js";import{u as i}from"./loadUtils-DEZa3oNR.js";import{t as a}from"./lazyLayerLoader-CkIeKrgl.js";import{n as o}from"./portalLayers-C3ZU9qxp.js";function s(e){return u(e,`notes`)}function c(e){return u(e,`markup`)}function l(e){return u(e,`route`)}function u(e,t){return!(!e.layerType||e.layerType!==`ArcGISFeatureLayer`)&&e.featureCollectionType===t}async function d(e,t,n){if(!t)return;let r=t.map(e=>C(e,n)),i=await Promise.allSettled(r);for(let t of i)t.status===`rejected`||t.value&&e.add(t.value)}var f={ArcGISDimensionLayer:`DimensionLayer`,ArcGISFeatureLayer:`FeatureLayer`,ArcGISImageServiceLayer:`ImageryLayer`,ArcGISMapServiceLayer:`MapImageLayer`,ArcGISSceneServiceLayer:`SceneLayer`,ArcGISTiledElevationServiceLayer:`ElevationLayer`,ArcGISTiledImageServiceLayer:`ImageryTileLayer`,ArcGISTiledMapServiceLayer:`TileLayer`,BuildingSceneLayer:`BuildingSceneLayer`,CatalogLayer:`CatalogLayer`,CSV:`CSVLayer`,DefaultTileLayer:`TileLayer`,GaussianSplatLayer:`GaussianSplatLayer`,GeoJSON:`GeoJSONLayer`,GroupLayer:`GroupLayer`,IntegratedMesh3DTilesLayer:`IntegratedMesh3DTilesLayer`,Object3DTilesLayer:`UnsupportedLayer`,IntegratedMeshLayer:`IntegratedMeshLayer`,KML:`KMLLayer`,LineOfSightLayer:`LineOfSightLayer`,MediaLayer:`MediaLayer`,OGCFeatureLayer:`OGCFeatureLayer`,OrientedImageryLayer:`OrientedImageryLayer`,PointCloudLayer:`PointCloudLayer`,RasterDataLayer:`UnsupportedLayer`,VectorTileLayer:`VectorTileLayer`,ViewshedLayer:`ViewshedLayer`,Voxel:`VoxelLayer`,WCS:`WCSLayer`,WFS:`WFSLayer`,WMS:`WMSLayer`,WebTiledLayer:`WebTileLayer`},p={ArcGISTiledElevationServiceLayer:`ElevationLayer`,DefaultTileLayer:`ElevationLayer`,RasterDataElevationLayer:`UnsupportedLayer`},m={ArcGISFeatureLayer:`FeatureLayer`},h={ArcGISImageServiceLayer:`UnsupportedLayer`,ArcGISMapServiceLayer:`UnsupportedLayer`,ArcGISSceneServiceLayer:`SceneLayer`,ArcGISTiledImageServiceLayer:`ImageryTileLayer`,ArcGISTiledMapServiceLayer:`TileLayer`,DefaultTileLayer:`TileLayer`,OpenStreetMap:`OpenStreetMapLayer`,VectorTileLayer:`VectorTileLayer`,WCS:`UnsupportedLayer`,WMS:`UnsupportedLayer`,WebTiledLayer:`WebTileLayer`},g={IntegratedMesh3DTilesLayer:`IntegratedMesh3DTilesLayer`},_={ArcGISAnnotationLayer:`UnsupportedLayer`,ArcGISDimensionLayer:`UnsupportedLayer`,ArcGISFeatureLayer:`FeatureLayer`,ArcGISImageServiceLayer:`ImageryLayer`,ArcGISImageServiceVectorLayer:`ImageryLayer`,ArcGISMapServiceLayer:`MapImageLayer`,ArcGISStreamLayer:`StreamLayer`,ArcGISTiledImageServiceLayer:`ImageryTileLayer`,ArcGISTiledMapServiceLayer:`TileLayer`,ArcGISVideoLayer:`VideoLayer`,BingMapsAerial:`BingMapsLayer`,BingMapsHybrid:`BingMapsLayer`,BingMapsRoad:`BingMapsLayer`,CatalogLayer:`CatalogLayer`,CSV:`CSVLayer`,DefaultTileLayer:`TileLayer`,GeoJSON:`GeoJSONLayer`,GeoRSS:`GeoRSSLayer`,GroupLayer:`GroupLayer`,KML:`KMLLayer`,KnowledgeGraphLayer:`KnowledgeGraphLayer`,MediaLayer:`MediaLayer`,OGCFeatureLayer:`OGCFeatureLayer`,OrientedImageryLayer:`OrientedImageryLayer`,get ParquetLayer(){return e(`parquetlayer-persistence-enabled`)?`ParquetLayer`:`UnsupportedLayer`},SubtypeGroupLayer:`SubtypeGroupLayer`,VectorTileLayer:`VectorTileLayer`,WCS:`WCSLayer`,WFS:`WFSLayer`,WMS:`WMSLayer`,WebTiledLayer:`WebTileLayer`},v={ArcGISFeatureLayer:`FeatureLayer`,SubtypeGroupTable:`SubtypeGroupLayer`},y={ArcGISImageServiceLayer:`ImageryLayer`,ArcGISImageServiceVectorLayer:`ImageryLayer`,ArcGISMapServiceLayer:`MapImageLayer`,ArcGISTiledImageServiceLayer:`ImageryTileLayer`,ArcGISTiledMapServiceLayer:`TileLayer`,BingMapsAerial:`BingMapsLayer`,BingMapsHybrid:`BingMapsLayer`,BingMapsRoad:`BingMapsLayer`,DefaultTileLayer:`TileLayer`,OpenStreetMap:`OpenStreetMapLayer`,VectorTileLayer:`VectorTileLayer`,WCS:`WCSLayer`,WMS:`WMSLayer`,WebTiledLayer:`WebTileLayer`},b={..._,LinkChartLayer:`LinkChartLayer`},x={...v},S={...y};async function C(e,t){return w(await T(e,t),e,t)}async function w(e,t,n){let i=new e;return i.read(t,n.context),i.type===`group`&&(t.layerType===`GroupLayer`?await k(i,t,n):D(t)?A(i,t,n.context):E(t)&&await j(i,t,n.context)),await r(i,n.context),i}async function T(e,n){let r=n.context,u=O(r),d=e.layerType||e.type;!d&&n?.defaultLayerType&&(d=n.defaultLayerType);let f=u[d],p=f?a[f]:a.UnknownLayer;if(D(e)){let n=r?.portal;if(e.itemId){let r=new t({id:e.itemId,portal:n});await r.load();let s=(await o(r,new i)).className||`UnknownLayer`;p=a[s]}}else d===`ArcGISFeatureLayer`?s(e)||c(e)?p=a.MapNotesLayer:l(e)?p=a.RouteLayer:E(e)&&(p=a.GroupLayer):e.wmtsInfo?.url&&e.wmtsInfo.layerIdentifier?p=a.WMTSLayer:d===`WFS`&&e.wfsInfo?.version!==`2.0.0`&&(p=a.UnsupportedLayer);return p()}function E(e){return e.layerType!==`ArcGISFeatureLayer`||D(e)?!1:(e.featureCollection?.layers?.length??0)>1}function D(e){return e.type===`Feature Collection`}function O(e){let t;switch(e.origin){case`web-scene`:switch(e.layerContainerType){case`basemap-base-layers`:t=h;break;case`basemap-ground-layers`:t=g;break;case`ground`:t=p;break;case`tables`:t=m;break;default:t=f}break;case`link-chart`:switch(e.layerContainerType){case`basemap-base-layers`:t=S;break;case`tables`:t=x;break;default:t=b}break;default:switch(e.layerContainerType){case`basemap-base-layers`:t=y;break;case`tables`:t=v;break;default:t=_}}return t}async function k(e,t,r){let i=new n,a=d(i,Array.isArray(t.layers)?t.layers:[],r);try{try{if(await a,e.type===`group`)return e.layers.addMany(i),e}catch(t){e.destroy();for(let e of i)e.destroy();throw t}}catch(e){throw e}}function A(e,n,r){n.itemId&&(e.portalItem=new t({id:n.itemId,portal:r?.portal}),e.when(()=>{let t=t=>{let i=t.layerId;M(t,e,n,i,r);let a=n.featureCollection?.layers?.[i];a&&t.read(a,r)};e.layers?.forEach(t),e.tables?.forEach(t)}))}async function j(e,t,n){let r=a.FeatureLayer,i=await r(),o=t.featureCollection,s=o?.showLegend,c=o?.layers?.map((r,a)=>{let o=new i;o.read(r,n);let c={...n,ignoreDefaults:!0};return M(o,e,t,a,c),s!=null&&o.read({showLegend:s},c),o});e.layers.addMany(c??[])}function M(e,t,n,r,i){e.read({id:`${t.id}-sublayer-${r}`,visibility:n.visibleLayers?.includes(r)??!0},i)}export{d as n,k as t};