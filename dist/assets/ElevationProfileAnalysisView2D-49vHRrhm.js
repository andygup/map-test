const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lengthOperator-C_T6gV46.js","assets/SpatialReference-HLIf1Z5k.js","assets/index-CZ4oMP1N.js","assets/index-CDgdHpAj.css","assets/Envelope2D-Cwxt0azx.js","assets/Point2D-7VmvyXN4.js","assets/OperatorDefinitions-CscAnk1m.js","assets/SimpleGeometryCursor-5wFw2ZZo.js","assets/Transformation2D-CPSmiNnd.js","assets/lengthOperator-DHlVc34D.js","assets/apiConverter-BH2GqpH4.js","assets/jsonConverter-CbeIyOFG.js","assets/OptimizedGeometry-hOUTi-cB.js","assets/memoryEstimations-DQOvnrRz.js"])))=>i.map(i=>d[i]);
import{Ag as e,An as t,BS as n,BT as r,Bx as i,CE as a,DT as o,Fg as s,Gf as c,Gh as l,Gw as u,JE as d,Jw as f,Jx as p,Kw as m,Nx as h,OT as g,Ov as _,Ox as v,QC as y,Q_ as b,Qc as ee,Qw as x,Rv as te,Sb as S,Sg as C,UT as w,Vl as T,WT as E,XT as ne,Z_ as re,Zu as ie,Zv as ae,_w as D,bS as oe,dg as se,eT as O,fT as ce,gD as k,hT as le,hw as ue,iv as de,jd as fe,kx as pe,lw as me,mb as he,nD as ge,nh as _e,nv as A,pg as ve,px as ye,qE as be,rT as j,rv as M,sl as xe,vT as N,vd as Se,wx as Ce,zi as we}from"./index-CZ4oMP1N.js";import"./memoryEstimations-DQOvnrRz.js";import"./OptimizedGeometry-hOUTi-cB.js";import"./Point2D-7VmvyXN4.js";import"./Envelope2D-Cwxt0azx.js";import"./SpatialReference-HLIf1Z5k.js";import"./Transformation2D-CPSmiNnd.js";import"./SimpleGeometryCursor-5wFw2ZZo.js";import"./OperatorDefinitions-CscAnk1m.js";import"./jsonConverter-CbeIyOFG.js";import"./apiConverter-BH2GqpH4.js";import"./geodeticCurveType-DoJa853C.js";import"./geodeticAreaOperator-CbAaN6Nl.js";import"./geodeticLengthOperator-CWQiiddx.js";import"./Distance2DCalculator-CXhBP-8I-CqzpU8vR.js";import"./distanceOperator-CYf0gmY_.js";import"./operatorSimplify-CKtdefMF.js";import"./simplifyOperator-CdQI_hSF.js";import"./quatf64-BJJPhW0N.js";import"./quat-BszBv_-H.js";import"./earcut-BF1-mB58.js";import"./plane-Bg1a5O73.js";import"./vectorStacks-FfDNcZoS.js";import"./projectPointToVector-HYpbaZqA.js";import"./spatialReferenceEllipsoidUtils-B0E4spY0.js";import"./dehydratedPoint-rdg1UAtQ.js";import"./projectVectorToVector-DX3Yd1qf.js";import{t as Te}from"./memoize-BNsZjv91.js";import{d as Ee,m as De}from"./elevationInfoUtils-9csVBlEH.js";import{s as Oe}from"./colorUtils-DJOs5VE1.js";import{t as ke}from"./GraphicsLayer-Bx8Nz7ax.js";import"./ObjectStack-CBI5g-Qc.js";import"./ray-CWXoVP-g.js";import{t as Ae}from"./GeometryDescriptor-CAI-CJtE.js";import{t as je}from"./getDefaultUnitForView-BwZf47ZU.js";import{n as Me,t as Ne}from"./ExclusiveOperationManager-CKK1qF1W.js";import"./quantity-CPor8qMe.js";import{a as Pe,i as Fe,o as Ie,s as Le}from"./geodesicUtils-CbiJFASl.js";import{n as Re,r as ze,t as Be}from"./SketchViewModel-NAjbn0Ca.js";import"./isSupportedObject-Ccal0viz.js";import"./layerUtils-VowzydxH.js";import"./SketchOptions-Dp8M5XoK.js";import"./LineSnappingHint-BOeMI0cS.js";import{n as Ve}from"./ParallelSnappingHint-C_mSlwpq.js";import"./snappingUtils-Od8uWW_a.js";import"./vec3-zq4-AU_O.js";import"./sphere-9YfqUkuX.js";import"./constraints-Bf0IRs4G.js";import"./SnappingCandidate-B4WtOFZq.js";import"./EdgeSnappingCandidate-BfgKjc_Z.js";import"./DrapedEdgeSnappingCandidate-BWx5lQgf.js";import"./IntersectionSnappingHint-CdcMZxUs.js";import"./IntersectionSnappingCandidate-b5Urq9uN.js";import"./LineSnappingCandidate-BsncFUer.js";import"./RightAngleTriangleSnappingCandidate-CRITbc5W.js";import"./RightAngleSnappingHint-BXbBqf-p.js";import"./viewUtils-D9SUkhqu.js";import"./viewUtils-BwKx9qtR.js";import"./euclideanLengthMeasurementUtils-C9WB-wbk.js";import"./lineSegment-BJ2rgalW.js";import"./triangle-_uWz9WdI.js";import"./hitTestSelectUtils-DQf3EOGe.js";import{t as P}from"./mapCollectionUtils-_kTr84uj.js";import{t as He}from"./throttle-LYImypwQ.js";import{a as Ue}from"./createUtils-BdtfcpTy.js";function We(e){return ne([A(()=>{let{analysis:t,sketchGraphic:n,toolState:r,visible:i}=e.analysisViewData,{geometryVisualizationVisible:a}=t.viewOptions;return{geometryVisualizationVisible:a,geometry:t.geometry,sketchGraphic:n,toolState:r,visible:i}},({geometryVisualizationVisible:t,sketchGraphic:n,toolState:r,visible:i})=>{if(e.remove(),i)return t&&n!=null&&r!==`reshaping`&&r!==`sketching`?e.show(n):void 0},M)])}var F=class extends D{constructor(e){super(e)}initialize(){this.addHandles(We({analysisViewData:this.analysisViewData,remove:()=>{},show:()=>{}}))}get updating(){return!1}};k([o({constructOnly:!0})],F.prototype,`view`,void 0),k([o({constructOnly:!0})],F.prototype,`analysisViewData`,void 0),k([o()],F.prototype,`updating`,null),F=k([g(`esri.views.2d.analysis.ElevationProfile.ElevationProfileInputVisualization2D`)],F);var Ge={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:Ge.noDataValue,demResolution:`auto`,maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:h(10,`centimeters`,`meters`),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:`solid`,borderWidth:3,borderColor:`#ffffff`,boxShadow:`0px 0px 0px 5px rgba(255,255,255,0.2)`}};function I(){return Ge}var L=class extends D{constructor(e){super(e),this.visible=!1,this._element=Ke()}initialize(){this.view.surface?.appendChild(this._element),this.addHandles([A(()=>this.visible&&!!this._screenPoint,e=>{this._element.style.display=e?`block`:`none`},M),A(()=>({color:this.line.color.toCss(),zIndex:this._zIndex}),({color:e,zIndex:t})=>{Object.assign(this._element.style,{background:e,zIndex:t.toString()})},M),A(()=>this._screenPoint,e=>{e&&(this._element.style.transform=`translate(${e.x}px, ${e.y}px)`)},M)])}destroy(){this._element.remove()}get updating(){return!1}get _result(){return this.analysisViewData.results.find(e=>e.computation.profile===this.line)}get _zIndex(){let{profiles:e}=this.analysisViewData.analysis,t=e.indexOf(this.line);return e.length-(t===-1?0:t)}get _screenPoint(){let{view:e}=this;e.type===`3d`?(e.commitProperty(`size`),e.commitProperty(`camera`)):e.commitProperty(`center`);let t=e?.spatialReference,n=t?C(this._result?.hoveredPoint,t).geometry:null;return n&&e?.ready?e.toScreen(n):null}};function Ke(){let e=document.createElement(`div`),{size:t,borderStyle:n,borderColor:r,borderWidth:i,boxShadow:a}=I().hoveredPointsStyle,{style:o}=e;return o.display=`block`,o.position=`absolute`,o.top=`0`,o.left=`0`,o.contain=`strict`,o.boxSizing=`border-box`,o.width=`${t}px`,o.height=`${t}px`,o.marginTop=`-${t/2}px`,o.marginLeft=`-${t/2}px`,o.border=`${n} ${i}px ${r}`,o.borderRadius=`${t}px`,o.boxShadow=a,e}k([o()],L.prototype,`view`,void 0),k([o()],L.prototype,`analysisViewData`,void 0),k([o()],L.prototype,`line`,void 0),k([o()],L.prototype,`visible`,void 0),k([o()],L.prototype,`updating`,null),k([o()],L.prototype,`_result`,null),k([o()],L.prototype,`_zIndex`,null),k([o()],L.prototype,`_screenPoint`,null),L=k([g(`esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization`)],L);function qe(e,t){if(!e||e.length===0)return;let n=e.length-1,r=[],i=[];for(let t=0;t<=n;t++){let{x:a,y:o,z:s}=e[t];s!=null&&i.push([a,o,s]),t!==n&&s!=null||!i.length||(r.push(i),i=[])}return Ue(r,t,!0)}var R=class extends D{constructor(e){super(e),this._graphic=new Se,this._updateGeometryThrottled=He(e=>{e&&(this._graphic.geometry=qe(e.samples,e.spatialReference))},I().profileLinesUpdateThrottleMillis)}initialize(){this.addGraphic(this._graphic),this._indicatorVisualization=new L({analysisViewData:this.analysisViewData,line:this.line,view:this.view}),this.addHandles([A(()=>this._effectiveLineVisible,e=>{this._graphic.visible=e},M),A(()=>this._effectiveIndicatorVisible,e=>{this._indicatorVisualization.visible=e},M),A(()=>this._colorUpdateParameters,e=>this._updateColor(e),M),A(()=>this.analysisViewData.analysis.geometry,()=>{this._graphic.geometry=null},M),A(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),M),this._updateGeometryThrottled])}destroy(){this._graphic.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.analysisViewData.results.find(e=>e.computation.profile===this.line)}get _effectiveLineVisible(){return this.getEffectiveVisible(`lineVisible`)}get _effectiveIndicatorVisible(){let e=this.getEffectiveVisible(`hoveredPointVisible`);return this._effectiveLineVisible?e&&!!this._graphic.geometry:e}getEffectiveVisible(e){let{analysisViewData:t,_result:n}=this;return t.visible&&!!n?.available&&n.computation.profile.viewOptions[e]}get _geometryUpdateParameters(){let e={samples:this._result?.samples,spatialReference:this.view.spatialReference};return e.samples&&this._effectiveLineVisible&&this.analysisViewData.progress!==1?null:e}get _colorUpdateParameters(){let e=this._result?.computation.profile.color;return e?{color:e.toArray(),contrastColor:Oe(e).toArray()}:null}_updateColor(e){e&&(this._graphic.symbol=new c({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{type:`CIMSolidStroke`,capStyle:`Butt`,color:e.color,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[5,4],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],joinStyle:`Round`,width:1.5},{type:`CIMSolidStroke`,capStyle:`Butt`,color:e.contrastColor,joinStyle:`Round`,width:1.5}]}}}))}};k([o({constructOnly:!0})],R.prototype,`addGraphic`,void 0),k([o({constructOnly:!0})],R.prototype,`analysisViewData`,void 0),k([o({constructOnly:!0})],R.prototype,`line`,void 0),k([o({constructOnly:!0})],R.prototype,`view`,void 0),k([o()],R.prototype,`updating`,null),k([o()],R.prototype,`_result`,null),k([o()],R.prototype,`_effectiveLineVisible`,null),k([o()],R.prototype,`_effectiveIndicatorVisible`,null),k([o()],R.prototype,`_geometryUpdateParameters`,null),k([o()],R.prototype,`_colorUpdateParameters`,null),R=k([g(`esri.views.2d.analysis.ElevationProfile.ElevationProfileLineVisualization2D`)],R);var z=class extends D{constructor(e){super(e),this._graphicsLayer=new ke({listMode:`hide`,internal:!0})}initialize(){let{view:e,analysisViewData:t}=this;e.map.add(this._graphicsLayer),e.map.layers.reorder(this._graphicsLayer,0),this._inputVisualization=new F({view:e,analysisViewData:t}),this._lineVisualizations=P(()=>t.analysis.profiles,n=>new R({view:e,analysisViewData:t,line:n,addGraphic:e=>{e.attributes={index:t.analysis.profiles.indexOf(n)},this._graphicsLayer.add(e),this._graphicsLayer.graphics.sort((e,t)=>{let n=e.attributes?.index??0;return(t.attributes?.index??0)-n})}}))}destroy(){this._inputVisualization.destroy(),this._lineVisualizations.destroy(),this._graphicsLayer.graphics.drain(e=>{e.destroyed||e.destroy()}),this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get updating(){return this._inputVisualization.updating||this._lineVisualizations.some(e=>e.updating)}};k([o()],z.prototype,`view`,void 0),k([o()],z.prototype,`analysisViewData`,void 0),k([o()],z.prototype,`updating`,null),z=k([g(`esri.views.2d.analysis.ElevationProfile.ElevationProfileVisualization2D`)],z);function B(e,t){let n,r=!1;function i(...i){let a=e.apply(this,i);return r&&n!==void 0&&t?.(n,a)?n:(r=!0,n=a,a)}return i}var Je=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t)}},V=class extends r{constructor(e,t,n){super(e,t,n),this.name=`unknown`,this.name=e}},H=class extends V{constructor(){super(`too-complex`,`The input geometry has too many points.`)}},Ye=class extends V{constructor(){super(`elevation-query-error`,`Error querying elevation from provider.`)}},Xe=class extends V{constructor(){super(`unknown`,`Unknown error.`)}},U=class extends r{constructor(){super(`invalid-geometry`,`The input geometry is invalid.`)}};async function Ze(t,r,a,o,c,l,u){let d,f,p,m=t.spatialReference,h=m.isGeographic||m.isWebMercator,g=0;if(!h){let{execute:e}=await n(async()=>{let{execute:e}=await import(`./lengthOperator-C_T6gV46.js`);return{execute:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]));O(u),g=e(t,{unit:`meters`}),O(u)}let _=1/i(o);if(h){await e([{source:m,dest:o},{source:m,dest:Ce.WGS84}],u);let n=yt(t);d=Ie([n],`meters`)[0];let i=Qe(d,c);if(xt(t,d,i)>l)throw new H;let h=$e(n,r,a);({densifiedPath:f,distances:p}=ft(h,i,_)),f=s(f,o)}else{await e([{source:m,dest:o}],u),d=g;let n=Qe(d,c);if(xt(t,d,n)>l)throw new H;let i=$e(t,r,a);({densifiedPath:f,distances:p}=dt(i,n,_)),O(u),f=s(f,o)}return{densifiedPath:f,pathLength:d*_,distances:p}}function Qe(e,t){let n=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,n)}function $e(e,t,n){if(t==null)return nt(e);let r=e.spatialReference,i=t.mode,a=Ee(t,r),o=null;switch(n.type){case`2d`:o=et(e,i,a);break;case`3d`:o=tt(e,i,a,n)}return o==null?nt(e):new _({hasZ:!0,hasM:!1,spatialReference:r,paths:rt(e.paths,o)})}function et({hasZ:e},t,n){return t===`absolute-height`?e?([e,t,r])=>[e,t,r+n]:([e,t])=>[e,t,n]:null}function tt({spatialReference:e,hasZ:t},n,r,{elevationProvider:i}){let a=(t,n,r,a)=>i?.getElevation(t,n,r,e,a)??0;switch(n){case`on-the-ground`:return([e,t])=>[e,t,a(e,t,0,`ground`)];case`absolute-height`:return t?([e,t,n])=>[e,t,n+r]:([e,t])=>[e,t,r];case`relative-to-ground`:return t?([e,t,n])=>[e,t,n+a(e,t,n,`ground`)+r]:([e,t])=>[e,t,a(e,t,0,`ground`)+r];case`relative-to-scene`:return t?([e,t,n])=>[e,t,n+a(e,t,n,`scene`)+r]:([e,t])=>[e,t,a(e,t,0,`scene`)+r];default:return null}}function nt(e){return e.hasZ?new _({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:rt(e.paths,([e,t])=>[e,t])}):e}function rt(e,t){let n=e.length,r=Array(n);for(let i=0;i<n;++i){let n=e[i],a=n.length,o=Array(n.length);r[i]=o;for(let e=0;e<a;++e)o[e]=t(n[e])}return r}function it(e){return st(e)&&e.paths.some(e=>e.length>1)}function at(e){return ot(e)&&it(e.geometry)}function ot(e){return ct(e)&&st(e?.geometry)}function st(e){return!ct(e)&&e!=null&&e.type===`polyline`}function ct(e){return e!=null&&`geometry`in e}function lt(e){let t=e?.layer;return t!=null&&t.type===`graphics`&&t.internal}function ut(e,t,n,r,a){let{spatialReference:o,hasZ:s}=e,c={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:o,metersPerSR:i(o)},l=[],u=[],d=0;for(let i=0;i<e.paths.length;++i){let o=e.paths[i],s=[],f=[],p=0;for(let e=1;e<o.length;++e){let i=o[e-1],l=o[e],u=r(c,i,l),m;for(m=p;m<u.distance&&!y(m,u.distance);m+=t)s.push(a(u,m)),f.push((d+m)*n);p=m-u.distance,d+=u.distance,s.push(l),f.push(d*n)}l[i]=s,u[i]=f}return{densifiedPath:new _({spatialReference:o,hasZ:s,paths:l}),distances:u}}function dt(e,t,n){let{hasZ:r}=e;return ut(e,t,n,mt,r?vt:_t)}function ft(e,t,n){let{hasZ:r}=e;return ut(e,t,n,pt,r?gt:ht)}function pt(e,t,n){return e.distance=0,Pe(e,t,n,e.spatialReference),e.from=t,e.to=n,e}function mt(e,t,n){return e.from=t,e.to=n,e.distance=S(n,t)*e.metersPerSR,e}function ht({from:e,azimuth:t,spatialReference:n},r){return Fe([0,0],e,t,r,n)}function gt({from:e,to:t,azimuth:n,distance:r,spatialReference:i},a){let o=a/r,s=[0,0,me(e[2],t[2],o)];return Fe(s,e,n,a,i),s}function _t({from:e,to:t,distance:n},r){return he([0,0],e,t,r/n)}function vt({from:e,to:t,distance:n},r){return xe([0,0,0],e,t,r/n)}function yt(e){return Le(e.spatialReference)?e:s(e,Ce.WGS84)}function bt(e){return e.paths.reduce((e,t)=>e+t.length,0)}function xt(e,t,n){return bt(e)+Math.floor(t/n)+Math.max(0,e.paths.reduce(e=>1+e,0)-1)}function St(e,t){let n=e.length;if(n===0)return null;let r=e[0],a=r.sampledZ,o=a,s=a,c=0,l=0,u=null,d=null,f=a??0,m=0,g=0,_=a==null?0:1,v=0,y=0,b=i(t),ee=p(t),x=I().minSlopeSampleDistance/b,te=2*x,S=new Dt,C=new Dt,w=()=>{E(),S.copy(C),C.reset()},T=(e,t)=>{w(),e>0&&e-S.start<=te&&(e=S.start+x),C.restart(e,t)},E=()=>{if(S.isHole||C.isHole)return;let e=C.avgElevation-S.avgElevation,t=C.start-S.start,n=e*ee,r=t*b,i=h(Math.atan2(n,r),`radians`,`degrees`);i>0?(m+=i,u=W(u,i),v++):i<0&&(g-=i,d=W(d,-i),y++)};r.sampledZ!=null&&T(r.distance,r.sampledZ);for(let t=1;t<n;++t){let n=e[t-1],r=e[t],i=r.sampledZ;if(i==null){C.isHole||w();continue}_++,f+=i,o=Tt(o,i),s=W(s,i),C.isHole||r.distance-C.start>=x?T(r.distance,i):C.insert(i);let a=n.sampledZ;if(a!=null){let e=i-a;e>0?c+=e:e<0&&(l-=e)}}return w(),_===0?null:{maxDistance:e[n-1].distance,minElevation:o,maxElevation:s,avgElevation:_===0?null:f/_,elevationGain:c,elevationLoss:l,maxPositiveSlope:u,maxNegativeSlope:d,avgPositiveSlope:v===0?null:m/v,avgNegativeSlope:y===0?null:g/y}}function Ct(e){let t=e.filter(d),n=t.length;if(n===0)return null;let r=t[0];if(n===1)return r;let i=r.maxDistance,a=r.minElevation,o=r.maxElevation,s=r.maxPositiveSlope,c=r.maxNegativeSlope;for(let e=1;e<t.length;++e){let n=t[e];i=W(i,n.maxDistance),a=Tt(a,n.minElevation),o=W(o,n.maxElevation),s=W(s,n.maxPositiveSlope),c=W(c,n.maxNegativeSlope)}return{maxDistance:i,minElevation:a,maxElevation:o,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:s,maxNegativeSlope:c,avgPositiveSlope:null,avgNegativeSlope:null}}function wt(e){let t=null,n=null,r=null;for(let a of e){if(a==null)continue;let{statistics:e,spatialReference:o}=a;if(e==null)continue;let s=i(o);t=W(t,Et(e.maxDistance,s));let c=p(o);r=Tt(r,Et(e.minElevation,c)),n=W(n,Et(e.maxElevation,c))}return{minDistance:0,maxDistance:t??0,minElevation:r??0,maxElevation:n??0}}function Tt(e,t){return t==null?e:e==null?t:Math.min(e,t)}function W(e,t){return t==null?e:e==null?t:Math.max(e,t)}function Et(e,t){return e!=null&&t!=null?e*t:null}var Dt=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,t){this._start=e,this._sampleCount=1,this._totalElevation=t}insert(e){++this._sampleCount,this._totalElevation+=e}};function Ot(e,t,n=[]){if(e>=t||(n.push(e),t-e<2))return n;let r=t-1;n.push(r);let i=kt(e+1,r);for(;;){let e=i.next();if(e.done)break;n.push(e.value)}return n}function*kt(e,t){if(e>=t)return;let n=e+Math.floor((t-e)/2);yield n;let r=kt(e,n),i=kt(n+1,t);for(;;){let e=r.next(),t=i.next();if(e.done&&t.done)break;e.done||(yield e.value),t.done||(yield t.value)}}async function*At(e,t){let{view:n,geometry:r,elevationInfo:i,providers:a,options:o}=e,s=n.spatialReference;if(!s||r==null||!it(r))throw new U;let c=a.length;if(c===0)return null;let l=Math.round(o.maxTotalSamples/c);if(bt(r)>l)throw new H;let d=await Ze(r,i,n,s,o,l,t);O(t);let f=0,p=Array(c),m=Array(c);for(let n=0;n<c;n++){let r=Lt(d);p[n]=r,f+=r.samples.length;let i={...e,provider:a[n],result:r,densificationResult:d};m[n]=jt(i,t)[Symbol.iterator]()}if(f>o.maxTotalSamples)throw new H;let h=await Promise.all(m.map(e=>{let t=e.next();return!0===t.done?Promise.resolve(null):t.value}));O(t);for(let e=0;e<c;e++)p[e]=h[e];yield p,await u(e.delayAfterPreview??I().delayAfterPreviewMillis,null,t.signal),O(t);let g=[];try{let e;do{e=!1;for(let t=0;t<c;t++){let n=m[t].next();!1===n.done&&(g.push({resultPromise:n.value,index:t}),e=!0)}}while(e)}finally{m.forEach(e=>e.return?.())}for(let{resultPromise:e,index:n}of g)p[n]=await e,O(t),yield p;for(let e of p)e!=null&&(e.progress=1);yield p}function*jt(e,t){let{densificationResult:n}=e,r={...e,abortOptions:t,densificationResult:n},i=Ot(0,r.result.samples.length),a=i.slice(0,r.provider.numSamplesForPreview);yield Mt(r,a,!0);let o=be(i,r.provider.numSamplesPerChunk);for(let e of o)yield Mt(r,e,!1)}async function Mt({densificationResult:e,result:t,provider:n,queue:r,abortOptions:i,cache:a},o,s){let{densifiedPath:c,pathLength:l}=e,u=t.spatialReference,{samples:d}=t,f=[];for(let e=0;e<o.length;e++)f[e]=[...d[o[e]].coordinate];try{return await r.push({geometry:new ae({spatialReference:u,points:f,hasZ:c.hasZ}),provider:n,indices:o,preview:s,result:t,parameters:{...I().defaultQueryOptions(),minDemResolution:s?Math.round(l/n.numSamplesForPreview):Math.round(l/d.length),cache:a}},i),{...t}}catch(e){return x(e),null}}function Nt(e){return new ee({priority:T.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async e=>{O(e.parameters);try{await Pt(e)}catch(e){x(e)}}})}async function Pt({geometry:e,provider:t,indices:n,preview:r,result:i,parameters:a}){if(n.length===0)return;let o=(await Vt(t,e,a)).geometry,{hasZ:s,points:c}=o,l=a.noDataValue,{samples:u}=i;for(let e=0;e<n.length;e++){let t=u[n[e]];if(t.isHole)continue;let r=s?c[e][2]:null;r===null||r===l?t.sampledZ=null:(i.hasZ=!0,t.sampledZ=r),t.sampled=!0}Ft(u),i.progress=r?0:i.progress+n.length/u.length,i.statistics=St(i.samples,i.spatialReference)}function Ft(e){let t=e.length-1,n=0;for(let r=1;r<=t;r++)(e[r].sampled||r===t)&&(It(e,n,r),n=r)}function It(e,t,n){if(n-t===1)return;let r=e[t],i=r.sampledZ,a=e[n],o=a.sampledZ;if(i==null||o==null){for(let r=t+1;r<n;r++)e[r].sampledZ=null;return}let s=r.distance,c=a.distance-s;for(let r=t+1;r<n;r++){let t=e[r],n=(t.distance-s)/c;t.sampledZ=me(i,o,n)}}function Lt({densifiedPath:e,distances:t}){let n=e.spatialReference,r=oe(n),i=e.paths,a=i.length,o=[],s=null,c=0;for(let e=0;e<a;e++){let n=i[e],a=n.length,l=t[e];for(let e=0;e<a;e++){let t=n[e],i=l[e];r&&(t[0]=te(t[0],r.valid[0],r.valid[1])),s&&e===0&&Rt(o,s,t,c,i),o.push(zt(t,i)),s=t,c=i}}return{progress:0,samples:o,hasZ:!1,statistics:null,spatialReference:n}}function Rt(e,t,n,r,i){e.push(Bt(t,r)),e.push(Bt(n,i))}function zt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function Bt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function Vt(e,t,n){try{return await e.queryElevation(t,n)}catch{throw new Ye}}function Ht(e,t,n){if(!e||e.length===0)return;let r=e.length-1,i=e[0];if(t<=n(i))return i;let a=e[r];if(t>=n(a))return a;let o=0,s=0,c=r;for(;o<c;){s=o+Math.floor((c-o)/2);let i=e[s],a=n(i);if(a===t)return i;if(t<a){if(s>0){let r=e[s-1],o=n(r);if(t>o)return t-o>=a-t?i:r}c=s}else{if(s<r){let r=e[s+1],o=n(r);if(t<o)return t-a>=o-t?r:i}o=s+1}}return e[s]}function Ut(e){return e>.999999?1:e}var G=class extends D{constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=B(()=>{let e=wt(this._activeComputations.map(e=>e.result.rawResult)),t=this.analysis.displayUnits,n=je(this.view);return{distance:v(e.maxDistance,`meters`,t.distance??n),elevation:pe(e.maxElevation,`meters`,t.elevation??n)}},a),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=B(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),a),this._getStableGenerationParameters=B(()=>{let{view:e,analysis:t}=this;return e?.ready&&this._queue?{view:e,geometry:t.geometry,geometryIsValid:t.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:e.type===`3d`?e.slice.plane:null}:null},a),this._getStableElevationInfo=B(()=>this.analysis.elevationInfo??Wt,le),this._getStableOptions=B(()=>{let{densificationMaxSamples:e,defaultDemResolution:t,maxTotalSamples:n}=I(),r=this._minDemResolution??t;return r=parseFloat(r.toFixed(2)),{samplingDistance:r,densificationMaxSamples:Math.round(e/this._activeComputations.length),maxTotalSamples:n}},a),this._updateThrottled=He(e=>this._update(e),I().updateThrottleMillis)}initialize(){this._computationsCollection=P(()=>this.analysis.profiles,e=>this.computationFactory.create({controller:this,profile:e,onInvalidate:e=>this._invalidateComputation(e)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on(`change`,()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),A(()=>this._updateParameters,e=>this._updateThrottled(e),M),this._updateThrottled]);let e=this.view.type===`3d`?this.view.resourceController:void 0;this._queue=Nt(e?.scheduler),e?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=N(this._queue),this._currentTileCache=N(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(let n of this._activeComputations)e++,t+=n.progress;return Ut(e>0?t/e:0)}get updating(){let{progress:e}=this,t=!!this._queue?.updating,n=this._updateThrottled.hasPendingUpdates(),r=this._updateTask!=null&&!this._updateTask.finished;return t||n||r||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return Ct(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){let{view:t}=this;return t?.type===`3d`?b(()=>t.elevationProvider,`elevation-change`,e,{onListenerAdd:e,onListenerRemove:e}):E()}get _tileCache(){this._currentTileCache=N(this._currentTileCache);let e=this.view;if(e?.type===`3d`){let t=e.basemapTerrain?.elevationQueryCache;if(t!=null)return t}return this._currentTileCache??=new Je(new t(20971520)),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){let e=this._minDemResolutions;return e.length>0?ge(e):null}get _minDemResolutions(){let e=[];for(let{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:n}){this._abortUpdate(),e&&(n==null?this._clearResults():this._updateTask=se(async e=>{this.error=null;let r=t.filter(e=>!this._isComputationValid(e,n));try{if(!n.geometryIsValid)throw new U;let t=At({...n,providers:r},{signal:e}),i=!1;for await(let a of t){O(e),i||=(this._clearInvalidResults(n),!0);for(let e=0;e<r.length;e++)r[e].setResult(a[e])}for(let e of r)this._parametersPerComputation.set(e,n)}catch(e){f(e),this._abortUpdate(),this.error=e instanceof V?e:e instanceof U?null:new Xe,r.forEach(e=>e.clearResult())}}))}_abortUpdate(){this._updateTask=ce(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(let t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(let e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};k([o({constructOnly:!0})],G.prototype,`analysis`,void 0),k([o({constructOnly:!0})],G.prototype,`analysisViewData`,void 0),k([o({constructOnly:!0})],G.prototype,`computationFactory`,void 0),k([o({constructOnly:!0})],G.prototype,`view`,void 0),k([o()],G.prototype,`error`,void 0),k([o({readOnly:!0})],G.prototype,`effectiveDisplayUnits`,null),k([o()],G.prototype,`progress`,null),k([o()],G.prototype,`updating`,null),k([o()],G.prototype,`results`,null),k([o()],G.prototype,`statistics`,null),k([o()],G.prototype,`hoveredPoints`,null),k([o()],G.prototype,`_updateTask`,void 0),k([o()],G.prototype,`_queue`,void 0),k([o()],G.prototype,`_tileCache`,null),k([o()],G.prototype,`_computationsCollection`,void 0),k([o()],G.prototype,`_computations`,null),k([o()],G.prototype,`_activeComputations`,null),k([o({readOnly:!0})],G.prototype,`_minDemResolution`,null),k([o()],G.prototype,`_minDemResolutions`,null),k([o()],G.prototype,`_updateParameters`,null),k([o()],G.prototype,`_generationParameters`,null),k([o()],G.prototype,`elevationInfo`,null),k([o()],G.prototype,`_options`,null),G=k([g(`esri.views.analysis.ElevationProfile.ElevationProfileController`)],G);var Wt=new we({...De});function Gt(e,t){if(e==null||t==null)return null;let{samples:n,spatialReference:r}=e,{distance:a,elevation:o}=t,s=i(r),c=p(r),l=n.length,u=Array(l);for(let e=0;e<l;++e){let t=n[e],r=t.sampledZ,i=t.coordinate;u[e]={x:i[0],y:i[1],z:r,distance:qt(t.distance,s,a),elevation:K(r,c,o)}}return u}function Kt(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;let{distance:n,elevation:r}=t,{statistics:a,spatialReference:o}=e,s=i(o),c=p(o);return{maxDistance:qt(a.maxDistance,s,n),minElevation:K(a.minElevation,c,r),maxElevation:K(a.maxElevation,c,r),avgElevation:K(a.avgElevation,c,r),elevationGain:K(a.elevationGain,c,r),elevationLoss:K(a.elevationLoss,c,r),maxPositiveSlope:a.maxPositiveSlope,maxNegativeSlope:a.maxNegativeSlope,avgPositiveSlope:a.avgPositiveSlope,avgNegativeSlope:a.avgNegativeSlope}}function qt(e,t,n){return e==null?null:h(e*t,`meters`,n)}function K(e,t,n){return e==null?null:h(e*t,`meters`,n)}var q=class extends ue{constructor(e){super(e),this._getSamplesMemoized=Te((e,t)=>Gt(e,t)),this._getStatisticsMemoized=Te((e,t)=>Kt(e,t)),this.rawResult=null}get available(){let{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return Ut(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;let e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;let{rawResult:t,samples:n}=this;if(n==null||t==null)return null;let r=n.length;if(r===0)return null;let i=n[r-1].distance,a=Ht(n,e*i,e=>e.distance);if(a==null)return null;let{x:o,y:s,z:c}=a;return c==null?null:new ye({x:o,y:s,z:c,spatialReference:t.spatialReference})}};k([o()],q.prototype,`available`,null),k([o({readOnly:!0})],q.prototype,`profile`,null),k([o({readOnly:!0})],q.prototype,`progress`,null),k([o()],q.prototype,`samples`,null),k([o()],q.prototype,`statistics`,null),k([o({constructOnly:!0})],q.prototype,`computation`,void 0),k([o()],q.prototype,`rawResult`,void 0),k([o()],q.prototype,`hoveredPoint`,null),q=k([g(`esri.views.analysis.ElevationProfile.ElevationProfileResult`)],q);var J=class extends D{constructor(e){super(e),this.result=new q({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([A(()=>{let{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),re)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return I().defaultDemResolution}};k([o({constructOnly:!0})],J.prototype,`controller`,void 0),k([o({constructOnly:!0})],J.prototype,`profile`,void 0),k([o({constructOnly:!0})],J.prototype,`onInvalidate`,void 0),k([o()],J.prototype,`result`,void 0),k([o({readOnly:!0})],J.prototype,`progress`,null),k([o()],J.prototype,`hoveredPoint`,null),k([o()],J.prototype,`available`,null),k([o()],J.prototype,`numSamplesForPreview`,void 0),k([o()],J.prototype,`numSamplesPerChunk`,void 0),k([o({readOnly:!0})],J.prototype,`minDemResolution`,null),J=k([g(`esri.views.analysis.ElevationProfile.ElevationProfileLineComputation`)],J);function Jt(e){if(e==null)return null;if(_e(e))return Yt(e);let t=e.tileInfo;if(t==null)return null;let n=t.lods?.at(-1);return n==null?null:n.resolution*i(t.spatialReference)}function Yt(e){if(e==null)return null;let t=e.layers.items.map(Xt).filter(d);return ge(t)??null}function Xt(e){return e&&`tileInfo`in e?Jt(e):null}var Y=class extends J{constructor(){super(...arguments),this.type=`ground`,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=B(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),a),this._getStableGroundLayers=B(()=>this._ground?.layers?.toArray(),a)}get minDemResolution(){return Yt(this._ground)}get available(){return!0===this._ground?.layers.some(e=>e.visible)}initialize(){this.addHandles([A(()=>this._queryElevationDependencies,()=>this.onInvalidate(this)),A(()=>this._ground,e=>{e&&!e.loaded&&e.load()},{initial:!0})])}async queryElevation(e,t){let n=this._queryElevationDependencies;if(n==null)throw Error(`${this.declaredClass}: no dependencies`);let{ground:r}=n;if(r==null)throw Error(`No ground configured in the view`);let i=await r.queryElevation(e,t),a=p(e.spatialReference),o=p(r.layers.at(0).spatialReference);if(a!==o){let e=i.geometry;e.points=e.points.map(([e,n,r])=>[e,n,r===t.noDataValue?r:r*o/a])}return i}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};k([o()],Y.prototype,`minDemResolution`,null),k([o()],Y.prototype,`available`,null),k([o()],Y.prototype,`_queryElevationDependencies`,null),k([o()],Y.prototype,`_ground`,null),Y=k([g(`esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation`)],Y);function Zt(e){return e?.map?.allLayers?.toArray().filter(e=>(e.type!==`graphics`||!e.internal)&&e.visible).map(e=>e.uid)??[]}var X=class extends J{constructor(){super(...arguments),this.type=`input`,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=B(()=>{let{view:e}=this.controller;if(!e)return null;let t=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:t,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},a),this._getStableElevationInfo=B(()=>this.controller.elevationInfo,le),this._getStableSpatialReference=B(()=>this.controller.view?.spatialReference,le),this._getStableLayerIds=B(()=>{let{view:e}=this.controller;return e.type===`3d`?Zt(e):[]},a)}initialize(){let e=()=>this.onInvalidate(this);this.addHandles([A(()=>this._queryElevationDependencies,e,re),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:n}){let r=this._queryElevationDependencies;if(r==null)throw Error(`${this.declaredClass}: no dependencies`);let{view:i,spatialReference:a}=r;if(this._requiresElevationAlignment&&i.type===`3d`&&a){let r=await Ae.fromGeometry(e).project(a,n);if(!r)return{geometry:e,noDataValue:t};let o=i.elevationProvider;return r.coordinates.forEach(e=>{e.z=o.getElevation(e.x,e.y,0,a,`ground`)??0}),{geometry:r.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode===`on-the-ground`&&this.controller.view.type===`3d`}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};k([o()],X.prototype,`_queryElevationDependencies`,null),X=k([g(`esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation`)],X);var Z=class extends J{constructor(){super(...arguments),this.type=`query`,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return Jt(this.profile.source)}get available(){let{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(e=>e.visible))}initialize(){this.addHandles(A(()=>this.profile.source,()=>this.onInvalidate(this),re))}queryElevation(e,t){if(!this.profile.source)throw Error(`No source configured for the elevation profile line`);return this.profile.source.queryElevation(e,t)}};k([o({readOnly:!0})],Z.prototype,`minDemResolution`,null),k([o()],Z.prototype,`available`,null),Z=k([g(`esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation`)],Z);var Qt=de.ofType(ze);function $t(e,t){let n=P(t?.excludeInternal?()=>e.map?.allLayers.filter(e=>!(`internal`in e)||!e.internal):()=>e.map?.allLayers,e=>new ze({layer:e}),{recycleItems:!0,createCollection:()=>new Qt}),r=new Re({enabled:!0,selfEnabled:t?.selfEnabled??!1,featureEnabled:!0,featureSources:n,distance:t?.distance??Ve.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??Ve.touchSensitivityMultiplier});return{...w(n),options:r}}var Q=class extends D{constructor(e){super(e),this._sketchViewModels=new de,this._updatingHandles=new ve,this._operationManager=new Ne}initialize(){let{view:e}=this;this._allLayerSnappingOptions=$t(this.view,{selfEnabled:!0,excludeInternal:!0}),this._graphicsLayer=new ke({listMode:`hide`,internal:!0}),this.addHandles([A(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:e,internalGraphicsLayer:t,state:n,geometryVisualizationVisible:r,visible:i})=>{tn(e,t);let a=this.sketchGraphic;switch(a&&(a.visible=i),n){case`idle`:case`reshaping-disabled`:a&&!r&&(a.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case`reshaping`:j(this._startReshape());break;case`awaiting-sketch`:this.analysisViewData.interactive=!0}},M),A(()=>this._analysis.elevationInfo,e=>{this._graphicsLayer.elevationInfo=e},M),this._allLayerSnappingOptions])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(e=>N(e));let e=this._graphicsLayer;this.view.map?.remove(e),e.destroy()}get sketchGraphic(){return this._get(`sketchGraphic`)}set sketchGraphic(e){e!==this._get(`sketchGraphic`)&&(this._set(`sketchGraphic`,e),this._updateAnalysisFromSketchGraphic())}get state(){let{visible:e,interactive:t}=this.analysisViewData;if(!e)return`idle`;switch(this._operationManager.currentOperationType){case`place`:return this._sketching?`sketching`:`awaiting-sketch`;case`pick-feature`:return`picking`;default:return this._analysis.geometry?t?`reshaping`:`reshaping-disabled`:`idle`}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return en(this.view.type)}place(e){return this._operationManager.start(`place`,async t=>{let n=this._createSketchViewModel(),r=this._analysis.clone();this._ensureUpdatedSketchGraphic();let i=this.sketchGraphic,a=this._analysis.elevationInfo,o=E(()=>{this.sketchGraphic===i&&(this._graphicsLayer.elevationInfo=a)}),s=n.on(`create`,e=>{switch(e.state){case`start`:this._graphicsLayer.removeAll(),this.sketchGraphic=e.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case`active`:this._updateAnalysisFromSketchGraphic();break;case`complete`:this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case`cancel`:t.stop()}});t.handles.push(s,E(()=>(s.remove(),n.destroy(),this._sketchViewModels.remove(n),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?m(e)||r.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),o),this._graphicsLayer.elevationInfo=nn,await this._updatingHandles.addPromise(j(n.create(`polyline`)))},e)}async pickFeature(e){return this._operationManager.start(`pick-feature`,async e=>{let{view:t}=this;t.closePopup();let n=null;e.handles.push(t.on(`immediate-click`,r=>{r.defer(async()=>{n?.abort(),n=se(async n=>{let{results:i}=await t.hitTest(r);O(n);let a=null;for(let e of i)if(e.type===`graphic`&&at(e.graphic)&&!lt(e.graphic)){a=e.graphic;break}a&&(r.preventDefault(),r.stopPropagation(),this.sketchGraphic=null,this._analysis.setGeometryFromFeature(a),e.resolve({feature:a}),e.stop())}),await n.promise})},l.TOOL),t.on(`key-down`,t=>{ie(t)&&(e.reject(),e.stop())},l.TOOL),t.acquireCursor(`crosshair`,`high`),E(()=>{n?.abort(),e.reject()})),t.focus()},e)}_startReshape(){let e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start(`reshape`,async t=>{let n=()=>{let t=this._ensureUpdatedSketchGraphic();return t?this._updatingHandles.addPromise(e.update(t,{tool:`reshape`})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;let r=e.on(`update`,e=>{this._updateAnalysisFromSketchGraphic(),e.state===`complete`&&(this.state===`reshaping`?j(n()):t.resolve())});t.handles.push(r,E(()=>{r.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await n()})}_createSketchViewModel(){return new Be({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:`click`,hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:`none`},toggleToolOnClick:!1,tool:`reshape`},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol,snappingOptions:this._allLayerSnappingOptions.options})}_ensureUpdatedSketchGraphic(){let{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;let t=this.sketchGraphic??=new Se({symbol:this._lineSymbol,geometry:e});return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){let{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(t=>t!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let e=this.sketchGraphic?.geometry;st(e)||(e=null);let t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function en(e){if(e===`2d`){let e={type:`CIMSolidStroke`,enable:!0,capStyle:`Butt`,joinStyle:`Round`,width:1.5};return new c({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{...e,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[5,4],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],color:[0,0,0,255]},{...e,color:[255,255,255,255]}]}}})}return new fe({color:[0,0,0,0]})}function tn(e,t){t&&(t.removeFromParent(),e?.add(t))}k([o({constructOnly:!0})],Q.prototype,`analysisViewData`,void 0),k([o({constructOnly:!0})],Q.prototype,`view`,void 0),k([o()],Q.prototype,`sketchGraphic`,null),k([o({nonNullable:!0})],Q.prototype,`state`,null),k([o()],Q.prototype,`updating`,null),k([o()],Q.prototype,`_sketching`,null),k([o()],Q.prototype,`_analysis`,null),k([o()],Q.prototype,`_lineSymbol`,null),Q=k([g(`esri.views.analysis.ElevationProfile.ElevationProfileTool`)],Q);var nn=new we({mode:`on-the-ground`,offset:0}),$=class extends Me{constructor(e){super(e),this.type=`elevation-profile-view-2d`,this.analysis=null,this.hoveredPosition=null}initialize(){let{analysis:e,view:t}=this;this._controller=new G({analysis:e,analysisViewData:this,view:t,computationFactory:{create:e=>{switch(e.profile.type){case`ground`:return new Y(e);case`input`:return new X(e);case`query`:return new Z(e);case`scene`:throw new r(`elevation-profile-analysis-view-2d:unsupported`,`The scene profile line type is not supported in 2D views.`)}}}}),this._visualization=new z({view:t,analysisViewData:this}),this._sketchTool=new Q({view:t,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:`meters`,elevation:`meters`}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return!0===this._controller?.updating||!0===this._visualization?.updating||!0===this._sketchTool?.updating}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??`idle`}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};k([o({readOnly:!0})],$.prototype,`type`,void 0),k([o({constructOnly:!0,nonNullable:!0})],$.prototype,`analysis`,void 0),k([o({readOnly:!0})],$.prototype,`effectiveDisplayUnits`,null),k([o({readOnly:!0})],$.prototype,`error`,null),k([o()],$.prototype,`hoveredPosition`,void 0),k([o()],$.prototype,`hoveredPoints`,null),k([o({readOnly:!0})],$.prototype,`progress`,null),k([o({readOnly:!0})],$.prototype,`results`,null),k([o({readOnly:!0})],$.prototype,`statistics`,null),k([o({readOnly:!0})],$.prototype,`updating`,null),k([o()],$.prototype,`sketchGraphic`,null),k([o()],$.prototype,`toolState`,null),k([o()],$.prototype,`_controller`,void 0),k([o()],$.prototype,`_visualization`,void 0),k([o()],$.prototype,`_sketchTool`,void 0),$=k([g(`esri.views.2d.analysis.ElevationProfileAnalysisView2D`)],$);var rn=$;export{rn as default};