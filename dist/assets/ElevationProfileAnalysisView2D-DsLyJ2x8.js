const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lengthOperator-BUhW82a8.js","assets/SpatialReference-CfUjvF_j.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/Envelope2D-B7gkUj4e.js","assets/Point2D-DJueHbCy.js","assets/OperatorDefinitions-C5Pat-Jx.js","assets/SimpleGeometryCursor-BILtMaQf.js","assets/Transformation2D-D07KwcEj.js","assets/lengthOperator-DdV6vMS2.js","assets/apiConverter-Dsm0pxcs.js","assets/jsonConverter-CoA5-zxu.js","assets/FlatGeometry-BsPiiSVP.js","assets/memoryEstimations-D_IbKyOk.js","assets/OptimizedGeometry-BQJ7w5VU.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,$x as n,An as r,Aw as i,BT as a,Eb as o,Ex as s,Hx as c,IE as l,Kg as u,Kx as d,Lx as f,NS as p,Ng as m,OT as h,Od as g,Ow as _,Pb as v,Sg as y,Sw as b,TT as x,VT as S,Vd as C,Vg as w,Vx as T,Yv as E,Zl as ee,_l as te,aT as ne,cl as re,cv as ie,cy as ae,dT as oe,dw as se,fh as ce,gT as le,hD as ue,hv as de,iT as fe,jT as D,kD as O,lE as pe,lv as me,mv as k,nE as he,ng as ge,oD as _e,pT as A,pv as j,rE as M,sD as ve,sS as N,sT as ye,sd as be,tp as xe,wg as Se,zi as Ce,zv as P}from"./index-BN8X5Ryz.js";import"./memoryEstimations-D_IbKyOk.js";import"./OptimizedGeometry-BQJ7w5VU.js";import"./Point2D-DJueHbCy.js";import"./Envelope2D-B7gkUj4e.js";import"./SpatialReference-CfUjvF_j.js";import"./Transformation2D-D07KwcEj.js";import"./SimpleGeometryCursor-BILtMaQf.js";import"./OperatorDefinitions-C5Pat-Jx.js";import"./jsonConverter-CoA5-zxu.js";import"./FlatGeometry-BsPiiSVP.js";import"./apiConverter-Dsm0pxcs.js";import"./geodeticCurveType-CcdKHJt5.js";import"./geodeticAreaOperator-B2LzXjd-.js";import"./geodeticLengthOperator-BdZS0ajo.js";import"./Distance2DCalculator-CXhBP-8I-CYkwuMp9.js";import"./distanceOperator-Cfhn9VMw.js";import"./operatorSimplify-BCW0XIAz.js";import"./simplifyOperator-C6TgASU6.js";import"./quatf64-D37SEdPg.js";import"./quat-C8PgLo31.js";import"./earcut-CEMcWA4Z.js";import"./plane-Da5EsY0J.js";import"./vectorStacks-Cuo89CNO.js";import"./projectPointToVector-BkRdoTqD.js";import"./spatialReferenceEllipsoidUtils-qw9wv8RL.js";import"./dehydratedPoint-CWZQBefp.js";import"./projectVectorToVector-DGzn2p7I.js";import{t as we}from"./memoize-Dl61_jt0.js";import{d as Te,m as Ee}from"./elevationInfoUtils-uoMH3ofe.js";import{s as De}from"./colorUtils-CzajW9E7.js";import{t as Oe}from"./GraphicsLayer-DBcl42yN.js";import"./ObjectStack-l5kM7JZu.js";import"./ray-LkJ58wpZ.js";import{t as ke}from"./GeometryDescriptor-CmFSJK3t.js";import{t as Ae}from"./getDefaultUnitForView-DyZIV1hK.js";import{n as je,t as Me}from"./ExclusiveOperationManager-D0f7Woil.js";import"./quantity-Co6flzuS.js";import{a as Ne,i as Pe,o as Fe,s as Ie}from"./geodesicUtils-D99LxQ6q.js";import{n as Le,r as Re,t as ze}from"./SketchViewModel-BUSTPGCt.js";import"./isSupportedObject-CnaOA-Ng.js";import"./layerUtils-BZgsYerz.js";import"./SketchOptions-DjwJVzbR.js";import"./LineSnappingHint-CmFAetWF.js";import{n as Be}from"./ParallelSnappingHint-CVYaPm-q.js";import"./snappingUtils-D3oTIKrZ.js";import"./vec3-B94Y7ih2.js";import"./sphere-d9-4vNcj.js";import"./constraints-Ch5tsKD8.js";import"./SnappingCandidate-DueCLuvH.js";import"./EdgeSnappingCandidate-CCg5Xb97.js";import"./DrapedEdgeSnappingCandidate-CqXt8QLN.js";import"./IntersectionSnappingHint-CvQZ8eWi.js";import"./IntersectionSnappingCandidate-C2uVyhEk.js";import"./LineSnappingCandidate-BNbhbOGH.js";import"./RightAngleTriangleSnappingCandidate-CqVuCsko.js";import"./RightAngleSnappingHint-tXLlHR_t.js";import"./viewUtils-GR2hLWLo.js";import"./viewUtils-H4dpIyqQ.js";import"./euclideanLengthMeasurementUtils-CvEUUrXw.js";import"./lineSegment-BudcKS0C.js";import"./triangle-46ad8nAb.js";import"./hitTestSelectUtils-DrV1belT.js";import{t as F}from"./mapCollectionUtils-CMweJs6i.js";import{t as Ve}from"./throttle-DtObBf3w.js";import{a as He}from"./createUtils-BVlp8HHH.js";function Ue(e){return pe([j(()=>{let{analysis:t,sketchGraphic:n,toolState:r,visible:i}=e.analysisViewData,{geometryVisualizationVisible:a}=t.viewOptions;return{geometryVisualizationVisible:a,geometry:t.geometry,sketchGraphic:n,toolState:r,visible:i}},({geometryVisualizationVisible:t,sketchGraphic:n,toolState:r,visible:i})=>{if(e.remove(),i)return t&&n!=null&&r!==`reshaping`&&r!==`sketching`?e.show(n):void 0},k)])}var I=class extends i{constructor(e){super(e)}initialize(){this.addHandles(Ue({analysisViewData:this.analysisViewData,remove:()=>{},show:()=>{}}))}get updating(){return!1}};O([a({constructOnly:!0})],I.prototype,`view`,void 0),O([a({constructOnly:!0})],I.prototype,`analysisViewData`,void 0),O([a()],I.prototype,`updating`,null),I=O([S(`esri.views.2d.analysis.ElevationProfile.ElevationProfileInputVisualization2D`)],I);var We={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:We.noDataValue,demResolution:`auto`,maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:d(10,`centimeters`,`meters`),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:`solid`,borderWidth:3,borderColor:`#ffffff`,boxShadow:`0px 0px 0px 5px rgba(255,255,255,0.2)`}};function L(){return We}var R=class extends i{constructor(e){super(e),this.visible=!1,this._element=Ge()}initialize(){this.view.surface?.appendChild(this._element),this.addHandles([j(()=>this.visible&&!!this._screenPoint,e=>{this._element.style.display=e?`block`:`none`},k),j(()=>({color:this.line.color.toCss(),zIndex:this._zIndex}),({color:e,zIndex:t})=>{Object.assign(this._element.style,{background:e,zIndex:t.toString()})},k),j(()=>this._screenPoint,e=>{e&&(this._element.style.transform=`translate(${e.x}px, ${e.y}px)`)},k)])}destroy(){this._element.remove()}get updating(){return!1}get _result(){return this.analysisViewData.results.find(e=>e.computation.profile===this.line)}get _zIndex(){let{profiles:e}=this.analysisViewData.analysis,t=e.indexOf(this.line);return e.length-(t===-1?0:t)}get _screenPoint(){let{view:e}=this;e.type===`3d`?(e.commitProperty(`size`),e.commitProperty(`camera`)):e.commitProperty(`center`);let t=e?.spatialReference,n=t?m(this._result?.hoveredPoint,t).geometry:null;return n&&e?.ready?e.toScreen(n):null}};function Ge(){let e=document.createElement(`div`),{size:t,borderStyle:n,borderColor:r,borderWidth:i,boxShadow:a}=L().hoveredPointsStyle,{style:o}=e;return o.display=`block`,o.position=`absolute`,o.top=`0`,o.left=`0`,o.contain=`strict`,o.boxSizing=`border-box`,o.width=`${t}px`,o.height=`${t}px`,o.marginTop=`-${t/2}px`,o.marginLeft=`-${t/2}px`,o.border=`${n} ${i}px ${r}`,o.borderRadius=`${t}px`,o.boxShadow=a,e}O([a()],R.prototype,`view`,void 0),O([a()],R.prototype,`analysisViewData`,void 0),O([a()],R.prototype,`line`,void 0),O([a()],R.prototype,`visible`,void 0),O([a()],R.prototype,`updating`,null),O([a()],R.prototype,`_result`,null),O([a()],R.prototype,`_zIndex`,null),O([a()],R.prototype,`_screenPoint`,null),R=O([S(`esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization`)],R);function Ke(e,t){if(!e||e.length===0)return;let n=e.length-1,r=[],i=[];for(let t=0;t<=n;t++){let{x:a,y:o,z:s}=e[t];s!=null&&i.push([a,o,s]),t!==n&&s!=null||!i.length||(r.push(i),i=[])}return He(r,t,!0)}var z=class extends i{constructor(e){super(e),this._graphic=new g,this._updateGeometryThrottled=Ve(e=>{e&&(this._graphic.geometry=Ke(e.samples,e.spatialReference))},L().profileLinesUpdateThrottleMillis)}initialize(){this.addGraphic(this._graphic),this._indicatorVisualization=new R({analysisViewData:this.analysisViewData,line:this.line,view:this.view}),this.addHandles([j(()=>this._effectiveLineVisible,e=>{this._graphic.visible=e},k),j(()=>this._effectiveIndicatorVisible,e=>{this._indicatorVisualization.visible=e},k),j(()=>this._colorUpdateParameters,e=>this._updateColor(e),k),j(()=>this.analysisViewData.analysis.geometry,()=>{this._graphic.geometry=null},k),j(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),k),this._updateGeometryThrottled])}destroy(){this._graphic.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.analysisViewData.results.find(e=>e.computation.profile===this.line)}get _effectiveLineVisible(){return this.getEffectiveVisible(`lineVisible`)}get _effectiveIndicatorVisible(){let e=this.getEffectiveVisible(`hoveredPointVisible`);return this._effectiveLineVisible?e&&!!this._graphic.geometry:e}getEffectiveVisible(e){let{analysisViewData:t,_result:n}=this;return t.visible&&!!n?.available&&n.computation.profile.viewOptions[e]}get _geometryUpdateParameters(){let e={samples:this._result?.samples,spatialReference:this.view.spatialReference};return e.samples&&this._effectiveLineVisible&&this.analysisViewData.progress!==1?null:e}get _colorUpdateParameters(){let e=this._result?.computation.profile.color;return e?{color:e.toArray(),contrastColor:De(e).toArray()}:null}_updateColor(e){e&&(this._graphic.symbol=new xe({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{type:`CIMSolidStroke`,capStyle:`Butt`,color:e.color,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[5,4],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],joinStyle:`Round`,width:1.5},{type:`CIMSolidStroke`,capStyle:`Butt`,color:e.contrastColor,joinStyle:`Round`,width:1.5}]}}}))}};O([a({constructOnly:!0})],z.prototype,`addGraphic`,void 0),O([a({constructOnly:!0})],z.prototype,`analysisViewData`,void 0),O([a({constructOnly:!0})],z.prototype,`line`,void 0),O([a({constructOnly:!0})],z.prototype,`view`,void 0),O([a()],z.prototype,`updating`,null),O([a()],z.prototype,`_result`,null),O([a()],z.prototype,`_effectiveLineVisible`,null),O([a()],z.prototype,`_effectiveIndicatorVisible`,null),O([a()],z.prototype,`_geometryUpdateParameters`,null),O([a()],z.prototype,`_colorUpdateParameters`,null),z=O([S(`esri.views.2d.analysis.ElevationProfile.ElevationProfileLineVisualization2D`)],z);var B=class extends i{constructor(e){super(e),this._graphicsLayer=new Oe({listMode:`hide`,internal:!0})}initialize(){let{view:e,analysisViewData:t}=this;e.map.add(this._graphicsLayer),e.map.layers.reorder(this._graphicsLayer,0),this._inputVisualization=new I({view:e,analysisViewData:t}),this._lineVisualizations=F(()=>t.analysis.profiles,n=>new z({view:e,analysisViewData:t,line:n,addGraphic:e=>{e.attributes={index:t.analysis.profiles.indexOf(n)},this._graphicsLayer.add(e),this._graphicsLayer.graphics.sort((e,t)=>{let n=e.attributes?.index??0;return(t.attributes?.index??0)-n})}}))}destroy(){this._inputVisualization.destroy(),this._lineVisualizations.destroy(),this._graphicsLayer.graphics.drain(e=>{e.destroyed||e.destroy()}),this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get updating(){return this._inputVisualization.updating||this._lineVisualizations.some(e=>e.updating)}};O([a()],B.prototype,`view`,void 0),O([a()],B.prototype,`analysisViewData`,void 0),O([a()],B.prototype,`updating`,null),B=O([S(`esri.views.2d.analysis.ElevationProfile.ElevationProfileVisualization2D`)],B);function V(e,t){let n,r=!1;function i(...i){let a=e.apply(this,i);return r&&n!==void 0&&t?.(n,a)?n:(r=!0,n=a,a)}return i}var qe=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t)}},H=class extends t{constructor(e,t,n){super(e,t,n),this.name=`unknown`,this.name=e}},U=class extends H{constructor(){super(`too-complex`,`The input geometry has too many points.`)}},Je=class extends H{constructor(){super(`elevation-query-error`,`Error querying elevation from provider.`)}},Ye=class extends H{constructor(){super(`unknown`,`Unknown error.`)}},Xe=class extends t{constructor(){super(`invalid-geometry`,`The input geometry is invalid.`)}};async function Ze(t,r,i,a,o,s,c){let l,d,p,m=t.spatialReference,h=m.isGeographic||m.isWebMercator,g=0;if(!h){let{execute:n}=await e(async()=>{let{execute:e}=await import(`./lengthOperator-BUhW82a8.js`);return{execute:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]));A(c),g=n(t,{unit:`meters`}),A(c)}let _=1/n(a);if(h){await w([{source:m,dest:a},{source:m,dest:f.WGS84}],c);let e=yt(t);l=Fe([e],`meters`)[0];let n=Qe(l,o);if(xt(t,l,n)>s)throw new U;let h=$e(e,r,i);({densifiedPath:d,distances:p}=ft(h,n,_)),d=u(d,a)}else{await w([{source:m,dest:a}],c),l=g;let e=Qe(l,o);if(xt(t,l,e)>s)throw new U;let n=$e(t,r,i);({densifiedPath:d,distances:p}=dt(n,e,_)),A(c),d=u(d,a)}return{densifiedPath:d,pathLength:l*_,distances:p}}function Qe(e,t){let n=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,n)}function $e(e,t,n){if(t==null)return nt(e);let r=e.spatialReference,i=t.mode,a=Te(t,r),o=null;switch(n.type){case`2d`:o=et(e,i,a);break;case`3d`:o=tt(e,i,a,n)}return o==null?nt(e):new P({hasZ:!0,hasM:!1,spatialReference:r,paths:rt(e.paths,o)})}function et({hasZ:e},t,n){return t===`absolute-height`?e?([e,t,r])=>[e,t,r+n]:([e,t])=>[e,t,n]:null}function tt({spatialReference:e,hasZ:t},n,r,{elevationProvider:i}){let a=(t,n,r,a)=>i?.getElevation(t,n,r,e,a)??0;switch(n){case`on-the-ground`:return([e,t])=>[e,t,a(e,t,0,`ground`)];case`absolute-height`:return t?([e,t,n])=>[e,t,n+r]:([e,t])=>[e,t,r];case`relative-to-ground`:return t?([e,t,n])=>[e,t,n+a(e,t,n,`ground`)+r]:([e,t])=>[e,t,a(e,t,0,`ground`)+r];case`relative-to-scene`:return t?([e,t,n])=>[e,t,n+a(e,t,n,`scene`)+r]:([e,t])=>[e,t,a(e,t,0,`scene`)+r];default:return null}}function nt(e){return e.hasZ?new P({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:rt(e.paths,([e,t])=>[e,t])}):e}function rt(e,t){let n=e.length,r=Array(n);for(let i=0;i<n;++i){let n=e[i],a=n.length,o=Array(n.length);r[i]=o;for(let e=0;e<a;++e)o[e]=t(n[e])}return r}function it(e){return st(e)&&e.paths.some(e=>e.length>1)}function at(e){return ot(e)&&it(e.geometry)}function ot(e){return ct(e)&&st(e?.geometry)}function st(e){return!ct(e)&&e!=null&&e.type===`polyline`}function ct(e){return e!=null&&`geometry`in e}function lt(e){let t=e?.layer;return t!=null&&t.type===`graphics`&&t.internal}function ut(e,t,r,i,a){let{spatialReference:o,hasZ:s}=e,c={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:o,metersPerSR:n(o)},l=[],u=[],d=0;for(let n=0;n<e.paths.length;++n){let o=e.paths[n],s=[],f=[],p=0;for(let e=1;e<o.length;++e){let n=o[e-1],l=o[e],u=i(c,n,l),m;for(m=p;m<u.distance&&!se(m,u.distance);m+=t)s.push(a(u,m)),f.push((d+m)*r);p=m-u.distance,d+=u.distance,s.push(l),f.push(d*r)}l[n]=s,u[n]=f}return{densifiedPath:new P({spatialReference:o,hasZ:s,paths:l}),distances:u}}function dt(e,t,n){let{hasZ:r}=e;return ut(e,t,n,mt,r?vt:_t)}function ft(e,t,n){let{hasZ:r}=e;return ut(e,t,n,pt,r?gt:ht)}function pt(e,t,n){return e.distance=0,Ne(e,t,n,e.spatialReference),e.from=t,e.to=n,e}function mt(e,t,n){return e.from=t,e.to=n,e.distance=v(n,t)*e.metersPerSR,e}function ht({from:e,azimuth:t,spatialReference:n},r){return Pe([0,0],e,t,r,n)}function gt({from:e,to:t,azimuth:n,distance:r,spatialReference:i},a){let o=a/r,s=[0,0,b(e[2],t[2],o)];return Pe(s,e,n,a,i),s}function _t({from:e,to:t,distance:n},r){return o([0,0],e,t,r/n)}function vt({from:e,to:t,distance:n},r){return te([0,0,0],e,t,r/n)}function yt(e){return Ie(e.spatialReference)?e:u(e,f.WGS84)}function bt(e){return e.paths.reduce((e,t)=>e+t.length,0)}function xt(e,t,n){return bt(e)+Math.floor(t/n)+Math.max(0,e.paths.reduce(e=>1+e,0)-1)}function St(e,t){let r=e.length;if(r===0)return null;let i=e[0],a=i.sampledZ,o=a,s=a,c=0,l=0,u=null,f=null,p=a??0,m=0,h=0,g=a==null?0:1,_=0,v=0,y=n(t),b=N(t),x=L().minSlopeSampleDistance/y,S=2*x,C=new Dt,w=new Dt,T=()=>{ee(),C.copy(w),w.reset()},E=(e,t)=>{T(),e>0&&e-C.start<=S&&(e=C.start+x),w.restart(e,t)},ee=()=>{if(C.isHole||w.isHole)return;let e=w.avgElevation-C.avgElevation,t=w.start-C.start,n=e*b,r=t*y,i=d(Math.atan2(n,r),`radians`,`degrees`);i>0?(m+=i,u=W(u,i),_++):i<0&&(h-=i,f=W(f,-i),v++)};i.sampledZ!=null&&E(i.distance,i.sampledZ);for(let t=1;t<r;++t){let n=e[t-1],r=e[t],i=r.sampledZ;if(i==null){w.isHole||T();continue}g++,p+=i,o=Tt(o,i),s=W(s,i),w.isHole||r.distance-w.start>=x?E(r.distance,i):w.insert(i);let a=n.sampledZ;if(a!=null){let e=i-a;e>0?c+=e:e<0&&(l-=e)}}return T(),g===0?null:{maxDistance:e[r-1].distance,minElevation:o,maxElevation:s,avgElevation:g===0?null:p/g,elevationGain:c,elevationLoss:l,maxPositiveSlope:u,maxNegativeSlope:f,avgPositiveSlope:_===0?null:m/_,avgNegativeSlope:v===0?null:h/v}}function Ct(e){let t=e.filter(ve),n=t.length;if(n===0)return null;let r=t[0];if(n===1)return r;let i=r.maxDistance,a=r.minElevation,o=r.maxElevation,s=r.maxPositiveSlope,c=r.maxNegativeSlope;for(let e=1;e<t.length;++e){let n=t[e];i=W(i,n.maxDistance),a=Tt(a,n.minElevation),o=W(o,n.maxElevation),s=W(s,n.maxPositiveSlope),c=W(c,n.maxNegativeSlope)}return{maxDistance:i,minElevation:a,maxElevation:o,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:s,maxNegativeSlope:c,avgPositiveSlope:null,avgNegativeSlope:null}}function wt(e){let t=null,r=null,i=null;for(let a of e){if(a==null)continue;let{statistics:e,spatialReference:o}=a;if(e==null)continue;let s=n(o);t=W(t,Et(e.maxDistance,s));let c=N(o);i=Tt(i,Et(e.minElevation,c)),r=W(r,Et(e.maxElevation,c))}return{minDistance:0,maxDistance:t??0,minElevation:i??0,maxElevation:r??0}}function Tt(e,t){return t==null?e:e==null?t:Math.min(e,t)}function W(e,t){return t==null?e:e==null?t:Math.max(e,t)}function Et(e,t){return e!=null&&t!=null?e*t:null}var Dt=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,t){this._start=e,this._sampleCount=1,this._totalElevation=t}insert(e){++this._sampleCount,this._totalElevation+=e}};function Ot(e,t,n=[]){if(e>=t||(n.push(e),t-e<2))return n;let r=t-1;n.push(r);let i=kt(e+1,r);for(;;){let e=i.next();if(e.done)break;n.push(e.value)}return n}function*kt(e,t){if(e>=t)return;let n=e+Math.floor((t-e)/2);yield n;let r=kt(e,n),i=kt(n+1,t);for(;;){let e=r.next(),t=i.next();if(e.done&&t.done)break;e.done||(yield e.value),t.done||(yield t.value)}}async function*At(e,t){let{view:n,geometry:r,elevationInfo:i,providers:a,options:o}=e,s=n.spatialReference;if(!s||r==null||!it(r))throw new Xe;let c=a.length;if(c===0)return null;let l=Math.round(o.maxTotalSamples/c);if(bt(r)>l)throw new U;let u=await Ze(r,i,n,s,o,l,t);A(t);let d=0,f=Array(c),p=Array(c);for(let n=0;n<c;n++){let r=Lt(u);f[n]=r,d+=r.samples.length;let i={...e,provider:a[n],result:r,densificationResult:u};p[n]=jt(i,t)[Symbol.iterator]()}if(d>o.maxTotalSamples)throw new U;let m=await Promise.all(p.map(e=>{let t=e.next();return!0===t.done?Promise.resolve(null):t.value}));A(t);for(let e=0;e<c;e++)f[e]=m[e];yield f,await fe(e.delayAfterPreview??L().delayAfterPreviewMillis,null,t.signal),A(t);let h=[];try{let e;do{e=!1;for(let t=0;t<c;t++){let n=p[t].next();!1===n.done&&(h.push({resultPromise:n.value,index:t}),e=!0)}}while(e)}finally{p.forEach(e=>e.return?.())}for(let{resultPromise:e,index:n}of h)f[n]=await e,A(t),yield f;for(let e of f)e!=null&&(e.progress=1);yield f}function*jt(e,t){let{densificationResult:n}=e,r={...e,abortOptions:t,densificationResult:n},i=Ot(0,r.result.samples.length),a=i.slice(0,r.provider.numSamplesForPreview);yield Mt(r,a,!0);let o=_e(i,r.provider.numSamplesPerChunk);for(let e of o)yield Mt(r,e,!1)}async function Mt({densificationResult:e,result:t,provider:n,queue:r,abortOptions:i,cache:a},o,s){let{densifiedPath:c,pathLength:l}=e,u=t.spatialReference,{samples:d}=t,f=[];for(let e=0;e<o.length;e++)f[e]=[...d[o[e]].coordinate];try{return await r.push({geometry:new ae({spatialReference:u,points:f,hasZ:c.hasZ}),provider:n,indices:o,preview:s,result:t,parameters:{...L().defaultQueryOptions(),minDemResolution:s?Math.round(l/n.numSamplesForPreview):Math.round(l/d.length),cache:a}},i),{...t}}catch(e){return oe(e),null}}function Nt(e){return new re({priority:ee.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async e=>{A(e.parameters);try{await Pt(e)}catch(e){oe(e)}}})}async function Pt({geometry:e,provider:t,indices:n,preview:r,result:i,parameters:a}){if(n.length===0)return;let o=(await Vt(t,e,a)).geometry,{hasZ:s,points:c}=o,l=a.noDataValue,{samples:u}=i;for(let e=0;e<n.length;e++){let t=u[n[e]];if(t.isHole)continue;let r=s?c[e][2]:null;r===null||r===l?t.sampledZ=null:(i.hasZ=!0,t.sampledZ=r),t.sampled=!0}Ft(u),i.progress=r?0:i.progress+n.length/u.length,i.statistics=St(i.samples,i.spatialReference)}function Ft(e){let t=e.length-1,n=0;for(let r=1;r<=t;r++)(e[r].sampled||r===t)&&(It(e,n,r),n=r)}function It(e,t,n){if(n-t===1)return;let r=e[t],i=r.sampledZ,a=e[n],o=a.sampledZ;if(i==null||o==null){for(let r=t+1;r<n;r++)e[r].sampledZ=null;return}let s=r.distance,c=a.distance-s;for(let r=t+1;r<n;r++){let t=e[r],n=(t.distance-s)/c;t.sampledZ=b(i,o,n)}}function Lt({densifiedPath:e,distances:t}){let n=e.spatialReference,r=p(n),i=e.paths,a=i.length,o=[],s=null,c=0;for(let e=0;e<a;e++){let n=i[e],a=n.length,l=t[e];for(let e=0;e<a;e++){let t=n[e],i=l[e];r&&(t[0]=E(t[0],r.valid[0],r.valid[1])),s&&e===0&&Rt(o,s,t,c,i),o.push(zt(t,i)),s=t,c=i}}return{progress:0,samples:o,hasZ:!1,statistics:null,spatialReference:n}}function Rt(e,t,n,r,i){e.push(Bt(t,r)),e.push(Bt(n,i))}function zt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function Bt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function Vt(e,t,n){try{return await e.queryElevation(t,n)}catch{throw new Je}}function Ht(e,t,n){if(!e||e.length===0)return;let r=e.length-1,i=e[0];if(t<=n(i))return i;let a=e[r];if(t>=n(a))return a;let o=0,s=0,c=r;for(;o<c;){s=o+Math.floor((c-o)/2);let i=e[s],a=n(i);if(a===t)return i;if(t<a){if(s>0){let r=e[s-1],o=n(r);if(t>o)return t-o>=a-t?i:r}c=s}else{if(s<r){let r=e[s+1],o=n(r);if(t<o)return t-a>=o-t?r:i}o=s+1}}return e[s]}function Ut(e){return e>.999999?1:e}var G=class extends i{constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=V(()=>{let e=wt(this._activeComputations.map(e=>e.result.rawResult)),t=this.analysis.displayUnits,n=Ae(this.view);return{distance:T(e.maxDistance,`meters`,t.distance??n),elevation:c(e.maxElevation,`meters`,t.elevation??n)}},l),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=V(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),l),this._getStableGenerationParameters=V(()=>{let{view:e,analysis:t}=this;return e?.ready&&this._queue?{view:e,geometry:t.geometry,geometryIsValid:t.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:e.type===`3d`?e.slice.plane:null}:null},l),this._getStableElevationInfo=V(()=>this.analysis.elevationInfo??Wt,h),this._getStableOptions=V(()=>{let{densificationMaxSamples:e,defaultDemResolution:t,maxTotalSamples:n}=L(),r=this._minDemResolution??t;return r=parseFloat(r.toFixed(2)),{samplingDistance:r,densificationMaxSamples:Math.round(e/this._activeComputations.length),maxTotalSamples:n}},l),this._updateThrottled=Ve(e=>this._update(e),L().updateThrottleMillis)}initialize(){this._computationsCollection=F(()=>this.analysis.profiles,e=>this.computationFactory.create({controller:this,profile:e,onInvalidate:e=>this._invalidateComputation(e)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on(`change`,()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),j(()=>this._updateParameters,e=>this._updateThrottled(e),k),this._updateThrottled]);let e=this.view.type===`3d`?this.view.resourceController:void 0;this._queue=Nt(e?.scheduler),e?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=D(this._queue),this._currentTileCache=D(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(let n of this._activeComputations)e++,t+=n.progress;return Ut(e>0?t/e:0)}get updating(){let{progress:e}=this,t=!!this._queue?.updating,n=this._updateThrottled.hasPendingUpdates(),r=this._updateTask!=null&&!this._updateTask.finished;return t||n||r||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return Ct(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){let{view:t}=this;return t?.type===`3d`?me(()=>t.elevationProvider,`elevation-change`,e,{onListenerAdd:e,onListenerRemove:e}):M()}get _tileCache(){this._currentTileCache=D(this._currentTileCache);let e=this.view;if(e?.type===`3d`){let t=e.basemapTerrain?.elevationQueryCache;if(t!=null)return t}return this._currentTileCache??=new qe(new r(20971520)),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){let e=this._minDemResolutions;return e.length>0?ue(e):null}get _minDemResolutions(){let e=[];for(let{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:n}){this._abortUpdate(),e&&(n==null?this._clearResults():this._updateTask=y(async e=>{this.error=null;let r=t.filter(e=>!this._isComputationValid(e,n));try{if(!n.geometryIsValid)throw new Xe;let t=At({...n,providers:r},{signal:e}),i=!1;for await(let a of t){A(e),i||=(this._clearInvalidResults(n),!0);for(let e=0;e<r.length;e++)r[e].setResult(a[e])}for(let e of r)this._parametersPerComputation.set(e,n)}catch(e){ye(e),this._abortUpdate(),this.error=e instanceof H?e:e instanceof Xe?null:new Ye,r.forEach(e=>e.clearResult())}}))}_abortUpdate(){this._updateTask=x(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(let t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(let e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};O([a({constructOnly:!0})],G.prototype,`analysis`,void 0),O([a({constructOnly:!0})],G.prototype,`analysisViewData`,void 0),O([a({constructOnly:!0})],G.prototype,`computationFactory`,void 0),O([a({constructOnly:!0})],G.prototype,`view`,void 0),O([a()],G.prototype,`error`,void 0),O([a({readOnly:!0})],G.prototype,`effectiveDisplayUnits`,null),O([a()],G.prototype,`progress`,null),O([a()],G.prototype,`updating`,null),O([a()],G.prototype,`results`,null),O([a()],G.prototype,`statistics`,null),O([a()],G.prototype,`hoveredPoints`,null),O([a()],G.prototype,`_updateTask`,void 0),O([a()],G.prototype,`_queue`,void 0),O([a()],G.prototype,`_tileCache`,null),O([a()],G.prototype,`_computationsCollection`,void 0),O([a()],G.prototype,`_computations`,null),O([a()],G.prototype,`_activeComputations`,null),O([a({readOnly:!0})],G.prototype,`_minDemResolution`,null),O([a()],G.prototype,`_minDemResolutions`,null),O([a()],G.prototype,`_updateParameters`,null),O([a()],G.prototype,`_generationParameters`,null),O([a()],G.prototype,`elevationInfo`,null),O([a()],G.prototype,`_options`,null),G=O([S(`esri.views.analysis.ElevationProfile.ElevationProfileController`)],G);var Wt=new Ce({...Ee});function Gt(e,t){if(e==null||t==null)return null;let{samples:r,spatialReference:i}=e,{distance:a,elevation:o}=t,s=n(i),c=N(i),l=r.length,u=Array(l);for(let e=0;e<l;++e){let t=r[e],n=t.sampledZ,i=t.coordinate;u[e]={x:i[0],y:i[1],z:n,distance:qt(t.distance,s,a),elevation:K(n,c,o)}}return u}function Kt(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;let{distance:r,elevation:i}=t,{statistics:a,spatialReference:o}=e,s=n(o),c=N(o);return{maxDistance:qt(a.maxDistance,s,r),minElevation:K(a.minElevation,c,i),maxElevation:K(a.maxElevation,c,i),avgElevation:K(a.avgElevation,c,i),elevationGain:K(a.elevationGain,c,i),elevationLoss:K(a.elevationLoss,c,i),maxPositiveSlope:a.maxPositiveSlope,maxNegativeSlope:a.maxNegativeSlope,avgPositiveSlope:a.avgPositiveSlope,avgNegativeSlope:a.avgNegativeSlope}}function qt(e,t,n){return e==null?null:d(e*t,`meters`,n)}function K(e,t,n){return e==null?null:d(e*t,`meters`,n)}var q=class extends _{constructor(e){super(e),this._getSamplesMemoized=we((e,t)=>Gt(e,t)),this._getStatisticsMemoized=we((e,t)=>Kt(e,t)),this.rawResult=null}get available(){let{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return Ut(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;let e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;let{rawResult:t,samples:n}=this;if(n==null||t==null)return null;let r=n.length;if(r===0)return null;let i=n[r-1].distance,a=Ht(n,e*i,e=>e.distance);if(a==null)return null;let{x:o,y:c,z:l}=a;return l==null?null:new s({x:o,y:c,z:l,spatialReference:t.spatialReference})}};O([a()],q.prototype,`available`,null),O([a({readOnly:!0})],q.prototype,`profile`,null),O([a({readOnly:!0})],q.prototype,`progress`,null),O([a()],q.prototype,`samples`,null),O([a()],q.prototype,`statistics`,null),O([a({constructOnly:!0})],q.prototype,`computation`,void 0),O([a()],q.prototype,`rawResult`,void 0),O([a()],q.prototype,`hoveredPoint`,null),q=O([S(`esri.views.analysis.ElevationProfile.ElevationProfileResult`)],q);var J=class extends i{constructor(e){super(e),this.result=new q({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([j(()=>{let{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),ie)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return L().defaultDemResolution}};O([a({constructOnly:!0})],J.prototype,`controller`,void 0),O([a({constructOnly:!0})],J.prototype,`profile`,void 0),O([a({constructOnly:!0})],J.prototype,`onInvalidate`,void 0),O([a()],J.prototype,`result`,void 0),O([a({readOnly:!0})],J.prototype,`progress`,null),O([a()],J.prototype,`hoveredPoint`,null),O([a()],J.prototype,`available`,null),O([a()],J.prototype,`numSamplesForPreview`,void 0),O([a()],J.prototype,`numSamplesPerChunk`,void 0),O([a({readOnly:!0})],J.prototype,`minDemResolution`,null),J=O([S(`esri.views.analysis.ElevationProfile.ElevationProfileLineComputation`)],J);function Jt(e){if(e==null)return null;if(ce(e))return Yt(e);let t=e.tileInfo;if(t==null)return null;let r=t.lods?.at(-1);return r==null?null:r.resolution*n(t.spatialReference)}function Yt(e){if(e==null)return null;let t=e.layers.items.map(Xt).filter(ve);return ue(t)??null}function Xt(e){return e&&`tileInfo`in e?Jt(e):null}var Y=class extends J{constructor(){super(...arguments),this.type=`ground`,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=V(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),l),this._getStableGroundLayers=V(()=>this._ground?.layers?.toArray(),l)}get minDemResolution(){return Yt(this._ground)}get available(){return!0===this._ground?.layers.some(e=>e.visible)}initialize(){this.addHandles([j(()=>this._queryElevationDependencies,()=>this.onInvalidate(this)),j(()=>this._ground,e=>{e&&!e.loaded&&e.load()},{initial:!0})])}async queryElevation(e,t){let n=this._queryElevationDependencies;if(n==null)throw Error(`${this.declaredClass}: no dependencies`);let{ground:r}=n;if(r==null)throw Error(`No ground configured in the view`);let i=await r.queryElevation(e,t),a=N(e.spatialReference),o=N(r.layers.at(0).spatialReference);if(a!==o){let e=i.geometry;e.points=e.points.map(([e,n,r])=>[e,n,r===t.noDataValue?r:r*o/a])}return i}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};O([a()],Y.prototype,`minDemResolution`,null),O([a()],Y.prototype,`available`,null),O([a()],Y.prototype,`_queryElevationDependencies`,null),O([a()],Y.prototype,`_ground`,null),Y=O([S(`esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation`)],Y);function Zt(e){return e?.map?.allLayers?.toArray().filter(e=>(e.type!==`graphics`||!e.internal)&&e.visible).map(e=>e.uid)??[]}var X=class extends J{constructor(){super(...arguments),this.type=`input`,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=V(()=>{let{view:e}=this.controller;if(!e)return null;let t=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:t,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},l),this._getStableElevationInfo=V(()=>this.controller.elevationInfo,h),this._getStableSpatialReference=V(()=>this.controller.view?.spatialReference,h),this._getStableLayerIds=V(()=>{let{view:e}=this.controller;return e.type===`3d`?Zt(e):[]},l)}initialize(){let e=()=>this.onInvalidate(this);this.addHandles([j(()=>this._queryElevationDependencies,e,ie),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:n}){let r=this._queryElevationDependencies;if(r==null)throw Error(`${this.declaredClass}: no dependencies`);let{view:i,spatialReference:a}=r;if(this._requiresElevationAlignment&&i.type===`3d`&&a){let r=await ke.fromGeometry(e).project(a,n);if(!r)return{geometry:e,noDataValue:t};let o=i.elevationProvider;return r.coordinates.forEach(e=>{e.z=o.getElevation(e.x,e.y,0,a,`ground`)??0}),{geometry:r.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode===`on-the-ground`&&this.controller.view.type===`3d`}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};O([a()],X.prototype,`_queryElevationDependencies`,null),X=O([S(`esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation`)],X);var Z=class extends J{constructor(){super(...arguments),this.type=`query`,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return Jt(this.profile.source)}get available(){let{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(e=>e.visible))}initialize(){this.addHandles(j(()=>this.profile.source,()=>this.onInvalidate(this),ie))}queryElevation(e,t){if(!this.profile.source)throw Error(`No source configured for the elevation profile line`);return this.profile.source.queryElevation(e,t)}};O([a({readOnly:!0})],Z.prototype,`minDemResolution`,null),O([a()],Z.prototype,`available`,null),Z=O([S(`esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation`)],Z);var Qt=de.ofType(Re);function $t(e,t){let n=F(t?.excludeInternal?()=>e.map?.allLayers.filter(e=>!(`internal`in e)||!e.internal):()=>e.map?.allLayers,e=>new Re({layer:e}),{recycleItems:!0,createCollection:()=>new Qt}),r=new Le({enabled:!0,selfEnabled:t?.selfEnabled??!1,featureEnabled:!0,featureSources:n,distance:t?.distance??Be.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??Be.touchSensitivityMultiplier});return{...he(n),options:r}}var Q=class extends i{constructor(e){super(e),this._sketchViewModels=new de,this._updatingHandles=new Se,this._operationManager=new Me}initialize(){let{view:e}=this;this._allLayerSnappingOptions=$t(this.view,{selfEnabled:!0,excludeInternal:!0}),this._graphicsLayer=new Oe({listMode:`hide`,internal:!0}),this.addHandles([j(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:e,internalGraphicsLayer:t,state:n,geometryVisualizationVisible:r,visible:i})=>{tn(e,t);let a=this.sketchGraphic;switch(a&&(a.visible=i),n){case`idle`:case`reshaping-disabled`:a&&!r&&(a.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case`reshaping`:le(this._startReshape());break;case`awaiting-sketch`:this.analysisViewData.interactive=!0}},k),j(()=>this._analysis.elevationInfo,e=>{this._graphicsLayer.elevationInfo=e},k),this._allLayerSnappingOptions])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(e=>D(e));let e=this._graphicsLayer;this.view.map?.remove(e),e.destroy()}get sketchGraphic(){return this._get(`sketchGraphic`)}set sketchGraphic(e){e!==this._get(`sketchGraphic`)&&(this._set(`sketchGraphic`,e),this._updateAnalysisFromSketchGraphic())}get state(){let{visible:e,interactive:t}=this.analysisViewData;if(!e)return`idle`;switch(this._operationManager.currentOperationType){case`place`:return this._sketching?`sketching`:`awaiting-sketch`;case`pick-feature`:return`picking`;default:return this._analysis.geometry?t?`reshaping`:`reshaping-disabled`:`idle`}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return en(this.view.type)}place(e){return this._operationManager.start(`place`,async t=>{let n=this._createSketchViewModel(),r=this._analysis.clone();this._ensureUpdatedSketchGraphic();let i=this.sketchGraphic,a=this._analysis.elevationInfo,o=M(()=>{this.sketchGraphic===i&&(this._graphicsLayer.elevationInfo=a)}),s=n.on(`create`,e=>{switch(e.state){case`start`:this._graphicsLayer.removeAll(),this.sketchGraphic=e.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case`active`:this._updateAnalysisFromSketchGraphic();break;case`complete`:this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case`cancel`:t.stop()}});t.handles.push(s,M(()=>(s.remove(),n.destroy(),this._sketchViewModels.remove(n),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?ne(e)||r.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),o),this._graphicsLayer.elevationInfo=nn,await this._updatingHandles.addPromise(le(n.create(`polyline`)))},e)}async pickFeature(e){return this._operationManager.start(`pick-feature`,async e=>{let{view:t}=this;t.closePopup();let n=null;e.handles.push(t.on(`immediate-click`,r=>{r.defer(async()=>{n?.abort(),n=y(async n=>{let{results:i}=await t.hitTest(r);A(n);let a=null;for(let e of i)if(e.type===`graphic`&&at(e.graphic)&&!lt(e.graphic)){a=e.graphic;break}a&&(r.preventDefault(),r.stopPropagation(),this.sketchGraphic=null,this._analysis.setGeometryFromFeature(a),e.resolve({feature:a}),e.stop())}),await n.promise})},ge.TOOL),t.on(`key-down`,t=>{be(t)&&(e.reject(),e.stop())},ge.TOOL),t.acquireCursor(`crosshair`,`high`),M(()=>{n?.abort(),e.reject()})),t.focus()},e)}_startReshape(){let e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start(`reshape`,async t=>{let n=()=>{let t=this._ensureUpdatedSketchGraphic();return t?this._updatingHandles.addPromise(e.update(t,{tool:`reshape`})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;let r=e.on(`update`,e=>{this._updateAnalysisFromSketchGraphic(),e.state===`complete`&&(this.state===`reshaping`?le(n()):t.resolve())});t.handles.push(r,M(()=>{r.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await n()})}_createSketchViewModel(){return new ze({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:`click`,hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:`none`},toggleToolOnClick:!1,tool:`reshape`},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol,snappingOptions:this._allLayerSnappingOptions.options})}_ensureUpdatedSketchGraphic(){let{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;let t=this.sketchGraphic??=new g({symbol:this._lineSymbol,geometry:e});return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){let{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(t=>t!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let e=this.sketchGraphic?.geometry;st(e)||(e=null);let t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function en(e){if(e===`2d`){let e={type:`CIMSolidStroke`,enable:!0,capStyle:`Butt`,joinStyle:`Round`,width:1.5};return new xe({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{...e,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[5,4],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],color:[0,0,0,255]},{...e,color:[255,255,255,255]}]}}})}return new C({color:[0,0,0,0]})}function tn(e,t){t&&(t.removeFromParent(),e?.add(t))}O([a({constructOnly:!0})],Q.prototype,`analysisViewData`,void 0),O([a({constructOnly:!0})],Q.prototype,`view`,void 0),O([a()],Q.prototype,`sketchGraphic`,null),O([a({nonNullable:!0})],Q.prototype,`state`,null),O([a()],Q.prototype,`updating`,null),O([a()],Q.prototype,`_sketching`,null),O([a()],Q.prototype,`_analysis`,null),O([a()],Q.prototype,`_lineSymbol`,null),Q=O([S(`esri.views.analysis.ElevationProfile.ElevationProfileTool`)],Q);var nn=new Ce({mode:`on-the-ground`,offset:0}),$=class extends je{constructor(e){super(e),this.type=`elevation-profile-view-2d`,this.analysis=null,this.hoveredPosition=null}initialize(){let{analysis:e,view:n}=this;this._controller=new G({analysis:e,analysisViewData:this,view:n,computationFactory:{create:e=>{switch(e.profile.type){case`ground`:return new Y(e);case`input`:return new X(e);case`query`:return new Z(e);case`scene`:throw new t(`elevation-profile-analysis-view-2d:unsupported`,`The scene profile line type is not supported in 2D views.`)}}}}),this._visualization=new B({view:n,analysisViewData:this}),this._sketchTool=new Q({view:n,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:`meters`,elevation:`meters`}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return!0===this._controller?.updating||!0===this._visualization?.updating||!0===this._sketchTool?.updating}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??`idle`}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};O([a({readOnly:!0})],$.prototype,`type`,void 0),O([a({constructOnly:!0,nonNullable:!0})],$.prototype,`analysis`,void 0),O([a({readOnly:!0})],$.prototype,`effectiveDisplayUnits`,null),O([a({readOnly:!0})],$.prototype,`error`,null),O([a()],$.prototype,`hoveredPosition`,void 0),O([a()],$.prototype,`hoveredPoints`,null),O([a({readOnly:!0})],$.prototype,`progress`,null),O([a({readOnly:!0})],$.prototype,`results`,null),O([a({readOnly:!0})],$.prototype,`statistics`,null),O([a({readOnly:!0})],$.prototype,`updating`,null),O([a()],$.prototype,`sketchGraphic`,null),O([a()],$.prototype,`toolState`,null),O([a()],$.prototype,`_controller`,void 0),O([a()],$.prototype,`_visualization`,void 0),O([a()],$.prototype,`_sketchTool`,void 0),$=O([S(`esri.views.2d.analysis.ElevationProfileAnalysisView2D`)],$);var rn=$;export{rn as default};