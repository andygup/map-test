import{$w as e,DT as t,Jp as n,OT as r,Q_ as i,_w as a,eT as o,ev as s,gD as c,nv as l}from"./index-CZ4oMP1N.js";import"./quatf64-BJJPhW0N.js";import"./plane-Bg1a5O73.js";import"./vectorStacks-FfDNcZoS.js";import"./dehydratedPoint-rdg1UAtQ.js";import{t as u}from"./memoize-BNsZjv91.js";import{a as d}from"./elevationInfoUtils-9csVBlEH.js";import"./ObjectStack-CBI5g-Qc.js";import"./ray-CWXoVP-g.js";import"./geodesicUtils-CbiJFASl.js";import"./LineSnappingHint-BOeMI0cS.js";import{i as f}from"./snappingUtils-Od8uWW_a.js";import"./vec3-zq4-AU_O.js";import"./sphere-9YfqUkuX.js";import"./constraints-Bf0IRs4G.js";import"./SnappingCandidate-B4WtOFZq.js";import"./EdgeSnappingCandidate-BfgKjc_Z.js";import"./DrapedEdgeSnappingCandidate-BWx5lQgf.js";import"./PointSnappingHint-DvioR9Jz.js";import"./VertexSnappingCandidate-CFon9yk0.js";import{n as p,t as m}from"./queryEngineUtils-C-2iwciK.js";import{n as h,r as g,t as _}from"./symbologySnappingCandidates-CpRcGH2C.js";var v=class extends a{get availability(){return 1}get _snappingElevationAligner(){let{view:t}=this,{layer:n}=this.layerSource,r=t!=null&&t.type===`3d`;return!r||n.type===`subtype-group`?g():g(r,{elevationInfo:n.elevationInfo,alignPointsInFeatures:async(r,i)=>(await e(t.whenLayerView(n),i)).elevationAlignPointsInFeatures(r,i)})}get _snappingElevationFilter(){let{view:e}=this,t=e!=null&&e.type===`3d`&&this.layerSource.layer.type!==`subtype-group`;return h(t)}get _symbologySnappingFetcher(){let{view:e}=this,{layer:t}=this.layerSource;return e!=null&&e.type===`3d`&&t.type!==`subtype-group`?_(this._symbologySnappingSupported,async(n,r)=>{let i=await e.whenLayerView(t);return o(r),i.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},r)}):_()}get _layerView(){let{view:e}=this;if(e==null)return null;let{layer:t}=this.layerSource;return e.allLayerViews.find(e=>e.layer===t)}get _layerView3D(){let{view:e}=this;return e==null||e.type===`2d`?null:this._layerView}get _symbologySnappingSupported(){return this._layerView3D!=null&&this._layerView3D.symbologySnappingSupported}initialize(){let{view:e}=this,{layer:t}=this.layerSource;e!=null&&e.type===`3d`&&t.type!==`subtype-group`&&this.addHandles([e.elevationProvider.on(`elevation-change`,({context:e})=>{let{elevationInfo:n}=t;d(e,n)&&this._snappingElevationAligner.notifyElevationSourceChange()}),l(()=>t.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),s),l(()=>this._layerView3D==null?null:this._layerView3D.layer?.renderer,()=>this._symbologySnappingFetcher.notifySymbologyChange(),s),i(()=>this._layerView3D?.layer,[`edits`,`apply-edits`],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=u(m)}refresh(){}async fetchCandidates(e,t){let{layer:r}=this.layerSource,{source:i}=r;if(!i?.querySnapping)return[];let a=r.createQuery();this._layerView&&`effectiveDisplayFilter`in this._layerView&&(a.where=n(a.where,this._layerView.effectiveDisplayFilter?.where));let s=`returnZ`in r?r.returnZ:void 0,c=f({parameters:e,mode:this.view?.type??`2d`,returnZ:s,filter:a}),l=await i.querySnapping(c,{signal:t});o(t);let u=e.coordinateHelper.spatialReference,d=await this._snappingElevationAligner.alignCandidates(l.candidates,u,t);o(t);let m=await this._symbologySnappingFetcher.fetch(d,t);o(t);let h=m.length===0?d:[...d,...m],g=this._snappingElevationFilter.filter(c,h),_=this._memoizedMakeGetGroundElevation(this.view,u);return g.map(e=>p(e,_))}};c([t({constructOnly:!0})],v.prototype,`layerSource`,void 0),c([t({constructOnly:!0})],v.prototype,`view`,void 0),c([t()],v.prototype,`_snappingElevationAligner`,null),c([t()],v.prototype,`_snappingElevationFilter`,null),c([t()],v.prototype,`_symbologySnappingFetcher`,null),c([t()],v.prototype,`_layerView`,null),c([t()],v.prototype,`_layerView3D`,null),c([t()],v.prototype,`_symbologySnappingSupported`,null),v=c([r(`esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource`)],v);export{v as FeatureCollectionSnappingSource};