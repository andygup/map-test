import{Aw as e,BT as t,VT as n,dv as r,fT as i,im as a,kD as o,lv as s,pT as c,pv as l}from"./index-BN8X5Ryz.js";import"./quatf64-D37SEdPg.js";import"./plane-Da5EsY0J.js";import"./vectorStacks-Cuo89CNO.js";import"./dehydratedPoint-CWZQBefp.js";import{t as u}from"./memoize-Dl61_jt0.js";import{a as d}from"./elevationInfoUtils-uoMH3ofe.js";import"./ObjectStack-l5kM7JZu.js";import"./ray-LkJ58wpZ.js";import"./geodesicUtils-D99LxQ6q.js";import"./LineSnappingHint-CmFAetWF.js";import{i as f}from"./snappingUtils-D3oTIKrZ.js";import"./vec3-B94Y7ih2.js";import"./sphere-d9-4vNcj.js";import"./constraints-Ch5tsKD8.js";import"./SnappingCandidate-DueCLuvH.js";import"./EdgeSnappingCandidate-CCg5Xb97.js";import"./DrapedEdgeSnappingCandidate-CqXt8QLN.js";import"./PointSnappingHint-F2JtYtXH.js";import"./VertexSnappingCandidate-DgxoZtvD.js";import{n as p,t as m}from"./queryEngineUtils-D9pJ9DzT.js";import{n as h,r as g,t as _}from"./symbologySnappingCandidates-B-0zt98i.js";var v=class extends e{get availability(){return 1}get _snappingElevationAligner(){let{view:e}=this,{layer:t}=this.layerSource,n=e!=null&&e.type===`3d`;return!n||t.type===`subtype-group`?g():g(n,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(n,r)=>(await i(e.whenLayerView(t),r)).elevationAlignPointsInFeatures(n,r)})}get _snappingElevationFilter(){let{view:e}=this,t=e!=null&&e.type===`3d`&&this.layerSource.layer.type!==`subtype-group`;return h(t)}get _symbologySnappingFetcher(){let{view:e}=this,{layer:t}=this.layerSource;return e!=null&&e.type===`3d`&&t.type!==`subtype-group`?_(this._symbologySnappingSupported,async(n,r)=>{let i=await e.whenLayerView(t);return c(r),i.queryForSymbologySnapping({candidates:n,spatialReference:e.spatialReference},r)}):_()}get _layerView(){let{view:e}=this;if(e==null)return null;let{layer:t}=this.layerSource;return e.allLayerViews.find(e=>e.layer===t)}get _layerView3D(){let{view:e}=this;return e==null||e.type===`2d`?null:this._layerView}get _symbologySnappingSupported(){return this._layerView3D!=null&&this._layerView3D.symbologySnappingSupported}initialize(){let{view:e}=this,{layer:t}=this.layerSource;e!=null&&e.type===`3d`&&t.type!==`subtype-group`&&this.addHandles([e.elevationProvider.on(`elevation-change`,({context:e})=>{let{elevationInfo:n}=t;d(e,n)&&this._snappingElevationAligner.notifyElevationSourceChange()}),l(()=>t.elevationInfo,()=>this._snappingElevationAligner.notifyElevationSourceChange(),r),l(()=>this._layerView3D==null?null:this._layerView3D.layer?.renderer,()=>this._symbologySnappingFetcher.notifySymbologyChange(),r),s(()=>this._layerView3D?.layer,[`edits`,`apply-edits`],()=>this._symbologySnappingFetcher.notifySymbologyChange())])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=u(m)}refresh(){}async fetchCandidates(e,t){let{layer:n}=this.layerSource,{source:r}=n;if(!r?.querySnapping)return[];let i=n.createQuery();this._layerView&&`effectiveDisplayFilter`in this._layerView&&(i.where=a(i.where,this._layerView.effectiveDisplayFilter?.where));let o=`returnZ`in n?n.returnZ:void 0,s=f({parameters:e,mode:this.view?.type??`2d`,returnZ:o,filter:i}),l=await r.querySnapping(s,{signal:t});c(t);let u=e.coordinateHelper.spatialReference,d=await this._snappingElevationAligner.alignCandidates(l.candidates,u,t);c(t);let m=await this._symbologySnappingFetcher.fetch(d,t);c(t);let h=m.length===0?d:[...d,...m],g=this._snappingElevationFilter.filter(s,h),_=this._memoizedMakeGetGroundElevation(this.view,u);return g.map(e=>p(e,_))}};o([t({constructOnly:!0})],v.prototype,`layerSource`,void 0),o([t({constructOnly:!0})],v.prototype,`view`,void 0),o([t()],v.prototype,`_snappingElevationAligner`,null),o([t()],v.prototype,`_snappingElevationFilter`,null),o([t()],v.prototype,`_symbologySnappingFetcher`,null),o([t()],v.prototype,`_layerView`,null),o([t()],v.prototype,`_layerView3D`,null),o([t()],v.prototype,`_symbologySnappingSupported`,null),v=o([n(`esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource`)],v);export{v as FeatureCollectionSnappingSource};