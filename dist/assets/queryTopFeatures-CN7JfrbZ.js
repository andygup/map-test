import{FC as e,Rv as t,TS as n,ZS as r,ga as i,kC as a,xu as o}from"./index-BN8X5Ryz.js";import{t as s}from"./urlUtils-CW4cnJ3W.js";var c=`Layer does not support extent calculation.`;function l(e,r){let i=e.geometry,a=e.toJSON(),o=a;if(i!=null&&(o.geometry=JSON.stringify(i),o.geometryType=t(i),o.inSR=n(i.spatialReference)),a.topFilter?.groupByFields&&(o.topFilter.groupByFields=a.topFilter.groupByFields.join(`,`)),a.topFilter?.orderByFields&&(o.topFilter.orderByFields=a.topFilter.orderByFields.join(`,`)),a.topFilter&&(o.topFilter=JSON.stringify(o.topFilter)),a.objectIds&&(o.objectIds=a.objectIds.join(`,`)),a.orderByFields&&(o.orderByFields=a.orderByFields.join(`,`)),a.outFields&&!(r?.returnCountOnly||r?.returnExtentOnly||r?.returnIdsOnly)?a.outFields.includes(`*`)?o.outFields=`*`:o.outFields=a.outFields.join(`,`):delete o.outFields,a.outSR?o.outSR=n(a.outSR):i&&a.returnGeometry&&(o.outSR=o.inSR),a.returnGeometry&&delete a.returnGeometry,a.timeExtent){let e=a.timeExtent,{start:t,end:n}=e;t==null&&n==null||(o.time=t===n?t:`${t??`null`},${n??`null`}`),delete a.timeExtent}return o}async function u(e,t,n,r){let a=await m(e,t,`json`,r);return i(t,n,a.data),a}async function d(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:m(e,t,`json`,n,{returnIdsOnly:!0})}async function f(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:m(e,t,`json`,n,{returnExtentOnly:!0,returnCountOnly:!0}).then(e=>{let t=e.data;if(t.hasOwnProperty(`extent`))return e;if(t.features||t.hasOwnProperty(`count`))throw Error(c);return e})}function p(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):m(e,t,`json`,n,{returnIdsOnly:!0,returnCountOnly:!0})}function m(t,n,i,c={},u={}){let d=typeof t==`string`?a(t):t,f=n.geometry?[n.geometry]:[];return c.responseType=`json`,o(f,null,c).then(t=>{let a=t?.[0];a!=null&&((n=n.clone()).geometry=a);let o=s({...d.query,f:i,...u,...l(n,u)});return r(e(d.path,`queryTopFeatures`),{...c,query:{...o,...c.query}})})}export{u as i,f as n,d as r,p as t};