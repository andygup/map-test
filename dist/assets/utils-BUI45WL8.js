import{A_ as e,B_ as t,D_ as n,E_ as r,M_ as i,Op as a,P_ as o,Up as s,gp as c,j_ as l,k_ as u,zp as d}from"./index-CzMixifc.js";var f=`,`,p={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},m=new Set([`integer`,`small-integer`]),h=null;function g(e){return c(e)||a(e)||d(e)}async function _(e){let{field:t,field2:n,field3:r,normalizationField:i,valueExpression:a,fields:o}=e,c=[];if(a){if(!h){let{arcadeUtils:e}=await s();h=e}c=h.extractFieldNames(a)}return t&&c.push(t),n&&c.push(n),r&&c.push(r),i&&c.push(i),o&&c.push(...o),c}function v(e){return String(e).padStart(2,`0`)}function y(e,t,n){let r;return t===`date`||t===`number`?(t===`number`&&(e=new Date(e)),r=`TIMESTAMP'${n?e.getFullYear():e.getUTCFullYear()}-${v((n?e.getMonth():e.getUTCMonth())+1)}-${v(n?e.getDate():e.getUTCDate())} ${v(n?e.getHours():e.getUTCHours())}:${v(n?e.getMinutes():e.getUTCMinutes())}:${v(n?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function b(e,t,n,r){let{hasQueryEngine:i}=e,a=`(${y(n,x(e,n),i)} - ${y(t,x(e,t),i)})`,o=p[r],s=`/`;return o<1&&(o=1/o,s=`*`),{sqlExpression:o===1?a:`(${a} ${s} ${o})`,sqlWhere:null}}function x(e,t){if(t instanceof Date)return`date`;if(typeof t==`number`)return`number`;if(typeof t==`string`){let n=e.getField(t);if(t.toLowerCase()===`<now>`)return;if(c(n))return`field`}}function S(e,t){let n=t&&e.getField(t);return!!n&&m.has(n.type)}function C(e){return`cast(${e} as float)`}function w(t,a){let{format:s,fieldFormat:c,timeZoneOptions:d,fieldType:f}=a??{},p=c?r(c):null,m,h;if(d&&({timeZone:m,timeZoneName:h}=o(d.layerTimeZone,d.datesInUnknownTimezone,d.viewTimeZone,p||n(s||`short-date-short-time`),f)),typeof t==`string`&&isNaN(Date.parse(f===`time-only`?`1970-01-01T${t}Z`:t)))return t;switch(f){case`date-only`:{let e=p||n(s||`short-date`);return typeof t==`string`?i(t,{...e}):l(t,{...e,timeZone:`UTC`})}case`time-only`:{let e=p||n(s||`short-time`);return typeof t==`string`?u(t,e):l(t,{...e,timeZone:`UTC`})}case`timestamp-offset`:{if(!m&&typeof t==`string`&&new Date(t).toISOString()!==t)return t;let r=s||p||d?p||n(s||`short-date-short-time`):void 0,i=r?{...r,timeZone:m,timeZoneName:h}:void 0;return typeof t==`string`?e(t,i):l(t,i)}default:{let e=s||p||d?p||n(s||`short-date-short-time`):void 0;return l(typeof t==`string`?new Date(t):t,e?{...e,timeZone:m,timeZoneName:h}:void 0)}}}export{f as a,g as i,S as n,_ as o,C as r,w as s,b as t};