import{A as e,BT as t,DT as n,Dh as r,Ha as i,L as a,OT as o,PT as s,RS as c,ax as l,bg as u,gD as d,j as f,px as p,tx as m,uE as h,ua as g,wT as _,wx as v,xg as y,yg as b}from"./index-CzMixifc.js";import{t as x}from"./imageBitmapUtils-DL-p4JOA.js";var S,C=new u(0,0,0),w=S=class extends g(e(f(r))){constructor(){super(...arguments),this.tileInfo=b.create({spatialReference:v.WebMercator,size:256}),this.type=`base-tile`,this.fullExtent=new l(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,v.WebMercator),this.spatialReference=v.WebMercator}addResolvingPromise(e){super.addResolvingPromise(e)}getTileBounds(e,t,n,r){let i=r||m();return C.level=e,C.row=t,C.col=n,C.extent=i,this.tileInfo.updateTileInfo(C),i}fetchTile(e,t,n,r={}){let{signal:i}=r,a=this.getTileUrl(e,t,n),o={responseType:`image`,signal:i,query:{...this.refreshParameters}};return c(a??``,o).then(e=>e.data)}async fetchImageBitmapTile(e,t,n,r={}){let{signal:i}=r;if(this.fetchTile!==S.prototype.fetchTile){let a=await this.fetchTile(e,t,n,r);return x(a,e,t,n,i)}let a=this.getTileUrl(e,t,n)??``,o={responseType:`blob`,signal:i,query:{...this.refreshParameters}},{data:s}=await c(a,o);return x(s,e,t,n,i)}getTileUrl(){throw new t(`basetilelayer:gettileurl-not-implemented`,`getTileUrl() is not implemented`)}};d([n({type:b})],w.prototype,`tileInfo`,void 0),d([n({type:[`show`,`hide`]})],w.prototype,`listMode`,void 0),d([n({readOnly:!0,value:`base-tile`})],w.prototype,`type`,void 0),d([n({nonNullable:!0})],w.prototype,`fullExtent`,void 0),d([n({type:v})],w.prototype,`spatialReference`,void 0),w=S=d([o(`esri.layers.BaseTileLayer`)],w);var T=new s({BingMapsAerial:`aerial`,BingMapsRoad:`road`,BingMapsHybrid:`hybrid`}),E=`https://dev.virtualearth.net`;_(h.getLogger(`esri.layers.BingMapsLayer`),`esri.layers.BingMapsLayer`,{version:`4.33`,warnOnce:!0});var D=class extends a(i(w)){constructor(e){super(e),this.type=`bing-maps`,this.tileInfo=new b({size:[256,256],dpi:96,origin:new p({x:-20037508.342787,y:20037508.342787,spatialReference:v.WebMercator}),spatialReference:v.WebMercator,lods:[new y({level:1,resolution:78271.5169639999,scale:295828763.795777}),new y({level:2,resolution:39135.7584820001,scale:147914381.897889}),new y({level:3,resolution:19567.8792409999,scale:73957190.948944}),new y({level:4,resolution:9783.93962049996,scale:36978595.474472}),new y({level:5,resolution:4891.96981024998,scale:18489297.737236}),new y({level:6,resolution:2445.98490512499,scale:9244648.868618}),new y({level:7,resolution:1222.99245256249,scale:4622324.434309}),new y({level:8,resolution:611.49622628138,scale:2311162.217155}),new y({level:9,resolution:305.748113140558,scale:1155581.108577}),new y({level:10,resolution:152.874056570411,scale:577790.554289}),new y({level:11,resolution:76.4370282850732,scale:288895.277144}),new y({level:12,resolution:38.2185141425366,scale:144447.638572}),new y({level:13,resolution:19.1092570712683,scale:72223.819286}),new y({level:14,resolution:9.55462853563415,scale:36111.909643}),new y({level:15,resolution:4.77731426794937,scale:18055.954822}),new y({level:16,resolution:2.38865713397468,scale:9027.977411}),new y({level:17,resolution:1.19432856685505,scale:4513.988705}),new y({level:18,resolution:.597164283559817,scale:2256.994353}),new y({level:19,resolution:.298582141647617,scale:1128.497176}),new y({level:20,resolution:.1492910708238085,scale:564.248588})]}),this.key=null,this.style=`road`,this.culture=`en-US`,this.region=null,this.portalUrl=null,this.hasAttributionData=!0}get bingMetadata(){return this._get(`bingMetadata`)}set bingMetadata(e){this._set(`bingMetadata`,e)}get copyright(){return this.bingMetadata==null?null:this.bingMetadata.copyright}get operationalLayerType(){return T.toJSON(this.style)}get bingLogo(){return this.bingMetadata==null?null:this.bingMetadata.brandLogoUri}load(e){return this.key?this.addResolvingPromise(this._getMetadata()):this.portalUrl?this.addResolvingPromise(this._getPortalBingKey().then(()=>this._getMetadata())):this.addResolvingPromise(Promise.reject(new t(`bingmapslayer:load`,`Bing layer must have bing key.`))),Promise.resolve(this)}getTileUrl(e,t,n){if(!this.loaded||this.bingMetadata==null)return null;let r=this.bingMetadata.resourceSets[0].resources[0],i=r.imageUrlSubdomains[t%r.imageUrlSubdomains.length],a=this._getQuadKey(e,t,n);return r.imageUrl.replace(`{subdomain}`,i).replace(`{quadkey}`,a)}async fetchAttributionData(){return this.load().then(()=>this.bingMetadata==null?null:{contributors:this.bingMetadata.resourceSets[0].resources[0].imageryProviders.map(e=>({attribution:e.attribution,coverageAreas:e.coverageAreas.map(e=>({zoomMin:e.zoomMin-(e.zoomMin?1:0),zoomMax:e.zoomMax-(e.zoomMin?1:0),score:1,bbox:[e.bbox[0],e.bbox[1],e.bbox[2],e.bbox[3]]}))}))})}_getMetadata(){let e={road:`roadOnDemand`,aerial:`aerial`,hybrid:`aerialWithLabelsOnDemand`}[this.style];return c(`${E}/REST/v1/Imagery/Metadata/${e}`,{responseType:`json`,query:{include:`ImageryProviders`,uriScheme:`https`,key:this.key,suppressStatus:!0,output:`json`,culture:this.culture,userRegion:this.region}}).then(e=>{let n=e.data;if(n.statusCode!==200)throw new t(`bingmapslayer:getmetadata`,n.statusDescription);if(this.bingMetadata=n,this.bingMetadata.resourceSets.length===0)throw new t(`bingmapslayer:getmetadata`,`no bing resourcesets`);if(this.bingMetadata.resourceSets[0].resources.length===0)throw new t(`bingmapslayer:getmetadata`,`no bing resources`)}).catch(e=>{throw new t(`bingmapslayer:getmetadata`,e.message)})}_getPortalBingKey(){return c(this.portalUrl??``,{responseType:`json`,authMode:`no-prompt`,query:{f:`json`}}).then(e=>{if(!e.data.bingKey)throw new t(`bingmapslayer:getportalbingkey`,`The referenced Portal does not contain a valid bing key`);this.key=e.data.bingKey}).catch(e=>{throw new t(`bingmapslayer:getportalbingkey`,e.message)})}_getQuadKey(e,t,n){let r=``;for(let i=e;i>0;i--){let e=0,a=1<<i-1;(n&a)!==0&&(e+=1),(t&a)!==0&&(e+=2),r+=e.toString()}return r}};d([n({json:{read:!1,write:!1},value:null})],D.prototype,`bingMetadata`,null),d([n({json:{read:!1,write:!1},value:`bing-maps`,readOnly:!0})],D.prototype,`type`,void 0),d([n({type:b})],D.prototype,`tileInfo`,void 0),d([n({type:String,readOnly:!0,json:{read:!1,write:!1}})],D.prototype,`copyright`,null),d([n({type:String,json:{write:!1,read:!1}})],D.prototype,`key`,void 0),d([n({type:T.apiValues,nonNullable:!0,json:{read:{source:`layerType`,reader:T.read}}})],D.prototype,`style`,void 0),d([n({type:[`BingMapsAerial`,`BingMapsHybrid`,`BingMapsRoad`]})],D.prototype,`operationalLayerType`,null),d([n({type:String,json:{write:!1,read:!1}})],D.prototype,`culture`,void 0),d([n({type:String,json:{write:!1,read:!1}})],D.prototype,`region`,void 0),d([n({type:String,json:{write:!0,read:!0}})],D.prototype,`portalUrl`,void 0),d([n({type:Boolean,json:{write:!1,read:!1}})],D.prototype,`hasAttributionData`,void 0),d([n({type:String,readOnly:!0})],D.prototype,`bingLogo`,null),D=d([o(`esri.layers.BingMapsLayer`)],D);var O=D;export{O as default};