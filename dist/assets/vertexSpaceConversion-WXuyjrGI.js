import{Bf as e,Ey as t,Gg as n,Il as r,Iy as i,Nm as a,Nx as o,Om as s,QC as c,Rf as l,Rm as u,SS as d,UC as f,Ux as p,al as m,c_ as h,dS as g,ew as _,fw as v,gS as ee,hm as te,jm as y,rl as ne,uE as re,ul as ie,xS as ae,yl as oe,yx as se,zy as b}from"./index-CzMixifc.js";import{a as ce,t as le}from"./meshVertexSpaceUtils-CrM2H6JB.js";import{n as x}from"./projectPointToVector-D72S8Uh5.js";import{t as S}from"./computeTranslationToOriginAndRotation-DwwRDWAD.js";import{x as C,z as w}from"./BufferView-BPABY7if.js";import{n as ue,o as T,s as E,t as D}from"./vec3-D13Z1xO0.js";import{i as de}from"./vec4-CJBDH7oG.js";import{n as fe,t as pe}from"./spatialReferenceEllipsoidUtils-b6wDfyu0.js";var me=`Projection may be possible after calling projection.load().`;function O(e,t,n,r){e.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${n.wkid}).${r?` `:``}${r}`)}function k(e,t,n,r,i,a){return z(0,C.fromTypedArray(e),0,w.fromTypedArray(t),n,w.fromTypedArray(r),i,C.fromTypedArray(a))?a:null}function A(e,t,n,r,i,a){return z(1,C.fromTypedArray(e),0,w.fromTypedArray(t),n,w.fromTypedArray(r),i,C.fromTypedArray(a))?a:null}function j(e,t,r,i){return n(e,t,0,r,i,0)?r:null}function M(e,t,r,i){return n(e,t,0,r,i,0)?r:null}function N(e,t,n){return i(U,n),T(t,e,U),_(U)&&ue(t,t),t}function P(e,t,n){return b(U,n),de(t,e,U),_(U)&&ue(t,t,4),t}function he(e,t,n,r){let i=t===0;return F(e,t,n,(e,t)=>{let n=Math.cos(v(e));t[0]=i?n:1/n,t[1]=1},r)}function ge(e,t,n,r){let i=t===0;return F(e,t,n,(e,t)=>{let n=Math.cosh(-e/f.radius);t[0]=1,t[1]=i?n:1/n},r)}function F(e,t,n,r,i){let a=t===0?3:4,o=[0,0];for(let t=0,s=1;t<e.length;t+=a,s+=3){r(n[s],o);let c=e[t]*o[0],l=e[t+1]*o[1],u=e[t+2],d=1/Math.sqrt(c*c+l*l+u*u);i[t]=c*d,i[t+1]=l*d,i[t+2]=u*d,a===4&&(i[t+3]=e[t+3])}return i}function I(e,t,n,r,i,a){if(!z(0,C.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),1,w.fromTypedArray(t),n,w.fromTypedArray(r),i,C.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let t=3;t<e.length;t+=4)a[t]=e[t];return a}function L(e,t,n,r,i,a){if(!z(1,C.fromTypedArray(e,16),1,w.fromTypedArray(t),n,w.fromTypedArray(r),i,C.fromTypedArray(a,16)))return null;for(let t=3;t<e.length;t+=4)a[t]=e[t];return a}function R(e,t,n,r,o){switch(S(r,n,H,r),e===1&&a(H,H),t){case 0:return i(o,H);case 1:return b(o,H)}}function z(e,t,n,r,i,a,o,s){if(!t)return;let c=r.count;if(_e(i))for(let r=0;r<c;r++)a.getVec(r,B),t.getVec(r,V),ie(V,V,R(e,n,B,o,U)),s.setVec(r,V);else for(let i=0;i<c;i++){a.getVec(i,B),t.getVec(i,V);let c=se(r.get(i,1)),l=Math.cos(c);n===1!=(e===0)&&(l=1/l),R(e,n,B,o,U),e===0?(U[0]*=l,U[1]*=l,U[2]*=l,U[3]*=l,U[4]*=l,U[5]*=l):(U[0]*=l,U[3]*=l,U[6]*=l,U[1]*=l,U[4]*=l,U[7]*=l),ie(V,V,U),ne(V,V),s.setVec(i,V)}return s}function _e(e){return e.isWGS84||ae(e)||g(e)||d(e)}var B=h(),V=h(),H=l(),U=t(),W=()=>re.getLogger(`esri.geometry.support.meshUtils.vertexSpaceConversion`);function ve(e,t,{vertexSpace:n,spatialReference:r}){if(n.type===`georeferenced`){let i=e;if(!x(t,i,r))return!1;let{origin:a}=n;return oe(e,i,a),!0}let i=pe(r),o=e;if(!x(t,o,i))return!1;let{origin:s}=n,c=$;if(!S(r,s,c,i))return!1;let l=a($,c);return l!=null&&(m(e,o,l),!0)}function ye(t,n,r){let{vertexSpace:i,transform:a,vertexAttributes:o}=t,s=ce(i)?a:null,c=J(t.spatialReference,r,3);if(le(i,n)&&(!s||te(s.localMatrix,e))&&Y(c)){let{position:e,normal:t,tangent:n}=o,i=r?.allowBufferReuse;return{position:i?e:e.slice(),normal:i?t:t?.slice(),tangent:i?n:n?.slice()}}switch(t.vertexSpace.type){case`local`:return n.type===`local`?we(t,t.vertexSpace,n.origin,r):xe(t,t.vertexSpace,n.origin,r);case`georeferenced`:return n.type===`local`?Se(t,t.vertexSpace,n.origin,r):be(t,t.vertexSpace,n.origin,r)}}function be({vertexAttributes:t,transform:n,spatialReference:i},{origin:a},o,s){let c=J(i,s,3),l=a||!Y(c)?u(Z,n?.localMatrix??e):null;l&&q(l,i,s,3);let{position:d,normal:f,tangent:p}=l?K(t,l):t,m=s?.allowBufferReuse,h=m?d:new Float64Array(d.length),g=d;if(a&&(g=D(h,g,a)),o){let e=r(Me,o);g=D(h,g,e)}return{position:g!==t.position||m?g:g.slice(),normal:f!==t.normal||m?f:f?.slice(),tangent:p!==t.tangent||m?p:p?.slice()}}function G(e,t){return t?.useEllipsoid&&ee(e)?fe:pe(e)}function xe({spatialReference:e,vertexAttributes:t,transform:n},{origin:i},a,o){let c=G(e,o);if(!S(e,i,Z,c))return O(W(),e,c),null;n&&s(Z,Z,n.localMatrix),q(Z,e,o,1);let l=new Float64Array(t.position.length),u=Te(t.position,Z,e,l,c);if(!u)return null;let d=Ee(u,e,l,c,t.normal,Z);if(t.normal&&!d)return null;let f=De(u,e,l,c,t.tangent,Z);if(t.tangent&&!f)return null;if(a){let e=r(Me,a);D(u,u,e)}return{position:u,normal:d,tangent:f}}function Se({vertexAttributes:e,spatialReference:t,transform:n},{origin:r},o,s){let c=G(t,s);if(!S(t,o,Z,c))return O(W(),t,c),null;let l=1/J(t,s,2);y(Z,Z,[l,l,l]);let u=a(Q,Z),{position:d,normal:f,tangent:p}=Ce(e,r,n),m=new Float64Array(d.length),h=Oe(d,t,u,m,c);if(!h)return null;let g=i(je,u),_=ke(f,d,t,m,c,g,f===e.normal?void 0:f);if(!_&&f)return null;let v=Ae(p,d,t,m,c,g,p===e.tangent?void 0:p);return!v&&p?null:{position:h,normal:_,tangent:v}}function Ce(e,t,n){if(!t)return e;if(!n){let{position:n,normal:r,tangent:i}=e;return{position:D(new Float64Array(n.length),n,t),tangent:i,normal:r}}let r=K(e,n.localMatrix);return D(r.position,r.position,t),r}function we({vertexAttributes:e,spatialReference:t,transform:n},{origin:r},i,o){let c=G(t,o);if(!S(t,r,Z,c))return O(W(),t,c),null;if(n&&s(Z,Z,n.localMatrix),!S(t,i,Q,c))return O(W(),c,t),null;a(Q,Q);let l=s(Z,Q,Z);return q(l,t,o,3),K(e,l)}function K(e,t){let n=new Float64Array(e.position.length);E(n,e.position,t);let r=e.normal?new Float32Array(e.normal.length):null,i=e.tangent?new Float32Array(e.tangent.length):null;return r&&e.normal&&N(e.normal,r,t),i&&e.tangent&&P(e.tangent,i,t),{position:n,normal:r,tangent:i}}function Te(e,t,n,r,i){E(r,e,t);let a=new Float64Array(e.length);return M(r,i,a,n)?a:(O(W(),i,n),null)}function Ee(e,t,n,r,i,a){if(i==null)return null;let o=new Float32Array(i.length);return N(i,o,a),A(o,e,t,n,r,o)?o:(O(W(),r,t),null)}function De(e,t,n,r,i,a){if(i==null)return null;let o=new Float32Array(i.length);return P(i,o,a),L(o,e,t,n,r,o)?o:(O(W(),r,t),null)}function q(e,t,n,r){let i=J(t,n,r);Y(i)||y(e,e,[i,i,i])}function J(e,t,n){let r=!!(1&n),i=!!(2&n),a=t?.sourceUnit,o=t?.targetUnit;if(!a&&!o)return 1;let s=X(a,e);r||!a||Y(s)||(W().warn(`source unit conversion not supported`),s=1);let c=1/X(o,e);return i||!o||Y(c)||(W().warn(`target unit conversion not supported`),c=1),s*c}function Y(e){return c(e,1)}function Oe(e,t,n,r,i){let a=j(e,t,r,i);if(!a)return O(W(),t,i),null;let o=new Float64Array(a.length);return E(o,a,n),o}function ke(e,t,n,r,i,a,o){if(e==null)return null;let s=o??new Float32Array(e.length);return k(e,t,n,r,i,s)?(T(s,s,a),s):(O(W(),n,i),null)}function Ae(e,t,n,r,i,a,o){if(e==null)return null;let s=o??new Float32Array(e.length);return I(e,t,n,r,i,s)?(T(s,s,a,4),s):(O(W(),n,i),null)}function X(e,t){if(e==null)return 1;let n=p(t);return 1/o(n,`meters`,e)}var Z=l(),Q=l(),je=t(),Me=h(),$=l();export{P as a,L as c,me as d,O as f,M as h,ge as i,he as l,k as m,ye as n,I as o,N as p,X as r,A as s,ve as t,j as u};