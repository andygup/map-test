const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/bundle-D9W9uNQo.js","assets/bundle-DgRwUxDT.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,RC as n,XS as r,ZS as i}from"./index-BN8X5Ryz.js";import{n as a}from"./QueueProcessor-D6ozkjY6.js";var o=null;async function s(){return o||=c(),o}async function c(){let t=await e(()=>import(`./bundle-D9W9uNQo.js`),__vite__mapDeps([0,1]));return await t.default({module_or_path:r(`esri/libs/parquet/pkg/bundle_bg.wasm`)}),t}var l=new a({concurrency:8,process:async e=>{let{data:t}=await i(e.url,e.options);return t}}),u=e=>async function(t,n,r,i){let a=e?.(),o=a??{};return await l.push({url:t,options:{responseType:`array-buffer`,query:o,headers:{range:`bytes=${n}-${r}`}}})},d=e=>async function(t){if(n(t)){let{data:e}=await i(t,{responseType:`blob`});return e.size}let{data:r}=await i(t,{responseType:`native`,method:`head`,query:e?.()}),a=r.headers.get(`Content-Length`);if(a==null)throw Error(`Unable to parse content length`);return parseInt(a,10)};function f(e,n){switch(n){case`esriGeometryPoint`:return e.GeometryType.Point;case`esriGeometryPolygon`:case`polygon`:return e.GeometryType.Polygon;case`esriGeometryPolyline`:case`polyline`:return e.GeometryType.Polyline;case`esriGeometryMultipoint`:case`multipoint`:return e.GeometryType.Multipoint;default:throw new t(`parquet`,`Found unexpected GeometryType: ${n}`)}}function p(e,t){let n=t.encoding,r=f(e,t.geometryType),i=t.spatialReference.wkid;if(i==null)throw Error(`InternalError: Wkid must be defined.`);switch(n.type){case`wkb`:return e.GeometryField.fromWkb(n.field,i,r);case`location`:{let{yField:t,xField:a}=n;return e.GeometryField.fromLocation(t,a,i,r)}}}function m(e,t){let n=e.GeometryInfo.new();t.geometry&&n.setGeometry(p(e,t.geometry));let r=t.displayOptimization;if(r){let{index:t,parentColumn:i}=r,a=e=>i==null?e:[i,e].join(`.`);if(t.type===`z`){let r=e.DisplayOptimizationZBuilder.new();r.setCodeField(a(t.code)),r.setXColumn(a(t.xColumn)),r.setYColumn(a(t.yColumn)),r.setCooordinatePrecision(t.coordinatePrecision),r.setFullExtent(t.fullExtent),r.setSpatialReference(t.wkid,t.wkt),r.setHasZ(!!t.zColumn),r.setHasM(!!t.mColumn),n.setOptmizationZ(r)}if(t.type===`xz`){let r=f(e,t.geometryType),i=e.DisplayOptimizationXZBuilder.new();i.setCodeField(a(t.code)),i.setEncoding(t.encoding),i.setFullExtent(t.fullExtent),i.setGeometryType(r),i.setSpatialReference(t.wkid,t.wkt),i.setMaxLevel(t.maxLevel),i.setHasZ(t.hasZ??!1),i.setHasM(t.hasM??!1);for(let n of t.levels??[]){let[t,r]=n.transform.translate,[o,s]=n.transform.scale,c=new Float64Array([t,r]),l=new Float64Array([o,s]),u=a(n.column);i.addLevel(e.MultiscaleGeometryField.new(n.level,n.scale,u,c,l))}n.setOptmizationXZ(i)}}return n}async function h(e,n={}){let r=await s(),i=u(n.getCustomParameters),a=d(n.getCustomParameters),o=n.geometryInfo?m(r,n.geometryInfo):null;try{return await r.ParquetFile.fromUrl(e,i,a,o)}catch(e){throw new t(`parquet`,`Failed to parse file`,{error:e})}}function g(e){let t=e.keyValueMetadata(`geo`);return t==null?null:JSON.parse(t)}function _(e){if(e.keyValueMetadata(`esri`))throw new t(`parquet:unsupported`,`File was created using an unsupported experimental display index. Please regenerate the file.`);let n=e.keyValueMetadata(`geodisplay`);if(n!=null)return JSON.parse(n);let r=e.keyValueMetadata(`org.apache.spark.sql.parquet.row.metadata`);if(r!=null){let e=JSON.parse(r);for(let n of e.fields)if(n.metadata!=null&&`type`in n.metadata&&(n.metadata.type===`xz`||n.metadata.type===`z`)){let e={parentColumn:n.name,index:n.metadata};if(e.index.type===`xz`&&(e.index.geometryType=e.index.geometryType.toLowerCase(),e.index.encoding===`esri-pbf`&&(e.index.encoding=`esriPBF`),e.index.encoding!==`esriPBF`))throw new t(`parquet:unsupported`,`Encoding for display index must be of type esriPBF, but found ${e.index.encoding}`);return e}}return null}export{s as i,h as n,_ as r,g as t};