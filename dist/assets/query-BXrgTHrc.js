import{FC as e,ZS as t,ga as n,kC as r,xu as i}from"./index-BN8X5Ryz.js";import{t as a}from"./urlUtils-CW4cnJ3W.js";import{t as o}from"./pbfQueryUtils-CmJPTrN7.js";import{t as s}from"./queryUtils-8f7b9mi_.js";var c=`Layer does not support extent calculation.`;function l(e,t,n){return s(e,t,n)}async function u(e,t,r,i,a){let o=t.timeExtent?.isEmpty?{features:[]}:await _(e,t,`json`,i,void 0,a);return n(t,r,o),o}async function d(e,t,n,r,i){if(t.timeExtent?.isEmpty)return n.createFeatureResult();let a=await f(e,t,r,i);return o(a,n)}function f(e,t,n,r){return _(e,t,`pbf`,n,void 0,r)}function p(e,t,n,r){return t.timeExtent?.isEmpty?Promise.resolve({objectIds:[]}):_(e,t,`json`,n,{returnIdsOnly:!0},r)}async function m(e,t,n,r){return t.timeExtent?.isEmpty?0:(await _(e,t,`json`,n,{returnIdsOnly:!0,returnCountOnly:!0},r)).count}async function h(e,t,n){if(t.timeExtent?.isEmpty)return{count:0,extent:null};let r=await _(e,t,`json`,n,{returnExtentOnly:!0,returnCountOnly:!0});if(r.hasOwnProperty(`extent`))return r;let i=typeof e==`string`?e:e.path;if(/\/imageserver\/?$/i.test(i)&&r.hasOwnProperty(`count`)){let i=await _(e,t,`json`,n,{returnExtentOnly:!0});return{count:r.count,extent:i.extent}}if(r.features||r.hasOwnProperty(`count`))throw Error(c);return r}function g(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;let n={...e,returnUniqueIdsOnly:!0};return delete n.returnIdsOnly,n}async function _(e,n,r,i={},a={},o={}){let s=await v(e,n,r,i,a,o),c=r===`json`?`json`:`array-buffer`;return t(s.url,{responseType:c,...s.options}).then(({data:e})=>e)}async function v(t,n,o,s,c={},u={}){let d=typeof t==`string`?r(t):t,f=n.geometry?[n.geometry]:[],p=await i(f,null,{signal:s.signal}),m=p?.[0];if(m!=null){let e=n.clone();e.geometry=m.clone(),n=e}let h=a({...d.query,f:o,...g(c,u),...l(n,c,u)});return s={...s,query:{...h,...s.query}},new y(e(d.path,b(n,c)?`query3d`:`query`),s)}var y=class{constructor(e,t){this.url=e,this.options=t}};function b(e,t){return e.formatOf3DObjects!=null&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}export{m as a,p as i,f as n,u as o,d as r,h as t};