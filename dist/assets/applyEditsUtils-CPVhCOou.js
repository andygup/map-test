import{$T as e,AS as t,Bg as n,CE as r,Od as i,TC as a,Ug as o,kv as s,nS as c,zg as l}from"./index-BN8X5Ryz.js";import{t as u}from"./MeshTransform-BaPjlQwH.js";import{n as d,s as f}from"./editingSupport-DiW8cYcp.js";async function p(e,r,i){let{geometry:a}=r,s={...r.attributes};if(i!=null&&a?.type===`mesh`){let{transformFieldRoles:r}=i,{origin:d,spatialReference:f,vertexSpace:p}=a,m=a.transform??new u,h=p.type===`local`,g=e.spatialReference,_=g.isGeographic,v=t(g,f),y=n(f,g)&&l(f,g);if(!(h&&_&&y||!h&&!_&&v))return null;let b=o(d,f,g);if(b==null)return null;if(s[r.originX]=b.x,s[r.originY]=b.y,s[r.originZ]=b.z??0,m!=null){let{translation:e,scale:t,rotation:n}=m,i=h?1:c(f)/c(g);s[r.translationX]=e[0]*i,s[r.translationY]=e[2]*i,s[r.translationZ]=-e[1]*i,s[r.scaleX]=t[0],s[r.scaleY]=t[2],s[r.scaleZ]=t[1],s[r.rotationX]=n[0],s[r.rotationY]=n[2],s[r.rotationZ]=-n[1],s[r.rotationDeg]=n[3]}return{attributes:s}}return a==null?{attributes:s}:a.type===`mesh`||a.type===`extent`?null:{geometry:a.toJSON(),attributes:s}}async function m(e,t){let n=await Promise.all((t.addAttachments??[]).map(t=>h(e,t))),r=await Promise.all((t.updateAttachments??[]).map(t=>h(e,t))),i=t.deleteAttachments??[];return n.length||r.length||i.length?{adds:n,updates:r,deletes:[...i]}:null}async function h(e,t){let{feature:n,attachment:r}=t,{globalId:i,name:o,contentType:s,data:c,uploadId:l}=r,u={globalId:i};if(n&&(`attributes`in n?u.parentGlobalId=n.attributes?.[e.globalIdField]:n.globalId&&(u.parentGlobalId=n.globalId)),l)u.uploadId=l;else if(c){let e=await a(c);e&&(u.contentType=e.mediaType,u.data=e.data),c instanceof File&&(u.name=c.name)}return o&&(u.name=o),s&&(u.contentType=s),u}function g(e,t,n){if(!t||t.length===0)return[];if(n&&f(t))return t.map(e=>e.globalId);if(d(t))return t.map(e=>e.objectId);let r=n?e.globalIdField:e.objectIdField;return r?t.map(e=>e.getAttribute(r)):[]}function _(e){let t=e?.assetMaps;if(t){for(let e of t.addResults)e.success||r.getLogger(`esri.layers.graphics.sources.support.sourceUtils`).error(`Failed to map asset to feature with globalId ${e.globalId}.`);for(let e of t.updateResults)e.success||r.getLogger(`esri.layers.graphics.sources.support.sourceUtils`).error(`Failed to map asset to feature with globalId ${e.globalId}.`)}let n=e?.attachments,i={addFeatureResults:e?.addResults?.map(v)??[],updateFeatureResults:e?.updateResults?.map(v)??[],deleteFeatureResults:e?.deleteResults?.map(v)??[],addAttachmentResults:n?.addResults?n.addResults.map(v):[],updateAttachmentResults:n?.updateResults?n.updateResults.map(v):[],deleteAttachmentResults:n?.deleteResults?n.deleteResults.map(v):[]};return e?.editMoment&&(i.editMoment=e.editMoment),i}function v(t){let n=!0===t.success?null:t.error||{code:void 0,description:`Feature edit failed`};return{objectId:t.objectId,globalId:t.globalId,error:n?new e(`feature-layer-source:edit-failure`,n.description,{code:n.code}):null}}function y(e,t){return new i({attributes:e.attributes,geometry:s({...e.geometry,spatialReference:t})})}function b(e,t){return{adds:e?.adds?.map(e=>y(e,t))||[],updates:e?.updates?.map(e=>({original:y(e[0],t),current:y(e[1],t)}))||[],deletes:e?.deletes?.map(e=>y(e,t))||[],spatialReference:t}}function x(e){let t=e.details.raw,n=+t.code,r=+t.extendedCode;return n===500&&(r===-2147217144||r===-2147467261)}export{x as a,m as i,v as n,p as o,g as r,_ as s,b as t};