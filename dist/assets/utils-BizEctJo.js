import{$T as e,$p as t,Ex as n,K as r,Lx as i,NS as a,RS as o,Uh as s,Zp as c,el as l,hg as u,q as d}from"./index-BN8X5Ryz.js";import{h as f,n as p}from"./utils-DCGMUq-q.js";import{i as m}from"./utils-Bftaersa.js";var h=null,g=/^(?<hh>([01][0-9])|(2[0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?(\.(?<ms>\d+))?$/;function _(e,t,n){return e.x<0?e.x+=t:e.x>n&&(e.x-=t),e}function v(e,t,r,i){let s=o(r)?a(r):null,c=s?Math.round((s.valid[1]-s.valid[0])/t.scale[0]):null;return e.map(e=>{let r=new n(e.geometry);return l(t,r,r),e.geometry=s?_(r,c??0,i[0]):r,e})}function y(e,t=18,n,i,a){let o=new Float64Array(i*a);t=Math.round(u(t));let s=1/0,c=-1/0,l=d(n);for(let{geometry:n,attributes:u}of e){let{x:e,y:d}=n,f=Math.max(0,e-t),p=Math.max(0,d-t),m=Math.min(a,d+t),h=Math.min(i,e+t),g=+l(u);for(let n=p;n<m;n++)for(let a=f;a<h;a++){let l=n*i+a,u=r(a-e,n-d,t)*g,f=o[l]+=u;s=Math.min(s,f),c=Math.max(c,f)}}return{min:s,max:c}}function b(e){let t=g.exec(e);if(!t)return null;let{hh:n,mm:r,ss:i,ms:a}=t.groups;return Number(n)*s.hours+Number(r)*s.minutes+Number(i)*s.seconds+Number(a||0)}async function x(e,n,r=!0){if(!n)return[];let{field:a,field2:o,field3:s,fieldDelimiter:l,fieldInfos:u,timeZone:d}=e,g=a&&u?.find(e=>e.name.toLowerCase()===a.toLowerCase()),_=!!g&&c(g),v=!!g&&m(g),y=e.valueExpression,x=e.normalizationType,S=e.normalizationField,C=e.normalizationTotal,w=[],T=e.viewInfoParams,E=null,D=null;if(y){if(!h){let{arcadeUtils:e}=await t();h=e}h.hasGeometryOperations(y)&&await h.enableGeometryOperations(),E=h.createFunction(y),D=T?h.getViewInfo({viewingMode:T.viewingMode,scale:T.scale,spatialReference:new i(T.spatialReference)}):null}let O=e.fieldInfos,k=!(n[0]&&`declaredClass`in n[0]&&n[0].declaredClass===`esri.Graphic`)&&O?{fields:O}:null;return n.forEach(e=>{let t=e.attributes,n;if(y){let t=k?Object.assign({},e,{layer:k}):e,r=h.createExecContext(t,D,d);n=h.executeFunction(E,r)}else t&&(n=t[a],o?(n=`${f(n)}${l}${f(t[o])}`,s&&(n=`${n}${l}${f(t[s])}`)):typeof n==`string`&&r&&(v?n=n?new Date(n).getTime():null:_&&(n=n?b(n):null)));if(x&&typeof n==`number`&&isFinite(n)){let e=t&&parseFloat(t[S]);n=p(n,x,e,C)}w.push(n)}),w}function S(e){let t=e.field,n=e.normalizationType,r=e.normalizationField,i;return n===`field`?i=`(NOT `+r+` = 0)`:n!==`log`&&n!==`natural-log`&&n!==`square-root`||(i=`(${t} > 0)`),i}function C(e,t,n){let r=t==null?``:e+` >= `+t,i=n==null?``:e+` <= `+n,a=``;return a=r&&i?w(r,i):r||i,a?`(`+a+`)`:``}function w(e,t){let n=e??``;return t!=null&&t&&(n=n?`(`+n+`) AND (`+t+`)`:t),n}function T(t,n){if(t&&t.spatialRelationship!==`intersects`)return new e(n,`Only 'intersects' spatialRelationship is supported for featureFilter`)}function E(t,n,r){let i=D({layer:t,fields:n});if(i.length)return new e(r,`Unknown fields: `+i.join(`, `)+`. You can only use fields defined in the layer schema`);let a=O({layer:t,fields:n});return a.length?new e(r,`Unsupported fields: `+a.join(`, `)+`. You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true`):void 0}function D(e){let t=e.layer;return e.fields.filter(e=>!t.getField(e))}function O(e){let t=e.layer;return e.fields.filter(e=>{let n=t.getFieldUsageInfo(e);return!n||!n.supportsStatistics})}export{E as a,y as c,C as i,v as l,x as n,w as o,T as r,b as s,S as t};