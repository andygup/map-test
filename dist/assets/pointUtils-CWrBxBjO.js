import{$ as e,Gd as t,Gg as n,Hv as r,J as i,Nl as a,Ol as o,Q as s,Rf as c,Rm as l,Tf as u,Uv as d,Wv as f,al as p,bf as m,c_ as h,fT as ee,gf as te,kf as ne,mf as re,ot as ie,pD as ae,qw as oe,r_ as se,rf as ce,rh as g,sf as le,si as _,tt as ue,uD as v,uE as de,u_ as fe,ut as pe,xf as me}from"./index-CzMixifc.js";import{n as y}from"./projectPointToVector-D72S8Uh5.js";import{t as b}from"./computeTranslationToOriginAndRotation-DwwRDWAD.js";import{n as he}from"./dehydratedPoint-CVzHYxaL.js";import{i as ge,t as _e}from"./symbolColorUtils-BzuXy7VF.js";import{a as ve,c as x,d as ye,h as be,i as xe,p as Se,t as S,x as Ce}from"./ElevationContext-RIB4rYIh.js";import{f as C,l as w}from"./FloatsPassUniform-Dhl7UDF5.js";import{c as we,i as Te,n as T}from"./graphicUtils-D4vcxFBm.js";import{n as Ee}from"./primitiveObjectSymbolUtils-DBU61hLp.js";import{r as De}from"./DefaultMaterial-BweY01X0.js";var E=class{constructor(e,t){this.renderer=e,this.symbol=t,this.color=null,this.size=null,this.opacity=null,this.outlineSize=null,this.heading=null,this.tilt=null,this.roll=null}};function Oe(e,t){if(e.symbol!=null)return e.symbol;let n=t?.renderer;return n!=null&&n.type!==`dot-density`?n.getSymbol(e,t):null}function ke(e,t){let n=Oe(e,t);if(n==null)return null;let r=t?.renderer,i=new E(r,n);if(r==null||!(`visualVariables`in r)||!r.visualVariables)return i;let a=_(r,e,t)??[],o=[`proportional`,`proportional`,`proportional`];for(let{variable:e,value:t}of a)if(t!=null||e.type===`size`&&e.useSymbolValue)switch(e.type){case`color`:i.color=t?.toRgba();break;case`size`:if(e.target===`outline`)i.outlineSize=t;else{let n=e.axis,r=e.useSymbolValue?`symbol-value`:t??`proportional`;switch(n){case`width`:o[0]=r;break;case`depth`:o[1]=r;break;case`height`:o[2]=r;break;case`width-and-depth`:o[0]=o[1]=r;break;default:o[0]=o[1]=o[2]=r}}break;case`opacity`:i.opacity=t;break;case`rotation`:switch(e.axis){case`tilt`:i.tilt=t;break;case`roll`:i.roll=t;break;default:i.heading=t}}return o[0]===`proportional`&&o[1]===`proportional`&&o[2]===`proportional`||(i.size=o),i}async function Ae(e,t){return e.symbol==null?t?.renderer?.getSymbolAsync(e,t)??null:e.symbol}async function je(e,t){let n=await Ae(e,t);if(!n)return null;let r=t?.renderer,i=new E(r,n);if(!r||!(`visualVariables`in r)||!r.visualVariables)return i;let a=_(r,e,t)??[],o=[`proportional`,`proportional`,`proportional`];for(let{variable:e,value:t}of a)if(e.type===`color`)i.color=g.toUnitRGBA(t);else if(e.type===`size`)if(e.target===`outline`)i.outlineSize=t;else{let n=e.axis,r=e.useSymbolValue?`symbol-value`:t;n===`width`?o[0]=r:n===`depth`?o[1]=r:n===`height`?o[2]=r:o[0]=o[1]=n===`width-and-depth`?r:o[2]=r}else e.type===`opacity`?i.opacity=t:e.type===`rotation`&&e.axis===`tilt`?i.tilt=t:e.type===`rotation`&&e.axis===`roll`?i.roll=t:e.type===`rotation`&&(i.heading=t);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(i.size=o),i}function Me(e,t=0){let n=e[t];return typeof n==`number`&&isFinite(n)?n:null}function Ne(e){for(let t=0;t<3;t++){let n=e[t];if(typeof n==`number`)return isFinite(n)?n:0}return 0}var Pe=1.2,Fe=i,Ie=3,Le=3,Re=10,D=class{constructor(e){this.estimated=!1,this.verticesPerFeature=e.verticesPerFeature??0,this.verticesPerCoordinate=e.verticesPerCoordinate??0,this.drawCallsPerFeature=e.drawCallsPerFeature??0,this.memory=e.memory??new k}},O=class extends D{constructor(e){super(e),this.estimated=!0}},ze=class extends D{constructor(e,t){super(t),this.numComplexities=e}},Be=class extends O{constructor(e,t){super(t),this.numComplexities=e}},k=class{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}},A=new O({});function Ve(e){return e.type===`web-style`?A:j(e.symbolLayers.toArray().map(t=>N(e,t)))}function j(e){let t=0,n=0,r=0,i=!1,a=0,o=new k;for(let s of e)s!=null&&(t+=s.verticesPerFeature,n+=s.verticesPerCoordinate,r+=s.drawCallsPerFeature,o.bytesPerFeature+=s.memory.bytesPerFeature,o.bytesPerFeatureLabel+=s.memory.bytesPerFeatureLabel,o.resourceBytes+=s.memory.resourceBytes,o.draped.bytesPerFeature+=s.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=s.memory.bytesPerFeatureLabel,i||=s.estimated,++a);return i?new Be(a,{verticesPerFeature:t,verticesPerCoordinate:n,drawCallsPerFeature:r,memory:o}):new ze(a,{verticesPerFeature:t,verticesPerCoordinate:n,drawCallsPerFeature:r,memory:o})}function He(e){let t=j(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}var M={};function N(e,t){let n=P(e,t),r=ge(t)?2:0;switch(t.type){case`extrude`:return new D({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:r,memory:n});case`fill`:if(e.type===`mesh-3d`)return new D({drawCallsPerFeature:r,memory:n});if(t.outline!=null&&t.outline.size>0)return new D({verticesPerFeature:-12,verticesPerCoordinate:9,memory:n});case`water`:return new D({verticesPerFeature:-6,verticesPerCoordinate:3,memory:n});case`line`:return new D({verticesPerFeature:-6,verticesPerCoordinate:6,memory:n});case`object`:return t.resource?.href?new O({verticesPerFeature:100,memory:n}):{...Ue(t.resource?.primitive??`sphere`),memory:n};case`path`:{let e=0,r=0;switch(t.profile){case`circle`:e=10;break;case`quad`:e=4;break;default:v(t.profile);return}switch(t.join){case`round`:r=3;break;case`miter`:case`bevel`:r=1;break;default:return}let i=2*e,a=e*r*2,o=a+i,s=-2*a-i;switch(t.cap){case`none`:break;case`butt`:case`square`:s+=2*(e-1);break;case`round`:s+=2*(e*2*2+e);break;default:return}return new D({verticesPerFeature:s,verticesPerCoordinate:o,memory:n})}case`text`:{let t=e.type===`label-3d`?0:2;return new D({verticesPerFeature:6,memory:n,drawCallsPerFeature:t})}case`icon`:return new D({verticesPerFeature:6,memory:n});default:return}}function P(e,t){let n=e.type===`point-3d`;switch(t.type){case`extrude`:return t.edges&&t.edges.size>0?I.EXTRUDE_EDGES:I.EXTRUDE;case`fill`:return t.outline!=null&&t.outline.size>0?I.FILL_OUTLINE:I.FILL;case`water`:return I.FILL;case`line`:return t.join===`round`?I.LINE_ROUND:I.LINE_MITER;case`path`:switch(t.join){case`round`:switch(t.profile){case`circle`:return I.PATH_ROUND_CIRCLE;case`quad`:return I.PATH_ROUND_QUAD;default:v(t.profile);return}case`miter`:case`bevel`:switch(t.profile){case`circle`:return I.PATH_MITER_CIRCLE;case`quad`:return I.PATH_MITER_QUAD;default:v(t.profile);return}default:return}case`object`:return n?I.OBJECT_POINT:I.OBJECT_POLYGON;case`icon`:case`text`:return n?I.ICON_POINT:I.ICON_POLYGON;default:return}}function Ue(e){let t=M[e];if(t)return t;let n=F(Ee(e,new De({},{spherical:!0})).levels);return M[e]=new D({verticesPerFeature:n}),M[e]}function F(e){return e.reduce((e,t,n)=>e+t.numVertices*(1/10**n),0)/e.reduce((e,t,n)=>e+1/10**n,0)}var I={ICON_POINT:{bytesPerFeature:2658,bytesPerFeatureLabel:3484,resourceBytes:0,draped:{bytesPerFeature:1845,bytesPerFeatureLabel:3498}},ICON_POLYGON:{bytesPerFeature:3086,bytesPerFeatureLabel:2996,resourceBytes:0,draped:{bytesPerFeature:2694,bytesPerFeatureLabel:3014}},OBJECT_POINT:{bytesPerFeature:497,bytesPerFeatureLabel:2933,resourceBytes:0,draped:{bytesPerFeature:497,bytesPerFeatureLabel:2933}},OBJECT_POLYGON:{bytesPerFeature:867,bytesPerFeatureLabel:2491,resourceBytes:0,draped:{bytesPerFeature:867,bytesPerFeatureLabel:2491}},LINE_MITER:{bytesPerFeature:2337,bytesPerFeatureLabel:2658,resourceBytes:0,draped:{bytesPerFeature:1864,bytesPerFeatureLabel:2656}},LINE_ROUND:{bytesPerFeature:2341,bytesPerFeatureLabel:2672,resourceBytes:0,draped:{bytesPerFeature:1873,bytesPerFeatureLabel:2643}},PATH_MITER_CIRCLE:{bytesPerFeature:22374,bytesPerFeatureLabel:2558,resourceBytes:0,draped:{bytesPerFeature:22374,bytesPerFeatureLabel:2558}},PATH_ROUND_CIRCLE:{bytesPerFeature:24004,bytesPerFeatureLabel:2598,resourceBytes:0,draped:{bytesPerFeature:24004,bytesPerFeatureLabel:2598}},PATH_MITER_QUAD:{bytesPerFeature:24040,bytesPerFeatureLabel:2940,resourceBytes:0,draped:{bytesPerFeature:24040,bytesPerFeatureLabel:2940}},PATH_ROUND_QUAD:{bytesPerFeature:23088,bytesPerFeatureLabel:2886,resourceBytes:0,draped:{bytesPerFeature:23088,bytesPerFeatureLabel:2886}},FILL:{bytesPerFeature:3059,bytesPerFeatureLabel:2838,resourceBytes:0,draped:{bytesPerFeature:2352,bytesPerFeatureLabel:2808}},FILL_OUTLINE:{bytesPerFeature:3093,bytesPerFeatureLabel:2632,resourceBytes:0,draped:{bytesPerFeature:2480,bytesPerFeatureLabel:2601}},EXTRUDE:{bytesPerFeature:5075,bytesPerFeatureLabel:2559,resourceBytes:0,draped:{bytesPerFeature:5075,bytesPerFeatureLabel:2559}},EXTRUDE_EDGES:{bytesPerFeature:2843,bytesPerFeatureLabel:2139,resourceBytes:0,draped:{bytesPerFeature:2843,bytesPerFeatureLabel:2139}}};if(ae(`esri-tests-disable-symbol-memory-estimators`))for(let e in I){let t=I[e];t.bytesPerFeature=0,t.bytesPerFeatureLabel=0,t.draped.bytesPerFeature=0,t.draped.bytesPerFeatureLabel=0}function L(e){return e.mapPositions!=null}function We(e,t,n,r,i){let a=e.stageObject,o=a.geometries,s=0;for(let e of o){if(!L(e))continue;let{update:o,averageGeometrySampledElevation:c}=W(e,t,n,r,i);s+=c,o&&a.geometryVertexAttributeUpdated(e,`position`)}return s/o.length}function Ge(e,t,n,r,i,a){let s=e.stageObject,c=t.centerInElevationSR,u=0;r(c,U),s.usesVerticalDistanceToGround?(ye(s,U.verticalDistanceToGround),u=U.sampledElevation):t.mode!==`absolute-height`&&(u=U.sampledElevation);let d=l(Ke,a??s.transformation),f=o(H,d[12],d[13],d[14]);C.TESTS_DISABLE_OPTIMIZATIONS?(z[0]=c[0],z[1]=c[1],z[2]=U.z,b(n,z,d,i.spatialReference)&&(a?l(a,d):s.transformation=d)):i.setAltitudeOfTransformation(U.z,d);let p=R/i.unitInMeters;return(Math.abs(d[12]-f[0])>=p||Math.abs(d[13]-f[1])>=p||Math.abs(d[14]-f[2])>=p)&&(a?l(a,d):s.transformation=d),u}var Ke=c();function qe(e,t,n,r,i){let a=e.graphics3DSymbolLayer.lodRenderer;if(a==null)return 0;let s=t.centerInElevationSR;r(s,U);let c=t.mode===`absolute-height`?0:U.sampledElevation,l=a.instanceData,u=e.instanceIndex,d=Ye;l.getGlobalTransform(u,d);let f=o(H,d[12],d[13],d[14]);C.TESTS_DISABLE_OPTIMIZATIONS?(z[0]=s[0],z[1]=s[1],z[2]=U.z,b(n,z,d,i.spatialReference)&&l.setGlobalTransform(u,d)):i.setAltitudeOfTransformation(U.z,d);let p=R/i.unitInMeters;return(C.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(d[12]-f[0])>=p||Math.abs(d[13]-f[1])>=p||Math.abs(d[14]-f[2])>=p)&&l.setGlobalTransform(u,d),c}function Je(e,t,n,r,i){let a=e.stageObject,o=a.geometries;if(o.length===0)return 0;let s=0,c=null,l=0,u=!1;for(let e of o){if(!L(e))continue;let o=e.attributes.get(`position`);if(o!==c){let{update:a,averageGeometrySampledElevation:s}=W(e,t,n,r,i);l=s,c=o,u=a}u&&a.geometryVertexAttributeUpdated(e,`position`),s+=l}return s/o.length}var R=.01,z=h(),B=h(),V=h(),Ye=c(),H=h(),U=new Se;function W(e,t,r,i,a){let o=!1,s=e.transformation,c=t.requiresSampledElevationInfo;B[0]=s[12],B[1]=s[13],B[2]=s[14],e.invalidateBoundingInfo();let l=e.getMutableAttribute(`position`),u=l.data,d=l.size,f=u.length/d,p=new be(e.mapPositions,r),m=0,h=0;for(let e=0;e<f;e++){if(V[0]=u[m],V[1]=u[m+1],V[2]=u[m+2],i(p,U),c&&(h+=U.sampledElevation),C.TESTS_DISABLE_OPTIMIZATIONS)u[m]=p.array[p.offset],u[m+1]=p.array[p.offset+1],u[m+2]=U.z,n(u,r,m,u,a.spatialReference,m,1),u[m]-=B[0],u[m+1]-=B[1],u[m+2]-=B[2],o=!0;else{z[0]=u[m]+B[0],z[1]=u[m+1]+B[1],z[2]=u[m+2]+B[2],a.setAltitude(z,U.z),u[m]=z[0]-B[0],u[m+1]=z[1]-B[1],u[m+2]=z[2]-B[2];let e=R/a.unitInMeters;(Math.abs(V[0]-u[m])>=e||Math.abs(V[1]-u[m+1])>=e||Math.abs(V[2]-u[m+2])>=e)&&(o=!0)}m+=d,p.offset+=3}return h/=f,{update:o,averageGeometrySampledElevation:h}}var Xe=class{constructor(e,t,n){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=n}},Ze=class{_getFlag(e){return(this._flags&e)===e}_setFlag(e,t){t?this._flags|=e:this._flags&=~e}get needsElevationUpdates(){return this._getFlag(2)}set needsElevationUpdates(e){this._setFlag(2,e)}get useObjectOriginAsAttachmentOrigin(){return this._getFlag(4)}set useObjectOriginAsAttachmentOrigin(e){this._setFlag(4,e)}get hiddenIfDeconflicted(){return this._getFlag(8)}set hiddenIfDeconflicted(e){this._setFlag(8,e)}get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,n,r,i,a=null){this.graphics3DSymbolLayer=e,this.stageObject=t,this._sharedResource=n,this.elevationAligner=r,this.elevationContext=i,this._edgeState=a,this.type=`object3d`,this._stageLayer=null,this._flags=0,this.alignedSampledElevation=0}initialize(e){this._stageLayer=e}destroy(){if(!this._stageLayer)return;let e=this._stageLayer.stage;this._getFlag(1)&&(this._stageLayer.remove(this.stageObject),this._setFlag(1,!1)),e.renderer.edgeView?.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource?.release(),this._stageLayer=null}get usedMemory(){return this.graphics3DSymbolLayer.usedMemory}layerOpacityChanged(e,t){let{stageObject:n,_edgeState:r,_stageLayer:i}=this;if(r==null)return;let a=G(r.baseMaterial);r.edgeMaterial.objectTransparency!==a&&(r.edgeMaterial.objectTransparency=a,this.resetEdgeObject(t)),i.stage.renderer.withEdgeView(t=>t.updateAllComponentOpacities(n,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){let{stageObject:n,_edgeState:r,_stageLayer:i}=this;r!=null&&i.stage.renderer.withEdgeView(i=>{i.updateAllComponentMaterials(n,r.edgeMaterial,e,!t),r.hasSlicePlane=e})}setVisibility(e){let{_edgeState:t,stageObject:n,_stageLayer:r}=this;r!=null&&this.visible!==e&&(n.visible=e,e&&!this._getFlag(1)&&(r.add(n),this._setFlag(1,!0)),t!=null&&r.stage.renderer.withEdgeView(r=>{r.hasObject(n)?r.updateObjectVisibility(n,e):e&&this._addOrUpdateEdgeObject(t,r,!1)}))}get visible(){return this._getFlag(1)&&this.stageObject.visible}alignWithElevation(e,t,n){this.elevationAligner!=null&&(this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,(n,r)=>ve(n,e,this.elevationContext,t,r),t),this.resetEdgeObject(n))}alignWithAbsoluteElevation(e,t,n){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,this.graphics3DSymbolLayer.view.spatialReference,(t,n)=>{n.sampledElevation=e,n.verticalDistanceToGround=0,n.z=e},t),this.resetEdgeObject(n)}getCenterObjectSpace(){return this.stageObject.boundingVolumeObjectSpace.bounds.center}getBoundingBoxObjectSpace(e=m()){let t=this.stageObject.boundingVolumeObjectSpace;return te(e,t.min),me(e,t.max),e}computeAttachmentOrigin(e){let t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(let n of this.stageObject.geometries)n.computeAttachmentOrigin(J)&&(p(J,J,t),a(e.render.origin,e.render.origin,J),e.render.num++)}async getProjectedBoundingBox(e,t,n,r,i){let a=this.getBoundingBoxObjectSpace(i),o=Qe,s=ce(a)?1:o.length;for(let e=0;e<s;e++){let t=o[e];q[0]=a[t[0]],q[1]=a[t[1]],q[2]=a[t[2]],p(q,q,this.stageObject.transformation),K[3*e]=q[0],K[3*e+1]=q[1],K[3*e+2]=q[2]}if(!e(K,0,s))return null;ne(a);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let e=0;e<3*s;e+=3){for(let t=0;t<3;t++)a[t]=Math.min(a[t],K[e+t]),a[t+3]=Math.max(a[t+3],K[e+t]);c&&n.push({location:K.slice(e,e+3),screenSpaceBoundingRect:c})}if(t?.service&&this.elevationContext.mode!==`absolute-height`){u(a,J);let e=this.elevationContext.mode===`relative-to-scene`?`scene`:`ground`,n=0;if(t.useViewElevation)n=t.service.getElevation(J[0],J[1],e)??0;else try{let i=Te(a,t.service.spatialReference,t);n=await t.service.queryElevation(J[0],J[1],r,i,e)??0}catch{}le(a,0,0,-this.alignedSampledElevation+n)}return a}addObjectState(e){e.stateType===0&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),e.stateType===1&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){let{_edgeState:t,stageObject:n,_stageLayer:r,visible:i}=this;t!=null&&r.stage.renderer.withEdgeView(r=>{i?this._addOrUpdateEdgeObject(t,r,e):r.removeObject(n)})}_addOrUpdateEdgeObject(e,t,n){let r=G(e.baseMaterial);e.edgeMaterial.objectTransparency=r,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!n).then(()=>this._stageLayer?.sync())}};function G(e){return e.transparent?0:1}var K=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=h(),J=h(),Qe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],$e=class{constructor(e,t=null){this.labelText=t,this.elevationOffset=e??0}},Y=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=0,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){return this._loadStatus===1?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===2?(t&&t(this._loadError),this._loader??Promise.resolve()):(this._loader??=(this._abortController=new AbortController,this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=1},e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=2,!oe(e)&&this.logger&&e.message&&this.logger.warn(e.message),e})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){this._abortController==null?this._loadStatus===0&&(this._loadStatus=2):this._abortController=ee(this._abortController),this._loader=null}},X=()=>de.getLogger(`esri.views.3d.layers.graphics.Graphics3DSymbolLayer`),et=class extends Y{constructor(e,t,n,r,i=!0){super(n.schedule),this.symbol=e,this.symbolLayer=t,this._context=n,this._drivenOpacityFallbackAlwaysOpaque=i,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=X(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=r.renderPriority,this._renderPriorityStep=r.renderPriorityStep,this._elevationContext=new S,this.updateComplexity(),this.ignoreDrivers=r.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=Z(this._context.renderer,i)),this._updateElevationContext()}destroy(){this.complexity=null,this._materials.length=0,super.destroy()}get view(){return this._context.stage.view}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get estimatedMemory(){let{complexity:e}=this;return e==null?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}get usedMemory(){return this.estimatedMemory}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;let t=this._drivenProperties,n=Z(e,this._drivenOpacityFallbackAlwaysOpaque);return n.color!==t.color||n.opacity!==t.opacity||n.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||n.size!==t.size||n.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._hasDrivenColorOrOpacity&&!this._drivenProperties.opacityAlwaysOpaque}get _hasDrivenColorOrOpacity(){return this._drivenProperties.color||this._drivenProperties.opacity}_logGeometryCreationWarnings(e,t,n,r){let i=e.projectionSuccess,a=`polygons`in e?e.polygons:null,o=`${r} geometry failed to be created`;i?!this._logGeometryValidationWarnings(t,n,r)&&a?.length===0&&n===`rings`&&t.length>0&&t[0].length>2&&X().warnOncePerTick(`${o} (filled rings should use clockwise winding - try reversing the order of vertices)`):X().warnOncePerTick(`${o} (failed to project geometry to view spatial reference)`)}get needsUpdateFocus(){return!1}_logGeometryValidationWarnings(e,t,n){let r=`${n} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(X().warnOncePerTick(`${r} (no ${t} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(X().warnOncePerTick(`${r} (${t} should be defined as a 2D array)`),!0)}_validateGeometry(e,t=null,n=null){if(t!=null&&!t.includes(e.type))return this.logger.warn(`unsupported geometry type for `+n+` symbol: ${e.type}`),!1;switch(e.type){case`point`:{let t=e;if(!isFinite(t.x)||!isFinite(t.y))return X().warn(`point coordinate is not a valid number, graphic skipped`),!1;break}case`polygon`:d(e)}return!0}_defaultElevationInfoNoZ(){return tt}_defaultElevationInfoZ(){return nt}_updateElevationContext(){this._elevationInfoOverride==null?this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.setFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset():(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.setFeatureExpressionInfoContext(null))}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,t=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}createElevationContextForGraphic(e){let t=new S;return this.updateElevationContextForGraphic(t,e),t}updateElevationContextForGraphic(e,t){let n=t.geometry,r=this.getDefaultElevationInfo(n);e.unit=this._elevationContext.unit==null?r.unit:this._elevationContext.unit,e.mode=this.getGeometryElevationMode(n,r),e.offsetMeters=this._elevationContext.meterUnitOffset??r.offset??0;let i=!this._elevationOptions.supportsOnTheGround&&e.mode===`on-the-ground`;i&&(e.mode=`relative-to-ground`,e.offsetMeters=0);let a=i?xe:this._elevationContext.featureExpressionInfoContext;a?e.updateFeatureExpressionInfoContextForGraphic(a,t,this._context.layer):e.setFeatureExpressionInfoContext(null)}prepareSymbolLayerPatch(e){}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&`fullOpacity`in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,t=Q){let n=this.draped?1:this._getLayerOpacity();return this._drivenProperties.color?n:e?n*(this._drivenProperties.opacity?1:e.a):t.hasIntrinsicColor?n:0}_getCombinedOpacityAndColor(e,t=Q){let n=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return T(null,n);let r=e==null?se:g.toUnitRGB(e);return T(r,n)}_getDrivenUInt8Color({color:t,opacity:n},r,a){let{color:o,opacity:s}=this._drivenProperties,c=g.toUnitRGBA(r)??(a?e:i),l=o?t??c:null,u=t||r||a,d=o?null:c[3];return T(l,s&&u?n??d:null,255)}_getDrivenUInt8ColorWithNaNSupport({color:e,opacity:t},n,r){let i=n?ue(g.toUnitRGBA(n)):s(NaN,NaN,NaN,r?NaN:0);return this._drivenProperties.color&&e!=null&&ie(i,e),this._drivenProperties.opacity&&t!=null&&(i[3]=t),pe(i,i,255),_e(i,i)}isFastUpdatesEnabled(){return this._fastUpdates!=null}updateComplexity(){this.complexity=this.computeComplexity()}computeComplexity(){return N(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,n){switch(e){case`opacity`:return this.layerOpacityChanged(t,n),!0;case`screenSizePerspectiveEnabled`:return this.layerScreenSizePerspectiveChanged(t,n),!0;case`elevationInfo`:{let e=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(t,n,e)!==2}case`slicePlaneEnabled`:return this.slicePlaneEnabledChanged(t,n);case`physicalBasedRenderingEnabled`:return this.physicalBasedRenderingChanged();case`pixelRatio`:return this.pixelRatioChanged;case`skipHighSymbolLods`:return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,n){let r=1;return e?.forEach(e=>{let i=t(e);if(i!=null){let t=e.graphic;this.updateElevationContextForGraphic(i.elevationContext,t),i.needsElevationUpdates=n(i.elevationContext.mode)}else r=2}),r}applyRendererDiff(e,t){return 0}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;let t=this._fastUpdates.visualVariables,n=t.size?w(t.size.field,e):0,r=t.color?w(t.color.field,e):0,i=t.opacity?w(t.opacity.field,e):0;return s(n,r,i,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&X().warnOnce(`A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.`),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables.size?.field??null,color:this._fastUpdates?.visualVariables.color?.field??null,opacity:this._fastUpdates?.visualVariables.opacity?.field??null,rotation:this._fastUpdates?.visualVariables.rotation?.field??null})}}};function Z(e,t){let n={color:!1,opacity:!1,opacityAlwaysOpaque:t,size:!1,rotation:!1};return e&&`visualVariables`in e&&e.visualVariables&&e.visualVariables.forEach(e=>{switch(e.type){case`color`:if(n.color=!0,e.stops)for(let t=0;t<e.stops.length;t++){let r=e.stops[t].color;r&&r.a<1&&(n.opacityAlwaysOpaque=!1)}break;case`opacity`:n.opacity=!0,n.opacityAlwaysOpaque=!1;break;case`size`:n.size=!0;break;case`rotation`:n.rotation=!0}}),n}var tt={mode:`on-the-ground`,offset:0,unit:`meters`},nt={mode:`absolute-height`,offset:0,unit:`meters`},Q={hasIntrinsicColor:!1},rt=s(NaN,NaN,NaN,NaN);function it(e,t,n,r,i){if(ot(e,t))return null;n.localOrigin=lt(e,t);let a=new Ce({geometries:[n],castShadow:!1,layerViewUid:e.layerViewUid,graphicUid:i,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:x(a,t,e.elevationProvider,e.renderCoordsHelper,r)}}function at(e,t,n,r){return ot(t,n)?null:x(e,n,t.elevationProvider,t.renderCoordsHelper,r)}function ot(e,t){let n=e.clippingExtent;return!!n&&(y(t,$,e.elevationProvider.spatialReference),!re(n,$))}function st(e,t,n){let r=e.elevationContext,i=n.spatialReference;y(t,$,i),r.centerInElevationSR=fe($[0],$[1],t.hasZ?$[2]:0)}function ct(e){switch(e.type){case`point`:return e;case`polygon`:case`extent`:return we(e);case`polyline`:{let t=e.paths[0];if(!t||t.length===0)return null;let n=f(t,r(t)/2);return he(n[0],n[1],n[2],e.spatialReference)}case`mesh`:return e.extent.center}return null}function lt(e,t){return y(t,$,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin($)}var $=h();export{je as A,D as C,Pe as D,Le as E,Ne as M,E as N,Fe as O,F as S,Ie as T,P as _,at as a,He as b,Y as c,Xe as d,Je as f,L as g,Ge as h,it as i,ke as j,Me as k,$e as l,qe as m,st as n,rt as o,We as p,lt as r,et as s,ct as t,Ze as u,j as v,Re as w,Ve as x,A as y};