import{DT as e,Ey as t,Hi as n,Hm as r,Im as i,Lm as a,Ml as o,OT as s,Ol as c,Om as l,Pm as u,Qp as d,Rf as f,Rm as ee,Wm as p,X as te,Xp as m,_w as h,a_ as g,c_ as _,dw as ne,gD as v,jm as re,l_ as y,nm as b,ot as x,pD as ie,zm as S,zy as ae}from"./index-CzMixifc.js";import{t as C}from"./Uniform-CfHWJqSg.js";import{t as w}from"./NoParameters-B66z9IwQ.js";var T=class extends h{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.OCCLUSION_QUERY_DEBUG_PIXEL=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.FLOW_GLOBAL_SCALE_THRESHOLD=null}};v([e()],T.prototype,`SCENEVIEW_HITTEST_RETURN_INTERSECTOR`,void 0),v([e()],T.prototype,`DECONFLICTOR_SHOW_VISIBLE`,void 0),v([e()],T.prototype,`DECONFLICTOR_SHOW_INVISIBLE`,void 0),v([e()],T.prototype,`DECONFLICTOR_SHOW_GRID`,void 0),v([e()],T.prototype,`LABELS_SHOW_BORDER`,void 0),v([e()],T.prototype,`TEXT_SHOW_BASELINE`,void 0),v([e()],T.prototype,`TEXT_SHOW_BORDER`,void 0),v([e()],T.prototype,`OVERLAY_DRAW_DEBUG_TEXTURE`,void 0),v([e()],T.prototype,`OVERLAY_SHOW_CENTER`,void 0),v([e()],T.prototype,`SHOW_POI`,void 0),v([e()],T.prototype,`OCCLUSION_QUERY_DEBUG_PIXEL`,void 0),v([e()],T.prototype,`TESTS_DISABLE_OPTIMIZATIONS`,void 0),v([e()],T.prototype,`TESTS_DISABLE_FAST_UPDATES`,void 0),v([e()],T.prototype,`DRAW_MESH_GEOMETRY_NORMALS`,void 0),v([e()],T.prototype,`FEATURE_TILE_FETCH_SHOW_TILES`,void 0),v([e()],T.prototype,`FEATURE_TILE_TREE_SHOW_TILES`,void 0),v([e()],T.prototype,`TERRAIN_TILE_TREE_SHOW_TILES`,void 0),v([e()],T.prototype,`I3S_TREE_SHOW_TILES`,void 0),v([e()],T.prototype,`I3S_SHOW_MODIFICATIONS`,void 0),v([e()],T.prototype,`LOD_INSTANCE_RENDERER_DISABLE_UPDATES`,void 0),v([e()],T.prototype,`LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL`,void 0),v([e()],T.prototype,`EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES`,void 0),v([e()],T.prototype,`LINE_WIREFRAMES`,void 0),v([e()],T.prototype,`FLOW_GLOBAL_SCALE_THRESHOLD`,void 0),T=v([s(`esri.views.3d.support.debugFlags`)],T);var E=new T;function D(){return!!ie(`enable-feature:objectAndLayerId-rendering`)}var O=class{constructor(e){this.field=e}},oe=class extends O{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[0,0,0],this.fallback=[0,0,0]}},k=class extends O{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}},A=class extends O{constructor(e,t=0){super(e),this.fallback=t,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},j=class{};function M(e){return e!=null}function N(e,t){e&&e.push(t)}function P(e,t,n,r=f()){let o=e||0,s=t||0,c=n||0;return o!==0&&p(r,r,-o/180*Math.PI),s!==0&&i(r,r,s/180*Math.PI),c!==0&&a(r,r,c/180*Math.PI),r}function F(e,t,r,i,a){let o=e.minSize,s=e.maxSize;if(e.useSymbolValue){let e=i.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(M(e.field))return M(e.stops)?e.stops.length===2&&d(e.stops[0].size)&&d(e.stops[1].size)?(I(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(N(a,`Could not convert size info: stops only supported with 2 elements`),!1):d(o)&&d(s)&&M(e.minDataValue)&&M(e.maxDataValue)?(I(o,s,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):e.valueUnit===`unknown`?(N(a,`Could not convert size info: proportional size not supported`),!1):n[e.valueUnit]==null?(N(a,`Could not convert size info: scale-dependent size not supported`),!1):(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/n[e.valueUnit],t.type[r]=1,!0);if(!M(e.field)){if(e.stops?.[0]&&d(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(d(o))return t.minSize[r]=o,t.maxSize[r]=o,t.offset[r]=o,t.factor[r]=0,t.type[r]=1,!0}return N(a,`Could not convert size info: unsupported variant of sizeInfo`),!1}function I(e,t,n,r,i,a){let o=Math.abs(r-n)>0?(t-e)/(r-n):0;i.minSize[a]=o>0?e:t,i.maxSize[a]=o>0?t:e,i.offset[a]=e-n*o,i.factor[a]=o}function L(e,t,n,r){if(e.normalizationField||e.valueRepresentation)return N(r,`Could not convert size info: unsupported property`),null;if(!b(e.field))return N(r,`Could not convert size info: field is not a string`),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return N(r,`Could not convert size info: multiple fields in use`),null}else t.size.field=e.field}else t.size=new oe(e.field),o(t.size.fallback,n.fallbackSize);let i;switch(e.axis){case`width`:return i=F(e,t.size,0,n,r),i?t:null;case`height`:return i=F(e,t.size,2,n,r),i?t:null;case`depth`:return i=F(e,t.size,1,n,r),i?t:null;case`width-and-depth`:return i=F(e,t.size,0,n,r),i&&F(e,t.size,1,n,r),i?t:null;case null:case void 0:case`all`:return i=F(e,t.size,0,n,r),i&&=F(e,t.size,1,n,r),i&&=F(e,t.size,2,n,r),i?t:null;default:return N(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function R(e,t,n){for(let n=0;n<3;++n){let r=t.unitInMeters;e.type[n]===1&&(r*=t.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/r,e.maxSize[n]=e.maxSize[n]/r,e.offset[n]=e.offset[n]/r,e.factor[n]=e.factor[n]/r}let r;if(e.type[0]!==0)r=0;else if(e.type[1]!==0)r=1;else{if(e.type[2]===0)return N(n,`No size axis contains a valid size or scale`),!1;r=2}for(let t=0;t<3;++t)e.type[t]===0&&(e.minSize[t]=e.minSize[r],e.maxSize[t]=e.maxSize[r],e.offset[t]=e.offset[r],e.factor[t]=e.factor[r],e.type[t]=e.type[r]);return!0}function z(e,t,n){e[4*t]=n.r/255,e[4*t+1]=n.g/255,e[4*t+2]=n.b/255,e[4*t+3]=n.a}function B(e,t,n,r){if(e.normalizationField)return N(r,`Could not convert color info: unsupported property`),null;if(m(e.field)){if(!e.stops)return N(r,`Could not convert color info: missing stops or colors`),null;{if(e.stops.length>8)return N(r,`Could not convert color info: too many color stops`),null;t.color=new k(e.field);let i=e.stops;for(let e=0;e<8;++e){let n=i[Math.min(e,i.length-1)];t.color.values[e]=n.value,z(t.color.colors,e,n.color)}x(t.color.fallback,n.fallbackColor)}}else{if(!(e.stops&&e.stops.length>=0))return N(r,`Could not convert color info: no field and no colors/stops`),null;{let r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color=new k(null);for(let e=0;e<8;e++)t.color.values[e]=1/0,z(t.color.colors,e,r);x(t.color.fallback,n.fallbackColor)}}return t}function V(e,t,n,r){if(e.normalizationField)return N(r,`Could not convert opacity info: unsupported property`),null;if(m(e.field)){if(!e.stops)return N(r,`Could not convert opacity info: missing stops or opacities`),null;{if(e.stops.length>8)return N(r,`Could not convert opacity info: too many opacity stops`),null;t.opacity=new A(e.field,n.fallbackColor[3]);let i=e.stops;for(let e=0;e<8;++e){let n=i[Math.min(e,i.length-1)];t.opacity.values[e]=n.value,t.opacity.opacityValues[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return N(r,`Could not convert opacity info: no field and no opacities/stops`),null;{let r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:n.fallbackColor[3]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}function H(e,t,n){let r=n===2&&e.rotationType===`arithmetic`;t.offset[n]=r?90:0,t.factor[n]=r?-1:1,t.type[n]=1}function U(e,t,n){if(!m(e.field))return N(n,`Could not convert rotation info: field is not a string`),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return N(n,`Could not convert rotation info: multiple fields in use`),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case`tilt`:return H(e,t.rotation,0),t;case`roll`:return H(e,t.rotation,1),t;case null:case void 0:case`heading`:return H(e,t.rotation,2),t;default:return N(n,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}var W=class{constructor({supports:e,modelSize:t,symbolSize:n,unitInMeters:r,anchor:i,scale:a,rotation:o,fallbackColor:s,fallbackSize:c}){this.supports=e,this.modelSize=t??g(),this.symbolSize=n??g(),this.unitInMeters=r??1,this.anchor=i??y(),this.scale=a??g(),this.rotation=o??y(),this.fallbackColor=s??te(),this.fallbackSize=c??g()}};function G(e,t,n){if(!e)return null;let r=e.reduce((e,r)=>{if(!e)return e;if(r.valueExpression)return N(n,`Could not convert visual variables: arcade expressions not supported`),null;switch(r.type){case`size`:return t.supports.size?L(r,e,t,n):e;case`color`:return t.supports.color?B(r,e,t,n):e;case`opacity`:return t.supports.opacity?V(r,e,t,n):null;case`rotation`:return t.supports.rotation?U(r,e,n):e;default:return null}},new j);return!(e.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!R(r.size,t,n)?null:r:null}var K=class{constructor(e,t,n){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=n}};function se(e,t){if(!e||D()||E.TESTS_DISABLE_FAST_UPDATES)return null;let n=G(e.visualVariables,t);return n?new K(n,Y(n,t),!!n.size):null}function ce(e,t,n){if(!t||!e)return!1;let r=e.visualVariables,i=G(t.visualVariables,n);return!!i&&!!(q(r.size,i.size,`size`)&&q(r.color,i.color,`color`)&&q(r.rotation,i.rotation,`rotation`)&&q(r.opacity,i.opacity,`opacity`))&&(e.visualVariables=i,e.materialParameters=Y(i,n),e.requiresShaderTransformation=!!i.size,!0)}function q(e,t,n){if(!!e!=!!t||e&&e.field!==t?.field)return!1;if(e&&n===`rotation`){let n=e,r=t;for(let e=0;e<3;e++)if(n.type[e]!==r.type[e]||n.offset[e]!==r.offset[e]||n.factor[e]!==r.factor[e])return!1}return!0}var J=class extends w{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}};function Y(e,n){let r=new J(e);return r.vvSize&&(r.vvSymbolAnchor=n.anchor,S($),P(n.rotation[2],n.rotation[0],n.rotation[1],$),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||t(),ae(r.vvSymbolRotationMatrix,$)),r}function le(e,t,n){if(!e.vvSize)return n;ee(Z,n);let i=e.vvSymbolRotationMatrix;return r($,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),l(Z,Z,$),X(Q,e,t),re(Z,Z,Q),u(Z,Z,e.vvSymbolAnchor),Z}function X(e,t,n){if(!t.vvSize)return c(e,1,1,1),e;if(Number.isNaN(n[0]))return o(e,t.vvSize.fallback);for(let r=0;r<3;++r){let i=t.vvSize.offset[r]+n[0]*t.vvSize.factor[r];e[r]=ne(i,t.vvSize.minSize[r],t.vvSize.maxSize[r])}return e}function ue(e,t){let n=e==null?0:t.attributes[e];return typeof n==`number`&&isFinite(n)?n:NaN}var Z=f(),Q=_(),$=f(),de=class extends J{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}},fe=8,pe=class extends C{constructor(e,t,n,r){super(e,`vec4`,1,(n,i,a)=>n.setUniform4fv(e,t(i,a),r),n)}},me=class extends C{constructor(e,t,n,r){super(e,`float`,1,(n,i,a)=>n.setUniform1fv(e,t(i,a),r),n)}};export{W as a,le as c,D as d,E as f,de as i,ue as l,pe as n,se as o,fe as r,ce as s,me as t,X as u};