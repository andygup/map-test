import{FC as e,Tu as t,ZS as n,ha as r,kC as i,xu as a}from"./index-BN8X5Ryz.js";import{t as o}from"./urlUtils-CW4cnJ3W.js";import{t as s}from"./queryUtils-8f7b9mi_.js";import{t as c}from"./PivotQuery-BmAzsJNe.js";function l(e){let t=s(e),n=t.outPivots;if(n?.length){for(let e of n)e.pivotType===`Pivot`&&e.pivotParameters.outStatistic?e.pivotParameters.outStatistic=JSON.stringify(e.pivotParameters.outStatistic):e.pivotType===`Unpivot`&&(e.unPivotParameters.sourceFields=e.unPivotParameters.sourceFields.join(`,`));t.outPivots=JSON.stringify(n)}return t}async function u(e,t,n){return await d(e,t,n)}async function d(t,r,s={}){let c=typeof t==`string`?i(t):t,u=r.geometry?[r.geometry]:[],d=await a(u,null,{signal:s.signal}),f=d?.[0];f!=null&&((r=r.clone()).geometry=f);let p=o({...c.query,f:`json`,...l(r)});return n(e(c.path,`queryPivot`),{...s,query:{...p,...s.query}})}async function f(e,n,i){let a=t(e),o={...i},{data:s}=await u(a,c.from(n),o);return r.fromJSON(s)}export{f as executePivotQuery};