const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/projectOperator-CCprhjfg.js","assets/SimpleGeometryCursor-BILtMaQf.js","assets/projectionZScaling-C8xhU_hX.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/projectOperator-DWqbOm71.js","assets/geographicTransformationUtils-BUPNDAzF.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,$x as n,Bv as r,Ex as i,JS as a,KS as o,Lx as s,NS as c,US as l,Ug as u,WS as d,Xw as f,YS as p,sD as m,vx as h}from"./index-BN8X5Ryz.js";function g(){if(!D)throw new t(`rasterprojectionhelper-project`,`projection operator is not loaded`)}var _=(e,t,n,r=0)=>{if(n[0]===1)return[0,0];let i=1,a=-1,o=1,s=-1;for(let t=0;t<e.length;t+=2)isNaN(e[t])||(i=i>e[t]?e[t]:i,a=a>e[t]?a:e[t],o=o>e[t+1]?e[t+1]:o,s=s>e[t+1]?s:e[t+1]);let{cols:c,rows:l}=t,u=(a-i)/c/n[0],d=(s-o)/l/n[1],f=2*r,p=0,m=!1,h=[0,0];for(let t=0;t<c-3;t++){for(let n=0;n<l-3;n++){let r=t*l*2+2*n,i=(e[r]+e[r+4]+e[r+4*l]+e[r+4*l+4])/4,a=(e[r+1]+e[r+5]+e[r+4*l+1]+e[r+4*l+5])/4,o=Math.abs((i-e[r+2*l+2])/u),s=Math.abs((a-e[r+2*l+3])/d);if(o+s>p&&(p=o+s,h=[o,s]),f&&p>f){m=!0;break}}if(m)break}return h},v={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},y=new Map,b=new Map,x=500,S=39.37,C=96,w,T,E,D=!1;async function O(){return w||(w=f(),T=await e(()=>import(`./projectOperator-CCprhjfg.js`),__vite__mapDeps([0,1,2,3,4,5])),E=await e(()=>import(`./geographicTransformationUtils-BUPNDAzF.js`),__vite__mapDeps([6,3,4])),T.isLoaded()||await T.load(),E.isLoaded()||await E.load(),D=!0,w.resolve()),w.promise}function k(e,t,n){if(g(),n){let n=T.execute(e,t);return E.getTransformation(t,e.spatialReference,n)}return E.getTransformation(e.spatialReference,t,e)}function A(e,t,n,r){let i=e.spatialReference;if(!i||!t||i.equals(t))return e;g();let a=n.center,o=new h({xmin:a.x-e.x/2,xmax:a.x+e.x/2,ymin:a.y-e.y/2,ymax:a.y+e.y/2,spatialReference:i}),s=T.execute(o,t,{geographicTransformation:r}),c=q(t);return s==null||c!=null&&s.width>=c?j(e,i,t):{x:s.width,y:s.height}}function j(e,t,r){let i=n(t)/n(r);return{x:e.x*i,y:e.y*i}}function M(e,i,a){let{spatialReference:o}=a;if(!o||!i||o.equals(i))return e;if(o.isGeographic&&i.isGeographic)return j(e,o,i);if(g(),!D)throw new t(`raster-projection-helper:project-dataset-resolution`,`geometry engine is not loaded`);let{x:s,y:c}=e,l=(s+c)/2*n(o),u=1;l>30&&(u=30/l,s*=u,c*=u);let d=s*256/2,f=c*256/2,{x:p,y:m}=a.center,h=[];for(let e=0;e<=256;e++)h.push([p-d,m-f+e*c]);for(let e=1;e<=256;e++)h.push([p-d+e*s,m+f]);for(let e=1;e<=256;e++)h.push([p+d,m+f-e*c]);for(let e=1;e<256;e++)h.push([p+d-e*s,m-f]);h.push(h[0]);let _=new r({rings:[h],spatialReference:o}),v=T.execute(_,i);if(!v)return j(e,o,i);let y=v.extent,b=q(i);if(y==null||b!=null&&y.width>=b)return j(e,o,i);let x=de(v.rings),S=s*c*256*256,C=Math.sqrt(x/S)/u,w={x:y.width/u/256,y:y.height/u/256},E={x:s*C,y:c*C},O=w.x*w.y;return Math.abs(O-E.x*E.y)/O<.1?w:E}function N(e,t){return(typeof e==`number`?e:(e.x+e.y)/2)*n(t)*C*S}function P(e,t){let{pixelSize:n,extent:r}=e;return N(M(n,t,r),t)}function F(e,t=.01){return n(e)?t/n(e):0}function I(e,t,n,r=!0){let i=e.spatialReference;if(i.equals(t))return e;g();let a=T.execute(e,t,{geographicTransformation:n});return r&&a&&L([e],[a],i,t),a}function L(e,t,n,r){let i=J(n,!0),a=J(r,!0),o=F(n,x),s=F(r,x);if(o&&i!=null&&a!=null)for(let n=0;n<e.length;n++){let r=t[n];if(!r)continue;let{x:c}=e[n],{x:l}=r;l>=a[1]-s&&Math.abs(c-i[0])<o?r.x-=a[1]-a[0]:l<=a[0]+s&&Math.abs(c-i[1])<o&&(r.x+=a[1]-a[0])}}function R(e){let{inSR:t,outSR:n,preferPE:r}=e;if(t.equals(n)){let{points:t}=U(e,null);return t}return t.isWebMercator&&n.isWGS84||t.isWGS84&&n.isWebMercator?ee(e):r&&(t.isGeographic||V(t)!=null)?B(e):z(e)}function z(e){let{points:t}=U(e,null),{inSR:n,outSR:r,datumTransformation:a}=e,o=t.map(e=>new i(e[0],e[1],n)),s=T.executeMany(o,r,{geographicTransformation:a});return a&&L(o,s,n,r),s.map(e=>e?[e.x,e.y]:[NaN,NaN])}function B(e){let{inSR:t,outSR:n,datumTransformation:r}=e,i=V(t),{points:s,mask:c}=U(e,i);if(!t.isGeographic){let e=t.wkid?d.coordsys(t.wkid):d.fromString(t.isGeographic?a.PE_TYPE_GEOGCS:a.PE_TYPE_PROJCS,t.wkt2||t.wkt);o.projToGeog(e,s.length,s)}if(r!=null&&r.steps.length){let e,t=179.9955;if(n.isGeographic&&(e=s.map(([e])=>e>t?1:e<-t?-1:0)),r.steps.forEach(e=>{let t=e.wkid?d.geogtran(e.wkid):d.fromString(a.PE_TYPE_GEOGTRAN,e.wkt);p.geogToGeog(t,s.length,s,null,e.isInverse?a.PE_TRANSFORM_2_TO_1:a.PE_TRANSFORM_1_TO_2)}),e)for(let n=0;n<s.length;n++){let r=e[n],i=s[n][0],a=i>t?1:i<-t?-1:0;r&&a&&r!==a&&(s[n][0]=r>0?i+360:i-360)}}if(!n.isGeographic){let e=V(n,!0),t=e!=null&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];te(s,t);let r=n.wkid?d.coordsys(n.wkid):d.fromString(n.isGeographic?a.PE_TYPE_GEOGCS:a.PE_TYPE_PROJCS,n.wkt2||n.wkt);o.geogToProj(r,s.length,s)}let l=s;if(c&&s.length!==c.length){l=[];for(let e=0,t=0;e<c.length;e++)c[e]?l.push(s[t++]):l.push([NaN,NaN])}return l}function ee(e){let{cols:t,rows:n,xres:r,yres:a,usePixelCenter:o,inSR:s,outSR:c}=e,{xmin:l,ymax:d}=e;o&&(l+=r/2,d-=a/2);let f=[],p=[],m=Math.max(t,n);for(let e=0;e<m;e++){let o=l+r*Math.min(t,e),m=d-a*Math.min(n,e),h=u(new i({x:o,y:m,spatialReference:s}),s,c);e<=t&&f.push(h.x),e<=n&&p.push(h.y)}let h=[];for(let e=0;e<t;e++)for(let t=0;t<n;t++)h.push([f[e],p[t]]);return h}function V(e,t=!1){let n=e.wkid||e.wkt2||e.wkt;if(!n||e.isGeographic)return null;if(n=String(n),y.has(n)){let e=y.get(n);return t?e?.gcs:e?.pcs}let r=e.wkid?d.coordsys(e.wkid):d.fromString(e.isGeographic?a.PE_TYPE_GEOGCS:a.PE_TYPE_PROJCS,e.wkt2||e.wkt),i=H(r,F(e,1e-4)),o=H(r,0,!0);return y.set(n,{pcs:i,gcs:o}),t?o:i}function H(e,t=0,n=!1){let r=l.generate(e),i=n?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!r||!i?.length)return null;let a=!1,o=i.find(e=>e.getInclusive()===1&&e.getKind()===1);if(!o){if(o=i.find(e=>e.getInclusive()===1&&e.getKind()===0),!o)return null;a=!0}let s=n?0:(r.getNorthPoleLocation()===2?1:0)|(r.getSouthPoleLocation()===2?2:0),c=r.isPannableRectangle(),u=o.getCoord();if(a)return{isEnvelope:a,isPannable:c,vertices:u,coef:null,bbox:[u[0][0]-t,u[0][1]-t,u[1][0]+t,u[1][1]+t],poleLocation:s};let d=0,f=[],[p,m]=u[0],[h,g]=u[0];for(let e=0,t=u.length;e<t;e++){d++,d===t&&(d=0);let[n,r]=u[e],[i,a]=u[d];if(a===r)f.push([n,i,r,a,2]);else{let e=(i-n)/(a-r||1e-4),t=n-e*r;r<a?f.push([e,t,r,a,0]):f.push([e,t,a,r,1])}p=p<n?p:n,m=m<r?m:r,h=h>n?h:n,g=g>r?g:r}return{isEnvelope:!1,isPannable:c,vertices:u,coef:f,bbox:[p,m,h,g],poleLocation:s}}function U(e,t){let n=[],{cols:r,rows:i,xres:a,yres:o,usePixelCenter:s}=e,{xmin:c,ymax:l}=e;if(s&&(c+=a/2,l-=o/2),t==null){for(let e=0;e<r;e++)for(let t=0;t<i;t++)n.push([c+a*e,l-o*t]);return{points:n}}let u=new Uint8Array(r*i);if(t.isEnvelope){let{bbox:[e,s,d,f]}=t;for(let p=0,m=0;p<r;p++){let r=c+a*p,h=t.isPannable||r>=e&&r<=d;for(let e=0;e<i;e++,m++){let t=l-o*e;h&&t>=s&&t<=f&&(n.push([r,t]),u[m]=1)}}return{points:n,mask:u}}let d=t.coef,f=[];for(let e=0;e<i;e++){let t=l-o*e,n=[],r=[];for(let e=0;e<d.length;e++){let[i,a,o,s,c]=d[e];if(t===o&&o===s)n.push(i),n.push(a),r.push(2),r.push(2);else if(t>=o&&t<=s){let e=i*t+a;n.push(e),r.push(c)}}let i=n;if(n.length>2){let e=r[0]===2?0:r[0],t=n[0];i=[];for(let a=1;a<r.length;a++)r[a]===2&&a!==r.length-1||(r[a]!==e&&(i.push(e===0?Math.min(t,n[a-1]):Math.max(t,n[a-1])),e=r[a],t=n[a]),a===r.length-1&&i.push(r[a]===0?Math.min(t,n[a]):Math.max(t,n[a])));i.sort((e,t)=>e-t)}else n[0]>n[1]&&(i=[n[1],n[0]]);f.push(i)}for(let e=0,t=0;e<r;e++){let r=c+a*e;for(let e=0;e<i;e++,t++){let i=l-o*e,a=f[e];if(a.length===2)r>=a[0]&&r<=a[1]&&(n.push([r,i]),u[t]=1);else if(a.length>2){let e=!1;for(let t=0;t<a.length;t+=2)if(r>=a[t]&&r<=a[t+1]){e=!0;break}e&&(n.push([r,i]),u[t]=1)}}}return{points:n,mask:u}}function te(e,t){let[n,r]=t;for(let t=0;t<e.length;t++){let i=e[t][1];(i<n||i>r)&&(e[t]=[NaN,NaN])}}function W(e,t){let n=q(e[0].spatialReference);if(e.length<2||n==null||(t??=F(e[0].spatialReference),(e=e.filter(e=>e.width>t)).length===1))return e[0];let{xmin:r,xmax:i,ymin:a,ymax:o}=e[0];for(let t=1;t<e.length;t++){let r=e[t];i=r.xmax+n*t,a=Math.min(a,r.ymin),o=Math.max(o,r.ymax)}return new h({xmin:r,xmax:i,ymin:a,ymax:o,spatialReference:e[0].spatialReference})}function G(e,t,n=null,r=!0){let i=e.spatialReference;if(i.equals(t)||!t)return e;let a=X(e),o=q(i,!0),s=q(t);if(a===0||o==null||s==null){let a=K(e,t,n,r);if(a&&o==null&&s!=null&&Math.abs(a.width-s)<F(t)&&T.isLoaded()){let n=V(i);if(n!=null&&n.poleLocation===0&&e.width<(n.bbox[2]-n.bbox[0])/2)return re(e,t)||a}return a}let c=e.clone().normalize();if(c.length===1&&e.xmax<o&&e.xmax-o/2>F(i)){let{xmin:t,xmax:n}=e;for(let r=0;r<=a;r++){let s=r===0?t:-o/2,l=r===a?n-o*r:o/2;c[r]=new h({xmin:s,xmax:l,ymin:e.ymin,ymax:e.ymax,spatialReference:i})}}let l=c.map(e=>K(e,t,n,r)).filter(m);return l.length===0?null:W(l)}function ne(e,t,n){if(e.type===`extent`){let{xmin:t,ymin:n,xmax:i,ymax:a,spatialReference:o}=e;e=new r({rings:[[[t,a],[i,a],[i,n],[t,n],[t,a]]],spatialReference:o})}return e.spatialReference.equals(t)?e:(g(),T.execute(e,t,{geographicTransformation:n}))}function re(e,t){let n=q(t);if(n==null)return null;let{xmin:i,ymin:a,xmax:o,ymax:s}=e,c=e.spatialReference,l=new r({spatialReference:c,rings:[[[i,a],[o,a],[o,s],[i,s],[i,a]]]}),u=T.execute(l,t);if(u.rings.length!==2||!u.rings[0].length||!u.rings[1].length)return null;let{rings:d}=u,f=F(c),p=new h({spatialReference:t});for(let e=0;e<2;e++){i=o=d[e][0][0],a=s=d[e][0][1];for(let t=0;t<d[e].length;t++)i=i>d[e][t][0]?d[e][t][0]:i,o=o<d[e][t][0]?d[e][t][0]:o,a=a>d[e][t][1]?d[e][t][1]:a,s=s<d[e][t][1]?d[e][t][1]:s;if(e===0)p.ymin=a,p.ymax=s,p.xmin=i,p.xmax=o;else if(p.ymin=Math.min(p.ymin,a),p.ymax=Math.max(p.ymax,s),Math.abs(o-n/2)<f)p.xmin=i,p.xmax+=n;else{if(!(Math.abs(i+n/2)<f))return null;p.xmax=o+n}}return p}function K(e,t,n,r=!0,a=!0){let o=e.spatialReference;if(o.equals(t)||!t)return e;g();let s=T.execute(e,t,{geographicTransformation:n});if(a&&t.isWebMercator&&s&&(s.ymax=Math.min(20037508.342787,s.ymax),s.ymin=Math.max(-20037508.342787,s.ymin),s.ymin>=s.ymax))return null;if(!r||!s)return s;let c=J(o,!0),l=J(t,!0);if(c==null||l==null)return s;let u=F(o,.001),d=F(o,x),f=F(t,.001);if(Math.abs(s.xmin-l[0])<f&&Math.abs(s.xmax-l[1])<f){let r=Math.abs(e.xmin-c[0]),a=Math.abs(c[1]-e.xmax);if(r<u&&a>d){s.xmin=l[0];let r=[];r.push(new i(e.xmax,e.ymin,o)),r.push(new i(e.xmax,(e.ymin+e.ymax)/2,o)),r.push(new i(e.xmax,e.ymax,o));let a=r.map(e=>I(e,t,n)).filter(e=>!isNaN(e?.x)).map(e=>e.x);s.xmax=Math.max.apply(null,a)}if(a<u&&r>d){s.xmax=l[1];let r=[];r.push(new i(e.xmin,e.ymin,o)),r.push(new i(e.xmin,(e.ymin+e.ymax)/2,o)),r.push(new i(e.xmin,e.ymax,o));let a=r.map(e=>I(e,t,n)).filter(e=>!isNaN(e?.x)).map(e=>e.x);s.xmin=Math.min.apply(null,a)}}else{let e=F(t,.001);Math.abs(s.xmin-l[0])<e&&(s.xmin=l[0]),Math.abs(s.xmax-l[1])<e&&(s.xmax=l[1])}return s}function q(e,t=!1){if(!e)return null;let n=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*n:e.wkid&&e.isGeographic?360:2*v[e.wkid]||null}function J(e,t=!1){if(e.isGeographic)return[-180,180];let n=q(e,t);return n==null?null:[-n/2,n/2]}function Y(e,t,n,r){let i=(e-t)/n;return i-Math.floor(i)===0?r&&--i:i=Math.floor(i),i}function X(e,t=!1){let n=q(e.spatialReference);if(n==null)return 0;let r=t?0:-(n/2),i=F(e.spatialReference),a=!t&&Math.abs(e.xmax-n/2)<i?n/2:e.xmax,o=!t&&Math.abs(e.xmin+n/2)<i?-n/2:e.xmin;return Y(a,r,n,!0)-Y(o,r,n,!1)}function ie(e){let t=e.storageInfo.origin.x,n=q(e.spatialReference,!0);if(n==null)return{originX:t,halfWorldWidth:null,pyramidsInfo:null};let r=n/2,{nativePixelSize:i,storageInfo:a,extent:o}=e,{maximumPyramidLevel:s,blockWidth:c,pyramidScalingFactor:l}=a,u=i.x,d=[],f=e.transform!=null&&e.transform.type===`gcs-shift`,p=t+(f?0:r),m=f?n-t:r-t;for(let e=0;e<=s;e++){let e=(o.xmax-t)/u/c,n=e-Math.floor(e)===0?e:Math.ceil(e),r=m/u/c,i=r-Math.floor(r)===0?r:Math.ceil(r),a=Math.floor(p/u/c),s=Math.round(p/u)%c,f=(c-Math.round(m/u)%c)%c;d.push({resolutionX:u,blockWidth:c,datasetColumnCount:n,worldColumnCountFromOrigin:i,leftMargin:s,rightPadding:f,originColumnOffset:a}),u*=l}return{originX:t,halfWorldWidth:r,pyramidsInfo:d,hasGCSSShiftTransform:f}}function ae(e){if(!e||e.isGeographic)return e;let t=String(e.wkid||e.wkt2||e.wkt),n;return b.has(t)?n=b.get(t):(n=(e.wkid?d.coordsys(e.wkid):d.fromString(a.PE_TYPE_PROJCS,e.wkt2||e.wkt)).getGeogcs().getCode(),b.set(t,n)),new s({wkid:n})}function oe(e){let t=e.isAdaptive&&e.spacing==null,n=e.spacing||[32,32],r=Z(e),i={cols:r.size[0]+1,rows:r.size[1]+1},a=r.outofBoundPointCount>0&&r.outofBoundPointCount<r.offsets.length/2,o=r.outofBoundPointCount===r.offsets.length/2||t&&a?[0,0]:_(r.offsets,i,n,4),s=(o[0]+o[1])/2,c=e.projectedExtent.spatialReference,l=e.srcBufferExtent.spatialReference;if(t&&(a||s>4)&&(c.isGeographic||V(c),n=[4,4],r=Z({...e,spacing:n}),i={cols:r.size[0]+1,rows:r.size[1]+1},o=_(r.offsets,i,n,4)),r.error=o,n[0]>1&&(r.coefficients=Q(r.offsets,i,a)),e.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(l.isGeographic)r.gcsGrid={offsets:r.offsets,coefficients:r.coefficients,spacing:n};else{let t=V(c);if(t!=null&&!t.isEnvelope){let t=ae(c),o=G(e.projectedExtent,t),{offsets:s}=Z({...e,srcBufferExtent:o,spacing:n}),l=Q(s,i,a);r.gcsGrid={offsets:s,coefficients:l,spacing:n}}}return r}function Z(e){let{projectedExtent:t,srcBufferExtent:n,pixelSize:r,datumTransformation:a,rasterTransform:o}=e,s=t.spatialReference,c=n.spatialReference;g();let{xmin:l,ymin:u,xmax:d,ymax:f}=t,p=q(c),m=p!=null&&(e.hasWrapAround||o?.type===`gcs-shift`),h=e.spacing||[32,32],_=h[0]*r.x,v=h[1]*r.y,y=h[0]===1,b=Math.ceil((d-l)/_-.1/h[0])+(y?0:1),S=Math.ceil((f-u)/v-.1/h[1])+(y?0:1),C=R({cols:b,rows:S,xmin:l,ymax:f,xres:_,yres:v,inSR:s,outSR:c,datumTransformation:a,preferPE:h[0]<=4,usePixelCenter:y}),w=[],T,E=0,D=y?-1:NaN,{xmin:O,xmax:k,ymax:A,width:j,height:M}=n,N=F(c,x),P=p!=null&&O>0&&k>p/2,I=V(s),L=I!=null&&I.poleLocation>0;for(let e=0;e<b;e++){let t=[];for(let n=0;n<S;n++){let r=C[e*S+n];if(m&&r[0]>k&&r[0]>p/2-N?r[0]-=p:m&&e===0&&r[0]<0&&P&&!o&&(r[0]+=p),!r||isNaN(r[0])||isNaN(r[1]))w.push(D),w.push(D),t.push(null),E++;else{if(o){let e=o.inverseTransform(new i({x:r[0],y:r[1],spatialReference:c}));r=[e.x,e.y]}t.push(r),e>0&&m&&T[n]&&r[0]<T[n][0]&&(r[0]+=p,L&&r[0]>k&&r[0]>p&&(r[0]-=p)),w.push((r[0]-O)/j),w.push((A-r[1])/M)}}T=t}return{offsets:w,error:null,coefficients:null,outofBoundPointCount:E,spacing:h,size:y?[b,S]:[b-1,S-1]}}function Q(e,t,n){let{cols:r,rows:i}=t,a=new Float32Array((r-1)*(i-1)*2*6),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),s=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let t=0;t<r-1;t++){for(let n=0;n<i-1;n++){let c=t*i*2+2*n,l=e[c],u=e[c+1],d=e[c+2],f=e[c+3];c+=2*i;let p=e[c],m=e[c+1],h=e[c+2],g=e[c+3],_=0,v=12*(n*(r-1)+t);for(let e=0;e<3;e++)a[v++]=o[_++]*l+o[_++]*d+o[_++]*h;_=0;for(let e=0;e<3;e++)a[v++]=o[_++]*u+o[_++]*f+o[_++]*g;_=0;for(let e=0;e<3;e++)a[v++]=s[_++]*l+s[_++]*p+s[_++]*h;_=0;for(let e=0;e<3;e++)a[v++]=s[_++]*u+s[_++]*m+s[_++]*g}if(n)for(let e=0;e<a.length;e++)isNaN(a[e])&&(a[e]=-1)}return a}function se(e,t){let n=e.clone().normalize();return n.length===1?n[0]:W(n,t)}function ce(e){let{spatialReference:t}=e,n=c(t);if(!n)return e;let[r,i]=n.valid,a=i-r,o=0;if(e.xmin<r){let t=r-e.xmin;o=Math.ceil(t/a)}else if(e.xmin>i){let t=e.xmin-i;o=-Math.ceil(t/a)}return new h({spatialReference:e.spatialReference,xmin:e.xmin+o*a,ymin:e.ymin,xmax:e.xmax+o*a,ymax:e.ymax})}function le(e,t,r){let{storageInfo:a,pixelSize:o}=t,s=0,c=!1,{pyramidResolutions:l}=a,u=a.tileInfo.format?.toLowerCase()===`mixed`?Math.max(1,Math.min(3,a.tileInfo.dpi/96)):1,d=(e.x+e.y)/2/u;if(l!=null&&l.length){let e=l[l.length-1],a=(e.x+e.y)/2,u=(o.x+o.y)/2;if(d<=u)s=0;else if(d>=a)s=l.length,c=d/a>8;else{let e,t=u;for(let n=1;n<=l.length;n++){if(e=(l[n-1].x+l[n-1].y)/2,d<=e){d===e?s=n:r===`down`?(s=n-1,c=d/t>8):s=r===`up`||d-t>e-d||d/t>2?n:n-1;break}t=e}}let f=s===0?o:l[s-1];return c&&Math.min(f.x,f.y)*n(t.spatialReference)>19567&&(c=!1),{pyramidLevel:s,pyramidResolution:new i({x:f.x,y:f.y,spatialReference:t.spatialReference}),excessiveReading:c}}let f=Math.log(e.x/o.x)/Math.LN2,p=Math.log(e.y/o.y)/Math.LN2,m=t.storageInfo.maximumPyramidLevel||0;s=r===`down`?Math.floor(Math.min(f,p)):r===`up`?Math.ceil(Math.max(f,p)):Math.round((f+p)/2),s<0?s=0:s>m&&(c=s>m+3,s=m);let h=2**s;return{pyramidLevel:s,pyramidResolution:new i({x:h*t.nativePixelSize.x,y:h*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:c}}function $(e,t,n=!1){let{pixelSize:r,extent:i}=e,a=k(i,t,!1),o=G(se(i,(r.x+r.y)/16),t,a);return!o||n||X(o)===0?o:K(i,t,a)}function ue(e,t,n){let r=n?.tileSize??512,i=n?.alignGlobalDatasetWithAGOL??!0,a=!!n?.limitToSrcResolution,{extent:o,spatialReference:c,pixelSize:l}=e,u=M(l,t,o);if(u==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};let d=(u.x+u.y)/2,f=N(d,t),p=t.isGeographic?256/r*295828763.7958547:256/r*591657527.591555,m=e.dataType===`vector-magdir`||e.dataType===`vector-uv`,h=$(e,t,!0),g=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(p/2/f)/Math.LN2));if(!m&&h&&i&&(t.isGeographic||t.isWebMercator)){let n=q(t);if(m=X(h)>0||n!=null&&h.width>n/4,!m&&n!=null){let t=-1;if(g<3)t=2**g*d*r;else if(e.storageInfo){let{maximumPyramidLevel:n=0,pyramidScalingFactor:i=2}=e.storageInfo;t=i**n*d*r}let i=Math.ceil(n/t);m=i===1||i===2&&n/2-h.xmax<t}}let _,v=f,y=1.001,b=Math.min(2,Math.max(1.414,e.storageInfo?.pyramidScalingFactor||2));if(m){v=p;let n=t.isGeographic?1341104507446289e-21:.29858214164761665,r=N(n,t),i=t.isGeographic?4326:3857;_=M({x:n,y:n},c,$(e,new s({wkid:i}),!0)),_.x*=v/r,_.y*=v/r}else{_={x:l.x,y:l.y};let e=0;for(;v<p*(y/2)&&e<g;)e++,v*=b,_.x*=b,_.y*=b;Math.max(v,p)/Math.min(v,p)<=y&&(v=p)}let x=[v],S=[{x:_.x,y:_.y}],C=Math.min(70.5310735,f)/y;for(;v>=C;)v/=b,_.x/=b,_.y/=b,x.push(v),S.push({x:_.x,y:_.y});if(a){let e=.001*l.x,t=S.findIndex(t=>t.x>=l.x-e&&t.x<=l.x+e);t>-1?(S.length=t+1,x.length=t+1):(t=S.findIndex(t=>t.x<=l.x+e),t>0&&(S.length=t,x.length=t))}return{projectedPixelSize:u,scales:x,srcResolutions:S,isCustomTilingScheme:!m}}function de(e){let t=0;for(let n of e){let e=n.length,r=n[0][0]*(n[1][1]-n[e-2][1]);for(let t=1;t<e-1;t++)r+=n[t][0]*(n[t+1][1]-n[t-1][1]);t+=r/2}return Math.abs(t)}export{ne as a,le as c,ue as d,X as f,k as h,P as i,ie as l,$ as m,A as n,I as o,oe as p,G as r,ce as s,q as t,O as u};