import{pD as e}from"./index-CzMixifc.js";import{n as t}from"./MeshLocalVertexSpace-Dfv_NBsU.js";import"./meshVertexSpaceUtils-CrM2H6JB.js";import"./projectPointToVector-D72S8Uh5.js";import"./computeTranslationToOriginAndRotation-DwwRDWAD.js";import"./BufferView-BPABY7if.js";import"./Util-YNFIi00s.js";import"./vec3-D13Z1xO0.js";import"./vec4-CJBDH7oG.js";import{n}from"./vertexSpaceConversion-WXuyjrGI.js";import"./spatialReferenceEllipsoidUtils-b6wDfyu0.js";import{n as r}from"./PooledRBush-OI-c3i-A.js";var i=class{async createIndex(e,t){let n=[];if(!e.vertexAttributes?.position)return new r;let i=s(e),a=t==null?this.createIndexThread(i).result:await t.invoke(`createIndexThread`,i,{transferList:n});return c().fromJSON(a)}createIndexThread(e){let t=c();if(!e)return{result:t.toJSON()};let n=new Float64Array(e.position);return e.components?o(t,n,e.components.map(e=>new Uint32Array(e))):a(t,n)}};function a(e,t){let n=Array(t.length/9),r=0;for(let e=0;e<t.length;e+=9)n[r++]=l(t,e,e+3,e+6);return e.load(n),{result:e.toJSON()}}function o(e,t,n){let r=0;for(let e of n)r+=e.length/3;let i=Array(r),a=0;for(let e of n)for(let n=0;n<e.length;n+=3)i[a++]=l(t,3*e[n],3*e[n+1],3*e[n+2]);return e.load(i),{result:e.toJSON()}}function s(e){let{vertexAttributes:{position:r},vertexSpace:i,spatialReference:a,transform:o}=e,s=n({vertexAttributes:{position:r},vertexSpace:i,spatialReference:a,transform:o},t.absolute,{allowBufferReuse:!0})?.position;return s?!e.components||e.components.some(e=>!e.faces)?{position:s.buffer}:{position:s.buffer,components:e.components.map(e=>e.faces)}:null}function c(){return new r(9,e(`esri-csp-restrictions`)?e=>e:[`.minX`,`.minY`,`.maxX`,`.maxY`])}function l(e,t,n,r){return{minX:Math.min(e[t],e[n],e[r]),maxX:Math.max(e[t],e[n],e[r]),minY:Math.min(e[t+1],e[n+1],e[r+1]),maxY:Math.max(e[t+1],e[n+1],e[r+1]),p0:[e[t],e[t+1],e[t+2]],p1:[e[n],e[n+1],e[n+2]],p2:[e[r],e[r+1],e[r+2]]}}export{i as default};