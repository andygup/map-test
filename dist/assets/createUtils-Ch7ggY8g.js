import{$x as e,Bx as t,Cl as n,DS as r,DT as i,Hx as a,JE as o,Lv as s,Nx as c,OT as l,Ov as u,Qx as d,SE as f,Su as p,Vv as m,Zv as h,_x as g,bx as _,c_ as v,dl as y,fl as b,gD as x,ku as S,kv as C,px as w,qv as T,rE as ee,rS as te,rl as E,sl as D,tD as O,vl as k,wx as A,xu as j,yS as M,yl as ne}from"./index-CzMixifc.js";import{n as re}from"./distanceOperator-DtUZpUXI.js";import{r as ie,t as ae}from"./simplifyOperator-DqzqfbFt.js";import{t as N}from"./quatf64-eO7UAs9K.js";import{i as oe,t as P}from"./quat-XKFzqP_i.js";import{i as F}from"./geodesicUtils-DoIAZh7n.js";var I,L=I=class extends C{constructor(e){super(e),this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit=`meters`}initialize(){let t=this.center,n=this.numberOfPoints;if(this.hasZ=t?.hasZ??!1,this.rings.length!==0||!t)return;let i=c(this.radius,this.radiusUnit,`meters`),o=t.spatialReference,s,l=`geographic`;if(o.isWebMercator?l=`webMercator`:((o.wkid&&r[o.wkid])!=null||(o.wkt2||o.wkt)&&a(o.wkt2||o.wkt))&&(l=`projected`),this.geodesic){let e;switch(l){case`webMercator`:e=g(t);break;case`projected`:console.error(`Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system`);break;case`geographic`:e=t}s=this._createGeodesicCircle(e,i,n),l===`webMercator`&&(s=_(s))}else{let r;l===`webMercator`||l===`projected`?r=i/d(t.spatialReference):l===`geographic`&&(r=e(i,`meters`,te(t.spatialReference).radius)),s=this._createPlanarCircle(t,r,n)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}get center(){return this._get(`center`)}set center(e){this._set(`center`,ee(w,e))}clone(){let{center:e,numberOfPoints:t,radius:n,radiusUnit:r,geodesic:i}=this;return new I({center:e?.clone(),numberOfPoints:t,radius:n,radiusUnit:r,geodesic:i})}_createGeodesicCircle(e,t,n){let r=[],i=[e.x,e.y];for(let a=0;a<360;a+=360/n){let n=this.hasZ?[0,0,e.z??0]:[0,0];F(n,i,a,t,A.WGS84),r.push(n)}return r.push(r[0]),new C({rings:[r]})}_createPlanarCircle(e,t,n){let r=[],i=2*Math.PI/n;for(let a=0;a<n;++a){let n=i*a,o=[e.x+Math.cos(-n)*t,e.y+Math.sin(-n)*t];this.hasZ&&o.push(e.z??0),r.push(o)}return r.push(r[0]),new C({spatialReference:e.spatialReference,rings:[r]})}};x([i({type:w,useTypeForAutocast:!1,value:null})],L.prototype,`center`,null),x([i()],L.prototype,`geodesic`,void 0),x([i()],L.prototype,`numberOfPoints`,void 0),x([i()],L.prototype,`radius`,void 0),x([i()],L.prototype,`radiusUnit`,void 0),L=I=x([l(`esri.geometry.Circle`)],L);var R=L;function z(e,t,n=null){return n==null?[e,t]:[e,t,n]}function B(e,t,n=null){return n==null?{x:e,y:t}:{x:e,y:t,z:n}}var V=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(e=>this.mapToLocal(e)).filter(o)}get doUnnormalization(){return!1}},H=class extends V{constructor(e,t,n=null){super(t),this._defaultZ=n,this.transform=j(),this.transformInv=j(),this.transform=p(e),S(this.transformInv,this.transform)}makeMapPoint(e,t){return z(e,t,this._defaultZ)}mapToLocal(e){return B(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return z(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},U=class extends V{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=v(),this.tangentFrameUpWS=v(),this.tangentFrameRightWS=v(),this.tangentFrameForwardWS=v(),this.localFrameRightWS=v(),this.localFrameUpWS=v(),this.worldToLocalTransform=N(),this.localToWorldTransform=N(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;let r=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);let i=v();n(i,this.tangentFrameForwardWS,y(r,this.tangentFrameForwardWS)),ne(this.localFrameRightWS,r,i),E(this.localFrameRightWS,this.localFrameRightWS),k(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),oe(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),P(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode===`global`}makeMapPoint(e,t){return z(e,t,this.defaultZ)}mapToLocal(e){let t=v();this.view.renderCoordsHelper.toRenderCoords(new w({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),b(t,t,this.worldToLocalTransform);let n=this.view.renderCoordsHelper.fromRenderCoords(t,new w({spatialReference:this.view.spatialReference}));return n==null?null:B(n.x/this.scale,n.y/this.scale)}localToMap(e){let t=v();this.view.renderCoordsHelper.toRenderCoords(new w({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),b(t,t,this.localToWorldTransform);let n=this.view.renderCoordsHelper.fromRenderCoords(t,new w({spatialReference:this.view.spatialReference}));return n==null?null:z(n.x,n.y,this.defaultZ)}};function W(e,t){if(e.type===`2d`)return new H(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type===`3d`){let n=t.length>2?new w({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new w({x:t[0],y:t[1],spatialReference:e.spatialReference});return new U(e,n)}return null}function G(e,t){let n=new w({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function K(e,t){return new h({points:e,spatialReference:t})}function se(e,t,n){let r=new u({paths:e,spatialReference:t});return n&&T(r),r}function q(e,t,n,r=!0){let i=f(e);i.forEach(e=>{let t=e[0],n=e[e.length-1];O(t,n)&&e.length!==1||e.push(e[0])});let a=new C({rings:i,spatialReference:t});return a.rings.forEach(e=>{m(e)||e.reverse()}),n&&T(a),r&&!ae(a)&&M(t)&&(a=ie(a)||a),a}function ce(e,t,n){let r=t.mapToLocalMultiple(e),i=[],a={x:r[0].x,y:r[0].y},s={x:r[1].x,y:r[1].y},c=Math.round(s.x-a.x),l=Math.round(s.y-a.y),u=Math.max(Math.abs(c),Math.abs(l));if(n){let e={x:a.x+u,y:a.y+u},t={x:a.x-u,y:a.y-u};i.push(B(e.x,t.y),B(t.x,t.y),B(t.x,e.y),B(e.x,e.y))}else{let e={x:c>0?a.x+u:a.x-u,y:l>0?a.y+u:a.y-u};i.push(B(a.x,a.y),B(e.x,a.y),B(e.x,e.y),B(a.x,e.y))}return J(q([i.map(e=>t.localToMap(e)).filter(o)],t.spatialReference,t.doUnnormalization,!0),i,t)}function le(e,t,n){let r=t.mapToLocalMultiple(e);if(r.length===1){let e=r[0];r=[B(e.x-48,e.y+48),B(e.x+48,e.y-48),B(e.x+48,e.y-48),B(e.x-48,e.y+48)]}let i=[],a={x:r[0].x,y:r[0].y},s={x:r[1].x,y:r[1].y};if(n){let e=Math.round(s.x-a.x),t=Math.round(s.y-a.y);i.push(B(a.x-e,a.y-t),B(s.x,a.y-t),B(s.x,s.y),B(a.x-e,s.y))}else i.push(B(a.x,a.y),B(s.x,a.y),B(s.x,s.y),B(a.x,s.y));return J(q([i.map(e=>t.localToMap(e)).filter(o)],t.spatialReference,t.doUnnormalization,!0),i,t)}function J(e,t,n){let r=Y(t[3],t[2],n),i=Y(t[1],t[2],n),a=Y(t[0],t[1],n),o=Y(t[0],t[3],n);return{geometry:e,midpoints:r!=null&&i!=null&&a!=null&&o!=null?{top:r,right:i,bottom:a,left:o}:null}}function Y(e,t,n){Z[0]=e.x,Z[1]=e.y,Z[2]=0,Q[0]=t.x,Q[1]=t.y,Q[2]=0,D(Z,Z,Q,.5),X.x=Z[0],X.y=Q[1],X.z=Q[2];let r=n.localToMap(X);return r==null?null:G(r,n.spatialReference)}var X=B(0,0,0),Z=v(),Q=v();function $(e,n,r,i){let a=n.mapToLocalMultiple(e),o=null,c=null;if(r)o=a[0],c=a[1];else{let e=a[0],t=a[1],n=Math.round(t.x-e.x),r=Math.round(t.y-e.y),i=Math.max(Math.abs(n),Math.abs(r));o=B(n>0?e.x+i/2:e.x-i/2,r>0?e.y+i/2:e.y-i/2),c=B(Math.abs(n)>Math.abs(r)?o.x-i/2:o.x,Math.abs(n)>Math.abs(r)?o.y:o.y-i/2)}let l=n.localToMap(o),u=n.localToMap(c);if(l==null||u==null)return null;n.doUnnormalization&&s([[l,u]],n.spatialReference);let d=G(l,n.spatialReference),f=G(u,n.spatialReference),p=t(n.spatialReference),m=0;if(M(n.spatialReference))m=p*re(d,f);else{let e=o.x-c.x,t=o.y-c.y;m=p*Math.sqrt(e*e+t*t)*(i||1)}let h=new R({center:d,radius:m,radiusUnit:`meters`,spatialReference:n.spatialReference});return{geometry:q(h.rings,h.spatialReference,!1),center:d,edge:f}}function ue(e,t,n){let r=t.mapToLocalMultiple(e),i=r[0],a=r[1],s=Math.round(a.x-i.x),c=Math.round(a.y-i.y),l=B(n?i.x:i.x+s/2,n?i.y:i.y+c/2),u=n?s:s/2,d=n?c:c/2,f=[],p=2*Math.PI/60;function m(e){let t=Math.cos(e),n=Math.sin(e);return B(u*t+l.x,d*n+l.y)}for(let e=0;e<60;e++)f.push(m(e*p));f.push(f[0]);let{spatialReference:h,doUnnormalization:g}=t,_=q([f.map(e=>t.localToMap(e)).filter(o)],h,g,!1),v=t.localToMap(m(Math.PI/2)),y=t.localToMap(m(0)),b=t.localToMap(m(-Math.PI/2)),x=t.localToMap(m(Math.PI));return{geometry:_,midpoints:v!=null&&y!=null&&b!=null&&x!=null?{top:G(v,h),right:G(y,h),bottom:G(b,h),left:G(x,h)}:null}}export{se as a,W as c,ce as i,q as n,$ as o,le as r,ue as s,K as t};