import{JC as e,Qb as t,Rb as n,Wb as r}from"./index-CzMixifc.js";import{r as i}from"./dataUtils-CAfnFU_x.js";function a(e,t,n){let{extent:r,valid:i}=e,[a,o,s,c]=r;return!(n<o||n>c)&&(i!=null&&a>s?t>=s||t<=a:t>=a&&t<=s)}function o(t,n,i,a){let{extent:o,modelSize:c,valid:l}=t,[u,d,f]=o,p=s(u,f,l),m=n/c[0]*p+u;return l!=null&&a&&(m=new e(l[0],l[1]).normalize(m)),[m,(c[1]-i)/c[1]*r(o)+d]}function s(e,t,n){if(n!=null&&e>t){let[r,i]=n;return i-e+(t-r)}return t-e}function c(e){return e?4:3}function l(e,s,c){let[l,u]=c.modelSize,d=null,f=new Map;s.forEach(t=>{f.set(t.lij,i(e,t))});let p=(e,t,r)=>n(e.extent,t,r);return(n,i)=>{let m=Math.round(n),h=Math.round(i);if(!e.wrapAround&&(m<0||m>=l||h<0||h>=u))return[0,0];let[g,_]=o(c,n,i,!0);if(!a(c,g,_))return[0,0];if(d==null||!p(d,g,_)){d=null;for(let[e,t]of s)if(p(t,g,_)){d=t;break}}if(d?.data==null)return[0,0];let v=f.get(d.lij);if(v==null)return[0,0];let{width:y,height:b,extent:x}=d;return v((g-x[0])/t(x)*y,b-(_-x[1])/r(x)*b)}}export{c as n,l as t};