import{DT as e,Gf as t,H_ as n,Hw as r,Kw as i,OT as a,Od as o,Ov as s,T_ as c,WT as l,_w as u,dg as ee,ev as d,gD as f,jd as te,nv as p,pg as m,rT as h,rv as g,vd as _}from"./index-CzMixifc.js";import"./memoryEstimations-C3WUBUZI.js";import"./OptimizedGeometry-5fDazGe-.js";import"./Point2D-BslC4Gs9.js";import"./Envelope2D-n2TB2v9l.js";import"./SpatialReference-BzfAMI5E.js";import"./Transformation2D-B6W9saMR.js";import"./SimpleGeometryCursor-BbFgAuic.js";import"./OperatorDefinitions-DoM9xd5U.js";import"./jsonConverter-CYYMdpyx.js";import"./apiConverter-BOyb99jX.js";import"./geodeticCurveType-B3tSXlNQ.js";import{i as ne,r as re}from"./geodeticAreaOperator-Csb55Hyk.js";import"./operatorGeodeticDensify-DHOu5z6X.js";import{i as v,o as y}from"./geodeticDensifyOperator-fGo38czy.js";import{i as b,r as x}from"./geodeticLengthOperator-BOd67Z-X.js";import{t as S}from"./areaOperator-Dnul1UIO.js";import{n as C}from"./lengthOperator-Dt-MIlZz.js";import"./operatorSimplify-HaL4veBZ.js";import{r as w}from"./simplifyOperator-DqzqfbFt.js";import"./quatf64-eO7UAs9K.js";import"./earcut-CsNwSYFA.js";import"./plane--nqwMDYx.js";import"./vectorStacks-BQiry9fn.js";import"./projectPointToVector-D72S8Uh5.js";import"./spatialReferenceEllipsoidUtils-b6wDfyu0.js";import"./projectionZScaling-BFjppU0E.js";import{i as T,r as E}from"./projectOperator-Db8iIPh0.js";import"./dehydratedPoint-CVzHYxaL.js";import"./projectVectorToVector-CZxjcyx6.js";import"./elevationInfoUtils-BcUBf70F.js";import{o as D,r as O}from"./colorUtils-Btp0B-0Y.js";import{t as k}from"./GraphicsLayer-CSZ-X1QF.js";import"./ObjectStack-DiVLRoBj.js";import"./ray-XqUMyuyU.js";import{t as ie}from"./getDefaultUnitForView-hBFUzhgR.js";import{n as ae,t as A}from"./ExclusiveOperationManager-BRGv9mhm.js";import{n as j,s as M}from"./quantity-DI5We-W2.js";import"./unitFormatUtils-dqVr3yY8.js";import{r as N}from"./quantityFormatUtils-BugvT62a.js";import{c as P,n as F,o as I,s as L}from"./geodesicUtils-DoIAZh7n.js";import{n as R,t as z}from"./SketchViewModel-Dri-bLEj.js";import"./isSupportedObject-B58JKqS1.js";import"./layerUtils-CCmUM-i4.js";import"./SketchOptions-CQ-6mB9z.js";import"./LineSnappingHint-C4TfMb_L.js";import"./ParallelSnappingHint-V0i1PzO4.js";import"./snappingUtils-BVQZFw4z.js";import"./vec3-D7a6REBc.js";import"./sphere-DkSdrT5o.js";import"./constraints-CZ12pnWC.js";import"./SnappingCandidate-CgOYxD9J.js";import"./EdgeSnappingCandidate-CRqUhTG1.js";import"./DrapedEdgeSnappingCandidate-yTm_e8W9.js";import"./IntersectionSnappingHint-GxnfNu8X.js";import"./IntersectionSnappingCandidate-CEWLdgd3.js";import"./LineSnappingCandidate-DrfbJnwY.js";import"./RightAngleTriangleSnappingCandidate-BnNMDbkx.js";import"./RightAngleSnappingHint-DDG9ajUd.js";import"./viewUtils-BjnASAVJ.js";import"./viewUtils-D2qwRYoF.js";import"./euclideanLengthMeasurementUtils-D4gy5vyI.js";import"./lineSegment-WEn1ku7V.js";import"./triangle-B4dfMIWc.js";import"./hitTestSelectUtils-B7XlogWA.js";function B(e){let n=O(e,.2);return new t({data:{type:`CIMSymbolReference`,symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,color:n.toArray()}]}}})}function V(e){return new t({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{type:`CIMSolidStroke`,capStyle:`Butt`,width:2,color:e.toArray()}]}}})}function H(e){let n=O(D(e,160),.5);return new t({data:{type:`CIMSymbolReference`,primitiveOverrides:[{type:`CIMPrimitiveOverride`,primitiveName:`textOverride`,propertyName:`TextString`,valueExpressionInfo:{type:`CIMExpressionInfo`,title:`Custom`,expression:`$feature.areaText`,returnType:`Default`}}],symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMVectorMarker`,colorLocked:!0,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:`CIMMarkerGraphic`,geometry:{x:0,y:0},symbol:{type:`CIMTextSymbol`,fontFamilyName:`sans-serif`,height:14,horizontalAlignment:`Center`,symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,color:e.toArray()}]},haloSymbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,color:n.toArray()}]},haloSize:1.5,verticalAlignment:`Center`},primitiveName:`textOverride`}],scaleSymbolsProportionally:!0,respectFrame:!0,markerPlacement:{type:`CIMMarkerPlacementPolygonCenter`}}]}}})}var U=class extends u{get _messages(){return this._messagesTask?.value}constructor(e){super(e),this._graphicsLayer=new k({listMode:`hide`,internal:!0}),this._updatingHandles=new m}initialize(){this.view.map?.add(this._graphicsLayer),this.addHandles(n(()=>this._updateMessageBundle())),this._updatingHandles.add(()=>({accentColor:this.view.effectiveTheme.accentColor,area:this.measurementViewData.result?.area,fill:this.measurementViewData.result?.display.fill,messages:this._messages,outline:this.measurementViewData.result?.display.outline,textColor:this.view.effectiveTheme.textColor,unit:this.measurementViewData.unit,visible:this.measurementViewData.visible}),({accentColor:e,area:t,fill:n,messages:r,outline:i,textColor:a,unit:o,visible:s},c)=>{if(this._graphicsLayer.visible=s,!s)return;if(!(t&&n&&r&&i))return void this._graphicsLayer.graphics.destroyAll();let l=r&&t?N(r,t,o):null;if(this._graphicsLayer.graphics.length===3&&e.equals(c?.accentColor)&&a.equals(c?.textColor)){let[e,t,r]=this._graphicsLayer.graphics.toArray();e.geometry=n,t.geometry=i,r.attributes.areaText=l,r.geometry=n;return}this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.addMany([new _({geometry:n,symbol:B(e)}),new _({geometry:i,symbol:V(e)}),new _({attributes:{areaText:l},geometry:n,symbol:H(a)})])},d),this._updateMessageBundle()}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get updating(){return!this._graphicsLayer.loaded||!this._messagesTask?.finished||this._updatingHandles.updating}_updateMessageBundle(){return this._messagesTask?.abort(),this._messagesTask=ee(()=>c(`esri/core/t9n/Units`)),this._messagesTask.promise}};f([e()],U.prototype,`_messages`,null),f([e()],U.prototype,`_messagesTask`,void 0),f([e()],U.prototype,`measurementViewData`,void 0),f([e()],U.prototype,`updating`,null),f([e()],U.prototype,`view`,void 0),U=f([a(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementAreaVisualization`)],U);var W=j(1e5,`meters`);async function G(e,t){if(!e?.rings.length||!e.rings[0].length)return null;await T();let n=E(e,t);return n?n.spatialReference.isGeographic?L(n.spatialReference)?q(n):K(n):n.spatialReference.isWebMercator?K(n):oe(n):null}async function K(e){await Promise.all([ne(),y(),b()]);let t=w(e);if(!t)return null;let n=J(t),r=v(t,W.value,{unit:W.unit});if(!r)return null;let i=v(n,W.value,{unit:W.unit});if(!i)return null;let a=x(t,{unit:`meters`}),o=re(t,{unit:`square-meters`});return{area:M(o,`square-meters`),display:{fill:r,outline:i},mode:`geodesic`,perimeter:j(a,`meters`)}}function q(e){let t=w(e);if(!t)return null;let n=J(t),r=P(t,W.value),i=P(n,W.value),a=I([t],`meters`)[0],o=F([t],`square-meters`)[0];return{area:M(o,`square-meters`),display:{fill:r,outline:i},mode:`geodesic`,perimeter:j(a,`meters`)}}function oe(e){let t=w(e);if(!t)return null;let n=J(t),r=C(n,{unit:`meters`}),i=S(t,{unit:`square-meters`});return{area:M(i,`square-meters`),display:{fill:t,outline:n},mode:`euclidean`,perimeter:j(r,`meters`)}}function J(e){return new s({spatialReference:e.spatialReference,paths:e.rings})}var Y=class extends u{constructor(e){super(e),this._result=null,this._updatingHandles=new m,this._debouncedGetResult=r(async e=>{this._result=await G(e,this.view.spatialReference)})}initialize(){this.addHandles(p(()=>this.measurementViewData.analysis.geometry,e=>{this._updatingHandles.addPromise(h(this._debouncedGetResult(e)))},g))}destroy(){this._updatingHandles.destroy()}get result(){return this._result}get updating(){return this._updatingHandles.updating}};f([e()],Y.prototype,`_result`,void 0),f([e()],Y.prototype,`measurementViewData`,void 0),f([e()],Y.prototype,`result`,null),f([e()],Y.prototype,`updating`,null),f([e()],Y.prototype,`view`,void 0),Y=f([a(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementController`)],Y);var X=class extends u{constructor(e){super(e),this._emptyFillSymbol=new o({color:null,outline:null}),this._graphicsLayer=new k({listMode:`hide`,internal:!0}),this._updatingHandles=new m}initialize(){this.view.map?.add(this._graphicsLayer),this._updatingHandles.add(()=>({geometry:this.measurementViewData.analysis.geometry}),({geometry:e})=>{if(!e)return void this._graphicsLayer.graphics.destroyAll();let t=this._graphicsLayer.graphics.at(0);t?t.geometry=e:(this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new _({geometry:e,symbol:this._emptyFillSymbol})))},d)}destroy(){this._emptyFillSymbol.destroy(),this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get graphic(){return this._graphicsLayer.graphics.at(0)}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded||this._updatingHandles.updating}};f([e()],X.prototype,`graphic`,null),f([e()],X.prototype,`graphicsLayer`,null),f([e()],X.prototype,`measurementViewData`,void 0),f([e()],X.prototype,`updating`,null),f([e()],X.prototype,`view`,void 0),X=f([a(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementManipulatorVisualization`)],X);var Z=class extends u{constructor(e){super(e),this._graphicsLayer=new k({listMode:`hide`,internal:!0})}initialize(){this.view.map?.add(this._graphicsLayer)}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded}};f([e()],Z.prototype,`graphicsLayer`,null),f([e()],Z.prototype,`measurementViewData`,void 0),f([e()],Z.prototype,`updating`,null),f([e()],Z.prototype,`view`,void 0),Z=f([a(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementSketchVisualization`)],Z);function se(e){return e?.type===`polygon`}var Q=class extends u{constructor(e){super(e),this._invisibleAreaSymbol=new o({color:null,outline:null}),this._operationManager=new A,this._updatingHandles=new m}initialize(){this._sketchViewModel=new z({defaultCreateOptions:{mode:`click`},defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{edgeOperation:`none`,shapeOperation:`none`},toggleToolOnClick:!1,tool:`reshape`},updateOnGraphicClick:!1,view:this.view}),this.addHandles([p(()=>({interactive:this.measurementViewData.interactive,visible:this.measurementViewData.visible}),({interactive:e,visible:t})=>{this._operationManager.stop(),t&&e&&this.reshape()}),p(()=>this.measurementViewData.snappingOptions,e=>{this._sketchViewModel&&(this._sketchViewModel.snappingOptions=e)},d),p(()=>this.view.effectiveTheme.accentColor,e=>{this._areaSymbol=new o({color:O(e,.3),outline:new te({color:e,width:2})})},d)])}destroy(){this._areaSymbol?.destroy(),this._invisibleAreaSymbol.destroy(),this._operationManager.destroy(),this._sketchViewModel?.destroy(),this._updatingHandles.destroy()}get state(){if(!this.measurementViewData.visible||!this._operationManager.currentOperationType)return`idle`;switch(this._operationManager.currentOperationType){case`place`:return`placing`;case`reshape`:return`reshaping`}}get updating(){return!this._sketchViewModel||this._sketchViewModel.updating||this._updatingHandles.updating}async place(e){return this._operationManager.start(`place`,async t=>{if(!this._sketchViewModel||!this.measurementViewData.sketchGraphicsLayer)return;let n=this._sketchViewModel.on(`create`,e=>{switch(e.state){case`active`:{let t=e.graphic?.geometry;t?.type===`polygon`&&(this.measurementViewData.analysis.geometry=t);break}case`cancel`:case`complete`:t.stop()}});t.handles.push(n,l(()=>{if(n.remove(),this._sketchViewModel?.cancel(),this.measurementViewData.sketchGraphicsLayer?.removeAll(),i(e))return t.reject();t.resolve({})})),this._sketchViewModel.polygonSymbol=this._invisibleAreaSymbol,this._sketchViewModel.layer=this.measurementViewData.sketchGraphicsLayer,this._updatingHandles.addPromise(h(this._sketchViewModel.create(`polygon`)))})}async reshape(e){return this._operationManager.start(`reshape`,async t=>{if(!this._sketchViewModel)return;let n=()=>this._areaSymbol&&this._sketchViewModel&&this.measurementViewData.manipulatorGraphic&&this.measurementViewData.manipulatorGraphicsLayer?(this._sketchViewModel.polygonSymbol=this._areaSymbol,this._sketchViewModel.layer=this.measurementViewData.manipulatorGraphicsLayer,this._updatingHandles.addPromise(h(this._sketchViewModel.update(this.measurementViewData.manipulatorGraphic,{tool:`reshape`})))):Promise.resolve(),r=this._sketchViewModel.on(`update`,e=>{let r=e.graphics[0]?.geometry;this.measurementViewData.analysis.geometry=se(r)?r:null,e.state===`complete`&&(this.measurementViewData.interactive?n():t.stop())});t.handles.push(r,l(()=>{if(r.remove(),this._sketchViewModel?.cancel(),i(e))return t.reject();t.resolve()})),await n()})}};f([e()],Q.prototype,`_sketchViewModel`,void 0),f([e()],Q.prototype,`measurementViewData`,void 0),f([e()],Q.prototype,`state`,null),f([e()],Q.prototype,`updating`,null),f([e()],Q.prototype,`view`,void 0),Q=f([a(`esri.views.2d.analysis.AreaMeasurement.AreaMeasurementTool`)],Q);var $=class extends ae{constructor(e){super(e),this.analysis=null,this.snappingOptions=new R,this.type=`area-measurement-view-2d`}initialize(){let{view:e}=this;this._areaVisualization=new U({view:e,measurementViewData:this}),this._controller=new Y({view:e,measurementViewData:this}),this._manipulatorVisualization=new X({view:e,measurementViewData:this}),this._sketchVisualization=new Z({view:e,measurementViewData:this}),this._tool=new Q({view:e,measurementViewData:this})}destroy(){this._areaVisualization?.destroy(),this._controller?.destroy(),this._manipulatorVisualization?.destroy(),this._sketchVisualization?.destroy(),this._tool?.destroy()}get manipulatorGraphic(){return this._manipulatorVisualization?.graphic}get manipulatorGraphicsLayer(){return this._manipulatorVisualization?.graphicsLayer}get sketchGraphicsLayer(){return this._sketchVisualization?.graphicsLayer}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get result(){return this._controller?.result}get unit(){return this.analysis.unit??ie(this.view)}get updating(){return(this._areaVisualization?.updating??!0)||(this._controller?.updating??!0)||(this._sketchVisualization?.updating??!0)||(this._tool?.updating??!0)}get visible(){return super.visible}set visible(e){super.visible=e}async place(e){return this._tool.place(e)}};f([e()],$.prototype,`_areaVisualization`,void 0),f([e()],$.prototype,`_controller`,void 0),f([e()],$.prototype,`_manipulatorVisualization`,void 0),f([e()],$.prototype,`_sketchVisualization`,void 0),f([e()],$.prototype,`_tool`,void 0),f([e({constructOnly:!0})],$.prototype,`analysis`,void 0),f([e()],$.prototype,`manipulatorGraphic`,null),f([e()],$.prototype,`manipulatorGraphicsLayer`,null),f([e()],$.prototype,`sketchGraphicsLayer`,null),f([e({readOnly:!0})],$.prototype,`result`,null),f([e({type:R,nonNullable:!0})],$.prototype,`snappingOptions`,void 0),f([e({readOnly:!0})],$.prototype,`type`,void 0),f([e({readOnly:!0})],$.prototype,`unit`,null),f([e({readOnly:!0})],$.prototype,`updating`,null),$=f([a(`esri.views.2d.analysis.AreaMeasurementAnalysisView2D`)],$);var ce=$;export{ce as default};