const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/groupLayerUtils-DOs9HYnK.js","assets/index-CZ4oMP1N.js","assets/index-CDgdHpAj.css","assets/originUtils-D6xFQIj1.js","assets/utils-xGYiRwRX.js","assets/saveUtils-Cw05PoQr.js","assets/resourceUtils-BiMcW5zN.js","assets/resourceUtils-BCTmrDyq.js"])))=>i.map(i=>d[i]);
import{A as e,AT as t,BS as n,DT as r,Dh as i,Fh as a,HT as o,Ha as s,Hw as c,Jw as l,L as u,M as d,OT as f,Q_ as p,Rh as m,Y_ as h,Z_ as g,am as _,gD as v,jT as y,lh as b,nv as x,om as S,rv as C,sm as w,uE as T,ua as E,wx as D}from"./index-CZ4oMP1N.js";import{n as O}from"./saveUtils-Cw05PoQr.js";import"./associatedFeatureServiceUtils-LJSputl4.js";import"./fetchService-yJGFErvp.js";import"./loadUtils-IIOJvYVV.js";import{t as k}from"./lazyLayerLoader-Z7OZuTUf.js";import{t as A}from"./layersCreator-CeQNT9as.js";import"./portalLayers-DpY9FtF8.js";import{t as j}from"./tagSymbols-CazaFvX8.js";var M=class extends E(e(u(d(_(S(s(i))))))){constructor(e){super(e),this.allLayers=new h({getCollections:()=>[this.layers],getChildrenFunction:e=>`layers`in e?e.layers:null}),this.allTables=w(this),this.fullExtent=void 0,this.operationalLayerType=`GroupLayer`,this.spatialReference=void 0,this.type=`group`,this._debouncedSaveOperations=c(async(e,t,r)=>{let{save:i,saveAs:a}=await n(async()=>{let{save:e,saveAs:t}=await import(`./groupLayerUtils-DOs9HYnK.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5,6,7]));switch(e){case 0:return i(this,t);case 1:return a(this,r,t)}})}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([x(()=>{let e=this.parent;for(;e&&`parent`in e&&e.parent;)e=e.parent;return e&&j in e},e=>{let t=`prevent-adding-tables`;this.removeHandles(t),e&&(this.tables.removeAll(),this.addHandles(p(()=>this.tables,`before-add`,e=>{e.preventDefault(),T.getLogger(this).errorOnce(`tables`,`tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.`)}),t))},C),x(()=>this.visible,this._onVisibilityChange.bind(this),g)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf(`portalItem`)===7}_writeLayers(e,t,n,r){let i=[];if(!e)return i;e.forEach(e=>{let t=b(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);t?.layerType&&i.push(t)}),t.layers=i}set portalItem(e){this._set(`portalItem`,e)}readPortalItem(e,t,n){let{itemId:r,layerType:i}=t;if(i===`GroupLayer`&&r)return new a({id:r,portal:n?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}set visibilityMode(e){let t=this._get(`visibilityMode`)!==e;this._set(`visibilityMode`,e),t&&this._enforceVisibility(e,this.visible)}async beforeSave(){return O(this)}load(e){let t=this.loadFromPortal({supportedTypes:[`Feature Service`,`Feature Collection`,`Group Layer`,`Scene Service`,`Video Service`],layerModuleTypeMap:k,populateGroupLayer:A},e).catch(e=>{if(l(e),this.sourceIsPortalItem)throw e});return this.addResolvingPromise(t),Promise.resolve(this)}async loadAll(){return m(this,e=>{e(this.layers,this.tables)})}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}layerAdded(e){e.visible&&this.visibilityMode===`exclusive`?this._turnOffOtherLayers(e):this.visibilityMode===`inherited`&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer read to Grouplayer: uid=${e.uid}`):this.addHandles(x(()=>e.visible,t=>this._onChildVisibilityChange(e,t),g),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(t=>{t!==e&&(t.visible=!1)})}_enforceVisibility(e,t){if(!o(this).initialized)return;let n=this.layers,r=n.find(e=>e.visible);switch(e){case`exclusive`:n.length&&!r&&(r=n.at(0),r.visible=!0),this._turnOffOtherLayers(r);break;case`inherited`:n.forEach(e=>{e.visible=t})}}_onVisibilityChange(e){this.visibilityMode===`inherited`&&this.layers.forEach(t=>{t.visible=e})}_onChildVisibilityChange(e,t){switch(this.visibilityMode){case`exclusive`:t?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case`inherited`:e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};v([r({readOnly:!0,dependsOn:[]})],M.prototype,`allLayers`,void 0),v([r({readOnly:!0})],M.prototype,`allTables`,void 0),v([r({json:{read:!0,write:!0}})],M.prototype,`blendMode`,void 0),v([r()],M.prototype,`fullExtent`,void 0),v([r({readOnly:!0})],M.prototype,`sourceIsPortalItem`,null),v([r({json:{read:!1,write:{ignoreOrigin:!0}}})],M.prototype,`layers`,void 0),v([t(`layers`)],M.prototype,`_writeLayers`,null),v([r({type:[`GroupLayer`]})],M.prototype,`operationalLayerType`,void 0),v([r({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,t,n){return{enabled:e?.type===`Group Layer`&&n?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],M.prototype,`portalItem`,null),v([y(`web-map`,`portalItem`,[`itemId`])],M.prototype,`readPortalItem`,null),v([t(`web-map`,`portalItem`,{itemId:{type:String}})],M.prototype,`writePortalItem`,null),v([r({type:D})],M.prototype,`spatialReference`,void 0),v([r({json:{read:!1},readOnly:!0,value:`group`})],M.prototype,`type`,void 0),v([r({type:[`independent`,`inherited`,`exclusive`],value:`independent`,json:{write:!0,origins:{"web-map":{type:[`independent`,`exclusive`],write:(e,t,n)=>{e!==`inherited`&&(t[n]=e)}}}}})],M.prototype,`visibilityMode`,null),M=v([f(`esri.layers.GroupLayer`)],M);var N=M;export{N as default};