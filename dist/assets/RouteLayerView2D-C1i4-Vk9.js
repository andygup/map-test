const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RouteLayerInteraction-DyhaBgVs.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/measures-DjCw0e_k.js","assets/closestPointOnCurve-CwZL45U3.js","assets/Distance2DCalculator-CXhBP-8I-CYkwuMp9.js","assets/SpatialReference-CfUjvF_j.js","assets/Envelope2D-B7gkUj4e.js","assets/Point2D-DJueHbCy.js","assets/OperatorDefinitions-C5Pat-Jx.js","assets/SimpleGeometryCursor-BILtMaQf.js","assets/Transformation2D-D07KwcEj.js","assets/OperatorProximity-0Hb8DnmN.js","assets/distanceOperator-Cfhn9VMw.js","assets/apiConverter-Dsm0pxcs.js","assets/jsonConverter-CoA5-zxu.js","assets/FlatGeometry-BsPiiSVP.js","assets/memoryEstimations-D_IbKyOk.js","assets/OptimizedGeometry-BQJ7w5VU.js","assets/earcut-CEMcWA4Z.js","assets/geodeticAreaOperator-B2LzXjd-.js","assets/geodeticCurveType-CcdKHJt5.js","assets/geodeticLengthOperator-BdZS0ajo.js","assets/proximityOperator-DOGTxDst.js","assets/ObjectStack-l5kM7JZu.js","assets/vectorStacks-Cuo89CNO.js","assets/quatf64-D37SEdPg.js","assets/colorUtils-CzajW9E7.js","assets/vec3-B94Y7ih2.js","assets/sphere-d9-4vNcj.js","assets/plane-Da5EsY0J.js","assets/ray-LkJ58wpZ.js","assets/memoize-Dl61_jt0.js","assets/quantity-Co6flzuS.js","assets/geodesicUtils-D99LxQ6q.js","assets/projectionZScaling-C8xhU_hX.js","assets/projectOperator-DWqbOm71.js","assets/projectPointToVector-BkRdoTqD.js","assets/projectVectorToVector-DGzn2p7I.js","assets/dehydratedPoint-CWZQBefp.js","assets/spatialReferenceEllipsoidUtils-qw9wv8RL.js","assets/lineSegment-BudcKS0C.js","assets/triangle-46ad8nAb.js","assets/GraphicsLayer-DBcl42yN.js","assets/Stop-DH13WZls.js","assets/networkEnums-DSwvS-2R.js","assets/elevationInfoUtils-uoMH3ofe.js","assets/SketchViewModel-BUSTPGCt.js","assets/isSupportedObject-CnaOA-Ng.js","assets/layerUtils-BZgsYerz.js","assets/SketchOptions-DjwJVzbR.js","assets/LineSnappingHint-CmFAetWF.js","assets/ParallelSnappingHint-CVYaPm-q.js","assets/DrapedEdgeSnappingCandidate-CqXt8QLN.js","assets/constraints-Ch5tsKD8.js","assets/EdgeSnappingCandidate-CCg5Xb97.js","assets/SnappingCandidate-DueCLuvH.js","assets/IntersectionSnappingCandidate-C2uVyhEk.js","assets/IntersectionSnappingHint-CvQZ8eWi.js","assets/LineSnappingCandidate-BNbhbOGH.js","assets/RightAngleTriangleSnappingCandidate-CqVuCsko.js","assets/RightAngleSnappingHint-tXLlHR_t.js","assets/viewUtils-GR2hLWLo.js","assets/viewUtils-H4dpIyqQ.js","assets/snappingUtils-D3oTIKrZ.js","assets/euclideanLengthMeasurementUtils-CvEUUrXw.js","assets/hitTestSelectUtils-DrV1belT.js"])))=>i.map(i=>d[i]);
import{$S as e,BT as t,VT as n,dv as r,hv as i,kD as a,mv as o,ov as s,pv as c,rE as l,sD as u}from"./index-BN8X5Ryz.js";import"./memoryEstimations-D_IbKyOk.js";import"./OptimizedGeometry-BQJ7w5VU.js";import"./OptimizedFeatureSet-CLjmRHYn.js";import"./featureConversionUtils-o9-cJXzl.js";import"./streamLayerUtils-82UmlW-3.js";import"./QueueProcessor-D6ozkjY6.js";import"./earcut-CEMcWA4Z.js";import"./layerViewUtils-CJcMVuwG.js";import"./colorUtils-CzajW9E7.js";import"./networkEnums-DSwvS-2R.js";import"./timeSupport-vK4lVcYW.js";import"./queryUtils-DGU5ISbw.js";import"./normalizeUtilsSync-TXjrdJAe.js";import{i as d,r as f,t as p}from"./RouteInfo-2q8j8fQj.js";import{i as m,n as h,r as g,t as _}from"./Stop-DH13WZls.js";import"./GeometryUtils-B-8QW9FG.js";import"./VertexAttributeLocations-BScEla0R.js";import"./VertexElementDescriptor-Cl_nC_ty.js";import"./labelPoint-1O-zXr9b.js";import"./callExpressionWithCursor-CKz4lb1p.js";import"./FeatureMetadata-rc_NIaUe.js";import"./CIMSymbolHelper-B2DBxDPE.js";import"./rasterizingUtils-BsmZb-O9.js";import"./Rect-LbcnjDUG.js";import"./BoundingBox-Dtf81F-g.js";import"./BidiEngine-DvXbVJau.js";import"./callExpressionWithFeature-UlbvTUQ4.js";import"./OverrideHelper-BahbnLvz.js";import"./FeatureCommandQueue-2UJWGVaq.js";import"./config-Dk3C6lVr.js";import"./dehydratedFeatureComparison-BCFMkftR.js";import"./WGLContainer-jm6ZclzQ.js";import"./utils-B0heZPZY.js";import"./ProgramTemplate-B9k_04Md.js";import"./VertexArrayObject-ChtD6bwg.js";import"./BufferObject-B3_aJU6V.js";import"./VertexBuffer-Ra4pb4dR.js";import"./vec3f32-DDMWoxUL.js";import"./Container-uEjPEzbR.js";import"./GraphShaderModule-AgkKIWM0.js";import"./FramebufferObject-BoYk_2uK.js";import"./ShaderBuilder-BLOqjpgt.js";import{t as v}from"./LayerView2D-Bgb1zyoa.js";import{t as y}from"./LayerView-DQaVI2FN.js";import"./UpdateTracking2D-BMTZzgpI.js";import"./TechniqueInstance-fDAaVtEH.js";import"./TileContainer-BL1bFhTv.js";import"./constants-BOI_CTg-.js";import"./utils-DmZFjYOb.js";import{t as b}from"./highlightOptionsUtils-DmkXKeuF.js";import"./AGraphicContainer-DHUNjrd-.js";import{t as x}from"./GraphicContainer-fLr16fKu.js";import"./ComputedAttributeStorage-BgTqXVQM.js";import{t as S}from"./GraphicsView2D-CUXbaTHc.js";import"./dehydratedFeatures-D5ZOMtMh.js";var C=[`route-info`,`direction-line`,`direction-point`,`polygon-barrier`,`polyline-barrier`,`point-barrier`,`stop`],w={graphic:null,property:null,oldValue:null,newValue:null};function T(e){return e instanceof d||e instanceof f||e instanceof m||e instanceof g||e instanceof h||e instanceof p||e instanceof _}function E(e){return i.isCollection(e)&&e.length&&T(e.at(0))}function D(e){return Array.isArray(e)&&e.length>0&&T(e[0])}var O=class extends v(y){constructor(){super(...arguments),this._graphics=new i,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map,this._interaction=null,this._loadInteractionPromise=null,this.interactive=!1}get _routeItems(){return new s({getCollections:()=>this.layer&&!this.destroyed?[this.layer.routeInfo?new i([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]:[]})}initialize(){this.addHandles(c(()=>{let{interactive:e,suspended:t}=this;return{interactive:e,suspended:t}},({interactive:e,suspended:t})=>{let n=e&&!t;n&&this._getInteractionLoadPromise().then(e=>{e.enabled=this.interactive&&!this.suspended}),this._interaction&&(this._interaction.enabled=n)},o)),this._updatingHandles.addOnCollectionChange(()=>this._routeItems,e=>this._routeItemsChanged(e),r)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get(`_routeItems`)?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView(),this._interaction?.enabled&&(this._interaction.enabled=!1)}get selectedNetworkFeatures(){return this._interaction?.selectedNetworkFeatures??null}async create(e){return this._interaction?.create(e)}delete(){this._interaction?.delete()}async fetchPopupFeaturesAtLocation(e,t){return this._graphicsView.hitTest(e).filter(({popupTemplate:e})=>!!e)}highlight(e,t){let n;n=T(e)?[this._getNetworkFeatureUid(e)]:D(e)?e.map(e=>this._getNetworkFeatureUid(e)):E(e)?e.map(e=>this._getNetworkFeatureUid(e)).toArray():[e.uid];let r=n.filter(u);if(!r.length)return l();let i=b(t);return this._addHighlights(r,i),l(()=>this._removeHighlights(r,i))}async hitTest(e,t){if(this.suspended)return null;let n=this._graphicsView.hitTest(e).filter(u).map(e=>this._networkGraphicMap.get(e));if(!n.length)return null;let{layer:r}=this;return n.reverse().map(t=>({type:`route`,layer:r,mapPoint:e,networkFeature:t}))}isUpdating(){return this._graphicsView.updating}moveEnd(){}remove(e){this._interaction?.remove(e)}update(e){this._graphicsView.processUpdate(e)}viewChange(){this._graphicsView.viewChange()}_createGraphic(e){let t=e.toGraphic();return t.layer=this.layer,t.sourceLayer=this.layer,t}_createGraphicsView(){let e=this.view,t=()=>this.requestUpdate(),n=new x(e.featuresTilingScheme);this._graphicsView=new S({container:n,graphics:this._graphics,requestUpdateCallback:t,view:e}),this.container.addChild(n),this._processHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(e){let t=this._networkGraphicMap.get(e);return C.indexOf(t.type)}_getInteractionLoadPromise(){return this._loadInteractionPromise||(this._loadInteractionPromise=this._loadInteraction(),this._updatingHandles.addPromise(this._loadInteractionPromise)),this._loadInteractionPromise}_getNetworkFeatureUid(e){return this._networkFeatureMap.has(e)?this._networkFeatureMap.get(e).uid:null}async _loadInteraction(){let{layer:t,view:n}=this,{RouteLayerInteraction:r}=await e(async()=>{let{RouteLayerInteraction:e}=await import(`./RouteLayerInteraction-DyhaBgVs.js`);return{RouteLayerInteraction:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66]));return this._interaction=new r({view:n,layer:t}),this._interaction}_routeItemsChanged(e){if(e.removed.length){this._graphics.removeMany(e.removed.map(e=>{let t=this._networkFeatureMap.get(e);return this._networkFeatureMap.delete(e),this._networkGraphicMap.delete(t),t}));for(let t of e.removed)this.removeHandles(t)}if(e.added.length){this._graphics.addMany(e.added.map(e=>{let t=this._createGraphic(e);return t.symbol==null?null:(this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),t)}).filter(u));for(let t of e.added)this.addHandles([c(()=>t.geometry,(e,n)=>{this._updateGraphic(t,`geometry`,e,n)}),c(()=>t.symbol,(e,n)=>{this._updateGraphic(t,`symbol`,e,n)}),c(()=>t.popupTemplate,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).popupTemplate=e)}),c(()=>t.toGraphic().attributes,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).attributes=e)})],t);this._graphics.sort((e,t)=>this._getDrawOrder(e)-this._getDrawOrder(t))}}_updateGraphic(e,t,n,r){if(!this._networkFeatureMap.has(e)){let t=this._createGraphic(e);this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),this._graphics.add(t);return}let i=this._networkFeatureMap.get(e);i[t]=n,w.graphic=i,w.property=t,w.oldValue=r,w.newValue=n,this._graphicsView.graphicUpdateHandler(w)}_processHighlight(){let e=this._getHighlights();this._graphicsView?.setHighlight(e)}};a([t()],O.prototype,`_routeItems`,null),a([t()],O.prototype,`_interaction`,void 0),a([t()],O.prototype,`interactive`,void 0),a([t({readOnly:!0})],O.prototype,`selectedNetworkFeatures`,null),O=a([n(`esri.views.2d.layers.RouteLayerView2D`)],O);var k=O;export{k as default};