import{d as k}from"./ClassBreaksDefinition-4fI5XmSN.js";import{ak as q}from"./index-C-FXvluM.js";const C=()=>q.getLogger("esri.rest.support.generateRendererUtils");function v(n,t){return Number(n.toFixed(t))}function w(n){const{normalizationTotal:t}=n;return{classBreaks:E(n),normalizationTotal:t}}function E(n){const t=n.definition,{classificationMethod:e,normalizationType:l,definedInterval:i}=t,a=t.breakCount??1,s=[];let u=n.values;if(u.length===0)return[];u=u.sort((f,d)=>f-d);const m=u[0],p=u[u.length-1];if(e==="equal-interval")if(u.length>=a){const f=(p-m)/a;let d=m;for(let r=1;r<a;r++){const o=v(m+r*f,6);s.push({minValue:d,maxValue:o,label:b(d,o,l)}),d=o}s.push({minValue:d,maxValue:p,label:b(d,p,l)})}else u.forEach(f=>{s.push({minValue:f,maxValue:f,label:b(f,f,l)})});else if(e==="natural-breaks"){const f=B(u),d=n.valueFrequency||f.valueFrequency,r=O(f.uniqueValues,d,a);let o=m;for(let c=1;c<a;c++)if(f.uniqueValues.length>c){const h=v(f.uniqueValues[r[c]],6);s.push({minValue:o,maxValue:h,label:b(o,h,l)}),o=h}s.push({minValue:o,maxValue:p,label:b(o,p,l)})}else if(e==="quantile")if(u.length>=a&&m!==p){let f=m,d=Math.ceil(u.length/a),r=0;for(let o=1;o<a;o++){let c=d+r-1;c>u.length&&(c=u.length-1),c<0&&(c=0),s.push({minValue:f,maxValue:u[c],label:b(f,u[c],l)}),f=u[c],r+=d,d=Math.ceil((u.length-r)/(a-o))}s.push({minValue:f,maxValue:p,label:b(f,p,l)})}else{let f=-1;for(let d=0;d<u.length;d++){const r=u[d];r!==f&&(f=r,s.push({minValue:f,maxValue:r,label:b(f,r,l)}),f=r)}}else if(e==="standard-deviation"){const f=L(u),d=G(u,f);if(d===0)s.push({minValue:u[0],maxValue:u[0],label:b(u[0],u[0],l)});else{const r=P(m,p,a,f,d)*d;let o=0,c=m;for(let g=a;g>=1;g--){const V=v(f-(g-.5)*r,6);s.push({minValue:c,maxValue:V,label:b(c,V,l)}),c=V,o++}let h=v(f+.5*r,6);s.push({minValue:c,maxValue:h,label:b(c,h,l)}),c=h,o++;for(let g=1;g<=a;g++)h=o===2*a?p:v(f+(g+.5)*r,6),s.push({minValue:c,maxValue:h,label:b(c,h,l)}),c=h,o++}}else if(e==="defined-interval"){if(!i)return s;const f=u[0],d=u[u.length-1],r=Math.ceil((d-f)/i);let o=f;for(let c=1;c<r;c++){const h=v(f+c*i,6);s.push({minValue:o,maxValue:h,label:b(o,h,l)}),o=h}s.push({minValue:o,maxValue:d,label:b(o,d,l)})}return s}function b(n,t,e){let l=null;return l=n===t?e&&e==="percent-of-total"?n+"%":n.toString():e&&e==="percent-of-total"?n+"% - "+t+"%":n+" - "+t,l}function B(n){const t=[],e=[];let l=Number.MIN_VALUE,i=1,a=-1;for(let s=0;s<n.length;s++){const u=n[s];u===l?(i++,e[a]=i):u!==null&&(t.push(u),l=u,i=1,e.push(i),a++)}return{uniqueValues:t,valueFrequency:e}}function O(n,t,e){const l=n.length,i=[];e>l&&(e=l);for(let s=0;s<e;s++)i.push(Math.round(s*l/e-1));i.push(l-1);let a=I(i,n,t,e);return U(a.mean,a.sdcm,i,n,t,e)&&(a=I(i,n,t,e)),i}function I(n,t,e,l){let i=[],a=[],s=[],u=0;const m=[],p=[];for(let o=0;o<l;o++){const c=x(o,n,t,e);m.push(c.sbMean),p.push(c.sbSdcm),u+=p[o]}let f,d=u,r=!0;for(;r||u<d;){r=!1,i=[];for(let o=0;o<l;o++)i.push(n[o]);for(let o=0;o<l;o++)for(let c=n[o]+1;c<=n[o+1];c++)if(f=t[c],o>0&&c!==n[o+1]&&Math.abs(f-m[o])>Math.abs(f-m[o-1]))n[o]=c;else if(o<l-1&&n[o]!==c-1&&Math.abs(f-m[o])>Math.abs(f-m[o+1])){n[o+1]=c-1;break}d=u,u=0,a=[],s=[];for(let o=0;o<l;o++){a.push(m[o]),s.push(p[o]);const c=x(o,n,t,e);m[o]=c.sbMean,p[o]=c.sbSdcm,u+=p[o]}}if(u>d){for(let o=0;o<l;o++)n[o]=i[o],m[o]=a[o],p[o]=s[o];u=d}return{mean:m,sdcm:p}}function U(n,t,e,l,i,a){let s=0,u=0,m=0,p=0,f=!0;for(let d=0;d<2&&f;d++){d===0&&(f=!1);for(let r=0;r<a-1;r++)for(;e[r+1]+1!==e[r+2];){e[r+1]=e[r+1]+1;const o=x(r,e,l,i);m=o.sbMean,s=o.sbSdcm;const c=x(r+1,e,l,i);if(p=c.sbMean,u=c.sbSdcm,!(s+u<t[r]+t[r+1])){e[r+1]=e[r+1]-1;break}t[r]=s,t[r+1]=u,n[r]=m,n[r+1]=p,f=!0}for(let r=a-1;r>0;r--)for(;e[r]!==e[r-1]+1;){e[r]=e[r]-1;const o=x(r-1,e,l,i);m=o.sbMean,s=o.sbSdcm;const c=x(r,e,l,i);if(p=c.sbMean,u=c.sbSdcm,!(s+u<t[r-1]+t[r])){e[r]=e[r]+1;break}t[r-1]=s,t[r]=u,n[r-1]=m,n[r]=p,f=!0}}return f}function P(n,t,e,l,i){let a=Math.max(l-n,t-l)/i/e;return a=a>=1?1:a>=.5?.5:.25,a}function L(n){let t=0;for(let e=0;e<n.length;e++)t+=n[e];return t/=n.length,t}function G(n,t){let e=0;for(let l=0;l<n.length;l++){const i=n[l];e+=(i-t)*(i-t)}return e/=n.length,Math.sqrt(e)}function x(n,t,e,l){let i=0,a=0;for(let m=t[n]+1;m<=t[n+1];m++){const p=l[m];i+=e[m]*p,a+=p}a<=0&&C().warn("Exception in Natural Breaks calculation");const s=i/a;let u=0;for(let m=t[n]+1;m<=t[n+1];m++)u+=l[m]*(e[m]-s)**2;return{sbMean:s,sbSdcm:u}}const A="<Null>",_="equal-interval",Y=1,j=5,Q=10,R=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,H=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),J=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),K=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function T(n){return n==null||typeof n=="string"&&!n?A:n}function W(n){const t=n.normalizationField!=null||n.normalizationType!=null,e=n.minValue!=null||n.maxValue!=null,l=!!n.sqlExpression&&n.supportsSQLExpression;return!t&&!e&&!l}function bn(n){var s,u;const{outStatisticTypes:t}=n,e=n.returnDistinct?[...new Set(n.values)]:n.values,l=e.filter(m=>m!=null).sort(),i=l.length,a={count:i,min:l[0],max:l[i-1]};return n.supportsNullCount&&(a.nullcount=e.length-i),!n.percentileParams||(s=t==null?void 0:t.include)!=null&&s.length&&!t.include.includes("median")||(u=t==null?void 0:t.exclude)!=null&&u.length&&t.exclude.includes("median")||(a.median=N(e,n.percentileParams)),a}function X(n){var h,g;const{values:t,useSampleStdDev:e,supportsNullCount:l,outStatisticTypes:i}=n;let a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,u=null,m=null,p=null,f=null,d=0;const r=n.minValue==null?-1/0:n.minValue,o=n.maxValue==null?1/0:n.maxValue;for(const V of t)Number.isFinite(V)?V>=r&&V<=o&&(u=u===null?V:u+V,a=Math.min(a,V),s=Math.max(s,V),d++):typeof V=="string"&&d++;if(d&&u!=null){m=u/d;let V=0;for(const y of t)Number.isFinite(y)&&y>=r&&y<=o&&(V+=(y-m)**2);f=e?d>1?V/(d-1):0:d>0?V/d:0,p=Math.sqrt(f)}else a=null,s=null;const c={avg:m,count:d,max:s,min:a,stddev:p,sum:u,variance:f};return l&&(c.nullcount=t.length-d),!n.percentileParams||(h=i==null?void 0:i.include)!=null&&h.length&&!i.include.includes("median")||(g=i==null?void 0:i.exclude)!=null&&g.length&&i.exclude.includes("median")||(c.median=N(t,n.percentileParams)),c}function N(n,t){const{fieldType:e,value:l,orderBy:i,isDiscrete:a}=t,s=Z(e,i==="desc");if((n=[...n].filter(o=>o!=null).sort((o,c)=>s(o,c))).length===0)return null;if(l<=0)return n[0];if(l>=1)return n[n.length-1];const u=(n.length-1)*l,m=Math.floor(u),p=m+1,f=u%1,d=n[m],r=n[p];return p>=n.length||a||typeof d=="string"||typeof r=="string"?d:d*(1-f)+r*f}function Z(n,t){if(n){if(H.has(n))return D(t);if(J.has(n))return z(t,!1);if(n==="esriFieldTypeTimestampOffset")return ln(t);const a=z(t,!0);if(n==="esriFieldTypeString")return a;if(n==="esriFieldTypeGUID"||n==="esriFieldTypeGlobalID")return(s,u)=>a($(s),$(u))}const e=t?1:-1,l=D(t),i=z(t,!0);return(a,s)=>typeof a=="number"&&typeof s=="number"?l(a,s):typeof a=="string"&&typeof s=="string"?i(a,s):e}const F=(n,t)=>n==null?t==null?0:1:t==null?-1:null,M=(n,t)=>n==null?t==null?0:-1:t==null?1:null;function nn(n){return n?F:M}const tn=(n,t)=>M(n,t)??(n===t?0:new Date(n).getTime()-new Date(t).getTime()),en=(n,t)=>F(n,t)??(n===t?0:new Date(t).getTime()-new Date(n).getTime());function ln(n){return n?en:tn}const an=(n,t)=>M(n,t)??(n===t?0:n<t?-1:1),un=(n,t)=>F(n,t)??(n===t?0:n<t?1:-1);function z(n,t){if(!t)return n?un:an;const e=nn(n);return n?(l,i)=>{const a=e(l,i);return a??((l=l.toUpperCase())>(i=i.toUpperCase())?-1:l<i?1:0)}:(l,i)=>{const a=e(l,i);return a??((l=l.toUpperCase())<(i=i.toUpperCase())?-1:l>i?1:0)}}const on=(n,t)=>F(n,t)??t-n,rn=(n,t)=>M(n,t)??n-t;function D(n){return n?on:rn}function $(n){return n.slice(24,36)+n.slice(19,23)+n.slice(16,18)+n.slice(14,16)+n.slice(11,13)+n.slice(9,11)+n.slice(6,8)+n.slice(4,6)+n.slice(2,4)+n.slice(0,2)}function gn(n,t,e){var i,a;let l;for(l in n)(i=t==null?void 0:t.include)!=null&&i.length&&!t.include.includes(l)||(a=t==null?void 0:t.exclude)!=null&&a.length&&t.exclude.includes(l)?delete n[l]:K.includes(l)&&(Number.isFinite(n[l])||(n[l]=null));return e&&["avg","stddev","variance"].forEach(s=>{n[s]!=null&&(n[s]=Math.ceil(n[s]??0))}),n}function vn(n){const t={};for(let e of n)(e==null||typeof e=="string"&&e.trim()==="")&&(e=null),t[e]==null?t[e]={count:1,data:e}:t[e].count++;return{count:t}}function S(n){return(n==null?void 0:n.type)!=="coded-value"?[]:n.codedValues.map(t=>t.code)}function xn(n,t,e,l){const i=n.count,a=[];if(e&&t){const s=[],u=S(t[0]);for(const m of u)if(t[1]){const p=S(t[1]);for(const f of p)if(t[2]){const d=S(t[2]);for(const r of d)s.push(`${T(m)}${l}${T(f)}${l}${T(r)}`)}else s.push(`${T(m)}${l}${T(f)}`)}else s.push(m);for(const m of s)i.hasOwnProperty(m)||(i[m]={data:m,count:0})}for(const s in i){const u=i[s];a.push({value:u.data,count:u.count,label:u.label})}return{uniqueValueInfos:a}}function Tn(n,t,e,l){let i=null;switch(t){case"log":n!==0&&(i=Math.log(n)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(l)&&l!==0&&(i=n/l*100);break;case"field":Number.isFinite(e)&&e!==0&&(i=n/e);break;case"natural-log":n>0&&(i=Math.log(n));break;case"square-root":n>0&&(i=n**.5)}return i}function sn(n,t){const e=mn({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||j});return n=cn(n,t.minValue,t.maxValue),w({definition:e,values:n,normalizationTotal:t.normalizationTotal})}function cn(n,t,e){const l=t??-1/0,i=e??1/0;return n.filter(a=>Number.isFinite(a)&&a>=l&&a<=i)}function mn(n){const{breakCount:t,field:e,normalizationField:l,normalizationType:i}=n,a=n.classificationMethod||_,s=a==="standard-deviation"?n.standardDeviationInterval||Y:void 0,u=a==="defined-interval"?n.definedInterval:void 0;return new k({breakCount:t,classificationField:e,classificationMethod:a,normalizationField:i==="field"?l:void 0,normalizationType:i,standardDeviationInterval:s,definedInterval:u})}function yn(n,t){var m,p;let e=n.classBreaks;const l=e.length,i=(m=e[0])==null?void 0:m.minValue,a=(p=e[l-1])==null?void 0:p.maxValue,s=t==="standard-deviation",u=R;return e=e.map(f=>{const d=f.label,r={minValue:f.minValue,maxValue:f.maxValue,label:d};if(s&&d){const o=d.match(u),c=(o==null?void 0:o.map(h=>+h.trim()))??[];c.length===2?(r.minStdDev=c[0],r.maxStdDev=c[1],c[0]<0&&c[1]>0&&(r.hasAvg=!0)):c.length===1&&(d.includes("<")?(r.minStdDev=null,r.maxStdDev=c[0]):d.includes(">")&&(r.minStdDev=c[0],r.maxStdDev=null))}return r}),{minValue:i,maxValue:a,classBreakInfos:e,normalizationTotal:n.normalizationTotal}}function Fn(n,t){const e=fn(n,t);if(e.min==null&&e.max==null)return{bins:[],minValue:e.min,maxValue:e.max,normalizationTotal:t.normalizationTotal};const l=e.intervals,i=e.min??0,a=e.max??0,s=l.map((u,m)=>({minValue:l[m][0],maxValue:l[m][1],count:0}));for(const u of n)if(u!=null&&u>=i&&u<=a){const m=dn(l,u);m>-1&&s[m].count++}return{bins:s,minValue:i,maxValue:a,normalizationTotal:t.normalizationTotal}}function fn(n,t){const{field:e,classificationMethod:l,standardDeviationInterval:i,normalizationType:a,normalizationField:s,normalizationTotal:u,minValue:m,maxValue:p}=t,f=t.numBins||Q;let d=null,r=null,o=null;if((!l||l==="equal-interval")&&!a){if(m!=null&&p!=null)d=m,r=p;else{const c=X({values:n,minValue:m,maxValue:p,useSampleStdDev:!a,supportsNullCount:W({normalizationType:a,normalizationField:s,minValue:m,maxValue:p})});d=c.min??null,r=c.max??null}o=pn(d??0,r??0,f)}else{const{classBreaks:c}=sn(n,{field:e,normalizationType:a,normalizationField:s,normalizationTotal:u,classificationMethod:l,standardDeviationInterval:i,minValue:m,maxValue:p,numClasses:f});d=c[0].minValue,r=c[c.length-1].maxValue,o=c.map(h=>[h.minValue,h.maxValue])}return{min:d,max:r,intervals:o}}function dn(n,t){let e=-1;for(let l=n.length-1;l>=0;l--)if(t>=n[l][0]){e=l;break}return e}function pn(n,t,e){const l=(t-n)/e,i=[];let a,s=n;for(let u=1;u<=e;u++)a=s+l,a=Number(a.toFixed(16)),i.push([s,u===e?t:a]),s=a;return i}export{xn as $,Tn as B,gn as C,sn as E,yn as P,Fn as U,W as d,bn as f,Z as g,vn as k,T as m,X as p,N as v};
