import{gL as y,hN as _,bS as E,x as $,hO as D,cN as b,jG as R,jH as H,b9 as h,jI as L,go as P,aE as c,aF as v,aL as j,b2 as O,jJ as S,fd as p,jK as T,$ as k,aK as V,ff as G,gX as I,b4 as u,hP as f}from"./index-C5AN6gIb.js";import{a as x}from"./HoveredPoints-CBczvf_V.js";import{j as z,w}from"./Laserlines.glsl-DEL4_FNC.js";import"./vec4f32-CjrfB-0a.js";import"./Octree-CyDSDobB.js";import"./Util-DZ-J3OpH.js";import"./OverlayCompositing.glsl-DsnZPVOs.js";import"./vec3f32-nZdmKIgz.js";import"./DoubleArray-Bc_s-eRk.js";import"./IntegerPassUniform-D4i1Uds1.js";import"./enums-BlUEVwJR.js";import"./Texture-CTKIRDMu.js";import"./BindType-BmZEZMMh.js";import"./NormalAttribute.glsl-BsjrRndr.js";import"./Indices-BRKmhTP5.js";import"./triangle-BDxswaYW.js";import"./doublePrecisionUtils-B0owpBza.js";import"./requestImageUtils-CvlvwEvR.js";import"./renderState-Clz7MxYz.js";import"./hydratedFeatures-CMrptU6P.js";import"./triangulationUtils-CsU-mkhu.js";import"./earcut-h7wdVcTx.js";import"./deduplicate-Bon-NhLh.js";import"./axisAngleDegrees-Bq-bfGg9.js";import"./NestedMap-DgiGbX8E.js";import"./InterleavedLayout-Bq7Nk9sY.js";import"./BufferView-CNNe45YH.js";import"./types-D0PSWh4d.js";import"./glUtil-C6KhMg1m.js";import"./VertexElementDescriptor-BOD-G50G.js";import"./VertexArrayObject-itGszRJk.js";import"./BufferObject-KHYTZLM-.js";import"./floatRGBA-Ca01y9H_.js";let M=class{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null,this._settings=new z({getTheme:()=>this._params.view.effectiveTheme})}destroy(){this.remove()}remove(){this._highlightTask=y(this._highlightTask),this._highlightHandle=_(this._highlightHandle),this._visualElementHandle=_(this._visualElementHandle)}showHighlight(e){if(this.remove(),e==null||!g(e))return;const i=e.layer;this._highlightTask=E(async t=>{const a=await this._params.view.whenLayerView(i);$(t),D(a)&&(this._highlightHandle=a.highlight(e))})}showReshaping(e){if(this.remove(),e==null)return;const i=this._params.view,t=new w({view:i,geometry:g(e)?e.geometry:null,attached:!1,elevationInfo:b(e),renderOccluded:R.OccludeAndTransparentStencil,isDecoration:!0}),a=new H({graphic:e}),s=[h(()=>a.isDraped,n=>{t.isDraped=n}),a.on("changed",()=>{t.geometry=g(e)?e.geometry:null}),i.trackGraphicState(a),i.maskOccludee(e),L(t)];this._settings.visualElements.lineObjects.outline.apply(t),t.attached=!0,this._visualElementHandle=P(s)}};function g(o){return o.geometry!=null&&o.geometry.type==="polyline"}const A=100;let m=class extends O{constructor(o){super(o),this._chartData=null,this._visualElements=[]}initialize(){const o=S(e=>{this._update(e)},A);this.addHandles([h(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),o,p),o])}destroy(){this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(o){this._chartData=o}_update(o){const{chartData:e}=o;if(e==null)return this.remove();if(!e.refined)return;const i=this._visualElements,t=e.lines.filter(r=>r.viewVisualizationEnabled),a=t.length;for(;i.length>a;)i.pop().destroy();const s=G().profileLinesStyle3D;for(;i.length<a;){const r=new w({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:s.width-s.outlineSize,width:s.width,falloff:s.falloff,color:s.outlineColor,renderOccluded:s.renderOccluded,isDecoration:!0});i.push(r)}const n=o.spatialReference;for(let r=0;r<a;++r){const d=i[r],l=t[a-1-r];d.geometry=this._createLineGeometry(l,n),d.innerColor=T(k.toUnitRGBA(l.color))}}_createLineGeometry(o,e){const i=o.samples??[],t=i.length-1,a=[];let s=[];for(let n=0;n<=t;n++){const{x:r,y:d,z:l}=i[n];l!=null&&s.push([r,d,l]),n!==t&&l!=null||!s.length||(a.push(s),s=[])}return new V({paths:a,hasZ:!0,spatialReference:e})}_destroyVisualElements(){this._visualElements.forEach(o=>o.destroy()),this._visualElements.length=0}};c([v()],m.prototype,"view",void 0),c([v()],m.prototype,"_chartData",void 0),m=c([j("esri.widgets.ElevationProfile.support.ProfileLines3D")],m);class Ee{constructor(e,i){this._handles=new I,this._inputRepresentation=new M({view:e}),this._hoveredPoints=new x({view:e}),this._profileLines=new m({view:e}),this._handles.add([h(()=>i.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),p),h(()=>{const{state:t,editable:a,highlightEnabled:s,viewModel:n}=i,r=n.input;return r&&(r.commitProperty("geometry"),r.commitProperty("layer")),{input:r,state:t,editable:a,highlightEnabled:s}},t=>this._updateInputRepresentation(t),p),h(()=>i.viewModel.chartData,t=>this._profileLines.update(t),p),h(()=>{var t;return(t=i.viewModel.input)==null?void 0:t.geometry},()=>{this._profileLines.remove()},p)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:e,state:i,editable:t,highlightEnabled:a}){const s=this._inputRepresentation;if(!a)return s.remove();i===f.Selected?s.showHighlight(e):i!==f.Created||t?s.remove():s.showReshaping(e)}}export{Ee as ElevationProfileView3D};
