import{KE as e,WT as t,eT as n,uE as r,ya as i}from"./index-CZ4oMP1N.js";var a=class{constructor(e,t,n,a,o={}){this._mainMethod=t,this._transferLists=n,this._listeners=[],this._promise=i(e,{...o,schedule:a}).then(e=>{if(this._thread===void 0){this._thread=e,this._promise=null,o.hasInitialize&&this.broadcast({},`initialize`);for(let e of this._listeners)this._connectListener(e)}else e.close()}),this._promise.catch(t=>r.getLogger(`esri.core.workers.WorkerHandle`).error(`Failed to initialize ${e} worker: ${t}`))}on(n,r){let i={removed:!1,eventName:n,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),t(()=>{i.removed=!0,e(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&=(this._thread.close(),null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t,n){return this.invokeMethod(this._mainMethod,e,t,n)}invokeMethod(e,t,r,i){if(this._thread){let n=this._transferLists[e],a=n?n(t):[];return this._thread.invoke(e,t,{transferList:a,signal:r,jobPriority:i})}return this._promise?this._promise.then(()=>(n(r),this.invokeMethod(e,t,r))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then(o):this._promise?this._promise.then(()=>this.broadcast(e,t)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(t=>{e.removed||(e.threadHandle=t)})}};function o(){}export{a as t};