const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingSupport-xRvi2YoA.js","assets/editingSupport-C4cREoG_.js","assets/index-ByaFsVj4.js","assets/index-DiFef-Um.css","assets/Mesh-DtAdnnCB.js","assets/earcut-CsNwSYFA.js","assets/vec3-BwuFja2y.js","assets/vec4-CB8mMORr.js","assets/vectorStacks-DhZu7qGn.js","assets/quatf64-eO7UAs9K.js","assets/quat-sUyQdiZR.js","assets/Mesh-D_obITm-.js","assets/computeTranslationToOriginAndRotation-CI8CU_D7.js","assets/projectPointToVector-DjmX75N6.js","assets/spatialReferenceEllipsoidUtils-nVny0a-O.js","assets/MeshComponent-BFAosfis.js","assets/MeshMaterialMetallicRoughness-Bn-u5_DP.js","assets/meshCloneUtils-5rtyOBgA.js","assets/meshProperties-DwrhStLW.js","assets/MeshLocalVertexSpace-UBa2rGXG.js","assets/MeshTransform-DDT-1d0m.js","assets/axisAngleDegrees-jawZYrHR.js","assets/MeshVertexAttributes-Fw_NZ99L.js","assets/External-5UklRB0N.js","assets/vertexSpaceConversion-h_-BmbPw.js","assets/BufferView-DuUrcLgU.js","assets/Util-uF9mYnOn.js","assets/meshVertexSpaceUtils-D9WJf86L.js","assets/triangulationUtils-DrUA1_Jh.js","assets/Indices-CZ754tYW.js","assets/deduplicate-BsMx4rdl.js","assets/plane-Dmhe_zL4.js"])))=>i.map(i=>d[i]);
import{$S as e,A as t,Ai as n,B as r,BS as i,BT as a,C as o,Cr as s,D as c,DT as l,Dh as u,Di as d,Eg as f,En as p,GC as m,GT as h,HT as g,Ha as _,Hp as v,Jf as y,Jw as b,Km as x,L as S,Ln as C,M as ee,Mi as te,Ni as ne,OT as w,Oh as T,Pa as E,Pn as D,Q_ as O,Qf as re,Qw as ie,RS as k,S as A,SC as ae,SE as oe,W as se,YS as j,Yn as ce,Z_ as le,Zf as ue,Zn as de,_ as fe,ba as pe,ca as me,eT as M,gD as N,gw as P,iv as F,jT as I,ji as L,k as R,ma as z,mp as B,pa as he,pr as ge,px as _e,qi as ve,qm as ye,qw as be,rd as xe,rr as Se,th as Ce,tv as we,uE as V,v as Te,vT as Ee,vd as De,wi as Oe,xa as ke,xp as Ae,xr as je}from"./index-ByaFsVj4.js";import"./quatf64-eO7UAs9K.js";import"./quat-sUyQdiZR.js";import"./axisAngleDegrees-jawZYrHR.js";import"./MeshTransform-DDT-1d0m.js";import"./plane-Dmhe_zL4.js";import"./vectorStacks-DhZu7qGn.js";import"./projectPointToVector-DjmX75N6.js";import"./computeTranslationToOriginAndRotation-CI8CU_D7.js";import"./spatialReferenceEllipsoidUtils-nVny0a-O.js";import{n as Me}from"./capabilities-DZSM_5j8.js";import{n as Ne}from"./SceneService-sH-A36GQ.js";import{i as Pe,n as Fe,r as H,t as Ie}from"./I3SLayerDefinitions-BJzd7L2I.js";import"./dehydratedPoint-CVzHYxaL.js";import"./projectVectorToVector-BnpPb96u.js";import"./featurePopupQueryUtils-BRgVNLxs.js";import"./I3SBinaryReader-oXU1Ljxf.js";import{t as Le}from"./I3SUtil-BWU5rOAQ.js";import"./symbolColorUtils-D9wsbCVF.js";import"./orientedBoundingBox-Dou91YqM.js";import"./Emissions.glsl-CK4HR9OW.js";import"./glsl-B__sVAcg.js";import"./Uniform-CfHWJqSg.js";import"./Float3DrawUniform-UWnIK6YY.js";import"./Float3PassUniform-BIrLVK7_.js";import"./FloatPassUniform-D-_T45xB.js";import"./Texture2DDrawUniform-CV_1kucp.js";import"./Texture2DPassUniform-wY08hxIn.js";import"./NoParameters-B66z9IwQ.js";import"./layerViewUtils--V83RFAv.js";import{n as Re,t as ze}from"./popupUtils-CCVHXhjm.js";import"./originUtils-BJaUzj5W.js";import"./resourceUtils-C04-w-fM.js";import"./resourceUtils-DYI0vrsK.js";import"./saveUtils-BB0-rUbr.js";import{t as Be}from"./associatedFeatureServiceUtils-C4oO8OzZ.js";import{o as Ve,p as U,t as He}from"./elevationInfoUtils-CyQsBf6_.js";import{t as Ue}from"./lazyLayerLoader-C-gbeYPV.js";import{a as We,s as Ge,t as Ke}from"./meshSpatialReferenceScaleUtils--Vbn6Pid.js";var qe=Symbol(`isSceneGraphicOrigin`),W,Je=class extends pe{get[(W=qe,y)](){return this.layer}get[ue](){return this.layer}get[ke](){return this.layer}constructor(e){super(),this[W]=!0,this.type=`scene`,this.layer=e}get id(){return this.layer.id}};function G({associatedLayer:e,serviceUpdateTimeStamp:t}){let n=e?.editingInfo?.lastEditDate,r=e?.serverGens,i=n!=null,a=t!=null,o=i&&a&&t.lastUpdate!==n.getTime();return i&&(o||!a&&r?.minServerGen!==r?.serverGen)}var K=e=>{let t=e,n=class extends t{constructor(){super(...arguments),this.serviceTimeInfo=null}get timeInfo(){let e=this.associatedLayer?.timeInfo;if(e==null)return null;let t=e.clone();return B(t,this.fieldsIndex),t}set timeInfo(e){B(e,this.fieldsIndex),this._override(`timeInfo`,e)}get timeExtent(){return this.associatedLayer?.timeExtent}set timeExtent(e){this._override(`timeExtent`,e)}get timeOffset(){return this.associatedLayer?.timeOffset}set timeOffset(e){this._override(`timeOffset`,e)}get datesInUnknownTimezone(){return this.associatedLayer?.datesInUnknownTimezone??!1}set datesInUnknownTimezone(e){this._override(`datesInUnknownTimezone`,e)}async loadTimeInfoFromService(e){let{serviceTimeInfo:t}=this;if(t==null)return;let{startTimeField:n,endTimeField:r}=t;if(n==null&&r==null||G({associatedLayer:this.associatedLayer,serviceUpdateTimeStamp:this.serviceUpdateTimeStamp}))return;let i=async t=>{let r=null;try{r=(await this.fetchStatistics?.(t,e))?.stats}catch{}if(r==null)return null;let{minTimeStr:i,min:a,maxTimeStr:o,max:s}=r,c=t===n?i??a:o??s;return c==null?null:new Date(c)},[a,o]=await Promise.all([i(n),i(r)]);if(n!=null&&a==null||r!=null&&o==null)return;let s=new T({start:a,end:o});this.setAtOrigin(`timeInfo`,new R({endField:r,startField:n,fullTimeExtent:s}),`service`)}};return N([l({type:R,json:{read:!1,write:!1}})],n.prototype,`timeInfo`,null),N([l({type:T,json:{read:!1,write:!1}})],n.prototype,`timeExtent`,null),N([l({type:E,json:{read:!1,write:!1}})],n.prototype,`timeOffset`,null),N([l({type:Boolean,nonNullable:!0,json:{read:!1,write:!1}})],n.prototype,`datesInUnknownTimezone`,null),N([l({type:q,readOnly:!0,json:{read:{source:`timeInfo`}},clonable:!1})],n.prototype,`serviceTimeInfo`,void 0),n=N([w(`esri.layers.mixins.TemporalSceneLayer`)],n),n},q=class extends m{constructor(){super(...arguments),this.endTimeField=null,this.startTimeField=null}};N([l({type:String})],q.prototype,`endTimeField`,void 0),N([l({type:String})],q.prototype,`startTimeField`,void 0),q=N([w(`esri.layers.mixins.TemporalSceneLayer.SceneServiceTimeInfo`)],q);var J=class extends m{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type=`rangeInfo`}};N([l({type:String,json:{read:!0,write:{isRequired:!0}}})],J.prototype,`name`,void 0),N([l({type:String,json:{read:!0,write:{isRequired:!0}}})],J.prototype,`field`,void 0),N([l({type:[Number],json:{read:!0,write:!0}})],J.prototype,`currentRangeExtent`,void 0),N([l({type:[Number],json:{read:!0,write:!0}})],J.prototype,`fullRangeExtent`,void 0),N([l({type:[`rangeInfo`],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],J.prototype,`type`,void 0),J=N([w(`esri.layers.support.RangeInfo`)],J);var Y,X=Y=class extends m{constructor(e){super(e),this.spatialRelationship=`disjoint`,this.geometries=new x,this._geometriesSource=null}initialize(){this.addHandles(O(()=>this.geometries,`after-changes`,()=>this.geometries=this.geometries,le))}readGeometries(t,n,r){Array.isArray(t)?this.geometries=x.fromJSON(t,r):r.origin!==`web-scene`&&r.origin!==`portal-item`||(this._geometriesSource={url:e(t,r),context:r})}async loadGeometries(e,t){if(this._geometriesSource==null)return;let{url:n,context:r}=this._geometriesSource,i=await k(n,{responseType:`json`,signal:t?.signal}),a=e.toJSON(),o=i.data.map(e=>({...e,spatialReference:a}));this.geometries=x.fromJSON(o,r),this._geometriesSource=null}clone(){let e=new Y({geometries:oe(this.geometries),spatialRelationship:this.spatialRelationship});return e._geometriesSource=this._geometriesSource,e}};N([l({type:[`disjoint`,`contains`],nonNullable:!0,json:{write:{isRequired:!0}}})],X.prototype,`spatialRelationship`,void 0),N([l({type:x,nonNullable:!0,json:{write:!0,origins:{"web-scene":{write:{isRequired:!0}}}}}),ye({origins:[`web-scene`,`portal-item`],type:`resource`,prefix:`geometries`,contentAddressed:!0})],X.prototype,`geometries`,void 0),N([I([`web-scene`,`portal-item`,`service`],`geometries`)],X.prototype,`readGeometries`,null),X=Y=N([w(`esri.layers.support.SceneFilter`)],X);var Ye=X;async function Xe({fieldName:e,statisticsInfo:t,errorContext:n,fieldsIndex:r,path:i,customParameters:o,apiKey:s,signal:c}){if(t==null)throw new a(`${n}:no-cached-statistics`,`Cached statistics are not available for this layer`);let l=r.get(e);if(l==null)throw new a(`${n}:field-unexisting`,`Field '${e}' does not exist on the layer`);let u=t.find(e=>e.name===l.name);if(u==null)throw new a(`${n}:no-cached-statistics`,`Cached statistics for this attribute are not available`);let d=ae(i,u.href),{data:f}=await k(d,{query:{f:`json`,...o,token:s},responseType:`json`,signal:c});return f}async function Ze(e){let t=[];for(let n of e)n.name.toLowerCase().endsWith(`.zip`)?t.push(Qe(n)):t.push(Promise.resolve(n));return(await Promise.all(t)).flat()}async function Qe(e){let{BlobReader:t,ZipReader:n,BlobWriter:r}=await i(async()=>{let{BlobReader:e,ZipReader:t,BlobWriter:n}=await import(`./zipjs-wrapper-BE2wTTp2.js`);return{BlobReader:e,ZipReader:t,BlobWriter:n}},[]),a=[];return(await new n(new t(e)).getEntries()).forEach(e=>{if(e.directory||/^__MACOS/i.test(e.filename))return;let t=new r;a.push(e.getData(t).then(t=>new File([t],e.filename)))}),Promise.all(a)}var $e=new Set([`3DObject`,`Point`]),Z=o(),Q=class extends K(ve(Ne(he(S(ee(t(_(me(z(P(u))))))))))){constructor(...e){super(...e),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType=`ArcGISSceneServiceLayer`,this.type=`scene`,this.fields=null,this.graphicOrigin=new Je(this),this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new F,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.attributeTableTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0,this.serviceItemId=void 0}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}destroy(){this._set(`renderer`,null),this.associatedLayer=Ee(this.associatedLayer)}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){let n=this.getField(e)?.domain??null;return this.associatedLayer?ge(this.associatedLayer,e,t,n):n}getFeatureType(e){return e&&this.associatedLayer?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer?.types??[]}get typeIdField(){return this.associatedLayer?.typeIdField??null}get templates(){return this.associatedLayer?.templates??null}get formTemplate(){return this.associatedLayer?.formTemplate??null}get fieldsIndex(){return new p(this.fields)}readNodePages(e,t,n){return t.layerType===`Point`&&(e=t.pointNodePages),typeof e!=`object`||!e?null:H.fromJSON(e,n)}set elevationInfo(e){this._set(`elevationInfo`,e),this.loaded&&this._validateElevationInfo()}get effectiveCapabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.effectiveCapabilities)}get effectiveEditingEnabled(){return this.associatedLayer!=null&&je(this.associatedLayer)}get geometryType(){return et[this.profile]||`mesh`}set renderer(e){v(e,this.fieldsIndex),this._set(`renderer`,e)}readCachedDrawingInfo(e){return typeof e==`object`&&e||(e={}),e.color??=!1,e}get capabilities(){return this._capabilitiesFromAssociatedFeatureLayer(this.associatedLayer?.capabilities)}_capabilitiesFromAssociatedFeatureLayer(e){e??=Me;let{query:t,queryRelated:n,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:a,supportsGeometryUpdate:o,supportsReturnServiceEditsInSourceSpatialReference:s},data:{supportsZ:c,supportsM:l,isVersioned:u,supportsAttachment:d},operations:{supportsEditing:f,supportsAdd:p,supportsUpdate:m,supportsDelete:h,supportsQuery:g,supportsQueryAttachments:_,supportsAsyncConvert3D:v}}=e,y=e.operations.supportsChangeTracking,b=!!this.associatedLayer?.infoFor3D;return{query:t,queryRelated:n,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:s,supportsRollbackOnFailure:i,supportsGeometryUpdate:b&&o,supportsUploadWithItemId:a},data:{supportsAttachment:d,supportsZ:c,supportsM:l,isVersioned:u},operations:{supportsQuery:g,supportsQueryAttachments:_,supportsEditing:f&&y,supportsAdd:b&&p&&y,supportsDelete:b&&h&&y,supportsUpdate:m&&y,supportsAsyncConvert3D:v}}}get editingEnabled(){return this._isOverridden(`editingEnabled`)?this._get(`editingEnabled`):this.associatedLayer?.editingEnabled??!1}set editingEnabled(e){this._overrideIfSome(`editingEnabled`,e)}get infoFor3D(){return this.associatedLayer?.infoFor3D??null}get relationships(){return this.associatedLayer?.relationships}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(e,t){return!e&&t.fields&&t.fields.some(t=>(t.type===`esriFieldTypeOID`&&(e=t.name),!!e)),e||void 0}readGlobalIdField(e,t){return!e&&t.fields&&t.fields.some(t=>(t.type===`esriFieldTypeGlobalID`&&(e=t.name),!!e)),e||void 0}get displayField(){return this.associatedLayer?.displayField??null}readProfile(e,t){let n=t.store.profile;return n!=null&&$[n]?$[n]:(V.getLogger(this).error(`Unknown or missing profile`,{profile:n,layer:this}),`mesh-pyramids`)}get useViewTime(){return this.associatedLayer?.useViewTime??!0}set useViewTime(e){this._override(`useViewTime`,e)}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){let t=e?.signal;await this.loadFromPortal({supportedTypes:[`Scene Service`]},e).catch(b),await this._fetchService(t),await Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,t),this._setAssociatedFeatureLayer(t),this._loadFilterGeometries()]),this._validateElevationInfo(),this._applyAssociatedLayerOverrides(),this._populateFieldUsageInfo(),await this.loadTimeInfoFromService(e),await Te(this,{origin:`service`},t),v(this.renderer,this.fieldsIndex),await this.finishLoadEditablePortalLayer(e)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(e){V.getLogger(this).error(`#_loadFilterGeometries()`,this,`Failed to load filter geometries. Geometry filter will not be applied for this layer.`,{error:e}),this.filter=null}}createQuery(){let e=new xe;return this.geometryType===`mesh`?this.capabilities.query.supportsReturnMesh&&(e.returnGeometry=!0):(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||`1=1`,e.sqlFormat=`standard`,e.outFields=[`*`],e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatures(e||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=this,t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}async queryRelatedFeatures(e,t){if(await this.load(),!this.associatedLayer)throw new a(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});return this.associatedLayer.queryRelatedFeatures(e,t)}async queryRelatedFeaturesCount(e,t){if(await this.load(),!this.associatedLayer)throw new a(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});return this.associatedLayer.queryRelatedFeaturesCount(e,t)}async queryCachedAttributes(e,t){let n=Ae(this.fieldsIndex,await Re(this,ze(this)));return Le(this.parsedUrl?.path??``,this.attributeStorageInfo??[],e,t,n,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){let n=await this.queryCachedAttributes(e,[t]);if(!n||n.length===0)throw new a(`scenelayer:feature-not-in-cached-data`,`Feature not found in cached data`);let r=new De;return r.attributes=n[0],r.layer=this,r.sourceLayer=this,r.origin=this.graphicOrigin,r}queryObjectIds(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryObjectIds(e||this.createQuery(),t))}queryAttachments(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryAttachments(e,t))}getFieldUsageInfo(e){let t={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[e]||t:(V.getLogger(this).error(`#getFieldUsageInfo()`,`Unavailable until layer is loaded`),t)}createPopupTemplate(e){return fe(this,e)}_getAssociatedLayerForQuery(){let e=this.associatedLayer;return e?.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new a(`scenelayer:query-not-available`,`SceneLayer queries are not available without an associated feature layer`,{layer:this});try{await this.associatedLayer.load()}catch(e){throw new a(`scenelayer:query-not-available`,`SceneLayer associated feature layer could not be loaded`,{layer:this,error:e})}return this.associatedLayer}hasCachedStatistics(e){return this.statisticsInfo!=null&&this.statisticsInfo.some(t=>t.name===e)}async queryCachedStatistics(e,t){return await this.load(t),await this.fetchStatistics(e,t)}async saveAs(e,t){return this._debouncedSaveOperations(1,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`scene`},e)}async save(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`scene`})}async applyEdits(e,t){let{applyEdits:n}=await i(async()=>{let{applyEdits:e}=await import(`./editingSupport-xRvi2YoA.js`);return{applyEdits:e}},__vite__mapDeps([0,1,2,3])),r=t;await this.load();let o=this.associatedLayer;if(!o)throw new a(`${this.type}-layer:not-editable`,`Service is not editable`);await o.load();let{globalIdField:c}=o,l=!!o.infoFor3D,u=r?.globalIdUsed??!0;if(l&&c==null)throw new a(`${this.type}-layer:not-editable`,`Valid globalIdField expected on editable SceneLayer`);if(l&&!u)throw new a(`${this.type}-layer:globalid-required`,`globalIdUsed must not be false for SceneLayer editing as globalIds are required.`);return j(o.url)&&l&&e.deleteFeatures!=null&&c!=null&&(r={...r,globalIdToObjectId:await s(o,e.deleteFeatures,c)}),n(this,o.source,e,r)}async uploadAssets(e,t){if(await this.load(),this.associatedLayer==null)throw new a(`${this.type}-layer:not-editable`,`Service is not editable`);return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(e,t)}async convertMesh(e,t){t??={};let n=e=>{throw V.getLogger(this).error(`.convertMesh()`,e.message),e};await this.load(t),this.infoFor3D||n(new a(`invalid:layer`,`SceneLayer has no capability for mesh conversion`));let r=await this.extractAndFilterFiles(e);M(t);let o=r.reduce((e,t)=>de(this.infoFor3D,t)?e+1:e,0);o===0&&n(new We),o>1&&n(new Ge);let s=this.spatialReference,c=t.origin,l=await f(c??t.defaultOrigin??new _e({x:0,y:0,z:0,spatialReference:s}),s,t),u=s.isGeographic?`local`:`georeferenced`,{default:d}=await i(async()=>{let{default:e}=await import(`./Mesh-DtAdnnCB.js`);return{default:e}},__vite__mapDeps([4,5,6,2,3,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]));M(t);let p=d.createWithExternalSource(l,{type:`client`,files:r},{vertexSpace:u,transform:Ke(s),unitConversionDisabled:!0}),[m]=await this.uploadAssets([p],{...t,useAssetOrigin:!c});return m}async extractAndFilterFiles(e){await this.load();let t=this.infoFor3D;return t?(await Ze(e)).filter(e=>ce(t,e)):e}validateLayer(e){if(e.layerType&&!$e.has(e.layerType))throw new a(`scenelayer:layer-type-not-supported`,`SceneLayer does not support this layer type`,{layerType:e.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new a(`layer:service-version-not-supported`,`Service version is not supported.`,{serviceVersion:this.version.versionString,supportedVersions:`1.x, 2.x`});if(this.version.major>2)throw new a(`layer:service-version-too-new`,`Service version is too new.`,{serviceVersion:this.version.versionString,supportedVersions:`1.x, 2.x`});function t(e,t){let n=!1,r=!1;if(e==null)n=!0,r=!0;else{let i=t&&t.isGeographic;switch(e){case`east-north-up`:case`earth-centered`:n=!0,r=i;break;case`vertex-reference-frame`:n=!0,r=!i;break;default:n=!1}}if(!n)throw new a(`scenelayer:unsupported-normal-reference-frame`,`Normal reference frame is invalid.`);if(!r)throw new a(`scenelayer:incompatible-normal-reference-frame`,`Normal reference frame is incompatible with layer spatial reference.`)}t(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){let e=[];if(this.profile===`points`)e.push(`Point`);else{if(this.profile!==`mesh-pyramids`)throw new a(`scenelayer:unknown-profile`,`SceneLayer:save() encountered an unknown SceneLayer profile: `+this.profile);e.push(`3DObject`)}return e}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(let e of this.fields){let t=!!this.attributeStorageInfo?.some(t=>t.name===e.name),n=!!this.associatedLayer?.fields?.some(t=>t&&e.name===t.name),r={supportsLabelingInfo:t,supportsRenderer:t,supportsPopupTemplate:t||n,supportsLayerQuery:n};this._fieldUsageInfo[e.name]=r}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPropertyOverrides(),this._applyAssociatedLayerExtentOverride(),this._applyAssociatedLayerPrivileges()}_applyAssociatedLayerFieldsOverrides(){if(!this.associatedLayer?.fields)return;let e=null;for(let t of this.associatedLayer.fields){let n=this.getField(t.name);n?(!n.domain&&t.domain&&(n.domain=t.domain.clone()),n.editable=t.editable,n.nullable=t.nullable,n.length=t.length):(e||=this.fields?this.fields.slice():[],e.push(t.clone()))}e&&this._set(`fields`,e)}_applyAssociatedLayerPropertyOverrides(){if(!this.associatedLayer)return;let e=[`popupTemplate`,`popupEnabled`,`attributeTableTemplate`],t=g(this);for(let n=0;n<e.length;n++){let r=e[n],i=this.originIdOf(r),a=this.associatedLayer.originIdOf(r);i<a&&(a===2||a===3)&&t.setAtOrigin(r,this.associatedLayer[r],a)}}_applyAssociatedLayerExtentOverride(){let e=this.associatedLayer?.getAtOrigin(`fullExtent`,`service`);this.associatedLayer?.infoFor3D==null||!e||!j(this.associatedLayer?.url)||!G(this)||g(this).setAtOrigin(`fullExtent`,e.clone(),2)}_applyAssociatedLayerPrivileges(){let e=this.associatedLayer;e&&(this._set(`userHasEditingPrivileges`,e.userHasEditingPrivileges),this._set(`userHasFullEditingPrivileges`,e.userHasFullEditingPrivileges),this._set(`userHasUpdateItemPrivileges`,e.userHasUpdateItemPrivileges))}async _setAssociatedFeatureLayer(e){if([`mesh-pyramids`,`points`].includes(this.profile))try{let{serverUrl:t,layerId:n,portalItem:r}=await Be(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e});this.associatedLayer=new(await(Ue.FeatureLayer()))({url:t,customParameters:this.customParameters,layerId:n,portalItem:r}),await this.associatedLayer.load()}catch(e){be(e)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){let e=new AbortController;this.addHandles(h(e));try{await we(()=>this.popupEnabled&&this.popupTemplate!=null,e.signal)}catch(e){ie(e);return}let t=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?V.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):V.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){let e=this.elevationInfo;this.profile===`mesh-pyramids`&&U(V.getLogger(this),He(`Mesh scene layers`,`relative-to-scene`,e)),U(V.getLogger(this),Ve(`Scene layers`,e))}async fetchStatistics(e,t){return await Xe({fieldName:e,statisticsInfo:this.statisticsInfo,errorContext:`scenelayer`,fieldsIndex:this.fieldsIndex,path:this.parsedUrl?.path??``,customParameters:this.customParameters,apiKey:this.apiKey,signal:t?.signal})}};N([l({types:{key:`type`,base:C,typeMap:{selection:r}},json:{origins:{"web-scene":{name:`layerDefinition.featureReduction`,write:{allowNull:!0}},"portal-item":{name:`layerDefinition.featureReduction`,write:{allowNull:!0}}}}})],Q.prototype,`featureReduction`,void 0),N([l({type:[J],json:{read:!1,origins:{"web-scene":{name:`layerDefinition.rangeInfos`,write:!0},"portal-item":{name:`layerDefinition.rangeInfos`,write:!0}}},clonable:!1})],Q.prototype,`rangeInfos`,void 0),N([l({json:{read:!1}})],Q.prototype,`associatedLayer`,void 0),N([l({type:[`show`,`hide`]})],Q.prototype,`listMode`,void 0),N([l({type:[`ArcGISSceneServiceLayer`]})],Q.prototype,`operationalLayerType`,void 0),N([l({json:{read:!1},readOnly:!0})],Q.prototype,`type`,void 0),N([l({...Z.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`fields`,void 0),N([l()],Q.prototype,`types`,null),N([l()],Q.prototype,`typeIdField`,null),N([l()],Q.prototype,`templates`,null),N([l()],Q.prototype,`formTemplate`,null),N([l({readOnly:!0})],Q.prototype,`graphicOrigin`,void 0),N([l({readOnly:!0,clonable:!1})],Q.prototype,`fieldsIndex`,null),N([l({type:Se,json:{read:{source:`layerDefinition.floorInfo`},write:{target:`layerDefinition.floorInfo`}}})],Q.prototype,`floorInfo`,void 0),N([l(Z.outFields)],Q.prototype,`outFields`,void 0),N([l({type:H,readOnly:!0,json:{read:!1},clonable:!1})],Q.prototype,`nodePages`,void 0),N([I(`service`,`nodePages`,[`nodePages`,`pointNodePages`])],Q.prototype,`readNodePages`,null),N([l({type:[Ie],readOnly:!0,clonable:!1})],Q.prototype,`materialDefinitions`,void 0),N([l({type:[Pe],readOnly:!0,clonable:!1})],Q.prototype,`textureSetDefinitions`,void 0),N([l({type:[Fe],readOnly:!0,clonable:!1})],Q.prototype,`geometryDefinitions`,void 0),N([l({readOnly:!0})],Q.prototype,`serviceUpdateTimeStamp`,void 0),N([l({readOnly:!0})],Q.prototype,`attributeStorageInfo`,void 0),N([l({readOnly:!0})],Q.prototype,`statisticsInfo`,void 0),N([l({type:F.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.excludeObjectIds`,write:{enabled:!0}}})],Q.prototype,`excludeObjectIds`,void 0),N([l({type:String,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],Q.prototype,`definitionExpression`,void 0),N([l({type:Ye,json:{name:`layerDefinition.polygonFilter`,write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],Q.prototype,`filter`,void 0),N([l({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Q.prototype,`path`,void 0),N([l(L)],Q.prototype,`elevationInfo`,null),N([l({readOnly:!0,json:{read:!1}})],Q.prototype,`effectiveCapabilities`,null),N([l({readOnly:!0})],Q.prototype,`effectiveEditingEnabled`,null),N([l({type:String})],Q.prototype,`geometryType`,null),N([l(te)],Q.prototype,`labelsVisible`,void 0),N([l({type:[D],json:{origins:{service:{name:`drawingInfo.labelingInfo`,read:{reader:A},write:!1}},name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:A},write:!0}})],Q.prototype,`labelingInfo`,void 0),N([l(d)],Q.prototype,`legendEnabled`,void 0),N([l({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:[`opacity`,`layerDefinition.drawingInfo.transparency`],reader(e,t){if(typeof e==`number`&&e>=0&&e<=1)return e;let n=t.layerDefinition?.drawingInfo?.transparency;return n===void 0?void 0:Ce(n)}}},"portal-item":{write:!0},service:{read:!1}}}})],Q.prototype,`opacity`,void 0),N([l({type:[`Low`,`High`],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`priority`,void 0),N([l({type:[`Labels`],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`semantic`,void 0),N([l({types:se,json:{origins:{service:{read:{source:`drawingInfo.renderer`}}},name:`layerDefinition.drawingInfo.renderer`,write:!0},value:null})],Q.prototype,`renderer`,null),N([l({json:{read:!1}})],Q.prototype,`cachedDrawingInfo`,void 0),N([I(`service`,`cachedDrawingInfo`)],Q.prototype,`readCachedDrawingInfo`,null),N([l({readOnly:!0,json:{read:!1}})],Q.prototype,`capabilities`,null),N([l({type:Boolean,json:{read:!1}})],Q.prototype,`editingEnabled`,null),N([l({readOnly:!0,json:{write:!1,read:!1}})],Q.prototype,`infoFor3D`,null),N([l({readOnly:!0,json:{write:!1,read:!1}})],Q.prototype,`relationships`,null),N([l(n)],Q.prototype,`popupEnabled`,void 0),N([l({type:re,json:{name:`popupInfo`,write:!0}})],Q.prototype,`popupTemplate`,void 0),N([l({readOnly:!0,json:{read:!1}})],Q.prototype,`defaultPopupTemplate`,null),N([l(Oe)],Q.prototype,`attributeTableTemplate`,void 0),N([l({type:String,json:{read:!1}})],Q.prototype,`objectIdField`,void 0),N([I(`service`,`objectIdField`,[`objectIdField`,`fields`])],Q.prototype,`readObjectIdField`,null),N([l({type:String,json:{read:!1}})],Q.prototype,`globalIdField`,void 0),N([I(`service`,`globalIdField`,[`globalIdField`,`fields`])],Q.prototype,`readGlobalIdField`,null),N([l({readOnly:!0,type:String,json:{read:!1}})],Q.prototype,`displayField`,null),N([l({type:String,json:{read:!1}})],Q.prototype,`profile`,void 0),N([I(`service`,`profile`,[`store.profile`])],Q.prototype,`readProfile`,null),N([l({readOnly:!0,type:String,json:{origins:{service:{read:{source:`store.normalReferenceFrame`}}},read:!1}})],Q.prototype,`normalReferenceFrame`,void 0),N([l(ne)],Q.prototype,`screenSizePerspectiveEnabled`,void 0),N([l({json:{read:!1,origins:{service:{read:!0}}}})],Q.prototype,`serviceItemId`,void 0),N([l(c)],Q.prototype,`useViewTime`,null),Q=N([w(`esri.layers.SceneLayer`)],Q);var $={"mesh-pyramids":`mesh-pyramids`,meshpyramids:`mesh-pyramids`,"features-meshes":`mesh-pyramids`,points:`points`,"features-points":`points`,lines:`lines`,"features-lines":`lines`,polygons:`polygons`,"features-polygons":`polygons`},et={"mesh-pyramids":`mesh`,points:`point`},tt=Q;export{tt as default};