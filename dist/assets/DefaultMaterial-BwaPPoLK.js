const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DefaultMaterial.glsl-CqSiHFbF.js","assets/DefaultMaterial.glsl-IsjWh3La.js","assets/index-ByaFsVj4.js","assets/index-DiFef-Um.css","assets/Transform.glsl-BzRx33WP.js","assets/Float2BindUniform-COpkFEGz.js","assets/Uniform-CfHWJqSg.js","assets/FloatBindUniform-BPgZfINH.js","assets/glsl-B__sVAcg.js","assets/NoParameters-B66z9IwQ.js","assets/ReadShadowMap.glsl-DiR1WaGe.js","assets/Emissions.glsl-CK4HR9OW.js","assets/Float3DrawUniform-UWnIK6YY.js","assets/Float3PassUniform-BIrLVK7_.js","assets/FloatPassUniform-D-_T45xB.js","assets/Texture2DDrawUniform-CV_1kucp.js","assets/Texture2DPassUniform-wY08hxIn.js","assets/AlphaCutoff-qYsC5qb0.js","assets/HighlightReadBitmap.glsl-yTX333eD.js","assets/Texture2DBindUniform-BW-pj6EM.js","assets/PiUtils.glsl-D-ndpb0M.js","assets/Float3BindUniform-DnRIK6cJ.js","assets/Float4BindUniform-DtHi0dnJ.js","assets/MixExternalColor.glsl-BvW5ZU7M.js","assets/Slice.glsl-ILtGSCz4.js","assets/VisualVariables.glsl-0raoMJkY.js","assets/FloatsPassUniform-7FLgAvOu.js","assets/Float4PassUniform-CYWbrPzx.js","assets/ObjectAndLayerIdColor.glsl-DLOlMhcf.js","assets/SnowCover.glsl-BGaHYUWy.js","assets/SSAO.glsl-aOK0mLB-.js","assets/ScreenSpacePass.glsl-MQijsFL9.js","assets/ReadDepth.glsl-D7iXVNKu.js","assets/CameraSpace.glsl-Cfgq47ku.js","assets/Float2PassUniform-gY4yy6pK.js","assets/ShaderBuilder-NkkCCxyc.js","assets/SSAOBlur.glsl-lcsBoHcY.js","assets/Float2DrawUniform-DrsJI05n.js","assets/SceneLighting-BZCjD1kJ.js","assets/sphere-BCy4W-Wa.js","assets/vectorStacks-DhZu7qGn.js","assets/quatf64-eO7UAs9K.js","assets/vec3-DP8KhY5h.js","assets/plane-Dmhe_zL4.js","assets/ray-CUcS4KDu.js","assets/ObjectStack-C2IlraSC.js","assets/projectPointToVector-DjmX75N6.js","assets/projectVectorToVector-BnpPb96u.js","assets/dehydratedPoint-CVzHYxaL.js","assets/frustum-B2u2I-AJ.js","assets/lineSegment-DXWFDhyj.js","assets/orientedBoundingBox-Dou91YqM.js","assets/quat-sUyQdiZR.js","assets/computeTranslationToOriginAndRotation-CI8CU_D7.js","assets/spatialReferenceEllipsoidUtils-nVny0a-O.js","assets/HUDIntersectorResult-qQNDrr8a.js","assets/VertexAttributeLocations-BMy2FGBT.js","assets/VertexElementDescriptor-C9CNG143.js","assets/renderState-DH1meWdn.js","assets/BooleanBindUniform-9cQHW2Mv.js","assets/View.glsl-DOc5qj3l.js","assets/Matrix4BindUniform-DNS5lGEU.js","assets/IntegerPassUniform-BWtfz08R.js","assets/Matrix4PassUniform-9Utk6s1j.js","assets/MaterialUtil-tSncuShD.js","assets/VertexColor.glsl-D6K20lwp.js","assets/VerticalOffset.glsl-D5rk37Cw.js","assets/ScreenSizePerspective.glsl-C7vDew6J.js","assets/Normals.glsl-CGTDnHsv.js","assets/TerrainDepthTest.glsl-8QLA4mH-.js","assets/OutputColorHighlightOLID.glsl-DrcS4MFv.js","assets/RealisticTree.glsl-D3N4LPSc.js","assets/RealisticTree.glsl-B7mcDTRB.js"])))=>i.map(i=>d[i]);
import{BS as e,Cl as t,DT as n,Ey as r,Ml as i,OT as a,Ol as o,Om as s,Q as c,Rf as l,Uy as u,Wy as d,_w as f,c_ as p,dl as ee,eD as m,gD as h,iD as te,i_ as g,jl as ne,oD as re,o_ as _,ol as ie,ov as ae,rl as oe,u_ as se,ul as ce,yl as v,zy as le}from"./index-ByaFsVj4.js";import{T as ue}from"./plane-Dmhe_zL4.js";import{H as y,b,u as x}from"./BufferView-DuUrcLgU.js";import{a as S}from"./Util-uF9mYnOn.js";import{d as C,l as w,m as T,r as de}from"./Emissions.glsl-CK4HR9OW.js";import{r as fe}from"./VertexAttributeLocations-BMy2FGBT.js";import{t as pe}from"./VertexBuffer-BwGrH3vw.js";import{a as me,n as he,r as ge}from"./renderState-DH1meWdn.js";import{B as _e,E as ve,F as ye,O as be,P as E,R as xe,V as Se,c as Ce,o as D,p as O,t as k,u as A,z as we}from"./DefaultBufferWriter-BACGnssJ.js";import{t as Te}from"./MaterialUtil-tSncuShD.js";import{a as Ee,f as De,i as Oe,s as j}from"./SceneLighting-BZCjD1kJ.js";import{a as M,s as N}from"./FloatArray-CclVVn1u.js";import{d as P}from"./FloatsPassUniform-7FLgAvOu.js";import{t as F}from"./AlphaCutoff-qYsC5qb0.js";import{c as ke,u as Ae}from"./MixExternalColor.glsl-BvW5ZU7M.js";import{u as je}from"./SnowCover.glsl-BGaHYUWy.js";import{n as Me}from"./DefaultMaterial.glsl-IsjWh3La.js";import{n as Ne}from"./RealisticTree.glsl-B7mcDTRB.js";var Pe=class{constructor(e,t,n){this.elementSize=t.stride,this._buffer=new pe(e,N(t,1)),this.resize(n)}destroy(){this._buffer.dispose()}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,n,r=0){let i=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(n.array,r*this.elementSize).set(i)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){let n=e*this.elementSize,r=t*this.elementSize;this._buffer.setSubData(new Uint8Array(this._array),n,n,r)}resize(e){let t=e*this.elementSize,n=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(n).set(new Uint8Array(this._array)):new Uint8Array(n).set(new Uint8Array(this._array).subarray(0,e*this.elementSize))),this._array=n,this._buffer.setSize(t),this._capacity=e}},I=class{constructor(e){this.localTransform=e.localTransform,this.globalTransform=e.globalTransform,this.modelOrigin=e.modelOrigin,this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelScaleFactors=e.modelScaleFactors,this.boundingSphere=e.boundingSphere,this.featureAttribute=e.getField(`instanceFeatureAttribute`,x),this.color=e.getField(`instanceColor`,y),this.olidColor=e.getField(`instanceOlidColor`,y),this.state=e.getField(`state`,b),this.lodLevel=e.getField(`lodLevel`,b)}},L=class extends f{constructor(e,t){super(e),this.events=new ae,this._capacity=0,this._size=0,this._next=0,this._highlightOptionsMap=new Map,this._highlightOptionsMapPrev=new Map,this._layout=Le(t),this._capacity=64,this._buffer=this._layout.createBuffer(this._capacity),this._view=new I(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();let e=this._findSlot();return this._view.state.set(e,1),this._size++,this.events.emit(`instances-changed`),e}removeInstance(e){let t=this._view.state;S(e>=0&&e<this._capacity&&!!(1&t.get(e)),`invalid instance handle`),this._getStateFlag(e,18)?this._setStateFlags(e,32):this.freeInstance(e),this.events.emit(`instances-changed`)}freeInstance(e){let t=this._view.state;S(e>=0&&e<this._capacity&&!!(1&t.get(e)),`invalid instance handle`),t.set(e,0),this._size--}setLocalTransform(e,t,n=!0){this._view.localTransform.setMat(e,t),n&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,n=!0){this._view.globalTransform.setMat(e,t),n&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){let t=this._view,n=z,r=B;t.localTransform.getMat(e,V),t.globalTransform.getMat(e,H);let i=s(H,H,V);o(n,i[12],i[13],i[14]),t.modelOrigin.setVec(e,n),le(r,i),t.model.setMat(e,r);let a=ue(z,i);a.sort(),t.modelScaleFactors.set(e,0,a[1]),t.modelScaleFactors.set(e,1,a[2]),u(r,r),d(r,r),t.modelNormal.setMat(e,r),this._setStateFlags(e,64),this.events.emit(`instance-transform-changed`,{index:e})}getModelTransform(e,t){let n=this._view;n.model.getMat(e,B),n.modelOrigin.getVec(e,z),t[0]=B[0],t[1]=B[1],t[2]=B[2],t[3]=0,t[4]=B[3],t[5]=B[4],t[6]=B[5],t[7]=0,t[8]=B[6],t[9]=B[7],t[10]=B[8],t[11]=0,t[12]=z[0],t[13]=z[1],t[14]=z[2],t[15]=1}applyShaderTransformation(e,t){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(z,this,e),t*=Math.max(z[0],z[1],z[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(z,this,e),t*=Fe(z[0],z[1],z[2])),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute?.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute?.getVec(e,t)}setColor(e,t){this._view.color?.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.olidColor?.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,4,t),this.events.emit(`instance-visibility-changed`,{index:e}))}getVisible(e){return this._getStateFlag(e,4)}setHighlight(e,t){let{_highlightOptionsMap:n}=this,r=n.get(e);t?t!==r&&(n.set(e,t),this._setStateFlag(e,8,!0),this.events.emit(`instance-highlight-changed`)):r&&(n.delete(e),this._setStateFlag(e,8,!1),this.events.emit(`instance-highlight-changed`))}get highlightOptionsMap(){return this._highlightOptionsMap}getHighlightStateFlag(e){return this._getStateFlag(e,8)}geHighlightOptionsPrev(e){let t=this._highlightOptionsMapPrev.get(e)??null;return this._highlightOptionsMapPrev.delete(e),t}getHighlightName(e){let t=this.highlightOptionsMap.get(e)??null;return t?this._highlightOptionsMapPrev.set(e,t):this._highlightOptionsMapPrev.delete(e),t}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let n=0;n<this._capacity;++n)this.getState(n)&e&&++t;return t}_setStateFlags(e,t){let n=this._view.state;t=n.get(e)|t,n.set(e,t)}_clearStateFlags(e,t){let n=this._view.state;t=n.get(e)&~t,n.set(e,t)}_setStateFlag(e,t,n){n?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(64,Math.floor(this._capacity*m)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new I(this._buffer)}_findSlot(){let e=this._view.state,t=this._next;for(;1&e.get(t);)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}};function Fe(e,t,n){return Math.max(Math.min(e,t),Math.min(Math.max(e,t),n))}h([n({constructOnly:!0})],L.prototype,`shaderTransformation`,void 0),h([n()],L.prototype,`_size`,void 0),h([n({readOnly:!0})],L.prototype,`size`,null),L=h([a(`esri.views.3d.webgl-engine.lib.lodRendering.InstanceData`)],L);var Ie=M().mat4f64(`localTransform`).mat4f64(`globalTransform`).vec4f64(`boundingSphere`).vec3f64(`modelOrigin`).mat3f(`instanceModel`).mat3f(`instanceModelNormal`).vec2f(`modelScaleFactors`);function Le(e){return R(Ie.clone(),e).u8(`state`).u8(`lodLevel`)}function R(e,t){return t.instancedFeatureAttribute&&e.vec4f(`instanceFeatureAttribute`),t.instancedColor&&e.vec4u8(`instanceColor`),P()&&e.vec4u8(`instanceOlidColor`),e}var z=p(),B=r(),V=l(),H=l(),Re=class{constructor(e){this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelOriginHi=e.instanceModelOriginHi,this.modelOriginLo=e.instanceModelOriginLo,this.featureAttribute=e.getField(`instanceFeatureAttribute`,x),this.color=e.getField(`instanceColor`,y),this.olidColor=e.getField(`instanceOlidColor`,y)}},ze=class{constructor(e,t){this._rctx=e,this._layout=t,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){let e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){S(!this._updating,`already updating`),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){S(this._updating,`not updating`),this.size<.5*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){S(this._updating,`not updating`),this.isFull&&this._grow();let e=this.headIndex;return this._captureFirstIndex&&=(this._firstIndex=e,!1),this._incrementHead(),S(this._headIndex!==this._tailIndex,`invalid pointers`),e}freeTail(){S(this._updating,`not updating`),S(this.size>0,`invalid size`);let e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){let e=Math.max(64,Math.floor(this._capacity*m));this._resize(e)}_shrink(){let e=Math.max(64,Math.floor(this._capacity*re));this._resize(e)}_resize(e){if(S(this._updating,`not updating`),e===this._capacity)return;let t=new Pe(this._rctx,this._layout,e);if(this._buffer){this._firstIndex&&=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity;let e=this.size,n=this._compactInstances(t);S(n===e,`invalid compaction`),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new Re(this._layout.createView(this._buffer.array))}_compactInstances(e){let t=this._headIndex,n=this._tailIndex;return n<t?(this._buffer.copyRange(n,t,e),t-n):n>t?(this._buffer.copyRange(n,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-n),t+(this._capacity-n)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}},Be=M().vec3f(`instanceModelOriginHi`).vec3f(`instanceModelOriginLo`).mat3f(`instanceModel`).mat3f(`instanceModelNormal`);function U(e){return R(Be.clone(),e)}var Ve=class extends Ae{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=je,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType=`normal`,this.cullFace=2,this.instanced=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.instanceColorEncodesAlphaIgnore=!1,this.emissiveStrengthFromSymbol=0,this.emissiveStrengthKHR=1,this.emissiveSource=1,this.emissiveBaseColor=g,this.instancedDoublePrecision=!1,this.normalType=0,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=_(.2,.2,.2),this.diffuse=_(.8,.8,.8),this.externalColor=c(1,1,1,1),this.colorMixMode=`multiply`,this.opacity=1,this.layerOpacity=1,this.origin=p(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.drivenOpacity=!1,this.writeDepth=!0,this.customDepthTest=0,this.textureAlphaMode=0,this.textureAlphaCutoff=F,this.textureAlphaPremultiplied=!1,this.renderOccluded=1,this.isDecoration=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}},He=class extends ke{constructor(){super(...arguments),this.origin=p(),this.slicePlaneLocalOrigin=this.origin}},W=class extends Ee{constructor(t,n){let r=[N(G(n))];n.instanced&&n.instancedDoublePrecision&&r.push(N(U(n))),super(t,n,fe(r)),this.shader=new j(Me,()=>e(()=>import(`./DefaultMaterial.glsl-CqSiHFbF.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70])))}_makePipeline(e,t){let{oitPass:n,output:r,hasEmission:i,transparent:a,cullFace:o,customDepthTest:s,hasOccludees:c}=e;return he({blending:w(r)&&a?xe(n):null,culling:We(e)?ge(o):null,depthTest:ye(n,Ue(s)),depthWrite:_e(e),drawBuffers:Oe(r,Se(n,i)),colorWrite:me,stencilWrite:c?A:null,stencilTest:c?t?O:Ce:null,polygonOffset:we(e)})}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e,t){return t?this._occludeePipelineState:super.getPipeline(e)}};function Ue(e){switch(e){case 1:return 515;case 0:case 3:return 513;case 2:return 516}}function We(e){return e.cullFace!==0||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}function G(e){let t=M().vec3f(`position`);return e.normalType===1?t.vec2i16(`normalCompressed`,{glNormalized:!0}):t.vec3f(`normal`),e.hasVertexTangents&&t.vec4f(`tangent`),e.hasTextures&&t.vec2f16(`uv0`),e.hasVertexColors&&t.vec4u8(`color`),e.hasSymbolColors&&t.vec4u8(`symbolColor`),!e.instanced&&P()&&t.vec4u8(`olidColor`),t}W=h([a(`esri.views.3d.webgl-engine.shaders.DefaultMaterialTechnique`)],W);var K=class extends be{constructor(e){super(),this.spherical=e,this.alphaDiscardMode=1,this.doubleSidedMode=0,this.pbrMode=0,this.cullFace=0,this.normalType=0,this.customDepthTest=0,this.emissionSource=0,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.instanced=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0,this.draped=!1}get textureCoordinateType(){return this.hasTextures?1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||this.emissionSource===3||this.hasOcclusionTexture}get hasVVInstancing(){return this.instanced}get discardInvisibleFragments(){return this.transparent}};h([E({count:4})],K.prototype,`alphaDiscardMode`,void 0),h([E({count:3})],K.prototype,`doubleSidedMode`,void 0),h([E({count:7})],K.prototype,`pbrMode`,void 0),h([E({count:3})],K.prototype,`cullFace`,void 0),h([E({count:3})],K.prototype,`normalType`,void 0),h([E({count:3})],K.prototype,`customDepthTest`,void 0),h([E({count:8})],K.prototype,`emissionSource`,void 0),h([E()],K.prototype,`hasVertexColors`,void 0),h([E()],K.prototype,`hasSymbolColors`,void 0),h([E()],K.prototype,`hasVerticalOffset`,void 0),h([E()],K.prototype,`hasColorTexture`,void 0),h([E()],K.prototype,`hasMetallicRoughnessTexture`,void 0),h([E()],K.prototype,`hasOcclusionTexture`,void 0),h([E()],K.prototype,`hasNormalTexture`,void 0),h([E()],K.prototype,`hasScreenSizePerspective`,void 0),h([E()],K.prototype,`hasVertexTangents`,void 0),h([E()],K.prototype,`hasOccludees`,void 0),h([E()],K.prototype,`instanced`,void 0),h([E()],K.prototype,`instancedDoublePrecision`,void 0),h([E()],K.prototype,`hasModelTransformation`,void 0),h([E()],K.prototype,`offsetBackfaces`,void 0),h([E()],K.prototype,`hasVVSize`,void 0),h([E()],K.prototype,`hasVVColor`,void 0),h([E()],K.prototype,`receiveShadows`,void 0),h([E()],K.prototype,`receiveAmbientOcclusion`,void 0),h([E()],K.prototype,`textureAlphaPremultiplied`,void 0),h([E()],K.prototype,`instancedFeatureAttribute`,void 0),h([E()],K.prototype,`instancedColor`,void 0),h([E()],K.prototype,`writeDepth`,void 0),h([E()],K.prototype,`transparent`,void 0),h([E()],K.prototype,`enableOffset`,void 0),h([E()],K.prototype,`terrainDepthTest`,void 0),h([E()],K.prototype,`cullAboveTerrain`,void 0),h([E()],K.prototype,`snowCover`,void 0),h([E()],K.prototype,`hasColorTextureTransform`,void 0),h([E()],K.prototype,`hasEmissionTextureTransform`,void 0),h([E()],K.prototype,`hasNormalTextureTransform`,void 0),h([E()],K.prototype,`hasOcclusionTextureTransform`,void 0),h([E()],K.prototype,`hasMetallicRoughnessTextureTransform`,void 0);var q=class extends W{constructor(){super(...arguments),this.shader=new j(Ne,()=>e(()=>import(`./RealisticTree.glsl-D3N4LPSc.js`),__vite__mapDeps([71,72,4,2,3,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70])))}};q=h([a(`esri.views.3d.webgl-engine.shaders.RealisticTreeTechnique`)],q);var Ge=class extends ve{constructor(e,t){super(e,J),this.materialType=`default`,this.supportsEdges=!0,this.intersectDraped=void 0,this.produces=new Map([[2,e=>(T(e)||C(e))&&!this.transparent],[4,e=>(T(e)||C(e))&&this.transparent&&this.parameters.writeDepth],[9,e=>(T(e)||C(e))&&this.transparent&&!this.parameters.writeDepth]]),this._layout=G(this.parameters),this._configuration=new K(t.spherical)}isVisibleForOutput(e){return e!==3&&e!==5&&e!==4||this.parameters.castShadows}get visible(){let{layerOpacity:e,colorMixMode:t,opacity:n,externalColor:r}=this.parameters;return e*(t===`replace`?1:n)*(t===`ignore`||isNaN(r[3])?1:r[3])>=F}get _hasEmissiveBase(){return!!this.parameters.emissiveTextureId||!ie(this.parameters.emissiveBaseColor,g)}get hasEmissions(){return this.parameters.emissiveStrength>0&&(this.parameters.emissiveSource===0&&this._hasEmissiveBase||this.parameters.emissiveSource===1)}getConfiguration(e,t){let{parameters:n,_configuration:r}=this,{treeRendering:i,doubleSided:a,doubleSidedType:o}=n;return super.getConfiguration(e,t,this._configuration),r.hasNormalTexture=n.hasNormalTexture,r.hasColorTexture=n.hasColorTexture,r.hasMetallicRoughnessTexture=n.hasMetallicRoughnessTexture,r.hasOcclusionTexture=n.hasOcclusionTexture,r.hasVertexTangents=!i&&n.hasVertexTangents,r.instanced=n.instanced,r.instancedDoublePrecision=n.instancedDoublePrecision,r.hasVVColor=!!n.vvColor,r.hasVVSize=!!n.vvSize,r.hasVerticalOffset=n.verticalOffset!=null,r.hasScreenSizePerspective=n.screenSizePerspective!=null,r.hasSlicePlane=n.hasSlicePlane,r.alphaDiscardMode=n.textureAlphaMode,r.normalType=i?0:n.normalType,r.transparent=this.transparent,r.writeDepth=n.writeDepth,r.customDepthTest=n.customDepthTest??0,r.hasOccludees=t.hasOccludees,r.cullFace=n.hasSlicePlane?0:n.cullFace,r.cullAboveTerrain=t.cullAboveTerrain,r.hasModelTransformation=!i&&n.modelTransformation!=null,r.hasVertexColors=n.hasVertexColors,r.hasSymbolColors=n.hasSymbolColors,r.doubleSidedMode=i?2:a&&o===`normal`?1:a&&o===`winding-order`?2:0,r.instancedFeatureAttribute=n.instancedFeatureAttribute,r.instancedColor=n.instancedColor,w(e)?(r.terrainDepthTest=t.terrainDepthTest,r.receiveShadows=n.receiveShadows,r.receiveAmbientOcclusion=n.receiveAmbientOcclusion&&t.ssao!=null):(r.terrainDepthTest=!1,r.receiveShadows=r.receiveAmbientOcclusion=!1),r.textureAlphaPremultiplied=!!n.textureAlphaPremultiplied,r.pbrMode=n.usePBR?n.isSchematic?2:1:0,r.emissionSource=n.emissionSource,r.offsetBackfaces=!(!this.transparent||!n.offsetTransparentBackfaces),r.oitPass=t.oitPass,r.enableOffset=t.enableOffset,r.snowCover=t.snowCover>0,r.hasColorTextureTransform=!!n.colorTextureTransformMatrix,r.hasNormalTextureTransform=!!n.normalTextureTransformMatrix,r.hasEmissionTextureTransform=!!n.emissiveTextureTransformMatrix,r.hasOcclusionTextureTransform=!!n.occlusionTextureTransformMatrix,r.hasMetallicRoughnessTextureTransform=!!n.metallicRoughnessTextureTransformMatrix,r}intersect(e,n,r,a,s,c){if(this.parameters.verticalOffset!=null){let e=r.camera;o($,n[12],n[13],n[14]);let c=null;switch(r.viewingMode){case 1:c=oe(Z,$);break;case 2:c=i(Z,X)}let l=v(Ye,$,e.eye),u=ne(l),d=t(l,l,1/u),f=null;this.parameters.screenSizePerspective&&(f=ee(c,d));let p=Te(e,u,this.parameters.verticalOffset,f??0,this.parameters.screenSizePerspective,null);t(c,c,p),ce(Q,c,r.transform.inverseRotation),a=v(qe,a,Q),s=v(Je,s,Q)}D(e,r,a,s,De(r.verticalOffset),c)}createGLMaterial(e){return new Ke(e)}createBufferWriter(){return new k(this._layout)}get transparent(){return Y(this.parameters)}},Ke=class extends de{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});let t=this._material.parameters;this.updateTexture(t.textureId);let n=e.camera.viewInverseTransposeMatrix;return o(t.origin,n[3],n[7],n[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(t.treeRendering?q:W,e)}},J=class extends Ve{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}get hasNormalTexture(){return!this.treeRendering&&!!this.normalTextureId}get hasColorTexture(){return!!this.textureId}get hasMetallicRoughnessTexture(){return!this.treeRendering&&!!this.metallicRoughnessTextureId}get hasOcclusionTexture(){return!this.treeRendering&&!!this.occlusionTextureId}get emissiveStrength(){return this.emissiveStrengthFromSymbol*this.emissiveStrengthKHR}get emissionSource(){return this.treeRendering?0:this.emissiveTextureId!=null&&this.emissiveSource===0?3:this.usePBR?this.emissiveSource===0?2:1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||this.emissionSource===3||this.hasOcclusionTexture}};function Y(e){let{drivenOpacity:t,opacity:n,externalColor:r,layerOpacity:i,texture:a,textureId:o,textureAlphaMode:s,colorMixMode:c}=e,l=r[3];return t||n<1&&c!==`replace`||l<1&&c!==`ignore`||i<1||(a!=null||o!=null)&&s!==1&&s!==2&&c!==`replace`}var qe=p(),Je=p(),X=se(0,0,1),Z=p(),Q=p(),$=p(),Ye=p();export{ze as a,He as i,Y as n,U as o,Ge as r,L as s,J as t};