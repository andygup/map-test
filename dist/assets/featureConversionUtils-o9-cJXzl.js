import{$T as e,Av as t,CE as n,DT as r,Iv as i,Lv as a,Mv as o,Pv as s,Rf as c,jv as l,lf as u,rp as d,ux as f}from"./index-BN8X5Ryz.js";import{t as p}from"./OptimizedGeometry-BQJ7w5VU.js";import{n as m,t as h}from"./OptimizedFeatureSet-CLjmRHYn.js";var g=()=>n.getLogger(`esri.layers.graphics.featureConversionUtils`),_={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0};function v({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function y({scale:e,translate:t},n){return Math.round((t[1]-n)/e[1])}function b({scale:e,translate:t},n){return Math.round((n-t[0])/e[0])}function x({scale:e,translate:t},n){return Math.round((n-t[1])/e[1])}function S({scale:e,translate:t},n,r){return n*e[r]+t[r]}function C(e,t,n){return t&&(e.hasZ=!0),n&&(e.hasM=!0),e}function w(e,t,n,r){if(t&&r&&e!==n)return(t,n,r,i)=>{r[i++]=t[n++],r[i++]=t[n++],e?n++:r[i++]=0,r[i++]=t[n++]??0};let i=2+(n?1:0)+(r?1:0),a=i-((!e&&n?1:0)+(!t&&r?1:0));return(e,t,n,r)=>{for(let o=0;o<i;++o)n[r++]=o<a?e[t++]??0:0}}function T(e,t,n){if(!e)return null;let{coords:r,hasZ:i,hasM:a}=e,[o,s]=r,c=i?r[2]:0,l=a?r[2+(i?1:0)]:0;return{x:o,y:s,z:t?c:void 0,m:n?l:void 0}}function E(e,t,n,r){for(let{geometry:i,attributes:a}of t)e.push({attributes:a,geometry:T(i,n,r)});return e}function D(e,t,n,r,a){for(let s of t){let{geometry:t,attributes:c,centroid:l}=s,u=o(t),f=i(t);e.push(new m(t?O(t,n&&u,r&&f):null,c,l?O(l,!1,!1):null,d(s,a)))}return e}function O(e,t=o(e),n=i(e)){let{x:r,y:a,z:s,m:c}=e,l=[r,a];return t&&l.push(s??0),n&&l.push(c??0),new p([],l,t,n)}function ee(e,t,n,r){for(let{geometry:i,attributes:a}of t)e.push({geometry:i&&k(i,n,r),attributes:a});return e}function k(e,t,n){if(e==null)return null;let{coords:r,stride:i,hasZ:a,hasM:o}=e,s=w(a,o,t,n),c=[];for(let e=0;e<r.length;e+=i){let t=[];s(r,e,t,0),c.push(t)}return C({points:c},t,n)}function te(e,t,n,r,a){for(let s of t){let{geometry:t,attributes:c}=s,l=o(t),u=i(t);e.push(new m(t?A(t,n&&l,r&&u):null,c,null,d(s,a)))}return e}function A(e,t=o(e),n=i(e)){let{points:r,hasZ:a,hasM:s}=e,c=new p([r.length],[],t,n),{coords:l,stride:u}=c,d=0,f=w(a??!1,s??!1,t,n);for(let e of r)f(e,0,l,d),d+=u;return c}function j(e,t,n,r){for(let{geometry:i,attributes:a}of t)e.push({geometry:i&&M(i,n,r),attributes:a});return e}function M(e,t,n){if(!e)return null;let{coords:r,lengths:i,stride:a,hasZ:o,hasM:s}=e,c=0,l=w(o,s,t,n),u=[];for(let e of i){let t=[];for(let n=0;n<e;n++){let e=[];l(r,c,e,0),c+=a,t.push(e)}u.push(t)}return C({paths:u},t,n)}function ne(e,t,n,r,a){for(let s of t){let{geometry:t,attributes:c,centroid:l}=s,u=o(t),f=i(t);e.push(new m(t?N(t,n&&u,r&&f):null,c,l?O(l,!1,!1):null,d(s,a)))}return e}function N(e,t=o(e),n=i(e)){let{paths:r,hasZ:a,hasM:s}=e,c=w(a??!1,s??!1,t,n),l=new p([],[],t,n),{lengths:u,coords:d,stride:f}=l,m=0;for(let e of r){for(let t of e)c(t,0,d,m),m+=f;u.push(e.length)}return l}function P(e,t,n,r){for(let{geometry:i,attributes:a,centroid:o}of t){let t=F(i,n,r),s=T(o,!1,!1);e.push(o?{geometry:t,attributes:a,centroid:s}:{geometry:t,attributes:a})}return e}function F(e,t,n){if(!e)return null;let{coords:r,lengths:i,stride:a,hasZ:o,hasM:s}=e,c=0,l=w(o,s,t,n),u=[];for(let e of i){let t=[];for(let n=0;n<e;n++){let e=[];l(r,c,e,0),c+=a,t.push(e)}u.push(t)}return C({rings:u},t,n)}function I(e,t,n,r,a){for(let s of t){let{geometry:t,attributes:c,centroid:l}=s,u=o(t),f=i(t);e.push(new m(t?L(t,n&&u,r&&f):null,c,l?O(l,!1,!1):null,d(s,a)))}return e}function L(e,t=o(e),n=i(e)){let{rings:r,hasZ:a,hasM:s}=e,c=new p([],[],t,n),{lengths:l,coords:u,stride:d}=c,f=0,m=w(a??!1,s??!1,t,n);for(let e of r){for(let t of e)m(t,0,u,f),f+=d;l.push(e.length)}return c}var R=[],z=[];function re(e,t,n,r,i){R[0]=e;let[a]=B(z,R,t,n,r,i);return $(R),$(z),a}function B(t,n,r,i,a,o){if($(t),!r){for(let e of n){let n=d(e,o);t.push(new m(null,e.attributes,null,n))}return t}switch(r){case`esriGeometryPoint`:return D(t,n,i,a,o);case`esriGeometryMultipoint`:return te(t,n,i,a,o);case`esriGeometryPolyline`:return ne(t,n,i,a,o);case`esriGeometryPolygon`:case`esriGeometryMultiPatch`:return I(t,n,i,a,o);default:g().error(`convertToFeatureSet:unknown-geometry`,new e(`internal:geometry`,`Unable to parse unknown geometry type '${r}'`)),$(t)}return t}function V(e,t,n,r){z[0]=e,G(R,z,t,n,r);let i=R[0];return $(R),$(z),i}function H(n,r=o(n),c=i(n)){return n==null?null:a(n)?O(n,r,c):s(n)?L(n,r,c):t(n)?N(n,r,c):l(n)?A(n,r,c):void g().error(`convertFromGeometry:unknown-geometry`,new e(`internal:geometry`,`Unable to parse unknown geometry type '${n}'`))}function U(t,n,r,i){if(t==null)return null;let a=`coords`in t?t:t.geometry;if(a==null)return null;switch(n){case`esriGeometryPoint`:return T(a,r,i);case`esriGeometryMultipoint`:return k(a,r,i);case`esriGeometryPolyline`:return M(a,r,i);case`esriGeometryPolygon`:return F(a,r,i);default:return g().error(`convertToGeometry:unknown-geometry`,new e(`internal:geometry`,`Unable to parse unknown geometry type '${n}'`)),null}}function W(e,t){for(let n of t)e.push({attributes:n.attributes});return e}function G(t,n,r,i,a){if($(t),r==null)return W(t,n);switch(r){case`esriGeometryPoint`:return E(t,n,i,a);case`esriGeometryMultipoint`:return ee(t,n,i,a);case`esriGeometryPolyline`:return j(t,n,i,a);case`esriGeometryPolygon`:return P(t,n,i,a);default:g().error(`convertToFeatureSet:unknown-geometry`,new e(`internal:geometry`,`Unable to parse unknown geometry type '${r}'`))}return t}function K(e){let{spatialReference:t,transform:n,fields:r,hasM:i,hasZ:a,features:o,geometryType:s,exceededTransferLimit:c,queryGeometry:l,queryGeometryType:u}=e,d={features:G([],o,s,a,i),fields:r,geometryType:s,spatialReference:t,queryGeometry:U(l,u,a,i)};return n&&(d.transform=n),c&&(d.exceededTransferLimit=c),i&&(d.hasM=i),a&&(d.hasZ=a),d}function q(e,t){let n=new h,{hasM:r,hasZ:i,features:a,spatialReference:o,geometryType:s,exceededTransferLimit:c,transform:l,fields:u}=e;return u&&(n.fields=u),n.geometryType=s??null,n.spatialReference=o??null,a&&B(n.features,a,s,i,r,t),c&&(n.exceededTransferLimit=c),r&&(n.hasM=r),i&&(n.hasZ=i),l&&(n.transform=l),n}function J(e){let{transform:t,features:n}=e;if(!t)return e;for(let e of n)e.geometry!=null&&Q(e.geometry,t),e.centroid!=null&&Q(e.centroid,t);return e.transform=null,e}function Y(e,t){let{geometryType:n,features:r}=t;if(!e)return t;for(let t=0;t<r.length;t++){let i=r[t],a=i.weakClone();a.geometry=X(i.geometry,n,e),a.centroid=X(i.centroid,`esriGeometryPoint`,e),r[t]=a}return t.transform=e,t}function X(e,t,n,r,i){if(e==null||!e?.coords.length)return null;let a=_[t],{coords:o,lengths:s,stride:c,hasZ:l,hasM:u}=e;r??=l,i??=u;let d=new p([],[],r,i),f=d.stride,m=w(l,u,r,i),h=0,g=[0,0,0,0].slice(f);function b(){m(o,h,g,0),h+=c,g[0]=v(n,g[0]),g[1]=y(n,g[1])}if(e.isPoint)return b(),d.coords.push(...g),d;let x=0;for(let e of s){if(e<a)continue;let t=1;b(),d.coords.push(...g);let[n,r]=g;for(let i=1;i<e;i++){b();let[e,i]=g;n===e&&r===i||(g[0]-=n,g[1]-=r,d.coords.push(...g),n=e,r=i,t++)}t>=a?(d.lengths.push(t),x=d.coords.length):$(d.coords,x)}return $(d.coords,x),d.coords.length?d:null}function ie(e,t,n,r=e.hasZ,i=e.hasM){if(!e.coords.length)return null;let a=_[t],{coords:o,lengths:s,stride:c,hasZ:l,hasM:u}=e,d=new p([],[],r,i),f=d.stride,m=w(l,u,r,i);if(e.isPoint)return m(o,0,d.coords,0),d;let h=0,g=n*n;for(let e of s){if(e<a){h+=e*c;continue}let t=d.coords.length/f,n=h,r=h+(e-1)*c;m(o,n,d.coords,d.coords.length),Z(d.coords,o,c,g,m,n,r),m(o,r,d.coords,d.coords.length);let i=d.coords.length/f-t;i>=a?d.lengths.push(i):$(d.coords,t*f),h+=e*c}return d.coords.length?d:null}function ae(e,t,n,r){let i=e[t],a=e[t+1],o=e[n],s=e[n+1],c=e[r],l=e[r+1],u=o,d=s,f=c-u,p=l-d;if(f!==0||p!==0){let e=((i-u)*f+(a-d)*p)/(f*f+p*p);e>1?(u=c,d=l):e>0&&(u+=f*e,d+=p*e)}return f=i-u,p=a-d,f*f+p*p}function Z(e,t,n,r,i,a,o){let s,c=r,l=0;for(let e=a+n;e<o;e+=n)s=ae(t,e,a,o),s>c&&(l=e,c=s);c>r&&(l-a>n&&Z(e,t,n,r,i,a,l),i(t,l,e,e.length),o-l>n&&Z(e,t,n,r,i,l,o))}function oe(e,t){if(!t?.coords?.length)return null;let n=1/0,r=1/0,i=-1/0,a=-1/0,{coords:o,stride:s}=t;for(let e=0;e<o.length;e+=s){let t=o[e],s=o[e+1];n=Math.min(n,t),i=Math.max(i,t),r=Math.min(r,s),a=Math.max(a,s)}return u(e)?c(e,n,r,i,a):f(n,r,i,a,e),e}function Q(e,t){let{coords:n,lengths:i,stride:a}=e;if(!n.length)return void(i.length=0);r(t);let{originPosition:o,scale:s,translate:c}=t,l=de;l.originPosition=o;let u=l.scale;u[0]=s[0]??1,u[1]=-(s[1]??1),u[2]=s[2]??1,u[3]=s[3]??1;let d=l.translate;if(d[0]=c[0]??0,d[1]=c[1]??0,d[2]=c[2]??0,d[3]=c[3]??0,!i.length){for(let e=0;e<a;++e)n[e]=S(l,n[e],e);i.length=0;return}let f=0;for(let e=0;e<i.length;e++){let t=i[e];i[e]=t;for(let e=0;e<a;++e)n[f+e]=S(l,n[f+e],e);let r=n[f],o=n[f+1];f+=a;for(let e=1;e<t;e++,f+=a){r+=n[f]*u[0],o+=n[f+1]*u[1],n[f]=r,n[f+1]=o;for(let e=2;e<a;++e)n[f+e]=S(l,n[f+e],e)}}}function se(e,t,n,r){let i=0,a=e[r*t],o=e[r*(t+1)];for(let s=1;s<n;s++){let n=a+e[r*(t+s)],c=o+e[r*(t+s)+1],l=(n-a)*(c+o);a=n,o=c,i+=l}return .5*i}function ce(e,t){let{coords:n,lengths:r}=e,i=0,a=0;for(let e=0;e<r.length;e++){let o=r[e];a+=se(n,i,o,t),i+=o}return Math.abs(a)}function le(e,t,n,r){return e*r-n*t===0&&e*n+t*r>0}function ue(e,t,n){let{stride:r}=e;if(e.isPoint){if(e.coords.length<2)return null;let[n,r]=e.coords,i=b(t,n),a=x(t,r);return new p([],[i,a])}let i=new p([],[0,0]),a=_[n],o=n===`esriGeometryPolygon`||n===`esriGeometryPolyline`,s=0,c=0;for(let n=0;n<e.lengths.length;n++){let l=e.lengths[n],u=c,d=b(t,e.coords[r*s]),f=x(t,e.coords[r*s+1]);i.coords[c++]=d,i.coords[c++]=f;let p=0,m=0,h=1;for(let n=1;n<l;n++){let a=b(t,e.coords[r*(n+s)]),l=x(t,e.coords[r*(n+s)+1]);if(a!==d||l!==f){let e=a-d,t=l-f;o&&le(p,m,e,t)?(i.coords[c-2]+=e,i.coords[c-1]+=t,d+=e,f+=t):(i.coords[c++]=a,i.coords[c++]=l,d=a,f=l,p=e,m=t,h+=1)}}h<a?c=u:i.lengths.push(h),s+=l}return i.lengths.length===0?null:i}function $(e,t=0){e.length!==t&&(e.length=t)}var de={originPosition:`lowerLeft`,scale:[1,1,1,1],translate:[0,0,0,0]};export{T as S,ue as _,H as a,J as b,v as c,q as d,A as f,O as g,Q as h,V as i,N as l,Y as m,re as n,y as o,ce as p,B as r,U as s,L as t,K as u,ie as v,oe as x,X as y};