const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-DWmryv9F.js","assets/knowledgeGraphService-IHR0Dm6J.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/Relationship-CyGEtlAI.js","assets/GPMessage-BiUuPRZS.js","assets/networkEnums-DSwvS-2R.js"])))=>i.map(i=>d[i]);
import{$S as e,AE as t,Aa as n,Ax as r,Fg as i,Ix as a,Kg as o,Kh as s,Lx as c,Nx as l,Rg as u,am as d,cm as f,ja as p,lm as m,om as h,qh as g,wn as _}from"./index-BN8X5Ryz.js";import"./ImmutableArray-C3KNQCVd.js";import{A as v,G as y,W as b,X as x,Y as S,et as C,lt as w,q as T,t as E,v as D,y as O}from"./Dictionary-Db5-uVgu.js";import"./shared-Bq4SQ-mm.js";import"./number-bRvGjlJj.js";import{t as k}from"./ArcadePortal-CBZerHI1.js";import{t as A}from"./portalUtils-Bs81nDRc.js";import{i as j,n as M,r as N,t as P}from"./Relationship-CyGEtlAI.js";import{t as F}from"./GraphQueryStreaming-DUkFf9hi.js";var I=null;async function L(e){let r=t.geometryServiceUrl??``;if(!r){u()||await i();for(let t of e)t.container[t.indexer]=o(t.container[t.indexer],c.WGS84);return}let a=e.map(e=>e.container[e.indexer]),s=new p({geometries:a,outSpatialReference:c.WGS84}),l=await n(r,s);for(let t=0;t<l.length;t++){let n=e[t];n.container[n.indexer]=l[t]}}async function R(t,n){let r=new s({portal:t,id:n});return await r.load(),I===null&&(I=await e(()=>import(`./knowledgeGraphService-DWmryv9F.js`),__vite__mapDeps([0,1,2,3,4,5,6]))),await I.fetchKnowledgeGraph(r.url)}function z(e,t,n,i,o){if(e===null)return null;if(h(e)||f(e))return e;if(S(e)||S(e))return e.toJSDate();if(C(e))return e.toStorageFormat();if(T(e))return e.toStorageString();if(D(e)){let r={};for(let s of e.keys())r[s]=z(e.field(s),t,n,i,o),r[s]instanceof a&&o.push({container:r,indexer:s});return r}if(m(e)){let r=e.map(e=>z(e,t,n,i,o));for(let e=0;e<r.length;e++)r[e]instanceof a&&o.push({container:r,indexer:e});return r}return v(e)?e.spatialReference.isWGS84?e:e.spatialReference.isWebMercator&&t?r(e):e:void 0}function B(e,t){if(!e)return e;if(e.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return l(e);if(e.spatialReference.equals(t.spatialReference))return e;throw new _(t,`WrongSpatialReference`,null)}function V(e,t){if(!e)return null;let n={};for(let r in e)n[r]=H(e[r],t);return n}function H(e,t){return e===null?null:m(e)?e.map(e=>H(e,t)):e instanceof j?{graphTypeName:e.typeName,id:e.id,graphType:`entity`,properties:V(e.properties,t)}:e instanceof N?{graphType:`object`,properties:V(e.properties,t)}:e instanceof P?{graphTypeName:e.typeName,id:e.id,graphType:`relationship`,originId:e.originId??null,destinationId:e.destinationId??null,properties:V(e.properties,t)}:e instanceof M?{graphType:`path`,path:e.path?e.path.map(e=>H(e,t)):null}:v(e)?B(e,t):h(e)||f(e)||d(e)?e:null}function U(t){t.mode===`async`&&(t.functions.knowledgegraphbyportalitem=function(e,n){return t.standardFunctionAsync(e,n,(t,r,i)=>{if(x(i,2,2,e,n),i[0]===null)throw new _(e,`PortalRequired`,n);if(i[0]instanceof k){let t=y(i[1]),n;return n=e.services?.portal?e.services.portal:g.getDefault(),R(A(i[0],n),t)}if(!1===h(i[0]))throw new _(e,`InvalidParameter`,n);let a=y(i[0]);return R(e.services?.portal??g.getDefault(),a)})},t.signatures.push({name:`knowledgegraphbyportalitem`,min:2,max:2}),t.functions.querygraph=function(n,r){return t.standardFunctionAsync(n,r,async(t,i,a)=>{x(a,2,4,n,r);let o=a[0];if(!b(o))throw new _(n,`InvalidParameter`,r);let s=a[1];if(!h(s))throw new _(n,`InvalidParameter`,r);I===null&&(I=await e(()=>import(`./knowledgeGraphService-DWmryv9F.js`),__vite__mapDeps([0,1,2,3,4,5,6])));let c=null,l=w(a[2],null);if(!(l instanceof E||l===null))throw new _(n,`InvalidParameter`,r);if(l){let e=[];c=z(l,!0,!1,n,e),e=e.filter(e=>!e.container[e.indexer].spatialReference.isWGS84),e.length>0&&await L(e)}let u=w(a[3],!1),d=new F({openCypherQuery:s,bindParameters:c,provenanceBehavior:u?`include`:`exclude`});(o?.serviceDefinition?.currentVersion??11.3)>11.2&&(d.outputSpatialReference=n.spatialReference);let f=(await I.executeQueryStreaming(o,d)).resultRowsStream.getReader(),p=[];try{for(;;){let{done:e,value:t}=await f.read();if(e)break;if(m(t))for(let e of t)p.push(H(e,n));else{let e=[];for(let r of t)e.push(H(t[r],n));p.push(e)}}}catch(e){throw e}return E.convertJsonToArcade(p,O(n),!1,!0)})},t.signatures.push({name:`querygraph`,min:2,max:4}))}export{U as registerFunctions};