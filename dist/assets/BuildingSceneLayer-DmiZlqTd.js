import{$m as e,A as t,Ai as n,BT as r,Bh as i,C as a,DT as o,Dh as ee,Di as te,Ei as s,En as ne,GC as c,GT as re,Ha as ie,Hh as l,Jf as ae,Jw as oe,L as se,LT as ce,Lh as le,M as ue,MT as de,Nh as fe,OT as u,Oi as pe,PT as me,Qf as he,Qp as ge,RS as _e,Rh as ve,SC as ye,SE as d,Ua as be,Uf as xe,W as Se,Y_ as Ce,Zf as we,_ as Te,ax as Ee,ba as De,ca as Oe,g as f,gD as p,iE as ke,iv as m,jT as h,ji as Ae,ma as je,pa as Me,pr as Ne,rT as Pe,rd as Fe,tv as Ie,uE as g,vd as Le,wx as _,xa as Re,xp as ze,zi as Be}from"./index-CZ4oMP1N.js";import"./quatf64-BJJPhW0N.js";import"./quat-BszBv_-H.js";import"./plane-Bg1a5O73.js";import"./vectorStacks-FfDNcZoS.js";import"./projectPointToVector-HYpbaZqA.js";import"./computeTranslationToOriginAndRotation-Cm78hfIp.js";import"./spatialReferenceEllipsoidUtils-B0E4spY0.js";import{n as Ve}from"./capabilities-BbPEoCzB.js";import{n as He,r as Ue}from"./SceneService-DxYxlApR.js";import{i as We,n as Ge,r as Ke,t as qe}from"./I3SLayerDefinitions-BZIqY7jk.js";import"./dehydratedPoint-rdg1UAtQ.js";import"./projectVectorToVector-DX3Yd1qf.js";import"./featurePopupQueryUtils-BIpfiKXw.js";import"./I3SBinaryReader-CnFv3yUu.js";import{t as Je}from"./I3SUtil-CdvmRvXY.js";import"./symbolColorUtils-aHvrhrl1.js";import"./orientedBoundingBox-CzNbshh-.js";import"./Emissions.glsl-D75sJPX5.js";import"./glsl-CQsgM67j.js";import"./Uniform-D2x0fAcR.js";import"./Float3DrawUniform-CdNiRdHS.js";import"./Float3PassUniform-tY0I44AO.js";import"./FloatPassUniform-DkGcNskm.js";import"./Texture2DDrawUniform-_ATT3Du-.js";import"./Texture2DPassUniform-DbQ0ICoe.js";import"./NoParameters-D8vOu4I5.js";import"./layerViewUtils-RSw-QNoB.js";import{n as Ye,t as Xe}from"./popupUtils-Bb88Y0DD.js";import"./originUtils-D6xFQIj1.js";import"./resourceUtils-BiMcW5zN.js";import"./resourceUtils-BCTmrDyq.js";import"./saveUtils-Cw05PoQr.js";import{t as Ze}from"./associatedFeatureServiceUtils-LJSputl4.js";import"./memoize-BNsZjv91.js";import{o as Qe,p as v,y as $e}from"./elevationInfoUtils-9csVBlEH.js";var et=Symbol(`isBuildingGraphicOrigin`),y,tt=class extends De{get[(y=et,ae)](){return this.sublayer}get[we](){return this.sublayer}get[Re](){return this.sublayer}constructor(e){super(),this[y]=!0,this.type=`building`,this.sublayer=e}get layer(){return this.sublayer.layer}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},b=class extends fe(be){constructor(e){super(e),this.title=``,this.id=-1,this.modelName=null,this.isEmpty=null,this.legendEnabled=!0,this.visible=!0,this.opacity=1}readTitle(e,t){return typeof t.alias==`string`?t.alias:typeof t.name==`string`?t.name:``}readIdOnlyOnce(e){return this.id===-1?typeof e==`number`?e:-1:this.id}};p([o({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],b.prototype,`title`,void 0),p([h(`service`,`title`,[`alias`,`name`])],b.prototype,`readTitle`,null),p([o()],b.prototype,`layer`,void 0),p([o({type:ke,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],b.prototype,`id`,void 0),p([h(`service`,`id`)],b.prototype,`readIdOnlyOnce`,null),p([o(s(String))],b.prototype,`modelName`,void 0),p([o(s(Boolean))],b.prototype,`isEmpty`,void 0),p([o({type:Boolean,nonNullable:!0})],b.prototype,`legendEnabled`,void 0),p([o({type:Boolean,json:{name:`visibility`,write:!0}})],b.prototype,`visible`,void 0),p([o({type:Number,json:{write:!0}})],b.prototype,`opacity`,void 0),b=p([u(`esri.layers.buildingSublayers.BuildingSublayer`)],b);var x=a(),S=class extends i(l(b)){constructor(e){super(e),this.type=`building-component`,this.nodePages=null,this.materialDefinitions=[],this.textureSetDefinitions=[],this.geometryDefinitions=[],this.indexInfo=null,this.serviceUpdateTimeStamp=null,this.store=null,this.attributeStorageInfo=[],this.fields=[],this.associatedLayer=null,this.outFields=null,this.listMode=`show`,this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType=`3d-object`}initialize(){this._set(`graphicOrigin`,new tt(this))}get parsedUrl(){return this.layer?{path:`${this.layer.parsedUrl?.path}/sublayers/${this.id}`,query:this.layer.parsedUrl?.query}:{path:``}}get fieldsIndex(){return new ne(this.fields)}readAssociatedLayer(e,t){let n=this.layer.associatedFeatureServiceItem,r=t.associatedLayerID;return n!=null&&typeof r==`number`?new f({portalItem:n,customParameters:this.customParameters,layerId:r}):null}get objectIdField(){if(this.fields!=null){for(let e of this.fields)if(e.type===`oid`)return e.name}return``}get globalIdField(){if(this.fields!=null){for(let e of this.fields)if(e.type===`global-id`)return e.name}return``}get displayField(){return this.associatedLayer==null?void 0:this.associatedLayer.displayField}get apiKey(){return this.layer.apiKey}get customParameters(){return this.layer.customParameters}get fullExtent(){return this.layer.fullExtent}get spatialReference(){return this.layer.spatialReference}get version(){return this.layer.version}get elevationInfo(){return this.layer.elevationInfo}get minScale(){return this.layer.minScale}get maxScale(){return this.layer.maxScale}get effectiveScaleRange(){return this.layer.effectiveScaleRange}get defaultPopupTemplate(){return this.createPopupTemplate()}load(e){let t=e==null?null:e.signal,n=this._fetchService(t).then(()=>{this.indexInfo=Ue(this.parsedUrl.path,this.rootNode,this.nodePages,this.customParameters,this.apiKey,g.getLogger(this),t)});return this.addResolvingPromise(n),Promise.resolve(this)}createPopupTemplate(e){return Te(this,e)}async _fetchService(e){let t=(await _e(this.parsedUrl.path,{query:{f:`json`,...this.customParameters,token:this.apiKey},responseType:`json`,signal:e})).data;this.read(t,{origin:`service`,url:this.parsedUrl})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){let n=this.getField(e)?.domain??null;return this.associatedLayer?Ne(this.associatedLayer,e,t,n):n}getFeatureType(e){return e&&this.associatedLayer!=null?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer==null?[]:this.associatedLayer.types??[]}get typeIdField(){return this.associatedLayer==null?null:this.associatedLayer.typeIdField}get geometryType(){return this.layerType===`3d-object`?`mesh`:`point`}get profile(){return this.layerType===`3d-object`?`mesh-pyramids`:`points`}get capabilities(){let e=this.associatedLayer!=null&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:Ve,{query:t,operations:{supportsQuery:n},data:{supportsZ:r,supportsM:i,isVersioned:a}}=e;return{query:t,operations:{supportsQuery:n},data:{supportsZ:r,supportsM:i,isVersioned:a}}}createQuery(){let e=new Fe;return this.geometryType!==`mesh`&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||`1=1`,e.sqlFormat=`standard`,e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatures(e||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=this.layer,t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}async queryObjectIds(e,t){return(await(await this._getAssociatedLayerForQuery()).queryObjectIds(e||this.createQuery(),t)).filter(ge)}async queryCachedAttributes(e,t){let n=ze(this.fieldsIndex,await Ye(this,Xe(this)));return Je(this.parsedUrl.path,this.attributeStorageInfo,e,t,n,this.apiKey,this.customParameters)}async queryCachedFeature(e,t){let n=await this.queryCachedAttributes(e,[t]);if(!n||n.length===0)throw new r(`scenelayer:feature-not-in-cached-data`,`Feature not found in cached data`);return new Le({attributes:n[0],layer:this,sourceLayer:this})}getFieldUsageInfo(e){return this.fieldsIndex.has(e)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:this.associatedLayer!=null}}_getAssociatedLayerForQuery(){let e=this.associatedLayer;return e!=null&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),this.associatedLayer==null)throw new r(`buildingscenelayer:query-not-available`,`BuildingSceneLayer component layer queries are not available without an associated feature layer`,{layer:this});try{await this.associatedLayer.load()}catch(e){throw new r(`buildingscenelayer:query-not-available`,`BuildingSceneLayer associated feature layer could not be loaded`,{layer:this,error:e})}return this.associatedLayer}};p([o({readOnly:!0})],S.prototype,`parsedUrl`,null),p([o({type:Ke,readOnly:!0})],S.prototype,`nodePages`,void 0),p([o({type:[qe],readOnly:!0})],S.prototype,`materialDefinitions`,void 0),p([o({type:[We],readOnly:!0})],S.prototype,`textureSetDefinitions`,void 0),p([o({type:[Ge],readOnly:!0})],S.prototype,`geometryDefinitions`,void 0),p([o({readOnly:!0})],S.prototype,`serviceUpdateTimeStamp`,void 0),p([o({readOnly:!0})],S.prototype,`store`,void 0),p([o({type:String,readOnly:!0,json:{read:{source:`store.rootNode`}}})],S.prototype,`rootNode`,void 0),p([o({readOnly:!0})],S.prototype,`attributeStorageInfo`,void 0),p([o(x.fields)],S.prototype,`fields`,void 0),p([o({readOnly:!0})],S.prototype,`fieldsIndex`,null),p([o({readOnly:!0,type:f})],S.prototype,`associatedLayer`,void 0),p([h(`service`,`associatedLayer`,[`associatedLayerID`])],S.prototype,`readAssociatedLayer`,null),p([o(x.outFields)],S.prototype,`outFields`,void 0),p([o({type:String,readOnly:!0})],S.prototype,`objectIdField`,null),p([o({type:String,readOnly:!0})],S.prototype,`globalIdField`,null),p([o({readOnly:!0,type:String,json:{read:!1}})],S.prototype,`displayField`,null),p([o({readOnly:!0,type:String})],S.prototype,`apiKey`,null),p([o({readOnly:!0,type:String})],S.prototype,`customParameters`,null),p([o({readOnly:!0,type:Ee})],S.prototype,`fullExtent`,null),p([o({readOnly:!0,type:_})],S.prototype,`spatialReference`,null),p([o({readOnly:!0})],S.prototype,`version`,null),p([o({readOnly:!0,type:Be})],S.prototype,`elevationInfo`,null),p([o({readOnly:!0,type:Number})],S.prototype,`minScale`,null),p([o({readOnly:!0,type:Number})],S.prototype,`maxScale`,null),p([o({readOnly:!0,type:Number})],S.prototype,`effectiveScaleRange`,null),p([o({type:[`hide`,`show`],json:{write:!0}})],S.prototype,`listMode`,void 0),p([o({types:Se,json:{origins:{service:{read:{source:`drawingInfo.renderer`}}},name:`layerDefinition.drawingInfo.renderer`,write:!0},value:null})],S.prototype,`renderer`,void 0),p([o({type:String,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],S.prototype,`definitionExpression`,void 0),p([o(n)],S.prototype,`popupEnabled`,void 0),p([o({type:he,json:{read:{source:`popupInfo`},write:{target:`popupInfo`}}})],S.prototype,`popupTemplate`,void 0),p([o({readOnly:!0,type:String,json:{origins:{service:{read:{source:`store.normalReferenceFrame`}}},read:!1}})],S.prototype,`normalReferenceFrame`,void 0),p([o({readOnly:!0,json:{read:!1}})],S.prototype,`defaultPopupTemplate`,null),p([o({readOnly:!0})],S.prototype,`graphicOrigin`,void 0),p([o()],S.prototype,`types`,null),p([o()],S.prototype,`typeIdField`,null),p([o({json:{write:!1}}),de(new me({"3DObject":`3d-object`,Point:`point`}))],S.prototype,`layerType`,void 0),p([o()],S.prototype,`geometryType`,null),p([o()],S.prototype,`profile`,null),p([o({readOnly:!0,json:{read:!1}})],S.prototype,`capabilities`,null),p([o({readOnly:!0})],S.prototype,`statisticsInfo`,void 0),S=p([u(`esri.layers.buildingSublayers.BuildingComponentSublayer`)],S);function C(e,t){e.forEach(e=>{t(e),e.type===`building-group`&&C(e.sublayers,t)})}var w={type:m,readOnly:!0,json:{origins:{service:{read:{source:`sublayers`,reader:T}}},read:!1}};function T(e,t,n){if(e&&Array.isArray(e))return new m(e.map(e=>{let t=nt(e);if(t){let r=new t;return r.read(e,n),r}return n?.messages&&e&&n.messages.push(new ce(`building-scene-layer:unsupported-sublayer-type`,`Building scene sublayer of type '`+(e.type||`unknown`)+`' are not supported`,{definition:e,context:n})),null}))}function nt(e){return e.layerType===`group`?E:S}var E=class extends b{constructor(e){super(e),this.type=`building-group`,this.listMode=`show`,this.sublayers=null}loadAll(){return le(this,e=>C(this.sublayers,t=>{t.type!==`building-group`&&e(t)}))}static{this.sublayersProperty=w}static{this.readSublayers=T}};p([o({type:[`hide`,`show`,`hide-children`],json:{write:!0}})],E.prototype,`listMode`,void 0),p([o(w)],E.prototype,`sublayers`,void 0),E=p([u(`esri.layers.buildingSublayers.BuildingGroupSublayer`)],E);var D=class extends c{constructor(){super(...arguments),this.type=null}};p([o({type:String,readOnly:!0,json:{write:{isRequired:!0}}})],D.prototype,`type`,void 0),D=p([u(`esri.layers.support.BuildingFilterAuthoringInfo`)],D);var O=D,k,A=k=class extends c{constructor(){super(...arguments),this.filterType=null,this.filterValues=null}clone(){return new k({filterType:this.filterType,filterValues:d(this.filterValues)})}};p([o({type:String,json:{write:{isRequired:!0}}})],A.prototype,`filterType`,void 0),p([o({type:[String],json:{write:{isRequired:!0}}})],A.prototype,`filterValues`,void 0),A=k=p([u(`esri.layers.support.BuildingFilterAuthoringInfoType`)],A);var rt=A,j,it=m.ofType(rt),M=j=class extends c{clone(){return new j({filterTypes:d(this.filterTypes)})}};p([o({type:it,json:{write:{isRequired:!0}}})],M.prototype,`filterTypes`,void 0),M=j=p([u(`esri.layers.support.BuildingFilterAuthoringInfoBlock`)],M);var at=M,N,ot=m.ofType(at),P=N=class extends O{constructor(){super(...arguments),this.type=`checkbox`}clone(){return new N({filterBlocks:d(this.filterBlocks)})}};p([o({type:[`checkbox`]})],P.prototype,`type`,void 0),p([o({type:ot,json:{write:{isRequired:!0}}})],P.prototype,`filterBlocks`,void 0),P=N=p([u(`esri.layers.support.BuildingFilterAuthoringInfoCheckbox`)],P);var F=P,I=class extends c{};p([o({readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],I.prototype,`type`,void 0),I=p([u(`esri.layers.support.BuildingFilterMode`)],I);var L=I,R,z=R=class extends L{constructor(){super(...arguments),this.type=`solid`}clone(){return new R}};p([o({type:[`solid`],readOnly:!0,json:{write:{isRequired:!0}}})],z.prototype,`type`,void 0),z=R=p([u(`esri.layers.support.BuildingFilterModeSolid`)],z);var B=z,V,H=V=class extends L{constructor(){super(...arguments),this.type=`wire-frame`,this.edges=null}clone(){return new V({edges:d(this.edges)})}};p([de({wireFrame:`wire-frame`})],H.prototype,`type`,void 0),p([o(xe)],H.prototype,`edges`,void 0),H=V=p([u(`esri.layers.support.BuildingFilterModeWireFrame`)],H);var st=H,U,W=U=class extends L{constructor(){super(...arguments),this.type=`x-ray`}clone(){return new U}};p([o({type:[`x-ray`],readOnly:!0,json:{write:{isRequired:!0}}})],W.prototype,`type`,void 0),W=U=p([u(`esri.layers.support.BuildingFilterModeXRay`)],W);var ct=W,G,K=G=class extends c{constructor(){super(...arguments),this.filterExpression=null,this.filterMode=new B,this.title=``}clone(){return new G({filterExpression:this.filterExpression,filterMode:d(this.filterMode),title:this.title})}};p([o({type:String,json:{write:{enabled:!0,isRequired:!0}}})],K.prototype,`filterExpression`,void 0),p([o({nonNullable:!0,types:{key:`type`,base:L,typeMap:{solid:B,"wire-frame":st,"x-ray":ct}},json:{read:e=>{switch(e?.type){case`solid`:return B.fromJSON(e);case`wireFrame`:return st.fromJSON(e);case`x-ray`:return ct.fromJSON(e);default:return}},write:{enabled:!0,isRequired:!0}}})],K.prototype,`filterMode`,void 0),p([o({type:String,json:{write:{enabled:!0,isRequired:!0}}})],K.prototype,`title`,void 0),K=G=p([u(`esri.layers.support.BuildingFilterBlock`)],K);var lt=K,q,ut=m.ofType(lt),J=q=class extends c{constructor(t){super(t),this.description=null,this.filterBlocks=null,this.id=e(),this.name=null}clone(){return new q({description:this.description,filterBlocks:d(this.filterBlocks),id:this.id,name:this.name,filterAuthoringInfo:d(this.filterAuthoringInfo)})}};p([o({type:String,json:{write:!0}})],J.prototype,`description`,void 0),p([o({type:ut,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`filterBlocks`,void 0),p([o({types:{key:`type`,base:O,typeMap:{checkbox:F}},json:{read:e=>e?.type===`checkbox`?F.fromJSON(e):null,write:!0}})],J.prototype,`filterAuthoringInfo`,void 0),p([o({type:String,constructOnly:!0,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`id`,void 0),p([o({type:String,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`name`,void 0),J=q=p([u(`esri.layers.support.BuildingFilter`)],J);var Y=class extends c{constructor(){super(...arguments),this.fieldName=null,this.modelName=null,this.label=null,this.min=null,this.max=null,this.mostFrequentValues=null,this.subLayerIds=null}};p([o({type:String})],Y.prototype,`fieldName`,void 0),p([o({type:String})],Y.prototype,`modelName`,void 0),p([o({type:String})],Y.prototype,`label`,void 0),p([o({type:Number})],Y.prototype,`min`,void 0),p([o({type:Number})],Y.prototype,`max`,void 0),p([o({json:{read:e=>Array.isArray(e)&&(e.every(e=>typeof e==`string`)||e.every(e=>typeof e==`number`))?e.slice():null}})],Y.prototype,`mostFrequentValues`,void 0),p([o({type:[Number]})],Y.prototype,`subLayerIds`,void 0),Y=p([u(`esri.layers.support.BuildingFieldStatistics`)],Y);var dt=Y,X=class extends i(l(c)){constructor(e){super(e),this.url=null,this.customParameters=null}get fields(){return this.loaded||this.loadStatus===`loading`?this._get(`fields`):(g.getLogger(this).error(`building summary statistics are not loaded`),null)}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}async _fetchService(e){let t=(await _e(this.url,{query:{f:`json`,...this.customParameters,token:this.apiKey},responseType:`json`,signal:e})).data;this.read(t,{origin:`service`})}};p([o({constructOnly:!0,type:String})],X.prototype,`url`,void 0),p([o({constructOnly:!0})],X.prototype,`customParameters`,void 0),p([o({constructOnly:!0})],X.prototype,`apiKey`,void 0),p([o({readOnly:!0,type:[dt],json:{read:{source:`summary`}}})],X.prototype,`fields`,null),X=p([u(`esri.layers.support.BuildingSummaryStatistics`)],X);var ft=m.ofType(J),pt=d(E.sublayersProperty),Z=pt.json?.origins;Z&&(Z[`web-scene`]={type:[S],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},Z[`portal-item`]={type:[S],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}});var Q=class extends He(Me(se(ue(t(ie(Oe(je(ee)))))))){constructor(e){super(e),this.operationalLayerType=`BuildingSceneLayer`,this.allSublayers=new Ce({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.type===`building-group`?e.sublayers:null}),this.sublayers=null,this._allSublayerOverrides=null,this.filters=new ft,this.activeFilterId=null,this.summaryStatistics=null,this.outFields=null,this.legendEnabled=!0,this.type=`building-scene`}normalizeCtorArgs(e){return typeof e==`string`?{url:e}:e??{}}destroy(){this.allSublayers.destroy()}readSublayers(e,t,n){let r=E.readSublayers(e,t,n);return C(r,e=>e.layer=this),this._allSublayerOverrides&&=(mt(r,this._allSublayerOverrides),null),r}write(e,t){return e=super.write(e,t),!t||t.origin!==`web-scene`&&t.origin!==`portal-item`||(this.sublayers?gt(this.sublayers,e,t):this._allSublayerOverrides&&_t(this._allSublayerOverrides,e,t)),e}read(e,t){if(super.read(e,t),(t?.origin===`web-scene`||t?.origin===`portal-item`)&&Array.isArray(e?.sublayers)){let n=ht(e.sublayers,t);this.sublayers?$(this.sublayers,n):(this._allSublayerOverrides??=new Map,this._allSublayerOverrides.set(t.origin,n))}}readSummaryStatistics(e,t){if(typeof t.statisticsHRef==`string`&&this.parsedUrl){let e=ye(this.parsedUrl.path,t.statisticsHRef);return new X({url:e,apiKey:this.apiKey,customParameters:this.customParameters})}return null}set elevationInfo(e){e!=null&&e.mode!==`absolute-height`||this._set(`elevationInfo`,e),this._validateElevationInfo(e)}load(e){let t=e==null?null:e.signal,n=this.loadFromPortal({supportedTypes:[`Scene Service`]},e).catch(oe).then(()=>this._fetchService(t)).then(()=>this._fetchAssociatedFeatureService(t));return this.addResolvingPromise(n),Promise.resolve(this)}loadAll(){return ve(this,e=>{C(this.sublayers,t=>{t.type!==`building-group`&&e(t)}),this.summaryStatistics&&e(this.summaryStatistics)})}async saveAs(e,t){return this._debouncedSaveOperations(1,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`building-scene`},e)}async save(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`building-scene`})}validateLayer(e){if(!e.layerType||e.layerType!==`Building`)throw new r(`buildingscenelayer:layer-type-not-supported`,`BuildingSceneLayer does not support this layer type`,{layerType:e.layerType})}_getTypeKeywords(){return[`Building`]}async _fetchAssociatedFeatureService(e){try{let{portalItem:t}=await Ze(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e});this.associatedFeatureServiceItem=t}catch{Pe(this._logWarningOnPopupEnabled())}}async _logWarningOnPopupEnabled(){let e=new AbortController;this.addHandles(re(e)),await Ie(()=>this.allSublayers.filter(e=>e.type===`building-component`).some(e=>e.popupEnabled&&e.popupTemplate!=null),e.signal);let t=this.allSublayers.filter(e=>e.type===`building-component`).filter(e=>e.popupEnabled&&e.popupTemplate!=null),n=[],r=[];for(let e of t){let t=e.title??`untitled ${e.id}`;e.attributeStorageInfo?n.push(t):r.push(t)}let i=n.length>0?`\nThe following sublayers will fall back to binary attributes for Popups:
  ${n.join(`
  `)}`:``,a=r.length>0?`\nThe following sublayers have no binary attributes and will not work with Popups:
  ${r.join(`
  `)}`:``;g.getLogger(this).warn(`Associated FeatureLayer could not be loaded for this BuildingSceneLayer: ${this.title}.`,i,a)}_validateElevationInfo(e){let t=`Building scene layers`;v(g.getLogger(this),$e(t,`absolute-height`,e)),v(g.getLogger(this),Qe(t,e))}};function mt(e,t){t.forEach(t=>$(e,t))}function $(e,t){let{overrides:n,context:r}=t;C(e,e=>e.read(n.get(e.id),r))}function ht(e,t){let n=new Map;for(let i of e)typeof i==`object`&&i&&typeof i.id==`number`?n.set(i.id,i):t.messages?.push(new r(`building-scene-layer:invalid-sublayer-override`,`Invalid value for sublayer override. Not an object or no id specified.`,{value:i}));return{overrides:n,context:t}}function gt(e,t,n){let r=[];C(e,e=>{let t=e.write({},n);Object.keys(t).length>1&&r.push(t)}),r.length>0&&(t.sublayers=r)}function _t(e,t,n){let r=n?.origin&&e.get(n.origin);r&&(t.sublayers=[],r.overrides.forEach(e=>{t.sublayers.push(d(e))}))}p([o({type:[`BuildingSceneLayer`]})],Q.prototype,`operationalLayerType`,void 0),p([o({readOnly:!0})],Q.prototype,`allSublayers`,void 0),p([o(pt)],Q.prototype,`sublayers`,void 0),p([h(`service`,`sublayers`)],Q.prototype,`readSublayers`,null),p([o({type:ft,nonNullable:!0,json:{write:!0}})],Q.prototype,`filters`,void 0),p([o({type:String,json:{write:!0}})],Q.prototype,`activeFilterId`,void 0),p([o({readOnly:!0,type:X})],Q.prototype,`summaryStatistics`,void 0),p([h(`summaryStatistics`,[`statisticsHRef`])],Q.prototype,`readSummaryStatistics`,null),p([o({type:[String],json:{read:!1}})],Q.prototype,`outFields`,void 0),p([o(pe)],Q.prototype,`fullExtent`,void 0),p([o(te)],Q.prototype,`legendEnabled`,void 0),p([o({type:[`show`,`hide`,`hide-children`]})],Q.prototype,`listMode`,void 0),p([o(s(_))],Q.prototype,`spatialReference`,void 0),p([o(Ae)],Q.prototype,`elevationInfo`,null),p([o({json:{read:!1},readOnly:!0})],Q.prototype,`type`,void 0),p([o()],Q.prototype,`associatedFeatureServiceItem`,void 0),Q=p([u(`esri.layers.BuildingSceneLayer`)],Q);var vt=Q;export{vt as default};