const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/groupLayerUtils-D3m8aIw5.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/originUtils-CJnuu7mB.js","assets/utils-BnryXVma.js","assets/saveUtils-CEfw3trS.js","assets/resourceUtils-Bt8ctqoA.js","assets/resourceUtils-t_8WR2aj.js"])))=>i.map(i=>d[i]);
import{$S as e,A as t,BT as n,CE as r,Kh as i,L as a,Lx as o,M as s,Rh as c,UT as l,Ua as u,VT as d,WT as f,Yh as p,_m as m,cv as h,gm as g,hm as _,kD as v,lv as y,mv as b,ov as x,pv as S,sT as C,tE as w,tT as T,ua as E,yh as D}from"./index-BN8X5Ryz.js";import{n as O}from"./saveUtils-CEfw3trS.js";import"./associatedFeatureServiceUtils-g0mrYesf.js";import"./fetchService-DUyN7SUy.js";import"./loadUtils-DEZa3oNR.js";import{t as k}from"./lazyLayerLoader-CkIeKrgl.js";import{t as A}from"./layersCreator-vJ6KgZCx.js";import"./portalLayers-C3ZU9qxp.js";import{t as j}from"./tagSymbols-67pK6deD.js";var M=class extends E(t(a(s(_(g(u(c))))))){constructor(t){super(t),this.allLayers=new x({getCollections:()=>[this.layers],getChildrenFunction:e=>`layers`in e?e.layers:null}),this.allTables=m(this),this.fullExtent=void 0,this.operationalLayerType=`GroupLayer`,this.spatialReference=void 0,this.type=`group`,this._debouncedSaveOperations=T(async(t,n,r)=>{let{save:i,saveAs:a}=await e(async()=>{let{save:e,saveAs:t}=await import(`./groupLayerUtils-D3m8aIw5.js`);return{save:e,saveAs:t}},__vite__mapDeps([0,1,2,3,4,5,6,7]));switch(t){case 0:return i(this,n);case 1:return a(this,r,n)}})}initialize(){this._enforceVisibility(this.visibilityMode,this.visible),this.addHandles([S(()=>{let e=this.parent;for(;e&&`parent`in e&&e.parent;)e=e.parent;return e&&j in e},e=>{let t=`prevent-adding-tables`;this.removeHandles(t),e&&(this.tables.removeAll(),this.addHandles(y(()=>this.tables,`before-add`,e=>{e.preventDefault(),r.getLogger(this).errorOnce(`tables`,`tables in group layers in a webscene are not supported. Please move the tables from the group layer to the webscene if you want to persist them.`)}),t))},b),S(()=>this.visible,this._onVisibilityChange.bind(this),h)])}destroy(){this.allLayers.destroy(),this.allTables.destroy()}get sourceIsPortalItem(){return this.portalItem&&this.originIdOf(`portalItem`)===7}_writeLayers(e,t,n,r){let i=[];if(!e)return i;e.forEach(e=>{let t=D(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);t?.layerType&&i.push(t)}),t.layers=i}set portalItem(e){this._set(`portalItem`,e)}readPortalItem(e,t,n){let{itemId:r,layerType:a}=t;if(a===`GroupLayer`&&r)return new i({id:r,portal:n?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}set visibilityMode(e){let t=this._get(`visibilityMode`)!==e;this._set(`visibilityMode`,e),t&&this._enforceVisibility(e,this.visible)}async beforeSave(){return O(this)}load(e){let t=this.loadFromPortal({supportedTypes:[`Feature Service`,`Feature Collection`,`Group Layer`,`Scene Service`,`Video Service`],layerModuleTypeMap:k,populateGroupLayer:A},e).catch(e=>{if(C(e),this.sourceIsPortalItem)throw e});return this.addResolvingPromise(t),Promise.resolve(this)}async loadAll(){return p(this,e=>{e(this.layers,this.tables)})}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}layerAdded(e){e.visible&&this.visibilityMode===`exclusive`?this._turnOffOtherLayers(e):this.visibilityMode===`inherited`&&(e.visible=this.visible),this.hasHandles(e.uid)?console.error(`Layer read to Grouplayer: uid=${e.uid}`):this.addHandles(S(()=>e.visible,t=>this._onChildVisibilityChange(e,t),h),e.uid)}layerRemoved(e){this.removeHandles(e.uid),this._enforceVisibility(this.visibilityMode,this.visible)}_turnOffOtherLayers(e){this.layers.forEach(t=>{t!==e&&(t.visible=!1)})}_enforceVisibility(e,t){if(!w(this).initialized)return;let n=this.layers,r=n.find(e=>e.visible);switch(e){case`exclusive`:n.length&&!r&&(r=n.at(0),r.visible=!0),this._turnOffOtherLayers(r);break;case`inherited`:n.forEach(e=>{e.visible=t})}}_onVisibilityChange(e){this.visibilityMode===`inherited`&&this.layers.forEach(t=>{t.visible=e})}_onChildVisibilityChange(e,t){switch(this.visibilityMode){case`exclusive`:t?this._turnOffOtherLayers(e):this._isAnyLayerVisible()||(e.visible=!0);break;case`inherited`:e.visible=this.visible}}_isAnyLayerVisible(){return this.layers.some(e=>e.visible)}};v([n({readOnly:!0,dependsOn:[]})],M.prototype,`allLayers`,void 0),v([n({readOnly:!0})],M.prototype,`allTables`,void 0),v([n({json:{read:!0,write:!0}})],M.prototype,`blendMode`,void 0),v([n()],M.prototype,`fullExtent`,void 0),v([n({readOnly:!0})],M.prototype,`sourceIsPortalItem`,null),v([n({json:{read:!1,write:{ignoreOrigin:!0}}})],M.prototype,`layers`,void 0),v([l(`layers`)],M.prototype,`_writeLayers`,null),v([n({type:[`GroupLayer`]})],M.prototype,`operationalLayerType`,void 0),v([n({json:{origins:{"web-map":{read:!1,write:{overridePolicy(e,t,n){return{enabled:e?.type===`Group Layer`&&n?.initiator!==this}}}},"web-scene":{read:!1,write:!1}}}})],M.prototype,`portalItem`,null),v([f(`web-map`,`portalItem`,[`itemId`])],M.prototype,`readPortalItem`,null),v([l(`web-map`,`portalItem`,{itemId:{type:String}})],M.prototype,`writePortalItem`,null),v([n({type:o})],M.prototype,`spatialReference`,void 0),v([n({json:{read:!1},readOnly:!0,value:`group`})],M.prototype,`type`,void 0),v([n({type:[`independent`,`inherited`,`exclusive`],value:`independent`,json:{write:!0,origins:{"web-map":{type:[`independent`,`exclusive`],write:(e,t,n)=>{e!==`inherited`&&(t[n]=e)}}}}})],M.prototype,`visibilityMode`,null),M=v([d(`esri.layers.GroupLayer`)],M);var N=M;export{N as default};