import{Al as e,Bm as t,Cl as n,Ml as r,Nb as i,Nl as a,Ol as o,Pl as s,Q as c,Tl as l,al as u,c_ as d,cl as f,f_ as p,jl as m,kl as h,nw as g,ow as _,p_ as v,rl as y,sl as b,u_ as x,vl as S,yl as C}from"./index-CzMixifc.js";import{k as w}from"./plane--nqwMDYx.js";import{n as T,t as E}from"./vectorStacks-BQiry9fn.js";import{s as D,t as O}from"./ray-XqUMyuyU.js";import{t as k}from"./vec3-D7a6REBc.js";function A(e){return e instanceof Float32Array&&e.length>=4}function j(e){return Array.isArray(e)&&e.length>=4}function M(e){return A(e)||j(e)}function N(e,t){let n=m(e),r=_(e[2]/n),i=Math.atan2(e[1]/n,e[0]/n);return o(t,n,r,i),t}var P=class o{constructor(e=0,t=0,n=0,r=0){this.radius=r,typeof e==`number`?this._center=x(e,t,n):k(e)||M(e)?(this._center=v(e),this.radius=e.length===4?e[3]:t):(this._center=p(e.center),this.radius=e.radius)}get center(){return this._center}set center(e){r(this.center,e)}exactEquals(e){return f(this._center,e.center)&&this.radius===e.radius}copy(e){return e!==this&&(r(this._center,e.center),this.radius=e.radius),this}clone(){return new o(this.center,this.radius)}toVec4(){return c(this.center[0],this.center[1],this.center[2],this.radius)}contains(e){return s(this.center,e)<=this.radius**2}intersectRay(e,t){if(e==null||!this._intersect(e,L))return!1;let{t0:n,t1:r}=L;if((n<0||r<n&&r>0)&&(n=r),n<0)return!1;if(t){let{origin:r,direction:i}=e;t[0]=r[0]+i[0]*n,t[1]=r[1]+i[1]*n,t[2]=r[2]+i[2]*n}return!0}intersectLine(t,n){let r=O(t,n);if(!this._intersect(r,L))return[];let{origin:a,direction:o}=r,{t0:s,t1:c}=L,l=t=>{let n=d();return e(n,a,o,t),this.projectPoint(n,n)};return Math.abs(s-c)<i()?[l(s)]:[l(s),l(c)]}_intersect(e,t){let{origin:n,direction:r}=e,i=R;i[0]=n[0]-this.center[0],i[1]=n[1]-this.center[1],i[2]=n[2]-this.center[2];let a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2];if(a===0)return!1;let o=2*(r[0]*i[0]+r[1]*i[1]+r[2]*i[2]),s=o*o-4*a*(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]-this.radius**2);if(s<0)return!1;let c=Math.sqrt(s);return t.t0=(-o-c)/(2*a),t.t1=(-o+c)/(2*a),!0}projectPoint(e,t){let r=C(E.get(),e,this.center),i=n(E.get(),r,this.radius/m(r));return a(t,i,this.center)}closestPointOnSilhouette(e,r){let i=E.get(),a=T.get();S(i,e.origin,e.direction),S(r,i,e.origin),n(r,r,1/m(r)*this.radius);let o=this._angleToSilhouette(e.origin),s=w(e.origin,r);return t(a,s+o,i),u(r,r,a),r}frustumCoverage(e,t,n){let r=this.radius,i=r*r,a=e+.5*Math.PI,o=t*t+i-2*Math.cos(a)*t*r,s=Math.sqrt(o),c=o-i;if(c<=0)return .5;let l=Math.sqrt(c),u=Math.acos(l/s)-Math.asin(r/(s/Math.sin(a)));return Math.min(1,(u+.5*n)/n)}_angleToSilhouette(e){let t=C(E.get(),e,this.center),n=m(t),r=this.radius,i=r+Math.abs(r-n);return g(r/i)}union(e){let t=h(this._center,e.center),n=this.radius,r=e.radius;return t+r<n?this:t+n<r?(this.copy(e),this):(b(this._center,this._center,e.center,(t+r-n)/(2*t)),this.radius=(t+n+r)/2,this)}toJSON(){return{center:this.center,radius:this.radius}}},F={create:e=>new P(e),copy:(e,t)=>t.copy(e),setExtent:(e,t,n)=>n.copy(e),getExtent:(e,t)=>t,elevate:(e,t,n)=>(n.copy(e),n.radius+=t,n),axisAt(e,t,n,r){let i=C(z,t,e.center);switch(n){case 0:{let e=N(i,z)[2];return o(r,-Math.sin(e),Math.cos(e),0)}case 1:{let e=N(i,z),t=e[1],n=e[2],a=Math.sin(t);return o(r,-a*Math.cos(n),-a*Math.sin(n),Math.cos(t))}case 2:return y(r,i);default:return}},altitudeAt(e,t){let n=C(B,t,e.center);return m(n)-e.radius},setAltitudeAt(e,t,r,i){let o=F.altitudeAt(e,t),s=F.axisAt(e,t,2,B),c=n(B,s,r-o);return a(i,t,c)},intersectRay:(e,t,n)=>e.intersectRay(t,n),closestPoint:(e,t,n)=>e.intersectRay(t,n)?n:(D(t,e.center,n),e.projectPoint(n,n)),intersectRayClosestSilhouette(e,t,r){if(e.intersectRay(t,r))return r;let i=e.closestPointOnSilhouette(t,E.get());return a(r,t.origin,n(E.get(),t.direction,h(t.origin,i)/m(t.direction))),r},closestPointOnSilhouette:(e,t,n)=>e.closestPointOnSilhouette(t,n),distanceToSilhouette(e,t){let n=C(E.get(),t,e.center),r=l(n),i=e.radius**2;return Math.sqrt(Math.abs(r-i))}},I=new P,L={t0:0,t1:0},R=d(),z=d(),B=d();export{F as n,I as r,P as t};