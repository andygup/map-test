import{JE as e,OT as t,Q_ as n,WT as r,ev as i,gD as a,iv as o,nv as s,vd as c}from"./index-CzMixifc.js";import"./memoryEstimations-C3WUBUZI.js";import"./OptimizedGeometry-5fDazGe-.js";import"./OptimizedFeatureSet-D4F9ObY_.js";import"./featureConversionUtils-VvJ2pauf.js";import"./streamLayerUtils-82UmlW-3.js";import"./QueueProcessor-CbN5H2eO.js";import"./earcut-CsNwSYFA.js";import"./layerViewUtils-Cbrog-dU.js";import"./colorUtils-Btp0B-0Y.js";import"./timeSupport-CjNpK2fD.js";import"./queryUtils-fxq7u50x.js";import"./quantizationUtils-CzrQVcZ1.js";import"./normalizeUtilsSync-DZGX2pCO.js";import"./GeometryUtils-C6BJBMi9.js";import"./VertexAttributeLocations-DOYYzMyn.js";import"./VertexElementDescriptor-C9CNG143.js";import"./labelPoint-D95l1mBc.js";import"./callExpressionWithCursor-NwM51lOx.js";import"./FeatureMetadata-DVsh91f_.js";import"./CIMSymbolHelper-CIzDgFQE.js";import"./rasterizingUtils-L-rXtdWe.js";import"./Rect-BMNJQxpm.js";import"./BoundingBox-CW0_Ka-z.js";import"./BidiEngine-CpIovbIK.js";import"./callExpressionWithFeature-jAwzgzDm.js";import"./OverrideHelper-Catw08-A.js";import"./FeatureCommandQueue-Ccv3I5Xd.js";import"./config-BY05DP3l.js";import"./dehydratedFeatureComparison-DeSHk9xR.js";import"./WGLContainer-v9ak9x06.js";import"./utils-CPFnbOXo.js";import"./ProgramTemplate-DXigF9DQ.js";import"./VertexArrayObject-BCHCoUBc.js";import"./BufferObject-DizvMSTk.js";import"./VertexBuffer-Dhf7DMaS.js";import"./vec3f32-BWuLbfSR.js";import"./Container-s63aPbsG.js";import"./GraphShaderModule-KXpa7jQA.js";import"./FramebufferObject-E0PFfPHi.js";import"./ShaderBuilder-Dbc4jYz7.js";import{t as l}from"./LayerView2D-BLVA9W76.js";import{t as u}from"./LayerView-BKgBHcbR.js";import"./UpdateTracking2D-BQFl9U6T.js";import"./TechniqueInstance-B2WffE-f.js";import"./TileContainer-CdHqIsYl.js";import"./constants-TfCITEY_.js";import"./utils-Cp6QQbUU.js";import{t as d}from"./highlightOptionsUtils-C-mZET-I.js";import"./AGraphicContainer-DjhIZWU6.js";import{t as f}from"./GraphicContainer-C207Aol3.js";import"./ComputedAttributeStorage-D3juJH-7.js";import{t as p}from"./GraphicsView2D-y5Ereu1j.js";import"./dehydratedFeatures-Db6Q9NQd.js";var m=`sublayers`,h=`layerView`,g=class extends l(u){*graphicsViews(){this._graphicsViewsFeatureCollectionMap==null?this._graphicsViews==null?yield*[]:yield*this._graphicsViews:yield*this._graphicsViewsFeatureCollectionMap.keys()}async hitTest(e,t){return Array.from(this.graphicsViews(),t=>{let n=t.hitTest(e);if(this._graphicsViewsFeatureCollectionMap!=null){let e=this._graphicsViewsFeatureCollectionMap.get(t);for(let t of n)!t.popupTemplate&&e.popupTemplate&&(t.popupTemplate=e.popupTemplate),t.sourceLayer=t.layer=this.layer}return n}).flat().map(t=>({type:`graphic`,graphic:t,layer:this.layer,mapPoint:e}))}highlight(t,n){let i;typeof t==`number`?i=[t]:t instanceof c?i=[t.uid]:Array.isArray(t)&&t.length>0?i=typeof t[0]==`number`?t:t.map(e=>e&&e.uid):o.isCollection(t)&&(i=t.map(e=>e&&e.uid).toArray());let a=i?.filter(e);if(!a?.length)return r();let s=d(n);return this._addHighlights(a,s),r(()=>this._removeHighlights(a,s))}update(e){for(let t of this.graphicsViews())t.processUpdate(e)}attach(){let e=this.view,t=()=>this.requestUpdate(),r=this.layer.featureCollections;if(r!=null&&r.length){this._graphicsViewsFeatureCollectionMap=new Map;for(let n of r){let r=new f(this.view.featuresTilingScheme),a=new p({view:e,graphics:n.source,renderer:n.renderer,requestUpdateCallback:t,container:r});this._graphicsViewsFeatureCollectionMap.set(a,n),this.container.addChild(a.container),this.addHandles([s(()=>n.visible,e=>a.container.visible=e,i),s(()=>a.updating,()=>this.notifyChange(`updating`),i)],h)}this._processHighlight()}else this.layer.sublayers!=null&&this.addHandles(n(()=>this.layer.sublayers,`change`,()=>this._createGraphicsViews(),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),m)}detach(){this._destroyGraphicsViews(),this.removeHandles(m)}moveEnd(){}viewChange(){for(let e of this.graphicsViews())e.viewChange()}isUpdating(){for(let e of this.graphicsViews())if(e.updating)return!0;return!1}_destroyGraphicsViews(){this.container.removeAllChildren(),this.removeHandles(h);for(let e of this.graphicsViews())e.destroy();this._graphicsViews=null,this._graphicsViewsFeatureCollectionMap=null}_createGraphicsViews(){if(this._destroyGraphicsViews(),this.layer.sublayers==null)return;let e=[],t=this.view,n=()=>this.requestUpdate();for(let r of this.layer.sublayers){let a=new f(this.view.featuresTilingScheme);a.fadeTransitionEnabled=!0;let o=new p({view:t,graphics:r.graphics,requestUpdateCallback:n,container:a});this.addHandles([r.on(`graphic-update`,o.graphicUpdateHandler),s(()=>r.visible,e=>o.container.visible=e,i),s(()=>o.updating,()=>this.notifyChange(`updating`),i)],h),this.container.addChild(o.container),e.push(o)}this._graphicsViews=e,this._processHighlight()}_processHighlight(){let e=this._getHighlights();for(let t of this._graphicsViews||[])t.setHighlight(e);this._graphicsViewsFeatureCollectionMap?.forEach((t,n)=>{n.setHighlight(e)})}};g=a([t(`esri.views.2d.layers.MapNotesLayerView2D`)],g);var _=g;export{_ as default};