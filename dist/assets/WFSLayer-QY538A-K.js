const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AttributeBinsQuery-D3TgiNPm.js","assets/queryUtils-DGU5ISbw.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/FixedIntervalBinParameters-CMgMaWGN.js","assets/AttributeBinsQuery-sRteDZ8D.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,A as n,Ai as r,BT as i,C as a,CE as o,Di as s,E as c,ED as l,L as u,Li as d,Lx as f,M as p,Mi as m,Ni as h,O as g,Ov as _,P as v,Pn as y,Qh as b,Qp as x,R as ee,Rh as te,S,Sr as ne,Ti as C,U as w,UT as T,Ua as E,Ui as re,VT as D,W as ie,W_ as ae,Z_ as oe,_ as O,_E as k,ba as A,bd as j,ca as M,cp as N,ha as P,ip as F,j as I,jE as L,ji as R,kC as z,kD as B,lT as V,pd as H,sp as U,tT as W,ta as G,ua as K,vx as q,wp as se,xa as ce,ya as le}from"./index-BN8X5Ryz.js";import"./memoryEstimations-D_IbKyOk.js";import"./OptimizedGeometry-BQJ7w5VU.js";import"./OptimizedFeatureSet-CLjmRHYn.js";import"./featureConversionUtils-o9-cJXzl.js";import"./QueryEngineCapabilities-CxeEdoTy.js";import{i as ue,r as de}from"./clientSideDefaults-Iizf0eUh.js";import"./date-DluEMNTt.js";import"./geojson-Dz-UDVkw.js";import"./xmlUtils-B_nEa0O-.js";import{c as fe,i as pe,r as me,s as he,t as ge}from"./wfsUtils-C3d6iNZ6.js";import{t as J}from"./AttributeBinsFeatureSet-B5vZtDTA.js";var _e=Symbol(`isWFSGraphicOrigin`),Y,ve=class extends A{get[(Y=_e,F)](){return this.layer}get[U](){return this.layer}get[ce](){return this.layer}constructor(e){super(),this[Y]=!0,this.type=`wfs`,this.layer=e}get id(){return this.layer.id}},X=class extends b{constructor(){super(...arguments),this._connection=null,this._workerHandler=null,this.capabilities=ue(!1,!1),this.type=`wfs`,this.refresh=W(async()=>{await this.load();let e={customParameters:this.layer.customParameters,maxRecordCount:this.layer.maxRecordCount,maxTotalRecordCount:this.layer.maxTotalRecordCount,maxPageCount:this.layer.maxPageCount},{extent:t}=await this._workerHandler.refresh(e);return t&&(this.sourceJSON.extent=t),{dataChanged:!0,updates:{extent:this.sourceJSON.extent}}})}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._startWorker({signal:t})),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null,this._workerHandler=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){let n=await this.queryFeaturesJSON(e,t);return P.fromJSON(n)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._workerHandler.queryFeatures(e?e.toJSON():void 0,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._workerHandler.queryFeatureCount(e?e.toJSON():void 0,t)}async queryObjectIds(e,t={}){return await this.load(t),this._workerHandler.queryObjectIds(e?e.toJSON():void 0,t)}async queryExtent(e,t={}){await this.load(t);let n=await this._workerHandler.queryExtent(e?e.toJSON():void 0,t);return{count:n.count,extent:q.fromJSON(n.extent)}}async querySnapping(e,t={}){return await this.load(t),this._workerHandler.querySnapping(e,t)}async queryAttributeBins(e,t={}){await this.load(t);let n=await this._workerHandler.queryAttributeBins(e?.toJSON(),t);return J.fromJSON(n)}async _createLoadOptions(e){let{url:n,customParameters:r,name:i,namespaceUri:a,fields:o,geometryType:s,maxRecordCount:c,maxPageCount:l,maxTotalRecordCount:u,swapXY:d}=this.layer,f=this.layer.originOf(`spatialReference`)===`defaults`?void 0:this.layer.spatialReference;if(!n)throw new t(`wfs-layer:missing-url`,`WFSLayer must be created with a url`);this.wfsCapabilities||=await he(n,{customParameters:r,...e});let p=[`fields`,`geometryType`,`name`,`namespaceUri`,`swapXY`].some(e=>this.layer[e]==null),m=p?await me(this.wfsCapabilities,i,a,{spatialReference:f,customParameters:r,signal:e?.signal}):{...fe(o??[]),geometryType:s,name:i,namespaceUri:a,spatialReference:f,swapXY:d},h=pe(this.wfsCapabilities.readFeatureTypes(),m.name,m.namespaceUri),g=_.toJSON(m.geometryType),{operations:v}=this.wfsCapabilities,y=v.GetFeature.url,b=v.GetFeature.outputFormat;return{customParameters:r,featureType:h,fields:m.fields?.map(e=>e.toJSON())??[],geometryField:m.geometryField,geometryType:g,getFeatureUrl:y,getFeatureOutputFormat:b,maxRecordCount:c,maxPageCount:l,maxTotalRecordCount:u,objectIdField:m.objectIdField,spatialReference:m.spatialReference?.toJSON(),swapXY:!!m.swapXY}}async _startWorker(e){let[t,n]=await V([this._createLoadOptions(e),le(`WFSSourceWorker`,{...e,strategy:l(`feature-layers-workers`)?`dedicated`:`local`,registryTarget:this})]),r=t.error||n.error||null,i=n.value||null;if(r)throw i&&i.close(),r;let a=t.value;this._connection=n.value,this._workerHandler=this._connection.createInvokeProxy();let s=await this._workerHandler.load(a,e);for(let e of s.warnings)o.getLogger(this.layer).warn(`#load()`,`${e.message} (title: '${this.layer.title||`no title`}', id: '${this.layer.id??`no id`}')`,{warning:e});this.sourceJSON={dateFieldsTimeReference:{timeZoneIANA:`UTC`},extent:s.extent,fields:a.fields,geometryType:a.geometryType,objectIdField:a.objectIdField,geometryField:a.geometryField,drawingInfo:de(a.geometryType),name:a.featureType.title,wfsInfo:{name:a.featureType.name,featureUrl:a.getFeatureUrl,maxFeatures:a.maxRecordCount,swapXY:a.swapXY,supportedSpatialReferences:a.featureType.supportedSpatialReferences,version:`2.0.0`,wfsNamespace:a.featureType.namespaceUri}}}};B([i()],X.prototype,`capabilities`,void 0),B([i({constructOnly:!0})],X.prototype,`layer`,void 0),B([i()],X.prototype,`sourceJSON`,void 0),B([i()],X.prototype,`type`,void 0),B([i()],X.prototype,`wfsCapabilities`,void 0),X=B([D(`esri.layers.graphics.sources.WFSSource`)],X);var Z,Q=a(),$=Z=class extends v(G(M(ee(re(K(g(c(I(n(u(p(E(te))))))))))))){static fromWFSLayerInfo(e){let{customParameters:t,fields:n,geometryField:r,geometryType:i,name:a,namespaceUri:o,objectIdField:s,spatialReference:c,swapXY:l,url:u,wfsCapabilities:d}=e;return new Z({customParameters:t,fields:n,geometryField:r,geometryType:i,name:a,namespaceUri:o,objectIdField:s,spatialReference:c,swapXY:l,url:u,wfsCapabilities:d})}constructor(e){super(e),this.copyright=null,this.customParameters=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureUrl=void 0,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ve(this),this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType=`WFS`,this.maxRecordCount=3e3,this.maxPageCount=10,this.maxTotalRecordCount=2e5,this.mode=0,this.name=null,this.namespaceUri=null,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new X({layer:this}),this.spatialReference=f.WGS84,this.spatialReferences=[4326],this.swapXY=void 0,this.title=`WFS`,this.type=`wfs`,this.url=null,this.version=void 0}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`WFS`]},e).then(()=>this.source.load(e)).then(()=>{this.read(this.source.sourceJSON,{origin:`service`,url:this.parsedUrl}),this.revert([`objectIdField`,`fields`,`timeInfo`,`spatialReference`,`name`,`namespaceUri`],`service`),x(this.renderer,this.fieldsIndex),se(this.timeInfo,this.fieldsIndex)})),Promise.resolve(this)}get capabilities(){return this.source?.capabilities}get createQueryVersion(){return this.commitProperty(`definitionExpression`),this.commitProperty(`timeExtent`),this.commitProperty(`timeOffset`),this.commitProperty(`geometryType`),this.commitProperty(`capabilities`),(this._get(`createQueryVersion`)||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,n){let r=e.filter(e=>e.name!==ge);this.geometryField&&r.unshift(new j({name:this.geometryField,alias:this.geometryField,type:`geometry`})),L(n,r.map(e=>e.toJSON()),t)}get parsedUrl(){return z(this.url)}set renderer(e){x(e,this.fieldsIndex),this._set(`renderer`,e)}get wfsCapabilities(){return this.source?.wfsCapabilities}set wfsCapabilities(e){this.source&&(this.source.wfsCapabilities=e)}createPopupTemplate(e){return O(this,e)}createQuery(){let e=new H({returnGeometry:!0,outFields:[`*`],where:this.definitionExpression||`1=1`}),{timeOffset:t,timeExtent:n}=this;return e.timeExtent=t!=null&&n!=null?n.offset(-t.value,t.unit):n||null,e}getFieldDomain(e,t){return this.getField(e)?.domain}getField(e){return this.fieldsIndex?.get(e)}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(H.from(e)||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}queryObjectIds(e,t){return this.load().then(()=>this.source.queryObjectIds(H.from(e)||this.createQuery(),t))}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(H.from(e)||this.createQuery(),t))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(H.from(e)||this.createQuery(),t))}async queryAttributeBins(t,n){let{source:r,capabilities:i}=await this.load();ne(t,i,`WFSLayer`);let a=await e(()=>import(`./AttributeBinsQuery-D3TgiNPm.js`),__vite__mapDeps([0,1,2,3,4,5])),o=await r.queryAttributeBins(a.default.from(t),n);if(o.features)for(let e of o.features)e.layer=e.sourceLayer=this;return o}async hasDataChanged(){try{let{dataChanged:e,updates:t}=await this.source.refresh();return t!=null&&this.read(t,{origin:`service`,url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};B([i({readOnly:!0})],$.prototype,`capabilities`,null),B([i({type:String})],$.prototype,`copyright`,void 0),B([i({readOnly:!0})],$.prototype,`createQueryVersion`,null),B([i({json:{name:`wfsInfo.customParameters`,write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0),ignoreOrigin:!0})}}})],$.prototype,`customParameters`,void 0),B([i(ae(`dateFieldsTimeReference`))],$.prototype,`dateFieldsTimeZone`,void 0),B([i({readOnly:!0})],$.prototype,`defaultPopupTemplate`,null),B([i({type:String,json:{name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],$.prototype,`definitionExpression`,void 0),B([i({type:String})],$.prototype,`displayField`,void 0),B([i(R)],$.prototype,`elevationInfo`,void 0),B([i({type:String,readOnly:!0,json:{name:`wfsInfo.featureUrl`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`featureUrl`,void 0),B([i({type:[j],json:{name:`layerDefinition.fields`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`fields`}}}})],$.prototype,`fields`,void 0),B([T(`fields`)],$.prototype,`writeFields`,null),B([i(Q.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),B([i({type:q,json:{name:`extent`}})],$.prototype,`fullExtent`,void 0),B([i()],$.prototype,`geometryField`,void 0),B([i({type:String,json:{read:{source:`layerDefinition.geometryType`,reader:_.read},write:{target:`layerDefinition.geometryType`,writer:_.write,ignoreOrigin:!0},origins:{service:{read:_.read}}}})],$.prototype,`geometryType`,void 0),B([i({readOnly:!0,clonable:!1})],$.prototype,`graphicOrigin`,void 0),B([i({type:String})],$.prototype,`id`,void 0),B([i(m)],$.prototype,`labelsVisible`,void 0),B([i({type:[y],json:{name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:S},write:!0}})],$.prototype,`labelingInfo`,void 0),B([i(s)],$.prototype,`legendEnabled`,void 0),B([i({type:[`show`,`hide`]})],$.prototype,`listMode`,void 0),B([i({type:String})],$.prototype,`objectIdField`,void 0),B([i({type:[`WFS`]})],$.prototype,`operationalLayerType`,void 0),B([i({type:k,json:{name:`wfsInfo.maxFeatures`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`maxRecordCount`,void 0),B([i({type:k})],$.prototype,`maxPageCount`,void 0),B([i({type:k})],$.prototype,`maxTotalRecordCount`,void 0),B([i({type:[0],readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],$.prototype,`mode`,void 0),B([i({type:String,json:{name:`wfsInfo.name`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`name`,void 0),B([i({type:String,json:{name:`wfsInfo.wfsNamespace`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`namespaceUri`,void 0),B([i(C)],$.prototype,`opacity`,void 0),B([i(Q.outFields)],$.prototype,`outFields`,void 0),B([i({readOnly:!0})],$.prototype,`parsedUrl`,null),B([i(r)],$.prototype,`popupEnabled`,void 0),B([i({type:N,json:{name:`popupInfo`,write:!0}})],$.prototype,`popupTemplate`,void 0),B([i({types:w,json:{origins:{service:{name:`drawingInfo.renderer`},"web-scene":{types:ie,name:`layerDefinition.drawingInfo.renderer`,write:!0}},name:`layerDefinition.drawingInfo.renderer`,write:{ignoreOrigin:!0}}})],$.prototype,`renderer`,null),B([i(h)],$.prototype,`screenSizePerspectiveEnabled`,void 0),B([i({readOnly:!0})],$.prototype,`source`,void 0),B([i({type:f,json:{name:`layerDefinition.spatialReference`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`extent.spatialReference`}}}})],$.prototype,`spatialReference`,void 0),B([i({readOnly:!0,type:[k],json:{name:`wfsInfo.supportedSpatialReferences`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`spatialReferences`,void 0),B([i({type:Boolean,value:!1,json:{name:`wfsInfo.swapXY`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`swapXY`,void 0),B([i({json:{write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`name`}}}})],$.prototype,`title`,void 0),B([i({json:{read:!1},readOnly:!0})],$.prototype,`type`,void 0),B([i(d)],$.prototype,`url`,void 0),B([i({type:String,readOnly:!0,json:{name:`wfsInfo.version`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`version`,void 0),B([i()],$.prototype,`wfsCapabilities`,null),$=Z=B([D(`esri.layers.WFSLayer`)],$);var ye=$;export{ye as default};