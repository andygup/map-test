import{aE as e,aF as i,aL as l,aM as q,d0 as P,ge as A,aO as $,bl as C,bb as _,bC as O,Z as j,s as V,b9 as p,fd as n,b6 as x,kn as U}from"./index-DzfnmjFP.js";import{h as M}from"./Container-CR-hhQoG.js";let c=class extends q{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};e([i({readOnly:!0})],c.prototype,"version",null),c=e([l("esri.views.layers.support.ClipArea")],c);const g=c;var m;let h=m=class extends g{constructor(a){super(a),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new m({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};e([i({type:[Number,String],json:{write:!0}})],h.prototype,"left",void 0),e([i({type:[Number,String],json:{write:!0}})],h.prototype,"right",void 0),e([i({type:[Number,String],json:{write:!0}})],h.prototype,"top",void 0),e([i({type:[Number,String],json:{write:!0}})],h.prototype,"bottom",void 0),h=m=e([l("esri.views.layers.support.ClipRect")],h);const N=h;var v;const H={base:A,key:"type",typeMap:{extent:$,polygon:C}};let d=v=class extends g{constructor(a){super(a),this.type="geometry",this.geometry=null}clone(){var a;return new v({geometry:((a=this.geometry)==null?void 0:a.clone())??null})}commitVersionProperties(){this.commitProperty("geometry")}};e([i({types:H,json:{read:P,write:!0}})],d.prototype,"geometry",void 0),d=v=e([l("esri.views.layers.support.Geometry")],d);const L=d;let u=class extends g{constructor(a){super(a),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};e([i({type:[[[Number]]],json:{write:!0}})],u.prototype,"path",void 0),u=e([l("esri.views.layers.support.Path")],u);const T=u,y=_.ofType({key:"type",base:null,typeMap:{rect:N,path:T,geometry:L}}),I=a=>{let r=class extends a{constructor(){super(...arguments),this.attached=!1,this.clips=new y,this.highlightOptions=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){var f,w,R;const s=((f=this.view)==null?void 0:f.spatialReferenceLocked)??!0;((w=this.view)==null?void 0:w.spatialReference)&&s&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new V("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new M),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([p(()=>this.suspended,t=>{this.container&&(this.container.visible=!t)},n),p(()=>this.updateSuspended,t=>{this.view&&!t&&this.updateRequested&&this.view.requestUpdate()},n),p(()=>{var t;return((t=this.layer)==null?void 0:t.opacity)??1},t=>{this.container&&(this.container.opacity=t)},n),p(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",t=>{this.container&&(this.container.blendMode=t)},n),p(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,t=>{this.container&&(this.container.effect=t)},n),p(()=>this.highlightOptions,t=>this.container.highlightOptions=t,n),x(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},n),p(()=>{var t;return{scale:(t=this.view)==null?void 0:t.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}},({scale:t,scaleRange:S})=>{const b=U(S,t);b!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=b)},n)],"constructor"),(R=this.view)!=null&&R.whenLayerView?this.view.whenLayerView(this.layer).then(t=>{t===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){var o;const s=(o=this.view)==null?void 0:o.spatialReference;return s==null||this.supportsSpatialReference(s)}get updating(){var s;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!((s=this._updatingHandles)!=null&&s.updating))}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(s){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",s),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(s))):this.updateRequested=!1}hitTest(s,o){return Promise.resolve(null)}supportsSpatialReference(s){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const s=super.getSuspendInfo(),o=!this.spatialReferenceSupported;return o&&(s.spatialReferenceNotSupported=o),s}addAttachHandles(s){this.addHandles(s,"attach")}};return e([i()],r.prototype,"attached",void 0),e([i({type:y,set(s){const o=O(s,this._get("clips"),y);this._set("clips",o)}})],r.prototype,"clips",void 0),e([i()],r.prototype,"container",void 0),e([i({type:j})],r.prototype,"highlightOptions",void 0),e([i()],r.prototype,"moving",void 0),e([i({readOnly:!0})],r.prototype,"spatialReferenceSupported",null),e([i({readOnly:!0})],r.prototype,"updateParameters",void 0),e([i()],r.prototype,"updateRequested",void 0),e([i()],r.prototype,"updating",null),e([i()],r.prototype,"view",void 0),e([i()],r.prototype,"_visibleAtCurrentScale",void 0),e([i({readOnly:!0})],r.prototype,"visibleAtCurrentScale",null),r=e([l("esri.views.2d.layers.LayerView2D")],r),r};export{L as a,I as f};
