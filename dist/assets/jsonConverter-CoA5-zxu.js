import{Av as e,Lv as t,Lx as n,Pv as r,SS as i,dS as a,eS as o,jv as s,tS as c}from"./index-BN8X5Ryz.js";import{I as l,Jt as u,Wt as d,Xt as f,cn as p,gt as m,in as h,kt as g,ln as _,m as v,o as y,st as b,vn as x,wn as S}from"./Point2D-DJueHbCy.js";import{Bn as C,D as w,Fn as T,G as E,Gn as D,Hn as O,Nn as k,On as A,Pn as j,Rn as M,Rt as N,S as P,Tn as F,Wn as I,Z as L,_n as R,c as z,dn as B,g as ee,it as V,j as te,kn as H,ln as ne,on as re,pn as ie,sn as ae,un as U,w as oe,wn as W,xn as se,yn as G,z as K,zn as ce}from"./SpatialReference-CfUjvF_j.js";import{a as le,i as ue,n as q}from"./FlatGeometry-BsPiiSVP.js";K()||oe(e=>{let t,n;typeof e==`number`?t=e:n=e;let r={wkid:t,wkt:n},s,l;if(n){s=c(n);let e=i(r);if(!s&&!e)throw Error(`Unsupported WKT type: ${n}`)}else s=!i(r);return l=t&&o.has(t)?Math.PI/200:s?a(r):Math.PI/180,{isPCS:s,metersOrRadiansPerUnit:l,semiMajor:0,wkidOrWkt:e}});function de({type:e,vertexCount:t,vertexXY:n,vertexZ:r,vertexM:i,partCount:a,partOffsets:o,partFlags:s,segmentFlags:c,segmentIndices:l,segmentParams:u,segmentCountArc:d,segmentCountBezier:f}){let p=new fe[e];if(p instanceof I)return p.setXYCoords(n[0],n[1]),r&&p.setZ(r[0]),i&&p.setM(i[0]),p;let m=new O({fromArray:n});if(p.setAttributeStreamRef(0,m),r){let e=new O({fromArray:r});p.setAttributeStreamRef(1,e)}if(i){let e=new O({fromArray:i});p.setAttributeStreamRef(2,e)}if(p instanceof R)return p.resizeNoInit(t),p;{let e=a+1,t=new D({fromArray:o,size:e}),n=new M({fromArray:s,size:e});p.setPathStreamRef(t),p.setPathFlagsStreamRef(n)}if(c==null)return p.resizeImpl(t),p;let h=new M({fromArray:c}),g=new D({fromArray:l}),_=new O({fromArray:u});return p.setSegmentData(g,_,h,u.length),p.incCurveType(4,d),p.incCurveType(2,f),p.modifyCurveCounter(d+f),p.resizeImpl(t),p}var fe={point:I,multipoint:R,polyline:U,polygon:G};function pe(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){let e=this.m_bReturnKey,t=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,e?{value:{m_token:5,m_value:this.m_keys[t]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[t]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function me(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){let e={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||e.value.m_value===void 0&&(e.value.m_value=NaN),e}return{value:{m_token:4,m_value:null},done:!0}}var he=class{createJSONObjectIterator(e){return{m_iteratorType:`object`,m_o:e,m_keys:this.m_options.strict?Object.keys(e):Object.keys(e).filter(t=>e[t]!==void 0),m_i:-1,m_bReturnKey:!0,next:pe}}createJSONArrayIterator(e){return{m_iteratorType:`array`,m_strict:this.m_options.strict,m_i:-1,m_a:e,next:me}}constructor(e,t){this.m_currentToken=0,this.m_options=t?{...t}:{strict:!0};let n=e;this.m_iteratorStack=[n instanceof Array?this.createJSONArrayIterator(n):this.createJSONObjectIterator(n)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(this.m_iteratorStack.length===0)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(typeof this.m_nextFlatToken.m_value==`number`)return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=d()&&this.m_currentValue<=m()?this.m_currentToken=8:this.m_currentToken=7;if(typeof this.m_nextFlatToken.m_value==`string`)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if(typeof this.m_nextFlatToken.m_value==`boolean`)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if(typeof this.m_nextFlatToken.m_value==`object`)return this.m_currentValue=null,this.m_currentToken=10;_(`unrecognized json element type`)}_(`unrecognized json element type`)}currentToken(){return this.m_currentToken}skipChildren(){if(this.m_iteratorStack.length!==0)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,this.m_currentToken=3;return;case 2:this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,this.m_currentToken=4;return}}currentString(){return this.m_currentToken!==6&&this.m_currentToken!==5&&h(`invalid token`),this.m_currentValue}currentDoubleValue(){return this.m_currentToken!==7&&this.m_currentToken!==8&&h(`invalid token`),this.m_currentValue}currentInt32Value(){return this.m_currentToken!==8&&h(`invalid token`),this.m_currentValue}currentInt64Value(){return x(0),0n}currentBoolValue(){return this.m_currentToken!==12&&this.m_currentToken!==11&&h(`invalid token`),this.m_currentValue}isError(){return 0}},ge=class{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){let e={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}startArray(){let e=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(e){this.m_pendingKey=e}addValue_(e){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):this.m_currentObject.at(-1).push(e)}addString(e){this.addValue_(e)}addDouble(e,t){this.addValue_(e)}addInt64(e){x(0)}addInt32(e){this.addValue_(e)}addBool(e){this.addValue_(e)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}},_e=class e{constructor(e){this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),e.sz===void 0?e.move?(this.m_sz=e.move.m_sz,this.m_buffer=e.move.m_buffer,this.m_view=e.move.m_view,this.m_bOwnsBuffer=e.move.m_bOwnsBuffer,this.m_bLittleEndian=e.move.m_bLittleEndian,e.move.m_buffer=null,e.move.m_view=null,e.move.m_sz=0,e.move.m_bOwnsBuffer=!0):_(`unrecognized constructor options`):(this.m_sz=e.sz,e.buffer?(this.m_sz<0&&u(`size out of range`),this.m_buffer=e.buffer,this.m_offset=e.offset===void 0?0:e.offset,this.m_view=e.offset===void 0?new DataView(this.m_buffer):new DataView(e.buffer,e.offset,e.sz),this.m_bOwnsBuffer=!1,this.m_bLittleEndian=!0):(this.m_sz<0&&u(`size out of range`),this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(e){return this===e||(this.clear(),this.m_sz=e.m_sz,this.m_buffer=e.m_buffer,this.m_view=e.m_view,this.m_bOwnsBuffer=e.m_bOwnsBuffer,this.m_bLittleEndian=e.m_bLittleEndian,e.m_buffer=null,e.m_sz=0,e.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(e.getNativeByteOrder()===1)}setNativeByteOrder(){this.m_bLittleEndian=e.getNativeByteOrder()===1}setOrder(e){this.m_bLittleEndian=e===1}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||f(`buffer not defined`),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(e){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(e,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(e,this.m_bLittleEndian)}writeDouble(e,t){this.m_elementDouble[0]=t,this.swapBytesDouble(),this.m_view.setFloat64(e,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(e){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(e,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(e,this.m_bLittleEndian)}writeInt32(e,t){this.m_elementInt32[0]=t,this.swapBytesInt32(),this.m_view.setInt32(e,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(e){x(e>=0&&e<=this.m_sz),this.m_sz=e}};function ve(e,t,n,r,i,a){let o=!1,s=!1,c=!1,l=!1,u=!1,d=!1,f=!1,m=!1,g=!1,_=!1,v=!1,y=!1,b=!1,S=!1,C=!1,w=!1,E=!1,D=!1,O=!1,k=!1,A=!1,j=!1,M=!1,N=!1,P=NaN,L=NaN,R=NaN,z=NaN,B=0,ee=NaN,V=NaN,te=NaN,H=NaN,ne=NaN,re=NaN,ie=NaN,ae=NaN,U=0,oe=0,W=!1,se=!1,G=null,K=null,le=null,ue=null,q=null;for(;n.nextToken()!==3;){let a=n.currentString();if(n.nextToken(),a===`spatialReference`){if(i&&!o){o=!0,n.currentToken()===1?ue=be(n):n.currentToken()!==10&&h(`failed to parse spatial reference: object or null is expected`);continue}}else if(r)if(a===`hasZ`){if(!s){s=!0,W=n.currentToken()===11;continue}}else if(a===`hasM`){if(!c){c=!0,se=n.currentToken()===11;continue}}else if(a===`rings`){if(!(u||d||e!==p.enumUnknown&&e!==p.enumPolygon)){u=!0,{geometry:q,as:G,bs:K}=xe(!0,!1,t,n);continue}}else if(a===`curveRings`){if(!d&&(e===p.enumUnknown||e===p.enumPolygon)){d=!0,{geometry:q,as:G,bs:K}=xe(!0,!0,t,n);continue}}else if(a===`paths`){if(!(f||m||e!==p.enumUnknown&&e!==p.enumPolyline)){f=!0,{geometry:q,as:G,bs:K}=xe(!1,!1,t,n);continue}}else if(a===`curvePaths`){if(!m&&(e===p.enumUnknown||e===p.enumPolyline)){m=!0,{geometry:q,as:G,bs:K}=xe(!1,!0,t,n);continue}}else if(a===`points`){if(!g&&(e===p.enumUnknown||e===p.enumMultiPoint)){g=!0,{geometry:q,as:G,bs:K}=Se(t,n);continue}}else if(a===`ids`){if(!l){l=!0,le=Ce(t,n);continue}}else if(a===`x`){if(!_&&(e===p.enumUnknown||e===p.enumPoint)){_=!0,P=J(n);continue}}else if(a===`y`){if(!v&&(e===p.enumUnknown||e===p.enumPoint)){v=!0,L=J(n);continue}}else if(a===`z`){if(!y&&(e===p.enumUnknown||e===p.enumPoint)){y=!0,R=J(n);continue}}else if(a===`m`){if(!b&&(e===p.enumUnknown||e===p.enumPoint)){b=!0,z=J(n);continue}}else if(a===`id`){if(!S&&(e===p.enumUnknown||e===p.enumPoint)){S=!0,B=we(n);continue}}else if(a===`xmin`){if(!C&&(e===p.enumUnknown||e===p.enumEnvelope)){C=!0,ee=J(n);continue}}else if(a===`ymin`){if(!w&&(e===p.enumUnknown||e===p.enumEnvelope)){w=!0,V=J(n);continue}}else if(a===`mmin`){if(!A&&(e===p.enumUnknown||e===p.enumEnvelope)){A=!0,ie=J(n);continue}}else if(a===`zmin`){if(!O&&(e===p.enumUnknown||e===p.enumEnvelope)){O=!0,ne=J(n);continue}}else if(a===`idmin`){if(!M&&(e===p.enumUnknown||e===p.enumEnvelope)){M=!0,U=we(n);continue}}else if(a===`xmax`){if(!E&&(e===p.enumUnknown||e===p.enumEnvelope)){E=!0,te=J(n);continue}}else if(a===`ymax`){if(!D&&(e===p.enumUnknown||e===p.enumEnvelope)){D=!0,H=J(n);continue}}else if(a===`mmax`){if(!j&&(e===p.enumUnknown||e===p.enumEnvelope)){j=!0,ae=J(n);continue}}else if(a===`zmax`){if(!k&&(e===p.enumUnknown||e===p.enumEnvelope)){k=!0,re=J(n);continue}}else if(a===`idmax`){if(!N&&(e===p.enumUnknown||e===p.enumEnvelope)){N=!0,oe=we(n);continue}}else a===`materials`&&x(0);n.skipChildren()}if(u||d||f||m||g){let e=null,t=null,n=q;W&&(q.addAttribute(1),e=G,e||=F(n.getPointCount(),NaN)),se&&(q.addAttribute(2),t=W?K:G),le!=null&&q.addAttribute(3),W&&e!=null&&n.setAttributeStreamRef(1,e),se&&t!=null&&n.setAttributeStreamRef(2,t),le!=null&&Te(n,le)}else if(_||v||b||y||S){T(P,L)||h(`failed to parse point: x and y must be finite or nan`),(Number.isNaN(L)||Number.isNaN(P))&&(P=NaN,L=NaN);let e=new I({x:P,y:L});y&&e.setZ(R),b&&e.setM(z),S&&e.setID(B),q=e}else if(C||w||E||D||O||k||A||j||M||N){(Number.isNaN(V)||Number.isNaN(te)||Number.isNaN(H))&&(ee=NaN);let e=new ce({xmin:ee,ymin:V,xmax:te,ymax:H});O&&k&&e.setInterval(1,0,ne,re),A&&j&&e.setInterval(2,0,ie,ae),M&&N&&e.setInterval(3,0,U,oe),q=e}return{...q?{geom:q}:{},...ue?{sr:ue}:{}}}function ye(e){let t=!1;for(;e.nextToken()!==3;){let n=e.currentString();e.nextToken(),n===`uwkid`?t||(t=!0,e.currentToken()===8&&e.currentInt32Value()):e.skipChildren()}return null}function be(e){let t=!1,n=!1,r=!1,i=!1,a=!1,o=!1,s=!1,c=!1,l=!1,u=!1,d=!1,f=!1,p=!1,m=!1,h=!1,g=!1,_=!1,v=-1,y=-1,b=-1,x=-1,S=0,C=0,T=0,D=0,O=0,k=0,A=0,j=0,M=0,N=0,F=``,I=``,R=null;for(;e.nextToken()!==3;){let w=e.currentString();e.nextToken(),w===`wkid`?t||(t=!0,e.currentToken()===8&&(v=e.currentInt32Value())):w===`latestWkid`?n||(n=!0,e.currentToken()===8&&(y=e.currentInt32Value())):w===`wkt`?a||(a=!0,e.currentToken()===6&&(F=e.currentString())):w===`wkt2`?a||e.currentToken()===6&&(I=e.currentString()):w===`vcsWkid`?r||(r=!0,e.currentToken()===8&&(b=e.currentInt32Value())):w===`latestVcsWkid`?i||(i=!0,e.currentToken()===8&&(x=e.currentInt32Value())):w===`xyTolerance`?s||(s=!0,o=!0,S=e.currentDoubleValue()):w===`zTolerance`?c||(c=!0,o=!0,C=e.currentDoubleValue()):w===`mTolerance`?l||(l=!0,o=!0,T=e.currentDoubleValue()):w===`falseX`?u||(u=!0,o=!0,A=e.currentDoubleValue()):w===`falseY`?d||(d=!0,o=!0,j=e.currentDoubleValue()):w===`falseZ`?f||(f=!0,o=!0,M=e.currentDoubleValue()):w===`falseM`?p||(p=!0,o=!0,N=e.currentDoubleValue()):w===`xyUnits`?m||(m=!0,o=!0,D=e.currentDoubleValue()):w===`zUnits`?h||(h=!0,o=!0,O=e.currentDoubleValue()):w===`mUnits`?g||(g=!0,o=!0,k=e.currentDoubleValue()):w===`unit`?_||(_=!0,R=ye(e)):e.skipChildren()}x<=0&&b>0&&(x=b),b<=0&&x>0&&(b=x);let B=null,H=!0;if(F.length!==0&&(H=!1,te(F)&&(B=L(F))),B||I.length===0||(H=!1,te(I)&&(B=L(I))),!B&&y>0&&(H=!1,ee(y)&&(x<=0||z())&&(B=w(y,x))),!B&&v>0&&(H=!1,ee(v)&&(b<=0||z())&&(B=w(v,b))),H&&(B=E(R)),o&&B){let e=new V;B.queryPrecisionDescriptorWithoutFalseXY(e),s&&e.setTolerance(0,S),c&&e.setTolerance(1,C),l&&e.setTolerance(2,T),m&&u&&d&&e.setGridParams(A,j,D),h&&f&&e.setZParams(M,O),g&&p&&e.setMParams(N,k),B=P(B,e)}return B}function xe(e,t,n,r){r.currentToken()!==2&&h(`failed to parse multipath: array of array of vertices is expected`);let i=e?new G:new U,a=i,o=A(0),s=F(2,0),c=H(0),l=null,u=null,d=null,f=null,p=null,m=0,_=0,x=0,S=new ne,C=g.getNAN(),w=0,T=0,E=e?1:0;for(;r.nextToken()!==4;){r.currentToken()!==2&&h(`failed to parse multipath: ring/path array is expected`);let n=2,i=0,D=!0,O=0,k=0,M=g.getNAN(),N=b(4,NaN),P=b(4,NaN),I=!1;for(r.nextToken();r.currentToken()!==4;){if(t&&r.currentToken()===1)D&&h(`failed to parse multipath: starting vertex array is expected`),d||(d=H(w-1,1),f=A(w-1,-1),p=F(0)),I=!0,n=1,{segFlag:x,toPointSz:O}=je(S,N,C,r);else{for(I=!1,r.currentToken()!==2&&h(`failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates`),O=0;r.nextToken()!==4;)O===4&&h(`failed to parse multipath: each vertex array has to have at most 4 elements`),N[O++]=J(r);O<2&&h(`failed to parse multipath: each vertex array has to have at least 2 elements`),j(N[0],N[1])||h(`failed to parse multipath: x and y must be finite`)}r.nextToken();do{if(s.size()===2*w&&s.resize(Ee(w)),s.writePoint2D(2*w,M.setCoords(N[0],N[1])),l&&l.size()===w&&l.resize(Y(w)),O>2?(l||=F(w+1,NaN),l.write(w,N[2])):l&&l.write(w,NaN),u&&u.size()===w&&u.resize(Y(w)),O>3?(u||=F(w+1,NaN),u.write(w,N[3])):u&&u.write(w,NaN),D)T++,o.add(w),c.add(E),D=!1,k=O,v(P,N,0,0,k);else if(d!==null)if(I){let e=re(x),t=p.size();p.resize(t+e),d.add(x),f.add(m),S.get().writeInBufferStream(p,m),m+=e,a.incCurveType(x,1),_++}else d.add(1),f.add(-1);w++,i++,C.setCoords(N[0],N[1])}while(i<n&&r.currentToken()===4)}i!==0&&(e&&i>n&&O===k&&y(N,P,O)===0?(w--,i--):d!==null&&(d.add(1),f.add(-1)))}return w&&(o.resize(T),c.resize(T),w>0&&(o.add(w),c.add(0)),a.setAttributeStreamRef(0,s),a.setPathFlagsStreamRef(c),a.setPathStreamRef(o),d!==null&&(a.updateCurveCounter(_),a.setSegmentData(f,p,d,m)),a.notifyModifiedFlags(65535)),{geometry:i,as:l,bs:u}}function Se(e,t){t.currentToken()!==2&&h(`failed to parse multipoint: array of vertices is expected`);let n=0,r=new R,i=F(2,0),a=0,o=b(4,NaN),s=new g,c=null,l=null;for(;t.nextToken()!==4;){for(t.currentToken()!==2&&h(`failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates`),a=0;t.nextToken()!==4;)a===4&&h(`failed to parse multipoint: each vertex array has to have at most 4 elements`),o[a++]=J(t);a<2&&h(`failed to parse multipoint: each vertex array has to have at least 2 elements`),j(o[0],o[1])||h(`failed to parse multipoint: x and y must be finite`),i.size()===2*n&&i.resize(Ee(n)),i.writePoint2D(2*n,s.setCoords(o[0],o[1])),c&&c.size()===n&&c.resize(Y(n)),a>2?(c||=F(n+1,NaN),c.write(n,o[2])):c&&c.write(n,NaN),l&&l.size()===n&&l.resize(Y(n)),a>3?(l||=F(n+1,NaN),l.write(n,o[3])):l&&l.write(n,NaN),n++}if(n){let e=r.getImpl();e.setAttributeStreamRef(0,i),e.resizeNoInit(n),e.notifyModifiedFlags(65535)}return{geometry:r,as:c,bs:l}}function Ce(e,t){t.currentToken()!==2&&h(`failed to parse array of IDs: array of array of integers is expected`);let n=k(2,0),r=0,i=-1;for(;t.nextToken()!==4;){let e=r;n.size()===r&&n.resize(Y(r)),r++;let a=0;for(i===-1?i=t.currentToken()===2?1:0:i===1&&t.currentToken()!==2&&h(`failed to parse array of IDs: array of array of integers is expected`),i===0&&(n.size()===r&&n.resize(Y(r)),n.write(r,we(t)),a++,r++);t.nextToken()!==4;)n.size()===r&&n.resize(Y(r)),n.write(r,we(t)),a++,r++;if(n.write(e,a),i===0)break}return n.resize(r),n}function J(e){let t=e.currentToken();if(t===10||t===6&&e.currentString()===`NaN`)return NaN;{let t=e.currentDoubleValue();return Number.isNaN(t)?NaN:t}}function we(e){return e.currentInt32Value()}function Te(e,t){if(e.isEmpty())return;let n=k(2,0),r=e.getGeometryType(),i=0;r===R.type?i=1:r===U.type||r===G.type?i=e.getPathCount():_(`not implemented`),n.resize(e.getPointCount(),0);let a=0;for(let o=0;o<i;++o){let i=t.read(a);a++;let s=a+i,c=0,l=0;r===R.type?c=e.getPointCount():r===U.type||r===G.type?(c=e.getPathSize(o),l=e.getPathStart(o)):_(`not implemented`);for(let e=0,r=Math.min(i,c);e<r;++e)n.write(l,t.read(a)),a++,l++;a=s}e.getImpl().setAttributeStreamRef(3,n)}function Ee(e){let t=2*Math.trunc(3*(e+1)/2);return t<8?t=8:t<32&&(t=32),t}function Y(e){let t=Math.trunc(3*(e+1)/2);return t<4?t=4:t<16&&(t=16),t}function De(e,t,n,r,i){i>=r.size()&&u(`Byte_buffer out of range access`),e.m_bits=0,e.m_rotation=0,e.m_cosr=1,e.m_sinr=0,e.setStartXY(t),e.setEndXY(n);let a=g.getNAN();a.x=r.readDouble(i),a.y=r.readDouble(i+8);let o=r.readInt32(i+16);if(1&o)return e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,W(e),!1;let s=!!(64&o),c=!!(128&o),l=!!(32&o),d=!!(8&o),f=!!(16&o),p=t.equals(n);return s&&!p&&(s=!1,l=!0),l&&p&&(s=!0,l=!1,a.setCoords(0,0)),s||(c?l?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0):(e.constructCircularArcThreePoint(t,n,a),p&&d===e.isClockwise()&&e.reverse()):l?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,W(e),e.queryCoord2D(.5,e.m_interior)):ae(e,t,n,a,d,f)),s&&(e.m_center.assign(t),e.m_startAngle=a.x,e.m_sweepAngle=a.y,ie(e,NaN,d,f),e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.setCoordsPoint2D(t)),e.setProjectionBehavior(0),W(e),!0}function Oe(e,t,n,r,i){e.m_bits=0,e.m_center.x=r.readDouble(i),e.m_center.y=r.readDouble(i+8),e.m_rotation=r.readDouble(i+16),e.m_semiMajorAxis=r.readDouble(i+24),e.m_minorMajorRatio=r.readDouble(i+32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y;let a=r.readInt32(i+40);if(1&a)return!1;let o=!!(64&a),s=!!(128&a),c=!!(2048&a),l=!!(4096&a);return!(512&a)&&!(1024&a)||s||(o=!0),s&&!t.equals(n)?(s=!1,o=!0):o&&t.equals(n)&&(s=!0,o=!1),s?(e.m_center.assign(t),e.m_startAngle=e.m_center.x,e.m_sweepAngle=e.m_center.y,ie(e,NaN,c,l),e.m_semiMajorAxis=0,e.m_interior.setCoordsPoint2D(t)):o?(e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,W(e),e.queryCoord2D(.5,e.m_interior)):e.constructEllipticArcEndPointsCenter(t,n,e.m_semiMajorAxis,e.m_minorMajorRatio,e.m_rotation,!l,c,e.m_center),e.setProjectionBehavior(1),W(e),!0}function ke(e,t,n,r,i){return x(i+32<=r.size()),e.m_cp=l(g,2),e.m_cp[0].x=r.readDouble(i),e.m_cp[0].y=r.readDouble(i+8),e.m_cp[1].x=r.readDouble(i+16),e.m_cp[1].y=r.readDouble(i+24),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y,!0}function Ae(e,t,n,r,i){return e.m_cp.x=r.readDouble(i),e.m_cp.y=r.readDouble(i+8),e.m_weights[0]=r.readDouble(i+16),e.m_weights[1]=r.readDouble(i+24),e.m_weights[2]=r.readDouble(i+32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y,!0}function je(e,t,n,r,i){let a={segFlag:0,toPointSz:0},o=r.currentToken();o=r.nextToken();let s=r.currentString(),c=s[0];for((s.length!==1||c!==`a`&&c!==`b`&&c!==`c`&&c!==`n`&&c!==`q`)&&h(`failed to parse curve: expecting "a", "b", "n", "q", or "c"`),o=r.nextToken(),o!==2&&h(`failed to parse curve: start array is expected for curve parameters`),o=r.nextToken(),o!==2&&h(`failed to parse curve: start array is expected for to point`),a.toPointSz=0;r.nextToken()!==4;)a.toPointSz===4&&h(`failed to parse curve: vertex array cannot have more than 4 elements`),t[a.toPointSz++]=J(r);a.toPointSz<2&&h(`failed to parse curve: vertex array must have at least 2 elements`);let l=g.construct(t[0],t[1]),u=g.getNAN(),d=-1,f=-1,p=!1,m=NaN,_=NaN,v=NaN,y=[g.getNAN(),g.getNAN(),g.getNAN()],b=g.getNAN();if(c===`a`){o=r.nextToken(),o!==2&&h(`failed to parse curve: start array is expected for center point`),o=r.nextToken();let e=J(r);o=r.nextToken();let t=J(r);o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for center point`),u.setCoords(e,t),o=r.nextToken(),d=r.currentInt32Value(),o=r.nextToken(),f=r.currentInt32Value(),o=r.nextToken(),o===4?p=!0:(p=!1,m=J(r),o=r.nextToken(),_=J(r),o=r.nextToken(),v=J(r),o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for curve parameters`)),a.segFlag=4}else if(c===`b`){for(let e=0;e<2;e++){o=r.nextToken(),o!==2&&h(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let t=J(r);o=r.nextToken();let n=J(r);o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for control point`),y[e].setCoords(t,n)}o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=2}else if(c===`n`){{o=r.nextToken(),o!==2&&h(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let e=J(r);o=r.nextToken();let t=J(r);o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for control point`),y[0].setCoords(e,t)}o=r.nextToken();let e=J(r);o=r.nextToken();let t=J(r);o=r.nextToken();let n=J(r);y[1].setCoords(e,t),y[2].setCoords(n,n),o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=8}else if(c===`q`){for(let e=0;e<1;e++){o=r.nextToken(),o!==2&&h(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let t=J(r);o=r.nextToken();let n=J(r);o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for control point`),y[e].setCoords(t,n)}o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=16}else{o=r.nextToken(),o!==2&&h(`failed to parse curve: start array is expected for interior point`),o=r.nextToken();let e=J(r);o=r.nextToken();let t=J(r);o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for interior point`),b.setCoords(e,t),o=r.nextToken(),o!==4&&h(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=4}return o=r.nextToken(),o!==3&&h(`failed to parse curve: end object is expected for curve`),c===`a`?(e.createEllipticArc(),p?Me(e.get(),n,l,u,!0,d,f):Ne(e.get(),n,l,u,d,f,m,_,v)):c===`b`?(e.createCubicBezier(),Pe(e.get(),n,l,y)):c===`n`?(e.createQuadraticRationalBezier(),Fe(e.get(),n,l,y[0],y[1].x,y[1].y,y[2].x)):c===`q`?(e.createQuadraticBezier(),e.get().construct(n,y[0],l)):(e.createEllipticArc(),Me(e.get(),n,l,b,!1,-1,-1)),a}function Me(e,t,n,r,i,a,o){e.dropAllAttributes();let s=new ArrayBuffer(20),c=new _e({sz:20,buffer:s}),l=0;c.writeDouble(l,r.x),l+=8,c.writeDouble(l,r.y),l+=8;let u=0;i?(o||(u|=8),a&&(u|=16)):u|=128,c.writeInt32(l,u),l+=4,De(e,t,n,c,0)}function Ne(e,t,n,r,i,a,o,s,c){e.dropAllAttributes();let l=new ArrayBuffer(44),u=new _e({sz:44,buffer:l}),d=0;u.writeDouble(d,r.x),d+=8,u.writeDouble(d,r.y),d+=8,u.writeDouble(d,o),d+=8,u.writeDouble(d,s),d+=8,u.writeDouble(d,c),d+=8;let f=0;a||(f|=2048),i&&(f|=4096),u.writeInt32(d,f),d+=4,Oe(e,t,n,u,0)}function Pe(e,t,n,r){e.dropAllAttributes();let i=new ArrayBuffer(32),a=new _e({sz:32,buffer:i}),o=0;a.writeDouble(o,r[0].x),o+=8,a.writeDouble(o,r[0].y),o+=8,a.writeDouble(o,r[1].x),o+=8,a.writeDouble(o,r[1].y),o+=8,ke(e,t,n,a,0)}function Fe(e,t,n,r,i,a,o){e.dropAllAttributes();let s=new ArrayBuffer(40),c=new _e({sz:40,buffer:s}),l=0;c.writeDouble(l,r.x),l+=8,c.writeDouble(l,r.y),l+=8,c.writeDouble(l,i),l+=8,c.writeDouble(l,a),l+=8,c.writeDouble(l,o),l+=8,Ae(e,t,n,c,0)}function Ie(e,t,n,r,i){let a=e.getGeometryType();if(a===p.enumEllipticArc)return Le(e,t,n,r,i);if(a===p.enumBezier)return Re(e,t,n,r,i);if(a===p.enumRationalBezier2)return ze(e,t,n,r,i);if(a===p.enumBezier2){let a=new se;return a.constructFromQuadraticSegment(e),Re(a,t,n,r,i)}S(``)}function Le(e,t,n,r,i){x(!B(e));let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;if(o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),e.isDegenerateToLine()||e.isDegenerate(0))return X(o,s,a.x,a.y,c,l,r,i),!0;let u=e.projectionBehavior()===0,d=!!u&&e.isClosed();if(u&&!d)i.startObject(),i.addFieldName(`c`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i),Z(e.m_interior.x,e.m_interior.y,17,i),i.endArray(),i.endObject();else if(u){i.startObject(),i.addFieldName(`a`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i),Z(e.m_center.x+0,e.m_center.y+0,17,i);let t=!e.isMajor();i.addInt32(t?1:0);let n=e.isClockwise();i.addInt32(n?1:0),i.endArray(),i.endObject()}else{i.startObject(),i.addFieldName(`a`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i);let t=e;Z(t.m_center.x,t.m_center.y,17,i);let n=!t.isMajor();i.addInt32(n?1:0);let u=t.isClockwise();i.addInt32(u?1:0),i.addDouble(t.m_rotation,17),i.addDouble(t.m_semiMajorAxis,17),i.addDouble(t.m_minorMajorRatio,17),i.endArray(),i.endObject()}return!1}function Re(e,t,n,r,i){let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;return o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName(`b`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i),Z(e.m_cp[0].x,e.m_cp[0].y,r,i),Z(e.m_cp[1].x,e.m_cp[1].y,r,i),i.endArray(),i.endObject(),!1}function ze(e,t,n,r,i){let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName(`n`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i),Z(e.m_cp.x,e.m_cp.y,r,i);let u=r;return i.addDouble(e.m_weights[0],u),i.addDouble(e.m_weights[1],u),i.addDouble(e.m_weights[2],u),i.endArray(),i.endObject(),!1}function X(e,t,n,r,i,a,o,s){s.startArray(),s.addDouble(n,o),s.addDouble(r,o),e&&s.addDouble(i,o),t&&s.addDouble(a,o),s.endArray()}function Z(e,t,n,r){r.startArray(),r.addDouble(e,n),r.addDouble(t,n),r.endArray()}var Be=class{getOperatorType(){return 10405}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,n,r,i,a){Ve(e,t,n,r)}exportSpatialReference(e,t,n,r){x(0)}exportProjectionTransformation(e,t,n,r){x(0)}exportDatumTransformation(e,t,n,r){x(0)}static geometryTypeToString(e){return x(0),``}};function Ve(e,t,n,r,i){if(t||n){if(r.startObject(),t!==null)switch(t.getGeometryType()){case p.enumPolygon:He(!0,e,t,r);break;case p.enumPolyline:He(!1,e,t,r);break;case p.enumMultiPoint:Ue(e,t,r);break;case p.enumPoint:We(e,t,r);break;case p.enumEnvelope:Ge(e,t,r);break;case p.enumMultipatch:x(0);break;default:_(`exportToJSON`)}n!==null&&(r.addFieldName(`spatialReference`),qe(e,n,r)),r.endObject()}}function He(e,t,n,r){let i=n.getImpl(),a=!!(2&t),o=!!(4&t),s=!!(8&t),c=i.hasAttribute(1)&&!a,l=i.hasAttribute(2)&&!o,u=i.hasAttribute(3)&&!s,d=i.hasNonLinearSegments();c&&(r.addFieldName(`hasZ`),r.addBool(!0)),l&&(r.addFieldName(`hasM`),r.addBool(!0)),e?d?r.addFieldName(`curveRings`):r.addFieldName(`rings`):d?r.addFieldName(`curvePaths`):r.addFieldName(`paths`);let f=null,p=[];if(n.isEmpty())r.startArray(),r.endArray();else{let e=17-(31&t>>13);r.startArray();let s=n.getPathCount(),m=0,h=i.getAttributeStreamRef(0),g=null,_=null,v=null,y=new ne,b=null,x=null,w=null;d&&(b=i.getSegmentFlagsStreamRef(),x=i.getSegmentIndexStreamRef(),w=i.getSegmentDataStreamRef()),c&&(g=i.getAttributeStreamRef(1)),l&&(_=i.getAttributeStreamRef(2)),u&&(v=i.getAttributeStreamRef(3),f=C(3,0));for(let t=0;t<s;t++){r.startArray(),u&&p.push(0);let i=n.getPathEnd(t);if(m===i){r.endArray();continue}let s=n.isClosedPath(t),d=h.read(2*m),C=h.read(2*m+1),T=c?g.read(m):NaN,E=l?_.read(m):NaN,D=u?v.read(m):0;Je(c,l,d,C,T,E,e,r);let O=1;u&&(f.add(D),p[p.length-1]++);let k=d,A=C,j=T,M=E,N=D,P=!1,F=0,I=NaN,L=NaN,R=0;for(let t=m+1,n=m,z=s?i+1:i;t<z;t++,n++){let s=b===null?1:31&b.read(n),m,z;if(t<i?(m=h.read(2*t),z=h.read(2*t+1),c&&(I=g.read(t)),l&&(L=_.read(t)),u&&(R=v.read(t))):(m=k,z=A,I=j,L=M,R=N),s!==1){P=!0,s===4?y.createEllipticArc():s===2?y.createCubicBezier():s===16?y.createQuadraticBezier():s===8?y.createQuadraticRationalBezier():S(`JSON export.unsupported curve`);let t=y.get(),i=x.read(n);t.setStartXYCoords(d,C),t.setEndXYCoords(m,z),c&&(t.setStartAttribute(1,0,T),t.setEndAttribute(1,0,I)),l&&(t.setStartAttribute(2,0,E),t.setEndAttribute(2,0,L)),t.readFromBufferStream(w,i),Ie(y.get(),a,o,e,r)&&F++}else Je(c,l,m,z,I,L,e,r);u&&(f.add(R),p[p.length-1]++),O++,d=m,C=z,T=I,E=L,D=R}P&&F===0||(O<2&&F<1&&(Je(c,l,d,C,T,E,e,r),O++,u&&(f.add(D),p[p.length-1]++)),s&&O<3&&F<2&&(Je(c,l,k,A,j,M,e,r),O++,d=k,C=A,T=j,E=M,D=N,u&&(f.add(N),p[p.length-1]++))),r.endArray(),m=i}r.endArray()}if(u){r.addFieldName(`ids`),r.startArray();let e=0;for(let t=0,n=p.length;t<n;++t){let n=p[t];x(n===0||f!==null&&e+n<=f.size()),r.startArray();for(let t=0;t<n;++t)r.addInt32(f.read(e)),e++;r.endArray()}r.endArray()}}function Ue(e,t,n){let r=t.getImpl(),i=r.hasAttribute(1)&&!(2&e),a=r.hasAttribute(2)&&!(4&e),o=r.hasAttribute(3)&&!(8&e);i&&(n.addFieldName(`hasZ`),n.addBool(!0)),a&&(n.addFieldName(`hasM`),n.addBool(!0)),n.addFieldName(`points`);let s=t.getPointCount();if(t.isEmpty())n.startArray(),n.endArray();else{let t=17-(31&e>>13);n.startArray();let o=r.getAttributeStreamRef(0),c=null,l=null;i&&(c=r.getAttributeStreamRef(1)),a&&(l=r.getAttributeStreamRef(2));for(let e=0;e<s;e++){let r=o.read(2*e),s=o.read(2*e+1),u=NaN,d=NaN;i&&(u=c.read(e)),a&&(d=l.read(e)),Je(i,a,r,s,u,d,t,n)}n.endArray()}if(o){let e=null;r.isEmpty()||(e=r.getAttributeStreamRef(3)),x(s===0||e!==null&&e.size()>=s),n.addFieldName(`ids`),n.startArray();for(let t=0;t<s;t++)n.addInt32(e.read(t));n.endArray()}}function We(e,t,n){let r=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),a=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return n.addFieldName(`x`),n.addNull(),n.addFieldName(`y`),n.addNull(),r&&(n.addFieldName(`z`),n.addNull()),i&&(n.addFieldName(`m`),n.addNull()),void(a&&(n.addFieldName(`id`),n.addInt32(0)));let o=17-(31&e>>13);n.addFieldName(`x`),n.addDouble(t.getX(),o),n.addFieldName(`y`),n.addDouble(t.getY(),o),r&&(n.addFieldName(`z`),n.addDouble(t.getZ(),o)),i&&(n.addFieldName(`m`),n.addDouble(t.getM(),o)),a&&(n.addFieldName(`id`),n.addInt32(t.getID()))}function Ge(e,t,n){let r=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),a=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return n.addFieldName(`xmin`),n.addNull(),n.addFieldName(`ymin`),n.addNull(),n.addFieldName(`xmax`),n.addNull(),n.addFieldName(`ymax`),n.addNull(),r&&(n.addFieldName(`zmin`),n.addNull(),n.addFieldName(`zmax`),n.addNull()),i&&(n.addFieldName(`mmin`),n.addNull(),n.addFieldName(`mmax`),n.addNull()),void(a&&(n.addFieldName(`idmin`),n.addInt32(0),n.addFieldName(`idmax`),n.addInt32(0)));let o=17-(31&e>>13);if(n.addFieldName(`xmin`),n.addDouble(t.getXMin(),o),n.addFieldName(`ymin`),n.addDouble(t.getYMin(),o),n.addFieldName(`xmax`),n.addDouble(t.getXMax(),o),n.addFieldName(`ymax`),n.addDouble(t.getYMax(),o),r){let e=t.queryInterval(1,0);n.addFieldName(`zmin`),n.addDouble(e.vmin,o),n.addFieldName(`zmax`),n.addDouble(e.vmax,o)}if(i){let e=t.queryInterval(2,0);n.addFieldName(`mmin`),n.addDouble(e.vmin,o),n.addFieldName(`mmax`),n.addDouble(e.vmax,o)}if(a){let e=t.queryInterval(3,0);n.addFieldName(`idmin`),n.addInt32(e.vmin),n.addFieldName(`idmax`),n.addInt32(e.vmax)}}function Ke(e,t,n){n.startObject();let r=t.getID();r<=0&&h(`cannot export unit that has no valid WKID`),n.addFieldName(`uwkid`),n.addInt32(r),n.endObject()}function qe(e,t,n){n.startObject();let r=0;t.isCustomWkid()||(r=t.getOldID());let i=0,a=t.getVCS();if(a!==null&&(a.isCustomWkid()||(i=a.getOldID()),i<=0&&(r=0)),r>0){n.addFieldName(`wkid`),n.addInt32(r);let e=t.getLatestID();if(e>0&&e!==r&&(n.addFieldName(`latestWkid`),n.addInt32(e)),i>0){n.addFieldName(`vcsWkid`),n.addInt32(i);let e=t.getLatestVerticalID();e!==i&&(n.addFieldName(`latestVcsWkid`),n.addInt32(e))}}if(t.getCoordinateSystemType()===0)n.addFieldName(`wkid`),n.addNull(),t.getUnit()!==null&&(n.addFieldName(`unit`),Ke(e,t.getUnit(),n));else if(r<=0||1&e){let r=``;64&e&&(r=t.getText2(),n.addFieldName(`wkt2`),n.addString(r));let i=t.getText();i!==r&&(n.addFieldName(`wkt`),n.addString(i))}if(16&e){let e=new V;t.queryPrecisionDescriptor(e),n.addFieldName(`xyTolerance`),n.addDouble(e.getTolerance(0)),n.addFieldName(`zTolerance`),n.addDouble(e.getTolerance(1)),n.addFieldName(`mTolerance`),n.addDouble(e.getTolerance(2)),n.addFieldName(`falseX`),n.addDouble(e.getFalseX()),n.addFieldName(`falseY`),n.addDouble(e.getFalseY()),n.addFieldName(`xyUnits`),n.addDouble(e.getGridUnitsXY()),n.addFieldName(`falseZ`),n.addDouble(e.getFalseZ()),n.addFieldName(`zUnits`),n.addDouble(e.getGridUnitsZ()),n.addFieldName(`falseM`),n.addDouble(e.getFalseM()),n.addFieldName(`mUnits`),n.addDouble(e.getGridUnitsM())}n.endObject()}function Je(e,t,n,r,i,a,o,s){s.startArray(),s.addDouble(n,o),s.addDouble(r,o),e&&s.addDouble(i,o),t&&s.addDouble(a,o),s.endArray()}var Q={s_a:97,s_A:65,s_asterisk:42,s_b:98,s_backslash:92,s_beginArray:91,s_beginObject:123,s_colon:58,s_period:46,s_comma:44,s_doubleQuote:34,s_endArray:93,s_endObject:125,s_e:101,s_E:69,s_f:102,s_F:70,s_forwardslash:47,s_minus:45,s_plus:43,s_n:110,s_N:78,s_r:114,s_t:116,s_u:117,s_zero:48,s_nine:57},Ye=class{constructor(e){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder(`utf-8`,{fatal:!0}),e===void 0?(this.m_startToken=2**53-1,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push(()=>this.accept_()),this.m_jsonString=null,this.m_bHasEscapes=!1):e.jsonString?this.resetParserFromString(e.jsonString):e.jsonStream?S(`streaming json parsing not yet impl`):_(`invalid constructor parameter`)}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(e){let t=this.m_jsonString?.slice(this.m_startToken,this.m_startToken+e-1);return this.m_endToken+=e-1,{s:t,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){S(`streaming json parsing not yet impl`)}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=2**53-1,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push(()=>this.start_()),this.m_pushPositions.length=0}resetParserFromString(e){this.reset_(),this.setStringFunctions_(),this.m_jsonString=e}resetParserFromStream(e){S(`streaming json parsing not yet impl`)}resetToPosition(e){return!!this.m_jsonString&&(this.m_endToken=e,this.m_startToken=Number.MAX_VALUE,this.m_currentTokenType=0,this.m_functionStack.length=0,e>=this.m_jsonString.length?(this.m_functionStack.push(()=>this.accept_()),!1):(this.m_functionStack.push(()=>this.start_()),!0))}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return x(0),``}childrenAsString(){return x(0),``}skipChildren(){this.skipChildren_()}skipChildren_(){if(this.m_currentTokenType===1){let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===1?e++:this.m_currentTokenType===3&&e--;while(this.m_currentTokenType!==3||e!==0);return}if(this.m_currentTokenType===2){let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===2?e++:this.m_currentTokenType===4&&e--;while(this.m_currentTokenType!==4||e!==0);return}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return`null`;case 11:return`true`;case 12:return`false`}h(`invalid token`)}toUTF8_(e,t){let n=0,r=e;for(;t.charCodeAt(r)===Q.s_backslash&&t.charCodeAt(r+1)===Q.s_u;)n++,r+=6;r=e;let i=new Uint8Array(n),a=0;for(;t.charCodeAt(r)===Q.s_backslash&&t.charCodeAt(r+1)===Q.s_u;)i[a++]=Number.parseInt(t.slice(r+2,r+6),16),r+=6;return{u8s:this.m_utf8Decoder.decode(i),end:r}}unquoteCurrentString_(){let e=``,t=1,n=this.m_endToken-this.m_startToken-1,r=0,i=this.m_getCurrentSubstr();for(let a=t;a<n;a++)if(i.charCodeAt(a)!==Q.s_backslash)r++;else{switch(r>0&&(e+=i.slice(t,t+r)),i.charCodeAt(++a)){case Q.s_doubleQuote:e+=`"`;break;case Q.s_u:{let{u8s:t,end:n}=this.toUTF8_(a-1,i);a=n-1,e+=t;break}case Q.s_backslash:e+=`\\`;break;case Q.s_forwardslash:e+=`/`;break;case Q.s_b:e+=`\b`;break;case Q.s_f:e+=`\f`;break;case Q.s_n:e+=`
`;break;case Q.s_r:e+=`\r`;break;case Q.s_t:e+=`	`}t=a+1,r=0}return r>0&&(e+=i.slice(t,t+r)),e}currentString(){return this.m_currentTokenType!==5&&this.m_currentTokenType!==6?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(this.m_currentTokenType!==7&&this.m_currentTokenType!==8&&this.m_currentTokenType!==9&&this.m_currentTokenType!==6&&this.m_currentTokenType!==10&&h(`invalid token`),this.m_currentTokenType===10)return NaN;let e=this.m_getCurrentSubstr(),t=this.m_endToken-this.m_startToken;if(this.m_currentTokenType===6){if(this.currentString()===`NaN`)return NaN;e=e.slice(1),t-=2,t===0&&h(`invalid token`)}let n=Number.parseFloat(e);if(this.m_currentTokenType===6)Number.isNaN(n)&&h(`invalid token`);else if(Number.isNaN(n))return NaN;return n}currentInt32Value(){this.m_currentTokenType!==8&&this.m_currentTokenType!==6&&h(`invalid token`);let e=this.m_getCurrentSubstr(),t=this.m_endToken-this.m_startToken;this.m_currentTokenType===6&&(e=e.slice(1),t-=2,t===0&&h(`invalid token`));let n=parseInt(e);return Number.isNaN(n)&&h(`invalid token`),n}currentInt64Value(){return x(0),0n}currentBoolValue(){return x(0),!1}isError(){return 0}JSONString(){return x(0),``}pushPosition(){return x(0),!1}popPosition(){return x(0),!1}skipCStyleComments_(){x(0)}skipCppStyleComments_(){x(0)}skipComments_(){this.m_prepSubstr();let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),e=this.m_peekChar(),e===Q.s_asterisk?this.skipCStyleComments_():e===Q.s_forwardslash?this.skipCppStyleComments_():h(`invalid token`)}skipWhiteSpace_(){let e;do{this.m_eof()&&h(`invalid token`);let t=this.m_peekChar();for(;t>=9&&t<=13||t===32;)this.m_increment(),this.m_eof()&&h(`invalid token`),t=this.m_peekChar();t===Q.s_forwardslash?(this.m_startToken=this.m_endToken,e=!0,this.skipComments_()):e=!1}while(e)}rightBracket_(){return this.m_peekChar()===Q.s_endArray&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===Q.s_endObject&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&h(`invalid token`);let e=this.m_peekChar();for(;e!==Q.s_doubleQuote;){let t=e===Q.s_backslash;if(this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),e=this.m_peekChar(),t)if(this.m_bHasEscapes=!0,e===Q.s_doubleQuote||e===Q.s_backslash||e===Q.s_forwardslash||e===Q.s_b||e===Q.s_f||e===Q.s_n||e===Q.s_r||e===Q.s_t)this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),e=this.m_peekChar();else if(e===Q.s_u)for(let t=0;t<4;t++)this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),e=this.m_peekChar(),e>=Q.s_zero&&e<=Q.s_nine||e>=Q.s_a&&e<=Q.s_f||e>=Q.s_A&&e<=Q.s_F||h(`invalid token`);else h(`invalid token`)}this.m_stepOverChar()}comma_(){return this.m_peekChar()===Q.s_comma&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===Q.s_colon&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):h(`invalid token`)}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==Q.s_doubleQuote&&h(`invalid token`),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push(()=>this.fieldNameEnd_())}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():h(`invalid token`)}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push(()=>this.elementEnd_()),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():h(`invalid token`)}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push(()=>this.pairEnd_()),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push(()=>this.objectStart_())}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push(()=>this.arrayStart_())}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()===Q.s_zero?this.m_stepOverChar():this.digits_()}digits_(){let e=this.m_peekChar();do this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),e=this.m_peekChar();while(e>=Q.s_zero&&e<=Q.s_nine)}frac_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),e=this.m_peekChar(),e>=Q.s_zero&&e<=Q.s_nine||h(`invalid token`),this.digits_()}exp_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),e=this.m_peekChar(),e!==Q.s_plus&&e!==Q.s_minus||(this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),e=this.m_peekChar()),e>=Q.s_zero&&e<=Q.s_nine||h(`invalid token`),this.digits_()}valueNumber_(){this.m_prepSubstr();let e=!1,t=this.m_peekChar();if(t===Q.s_minus?(this.m_stepOverChar(),this.m_eof()&&h(`invalid token`),t=this.m_peekChar(),e=!0,t>=Q.s_zero&&t<=Q.s_nine||h(`invalid token`),this.int_()):this.int_(),t=this.m_peekChar(),t===Q.s_period)this.m_currentTokenType=7,this.frac_(),t=this.m_peekChar(),t!==Q.s_e&&t!==Q.s_E||this.exp_();else if(t===Q.s_e||t===Q.s_E)this.m_currentTokenType=7,this.exp_();else{let t=0;e&&t++;let n=this.m_endToken-this.m_startToken-t;if(n<10)this.m_currentTokenType=8;else if(n===10){let n=this.m_getCurrentSubstr();e?n.slice(t)<=`2147483648`?this.m_currentTokenType=8:this.m_currentTokenType=9:n.slice(t)<=`2147483647`?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(n<19)this.m_currentTokenType=9;else if(n===19){let n=this.m_getCurrentSubstr();e?n.slice(t)<=`9223372036854775808`?this.m_currentTokenType=9:this.m_currentTokenType=7:n.slice(t)<=`9223372036854775807`?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){let{s:e,bDone:t}=this.m_get(5);t&&h(`invalid token`),e!==`null`&&h(`invalid token`),this.m_currentTokenType=10}valueTrue_(){let{s:e,bDone:t}=this.m_get(5);t&&h(`invalid token`),e!==`true`&&h(`invalid token`),this.m_currentTokenType=11}valueFalse_(){let{s:e,bDone:t}=this.m_get(6);t&&h(`invalid token`),e!==`false`&&h(`invalid token`),this.m_currentTokenType=12}valueNan_(){let{s:e,bDone:t}=this.m_get(4);t&&h(`invalid token`),e!==`NaN`&&h(`invalid token`),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;let e=this.m_peekChar();e===Q.s_beginObject?this.valueStartObject_():e===Q.s_beginArray?this.valueStartArray_():e===Q.s_doubleQuote?this.valueString_():e===Q.s_minus||e>=Q.s_zero&&e<=Q.s_zero+9?this.valueNumber_():e===Q.s_n?this.valueNull_():e===Q.s_t?this.valueTrue_():e===Q.s_f?this.valueFalse_():e===Q.s_N?this.valueNan_():h(`invalid token`)}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push(()=>this.accept_());let e=this.m_peekChar();e!==Q.s_beginObject&&e!==Q.s_beginArray&&h(`invalid token`),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}},Xe=class{getOperatorType(){return 10404}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,n,r,i,a,o){let s;typeof n==`string`?(s=new Ye({jsonString:n}),s.nextToken()):s=n,s.currentToken()!==1&&h(`failed to import map geometry: start of object is expected`);let c=ve(t,e,s,r,i);return new N(c)}importSpatialReference(e){let t=be(e);return t===null&&_(`failed to import spatial reference`),t}importProjectionTransformation(e,t){return x(0),{}}importDatumTransformation(e,t){return x(0),{}}static stringToGeometryType(e){return(e=e.toLowerCase()).startsWith(`esrigeometry`)||h(`string_to_geometry_type`),e.endsWith(`point`)?p.enumPoint:e.endsWith(`envelope`)?p.enumEnvelope:e.endsWith(`multipoint`)?p.enumMultiPoint:e.endsWith(`polyline`)?p.enumPolyline:e.endsWith(`polygon`)?p.enumPolygon:void h(`string_to_geometry_type`)}},$=new ge,Ze=new Be,Qe=new Xe;function $e(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference}function et(n,i=!1){if(!i&&(t(n)||s(n)||e(n)||r(n))){let e=new N;return e.setGeometry(de(le(n))),e}let a=new he(n,{strict:!1});return a.nextToken(),Qe.execute(0,p.enumUnknown,a,!0,!1)}function tt(e){let t=null;return[e.map(e=>{if(t==null){let n=nt(e);return t=n.getSpatialReference(),n.getGeometry()}return rt(e)}),t]}function nt(e){let t=et(e),n=at(e.spatialReference);return n&&t.setSpatialReference(n),t}function rt(e){return et(e).getGeometry()}function it(e){return et(e,!0).getGeometry()}function at(e){if(e==null)return null;let t=!1;if(e instanceof n){let{wkt2:n}=e;e=e.toJSON(),e.wkt2??=n,t=!0}(e.latestVcsWkid||e.vcsWkid)&&(t||(e={...e}),delete e?.latestVcsWkid,delete e?.vcsWkid);let r=new he(e,{strict:!1});r.nextToken();let i=Qe.importSpatialReference(r);return i.getCoordinateSystemType()===0?null:i}function ot(e,t){if(e instanceof N&&(t=e.getSpatialReference(),e=e.getGeometry()),e==null||e.isEmpty())return null;let n;switch(e.getGeometryType()){case p.enumPoint:case p.enumMultiPoint:case p.enumPolyline:case p.enumPolygon:n=ue(e)}if(n){let e=q(n);return e.spatialReference=st(t),e.spatialReference??delete e.spatialReference,e}return $.reset(),Ze.execute(0,e,t??null,$),$.getObject()}function st(e){return e==null||e.getCoordinateSystemType()===0?null:($.reset(),Ze.execute(0,null,e,$),$.getObject().spatialReference)}export{rt as a,st as c,$e as i,it as n,nt as o,tt as r,ot as s,at as t};