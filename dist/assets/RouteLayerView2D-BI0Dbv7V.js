const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RouteLayerInteraction-CvU1mMP-.js","assets/index-CzMixifc.js","assets/index-CDgdHpAj.css","assets/earcut-CsNwSYFA.js","assets/geodeticAreaOperator-Csb55Hyk.js","assets/geodeticCurveType-B3tSXlNQ.js","assets/geodeticLengthOperator-BOd67Z-X.js","assets/ObjectStack-DiVLRoBj.js","assets/vectorStacks-BQiry9fn.js","assets/quatf64-eO7UAs9K.js","assets/vec3-D7a6REBc.js","assets/sphere-DkSdrT5o.js","assets/plane--nqwMDYx.js","assets/ray-XqUMyuyU.js","assets/elevationInfoUtils-BcUBf70F.js","assets/quantity-DI5We-W2.js","assets/geodesicUtils-DoIAZh7n.js","assets/projectPointToVector-D72S8Uh5.js","assets/projectVectorToVector-CZxjcyx6.js","assets/dehydratedPoint-CVzHYxaL.js","assets/spatialReferenceEllipsoidUtils-b6wDfyu0.js","assets/lineSegment-WEn1ku7V.js","assets/triangle-B4dfMIWc.js","assets/GraphicsLayer-CSZ-X1QF.js","assets/Stop-DrRRdYO-.js","assets/networkEnums-B1KLygK2.js","assets/SketchViewModel-Dri-bLEj.js","assets/isSupportedObject-B58JKqS1.js","assets/layerUtils-CCmUM-i4.js","assets/SketchOptions-CQ-6mB9z.js","assets/LineSnappingHint-C4TfMb_L.js","assets/ParallelSnappingHint-V0i1PzO4.js","assets/DrapedEdgeSnappingCandidate-yTm_e8W9.js","assets/constraints-CZ12pnWC.js","assets/EdgeSnappingCandidate-CRqUhTG1.js","assets/SnappingCandidate-CgOYxD9J.js","assets/IntersectionSnappingCandidate-CEWLdgd3.js","assets/IntersectionSnappingHint-GxnfNu8X.js","assets/LineSnappingCandidate-DrfbJnwY.js","assets/RightAngleTriangleSnappingCandidate-BnNMDbkx.js","assets/RightAngleSnappingHint-DDG9ajUd.js","assets/viewUtils-BjnASAVJ.js","assets/viewUtils-D2qwRYoF.js","assets/snappingUtils-BVQZFw4z.js","assets/euclideanLengthMeasurementUtils-D4gy5vyI.js","assets/hitTestSelectUtils-B7XlogWA.js"])))=>i.map(i=>d[i]);
import{BS as e,DT as t,JE as n,OT as r,WT as i,Y_ as a,ev as o,gD as s,iv as c,nv as l,rv as u}from"./index-CzMixifc.js";import"./memoryEstimations-C3WUBUZI.js";import"./OptimizedGeometry-5fDazGe-.js";import"./OptimizedFeatureSet-D4F9ObY_.js";import"./featureConversionUtils-VvJ2pauf.js";import"./streamLayerUtils-82UmlW-3.js";import"./QueueProcessor-CbN5H2eO.js";import"./earcut-CsNwSYFA.js";import"./layerViewUtils-Cbrog-dU.js";import"./colorUtils-Btp0B-0Y.js";import"./networkEnums-B1KLygK2.js";import"./timeSupport-CjNpK2fD.js";import"./queryUtils-fxq7u50x.js";import"./quantizationUtils-CzrQVcZ1.js";import"./normalizeUtilsSync-DZGX2pCO.js";import{i as d,r as f,t as p}from"./RouteInfo-md16iZiM.js";import{i as m,n as h,r as g,t as _}from"./Stop-DrRRdYO-.js";import"./GeometryUtils-C6BJBMi9.js";import"./VertexAttributeLocations-DOYYzMyn.js";import"./VertexElementDescriptor-C9CNG143.js";import"./labelPoint-D95l1mBc.js";import"./callExpressionWithCursor-NwM51lOx.js";import"./FeatureMetadata-DVsh91f_.js";import"./CIMSymbolHelper-CIzDgFQE.js";import"./rasterizingUtils-L-rXtdWe.js";import"./Rect-BMNJQxpm.js";import"./BoundingBox-CW0_Ka-z.js";import"./BidiEngine-CpIovbIK.js";import"./callExpressionWithFeature-jAwzgzDm.js";import"./OverrideHelper-Catw08-A.js";import"./FeatureCommandQueue-Ccv3I5Xd.js";import"./config-BY05DP3l.js";import"./dehydratedFeatureComparison-DeSHk9xR.js";import"./WGLContainer-v9ak9x06.js";import"./utils-CPFnbOXo.js";import"./ProgramTemplate-DXigF9DQ.js";import"./VertexArrayObject-BCHCoUBc.js";import"./BufferObject-DizvMSTk.js";import"./VertexBuffer-Dhf7DMaS.js";import"./vec3f32-BWuLbfSR.js";import"./Container-s63aPbsG.js";import"./GraphShaderModule-KXpa7jQA.js";import"./FramebufferObject-E0PFfPHi.js";import"./ShaderBuilder-Dbc4jYz7.js";import{t as v}from"./LayerView2D-BLVA9W76.js";import{t as y}from"./LayerView-BKgBHcbR.js";import"./UpdateTracking2D-BQFl9U6T.js";import"./TechniqueInstance-B2WffE-f.js";import"./TileContainer-CdHqIsYl.js";import"./constants-TfCITEY_.js";import"./utils-Cp6QQbUU.js";import{t as b}from"./highlightOptionsUtils-C-mZET-I.js";import"./AGraphicContainer-DjhIZWU6.js";import{t as x}from"./GraphicContainer-C207Aol3.js";import"./ComputedAttributeStorage-D3juJH-7.js";import{t as S}from"./GraphicsView2D-y5Ereu1j.js";import"./dehydratedFeatures-Db6Q9NQd.js";var C=[`route-info`,`direction-line`,`direction-point`,`polygon-barrier`,`polyline-barrier`,`point-barrier`,`stop`],w={graphic:null,property:null,oldValue:null,newValue:null};function T(e){return e instanceof d||e instanceof f||e instanceof m||e instanceof g||e instanceof h||e instanceof p||e instanceof _}function E(e){return c.isCollection(e)&&e.length&&T(e.at(0))}function D(e){return Array.isArray(e)&&e.length>0&&T(e[0])}var O=class extends v(y){constructor(){super(...arguments),this._graphics=new c,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map,this._interaction=null,this._loadInteractionPromise=null,this.interactive=!1}get _routeItems(){return new a({getCollections:()=>this.layer&&!this.destroyed?[this.layer.routeInfo?new c([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]:[]})}initialize(){this.addHandles(l(()=>{let{interactive:e,suspended:t}=this;return{interactive:e,suspended:t}},({interactive:e,suspended:t})=>{let n=e&&!t;n&&this._getInteractionLoadPromise().then(e=>{e.enabled=this.interactive&&!this.suspended}),this._interaction&&(this._interaction.enabled=n)},u)),this._updatingHandles.addOnCollectionChange(()=>this._routeItems,e=>this._routeItemsChanged(e),o)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get(`_routeItems`)?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView(),this._interaction?.enabled&&(this._interaction.enabled=!1)}get selectedNetworkFeatures(){return this._interaction?.selectedNetworkFeatures??null}async create(e){if(this.interactive)return(await this._getInteractionLoadPromise()).create(e)}async fetchPopupFeaturesAtLocation(e,t){return this._graphicsView.hitTest(e).filter(({popupTemplate:e})=>!!e)}highlight(e,t){let r;r=T(e)?[this._getNetworkFeatureUid(e)]:D(e)?e.map(e=>this._getNetworkFeatureUid(e)):E(e)?e.map(e=>this._getNetworkFeatureUid(e)).toArray():[e.uid];let a=r.filter(n);if(!a.length)return i();let o=b(t);return this._addHighlights(a,o),i(()=>this._removeHighlights(a,o))}async hitTest(e,t){if(this.suspended)return null;let r=this._graphicsView.hitTest(e).filter(n).map(e=>this._networkGraphicMap.get(e));if(!r.length)return null;let{layer:i}=this;return r.reverse().map(t=>({type:`route`,layer:i,mapPoint:e,networkFeature:t}))}isUpdating(){return this._graphicsView.updating}moveEnd(){}remove(e){this._interaction?.remove(e)}update(e){this._graphicsView.processUpdate(e)}viewChange(){this._graphicsView.viewChange()}_createGraphic(e){let t=e.toGraphic();return t.layer=this.layer,t.sourceLayer=this.layer,t}_createGraphicsView(){let e=this.view,t=()=>this.requestUpdate(),n=new x(e.featuresTilingScheme);this._graphicsView=new S({container:n,graphics:this._graphics,requestUpdateCallback:t,view:e}),this.container.addChild(n),this._processHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(e){let t=this._networkGraphicMap.get(e);return C.indexOf(t.type)}_getInteractionLoadPromise(){return this._loadInteractionPromise||(this._loadInteractionPromise=this._loadInteraction(),this._updatingHandles.addPromise(this._loadInteractionPromise)),this._loadInteractionPromise}_getNetworkFeatureUid(e){return this._networkFeatureMap.has(e)?this._networkFeatureMap.get(e).uid:null}async _loadInteraction(){let{layer:t,view:n}=this,{RouteLayerInteraction:r}=await e(async()=>{let{RouteLayerInteraction:e}=await import(`./RouteLayerInteraction-CvU1mMP-.js`);return{RouteLayerInteraction:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]));return this._interaction=new r({view:n,layer:t}),this._interaction}_routeItemsChanged(e){if(e.removed.length){this._graphics.removeMany(e.removed.map(e=>{let t=this._networkFeatureMap.get(e);return this._networkFeatureMap.delete(e),this._networkGraphicMap.delete(t),t}));for(let t of e.removed)this.removeHandles(t)}if(e.added.length){this._graphics.addMany(e.added.map(e=>{let t=this._createGraphic(e);return t.symbol==null?null:(this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),t)}).filter(n));for(let t of e.added)this.addHandles([l(()=>t.geometry,(e,n)=>{this._updateGraphic(t,`geometry`,e,n)}),l(()=>t.symbol,(e,n)=>{this._updateGraphic(t,`symbol`,e,n)}),l(()=>t.popupTemplate,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).popupTemplate=e)}),l(()=>t.toGraphic().attributes,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).attributes=e)})],t);this._graphics.sort((e,t)=>this._getDrawOrder(e)-this._getDrawOrder(t))}}_updateGraphic(e,t,n,r){if(!this._networkFeatureMap.has(e)){let t=this._createGraphic(e);this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),this._graphics.add(t);return}let i=this._networkFeatureMap.get(e);i[t]=n,w.graphic=i,w.property=t,w.oldValue=r,w.newValue=n,this._graphicsView.graphicUpdateHandler(w)}_processHighlight(){let e=this._getHighlights();this._graphicsView?.setHighlight(e)}};s([t()],O.prototype,`_routeItems`,null),s([t()],O.prototype,`_interaction`,void 0),s([t()],O.prototype,`interactive`,void 0),s([t({readOnly:!0})],O.prototype,`selectedNetworkFeatures`,null),O=s([r(`esri.views.2d.layers.RouteLayerView2D`)],O);var k=O;export{k as default};