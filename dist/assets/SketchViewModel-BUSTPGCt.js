const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SelfSnappingEngine-CSogHo4n.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/ObjectStack-l5kM7JZu.js","assets/vectorStacks-Cuo89CNO.js","assets/quatf64-D37SEdPg.js","assets/vec3-B94Y7ih2.js","assets/sphere-d9-4vNcj.js","assets/plane-Da5EsY0J.js","assets/ray-LkJ58wpZ.js","assets/memoize-Dl61_jt0.js","assets/quantity-Co6flzuS.js","assets/geodesicUtils-D99LxQ6q.js","assets/projectPointToVector-BkRdoTqD.js","assets/projectVectorToVector-DGzn2p7I.js","assets/dehydratedPoint-CWZQBefp.js","assets/elevationInfoUtils-uoMH3ofe.js","assets/viewUtils-H4dpIyqQ.js","assets/constraints-Ch5tsKD8.js","assets/LineSnappingHint-CmFAetWF.js","assets/ParallelSnappingHint-CVYaPm-q.js","assets/LineSnappingCandidate-BNbhbOGH.js","assets/SnappingCandidate-DueCLuvH.js","assets/RightAngleTriangleSnappingCandidate-CqVuCsko.js","assets/RightAngleSnappingHint-tXLlHR_t.js","assets/viewUtils-GR2hLWLo.js","assets/snappingUtils-D3oTIKrZ.js","assets/angularMeasurementUtils-DQYnovl-.js","assets/GridSnappingEngine-B6ykT_KH.js","assets/gridUtils-951JUSRu.js","assets/IntersectionSnappingCandidate-C2uVyhEk.js","assets/IntersectionSnappingHint-CvQZ8eWi.js","assets/FeatureSnappingEngine-C5ee4UCl.js","assets/mapCollectionUtils-CMweJs6i.js","assets/floorFilterUtils-CPLVKkMB.js","assets/DrapedEdgeSnappingCandidate-CqXt8QLN.js","assets/EdgeSnappingCandidate-CCg5Xb97.js","assets/layerViewUtils-CJcMVuwG.js","assets/geometryEngine-oeRdEJ9p.js","assets/_commonjsHelpers-YBF0zzdz.js","assets/geometryEngineBase-tEU0133Y.js","assets/editingTools-CYJrF2TC.js","assets/editPlaneUtils-DwX4f2SP.js","assets/boundedPlane-DKHNKWJN.js","assets/lineSegment-BudcKS0C.js","assets/ReactiveSet-CN-U9t41.js","assets/createUtils-BVlp8HHH.js","assets/distanceOperator-Cfhn9VMw.js","assets/Distance2DCalculator-CXhBP-8I-CYkwuMp9.js","assets/SpatialReference-CfUjvF_j.js","assets/Envelope2D-B7gkUj4e.js","assets/Point2D-DJueHbCy.js","assets/OperatorDefinitions-C5Pat-Jx.js","assets/SimpleGeometryCursor-BILtMaQf.js","assets/Transformation2D-D07KwcEj.js","assets/apiConverter-Dsm0pxcs.js","assets/jsonConverter-CoA5-zxu.js","assets/FlatGeometry-BsPiiSVP.js","assets/memoryEstimations-D_IbKyOk.js","assets/OptimizedGeometry-BQJ7w5VU.js","assets/simplifyOperator-C6TgASU6.js","assets/operatorSimplify-BCW0XIAz.js","assets/quat-C8PgLo31.js","assets/rotate-Drb-fn66.js","assets/quantityFormatUtils-DorrZj0i.js","assets/unitFormatUtils-DIX5VDC2.js","assets/MeshTransform-BaPjlQwH.js","assets/axisAngleDegrees-DzAS4tF-.js","assets/meshVertexSpaceUtils-s2jLb8qI.js","assets/MeshLocalVertexSpace-vomIk0sx.js","assets/getDefaultUnitForView-DyZIV1hK.js","assets/GraphicsLayer-DBcl42yN.js","assets/dehydratedFeatureComparison-BCFMkftR.js","assets/hydratedFeatures-Cf3ay5ZM.js","assets/drapedUtils-BaZZPZSM.js","assets/SnappingContext-CJ1Obe6m.js","assets/curveOperationUtils-CjGTFE3v.js","assets/PointSnappingHint-F2JtYtXH.js","assets/euclideanLengthMeasurementUtils-CvEUUrXw.js","assets/spatialReferenceEllipsoidUtils-qw9wv8RL.js","assets/SketchOptions-DjwJVzbR.js","assets/colorUtils-CzajW9E7.js","assets/cimSymbolUtils-CLt57XQ8.js","assets/SnappingVisualizer2D-DBg2fFdu.js","assets/drawUtils-BUBS53Cs.js","assets/hitTestSelectUtils-DrV1belT.js","assets/editingTools-Ba1hBSc8.js","assets/ColorMaterial.glsl-Bt7WM1mm.js","assets/Transform.glsl-2U1BxklA.js","assets/Float2BindUniform-D7Jg9GMR.js","assets/Uniform-C_fuiTP5.js","assets/FloatBindUniform-CXY5KrrB.js","assets/glsl-BMw-Ib6r.js","assets/NoParameters-BDE7RvXT.js","assets/Slice.glsl-DU3Ivhcc.js","assets/Float3DrawUniform-ua6q6ZtZ.js","assets/VisualVariables.glsl-1DqsizMu.js","assets/FloatsPassUniform-DKsLDw29.js","assets/AlphaCutoff-WIqqBGOV.js","assets/HighlightReadBitmap.glsl-BBr-esSE.js","assets/Texture2DBindUniform-Btzx3XRx.js","assets/Float3PassUniform-SaBA6LBM.js","assets/Float4PassUniform-C4TO8dd0.js","assets/ObjectAndLayerIdColor.glsl-BHzrt-xI.js","assets/VertexColor.glsl-_MhPfHih.js","assets/TerrainDepthTest.glsl-D7e23Ppb.js","assets/ReadDepth.glsl-CX2bpX_x.js","assets/View.glsl-CPcmVaet.js","assets/Float3BindUniform-BDFedz_d.js","assets/Matrix4BindUniform-D7U89BGU.js","assets/OutputColorHighlightOLID.glsl-CoP020fC.js","assets/Emissions.glsl-C_Yvv-sZ.js","assets/FloatPassUniform-CSAt82xV.js","assets/Texture2DDrawUniform-jqrXjxoW.js","assets/Texture2DPassUniform-DFWoDpEL.js","assets/ShaderBuilder-BLOqjpgt.js","assets/Compositing.glsl-DXXOoKEp.js","assets/ScreenSpacePass.glsl-QJ_LkLYn.js","assets/HUDMaterial.glsl-CIbE2wvS.js","assets/HUDVisibility.glsl-DO8Yaq72.js","assets/VerticalOffset.glsl-VrGhTlbS.js","assets/ScreenSizePerspective.glsl-BuhoSJZ3.js","assets/BooleanBindUniform-Dgbi5WXL.js","assets/Float4BindUniform-DpoBnM9l.js","assets/Float2PassUniform-DUyrQoTC.js","assets/HighlightApply.glsl-C2uw2Uqi.js","assets/HighlightDownsample.glsl-CHTjOIMl.js","assets/HighlightCellGridScreenSpacePass.glsl-BYepSulG.js","assets/IntegerPassUniform-CdQB44QJ.js","assets/Float2DrawUniform-3WoZLC1o.js","assets/HighlightBlur.glsl-Bcasx3G3.js","assets/HighlightToSingle.glsl-DnQ7SOsv.js","assets/ImageMaterial.glsl-C3rXb5wK.js","assets/LaserlinePath.glsl-CcRQQ4A2.js","assets/Laserline.glsl-BfjsQ-Vb.js","assets/CameraSpace.glsl-BqHBV5nH.js","assets/Matrix4PassUniform-CDJEQqiQ.js","assets/Laserlines.glsl-QkQmGFOA.js","assets/OverlayCompositing.glsl-qGsngx-I.js","assets/RibbonLine.glsl-CfmEn9-p.js","assets/MarkerSizing.glsl-nslzooYm.js","assets/PiUtils.glsl-IDKkXUQy.js","assets/ShadedColorMaterial.glsl-CvbaQaix.js","assets/SlicePlaneMaterial.glsl-Du0SvbBw.js","assets/TextureOnly.glsl-DvvGRcsb.js","assets/SceneLighting-LJvcoD7s.js","assets/frustum-LgSQ4wIS.js","assets/orientedBoundingBox-Bd4igSGQ.js","assets/computeTranslationToOriginAndRotation-0WDVmpJG.js","assets/HUDIntersectorResult-C5AENPbM.js","assets/VertexAttributeLocations-BScEla0R.js","assets/VertexElementDescriptor-Cl_nC_ty.js","assets/renderState-BaFdYDAL.js","assets/earcut-CEMcWA4Z.js","assets/NestedMap-BpsBVffk.js","assets/vec3f32-DDMWoxUL.js","assets/RenderCoordsHelper-Bnx1ecmY.js","assets/graphicUtils-Ct1OT6JD.js","assets/FloatArray-Dt98pDp2.js","assets/BufferView-BW77W5ev.js","assets/Util-BQgFCZvD.js","assets/types-BEunqM4i.js","assets/Indices-tJiSUK6w.js","assets/DefaultBufferWriter-BGKzMKkp.js","assets/triangle-46ad8nAb.js","assets/MaterialUtil-CcE5uVnF.js","assets/SegmentLabels-DAtgpVzT.js","assets/deduplicate-D-tDe87s.js","assets/triangulationUtils-DNxIB1ux.js","assets/videoUtils-CRYmuPNe.js","assets/ManagedTexture-DgNSfAYU.js","assets/image-CmtRVQsT.js","assets/utils-BGjabRH0.js","assets/DefaultLayouts-D2eBAPD-.js","assets/weather-D4qJROgB.js","assets/ElevationContext-BzXFRbX1.js","assets/Octree-czER3kAP.js","assets/TextureBackedBufferLayout-C3PSJOOo.js","assets/BufferObject-B3_aJU6V.js","assets/VertexArrayObject-ChtD6bwg.js","assets/VertexBuffer-Ra4pb4dR.js","assets/isSupportedObject-CnaOA-Ng.js","assets/SelectedVertexTooltipInfo-BFQFy4wV.js","assets/sdfPrimitives-BR6xMvJc.js","assets/ExtentScaleTooltipInfo-Ck2BWdDe.js","assets/TranslateTooltipInfo-_IhWPH6-.js","assets/GraphicsLayerView3D-DDVqxJfv.js","assets/DefaultMaterial.glsl-pmrJSA2T.js","assets/ReadShadowMap.glsl-DMCvezCI.js","assets/MixExternalColor.glsl-D0GjeJQe.js","assets/SnowCover.glsl-DvDl-UAS.js","assets/SSAO.glsl-xhx5R_Qb.js","assets/SSAOBlur.glsl-C8iS6qjP.js","assets/Normals.glsl-Dm_iDce_.js","assets/LineCallout.glsl-D6ln7DXm.js","assets/RealisticTree.glsl-DAC1hFJj.js","assets/PooledRBush-BH7_Gu1G.js","assets/OptimizedFeatureSet-CLjmRHYn.js","assets/optimizedFeatureQueryEngineAdapter-DQyaY_b1.js","assets/dehydratedFeatures-D5ZOMtMh.js","assets/featureConversionUtils-o9-cJXzl.js","assets/pointUtils-BP9nRZeK.js","assets/primitiveObjectSymbolUtils-fz701Tc0.js","assets/Intersector-DL9RPLNy.js","assets/symbolColorUtils-KqO0oQTm.js","assets/DefaultMaterial-BVbzHMdq.js","assets/LayerView-DQaVI2FN.js","assets/popupUtils-z3ynpNjO.js","assets/highlightOptionsUtils-DmkXKeuF.js","assets/GraphicMover-BJk1rYvZ.js","assets/GraphicMover-C6nMhwuQ.js","assets/layerUtils-BZgsYerz.js","assets/Box-mqxLebif.js","assets/settings-D0ZT6y9O.js","assets/Reshape-BONCTV-_.js","assets/devEnvironmentUtils-Yxtjm7qW.js","assets/symbolUtils-tTcNtU7T.js","assets/webStyleSymbolUtils-DnfhffQg.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,AS as n,Ah as r,Aw as i,Ay as a,BT as o,Bl as s,CE as c,Fg as l,Fl as u,Hd as d,Id as f,Kg as p,Ld as m,Pd as h,Rd as g,Rg as ee,Rl as _,Sg as te,TT as ne,VT as v,Vd as re,Vg as ie,aT as ae,af as oe,cE as y,cd as b,cv as se,fD as ce,fT as le,fv as ue,gS as de,gT as fe,hv as x,jT as S,kD as C,lE as pe,lv as me,mT as he,mv as w,ng as T,ny as ge,od as _e,pT as ve,pv as E,rS as ye,rd as be,sD as xe,uv as Se,vv as Ce,wg as we,y_ as D,zg as Te,zv as Ee}from"./index-BN8X5Ryz.js";import{i as De,r as Oe}from"./geodeticAreaOperator-B2LzXjd-.js";import{i as ke,r as Ae}from"./geodeticLengthOperator-BdZS0ajo.js";import{t as je}from"./earcut-CEMcWA4Z.js";import{b as Me,p as Ne,v as Pe,x as Fe}from"./plane-Da5EsY0J.js";import{t as Ie}from"./projectVectorToVector-DGzn2p7I.js";import{m as Le}from"./elevationInfoUtils-uoMH3ofe.js";import{t as Re}from"./GraphicsLayer-DBcl42yN.js";import{n as O,s as k}from"./quantity-Co6flzuS.js";import{a as ze,n as Be,o as Ve,r as He}from"./geodesicUtils-D99LxQ6q.js";import{t as Ue}from"./isSupportedObject-CnaOA-Ng.js";import{r as We}from"./layerUtils-BZgsYerz.js";import{i as Ge,n as Ke,r as qe,t as Je}from"./SketchOptions-DjwJVzbR.js";import{f as Ye,g as Xe,p as A}from"./LineSnappingHint-CmFAetWF.js";import{n as j}from"./ParallelSnappingHint-CVYaPm-q.js";import{l as Ze,r as Qe,s as $e}from"./snappingUtils-D3oTIKrZ.js";import{t as et}from"./EdgeSnappingCandidate-CCg5Xb97.js";import{t as tt}from"./DrapedEdgeSnappingCandidate-CqXt8QLN.js";import{t as M}from"./IntersectionSnappingCandidate-C2uVyhEk.js";import{t as nt}from"./LineSnappingCandidate-BNbhbOGH.js";import{n as rt,t as it}from"./RightAngleTriangleSnappingCandidate-CqVuCsko.js";import{n as at,t as ot}from"./viewUtils-GR2hLWLo.js";import{a as st,c as ct,i as lt,n as ut,u as dt}from"./euclideanLengthMeasurementUtils-CvEUUrXw.js";import{n as ft}from"./triangle-46ad8nAb.js";import{t as pt}from"./hitTestSelectUtils-DrV1belT.js";function mt(e){switch(e){case 0:break;case 1:return`not owned by a graphics layer`;case 2:return`no geometry`;case 3:return`the geometry type is not supported`;case 4:return`the symbol type is not supported`}return``}function ht(e){return gt(e).result}function gt(e){if(e.graphic&&e.graphic.layer?.type!==`graphics`)return{result:1};if(!e.operations)return{result:2};let t=e.operations.data.type,n=e.operations.data.geometry;return t===`point`||t===`mesh`||t===`polyline`||t===`polygon`?{result:0,geometry:n}:{result:3}}function _t(e){if(e.layer?.type!==`graphics`)return 1;if(e.geometry==null)return 2;switch(e.geometry.type){case`point`:break;case`polygon`:case`polyline`:case`multipoint`:case`extent`:case`mesh`:return 0;default:return 3}let t=e.symbol!=null&&e.symbol.type===`point-3d`&&e.symbol.symbolLayers;return t&&t.some(e=>e.type===`object`)?0:4}var N=class extends i{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new x}};C([o({constructOnly:!0})],N.prototype,`layer`,void 0),C([o()],N.prototype,`enabled`,void 0),C([o()],N.prototype,`updating`,void 0),C([o()],N.prototype,`availability`,void 0),C([o()],N.prototype,`sublayerSources`,void 0),N=C([v(`esri.views.interactive.snapping.FeatureSnappingLayerSource`)],N);var P=class extends i{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new x,this.distance=j.distance,this.touchSensitivityMultiplier=j.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){let e=this.featureSources;e.some(vt)&&c.getLogger(this).warnOnce(`Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.`);let t=e.filter(bt),n=this._get(`_effectiveFeatureSources`)?.filter(vt)??new x;for(let e of t){let t=n.find(t=>t.layer===e.layer.parent);if(t)t.sublayerSources.includes(e)||t.sublayerSources.add(e);else if(e.layer.parent){let t=new N({layer:e.layer.parent});t.sublayerSources.add(e),n.add(t)}}for(let e of n){let n=e.sublayerSources.filter(e=>!t.includes(e));e.sublayerSources.removeMany(n)}n.removeMany(n.filter(e=>e.sublayerSources.length===0));let r=e.filter(yt),i=this._get(`_effectiveFeatureSources`)??new x,{added:a,removed:o}=ce(i.toArray(),[...r,...n]);return i.removeMany(o),i.addMany(a),i}};function vt(e){return e.layer.type===`subtype-group`}function yt(e){return e.layer.type!==`subtype-group`}function bt(e){return e.layer.type===`subtype-sublayer`}C([o()],P.prototype,`enabled`,void 0),C([o()],P.prototype,`enabledToggled`,void 0),C([o()],P.prototype,`forceDisabled`,void 0),C([o()],P.prototype,`selfEnabled`,void 0),C([o()],P.prototype,`featureEnabled`,void 0),C([o()],P.prototype,`gridEnabled`,void 0),C([o()],P.prototype,`attributeRulesEnabled`,void 0),C([o({type:x.ofType(N)})],P.prototype,`featureSources`,void 0),C([o()],P.prototype,`distance`,void 0),C([o()],P.prototype,`touchSensitivityMultiplier`,void 0),C([o({readOnly:!0})],P.prototype,`effectiveEnabled`,null),C([o({readOnly:!0})],P.prototype,`effectiveGridEnabled`,null),C([o({readOnly:!0})],P.prototype,`effectiveSelfEnabled`,null),C([o({readOnly:!0})],P.prototype,`effectiveFeatureEnabled`,null),C([o({readOnly:!0})],P.prototype,`_effectiveFeatureSources`,null),P=C([v(`esri.views.interactive.snapping.SnappingOptions`)],P);function xt(e){let{spatialReference:t}=e,n=a(e);return dt(t,n?kt:Ot,kt,e)}function St(e,t){if(!n(e.spatialReference,t.spatialReference))return null;let{spatialReference:r}=e;return F[0]=e.x,F[1]=e.y,F[2]=e.hasZ?e.z:0,I[0]=t.x,I[1]=t.y,I[2]=t.hasZ?t.z:0,Ct(F,I,r)}function Ct(e,t,n){return dt(n,Et,Dt,e,t,n)}var wt={geodesicLength:xt,geodesicDistanceBetweenPoints:St,geodesicDistance:Ct};async function Tt(){return await ke(),wt}function Et(e,t,n){return O(ze(jt,e,t,n).distance,`meters`)}function Dt(e,t,n){return O(Ae(At(e,t,n),{unit:`meters`}),`meters`)}function Ot(e){return O(Ve([e],`meters`)[0],`meters`)}function kt(e){return O(Ae(e,{unit:`meters`}),`meters`)}function At(e,t,n){return new Ee({spatialReference:n,paths:[[[...e],[...t]]]})}var jt=new He,F=D(),I=D(),L=class extends Ce{constructor(e){super(e),this.options=new P,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([E(()=>{let{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:n,effectiveFeatureEnabled:r,effectiveGridEnabled:i}=this.options;return{selfEnabled:n,featureEnabled:r,gridEnabled:this.view.type===`2d`&&i,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit(`changed`)),this._loadTask?.abort(),this._loadTask=te(n=>this._updateEngines(e,t,n))},w),E(()=>this.options,e=>{for(let t of this._engines)t.options=e},se)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,n){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();let r=this._engineCache,i=await Promise.allSettled([e.featureEnabled&&!r.has(`feature`)?this._createFeatureSnappingEngine(n):void 0,e.selfEnabled&&!r.has(`self`)?this._createSelfSnappingEngine(n):void 0,e.gridEnabled&&!r.has(`grid`)?this._createGridSnappingEngine(n):void 0]);if(n.aborted)for(let e of i)e.status===`fulfilled`&&e.value?.engine.destroy();else{for(let e of i)e.status===`fulfilled`&&e.value&&r.set(e.value.type,e.value.engine);this._engines=Array.from(r.values())}}async _createSelfSnappingEngine(t){let[{SelfSnappingEngine:n},r]=await Promise.all([e(()=>import(`./SelfSnappingEngine-CSogHo4n.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27])),Tt()]);return ve(t),{type:`self`,engine:new n({view:this.view,options:this.options,geodesicLengthMeasurementUtils:r})}}async _createGridSnappingEngine(t){let{view:n}=this;if(n.type!==`2d`)return;let{GridSnappingEngine:r}=await e(async()=>{let{GridSnappingEngine:e}=await import(`./GridSnappingEngine-B6ykT_KH.js`);return{GridSnappingEngine:e}},__vite__mapDeps([28,1,2,3,4,5,6,7,8,9,10,12,15,16,29,18,19,30,22,31,21,26]));return ve(t),{type:`grid`,engine:new r({view:n,options:this.options})}}async _createFeatureSnappingEngine(t){let{FeatureSnappingEngine:n}=await e(async()=>{let{FeatureSnappingEngine:e}=await import(`./FeatureSnappingEngine-C5ee4UCl.js`);return{FeatureSnappingEngine:e}},__vite__mapDeps([32,1,2,3,4,5,6,7,8,9,33,10,12,15,34,16,17,18,19,35,36,22,25,24,26,37]));ve(t);let{view:r,options:i}=this,{spatialReference:a}=r;return{type:`feature`,engine:new n({view:r,options:i,spatialReference:a})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){let{distance:e,touchSensitivityMultiplier:t}=this.options,n=e*t;return n*n}snap(e){return Lt(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){let{point:t,context:n}=e;this._removeVisualization();let r=this._currentMainCandidate;if(r==null)return t;let i=this._selectUpdateInput(e);if(i==null)return t;let{spatialReference:a}=n,o=p(i,a);if(o==null)return t;let{view:s}=this,{elevationInfo:c,visualizer:l}=n,u=[],d=A(o,s,c),f=r.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,f,n)||!Pt(r,n.drawConstraints))return this._resetSnappingState(),t;r.targetPoint=Xe(f),u.push(...r.hints);for(let e of this._currentOtherActiveCandidates)Pt(e,n.drawConstraints)&&(e.targetPoint=Xe(f),u.push(...e.hints));return l!=null&&this.addHandles(l.draw(u,{spatialReference:a,elevationInfo:Rt(n),view:s,selfSnappingZ:n.selfSnappingZ}),Mt),Ye(f,s,t,n)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(Mt)}async _snapSinglePoint({point:e,context:t,signal:n}){let{view:r}=this,{elevationInfo:i}=t,a=A(e,r,i),o=await this._fetchCandidates(a,3,t,n);return this._createSnapResult(a,0,o,r,e,t,n)}async _snapMultiPoint({point:e,scenePoint:t,context:n,signal:r}){let{view:i}=this,{coordinateHelper:a,elevationInfo:o,spatialReference:s}=n;await ie(t.spatialReference,s);let c=p(t,s),l=A(c,i,o),u=await this._fetchCandidates(l,1,n,r);if(u.length>0){let e=await this._fetchCandidates(l,2,n,r);return this._createSnapResult(l,1,[...u,...e],i,c,n,r)}let d=A(e,i,o),f=await this._fetchCandidates(d,2,n,r);return this._createSnapResult(d,0,f,i,{z:a.hasZ()&&e.hasZ?e.z??0:void 0,m:a.hasM()&&e.hasM?e.m??0:void 0},n,r)}async _fetchCandidates(e,t,n,r){return(await Promise.all(this._engines.map(i=>i.fetchCandidates(e,t,n,r)))).flat()}_createSnapResult(e,t,n,r,i,a,o){return{get valid(){return!ae(o)},apply:()=>{let{spatialReference:o}=a,{snappedPoint:s,hints:c}=this._processCandidates(e,t,n,a);return this._removeVisualization(),a.visualizer!=null&&this.addHandles(a.visualizer.draw(c,{spatialReference:o,elevationInfo:Le,view:r,selfSnappingZ:a.selfSnappingZ}),Mt),Ye(s,r,i,a)}}}_processCandidates(e,t,n,r){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Ze(e,n);let i=this._currentMainCandidate;if(i!=null){let a=Ft(i,n);if(a>=0){if(!(n[a]instanceof M))return this._intersectWithOtherCandidates(a,n,e,t,r);if(this._arePointsWithinScreenThreshold(e,i.targetPoint,r))return this._updateSnappingCandidate(i,t,n,r)}}return this._intersectWithOtherCandidates(0,n,e,t,r)}_intersectWithOtherCandidates(e,t,n,r,i){let{coordinateHelper:a}=i,o=t[e],s=[];for(let r=0;r<t.length;++r){if(r===e)continue;let i=t[r],c=o.constraint.intersect(i.constraint);if(c)for(let e of c.closestPoints(o.targetPoint))s.push([new M(Xe(e),o,i,i.isDraped),this._squaredScreenDistance(n,e,a)])}return s.length>0&&(s.sort((e,t)=>e[1]-t[1]),s[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(s[0][0],r,t,i):Pt(o,i.drawConstraints)?this._updateSnappingCandidate(o,r,t,i):{snappedPoint:n,hints:[]}}_updateSnappingCandidate(e,t,n,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;let i=this._currentMainCandidate.targetPoint,a=[];a.push(...e.hints);for(let t of n){if(e instanceof M){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;let n=t.constraint.closestTo(i);this._squaredScreenDistance(n,i,r.coordinateHelper)<Nt()&&(t.targetPoint=i,this._currentOtherActiveCandidates.push(t),a.push(...t.hints))}return{snappedPoint:i,hints:a}}_squaredPointProximityThreshold(e){return e===`touch`?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}_squaredScreenDistance(e,t,n){return Qe(this._toScreen(e,n),this._toScreen(t,n))}_toScreen(e,t){return ot(e,t.spatialReference,Le,this.view)}get test(){}};C([o({constructOnly:!0})],L.prototype,`view`,void 0),C([o()],L.prototype,`options`,void 0),C([o({readOnly:!0})],L.prototype,`updating`,null),C([o()],L.prototype,`_loadTask`,void 0),C([o()],L.prototype,`_engines`,void 0),C([o()],L.prototype,`_squaredMouseProximityThreshold`,null),C([o()],L.prototype,`_squaredTouchProximityThreshold`,null),L=C([v(`esri.views.interactive.snapping.SnappingManager`)],L);var Mt=`visualization-handle`;function Nt(){return j.satisfiesConstraintScreenThreshold*j.satisfiesConstraintScreenThreshold}function Pt(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof tt||e instanceof et||e instanceof nt||e instanceof rt||e instanceof it)&&(!(e instanceof at)||t.direction==null&&e.selfSnappingType===1)}function Ft(e,t){return e instanceof M?It(t,e.first)>=0&&It(t,e.second)>=0?0:-1:It(t,e)}function It(e,t){let n=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){n=r;break}return n}function Lt(e){return e.scenePoint!=null}function Rt({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Le:t}function zt(e,t=R()){return Vt(e,t)}function Bt(e,t=R()){return Vt(e,t,!1)}function Vt(e,t,n=e.hasZ){let r=ct(e.spatialReference),i=ye(r);if(i==null)return null;let a=(e,t)=>!(t.length<2)&&(_(e,t[0],t[1],n&&t[2]||0),!0),o=0;for(let n of e.rings){let i=n.length;if(i<3)continue;let{positionsWorldCoords:c}=t;for(;c.length<i;)c.push(D());let l=Ht,d=_(Ut,0,0,0),f=1/i;for(let t=0;t<i;t++){if(!a(l,n[t])||!Ie(l,e.spatialReference,c[t],r))return null;s(d,d,c[t],f)}let p=Fe(c[0],c[1],d,Pe());if(u(Me(p))===0)continue;for(let e=0;e<i;e++)Ne(p,d,c[e],c[e]);let m=Wt(c);for(let e=0;e<m.length;e+=3)o+=ft(c[m[e]],c[m[e+1]],c[m[e+2]])}return k(o,i)}var Ht=D(),Ut=D();function R(){return{positionsWorldCoords:[]}}function Wt(e){return je(Gt(e),[],2)}function Gt(e){let t=new Float64Array(2*e.length);for(let n=0;n<e.length;++n){let r=e[n],i=2*n;t[i]=r[0],t[i+1]=r[1]}return t}var Kt=e=>({geodesicArea(t){let{spatialReference:n}=t,r=a(t);return dt(n,r?Xt:Jt,r?Xt:t=>Yt(e,t),t)}});async function qt(){let t=await e(()=>import(`./geometryEngine-oeRdEJ9p.js`),__vite__mapDeps([38,1,2,39,40]));return await De(),Kt(t)}function Jt(e){return k(Math.abs(Be([e],`square-meters`)[0]),`square-meters`)}function Yt(e,t){try{return k(Math.abs(e.geodesicArea(t,`square-meters`)),`square-meters`)}catch{return null}}function Xt(e){return k(Oe(e,{unit:`square-meters`,curveType:`geodesic`}),`square-meters`)}var Zt=e=>({autoAreaByElevationMode(t,n,r=R()){return n===`on-the-ground`?e.geodesicArea(t)??Bt(t,r):zt(t,r)},autoArea2D(e,t=R()){return this.autoAreaByElevationMode(e,`on-the-ground`,t)}}),Qt=null;async function z(){return Qt||=Zt(await qt()),Qt}function $t(e){return{autoLength2D:t=>e.geodesicLength(t)??ut(t),autoDistanceBetweenPoints2D:(t,n)=>e.geodesicDistanceBetweenPoints(t,n)??st(t,n),autoDistance2D:(t,n,r)=>(V[0]=t[0],V[1]=t[1],V[2]=t.length===3?t[2]:0,H[0]=n[0],H[1]=n[1],H[2]=n.length===3?n[2]:0,e.geodesicDistance(V,H,r)??lt(V,H,r))}}async function B(){return $t(await Tt())}var V=D(),H=D(),en=class{constructor(e){this.layer=e}get elevationInfo(){return this.layer.elevationInfo}add(e){this.layer.add(e)}addMany(e){this.layer.addMany(e)}onGraphicsChange(e){let{layer:t}=this;return me(()=>t.graphics,`change`,t=>e(t))}has(e){return e.layer===this.layer}remove(e){this.layer.remove(e)}removeMany(e){this.layer.removeMany(e)}removeAll(){this.layer.removeAll()}};C([o()],en.prototype,`elevationInfo`,null);var tn=class{constructor(e){this.layer=e}get elevationInfo(){}add(e,t){(this._getSublayerForCreateTool(t)??this._getSublayerForGraphic(e))?.add(e)}addMany(e,t){if(t){let n=this._getSublayerForCreateTool(t);if(n)return void n.addMany(e)}e.forEach(e=>this._getSublayerForGraphic(e)?.add(e))}onGraphicsChange(e){let{layer:t}=this;if(t.sublayers?.length)return pe(t.sublayers?.toArray().map(t=>me(()=>t.graphics,`change`,t=>e(t))))}has(e){let{layer:t}=this;return e.layer===t||e.sourceLayer===t||!!t.sublayers?.some(t=>e.layer===t||e.sourceLayer===t)}remove(e){this._getSublayerForGraphic(e)?.remove(e)}removeMany(e){e.forEach(e=>this._getSublayerForGraphic(e)?.remove(e))}removeAll(){this.layer.sublayers?.forEach(e=>e.removeAll())}_getSublayerForCreateTool(e){let{layer:t}=this;switch(e){case`point`:return t.pointLayer;case`polyline`:return t.polylineLayer;case`polygon`:return t.polygonLayer;case`multipoint`:return t.multipointLayer;case`text`:return t.textLayer}}_getSublayerForGraphic(e){let{layer:t}=this;if(e?.geometry)switch(e.geometry.type){case`point`:return e.symbol?.type===`text`?t.textLayer:t.pointLayer;case`polyline`:return t.polylineLayer;case`polygon`:return t.polygonLayer;case`multipoint`:return t.multipointLayer}}};C([o()],tn.prototype,`elevationInfo`,null);var U=class extends Ce{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){let{activeComponent:e}=this;if(!e)return null;switch(e.type){case`graphic-mover`:case`move-3d`:return`move`;case`box`:case`transform-3d`:return`transform`;case`reshape`:case`reshape-3d`:return`reshape`;case`draw-2d`:return e.graphicSymbol?.type===`text`?`text`:e.geometryType;case`draw-3d`:return e.geometryType}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit(`complete`)}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){let e=this.activeComponent;e&&(e.type!==`box`&&e.type!==`reshape`&&e.type!==`graphic-mover`||e.refresh())}set undo(e){this._set(`undo`,()=>{this.canUndo()&&e()})}set redo(e){this._set(`redo`,()=>{this.canRedo()&&e()})}};C([o()],U.prototype,`activeComponent`,void 0),C([o()],U.prototype,`cancelled`,void 0),C([o()],U.prototype,`history`,void 0),C([o()],U.prototype,`tool`,null),C([o()],U.prototype,`type`,void 0),C([o()],U.prototype,`canUndo`,null),C([o()],U.prototype,`canRedo`,null),C([o()],U.prototype,`onEnd`,void 0),C([o()],U.prototype,`undo`,null),C([o()],U.prototype,`redo`,null),C([o()],U.prototype,`toggleTool`,void 0),C([o()],U.prototype,`addToSelection`,void 0),C([o()],U.prototype,`removeFromSelection`,void 0),U=C([v(`esri.widgets.Sketch.support.OperationHandle`)],U);var W=class extends U{};C([o()],W.prototype,`activeComponent`,void 0),W=C([v(`esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle`)],W);var G=class extends U{};C([o()],G.prototype,`activeComponent`,void 0),G=C([v(`esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle`)],G);function nn(e,t){return t===`freehandPolygon`||t===`freehandPolyline`?`freehand`:e??(t===`rectangle`||t===`circle`?`hybrid`:`click`)}function rn(e){switch(e){case`freehandPolygon`:return`polygon`;case`freehandPolyline`:return`polyline`;case`text`:return`point`;default:return e}}function an(e){if(e.length>1)return!1;let t=e.at(0)?.geometry;return t?.type===`point`||t?.type===`multipoint`&&t.points.length<2}var on={defaultZ:0},K={reshapeOptions:{edgeOperation:`split`,shapeOperation:`move`,vertexOperation:`move`,enableCreateCurveFromStraightEdge:!0},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:be},tool:`transform`},q=Symbol(),sn=Symbol(),J=class extends Ce{constructor(e){super(e),this._defaultSnappingManager=null,this._internalGraphicsLayer=new Re({listMode:`hide`,internal:!0,title:`SVM Internal`}),this._operationHandle=null,this._updatingHandles=new we,this._viewHandlesKey=`viewHandles`,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new m({style:`circle`,size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new g({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new re({color:[130,130,130,1],width:2}),this.meshSymbol=new d({symbolLayers:new x([new oe])}),this.updateGraphics=new x,this.updateOnGraphicClick=!0,this.creationMode=`single`,this.vertexSymbol=new m({style:`circle`,size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Je,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._onLayerAdapterChange=async()=>{let{_layerAdapter:e}=this;if(this.removeHandles(sn),!e)return;let t=[e.onGraphicsChange(e=>this._onLayerGraphicsChangeCallback(e)),E(()=>e.elevationInfo,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer&&(this._internalGraphicsLayer.elevationInfo=e))},w)].filter(xe);this.addHandles(t,sn)},this._originalPopupEnabled=null,this.defaultCreateOptions=on,this.defaultUpdateOptions=K,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new P,this.textSymbol=new f({text:`text`})}initialize(){this.addHandles([me(()=>this.view?.map?.layers,`change`,e=>{this.layer&&e.removed.includes(this.layer)&&this.cancel()}),E(()=>this._layerAdapter,()=>this._onLayerAdapterChange(),w),E(()=>this.view,t=>{this._defaultSnappingManager=S(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new L({view:t,options:this.snappingOptions})),t.type===`2d`?e(()=>import(`./editingTools-CYJrF2TC.js`),__vite__mapDeps([41,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,12,63,64,65,66,67,68,69,70,27,14,13,15,71,72,73,74,16,75,76,19,20,31,77,24,78,79,80,18,7,6,26,81,82,83,84,85])):t.type===`3d`&&(e(()=>import(`./editingTools-Ba1hBSc8.js`),__vite__mapDeps([86,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,12,63,64,65,66,67,68,69,70,27,14,13,15,71,72,73,74,16,75,76,19,20,31,77,24,78,79,80,18,7,6,26,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,81,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,82,172,173,174,175,176,177,178,179,180,181,17,182,183,184,185])),e(()=>import(`./GraphicsLayerView3D-DDVqxJfv.js`),__vite__mapDeps([186,1,2,187,88,89,90,91,92,93,188,111,95,101,112,113,114,98,99,100,141,108,123,189,94,96,97,102,103,190,191,117,106,135,124,115,192,129,145,7,4,5,6,8,9,3,13,14,15,146,44,147,62,148,79,149,150,151,152,122,107,109,128,136,165,104,120,121,193,105,110,118,119,194,195,139,140,155,196,10,58,158,159,160,161,157,162,68,69,73,163,164,197,59,198,72,199,200,169,170,171,201,175,176,202,203,204,205,180,178,16,183,206,37,207,208]))))},w),E(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),$e(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=S(this._defaultSnappingManager),this._set(`snappingManager`,null),this._set(`view`,null),this._updatingHandles.destroy(),this.emit(`destroy`)}get _layerAdapter(){let{layer:e}=this;switch(e?.type){case`graphics`:return new en(e);case`map-notes`:return new tn(e);default:return null}}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type===`create`&&this._operationHandle.activeComponent&&`mode`in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){let{activeComponent:e,destroyed:t}=this,n=!t&&e&&`tooltip`in e?e.tooltip:null;return n?.visible?n:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!==`draw-3d`&&this.activeComponent.type!==`draw-2d`?this._get(`createGraphic`):this.activeComponent.graphic}get defaultCreateOptions(){return this._get(`defaultCreateOptions`)}set defaultCreateOptions(e){this._set(`defaultCreateOptions`,{...on,...e})}get defaultUpdateOptions(){return this._get(`defaultUpdateOptions`)}set defaultUpdateOptions(e){this._set(`defaultUpdateOptions`,{...K,...e,reshapeOptions:{...K.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...K.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get textSymbol(){return this._get(`textSymbol`)}set textSymbol(e){this._set(`textSymbol`,e)}get snappingOptions(){return this.snappingManager?.options??this._get(`snappingOptions`)}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set(`snappingOptions`,e)}get snappingManager(){return this._isOverridden(`snappingManager`)&&this._get(`snappingManager`),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden(`snappingManager`)||(this._defaultSnappingManager=S(this._defaultSnappingManager)),this._override(`snappingManager`,e);else{let{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new L({options:this.snappingOptions,view:e})),this._clearOverride(`snappingManager`)}}get state(){let e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?`active`:e?`ready`:`disabled`}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get updating(){return!(!this._updatingHandles.updating&&!this.snappingManager?.updating)}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get(`view`)}set view(e){let t=this._get(`view`);if(t){let{container:e,map:n}=t;e&&this._clearCursor(),n?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}let n=`view-ready`;this.removeHandles(n),e&&this.addHandles(Se(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},w),n),this._set(`view`,e)}addGraphic(e){this._layerAdapter?.add(e)}addGraphics(e){this._layerAdapter?.addMany(e)}hasGraphic(e){return!!this._layerAdapter?.has(e)}removeGraphic(e){this._layerAdapter?.remove(e)}removeGraphics(e){this._layerAdapter?.removeMany(e)}removeAllGraphics(){this._layerAdapter?.removeAll()}cancel(){this._moduleLoaderAbortController=ne(this._moduleLoaderAbortController),this._viewReadyAbortController=ne(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle?.complete()}delete(){let{state:e,updateGraphics:t}=this;if(e===`active`&&t.length){let{activeTool:e}=this,n=t.toArray();this.removeGraphics(n),this.cancel(),this._emitDeleteEvent({graphics:n,tool:e})}}duplicate(){if(this.state===`active`&&this.updateGraphics.length){let e=this.updateGraphics.map(e=>e.clone()).toArray();return this.addGraphics(e),this.emit(`duplicate`,{graphics:e,type:`duplicate`}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();let{view:n,layer:r}=this;if(!n||this.state===`disabled`)throw r||this._logMissingLayer(),he();if(n.activeTool!=null&&(n.activeTool=null),!e)return void this._logError(`sketch:missing-parameter`,`Missing parameter 'tool'.`);We(n,this._internalGraphicsLayer);let i=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(i==null||this.destroyed)return void n.map?.remove(this._internalGraphicsLayer);i.on(`complete`,()=>{if(i===this._operationHandle){let n=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set(`createGraphic`,null),this.view?.map?.remove(this._internalGraphicsLayer),i.cancelled||n==null||this.addGraphic(n),this._sketchContinuationFlag=!1,this.emit(`create`,{graphic:n,state:r?`cancel`:`complete`,tool:e,toolEventInfo:null,type:`create`}),r||this._sketchContinuationFlag)return;let{creationMode:a}=this;if(a===`continuous`){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(fe(this.create(e,t)))}else a===`update`&&n&&this._updatingHandles.addPromise(fe(this.update([n])))}}),this._operationHandle=i,n.ready&&n.focus()}async place(e,t){return await e.load(),this.create(`mesh`,{mode:`click`,hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();let{layer:n,view:r,state:i}=this;if(!r||i===`disabled`)throw n||this._logMissingLayer(),he();r.activeTool!=null&&(r.activeTool=null);let a=Array.isArray(e)?e:[e];if(e==null||!a?.length)return void this._logError(`sketch:missing-parameter`,`Missing parameter 'graphics'.`);if(a.some(e=>this.hasGraphic(e)?e.geometry==null&&(this._logError(`sketch:invalid-parameter`,`Parameter 'graphics' contains one or more graphics with an unsupported geometry.`),!0):(this._logError(`sketch:invalid-parameter`,`Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer.`),!0)))return;let o=await this._updatingHandles.addPromise(this._setupUpdateOperation(a,t));this.destroyed||o==null||$(o)||(We(r,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,t),this.emit(`update`,{graphics:a,state:`start`,aborted:!1,tool:o.tool,toolEventInfo:null,type:`update`}))}async _updateSpatialReference(e){let t=this.view;if(t){e=Array.isArray(e)?e:[e];for(let r of e)r.geometry==null||r.geometry.type===`mesh`||n(r.geometry.spatialReference,t.spatialReference)||(Te(r.geometry.spatialReference,t.spatialReference)||ee()||await l(),r.geometry=p(r.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){let t=this.view;if(!t)return this._logMissingView(),null;if(t.type===`2d`){let n=[];t.map.allLayers.forEach(e=>{e.type!==`vector-tile`&&e.type!==`imagery`||n.push(e)});let r=await t.hitTest(e,{exclude:n});return pt(r.results)}let n=[t.map.ground];t.map.allLayers.forEach(e=>{r(e)&&n.push(e)});let i=await t.hitTest(e,{exclude:n});if(i.results.length>0){let e=i.results[0];if(e!=null&&e.type===`graphic`&&e.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(e.distance??0)>-Math.min(3*i.ground.distance,t.viewingMode===`global`?de(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:1/0)))return e}return null}_generateViewHandles(e){return[e.on(`immediate-click`,async e=>{let t=this.state===`active`&&this._operationHandle?.type===`create`;this.state!==`disabled`&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},T.WIDGET)]}async _handleImmediateClick(e){let t=await e.defer(()=>this._getFirstHit(_e(e))),n=null;if(t!=null){let r=t.graphic;this.updateGraphics.includes(r)||this.hasGraphic(r)?(e.stopPropagation(),n=r):this.view?.type!==`2d`||this._isComponentGraphic(r)||this.state!==`active`||this.cancel()}else this.state===`active`&&this.cancel();n==null||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){let n=this.view;if(!n)return this._logMissingView(),null;let r={hasZ:n.type===`3d`,...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,n,r);return i==null?null:(n.tools.add(i),n.activeTool=i,this._setupCreateOperationHandle(i,e))}async _setupDrawGraphicTool(e,t,n){if(e===`multipoint`&&t.type===`3d`)return this._logError(`sketch:create`,`Multipoint geometries are not supported in SceneView.`),null;if(!t)return this._logMissingView(),null;let{cursor:r,defaultZ:i,hasZ:a,geometryToPlace:o,graphicProperties:s,mode:c,preserveAspectRatio:l}=n,u=nn(c,e),d=rn(e),f=n?.optionsPerTool?.has(e)?n.optionsPerTool.get(e):{},p=f?.preserveAspectRatio??l??e!==`rectangle`,m={centered:e!==`rectangle`&&!(e===`circle`&&!p),cursor:r,defaultZ:i,forceUniformSize:p,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:o,geometryType:d,mode:u,graphicSymbol:n.graphicSymbol??this._getGraphicSymbolFromTool(e),hasZ:a,snappingManager:this.snappingManager,snapToScene:!1,view:t,...f};return t.type===`2d`?this._makeDrawGraphicTool2D(m):this._makeDrawGraphicTool3D(m)}async _makeDrawGraphicTool2D(t){let[n,r,i]=await Promise.all([this._requireModule(e(()=>import(`./editingTools-CYJrF2TC.js`),__vite__mapDeps([41,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,12,63,64,65,66,67,68,69,70,27,14,13,15,71,72,73,74,16,75,76,19,20,31,77,24,78,79,80,18,7,6,26,81,82,83,84,85]))),z(),B()]);return $(n)||this.destroyed?null:new n.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:un(t.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:i})}async _makeDrawGraphicTool3D(t){let[n,r,i]=await Promise.all([this._requireModule(e(()=>import(`./editingTools-Ba1hBSc8.js`),__vite__mapDeps([86,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,12,63,64,65,66,67,68,69,70,27,14,13,15,71,72,73,74,16,75,76,19,20,31,77,24,78,79,80,18,7,6,26,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,81,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,82,172,173,174,175,176,177,178,179,180,181,17,182,183,184,185]))),z(),B()]);return $(n)||this.destroyed?null:new n.module.DrawGraphicTool3D({...t,elevationInfo:this._layerAdapter?.elevationInfo,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:i})}_setupCreateOperationHandle(e,t){let n=this.view;if(!n)return this._logMissingView(),null;let r=null,i=e.forceUniformSize,a=e.centered,o=[n.on(`key-down`,t=>{if(t.key===b.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===b.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==b.vertexAdd||t.repeat)t.key===b.undo?(t.stopPropagation(),s.undo()):t.key===b.redo?(t.stopPropagation(),s.redo()):t.key!==b.constraint||e.geometryType!==`rectangle`&&e.geometryType!==`circle`||t.repeat?t.key===b.center&&(t.repeat||(e.centered=!a,t.stopPropagation())):(e.forceUniformSize=!i,t.stopPropagation());else{let n=e.drawOperation.geometryType;n!==`polyline`&&n!==`polygon`&&n!==`multipoint`||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},T.WIDGET),n.on(`key-up`,t=>{t.key===b.pan?e.enabled=!0:t.key!==b.constraint||e.geometryType!==`rectangle`&&e.geometryType!==`circle`?t.key===b.center&&(e.centered=a,t.stopPropagation()):(e.forceUniformSize=i,t.stopPropagation())},T.WIDGET),e.on(`vertex-add`,t=>{switch(r=r==null?`start`:`active`,t.operation){case`apply`:this.emit(`create`,{graphic:e.graphic,state:r,tool:this.activeTool,toolEventInfo:t,type:`create`});break;case`undo`:this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case`redo`:this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on(`cursor-update`,t=>{e.drawOperation.numCommittedVertices>0&&this.emit(`create`,{graphic:e.graphic,state:`active`,tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:`cursor-update`},type:`create`})}),e.on(`vertex-remove`,t=>{switch(t.operation){case`apply`:this.emit(`create`,{graphic:e.graphic,state:`active`,tool:this.activeTool,toolEventInfo:t,type:`create`});break;case`undo`:this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case`redo`:this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on(`complete`,e=>{this._set(`createGraphic`,e.graphic),r=`complete`,e.aborted?s&&s.cancel():s&&s.complete()}),E(()=>this._getGraphicSymbolFromTool(t),t=>{e.graphicSymbol=t})],s=new W({activeComponent:e,type:`create`,onEnd:()=>{y(o),n.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return s}_getGraphicSymbolFromTool(e){switch(e){case`point`:case`multipoint`:return this.pointSymbol;case`polyline`:case`freehandPolyline`:return this.polylineSymbol;case`circle`:case`rectangle`:case`polygon`:case`freehandPolygon`:return this.polygonSymbol;case`mesh`:return this.meshSymbol;case`text`:return this.textSymbol}}async _setupUpdateOperation(e,t){let{view:n}=this;if(!n)return this._logMissingView(),null;let r={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}},i=r.tool??K.tool;if(this.removeGraphics(e),this.addGraphics(e),n.type===`3d`){if(e.length===0)return null;switch(i){case`move`:return this._setupMove3DOperation(e,r,n,i);case`reshape`:return e.length>1?(this._logError(`sketch:reshape-multiple`,`Reshape operation does not support multiple graphics.`),null):this._setupReshape3DOperation(e[0],r,n);case`transform`:return this._setupGraphicTransform3DOperation(e,r,n)}}switch(i){case`move`:return this._setupMove2DOperation(e,r,n);case`reshape`:return e.length>1?(this._logError(`sketch:reshape-multiple`,`Reshape operation does not support multiple graphics.`),null):this._setupTransformOrReshape2DOperation(e,i,r,n);case`transform`:return an(e)&&(i=`reshape`),this._setupTransformOrReshape2DOperation(e,i,r,n)}}async _setupMove3DOperation(t,n,r,i,a=!1){let[o,s]=await Promise.all([this._requireModule(e(()=>import(`./editingTools-Ba1hBSc8.js`),__vite__mapDeps([86,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,12,63,64,65,66,67,68,69,70,27,14,13,15,71,72,73,74,16,75,76,19,20,31,77,24,78,79,80,18,7,6,26,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,81,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,82,172,173,174,175,176,177,178,179,180,181,17,182,183,184,185]))),B()]);if($(o))return o;let{ManipulatedObject3DGraphic:c,MoveTool3D:l}=o.module,u=new Map,d=()=>{u.forEach(e=>e.destroy()),u.clear()};for(let e of t){let t=new c({view:r,graphic:e}),n=Ue(t);if(n!==0)return d(),this._logError(`sketch:move`,`Move operation not supported for provided graphic(s) (${mt(n)}).`),null;u.set(e,t)}let f=new l({view:r,enableZ:n.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:s});r.tools.add(f),f.objects.addMany(Array.from(u.values())),a||this.updateGraphics.addMany(t);let p=[],m=new G({activeComponent:f,tool:i,type:`update`,onEnd:()=>{y(p),Q(r,f),d()},undo:()=>{fn(this.view,f),Y(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{X(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:e=>{this.updateGraphics.push(e);let t=new c({view:r,graphic:e});u.set(e,t),f.objects.push(t),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);if(m.history.undo.forEach(e=>e.updates.splice(t,1)),m.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),this.updateGraphics.length===0)return void m.complete();let n=u.get(e);n&&(f.objects.remove(n),n.destroy(),u.delete(e))},toggleTool:async()=>{if(this.updateGraphics.length!==1||!1===n.toggleToolOnClick||i!==`transform`)return;let e=this.updateGraphics.at(0),t=await this._setupReshape3DOperation(e,n,r,!0);t&&!$(t)&&(m.onEnd(),m.destroy(),this._setUpdateOperationHandle(t,n))}});return p.push(...this._getHandlesForComponent(m,n),r.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(m,e,n),T.WIDGET),r.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)},T.WIDGET)),m}_setupGraphicTransform3DOperation(e,t,n,r=!1){if(e.length===1&&_t(e[0])===0){let i=e[0],a=i.geometry;if(a!=null&&(a.type===`point`||a.type===`mesh`))return this._setupPointTransform3DOperation(i,t,n);if(a!=null&&(a.type===`polygon`||a.type===`polyline`))return this._setupPolyTransform3DOperation(i,t,n,r)}return this._setupMove3DOperation(e,t,n,`transform`,r)}async _setupPointTransform3DOperation(t,n,r){let i=`transform`,{enableRotation:a,enableScaling:o,enableZ:s}=n,c=await this._requireModule(e(()=>import(`./editingTools-Ba1hBSc8.js`),__vite__mapDeps([86,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,12,63,64,65,66,67,68,69,70,27,14,13,15,71,72,73,74,16,75,76,19,20,31,77,24,78,79,80,18,7,6,26,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,81,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,82,172,173,174,175,176,177,178,179,180,181,17,182,183,184,185])));if($(c))return c;let{TransformTool3D:l,ManipulatedObject3DGraphic:u}=c.module,d=new u({graphic:t,view:r}),f=new l({object:d,view:r,enableRotation:a,enableScaling:o,enableZ:s,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});r.tools.add(f),this.updateGraphics.add(t);let p=[],m=new G({activeComponent:f,tool:i,type:`update`,onEnd:()=>{y(p),Q(r,f),d.destroy()},undo:()=>{fn(this.view,f),Y(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{X(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),m.onEnd(),m.destroy();let t=await this._setupMove3DOperation(this.updateGraphics.toArray(),n,r,`transform`,!0);$(t)||this._setUpdateOperationHandle(t,n)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),m.complete()},toggleTool:()=>{}});return p.push(...this._getHandlesForComponent(m,n),r.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(m,e,n),T.WIDGET),r.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)},T.WIDGET)),m}async _setupPolyTransform3DOperation(t,n,r,i=!1){let a=`transform`,{enableRotation:o,enableScaling:s,enableZ:c,preserveAspectRatio:l}=n,[u,d]=await Promise.all([this._requireModule(e(()=>import(`./editingTools-Ba1hBSc8.js`),__vite__mapDeps([86,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,12,63,64,65,66,67,68,69,70,27,14,13,15,71,72,73,74,16,75,76,19,20,31,77,24,78,79,80,18,7,6,26,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,81,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,82,172,173,174,175,176,177,178,179,180,181,17,182,183,184,185]))),B()]);if($(u))return u;let{ManipulatedObject3DGraphic:f,ExtentTransformTool:p}=u.module,m=this.view?.inputManager?.isModifierKeyDown(b.constraint),h=new f({view:r,graphic:t}),g=new p({object:h,view:r,enableRotation:o,enableScaling:s,enableZ:c,preserveAspectRatio:!!l!=!!m,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});r.tools.add(g),i||this.updateGraphics.add(t);let ee=[],_=new G({activeComponent:g,tool:a,type:`update`,onEnd:()=>{y(ee),Q(r,g),h.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),_.onEnd(),_.destroy();let t=await this._setupMove3DOperation(this.updateGraphics.toArray(),n,r,`transform`,!0);$(t)||this._setUpdateOperationHandle(t,n)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),_.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||!1===n.toggleToolOnClick)return;let e=await this._setupReshape3DOperation(t,n,r,!0);e&&!$(e)&&(_.onEnd(),_.destroy(),this._setUpdateOperationHandle(e,n))}});return ee.push(...this._getHandlesForComponent(_,n),r.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(_,e,n),T.WIDGET),r.on(`key-down`,e=>this._getCommonUpdateOperationKeyDownHandlers(_,e),T.WIDGET),r.on(`key-down`,e=>{e.key!==b.constraint||e.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,e.stopPropagation())},T.WIDGET),r.on(`key-up`,e=>{e.key===b.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,e.stopPropagation())},T.WIDGET)),_}async _setupMove2DOperation(e,t,n){let r=`move`;this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let i=await this._getGraphicMover(e,t,n);if($(i))return i;let a=new G({activeComponent:i,tool:r,type:`update`,onEnd:()=>{this._clearCursor(),y(c),y(s),i.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{let e=this.updateGraphics.toArray();Y(a,e),a.refreshComponent(),this._emitUndoEvent({graphics:e,tool:r})},redo:()=>{let e=this.updateGraphics.toArray();X(a,e),a.refreshComponent(),this._emitRedoEvent({graphics:e,tool:r})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),i.graphics=this.updateGraphics.toArray(),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);a.history.undo.forEach(e=>e.updates.splice(t,1)),a.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);let n=this.updateGraphics.toArray();this.emit(`update`,{graphics:n,state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),this.updateGraphics.length===0?a.complete():i.graphics=n}}),o=!1,s=[n.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(a,e,t),T.WIDGET),n.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(a,e),e.key!==b.constraint||e.repeat||(o=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},T.WIDGET),n.on(`key-up`,e=>{e.key===b.constraint&&o&&(o=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},T.WIDGET)],c=this._getHandlesForComponent(a,t);return a}async _setupReshape3DOperation(t,n,r,i=!1){let a=`reshape`,[o,s,c]=await Promise.all([this._requireModule(e(()=>import(`./editingTools-Ba1hBSc8.js`),__vite__mapDeps([86,1,2,42,43,3,4,5,44,8,9,45,10,11,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,12,63,64,65,66,67,68,69,70,27,14,13,15,71,72,73,74,16,75,76,19,20,31,77,24,78,79,80,18,7,6,26,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,81,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,82,172,173,174,175,176,177,178,179,180,181,17,182,183,184,185]))),z(),B()]);if($(o))return o;let{ManipulatedObject3DGraphic:l,ReshapeTool3D:u}=o.module,d=new l({view:r,graphic:t}),f=ht(d);if(f!==0)return d.destroy(),this._logError(`sketch:reshape`,`Reshape operation not supported for provided graphic(s) (${mt(f)}).`),null;let p=n.reshapeOptions,m=new u({view:r,object:d,enableZVertex:n.enableZ&&p?.vertexOperation===`move`,enableZShape:n.enableZ&&p?.shapeOperation===`move`,enableMoveObject:p?.shapeOperation===`move`||p?.shapeOperation===`move-xy`,enableMidpoints:p?.edgeOperation===`split`,enableEdgeOffset:p?.edgeOperation===`offset`,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:s,automaticLengthMeasurementUtils:c});r.tools.add(m),i||this.updateGraphics.add(d.graphic);let h=[],g=new G({activeComponent:m,tool:a,type:`update`,onEnd:()=>{y(h),Q(r,m),d.destroy()},canUndo:()=>!m.destroyed&&m.canUndo,undo:()=>{m.destroyed||(m.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},canRedo:()=>!m.destroyed&&m.canRedo,redo:()=>{m.destroyed||(m.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`}),g.onEnd(),g.destroy();let t=await this._setupMove3DOperation(this.updateGraphics.toArray(),n,r,`transform`,!0);$(t)||this._setUpdateOperationHandle(t,n)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`}),g.complete()},toggleTool:async()=>{if(!1===n.toggleToolOnClick)return;g.onEnd(),g.destroy();let e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),n,r,!0);$(e)||this._setUpdateOperationHandle(e,n)}});return h.push(...this._getHandlesForComponent(g,n),r.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(g,e,n),T.WIDGET),r.on(`key-down`,e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)},T.WIDGET)),g}async _setupTransformOrReshape2DOperation(e,t,n,r){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));let i=t===`transform`?await this._getBox(e,n,r):await this._getReshape(e,n,r);if($(i))return i;let a=new G({activeComponent:i,type:`update`,onEnd:()=>{y(s),y(o),a.activeComponent&&!a.activeComponent.destroyed&&a.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Y(a,this.updateGraphics.toArray()),a.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:a.tool})},redo:()=>{X(a,this.updateGraphics.toArray()),a.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:a.tool})},addToSelection:async e=>{let t=a.activeComponent;if(t?.type===`reshape`){let t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),a.onEnd(),a.destroy();let i=await this._setupTransformOrReshape2DOperation(t,`transform`,n,r);if($(i))return;this._setUpdateOperationHandle(i,n)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),a.resetHistory();this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:`selection-change`},type:`update`})},removeFromSelection:e=>{let t=this.updateGraphics.indexOf(e);a.history.undo.forEach(e=>e.updates.splice(t,1)),a.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);let n=this.updateGraphics.toArray();n.length===0?a.complete():an(n)?a.toggleTool():a.activeComponent.graphics=n,this.emit(`update`,{graphics:n,state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:`selection-change`},type:`update`})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;let e=this.updateGraphics.at(0),t=e.geometry;if(t!=null&&(a.tool===`reshape`&&t.type===`point`||a.tool===`transform`&&t.type===`extent`))return;let i=null;a.tool===`transform`?i=await this._getReshape([e],n,r):a.tool===`reshape`&&(i=await this._getBox([e],n,r)),$(i)||(a.activeComponent?.destroy(),a.activeComponent=i,a.activeComponent&&(y(s),s=this._getHandlesForComponent(a,n)))}}),o=[r.on(`immediate-click`,e=>this._getCommonUpdateOperationClickHandlers(a,e,n),T.WIDGET),r.on(`key-down`,e=>{if(this._getCommonUpdateOperationKeyDownHandlers(a,e),e.key===b.constraint&&!e.repeat&&a){let e=a.activeComponent;e?.type===`box`&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},T.WIDGET),r.on(`key-up`,e=>{if(e.key===b.constraint&&a){let e=a.activeComponent;e?.type===`box`&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},T.WIDGET)],s=this._getHandlesForComponent(a,n);return a}async _getGraphicMover(t,n,r){let{enableMoveAllGraphics:i,highlightOptions:a}=n,o=await this._requireModule(e(()=>import(`./GraphicMover-BJk1rYvZ.js`),__vite__mapDeps([209,71,1,2,210,84,76,211,37])));return $(o)?o:new o.module.default({enableMoveAllGraphics:i,highlightName:a?.name,highlightsEnabled:!!a?.enabled,indicatorsEnabled:!1,graphics:t,view:r,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:n})=>{this._displayCursor(`grabbing`),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move-start`},type:`update`})},onGraphicMove:({dx:e,dy:t,graphic:n})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move`},type:`update`}),onGraphicMoveStop:({dx:e,dy:t,graphic:n})=>{this._displayCursor(`pointer`),this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:`move-stop`},type:`update`})},onGraphicPointerOver:()=>this._displayCursor(`move`),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(t,n,r){let{enableRotation:i,enableScaling:a,highlightOptions:o,preserveAspectRatio:s}=n,[c,l]=await Promise.all([this._requireModule(e(()=>import(`./Box-mqxLebif.js`),__vite__mapDeps([212,1,2,5,62,10,11,64,65,63,66,67,68,69,70,27,12,14,13,15,71,210,84,76,211,37,213,80,184,185]))),B()]);if($(c))return c;let u=this.view?.inputManager?.isModifierKeyDown(b.constraint);return new c.module.default({graphics:t,enableRotation:i,enableScaling:a,highlightName:o?.name,highlightsEnabled:!!o?.enabled,preserveAspectRatio:!!s!=!!u,layer:this._internalGraphicsLayer,view:r,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:l,callbacks:{onMoveStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onMove:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onMoveStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScaleStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScale:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onScaleStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotateStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotate:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onRotateStop:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`})}})}async _getReshape(t,n,r){let{highlightOptions:i,reshapeOptions:a}=n,o=a?.edgeOperation===`split`,s=a?.shapeOperation===`move`,c=!!a?.enableCreateCurveFromStraightEdge,[l,u,d]=await Promise.all([this._requireModule(e(()=>import(`./Reshape-BONCTV-_.js`),__vite__mapDeps([214,1,2,49,50,51,52,53,54,4,5,81,215,62,10,58,11,64,65,57,59,63,66,67,68,69,70,27,12,14,13,15,55,56,79,8,71,16,82,172,216,217,83,75,76,19,20,31,77,24,78,182,210,84,211,37,213,80,185]))),z(),B()]);return $(l)?l:new l.module.default({enableMidpoints:o,enableMovement:s,enableCurveOnMidpoint:c,graphic:t[0],highlightName:i?.name,highlightsEnabled:!!i?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:u,automaticLengthMeasurementUtils:d,view:r,callbacks:{onReshapeStart:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onReshape:e=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:`update`}),onReshapeStop:({mover:e,type:t})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:`update`}),onMoveStart:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onMove:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onMoveStop:({dx:e,dy:t,mover:n,type:r})=>this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:n,type:r},type:`update`}),onVertexAdd:({added:e,type:t,vertices:n})=>{let r=e.map(e=>ge(e.geometry));this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{added:r,vertices:n,type:t},type:`update`})},onVertexRemove:({removed:e,type:t,vertices:n})=>{let r=e.map(e=>ge(e.geometry));this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{removed:r,vertices:n,type:t},type:`update`})}}})}_getHandlesForComponent(e,t){let n=e.activeComponent;if(!n)return[];switch(n.type){case`graphic-mover`:return[n.on(`graphic-click`,({graphic:n,viewEvent:r})=>{r.native?.shiftKey&&t.multipleSelectionEnabled&&(r.stopPropagation(),e.removeFromSelection(n))}),n.on(`graphic-move-start`,t=>e.addToHistory(Z(t.allGraphics)))];case`box`:return[n.on(`graphic-click`,n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),n.on(`move-start`,t=>e.addToHistory(Z(t.graphics))),n.on(`rotate-start`,t=>e.addToHistory(Z(t.graphics))),n.on(`scale-start`,t=>e.addToHistory(Z(t.graphics)))];case`reshape`:return[n.on(`graphic-click`,n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),n.on(`move-start`,t=>e.addToHistory(Z([t.mover]))),n.on(`reshape-start`,t=>e.addToHistory(Z([t.graphic]))),n.on(`vertex-add`,t=>e.addToHistory(Z([t.oldGraphic]))),n.on(`vertex-remove`,t=>e.addToHistory(Z([t.oldGraphic])))];case`move-3d`:return[n.events.on(`record-undo`,({updates:t})=>{e.addToHistory({updates:t})}),n.events.on(`move-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move-start`},type:`update`})}),n.events.on(`move`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move`},type:`update`})}),n.events.on(`move-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:`move-stop`},type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case`transform-3d`:return[n.events.on(`record-undo`,({updates:t})=>{e.addToHistory({updates:t})}),n.events.on(`translate-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move-start`},type:`update`})}),n.events.on(`translate-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move-stop`},type:`update`})}),n.events.on(`rotate-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate-start`},type:`update`})}),n.events.on(`rotate-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate-stop`},type:`update`})}),n.events.on(`scale-start`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale-start`},type:`update`})}),n.events.on(`scale-stop`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale-stop`},type:`update`})}),n.events.on(`translate`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:`move`},type:`update`})}),n.events.on(`rotate`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:`rotate`},type:`update`})}),n.events.on(`scale`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:`scale`},type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case`reshape-3d`:return[n.events.on(`reshape`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:`update`})}),n.events.on(`move`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:`update`})}),n.events.on(`vertex-add`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:e,type:`update`})}),n.events.on(`vertex-remove`,e=>{this.emit(`update`,{graphics:this.updateGraphics.toArray(),state:`active`,aborted:!1,tool:this.activeTool,toolEventInfo:e,type:`update`})}),n.events.on(`immediate-click`,n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,n){let{graphic:r,viewEvent:i}=n;return i.native?.shiftKey&&this.hasGraphic(r)?(i.stopPropagation(),e.removeFromSelection(r)):t.toggleToolOnClick?(i.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;let n=this.view?.map;this._disablePopup(t),e.on(`complete`,()=>{if(e===this._operationHandle){let r=this.updateGraphics.toArray(),i=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),n&&n.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit(`update`,{graphics:r,state:`complete`,aborted:e.cancelled,tool:i,toolEventInfo:null,type:`update`})}})}async _getCommonUpdateOperationClickHandlers(e,t,n){let r=_e(t),i=await t.defer(()=>this._getFirstHit(r));if(i==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([i.graphic],e,n))return void t.stopPropagation();this.updateGraphics.includes(i.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,n){let r=!!n.multipleSelectionEnabled;return e.some(e=>e!=null&&!(!r||!this.hasGraphic(e))&&(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;let n=t.key;n===b.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):n===b.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):n===b.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&b.delete.includes(n)&&this._onDeleteKey(t)}_onDeleteKey(e){this._operationHandle&&this._operationHandle.type===`update`&&this.activeComponent!=null&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&=(this.view?.map?.remove(this._internalGraphicsLayer),S(this._internalGraphicsLayer))}_isComponentGraphic(e){let{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type===`draw-2d`&&t.graphic===e||(t.type===`box`||t.type===`reshape`)&&t.isUIGraphic(e))}_clearCursor(){this.removeHandles(q)}_displayCursor(e){this.removeHandles(q),this.view?.container&&e!=null&&this.addHandles(this.view.acquireCursor(e,`high`),q)}_logError(e,n,r){c.getLogger(this).error(new t(e,n,r))}async _requireModule(e){let t=new AbortController;this._moduleLoaderAbortController=t;let n=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:`aborted`}:{module:n}}_emitUndoEvent(e){this.emit(`undo`,{...e,type:`undo`})}_emitRedoEvent(e){this.emit(`redo`,{...e,type:`redo`})}_emitDeleteEvent(e){this.emit(`delete`,{...e,type:`delete`})}_onLayerGraphicsChangeCallback(e){if(this._operationHandle!=null){let{updateGraphics:t}=this;for(let n of e.removed)if(t.includes(n)){if(!(t.length>1)){this._operationHandle.cancel();break}this._operationHandle.removeFromSelection(n)}}}get test(){}wait(){return ue(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!==`3d`||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){let e=this.view;e?(ne(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await le(ue(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError(`sketch:missing-property`,ln(`view`))}_logMissingLayer(){this._logError(cn,ln(`layer`))}};C([o()],J.prototype,`_defaultSnappingManager`,void 0),C([o()],J.prototype,`_layerAdapter`,null),C([o()],J.prototype,`_operationHandle`,void 0),C([o({readOnly:!0})],J.prototype,`_updatingHandles`,void 0),C([o({readOnly:!0})],J.prototype,`activeTool`,null),C([o({readOnly:!0})],J.prototype,`activeCreateToolDrawMode`,null),C([o()],J.prototype,`activeTooltip`,null),C([o({types:h})],J.prototype,`activeFillSymbol`,void 0),C([o()],J.prototype,`activeLineSymbol`,void 0),C([o()],J.prototype,`activeVertexSymbol`,void 0),C([o()],J.prototype,`allowDeleteKey`,void 0),C([o({readOnly:!0})],J.prototype,`createGraphic`,null),C([o()],J.prototype,`defaultCreateOptions`,null),C([o()],J.prototype,`defaultUpdateOptions`,null),C([o({type:Ge,nonNullable:!0})],J.prototype,`labelOptions`,null),C([o()],J.prototype,`layer`,void 0),C([o({types:h})],J.prototype,`pointSymbol`,void 0),C([o({types:h})],J.prototype,`polygonSymbol`,void 0),C([o({types:h})],J.prototype,`polylineSymbol`,void 0),C([o()],J.prototype,`meshSymbol`,void 0),C([o({type:f})],J.prototype,`textSymbol`,null),C([o({type:P,nonNullable:!0})],J.prototype,`snappingOptions`,null),C([o()],J.prototype,`snappingManager`,null),C([o({readOnly:!0})],J.prototype,`state`,null),C([o({type:qe,nonNullable:!0})],J.prototype,`tooltipOptions`,null),C([o({readOnly:!0})],J.prototype,`updateGraphics`,void 0),C([o()],J.prototype,`updateOnGraphicClick`,void 0),C([o()],J.prototype,`updating`,null),C([o()],J.prototype,`creationMode`,void 0),C([o({type:Ke,nonNullable:!0})],J.prototype,`valueOptions`,null),C([o({types:h})],J.prototype,`vertexSymbol`,void 0),C([o({value:null})],J.prototype,`view`,null),C([o({constructOnly:!0,type:Je})],J.prototype,`sketchOptions`,void 0),J=C([v(`esri.widgets.Sketch.SketchViewModel`)],J);var cn=`sketch:missing-property`,ln=e=>`Property '${e}' is missing on SketchViewModel.`;function un(e){return e===`polygon`||e===`rectangle`||e===`circle`}function Y(e,t){dn(`undo`,e.history.undo,e.history.redo,t)}function X(e,t){dn(`redo`,e.history.redo,e.history.undo,t)}function dn(e,t,n,r){let i=t.pop();if(!i)return;let a=i.updates,o=[];r.forEach((t,n)=>{let r=a[n];r!=null&&(`geometry`in r&&r.geometry!=null&&(o.push({geometry:t.geometry}),t.geometry=r.geometry),`symbol`in r&&r.symbol!=null&&(o.push({symbol:t.symbol}),t.symbol=r.symbol),`undo`in r&&(o.push(r),r[e](t)))}),n.push({updates:o})}function fn(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function Z(e){return{updates:e.map(({geometry:e})=>e?.type===`mesh`?{geometry:e.cloneShallow()}:{geometry:e})}}function Q(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function $(e){return`requireError`in e&&e.requireError===`aborted`}export{P as n,N as r,J as t};