import{$T as e,A as t,AE as n,Ad as r,BT as i,CE as a,DS as o,Dv as s,Eu as c,Ex as l,Fa as u,GT as d,JT as f,Kg as p,Kh as m,Kx as h,L as g,Ld as _,Lx as v,M as y,Md as ee,Od as b,PE as te,QT as x,Rd as ne,Rh as re,Tu as ie,UC as ae,UT as S,Ua as oe,V as se,VT as C,Vd as ce,Vg as le,WT as w,ZS as T,cp as ue,cy as de,eE as fe,ha as E,hv as D,iw as O,jE as pe,kC as me,kD as k,kd as he,kv as ge,kw as A,lv as _e,mE as ve,nC as ye,oT as be,qT as xe,qh as Se,sD as Ce,ua as we,vx as Te,xu as Ee,zv as De}from"./index-BN8X5Ryz.js";import{t as Oe}from"./commonProperties-CaHgSHvW.js";import{t as ke}from"./originUtils-CJnuu7mB.js";import{C as Ae,T as je,_ as Me,a as Ne,b as Pe,c as Fe,d as Ie,g as Le,h as Re,l as ze,n as j,r as Be,u as Ve,v as He,x as Ue}from"./networkEnums-DSwvS-2R.js";import{t as We}from"./GPMessage-BiUuPRZS.js";import{a as Ge,i as Ke,n as qe,r as Je,t as Ye}from"./RouteInfo-2q8j8fQj.js";import{c as Xe,i as M,n as N,r as P,s as Ze,t as F}from"./Stop-DH13WZls.js";var I=class extends O{constructor(e){super(e),this.break=new _({color:[255,255,255],size:12,outline:{color:[0,122,194],width:3}}),this.first=new _({color:[0,255,0],size:20,outline:{color:[255,255,255],width:4}}),this.unlocated=new _({color:[255,0,0],size:12,outline:{color:[255,255,255],width:3}}),this.last=new _({color:[255,0,0],size:20,outline:{color:[255,255,255],width:4}}),this.middle=new _({color:[51,51,51],size:12,outline:{color:[0,122,194],width:3}}),this.waypoint=new _({color:[255,255,255],size:12,outline:{color:[0,122,194],width:3}})}};k([i({types:r})],I.prototype,`break`,void 0),k([i({types:r})],I.prototype,`first`,void 0),k([i({types:r})],I.prototype,`unlocated`,void 0),k([i({types:r})],I.prototype,`last`,void 0),k([i({types:r})],I.prototype,`middle`,void 0),k([i({types:r})],I.prototype,`waypoint`,void 0),I=k([C(`esri.layers.support.RouteStopSymbols`)],I);var L=class extends O{constructor(e){super(e),this.directionLines=new ce({color:[0,122,194],width:6}),this.directionPoints=new _({color:[255,255,255],size:6,outline:{color:[0,122,194],width:2}}),this.pointBarriers=new _({style:`x`,size:10,outline:{color:[255,0,0],width:3}}),this.polygonBarriers=new ne({color:[255,170,0,.6],outline:{width:7.5,color:[255,0,0,.6]}}),this.polylineBarriers=new ce({width:7.5,color:[255,85,0,.7]}),this.routeInfo=new ce({width:8,color:[20,89,127]}),this.stops=new I}};k([i({types:he})],L.prototype,`directionLines`,void 0),k([i({types:r})],L.prototype,`directionPoints`,void 0),k([i({types:r})],L.prototype,`pointBarriers`,void 0),k([i({types:ee})],L.prototype,`polygonBarriers`,void 0),k([i({types:he})],L.prototype,`polylineBarriers`,void 0),k([i({types:he})],L.prototype,`routeInfo`,void 0),k([i({type:I})],L.prototype,`stops`,void 0),L=k([C(`esri.layers.support.RouteSymbols`)],L);var R=class extends O{constructor(e){super(e),this.dataType=null,this.name=null,this.parameterNames=null,this.restrictionUsageParameterName=null,this.timeNeutralAttributeName=null,this.trafficSupport=null,this.units=null,this.usageType=null}};k([i({type:String})],R.prototype,`dataType`,void 0),k([d(j,{ignoreUnknown:!1})],R.prototype,`name`,void 0),k([i({type:[String]})],R.prototype,`parameterNames`,void 0),k([i({type:String})],R.prototype,`restrictionUsageParameterName`,void 0),k([d(Fe,{ignoreUnknown:!1})],R.prototype,`timeNeutralAttributeName`,void 0),k([i({type:String})],R.prototype,`trafficSupport`,void 0),k([d(Me)],R.prototype,`units`,void 0),k([d(Ve)],R.prototype,`usageType`,void 0),R=k([C(`esri.rest.support.NetworkAttribute`)],R);var Qe=R,z=class extends O{constructor(e){super(e),this.buildTime=null,this.name=null,this.networkAttributes=null,this.networkSources=null,this.state=null}};k([i({type:Number})],z.prototype,`buildTime`,void 0),k([i({type:String})],z.prototype,`name`,void 0),k([i({type:[Qe]})],z.prototype,`networkAttributes`,void 0),k([i()],z.prototype,`networkSources`,void 0),k([i({type:String})],z.prototype,`state`,void 0),z=k([C(`esri.rest.support.NetworkDataset`)],z);var $e=z,B=class extends O{constructor(e){super(e),this.accumulateAttributeNames=null,this.attributeParameterValues=null,this.currentVersion=null,this.defaultTravelMode=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsSupportedLanguages=null,this.directionsTimeAttribute=null,this.hasZ=null,this.impedance=null,this.networkDataset=null,this.supportedTravelModes=null}readAccumulateAttributes(e){return e==null?null:e.map(e=>j.fromJSON(e))}writeAccumulateAttributes(e,t,n){e?.length&&(t[n]=e.map(e=>j.toJSON(e)))}get capabilities(){return{supportsNow:(this.currentVersion??10)>=10.81}}readDefaultTravelMode(e,t){let n=t.supportedTravelModes?.find(({id:e})=>e===t.defaultTravelMode)??t.supportedTravelModes?.find(({itemId:e})=>e===t.defaultTravelMode);return n?Ge.fromJSON(n):null}};k([i()],B.prototype,`accumulateAttributeNames`,void 0),k([w(`accumulateAttributeNames`)],B.prototype,`readAccumulateAttributes`,null),k([S(`accumulateAttributeNames`)],B.prototype,`writeAccumulateAttributes`,null),k([i()],B.prototype,`attributeParameterValues`,void 0),k([i()],B.prototype,`capabilities`,null),k([i()],B.prototype,`currentVersion`,void 0),k([i()],B.prototype,`defaultTravelMode`,void 0),k([w(`defaultTravelMode`,[`defaultTravelMode`,`supportedTravelModes`])],B.prototype,`readDefaultTravelMode`,null),k([i()],B.prototype,`directionsLanguage`,void 0),k([d(ze)],B.prototype,`directionsLengthUnits`,void 0),k([i()],B.prototype,`directionsSupportedLanguages`,void 0),k([d(Fe,{ignoreUnknown:!1})],B.prototype,`directionsTimeAttribute`,void 0),k([i()],B.prototype,`hasZ`,void 0),k([d(j,{ignoreUnknown:!1})],B.prototype,`impedance`,void 0),k([i({type:$e})],B.prototype,`networkDataset`,void 0),k([i({type:[Ge]})],B.prototype,`supportedTravelModes`,void 0),B=k([C(`esri.rest.support.NetworkServiceDescription`)],B);var et=()=>a.getLogger(`esri.rest.networkService`);function tt(e,t,n,r){r[n]=[t.length,t.length+e.length],e.forEach(e=>{t.push(e.geometry)})}function nt(e,t){for(let n=0;n<t.length;n++){let r=e[t[n]];if(r&&r.length)for(let e of r)e.z=void 0}et().warnOnce(`The remote Network Analysis service is powered by a network dataset which is not Z-aware.
Z-coordinates of the input geometry are ignored.`)}function rt(e,t){for(let n=0;n<t.length;n++){let r=e[t[n]];if(r&&r.length){for(let e of r)if(e!=null&&e.hasZ)return!0}}return!1}async function it(t,n,r){if(!t)throw new e(`network-service:missing-url`,`Url to Network service is missing`);let i=c({f:`json`,token:n},r),{data:a}=await T(t,i),o=a.currentVersion>=10.4?ot(t,n,r):at(t,r),{defaultTravelMode:s,supportedTravelModes:l}=await o;return a.defaultTravelMode=s,a.supportedTravelModes=l,B.fromJSON(a)}async function at(e,t){let n=c({f:`json`},t),{data:r}=await T(e.replace(/\/rest\/.*$/i,`/info`),n);if(!r?.owningSystemUrl)return{supportedTravelModes:[],defaultTravelMode:null};let{owningSystemUrl:i}=r,a=ae(i)+`/sharing/rest/portals/self`,{data:o}=await T(a,n),s=te(`helperServices.routingUtilities.url`,o);if(!s)return{supportedTravelModes:[],defaultTravelMode:null};let l=ie(i),u=/\/solve$/i.test(l.path)?`Route`:/\/solveclosestfacility$/i.test(l.path)?`ClosestFacility`:`ServiceAreas`,d=c({f:`json`,serviceName:u},t),f=ae(s)+`/GetTravelModes/execute`,p=await T(f,d),m=[],h=null;if(p?.data?.results?.length){let e=p.data.results;for(let t of e)if(t.paramName===`supportedTravelModes`){if(t.value?.features){for(let{attributes:e}of t.value.features)if(e){let t=JSON.parse(e.TravelMode);m.push(t)}}}else t.paramName===`defaultTravelMode`&&(h=t.value)}return{supportedTravelModes:m,defaultTravelMode:h}}async function ot(t,n,r){try{let e=c({f:`json`,token:n},r),i=ae(t)+`/retrieveTravelModes`,{data:{supportedTravelModes:a,defaultTravelMode:o}}=await T(i,e);return{supportedTravelModes:a,defaultTravelMode:o}}catch(t){throw new e(`network-service:retrieveTravelModes`,`Could not get to the NAServer's retrieveTravelModes.`,{error:t})}}var st=new xe({0:`informative`,1:`process-definition`,2:`process-start`,3:`process-stop`,50:`warning`,100:`error`,101:`empty`,200:`abort`}),ct=class extends We{constructor(e){super(e),this.type=null}};k([i({type:String,json:{read:st.read,write:st.write}})],ct.prototype,`type`,void 0),ct=k([C(`esri.rest.support.NAMessage`)],ct);var lt=ct,V=class extends O{constructor(e){super(e)}};k([i({json:{read:{source:`string`}}})],V.prototype,`text`,void 0),k([d(Pe,{name:`stringType`})],V.prototype,`type`,void 0),V=k([C(`esri.rest.support.DirectionsString`)],V);var ut=V,H=class extends O{constructor(e){super(e),this.arriveTime=null,this.arriveTimeOffset=null,this.geometry=null,this.strings=null}readArriveTimeOffset(e,t){return Xe(t.ETA,t.arriveTimeUTC)}readGeometry(e,t){return l.fromJSON(t.point)}};k([i({type:Date,json:{read:{source:`arriveTimeUTC`}}})],H.prototype,`arriveTime`,void 0),k([i()],H.prototype,`arriveTimeOffset`,void 0),k([w(`arriveTimeOffset`,[`arriveTimeUTC`,`ETA`])],H.prototype,`readArriveTimeOffset`,null),k([i({type:l})],H.prototype,`geometry`,void 0),k([w(`geometry`,[`point`])],H.prototype,`readGeometry`,null),k([i({type:[ut]})],H.prototype,`strings`,void 0),H=k([C(`esri.rest.support.DirectionsEvent`)],H);var dt=H;function ft(e){if(e==null||e===``)return null;let t=0,n=0,r=0,i=0,a=[],o,s,c,l,u,d,f,p,m=0,h=0,g=0;if(u=e.match(/((\+|-)[^+\-|]+|\|)/g),u||=[],parseInt(u[m],32)===0){m=2;let e=parseInt(u[m],32);m++,d=parseInt(u[m],32),m++,1&e&&(h=u.indexOf(`|`)+1,f=parseInt(u[h],32),h++),2&e&&(g=u.indexOf(`|`,h)+1,p=parseInt(u[g],32),g++)}else d=parseInt(u[m],32),m++;for(;m<u.length&&u[m]!==`|`;){o=parseInt(u[m],32)+t,m++,t=o,s=parseInt(u[m],32)+n,m++,n=s;let e=[o/d,s/d];h&&(l=parseInt(u[h],32)+r,h++,r=l,e.push(l/f)),g&&(c=parseInt(u[g],32)+i,g++,i=c,e.push(c/p)),a.push(e)}return{paths:[a],hasZ:h>0,hasM:g>0}}var U=class extends b{constructor(e){super(e),this.events=null,this.geometry=null,this.strings=null}set attributes(e){super.attributes=e}readGeometry(e,t){let n=ft(t.compressedGeometry);return n==null?null:De.fromJSON(n)}};k([i({type:[dt]})],U.prototype,`events`,void 0),k([i({type:De})],U.prototype,`geometry`,void 0),k([w(`geometry`,[`compressedGeometry`])],U.prototype,`readGeometry`,null),k([i({type:[ut]})],U.prototype,`strings`,void 0),U=k([C(`esri.rest.support.DirectionsFeature`)],U);var pt=U;function mt(e,t){if(e.length===0)return new De({spatialReference:t});let n=[];for(let t of e)for(let e of t.paths)n.push(...e);let r=[];n.forEach((e,t)=>{t!==0&&e[0]===n[t-1][0]&&e[1]===n[t-1][1]||r.push(e)});let{hasM:i,hasZ:a}=e[0];return new De({hasM:i,hasZ:a,paths:[r],spatialReference:t})}var W=class extends E{constructor(e){super(e),this.extent=null,this.features=[],this.geometryType=`polyline`,this.routeId=null,this.routeName=null,this.totalDriveTime=null,this.totalLength=null,this.totalTime=null}readFeatures(e,t){if(!e)return[];let n=t.summary.envelope.spatialReference??t.spatialReference,r=n&&v.fromJSON(n);return e.map(e=>{let t=pt.fromJSON(e);if(t.geometry!=null&&(t.geometry.spatialReference=r),t.events!=null)for(let e of t.events)e.geometry!=null&&(e.geometry.spatialReference=r);return t})}get mergedGeometry(){return this.features?mt(this.features.map(({geometry:e})=>e),this.extent.spatialReference):null}get strings(){return this.features.flatMap(({strings:e})=>e).filter(Ce)}};k([i({type:Te,json:{read:{source:`summary.envelope`}}})],W.prototype,`extent`,void 0),k([i({nonNullable:!0})],W.prototype,`features`,void 0),k([w(`features`)],W.prototype,`readFeatures`,null),k([i()],W.prototype,`geometryType`,void 0),k([i({readOnly:!0})],W.prototype,`mergedGeometry`,null),k([i()],W.prototype,`routeId`,void 0),k([i()],W.prototype,`routeName`,void 0),k([i({value:null,readOnly:!0})],W.prototype,`strings`,null),k([i({json:{read:{source:`summary.totalDriveTime`}}})],W.prototype,`totalDriveTime`,void 0),k([i({json:{read:{source:`summary.totalLength`}}})],W.prototype,`totalLength`,void 0),k([i({json:{read:{source:`summary.totalTime`}}})],W.prototype,`totalTime`,void 0),W=k([C(`esri.rest.support.DirectionsFeatureSet`)],W);var ht=W,G=class extends O{constructor(e){super(e),this.directionLines=null,this.directionPoints=null,this.directions=null,this.route=null,this.routeName=null,this.stops=null,this.traversedEdges=null,this.traversedJunctions=null,this.traversedTurns=null}};k([i({type:E,json:{write:!0}})],G.prototype,`directionLines`,void 0),k([i({type:E,json:{write:!0}})],G.prototype,`directionPoints`,void 0),k([i({type:ht,json:{write:!0}})],G.prototype,`directions`,void 0),k([i({type:b,json:{write:!0}})],G.prototype,`route`,void 0),k([i({type:String,json:{write:!0}})],G.prototype,`routeName`,void 0),k([i({type:[b],json:{write:!0}})],G.prototype,`stops`,void 0),k([i({type:E,json:{write:!0}})],G.prototype,`traversedEdges`,void 0),k([i({type:E,json:{write:!0}})],G.prototype,`traversedJunctions`,void 0),k([i({type:E,json:{write:!0}})],G.prototype,`traversedTurns`,void 0),G=k([C(`esri.rest.support.RouteResult`)],G);var gt=G;function _t(e){return e?E.fromJSON(e).features.filter(Ce):[]}var K=class extends O{constructor(e){super(e),this.checksum=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(e,t){return _t(t.barriers)}readPolylineBarriers(e){return _t(e)}readPolygonBarriers(e){return _t(e)}};k([i({type:String})],K.prototype,`checksum`,void 0),k([i({type:[lt]})],K.prototype,`messages`,void 0),k([i({type:[b]})],K.prototype,`pointBarriers`,void 0),k([w(`pointBarriers`,[`barriers`])],K.prototype,`readPointBarriers`,null),k([i({type:[b]})],K.prototype,`polylineBarriers`,void 0),k([w(`polylineBarriers`)],K.prototype,`readPolylineBarriers`,null),k([i({type:[b]})],K.prototype,`polygonBarriers`,void 0),k([w(`polygonBarriers`)],K.prototype,`readPolygonBarriers`,null),k([i({type:[gt]})],K.prototype,`routeResults`,void 0),K=k([C(`esri.rest.support.RouteSolveResult`)],K);function vt(e){return e instanceof E}async function yt(e,t,n){let r=[],i=[],a={},o={},s=ie(e),{path:c}=s;vt(t.stops)&&tt(t.stops.features,i,`stops.features`,a),vt(t.pointBarriers)&&tt(t.pointBarriers.features,i,`pointBarriers.features`,a),vt(t.polylineBarriers)&&tt(t.polylineBarriers.features,i,`polylineBarriers.features`,a),vt(t.polygonBarriers)&&tt(t.polygonBarriers.features,i,`polygonBarriers.features`,a);let l=await Ee(i);for(let e in a){let t=a[e];r.push(e),o[e]=l.slice(t[0],t[1])}if(rt(o,r)){let e=null;try{e=await it(c,t.apiKey,n)}catch{}e&&!e.hasZ&&nt(o,r)}for(let e in o)o[e].forEach((n,r)=>{fe(t,e)[r].geometry=n});let u={...n,query:{...s.query,...Ze(t),f:`json`}},d=c.endsWith(`/solve`)?c:`${c}/solve`,{data:f}=await T(d,u);return bt(f)}function bt(e){let{barriers:t,checksum:n,directionLines:r,directionPoints:i,directions:a,messages:o,polygonBarriers:s,polylineBarriers:c,routes:l,stops:u,traversedEdges:d,traversedJunctions:f,traversedTurns:p}=e,m=e=>{let t=g.find(t=>t.routeName===e);if(t!=null)return t;let n={routeId:g.length+1,routeName:e};return g.push(n),n},h=e=>{let t=g.find(t=>t.routeId===e);if(t!=null)return t;let n={routeId:e,routeName:null};return g.push(n),n},g=[];l?.features.forEach((e,t)=>{e.geometry.spatialReference=l.spatialReference??void 0;let n=e.attributes.Name,r=t+1;g.push({routeId:r,routeName:n,route:e})}),a?.forEach(e=>{let{routeName:t}=e;m(t).directions=e});let _=(u?.features.every(e=>e.attributes.RouteName==null)??!1)&&g.length>0?g[0].routeName:null;return u?.features.forEach(e=>{e.geometry&&(e.geometry.spatialReference??=u.spatialReference??void 0);let t=_??e.attributes.RouteName,n=m(t);n.stops??=[],n.stops.push(e)}),r?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t),{geometryType:i,spatialReference:a}=r;n.directionLines??={features:[],geometryType:i,spatialReference:a},n.directionLines.features.push(e)}),i?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t),{geometryType:r,spatialReference:a}=i;n.directionPoints??={features:[],geometryType:r,spatialReference:a},n.directionPoints.features.push(e)}),d?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t),{geometryType:r,spatialReference:i}=d;n.traversedEdges??={features:[],geometryType:r,spatialReference:i},n.traversedEdges.features.push(e)}),f?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t),{geometryType:r,spatialReference:i}=f;n.traversedJunctions??={features:[],geometryType:r,spatialReference:i},n.traversedJunctions.features.push(e)}),p?.features.forEach(e=>{let t=e.attributes.RouteID,n=h(t);n.traversedTurns??={features:[]},n.traversedTurns.features.push(e)}),K.fromJSON({barriers:t,checksum:n,messages:o,polygonBarriers:s,polylineBarriers:c,routeResults:g})}var q=class extends A(O){constructor(e){super(e),this.doNotLocateOnRestrictedElements=null,this.geometry=null,this.geometryType=null,this.name=null,this.spatialRelationship=null,this.type=`layer`,this.where=null}};k([i({type:Boolean,json:{write:!0}})],q.prototype,`doNotLocateOnRestrictedElements`,void 0),k([i({types:s,json:{read:ge,write:!0}})],q.prototype,`geometry`,void 0),k([d(Ne)],q.prototype,`geometryType`,void 0),k([i({type:String,json:{name:`layerName`,write:!0}})],q.prototype,`name`,void 0),k([d(Be,{name:`spatialRel`})],q.prototype,`spatialRelationship`,void 0),k([i({type:String,json:{write:!0}})],q.prototype,`type`,void 0),k([i({type:String,json:{write:!0}})],q.prototype,`where`,void 0),q=k([C(`esri.rest.support.DataLayer`)],q);var J=class extends A(O){constructor(e){super(e),this.name=null,this.where=null}};k([x({json:{write:!0}})],J.prototype,`name`,void 0),k([x({json:{write:!0}})],J.prototype,`where`,void 0),J=k([f(`esri.rest.support.LocateSettingSource`)],J);var xt=J,St=class extends A(O){constructor(e){super(e),this.allowAutoRelocate=null,this.sources=null}};k([x({type:Boolean,json:{write:!0}})],St.prototype,`allowAutoRelocate`,void 0),k([x({type:[xt],json:{write:!0}})],St.prototype,`sources`,void 0),St=k([f(`esri.rest.support.LocateSettingBase`)],St);var Ct=St,wt=class extends Ct{constructor(e){super(e),this.tolerance=null,this.toleranceUnits=null}};k([x({type:Number,json:{write:!0}})],wt.prototype,`tolerance`,void 0),k([d(Ae)],wt.prototype,`toleranceUnits`,void 0),wt=k([f(`esri.rest.support.LocateSetting`)],wt);var Tt=wt,Y=class extends A(O){constructor(e){super(e),this.stops=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null}};k([x({type:Tt,json:{write:!0}})],Y.prototype,`stops`,void 0),k([x({type:Tt,json:{name:`barriers`,write:!0}})],Y.prototype,`pointBarriers`,void 0),k([x({type:Ct,json:{write:!0}})],Y.prototype,`polylineBarriers`,void 0),k([x({type:Ct,json:{write:!0}})],Y.prototype,`polygonBarriers`,void 0),Y=k([f(`esri.rest.support.LocateSettingsOverrides`)],Y);var Et=Y,Dt=class extends A(O){constructor(e){super(e),this.default=null,this.overrides=null}};k([x({type:Tt,json:{write:!0}})],Dt.prototype,`default`,void 0),k([x({type:Et,json:{write:!0}})],Dt.prototype,`overrides`,void 0),Dt=k([f(`esri.rest.support.LocateSettings`)],Dt);var Ot=Dt,kt,At=class extends E{static{kt=this}constructor(e){super(e),this.doNotLocateOnRestrictedElements=null}clone(){return new kt({doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements,...this.cloneProperties()})}};k([i({type:Boolean,json:{write:!0}})],At.prototype,`doNotLocateOnRestrictedElements`,void 0),At=kt=k([C(`esri.rest.support.NetworkFeatureSet`)],At);var jt=class extends A(O){constructor(e){super(e),this.doNotLocateOnRestrictedElements=null,this.url=null}};k([i({type:Boolean,json:{write:!0}})],jt.prototype,`doNotLocateOnRestrictedElements`,void 0),k([i({type:String,json:{write:!0}})],jt.prototype,`url`,void 0),jt=k([C(`esri.rest.support.NetworkUrl`)],jt);var Mt,X=class extends A(O){static{Mt=this}constructor(e){super(e),this.accumulateAttributes=null,this.apiKey=null,this.attributeParameterValues=null,this.checksum=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsOutputType=null,this.directionsStyleName=null,this.directionsTimeAttribute=null,this.findBestSequence=null,this.geometryPrecision=null,this.geometryPrecisionM=null,this.geometryPrecisionZ=null,this.ignoreInvalidLocations=null,this.impedanceAttribute=null,this.locateSettings=null,this.outputGeometryPrecision=null,this.outputGeometryPrecisionUnits=null,this.outputLines=`true-shape`,this.outSpatialReference=null,this.overrides=null,this.pointBarriers=null,this.polygonBarriers=null,this.polylineBarriers=null,this.preserveFirstStop=null,this.preserveLastStop=null,this.preserveObjectID=null,this.restrictionAttributes=null,this.restrictUTurns=null,this.returnBarriers=!1,this.returnDirections=!1,this.returnEmptyResults=null,this.returnPolygonBarriers=!1,this.returnPolylineBarriers=!1,this.returnRoutes=!0,this.returnStops=!1,this.returnTraversedEdges=null,this.returnTraversedJunctions=null,this.returnTraversedTurns=null,this.returnZ=!0,this.startTime=null,this.startTimeIsUTC=!0,this.stops=null,this.timeWindowsAreUTC=null,this.travelMode=null,this.useHierarchy=null,this.useTimeWindows=null}static from(e){return ve(Mt,e)}readAccumulateAttributes(e){return e==null?null:e.map(e=>j.fromJSON(e))}writeAccumulateAttributes(e,t,n){e?.length&&(t[n]=e.map(e=>j.toJSON(e)))}writePointBarriers(e,t,n){Rt(e,t,n)}writePolygonBarrier(e,t,n){Rt(e,t,n)}writePolylineBarrier(e,t,n){Rt(e,t,n)}readRestrictionAttributes(e){return e==null?null:e.map(e=>je.fromJSON(e))}writeRestrictionAttributes(e,t,n){e?.length&&(t[n]=e.map(e=>je.toJSON(e)))}readStartTime(e,t){let{startTime:n}=t;return n==null?null:n===`now`?`now`:new Date(n)}writeStartTime(e,t){e!=null&&(t.startTime=e===`now`?`now`:e.getTime())}readStops(e,t){return Lt(t.stops)}writeStops(e,t,n){Rt(e,t,n)}};function Nt(e){return e&&`type`in e}function Pt(e){return e&&`features`in e&&`doNotLocateOnRestrictedElements`in e}function Ft(e){return e&&`url`in e}function It(e){return e&&`features`in e}function Lt(e){return Nt(e)?q.fromJSON(e):Ft(e)?jt.fromJSON(e):Pt(e)?At.fromJSON(e):It(e)?E.fromJSON(e):null}function Rt(e,t,n){e!=null&&(t[n]=D.isCollection(e)?{features:e.toArray().map(e=>e.toJSON())}:e.toJSON())}k([i({type:[String],json:{name:`accumulateAttributeNames`,write:!0}})],X.prototype,`accumulateAttributes`,void 0),k([w(`accumulateAttributes`)],X.prototype,`readAccumulateAttributes`,null),k([S(`accumulateAttributes`)],X.prototype,`writeAccumulateAttributes`,null),k([i(Oe)],X.prototype,`apiKey`,void 0),k([i({json:{write:!0}})],X.prototype,`attributeParameterValues`,void 0),k([i({type:String,json:{write:!0}})],X.prototype,`checksum`,void 0),k([i({type:String,json:{write:!0}})],X.prototype,`directionsLanguage`,void 0),k([d(ze)],X.prototype,`directionsLengthUnits`,void 0),k([d(He)],X.prototype,`directionsOutputType`,void 0),k([d(Ie)],X.prototype,`directionsStyleName`,void 0),k([d(Fe,{name:`directionsTimeAttributeName`,ignoreUnknown:!1})],X.prototype,`directionsTimeAttribute`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`findBestSequence`,void 0),k([i({type:Number,json:{write:!0}})],X.prototype,`geometryPrecision`,void 0),k([i({type:Number,json:{write:!0}})],X.prototype,`geometryPrecisionM`,void 0),k([i({type:Number,json:{write:!0}})],X.prototype,`geometryPrecisionZ`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`ignoreInvalidLocations`,void 0),k([d(j,{name:`impedanceAttributeName`,ignoreUnknown:!1})],X.prototype,`impedanceAttribute`,void 0),k([i({type:Ot,json:{write:!0}})],X.prototype,`locateSettings`,void 0),k([i({type:Number,json:{write:!0}})],X.prototype,`outputGeometryPrecision`,void 0),k([d(Ue)],X.prototype,`outputGeometryPrecisionUnits`,void 0),k([d(Re)],X.prototype,`outputLines`,void 0),k([i({type:v,json:{name:`outSR`,write:!0}})],X.prototype,`outSpatialReference`,void 0),k([i({json:{write:!0}})],X.prototype,`overrides`,void 0),k([i({json:{name:`barriers`,write:!0}})],X.prototype,`pointBarriers`,void 0),k([S(`pointBarriers`)],X.prototype,`writePointBarriers`,null),k([i({json:{write:!0}})],X.prototype,`polygonBarriers`,void 0),k([S(`polygonBarriers`)],X.prototype,`writePolygonBarrier`,null),k([i({json:{write:!0}})],X.prototype,`polylineBarriers`,void 0),k([S(`polylineBarriers`)],X.prototype,`writePolylineBarrier`,null),k([i({type:Boolean,json:{write:!0}})],X.prototype,`preserveFirstStop`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`preserveLastStop`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`preserveObjectID`,void 0),k([i({type:[String],json:{name:`restrictionAttributeNames`,write:!0}})],X.prototype,`restrictionAttributes`,void 0),k([w(`restrictionAttributes`)],X.prototype,`readRestrictionAttributes`,null),k([S(`restrictionAttributes`)],X.prototype,`writeRestrictionAttributes`,null),k([d(Le)],X.prototype,`restrictUTurns`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnBarriers`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnDirections`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnEmptyResults`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnPolygonBarriers`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnPolylineBarriers`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnRoutes`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnStops`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnTraversedEdges`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnTraversedJunctions`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnTraversedTurns`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`returnZ`,void 0),k([i({json:{write:!0}})],X.prototype,`startTime`,void 0),k([w(`startTime`)],X.prototype,`readStartTime`,null),k([S(`startTime`)],X.prototype,`writeStartTime`,null),k([i({type:Boolean,json:{write:!0}})],X.prototype,`startTimeIsUTC`,void 0),k([i({json:{write:!0}})],X.prototype,`stops`,void 0),k([w(`stops`)],X.prototype,`readStops`,null),k([S(`stops`)],X.prototype,`writeStops`,null),k([i({type:Boolean,json:{write:!0}})],X.prototype,`timeWindowsAreUTC`,void 0),k([i({type:Ge,json:{write:!0}})],X.prototype,`travelMode`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`useHierarchy`,void 0),k([i({type:Boolean,json:{write:!0}})],X.prototype,`useTimeWindows`,void 0),X=Mt=k([C(`esri.rest.support.RouteParameters`)],X);function zt(e){if(!e.length)return;let t=e.toArray(),n=t.map(({objectId:e})=>e).filter(e=>e!=null),r=Math.max(...n,0);for(let e of t)e.objectId??=++r}function Bt(e,t){return e.length===t.length&&Vt(e)&&Vt(t)}function Vt(e){return e.every(({objectId:e})=>e!=null)}function Ht(e,t){return!!e.length||!!t.length}function Ut(e){return e.length?e:null}function Wt(e){switch(e){case`esriGeometryPoint`:return{type:`esriSMS`,style:`esriSMSCircle`,size:12,color:[0,0,0,0],outline:Wt(`esriGeometryPolyline`)};case`esriGeometryPolyline`:return{type:`esriSLS`,style:`esriSLSSolid`,width:1,color:[0,0,0,0]};case`esriGeometryPolygon`:return{type:`esriSFS`,style:`esriSFSNull`,outline:Wt(`esriGeometryPolyline`)}}}function Gt(e){return`layers`in e}function Kt(e){return e.declaredClass===`esri.rest.support.FeatureSet`}function qt(e){return e.declaredClass===`esri.rest.support.NetworkFeatureSet`}function Jt(e,t){for(let n of e){let e=t.find(e=>e.objectId===n.objectId);e&&(e.addedCost=n.addedCost,e.barrierType=n.barrierType,e.costs=n.costs,e.curbApproach=n.curbApproach,e.fullEdge=n.fullEdge,e.geometry=n.geometry,e.name=n.name,e.sideOfEdge=n.sideOfEdge,e.sourceId=n.sourceId,e.sourceOid=n.sourceOid,e.status=n.status,e.symbol=n.symbol)}}function Yt(e,t){for(let n of e){let e=t.find(e=>e.objectId===n.objectId);e&&(e.barrierType=n.barrierType,e.costs=n.costs,e.geometry=n.geometry,e.name=n.name,e.scaleFactor=n.scaleFactor,e.symbol=n.symbol)}}function Xt(e,t){for(let n of e){let e=t.find(e=>e.objectId===n.objectId);e&&(e.barrierType=n.barrierType,e.costs=n.costs,e.geometry=n.geometry,e.name=n.name,e.scaleFactor=n.scaleFactor,e.symbol=n.symbol)}}function Zt(e,t){for(let n of e){let e=t.find(e=>e.objectId===n.objectId);e&&(e.arriveCurbApproach=n.arriveCurbApproach,e.arriveTime=n.arriveTime,e.arriveTimeOffset=n.arriveTimeOffset,e.cumulativeCosts=n.cumulativeCosts,e.cumulativeDistance=n.cumulativeDistance,e.cumulativeDuration=n.cumulativeDuration,e.curbApproach=n.curbApproach,e.departCurbApproach=n.departCurbApproach,e.departTime=n.departTime,e.departTimeOffset=n.departTimeOffset,e.distanceToNetworkInMeters=n.distanceToNetworkInMeters,e.geometry=n.geometry,e.lateDuration=n.lateDuration,e.name=n.name,e.navLatency=n.navLatency,e.positionAlong=n.positionAlong,e.routeName=n.routeName,e.serviceCosts=n.serviceCosts,e.serviceDistance=n.serviceDistance,e.serviceDuration=n.serviceDuration,e.sequence=n.sequence,e.sideOfEdge=n.sideOfEdge,e.snapX=n.snapX,e.snapY=n.snapY,e.snapZ=n.snapZ,e.sourceId=n.sourceId,e.sourceOid=n.sourceOid,e.status=n.status,e.symbol=n.symbol,e.timeWindowEnd=n.timeWindowEnd,e.timeWindowStart=n.timeWindowStart,e.violations=n.violations,e.waitDuration=n.waitDuration,e.wait=n.wait)}}async function Qt(e){let t=v.WGS84;return await le(e.spatialReference,t),p(e,t)}function Z(e,t){if(t&&e?.length&&!e.every(({symbol:e})=>!!e))for(let n of e)n.symbol=t}function Q(e,t){switch(t){case`seconds`:return e/60;case`hours`:return 60*e;case`days`:return 60*e*24;default:return e}}function $t(e,t){return t===`decimal-degrees`||t===`points`||t===`unknown`?e:h(e,t,`meters`)}function en(e){let{attributes:t,geometry:n,popupTemplate:r,symbol:i}=e.toGraphic().toJSON();return{attributes:t,geometry:n,popupInfo:r,symbol:i}}var tn=D.ofType(Ke),nn=D.ofType(Je),rn=D.ofType(M),an=D.ofType(P),on=D.ofType(N),sn=D.ofType(F),$=class extends we(t(g(y(oe(re))))){constructor(e){super(e),this._cachedServiceDescription=null,this._featureCollection=null,this._type=`Feature Collection`,this.checksum=null,this.defaultSymbols=new L,this.directionLines=null,this.directionPoints=null,this.featureCollectionType=`route`,this.legendEnabled=!1,this.maxScale=0,this.minScale=0,this.pointBarriers=new rn,this.polygonBarriers=new an,this.polylineBarriers=new on,this.routeInfo=null,this.spatialReference=v.WGS84,this.stops=new sn,this.type=`route`}initialize(){let e=()=>{this._setStopSymbol(this.stops)},t=()=>{Z(this.pointBarriers,this.defaultSymbols.pointBarriers)},n=()=>{Z(this.polylineBarriers,this.defaultSymbols.polylineBarriers)},r=()=>{Z(this.polygonBarriers,this.defaultSymbols.polygonBarriers)};this.addHandles([_e(()=>this.stops,`change`,e,{sync:!0,onListenerAdd:e}),_e(()=>this.pointBarriers,`change`,t,{sync:!0,onListenerAdd:t}),_e(()=>this.polylineBarriers,`change`,n,{sync:!0,onListenerAdd:n}),_e(()=>this.polygonBarriers,`change`,r,{sync:!0,onListenerAdd:r})])}writeFeatureCollectionWebmap(e,t,n,r){let i=[this._writePolygonBarriers(),this._writePolylineBarriers(),this._writePointBarriers(),this._writeRouteInfo(),this._writeDirectionLines(),this._writeDirectionPoints(),this._writeStops()].filter(e=>!!e),a=i.map((e,t)=>t),o=r.origin===`web-map`?`featureCollection.layers`:`layers`;pe(o,i,t),t.opacity=this.opacity,t.visibility=this.visible,t.visibleLayers=a}readDirectionLines(e,t){return this._getNetworkFeatures(t,`DirectionLines`,e=>Ke.fromGraphic(e))}readDirectionPoints(e,t){return this._getNetworkFeatures(t,`DirectionPoints`,e=>Je.fromGraphic(e))}get fullExtent(){let e=new Te({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:v.WGS84});if(this.routeInfo?.geometry!=null)return this.routeInfo.geometry.extent??e;if(this.stops==null)return e;let t=this.stops.filter(e=>e.geometry!=null);if(t.length<2)return e;let{spatialReference:n}=t.at(0).geometry;if(n==null)return e;let r=t.toArray().map(e=>{let t=e.geometry;return[t.x,t.y]});return new de({points:r,spatialReference:n}).extent}readMaxScale(e,t){return((Gt(t)?t.layers:t.featureCollection?.layers)?.find(e=>e.layerDefinition.maxScale!=null))?.layerDefinition.maxScale??0}readMinScale(e,t){return((Gt(t)?t.layers:t.featureCollection?.layers)?.find(e=>e.layerDefinition.minScale!=null))?.layerDefinition.minScale??0}readPointBarriers(e,t){return this._getNetworkFeatures(t,`Barriers`,e=>M.fromGraphic(e))}readPolygonBarriers(e,t){return this._getNetworkFeatures(t,`PolygonBarriers`,e=>P.fromGraphic(e))}readPolylineBarriers(e,t){return this._getNetworkFeatures(t,`PolylineBarriers`,e=>N.fromGraphic(e))}readRouteInfo(e,t){return this._getNetworkFeatures(t,`RouteInfo`,e=>Ye.fromGraphic(e)).at(0)??null}readSpatialReference(e,t){let n=Gt(t)?t.layers:t.featureCollection?.layers;if(!n?.length)return v.WGS84;let{layerDefinition:r,featureSet:i}=n[0],a=i.features[0],s=a?.geometry?.spatialReference??i.spatialReference??r.spatialReference??r.extent.spatialReference??o;return v.fromJSON(s)}readStops(e,t){return this._getNetworkFeatures(t,`Stops`,e=>F.fromGraphic(e),e=>this._setStopSymbol(e))}get title(){return this.routeInfo?.name??`Route`}set title(e){this._overrideIfSome(`title`,e)}get url(){return n.routeServiceUrl}set url(e){e==null?this._set(`url`,n.routeServiceUrl):this._set(`url`,ye(e,a.getLogger(this)))}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`Feature Collection`]},e)),Promise.resolve(this)}removeAll(){this.removeResult(),this.pointBarriers.removeAll(),this.polygonBarriers.removeAll(),this.polylineBarriers.removeAll(),this.stops.removeAll()}removeResult(){this.directionLines!=null&&(this.directionLines.removeAll(),this._set(`directionLines`,null)),this.directionPoints!=null&&(this.directionPoints.removeAll(),this._set(`directionPoints`,null)),this.routeInfo!=null&&this._set(`routeInfo`,null)}async save(){await this.load();let{fullExtent:t,portalItem:n}=this;if(!n)throw new e(`routelayer:portal-item-not-set`,`save() requires to the layer to have a portal item`);if(!n.id)throw new e(`routelayer:portal-item-not-saved`,`Please use saveAs() first to save the routelayer`);if(n.type!==`Feature Collection`)throw new e(`routelayer:portal-item-wrong-type`,`Portal item needs to have type "Feature Collection"`);if(!this.routeInfo)throw new e(`routelayer:route-unsolved`,`save() requires a solved route`);let{portal:r}=n;await r.signIn(),r.user||await n.reload();let{itemUrl:i,itemControl:a}=n;if(a!==`admin`&&a!==`update`)throw new e(`routelayer:insufficient-permissions`,`To save this layer, you need to be the owner or an administrator of your organization`);let o={messages:[],origin:`portal-item`,portal:r,url:i?me(i):void 0,writtenProperties:[]},s=this.write(void 0,o);return n.extent=await Qt(t),n.title=this.title,await n.update({data:s}),n}async saveAs(t,n={}){if(await this.load(),this.routeInfo==null)throw new e(`routelayer:route-unsolved`,`saveAs() requires a solved route`);let r=m.from(t).clone();r.extent??=await Qt(this.fullExtent),r.id=null,r.portal??=Se.getDefault(),r.title??=this.title,r.type=`Feature Collection`,r.typeKeywords=[`Data`,`Feature Collection`,u.MULTI_LAYER,`Route Layer`];let{portal:i}=r,a={messages:[],origin:`portal-item`,portal:i,url:null,writtenProperties:[]};await i.signIn();let o=n?.folder,s=this.write(void 0,a);return await i.user.addItem({item:r,folder:o,data:s}),this.portalItem=r,ke(a),a.portalItem=r,r}async solve(t,n){zt(this.stops),zt(this.pointBarriers),zt(this.polylineBarriers),zt(this.polygonBarriers);let r=t?.stops??this.stops,i=t?.pointBarriers??Ut(this.pointBarriers),a=t?.polylineBarriers??Ut(this.polylineBarriers),o=t?.polygonBarriers??Ut(this.polygonBarriers);if(r==null)throw new e(`routelayer:undefined-stops`,`the route layer must have stops defined in the route parameters.`);if((Kt(r)||qt(r))&&r.features.length<2||D.isCollection(r)&&r.length<2)throw new e(`routelayer:insufficent-stops`,`the route layer must have two or more stops to solve a route.`);if(D.isCollection(r))for(let e of r)e.routeName=null;let s=t?.apiKey,{checksum:c,url:l}=this,u=await this._getServiceDescription(l,s,n),d=t?.travelMode??u.defaultTravelMode,f=t?.accumulateAttributes??[];d&&(f.push(d.distanceAttributeName),d.timeAttributeName&&f.push(d.timeAttributeName));let p={accumulateAttributes:f,checksum:c,directionsOutputType:`featuresets`,ignoreInvalidLocations:!0,pointBarriers:i,polylineBarriers:a,polygonBarriers:o,preserveObjectID:!0,returnBarriers:!!i,returnDirections:!0,returnPolygonBarriers:!!o,returnPolylineBarriers:!!a,returnRoutes:!0,returnStops:!0,stops:r},m=X.from(t??{}),h;m.set(p);try{h=await yt(l,m,n)}catch(t){throw be(t)?t:new e(`routelayer:failed-route-request`,`the routing request failed`,{error:t})}let g=this._toRouteLayerSolution(h);return this._isOverridden(`title`)||(this.title=g.routeInfo.name??`Route`),this._populatePortalFields(g,u,m),g}update(e){let{checksum:t,directionLines:n,directionPoints:r,pointBarriers:i,polygonBarriers:a,polylineBarriers:o,routeInfo:s,stops:c}=e;Bt(c,this.stops)?Zt(c,this.stops):this.set({stops:c}),Ht(i,this.pointBarriers)&&(Bt(i,this.pointBarriers)?Jt(i,this.pointBarriers):this.set({pointBarriers:i})),Ht(o,this.polylineBarriers)&&(Bt(o,this.polylineBarriers)?Yt(o,this.polylineBarriers):this.set({polylineBarriers:o})),Ht(a,this.polygonBarriers)&&(Bt(a,this.polygonBarriers)?Xt(a,this.polygonBarriers):this.set({polygonBarriers:a})),this.set({checksum:t}),this._set(`directionLines`,n),this._set(`directionPoints`,r),this._set(`routeInfo`,s),s.geometry&&(this.spatialReference=s.geometry.spatialReference)}_getNetworkFeatures(e,t,n,r){let i=Gt(e)?e.layers:e.featureCollection?.layers,a=i?.find(e=>e.layerDefinition.name===t);if(a==null)return new D;let{layerDefinition:s,popupInfo:c,featureSet:l}=a,u=s.drawingInfo.renderer,{features:d}=l,f=l.spatialReference??s.spatialReference??s.extent.spatialReference??o,p=u&&se(u),m=v.fromJSON(f),h=d.map(e=>{let r=b.fromJSON(e);r.geometry&&e.geometry&&e.geometry.spatialReference==null&&(r.geometry.spatialReference=m);let i=n(r);return i.symbol??=p?.getSymbol(r)??this._getNetworkSymbol(t),i.popupTemplate??=c&&ue.fromJSON(c),i});return r&&h.some(({symbol:e})=>!e)&&r(h),new D(h)}_getNetworkSymbol(e){switch(e){case`Barriers`:return this.defaultSymbols.pointBarriers;case`DirectionPoints`:return this.defaultSymbols.directionPoints;case`DirectionLines`:return this.defaultSymbols.directionLines;case`PolylineBarriers`:return this.defaultSymbols.polylineBarriers;case`PolygonBarriers`:return this.defaultSymbols.polygonBarriers;case`RouteInfo`:return this.defaultSymbols.routeInfo;case`Stops`:return null}}async _getServiceDescription(e,t,n){if(this._cachedServiceDescription!=null&&this._cachedServiceDescription.url===e)return this._cachedServiceDescription.serviceDescription;let r=await it(e,t,n);return this._cachedServiceDescription={serviceDescription:r,url:e},r}_setStopSymbol(e){let t=D.isCollection(e)?e.toArray():e;if(!t||!t.length||!this.defaultSymbols.stops||t.every(({symbol:e})=>!!e))return;let{first:n,last:r,middle:i,unlocated:a,waypoint:o,break:s}=this.defaultSymbols.stops,c=t.map(({sequence:e})=>e).filter(Ce),l=t.length===c.length;if(!this.routeInfo&&!l||t.length===1)return void t.forEach((e,a)=>{switch(a){case 0:e.symbol=n;break;case t.length-1:e.symbol=r;break;default:e.symbol=i}});let u=Math.min(...c),d=Math.max(...c);for(let e of t)e.sequence===u?e.symbol=n:e.sequence===d?e.symbol=r:this.routeInfo&&e.status!==`ok`&&e.status!==`not-located-on-closest`?e.symbol=a:e.locationType===`waypoint`?e.symbol=o:e.locationType===`break`?e.symbol=s:e.symbol=i}_toRouteLayerSolution(e){let{checksum:t,routeResults:n}=e,r=n[0].stops?.map(e=>F.fromJSON(e.toJSON()));this._setStopSymbol(r);let i=new sn(r),a=new an(e.polygonBarriers?.map(e=>P.fromJSON(e.toJSON())));Z(a,this.defaultSymbols.polygonBarriers);let o=new on(e.polylineBarriers?.map(e=>N.fromJSON(e.toJSON())));Z(o,this.defaultSymbols.polylineBarriers);let s=new rn(e.pointBarriers?.map(e=>M.fromJSON(e.toJSON())));Z(s,this.defaultSymbols.pointBarriers);let c=n[0].route?.toJSON(),l=Ye.fromJSON(c);l.symbol=this.defaultSymbols.routeInfo;let u=new nn(n[0].directionPoints?.features.map(e=>Je.fromJSON(e.toJSON())));Z(u,this.defaultSymbols.directionPoints);let d=new tn(n[0].directionLines?.features.map(e=>Ke.fromJSON(e.toJSON())));return Z(d,this.defaultSymbols.directionLines),{checksum:t,directionLines:d,directionPoints:u,pointBarriers:s,polygonBarriers:a,polylineBarriers:o,routeInfo:l,stops:i}}_writeDirectionLines(){return this._writeNetworkFeatures(this.directionLines,this.defaultSymbols.directionLines,`esriGeometryPolyline`,Ke.fields,`DirectionLines`,`Direction Lines`)}_writeDirectionPoints(){return this._writeNetworkFeatures(this.directionPoints,this.defaultSymbols.directionPoints,`esriGeometryPoint`,Je.fields,`DirectionPoints`,`Direction Points`)}_writeNetworkFeatures(e,t,n,r,i,a){if(!e?.length)return null;let o=this.spatialReference.toJSON(),{fullExtent:s,maxScale:c,minScale:l}=this;return{featureSet:{features:e.toArray().map(e=>en(e)),geometryType:n,spatialReference:o},layerDefinition:{capabilities:`Query,Update,Editing`,drawingInfo:{renderer:{type:`simple`,symbol:t?.toJSON()??Wt(n)}},extent:s.toJSON(),fields:r,geometryType:n,hasM:!1,hasZ:!1,maxScale:c,minScale:l,name:i,objectIdField:`ObjectID`,spatialReference:o,title:a,type:`Feature Layer`,typeIdField:``}}}_writePointBarriers(){return this._writeNetworkFeatures(this.pointBarriers,this.defaultSymbols.pointBarriers,`esriGeometryPoint`,M.fields,`Barriers`,`Point Barriers`)}_writePolygonBarriers(){return this._writeNetworkFeatures(this.polygonBarriers,this.defaultSymbols.polygonBarriers,`esriGeometryPolygon`,P.fields,`PolygonBarriers`,`Polygon Barriers`)}_writePolylineBarriers(){return this._writeNetworkFeatures(this.polylineBarriers,this.defaultSymbols.polylineBarriers,`esriGeometryPolyline`,N.fields,`PolylineBarriers`,`Line Barriers`)}_writeRouteInfo(){return this._writeNetworkFeatures(this.routeInfo==null?null:new D([this.routeInfo]),this.defaultSymbols.routeInfo,`esriGeometryPolyline`,Ye.fields,`RouteInfo`,`Route Details`)}_writeStops(){let e=this._writeNetworkFeatures(this.stops,null,`esriGeometryPoint`,F.fields,`Stops`,`Stops`);if(e==null)return null;let{stops:t}=this.defaultSymbols,n=t?.first?.toJSON(),r=t?.middle?.toJSON(),i=t?.last?.toJSON();return e.layerDefinition.drawingInfo.renderer={type:`uniqueValue`,field1:`Sequence`,defaultSymbol:r,uniqueValueInfos:[{value:`1`,symbol:n,label:`First Stop`},{value:`${this.stops.length}`,symbol:i,label:`Last Stop`}]},e}_populatePortalFields(t,n,r){let i=n.networkDataset?.networkAttributes,o=i?.filter(({usageType:e})=>e===`cost`)??[],s=r.travelMode??n.defaultTravelMode;if(s==null)return void a.getLogger(this).warn(`route-layer:missing-travel-mode`,`The routing service must have a default travel mode or one must be specified in the route parameter.`);let{timeAttributeName:c,distanceAttributeName:l}=s,u=o.find(({name:e})=>e===c),d=o.find(({name:e})=>e===l),f=r.travelMode?.impedanceAttributeName??r.impedanceAttribute??n.impedance,p=u?.units,m=d?.units;if(!p||!m)throw new e(`routelayer:unknown-impedance-units`,`the units of either the distance or time impedance are unknown`);let h=r.directionsLanguage??n.directionsLanguage,g=r.accumulateAttributes??n.accumulateAttributeNames??[],_=new Set(o.filter(({name:e})=>e===c||e===l||e===f||e!=null&&g.includes(e)).map(({name:e})=>e)),v=e=>{for(let t in e)_.has(t)||delete e[t]};for(let e of t.pointBarriers)e.costs!=null&&(e.addedCost=e.costs[f]??0,v(e.costs));for(let e of t.polygonBarriers)e.costs!=null&&(e.scaleFactor=e.costs[f]??1,v(e.costs));for(let e of t.polylineBarriers)e.costs!=null&&(e.scaleFactor=e.costs[f]??1,v(e.costs));let{routeInfo:y}=t,{findBestSequence:ee,preserveFirstStop:b,preserveLastStop:te,startTimeIsUTC:x,timeWindowsAreUTC:ne}=r;y.analysisSettings=new qe({accumulateAttributes:g,directionsLanguage:h,findBestSequence:ee,preserveFirstStop:b,preserveLastStop:te,startTimeIsUTC:x,timeWindowsAreUTC:ne,travelMode:s}),y.totalDuration=Q(y.totalCosts?.[c]??0,p),y.totalDistance=$t(y.totalCosts?.[l]??0,m),y.totalLateDuration=Q(y.totalViolations?.[c]??0,p),y.totalWaitDuration=Q(y.totalWait?.[c]??0,p),y.totalCosts!=null&&v(y.totalCosts),y.totalViolations!=null&&v(y.totalViolations),y.totalWait!=null&&v(y.totalWait);for(let e of t.stops)e.serviceCosts!=null&&(e.serviceDuration=Q(e.serviceCosts[c]??0,p),e.serviceDistance=$t(e.serviceCosts[l]??0,m),v(e.serviceCosts)),e.cumulativeCosts!=null&&(e.cumulativeDuration=Q(e.cumulativeCosts[c]??0,p),e.cumulativeDistance=$t(e.cumulativeCosts[l]??0,m),v(e.cumulativeCosts)),e.violations!=null&&(e.lateDuration=Q(e.violations[c]??0,p),v(e.violations)),e.wait!=null&&(e.waitDuration=Q(e.wait[c]??0,p),v(e.wait))}};k([i({readOnly:!0,json:{read:!1,origins:{"portal-item":{write:{allowNull:!0,ignoreOrigin:!0}},"web-map":{write:{overridePolicy(){return{allowNull:!0,ignoreOrigin:this.portalItem==null}}}}}}})],$.prototype,`_featureCollection`,void 0),k([S([`web-map`,`portal-item`],`_featureCollection`)],$.prototype,`writeFeatureCollectionWebmap`,null),k([i({readOnly:!0,json:{read:!1,origins:{"web-map":{write:{target:`type`,overridePolicy(){return{ignoreOrigin:this.portalItem!=null}}}}}}})],$.prototype,`_type`,void 0),k([i({type:String})],$.prototype,`checksum`,void 0),k([i({nonNullable:!0,type:L})],$.prototype,`defaultSymbols`,void 0),k([i({readOnly:!0})],$.prototype,`directionLines`,void 0),k([w([`web-map`,`portal-item`],`directionLines`,[`layers`,`featureCollection.layers`])],$.prototype,`readDirectionLines`,null),k([i({readOnly:!0})],$.prototype,`directionPoints`,void 0),k([w([`web-map`,`portal-item`],`directionPoints`,[`layers`,`featureCollection.layers`])],$.prototype,`readDirectionPoints`,null),k([i({readOnly:!0,json:{read:!1,origins:{"web-map":{write:{ignoreOrigin:!0}}}}})],$.prototype,`featureCollectionType`,void 0),k([i({readOnly:!0})],$.prototype,`fullExtent`,null),k([i({json:{origins:{"web-map":{name:`featureCollection.showLegend`}},write:!0}})],$.prototype,`legendEnabled`,void 0),k([i({type:[`show`,`hide`]})],$.prototype,`listMode`,void 0),k([i({type:Number,nonNullable:!0,json:{write:!1}})],$.prototype,`maxScale`,void 0),k([w([`web-map`,`portal-item`],`maxScale`,[`layers`,`featureCollection.layers`])],$.prototype,`readMaxScale`,null),k([i({type:Number,nonNullable:!0,json:{write:!1}})],$.prototype,`minScale`,void 0),k([w([`web-map`,`portal-item`],`minScale`,[`layers`,`featureCollection.layers`])],$.prototype,`readMinScale`,null),k([i({type:[`ArcGISFeatureLayer`],value:`ArcGISFeatureLayer`})],$.prototype,`operationalLayerType`,void 0),k([i({nonNullable:!0,type:D.ofType(M)})],$.prototype,`pointBarriers`,void 0),k([w([`web-map`,`portal-item`],`pointBarriers`,[`layers`,`featureCollection.layers`])],$.prototype,`readPointBarriers`,null),k([i({nonNullable:!0,type:D.ofType(P)})],$.prototype,`polygonBarriers`,void 0),k([w([`web-map`,`portal-item`],`polygonBarriers`,[`layers`,`featureCollection.layers`])],$.prototype,`readPolygonBarriers`,null),k([i({nonNullable:!0,type:D.ofType(N)})],$.prototype,`polylineBarriers`,void 0),k([w([`web-map`,`portal-item`],`polylineBarriers`,[`layers`,`featureCollection.layers`])],$.prototype,`readPolylineBarriers`,null),k([i({readOnly:!0})],$.prototype,`routeInfo`,void 0),k([w([`web-map`,`portal-item`],`routeInfo`,[`layers`,`featureCollection.layers`])],$.prototype,`readRouteInfo`,null),k([i({type:v})],$.prototype,`spatialReference`,void 0),k([w([`web-map`,`portal-item`],`spatialReference`,[`layers`,`featureCollection.layers`])],$.prototype,`readSpatialReference`,null),k([i({nonNullable:!0,type:D.ofType(F)})],$.prototype,`stops`,void 0),k([w([`web-map`,`portal-item`],`stops`,[`layers`,`featureCollection.layers`])],$.prototype,`readStops`,null),k([i()],$.prototype,`title`,null),k([i({readOnly:!0,json:{read:!1}})],$.prototype,`type`,void 0),k([i()],$.prototype,`url`,null),$=k([C(`esri.layers.RouteLayer`)],$);var cn=$;export{cn as default};