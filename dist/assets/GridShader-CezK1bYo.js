import{Aw as e,BT as t,ED as n,Ex as r,Fb as i,Jl as a,Jw as o,Nl as s,Rb as c,Rl as l,Uu as u,VT as d,Vl as ee,Ya as f,Yw as te,_u as ne,_v as re,dg as ie,du as ae,fu as oe,hu as se,jD as p,jT as ce,kD as m,lg as le,mu as ue,ng as de,uu as fe,uv as pe,vu as me,ww as he,x_ as ge,xv as _e,y_ as ve,zb as ye,zc as be}from"./index-BN8X5Ryz.js";import{f as h}from"./WGLContainer-jm6ZclzQ.js";import{A as xe,B as Se,D as Ce,H as g,I as we,It as _,J as Te,L as Ee,M as v,Mt as y,Tt as b,U as x,W as De,Y as Oe,_ as S,_t as ke,a as C,c as w,ct as Ae,dt as T,gt as je,h as Me,i as Ne,it as Pe,j as Fe,jt as Ie,k as Le,kt as Re,l as E,mt as ze,n as D,ot as Be,q as O,r as k,s as A,st as Ve,t as j,tt as He,u as M,v as N,wt as Ue,x as We,y as Ge,z as P}from"./GraphShaderModule-AgkKIWM0.js";import{c as Ke}from"./constants-BOI_CTg-.js";import{a as F,l as qe,o as Je,s as Ye}from"./utils-DmZFjYOb.js";import{t as Xe}from"./CircularArray-Bnt6GPkP.js";import{t as Ze}from"./DisjointTimerQuery-BX0tLCqC.js";import{t as Qe}from"./SymbolFader-FxP6csuG.js";var $e={vertexShader:h(`bitBlit/bitBlit.vert`),fragmentShader:h(`bitBlit/bitBlit.frag`)},et={vertexShader:h(`stencil/stencil.vert`),fragmentShader:h(`stencil/stencil.frag`)},tt=class extends j{};m([C(0,P)],tt.prototype,`position`,void 0);var nt=class extends D{},I=class extends M{};m([w(v)],I.prototype,`layerTexture`,void 0),m([w(v)],I.prototype,`backbufferTexture`,void 0),m([w(S)],I.prototype,`opacity`,void 0),m([w(S)],I.prototype,`inFadeOpacity`,void 0);var rt=class extends k{constructor(){super(...arguments),this.type=`BlendShader`}vertex(e){return{uv:e.position,glPosition:new O(qe(e.position),0,1)}}fragment(e){let t=new E,n=y(this.config.layerTexture,e.uv),r=y(this.config.backbufferTexture,e.uv),i=_(N(n.a,new S(0)),n.rgb,n.rgb.divide(n.a)),a=_(N(r.a,new S(0)),r.rgb,r.rgb.divide(r.a)),o=this.config.opacity.multiply(n.a),s=r.a;switch(this.blendMode){case`destination-over`:t.fragColor=new O(i.multiply(o).multiply(F(s)).add(a.multiply(s)),o.add(s).subtract(o.multiply(s)));break;case`source-in`:{let e=new O(i.multiply(o).multiply(s),o.multiply(s)),n=new O(a.multiply(s),s).multiply(F(this.config.opacity)).multiply(this.config.inFadeOpacity);t.fragColor=e.add(n)}break;case`destination-in`:{let e=new O(a.multiply(s).multiply(o),s.multiply(o)),n=new O(a.multiply(s),s).multiply(new O(F(this.config.opacity).multiply(this.config.inFadeOpacity)));t.fragColor=e.add(n)}break;case`source-out`:t.fragColor=new O(i.multiply(o).multiply(F(s)),o.multiply(F(s)));break;case`destination-out`:t.fragColor=new O(a.multiply(s).multiply(F(o)),s.multiply(F(o)));break;case`source-atop`:t.fragColor=new O(i.multiply(o).multiply(s).add(a.multiply(s.multiply(F(o)))),s);break;case`destination-atop`:t.fragColor=new O(i.multiply(o.multiply(F(s))).add(a.multiply(s).multiply(o)),o);break;case`xor`:t.fragColor=new O(i.multiply(o.multiply(F(s))).add(a.multiply(s.multiply(F(o)))),o.multiply(F(s)).add(s.multiply(F(o))));break;case`multiply`:t.fragColor=new O(i.multiply(o).multiply(a.multiply(s)).add(i.multiply(o).multiply(F(s))).add(a.multiply(s).multiply(F(o))),o.add(s.multiply(F(o))));break;case`screen`:t.fragColor=new O(i.add(a).subtract(i.multiply(a)).multiply(o.multiply(s)).add(i.multiply(o).multiply(F(s))).add(a.multiply(s).multiply(F(o))),o.add(s.multiply(F(o))));break;case`overlay`:{let e=new g(it(a.r,i.r),it(a.g,i.g),it(a.b,i.b));t.fragColor=L(e,i,a,o,s)}break;case`darken`:{let e=x(i,a);t.fragColor=L(e,i,a,o,s)}break;case`lighter`:t.fragColor=new O(i.multiply(o).add(a.multiply(s)),o.add(s));break;case`lighten`:{let e=Se(i,a);t.fragColor=L(e,i,a,o,s)}break;case`color-dodge`:{let e=b(new g(at(a.r,i.r),at(a.g,i.g),at(a.b,i.b)),new g(0),new g(1));t.fragColor=L(e,i,a,o,s)}break;case`color-burn`:{let e=new g(ot(a.r,i.r),ot(a.g,i.g),ot(a.b,i.b));t.fragColor=L(e,i,a,o,s)}break;case`hard-light`:{let e=new g(st(a.r,i.r),st(a.g,i.g),st(a.b,i.b));t.fragColor=L(e,i,a,o,s)}break;case`soft-light`:{let e=new g(ct(a.r,i.r),ct(a.g,i.g),ct(a.b,i.b));t.fragColor=L(e,i,a,o,s)}break;case`difference`:{let e=Ce(a.subtract(i));t.fragColor=L(e,i,a,o,s)}break;case`exclusion`:{let e=i.add(a).subtract(new S(2).multiply(i).multiply(a));t.fragColor=L(e,i,a,o,s)}break;case`invert`:t.fragColor=new O(new g(1).subtract(a).multiply(o).multiply(s).add(a.multiply(s).multiply(F(o))),s);break;case`vivid-light`:{let e=new g(b(lt(a.r,i.r),new S(0),new S(1)),b(lt(a.g,i.g),new S(0),new S(1)),b(lt(a.b,i.b),new S(0),new S(1)));t.fragColor=L(e,i,a,o,s)}break;case`hue`:{let e=gt(i,a,a);t.fragColor=L(e,i,a,o,s)}break;case`saturation`:{let e=gt(a,i,a);t.fragColor=L(e,i,a,o,s)}break;case`color`:{let e=ht(i,a);t.fragColor=L(e,i,a,o,s)}break;case`luminosity`:{let e=ht(a,i);t.fragColor=L(e,i,a,o,s)}break;case`plus`:t.fragColor=b(new O(n.r.add(a.r),n.g.add(a.g),n.b.add(a.b),o.add(s)),new O(0),new O(1));break;case`minus`:t.fragColor=new O(b(new g(a.r.subtract(n.r),a.g.subtract(n.g),a.b.subtract(n.b)),new g(0),new g(1)),s.multiply(o));break;case`average`:{let e=a.add(i).divide(2);t.fragColor=L(e,i,a,o,s)}break;case`reflect`:{let e=b(new g(_t(a.r,i.r),_t(a.g,i.g),_t(a.b,i.b)),new g(0),new g(1));t.fragColor=L(e,i,a,o,s)}break;default:t.fragColor=n.multiply(this.config.opacity)}return t}};function L(e,t,n,r,i){return new O(e.multiply(r).multiply(i).add(t.multiply(r).multiply(F(i))).add(n.multiply(i).multiply(F(r))),r.add(i.multiply(F(r))))}function it(e,t){return new S(1).subtract(T(new S(.5),t)).multiply(F(new S(2).multiply(F(t).multiply(F(e))))).add(T(new S(.5),t).multiply(new S(2).multiply(t).multiply(e)))}function at(e,t){return _(N(e,new S(0)),new S(0),_(N(t,new S(1)),new S(1),x(new S(1),e.divide(new S(1).subtract(t)))))}function ot(e,t){return _(N(e,new S(1)),new S(1),_(N(t,new S(0)),new S(0),F(x(new S(1),F(e).divide(t)))))}function st(e,t){return new S(1).subtract(T(new S(.5),t)).multiply(new S(2).multiply(t).multiply(e)).add(T(new S(.5),t).multiply(F(new S(2).multiply(F(t).multiply(F(e))))))}function ct(e,t){return Fe([Oe(t,new S(.5)),()=>{let n=new S(2).multiply(t),r=F(n),i=F(e);return e.subtract(r.multiply(e).multiply(i))}],[Oe(e,new S(.25)),()=>{let n=new S(2).multiply(t),r=Je(n).multiply(e),i=new S(16).multiply(e).subtract(new S(12)).multiply(e).add(new S(3));return e.add(r.multiply(i))}],[!0,()=>{let n=new S(2).multiply(t),r=Je(n),i=Pe(e).subtract(e);return e.add(r.multiply(i))}])}function lt(e,t){let n=F(T(new S(.5),t)).multiply(ot(e,new S(2).multiply(t))),r=T(new S(.5),t).multiply(at(e,new S(2).multiply(Ye(t,.5))));return n.add(r)}function ut(e){return x(x(e.r,e.g),e.b)}function dt(e){return Se(Se(e.r,e.g),e.b)}function ft(e){return Ie(e,new g(.3,.59,.11))}function pt(e){return dt(e).subtract(ut(e))}function mt(e){let t=ft(e),n=ut(e),r=dt(e);return Fe([De(n,new S(0)),()=>{let r=e.subtract(t).multiply(t),i=t.subtract(n);return t.add(r.divide(i))}],[We(r,new S(1)),()=>{let n=e.subtract(t),i=F(t),a=n.multiply(i),o=r.subtract(t);return t.add(a.divide(o))}],[!0,e])}function ht(e,t){let n=ft(e),r=ft(t).subtract(n);return mt(e.add(new g(r)))}function gt(e,t,n){let r=ut(e),i=pt(e),a=pt(t);return ht(_(We(i,new S(0)),()=>e.subtract(r).multiply(a).divide(i),new g(0)),n)}function _t(e,t){return _(N(t,new S(1)),t,()=>{let n=F(t),r=e.multiply(e).divide(n);return x(r,new S(1))})}m([Ne],rt.prototype,`blendMode`,void 0),m([w(I)],rt.prototype,`config`,void 0),m([p(0,A(tt))],rt.prototype,`vertex`,null),m([p(0,A(nt))],rt.prototype,`fragment`,null);var vt=class extends j{};m([C(0,P)],vt.prototype,`position`,void 0);var yt=class extends D{},bt=class extends M{};m([w(v)],bt.prototype,`layerTexture`,void 0),m([w(S)],bt.prototype,`opacity`,void 0);var xt=class extends k{constructor(){super(...arguments),this.type=`OpacityShader`}vertex(e){return{uv:e.position,glPosition:new O(e.position.subtract(new P(.5)).multiply(2),0,1)}}fragment(e){let t=new E;return t.fragColor=y(this.config.layerTexture,e.uv).multiply(this.config.opacity),t}};m([w(bt)],xt.prototype,`config`,void 0),m([p(0,A(vt))],xt.prototype,`vertex`,null),m([p(0,A(yt))],xt.prototype,`fragment`,null);var St={vertexShader:h(`highlight/textured.vert`),fragmentShader:h(`highlight/highlight.frag`)},Ct={vertexShader:h(`highlight/textured.vert`),fragmentShader:h(`highlight/blur.frag`)},wt=class extends j{};m([C(0,P)],wt.prototype,`position`,void 0);var R=class extends D{},z=class extends k{constructor(){super(...arguments),this.type=`PostProcessingShader`}vertex(e){return{uv:e.position,glPosition:new O(qe(e.position),0,1)}}};m([p(0,A(wt))],z.prototype,`vertex`,null);var Tt=class extends M{};m([w(v)],Tt.prototype,`blitTexture`,void 0);var Et=class extends z{fragment(e){let t=new E;return t.fragColor=y(this.blitConfig.blitTexture,e.uv),t}};m([w(Tt)],Et.prototype,`blitConfig`,void 0),m([p(0,A(R))],Et.prototype,`fragment`,null);var B=class extends M{};m([w(v)],B.prototype,`luminosityTexture`,void 0),m([w(g)],B.prototype,`defaultColor`,void 0),m([w(S)],B.prototype,`defaultOpacity`,void 0),m([w(S)],B.prototype,`luminosityThreshold`,void 0),m([w(S)],B.prototype,`smoothWidth`,void 0);var Dt=class extends z{constructor(){super(...arguments),this.type=`LuminosityHighPassShader`}fragment(e){let t=new E,n=y(this.luminosityHighPassConfig.luminosityTexture,e.uv),r=new g(.299,.587,.114),i=Ie(n.xyz,r),a=new O(this.luminosityHighPassConfig.defaultColor.rgb,this.luminosityHighPassConfig.defaultOpacity),o=ke(this.luminosityHighPassConfig.luminosityThreshold,this.luminosityHighPassConfig.luminosityThreshold.add(this.luminosityHighPassConfig.smoothWidth),i);return t.fragColor=Te(a,n,o),t}};m([w(B)],Dt.prototype,`luminosityHighPassConfig`,void 0),m([p(0,A(R))],Dt.prototype,`fragment`,null);var V=class extends M{};m([w(v)],V.prototype,`blurTexture1`,void 0),m([w(v)],V.prototype,`blurTexture2`,void 0),m([w(v)],V.prototype,`blurTexture3`,void 0),m([w(v)],V.prototype,`blurTexture4`,void 0),m([w(v)],V.prototype,`blurTexture5`,void 0),m([w(S)],V.prototype,`bloomStrength`,void 0),m([w(S)],V.prototype,`bloomRadius`,void 0),m([w(Me.ofType(S,5))],V.prototype,`bloomFactors`,void 0),m([w(g)],V.prototype,`bloomTintColor`,void 0);var Ot=class extends z{constructor(){super(...arguments),this.type=`CompositeShader`}fragment(e){let t=new E,{blurTexture1:n,blurTexture2:r,blurTexture3:i,blurTexture4:a,blurTexture5:o,bloomStrength:s,bloomFactors:c,bloomTintColor:l}=this.compositeConfig,u=this._lerpBloomFactor(c[0]).multiply(new O(l,1).multiply(y(n,e.uv))),d=this._lerpBloomFactor(c[1]).multiply(new O(l,1).multiply(y(r,e.uv))),ee=this._lerpBloomFactor(c[2]).multiply(new O(l,1).multiply(y(i,e.uv))),f=this._lerpBloomFactor(c[3]).multiply(new O(l,1).multiply(y(a,e.uv))),te=this._lerpBloomFactor(c[4]).multiply(new O(l,1).multiply(y(o,e.uv))),ne=s.multiply(u.add(d.add(ee.add(f.add(te)))));return t.fragColor=b(ne,new S(0),new S(1)),t}_lerpBloomFactor(e){let t=new S(1.2).subtract(e);return Te(e,t,this.compositeConfig.bloomRadius)}};m([Ne],Ot.prototype,`numMips`,void 0),m([w(V)],Ot.prototype,`compositeConfig`,void 0),m([p(0,A(R))],Ot.prototype,`fragment`,null);var H=class extends M{};m([w(v)],H.prototype,`texture`,void 0),m([w(P)],H.prototype,`texSize`,void 0),m([w(P)],H.prototype,`direction`,void 0),m([w(S)],H.prototype,`sigma`,void 0);var kt=class extends z{constructor(){super(...arguments),this.type=`GaussianBlurShader`}fragment(e){let t=new E,n=new S(1).divide(this.gaussianBlurConfig.texSize),r=this.gaussianBlurConfig.sigma,i=At(new S(0),r),a=y(this.gaussianBlurConfig.texture,e.uv).multiply(i);for(let t=1;t<this.kernelRadius;t++){let o=new S(t),s=At(o,r),c=this.gaussianBlurConfig.direction.multiply(n).multiply(o),l=y(this.gaussianBlurConfig.texture,e.uv.add(c)),u=y(this.gaussianBlurConfig.texture,e.uv.subtract(c));a=a.add(l.multiply(s)).add(u.multiply(s)),i=i.add(new S(2).multiply(s))}return t.fragColor=a.divide(i),t}};function At(e,t){return new S(.39894).multiply(He(new S(-.5).multiply(e).multiply(e).divide(t.multiply(t))).divide(t))}m([Ne],kt.prototype,`kernelRadius`,void 0),m([w(H)],kt.prototype,`gaussianBlurConfig`,void 0),m([p(0,A(R))],kt.prototype,`fragment`,null);var jt=class extends M{};m([w(v)],jt.prototype,`texture`,void 0);var Mt=1,Nt=2.2,Pt=[-.08,-.05,-.03,-.02,-.01,.01,.02,.03,.05,.08],Ft=class extends z{constructor(){super(...arguments),this.type=`RadialBlurShader`}fragment(e){let t=new E,n=new S(.5).subtract(e.uv),r=Pe(n.x.multiply(n.y).add(n.y.multiply(n.y)));n=n.divide(r);let i=y(this.radialBlurConfig.texture,e.uv),a=i;for(let t=0;t<10;t++){let r=y(this.radialBlurConfig.texture,e.uv.add(n).multiply(new S(Pt[t]).multiply(Mt)));a=a.add(r)}let o=new S(1).divide(new S(11));a=a.multiply(o);let s=r.multiply(Nt);return s=b(s,new S(0),new S(1)),t.fragColor=Te(i,a,s),t}};m([Ne],Ft.prototype,`kernelRadius`,void 0),m([w(jt)],Ft.prototype,`radialBlurConfig`,void 0),m([p(0,A(R))],Ft.prototype,`fragment`,null);var It=class extends M{};m([w(v)],It.prototype,`colorTexture`,void 0),m([w(Ve)],It.prototype,`coefficients`,void 0);var Lt=class extends z{constructor(){super(...arguments),this.type=`FilterEffectShader`}fragment(e){let t=new E,n=y(this.filterEffectConfig.colorTexture,e.uv),r=_(We(n.a,new S(0)),n.rgb.divide(n.a),new g(0)),i=this.filterEffectConfig.coefficients.multiply(new O(r,1)),a=n.a;return t.fragColor=new O(a.multiply(i.rgb),a),t}};m([w(It)],Lt.prototype,`filterEffectConfig`,void 0),m([p(0,A(R))],Lt.prototype,`fragment`,null);var U=class extends M{};m([w(v)],U.prototype,`layerFBOTexture`,void 0),m([w(v)],U.prototype,`blurTexture`,void 0),m([w(O)],U.prototype,`shadowColor`,void 0),m([w(P)],U.prototype,`shadowOffset`,void 0),m([w(Ue)],U.prototype,`displayViewMat3`,void 0);var Rt=class extends z{constructor(){super(...arguments),this.type=`CompositeShader`}fragment(e){let t=new E,{layerFBOTexture:n,blurTexture:r,shadowColor:i,shadowOffset:a,displayViewMat3:o}=this.compositeConfig,s=o.multiply(new g(a,new S(0))),c=y(n,e.uv);return t.fragColor=y(r,e.uv.subtract(s.xy.divide(2))).a.multiply(i).multiply(new S(1).subtract(c.a)).add(c),t}};m([w(U)],Rt.prototype,`compositeConfig`,void 0),m([p(0,A(R))],Rt.prototype,`fragment`,null);var W=!!n(`esri-2d-profiler`),zt=class{constructor(e,t){if(this._events=new re,this._entries=new Map,this._timings=new Xe(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!W)return;this._ext=Ze(e.gl,{}),this._debugOutput=t;let n=e.gl;if(!this.enableCommandLogging)return;let r;for(r in n)if(typeof n[r]==`function`){let e=n[r],t=r.includes(`draw`);n[r]=(...i)=>(this._events.emit(`command`,{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:r,args:i,isDrawCommand:t}),this._currentSummary&&(this._currentSummary.commands++,t&&this._currentSummary.drawCommands++),e.apply(n,i))}}get enableCommandLogging(){return typeof W==`object`&&W.commandLogging}get enableTimeLogging(){return typeof W==`object`&&W.timeLogging}get lastTime(){return this._timings.peekLast()}recordContainerStart(e){W&&(this._currentContainer=e)}recordContainerEnd(){W&&(this._currentContainer=null)}recordPassStart(e){W&&(this._currentPass=e,this._initSummary())}recordPassEnd(){W&&(this._currentPass=null,this._emitSummary())}recordBrushStart(e){W&&(this._currentBrush=e)}recordBrushEnd(){W&&(this._currentBrush=null)}recordStart(e){if(W&&this._ext!=null){if(this._entries.has(e)){let t=this._entries.get(e),n=this._ext.resultAvailable(t.query),r=this._ext.disjoint();if(n&&!r){let n=this._ext.getResult(t.query)/1e6,r=0;if(this._timings.enqueue(n)!=null&&this.enableTimeLogging){let e=this._timings.entries,t=e.length,n=0;for(let t of e)n+=t;r=n/t}let i=n.toFixed(2),a=r?r.toFixed(2):`--`;this.enableCommandLogging?(this.enableTimeLogging?console.groupCollapsed(`Frame report for ${e}, ${i} ms (${a} last 10 avg)\n              ${t.commandsLen} Commands (${t.drawCommands} draw)`):console.groupCollapsed(`Frame report for ${e}\n              ${t.commandsLen} Commands (${t.drawCommands} draw)`),console.log(`RenderPass breakdown: `),console.table(t.summaries),console.log(`Commands: `,t.commands),console.groupEnd()):this.enableTimeLogging&&console.log(`Frame report for ${e}, ${i} ms (${a} last 10 avg)`),this.enableTimeLogging&&(this._debugOutput.innerHTML=`${i} (${a})`)}for(let e of t.handles)e.remove();this._ext.deleteQuery(t.query),this._entries.delete(e)}let t={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(t.handles.push(this._events.on(`command`,e=>{t.commandsLen++,t.commands.push(e),e.isDrawCommand&&t.drawCommands++})),t.handles.push(this._events.on(`summary`,e=>{t.summaries.push(e)}))),this._ext.beginTimeElapsed(t.query),this._entries.set(e,t)}}recordEnd(e){W&&this._ext!=null&&this._entries.has(e)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit(`summary`,this._currentSummary)}},Bt=class extends j{};m([C(0,P)],Bt.prototype,`position`,void 0),m([C(1,P)],Bt.prototype,`texcoord`,void 0),m([C(2,S)],Bt.prototype,`w`,void 0);var Vt=class extends D{},Ht=class extends M{};m([w(v)],Ht.prototype,`texture`,void 0),m([w(S)],Ht.prototype,`opacity`,void 0);var Ut=class extends k{constructor(){super(...arguments),this.type=`VideoScreenShader`}vertex(e){let{position:t,texcoord:n,w:r}=e;return{glPosition:new O(t,0,r),texcoord:n}}fragment(e){let t=new E;return t.fragColor=y(this.config.texture,e.texcoord).multiply(this.config.opacity),t}};m([w(Ht)],Ut.prototype,`config`,void 0),m([p(0,A(Bt))],Ut.prototype,`vertex`,null),m([p(0,A(Vt))],Ut.prototype,`fragment`,null);var Wt=64,Gt=class{constructor(){this.styles=new Map,this.layerContexts=new Map}get cachedStyles(){return this.styles}setLabelClassStyle(e,t,n){this.layerContexts.set(e,t),this.styles.set(e,n)}removeContainer(e){for(let[t,n]of this.layerContexts.entries())n===e&&this.layerContexts.delete(t)}},G=class extends e{constructor(e){super(e),this._faderWorkingSet=[],this._styleRepository=new Gt,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null,this.symbolFader=new Qe(`feature-tile`,this._styleRepository,(e,t)=>{e.updateLabelVisibility(),e.requestRender(),e.isReady&&(e.decluttered=!0)},this._faderWorkingSet,512,Wt)}get updating(){return n(`esri-2d-log-updating`)&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(e){this.doUpdate(e)?this.updateRequested=!1:(this.updateRequested=!0,this.view?.requestUpdate())}setLabelSchemaStyles(e,t){let n;switch(e.type){case`label`:n=e.classes;break;case`subtype`:n=Array.from(Object.values(e.renderers).flatMap(e=>e.classes));break;case`cluster`:n=[...e.cluster.classes,...e.feature.classes];break;case`track`:n=[...e.latestObservation.classes,...e.previousObservation.classes,...e.trackLine.classes]}for(let e of n){let n=Kt(e);this._styleRepository.setLabelClassStyle(e.labelClassId,t,n)}}removeContainer(e){this._styleRepository.removeContainer(e),this.requestUpdate()}doUpdate(e){this._faderWorkingSet.length=0;let t=this.view;if(!t)return!1;let n=t.allLayerViews.map(e=>e.featureContainer).filter(e=>!!e&&e?.hasLabels);if(n.length>0){for(let t of n)for(let n of t.tiles||[])n.setTransform(e.state),this._faderWorkingSet.push(n);let r=e.state.scale,i=t.featuresTilingScheme.scaleToZoom(r);return this.symbolFader.update(i,e.state)}return!0}};function Kt(e){let t=e.geometryType===`esriGeometryPolyline`?0:1,n=e.geometryType===`esriGeometryPolyline`?0:1;return{geometryType:e.geometryType,iconAllowOverlap:!e.deconflictionEnabled,iconIgnorePlacement:!1,textAllowOverlap:!e.deconflictionEnabled,textIgnorePlacement:!1,iconRotationAlignment:t,textRotationAlignment:t,iconTranslateAnchor:n,iconTranslate:[0,0],textTranslateAnchor:n,textTranslate:[0,0]}}m([t()],G.prototype,`updateRequested`,void 0),m([t()],G.prototype,`updating`,null),m([t()],G.prototype,`view`,void 0),G=m([d(`esri.views.2d.LabelManager`)],G);var qt=`esri-zoom-box`,Jt={container:`${qt}__container`,overlay:`${qt}__overlay`,background:`${qt}__overlay-background`,box:`${qt}__outline`},Yt={zoom:`Shift`,counter:`Control`},K=class extends e{constructor(e){super(e),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(e){this.removeAllHandles(),this._destroyOverlay(),this._set(`view`,e),e&&this.addHandles([e.on(`drag`,[Yt.zoom],e=>this._handleDrag(e,1),de.INTERNAL),e.on(`drag`,[Yt.zoom,Yt.counter],e=>this._handleDrag(e,-1),de.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(e,t,n,r){this._box.x=e,this._box.y=t,this._box.width=n,this._box.height=r,this._rafId||=requestAnimationFrame(this._redraw)}_end(e,t,n,r,i){let a=this.view,o=a.toMap(ie(e+.5*n,t+.5*r)),s=Math.max(n/a.width,r/a.height);i===-1&&(s=1/s),this._destroyOverlay(),this.navigation.end(),a.goTo({center:o,scale:a.scale*s},{animationMode:`always`,duration:f()})}_updateBox(e,t,n,r){let i=this._boxShape;i.setAttributeNS(null,`x`,``+e),i.setAttributeNS(null,`y`,``+t),i.setAttributeNS(null,`width`,``+n),i.setAttributeNS(null,`height`,``+r),i.setAttributeNS(null,`class`,Jt.box)}_updateBackground(e,t,n,r){this._backgroundShape.setAttributeNS(null,`d`,this._toSVGPath(e,t,n,r,this.view.width,this.view.height))}_createContainer(){let e=document.createElement(`div`);e.className=Jt.container,this.view.root.appendChild(e),this._container=e}_createOverlay(){let e=this.view.width,t=this.view.height,n=document.createElementNS(`http://www.w3.org/2000/svg`,`path`);n.setAttributeNS(null,`d`,`M 0 0 L `+e+` 0 L `+e+` `+t+` L 0 `+t+` Z`),n.setAttributeNS(null,`class`,Jt.background);let r=document.createElementNS(`http://www.w3.org/2000/svg`,`rect`),i=document.createElementNS(`http://www.w3.org/2000/svg`,`svg`);i.setAttributeNS(`http://www.w3.org/2000/xmlns/`,`xmlns:xlink`,`http://www.w3.org/1999/xlink`),i.setAttributeNS(null,`class`,Jt.overlay),i.appendChild(n),i.appendChild(r),this._container.appendChild(i),this._backgroundShape=n,this._boxShape=r,this._overlay=i}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(e,t,n,r,i,a){let o=e+n,s=t+r;return`M 0 0 L `+i+` 0 L `+i+` `+a+` L 0 `+a+` ZM `+e+` `+t+` L `+e+` `+s+` L `+o+` `+s+` L `+o+` `+t+` Z`}_handleDrag(e,t){let n=e.x,r=e.y,i=e.origin.x,a=e.origin.y,o,s,c,l;switch(n>i?(o=i,c=n-i):(o=n,c=i-n),r>a?(s=a,l=r-a):(s=r,l=a-r),e.action){case`start`:this._start();break;case`update`:this._update(o,s,c,l);break;case`end`:this._end(o,s,c,l,t)}e.stopPropagation()}_redraw(){if(!this._rafId||(this._rafId=null,!this._overlay))return;let{x:e,y:t,width:n,height:r}=this._box;this._updateBox(e,t,n,r),this._updateBackground(e,t,n,r),this._rafId=requestAnimationFrame(this._redraw)}};m([t()],K.prototype,`navigation`,void 0),m([t()],K.prototype,`view`,null),K=m([d(`esri.views.2d.navigation.ZoomBox`)],K);var q=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){let t=this.computeDelta(e);this._updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta===void 0?this.filteredDelta=e:this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e}},Xt=class{constructor(e,t,n){this._initialVelocity=e,this._stopVelocity=t,this.friction=n,this._duration=o(Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this.friction)))}get duration(){return this._duration}isFinished(e){return e>this.duration}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){let n=this.value(e);return this.value(e+t)-n}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);let n=1-this.friction;return e*(n**t-1)/Math.log(n)}},Zt=class extends Xt{constructor(e,t,n,r,i){super(e,t,n),this._sceneVelocity=r,this.direction=i}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},Qt=class{constructor(e=300,t=12,n=.84){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=n,this.enabled=!0,this._time=new q(.6),this._screen=[new q(.4),new q(.4)],this._scene=[new q(.6),new q(.6),new q(.6)],this._tmpDirection=ve()}add(e,t,n){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(n)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(t[0]),this._scene[1].update(t[1]),this._scene[2].update(t[2]),this._time.update(n)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;let e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,n=e==null||t==null?0:Math.sqrt(e*e+t*t),r=this._time.filteredDelta,i=r==null||n==null?0:n/r;return Math.abs(i)<this._minimumInitialVelocity?null:this.createMomentum(i,this._stopVelocity,this._friction)}createMomentum(e,t,n){l(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);let r=ee(this._tmpDirection);r>0&&s(this._tmpDirection,this._tmpDirection,1/r);let i=this._time.filteredDelta;return new Zt(e,t,n,i==null?0:r/i,this._tmpDirection)}},J=class extends e{constructor(e){super(e),this.animationTime=o(0),this.momentumEstimator=new Qt(500,6,.92),this.momentum=null,this.tmpMomentum=ve(),this.momentumFinished=!1,this.viewpoint=new _e({targetGeometry:new r,scale:0,rotation:0}),this._previousDrag=null,this.addHandles(pe(()=>this.momentumFinished,()=>this.navigation.stop()))}begin(e,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this._previousDrag=t}update(e,t){this.addToEstimator(t);let n=t.center.x,r=t.center.y,i=this._previousDrag;n=i?i.center.x-n:-n,r=i?r-i.center.y:r,e.viewpoint=se(this.viewpoint,e.viewpoint,[n||0,r||0]),this._previousDrag=t}end(e,t){this.addToEstimator(t),this.momentum=e.navigation.momentumEnabled&&!a()?this.momentumEstimator.evaluateMomentum():null,this.animationTime=o(0),this.momentum&&this.onAnimationUpdate(e),this._previousDrag=null,this.navigation.end()}addToEstimator(e){let t=e.center.x,n=e.center.y,r=le(-t,n),i=ge(-t,n,0);this.momentumEstimator.add(r,i,.001*e.timestamp)}onAnimationUpdate(e){this.navigation.animationManager?.animateContinuous(e.viewpoint,(t,n)=>{let{momentum:r,animationTime:i,tmpMomentum:a}=this,c=this.momentumFinished=!r||r.isFinished(i),l=te(n);if(!c){let n=r.valueDelta(i,l);s(a,r.direction,n),se(t,t,a),e.constraints.constrainByGeometry(t)}this.animationTime=o(this.animationTime+l)})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};m([t()],J.prototype,`momentumFinished`,void 0),m([t()],J.prototype,`viewpoint`,void 0),m([t()],J.prototype,`navigation`,void 0),J=m([d(`esri.views.2d.navigation.actions.Pan`)],J);var $t=class{constructor(e=2.5,t=.01,n=.95,r=12){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=n,this._maxVelocity=r,this.enabled=!0,this.value=new q(.8),this.time=new q(.3)}add(e,t){if(this.enabled&&t!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta()){let t=this.value.computeDelta(e);this.value.filteredDelta*t<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=he(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,t,n){return new Xt(e,t,n)}},en=class extends $t{constructor(e=3,t=.01,n=.95,r=12){super(e,t,n,r)}add(e,t){let n=this.value.lastValue;if(n!=null){let t=e-n;for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;e=n+t}super.add(e,t)}},tn=class extends Xt{constructor(e,t,n){super(e,t,n)}value(e){let t=super.value(e);return Math.exp(t)}valueDelta(e,t){let n=super.value(e),r=super.value(e+t)-n;return Math.exp(r)}},nn=class extends $t{constructor(e=2.5,t=.01,n=.95,r=12){super(e,t,n,r)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,n){return new tn(e,t,n)}},Y=class extends e{constructor(e){super(e),this._animationTime=o(0),this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new en(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new nn,this._zoomOnly=null,this.viewpoint=new _e({targetGeometry:new r,scale:0,rotation:0}),this.zoomMomentum=null,this.rotateMomentum=null,this.addHandles(pe(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(e,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}update(e,t){this._updateTimestamp===null&&(this._updateTimestamp=t.timestamp);let n=t.angle,r=t.radius,i=t.center,a=Math.abs(180*(n-this._startAngle)/Math.PI),o=Math.abs(r-this._startRadius),s=this._startRadius/r;if(this._previousRadius&&this._previousCenter){let c=r/this._previousRadius,l=180*(n-this._previousAngle)/Math.PI;this._rotationDirection=l>=0?1:-1,this._zoomDirection=c>=1?1:-1,e.constraints.rotationEnabled?(this._zoomOnly===null&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=o-a>0),this._zoomOnly===null||this._zoomOnly?l=0:this.addToRotateEstimator(n-this._startAngle,t.timestamp)):l=0,this.addToZoomEstimator(t,s),this.navigation.setViewpoint([i.x,i.y],1/c,l,[this._previousCenter.x-i.x,i.y-this._previousCenter.y])}this._previousAngle=n,this._previousRadius=r,this._previousCenter=i}end(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=o(0),(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}addToRotateEstimator(e,t){this._rotationMomentumEstimator.add(e,.001*t)}addToZoomEstimator(e,t){this._zoomMomentumEstimator.add(t,.001*e.timestamp)}canZoomIn(e){let t=e.scale,n=e.constraints.effectiveMaxScale;return n===0||t>n}canZoomOut(e){let t=e.scale,n=e.constraints.effectiveMinScale;return n===0||t<n}onAnimationUpdate(e){this.navigation.animationManager?.animateContinuous(e.viewpoint,(t,n)=>{let r=!this.canZoomIn(e)&&this._zoomDirection>1||!this.canZoomOut(e)&&this._zoomDirection<1,a=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),s=r||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),c=te(n);if(this._momentumFinished=a&&s,!this._momentumFinished){let n=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,c))*this._rotationDirection*180/Math.PI:0,r=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,c)):1,a=u(),o=u();if(this._previousCenter){i(a,this._previousCenter.x,this._previousCenter.y),me(o,e.size,e.padding),ye(a,a,o);let{constraints:s,scale:c}=e,l=c*r;r<1&&!s.canZoomInTo(l)?(r=c/s.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):r>1&&!s.canZoomOutTo(l)&&(r=c/s.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),ae(t,e.viewpoint,r,n,a,e.size),e.constraints.constrainByGeometry(t)}}this._animationTime=o(this._animationTime+c)})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&=(this._rotationMomentumEstimator.reset(),null),this.zoomMomentum&&=(this._zoomMomentumEstimator.reset(),null),this.navigation.stop())}};m([t()],Y.prototype,`_momentumFinished`,void 0),m([t()],Y.prototype,`viewpoint`,void 0),m([t()],Y.prototype,`navigation`,void 0),Y=m([d(`esri.views.2d.navigation.actions.Pinch`)],Y);var rn=u(),an=u(),on=class extends e{constructor(e){super(e),this._previousCenter=u(),this.viewpoint=new _e({targetGeometry:new r,scale:0,rotation:0})}begin(e,t){this.navigation.begin(),i(this._previousCenter,t.center.x,t.center.y)}update(e,t){let{state:{size:n,padding:r}}=e;i(rn,t.center.x,t.center.y),fe(an,n,r),e.viewpoint=ue(this.viewpoint,e.state.paddedViewState.viewpoint,ne(an,this._previousCenter,rn)),c(this._previousCenter,rn)}end(){this.navigation.end()}};m([t()],on.prototype,`viewpoint`,void 0),m([t()],on.prototype,`navigation`,void 0),on=m([d(`esri.views.2d.navigation.actions.Rotate`)],on);var X=10,sn=1,cn=new _e({targetGeometry:new r}),ln=[0,0],un=250,Z=class extends e{constructor(e){super(e),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new J({navigation:this}),this.rotate=new on({navigation:this}),this.pinch=new Y({navigation:this}),this.zoomBox=new K({view:this.view,navigation:this})}destroy(){this.pan=ce(this.pan),this.rotate=ce(this.rotate),this.pinch=ce(this.pinch),this.zoomBox=ce(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set(`interacting`,!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(un)}async zoom(e,t=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return e<1?this.zoomIn(t):this.zoomOut(t);this.setViewpoint(t,e,0,[0,0])}async zoomIn(e){let t=this.view,n=t.constraints.snapToNextScale(t.scale);return this._zoomToScale(n,e)}async zoomOut(e){let t=this.view,n=t.constraints.snapToPreviousScale(t.scale);return this._zoomToScale(n,e)}setViewpoint(e,t,n,r){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,n,r),this.end()}setViewpointImmediate(e,t=0,n=[0,0],r=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,r,e,t,n)}continuousRotateClockwise(){let e=this.view.viewpoint;this.animationManager?.animateContinuous(e,e=>{ue(e,e,-sn)})}continuousRotateCounterclockwise(){let e=this.view.viewpoint;this.animationManager?.animateContinuous(e,e=>{ue(e,e,sn)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-X,0])}continuousPanRight(){this._continuousPan([X,0])}continuousPanUp(){this._continuousPan([0,X])}continuousPanDown(){this._continuousPan([0,-X])}continuousPanVector({x:e,y:t}){this._continuousPan([e*X,t*X])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),this._endTimer!==null&&(clearTimeout(this._endTimer),this._endTimer=null,this._set(`interacting`,!1))}_continuousPan(e){let t=this.view.viewpoint;this.animationManager?.animateContinuous(t,t=>{se(t,t,e),this.view.constraints.constrainByGeometry(t)})}_startTimer(e){return this._endTimer!==null||(this._endTimer=setTimeout(()=>{this._endTimer=null;let e=performance.now()-(this._lastEventTimestamp??0);e<un?this._endTimer=this._startTimer(e):this._set(`interacting`,!1)},e)),this._endTimer}_getDefaultAnchor(){let{size:e,padding:{left:t,right:n,top:r,bottom:i}}=this.view;return ln[0]=.5*(e[0]-n+t),ln[1]=.5*(e[1]-i+r),ln}async _zoomToScale(e,t=this._getDefaultAnchor()){let{view:n}=this,{constraints:r,scale:i,viewpoint:a,size:o,padding:s}=n,c=r.canZoomInTo(e),l=r.canZoomOutTo(e);if(!(e<i&&!c||e>i&&!l))return oe(cn,a,e/i,0,t,o,s),r.constrainByGeometry(cn),n.goTo(cn,{animate:!0,animationMode:`always`,duration:f(),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(e,t,n,r,i){let{view:a}=this,{size:o,padding:s,constraints:c,scale:l,viewpoint:u}=a,d=l*n,ee=c.canZoomInTo(d),f=c.canZoomOutTo(d);return(n<1&&!ee||n>1&&!f)&&(n=1),se(u,u,i),oe(e,u,n,r,t,o,s),c.constrainByGeometry(e)}};m([t()],Z.prototype,`animationManager`,void 0),m([t({type:Boolean,readOnly:!0})],Z.prototype,`interacting`,void 0),m([t()],Z.prototype,`pan`,void 0),m([t()],Z.prototype,`pinch`,void 0),m([t()],Z.prototype,`rotate`,void 0),m([t()],Z.prototype,`view`,void 0),m([t()],Z.prototype,`zoomBox`,void 0),Z=m([d(`esri.views.2d.navigation.MapViewNavigation`)],Z);var dn=Z,fn=class extends j{};m([C(0,P)],fn.prototype,`position`,void 0);var pn=class extends D{},Q=class extends M{};m([w(v)],Q.prototype,`readbackTexture`,void 0),m([w(v)],Q.prototype,`maskTexture`,void 0),m([w(v)],Q.prototype,`overlayTexture`,void 0),m([w(O)],Q.prototype,`background`,void 0),m([w(O)],Q.prototype,`drawPos`,void 0),m([w(S)],Q.prototype,`maskEnabled`,void 0),m([w(S)],Q.prototype,`overlayEnabled`,void 0);var mn=class extends k{constructor(){super(...arguments),this.type=`MagnifierShader`}vertex(e){let t=e.position,n=e.position.subtract(new P(.5)).multiply(this.config.drawPos.zw),r=this.config.drawPos.xy.add(n);return{glPosition:new O(r,0,1),texCoord:t}}fragment(e){let t=y(this.config.readbackTexture,hn(e.texCoord));t=t.add(new S(1).subtract(t.a)).multiply(this.config.background);let n=_(N(this.config.maskEnabled,new S(1)),y(this.config.maskTexture,e.texCoord).a,new S(1));t=t.multiply(n);let r=_(N(this.config.overlayEnabled,new S(1)),y(this.config.overlayTexture,e.texCoord),new O(0)),i=new E;return i.fragColor=r.add(new S(1).subtract(r.a).multiply(t)),i}};function hn(e){let t=e.multiply(new P(2)).subtract(1);return _(N(t.x,new S(0)).and(N(t.y,new S(0))),new P(.5),()=>{let e=Be(t.y,t.x),n=Ee(Ae(t),new S(Ke)),r=new P(je(e),Re(e));return n.multiply(r).multiply(new P(.5)).add(new S(.5))})}m([w(Q)],mn.prototype,`config`,void 0),m([p(0,A(fn))],mn.prototype,`vertex`,null),m([p(0,A(pn))],mn.prototype,`fragment`,null);var gn=class extends j{};m([C(0,P)],gn.prototype,`position`,void 0);var _n=class extends D{},vn=class extends M{};m([w(Ue)],vn.prototype,`dvs`,void 0);var $=class extends M{};m([w(S)],$.prototype,`halfWidth`,void 0),m([w(S)],$.prototype,`aaWidth`,void 0),m([w(S)],$.prototype,`pxPerCell`,void 0),m([w(O)],$.prototype,`minorLineColor`,void 0),m([w(O)],$.prototype,`majorLineColor`,void 0),m([w(we)],$.prototype,`majorLineInterval`,void 0);var yn=class extends k{constructor(){super(...arguments),this.type=`GridShader`}vertex(e){let t=e.position.multiply(2).subtract(1);return{gridPos:this.transform.dvs.multiply(new g(t,1)).xy,glPosition:new O(t,0,1)}}fragment(e){let t=Ce(e.gridPos),n=xe(t),r=x(n.x,new S(1).subtract(n.x)),i=x(n.y,new S(1).subtract(n.y)),a=new P(r,i).multiply(this.config.pxPerCell).subtract(this.config.halfWidth),o=x(a.x,a.y),s=new S(1).subtract(ke(new S(0),this.config.aaWidth,o)),c=new we(ze(t.x)),l=new we(ze(t.y)),u=new S(Le(c,this.config.majorLineInterval)),d=new S(Le(l,this.config.majorLineInterval)),ee=_(De(a.x,a.y),u,d),f=We(Ge(T(a.x,this.config.aaWidth),T(a.y,this.config.aaWidth)),new S(.5)),te=x(u,d),ne=_(f,te,ee),re=Te(this.config.majorLineColor,this.config.minorLineColor,x(ne,new S(1))),ie=new E;return ie.fragColor=re.multiply(s),ie}};m([w(vn)],yn.prototype,`transform`,void 0),m([w($)],yn.prototype,`config`,void 0),m([p(0,A(gn))],yn.prototype,`vertex`,null),m([p(0,A(_n))],yn.prototype,`fragment`,null);export{rt as _,Ut as a,Lt as c,Ot as d,Dt as f,xt as g,Ct as h,G as i,Ft as l,St as m,mn as n,zt as o,Et as p,dn as r,Rt as s,yn as t,kt as u,et as v,$e as y};