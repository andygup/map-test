const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GroupLayer-Dny-W0bs.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/loadUtils-DEZa3oNR.js","assets/associatedFeatureServiceUtils-g0mrYesf.js","assets/fetchService-DUyN7SUy.js","assets/layersCreator-vJ6KgZCx.js","assets/lazyLayerLoader-CkIeKrgl.js","assets/portalLayers-C3ZU9qxp.js","assets/tagSymbols-67pK6deD.js","assets/saveUtils-CEfw3trS.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,JC as n,Lh as r,iC as i,kC as a,oC as o,wh as s}from"./index-BN8X5Ryz.js";import{t as c}from"./associatedFeatureServiceUtils-g0mrYesf.js";import{n as l,r as u,t as d}from"./fetchService-DUyN7SUy.js";import{t as f}from"./lazyLayerLoader-CkIeKrgl.js";var p={FeatureLayer:!0,SceneLayer:!0,VideoLayer:!0};async function m(t){let{properties:n,url:r}=t,i={...n,url:r},a=await v(r,n?.customParameters),{Constructor:o,layerId:s,sourceJSON:c,parsedUrl:l,layers:u,tables:d}=a;if(u.length+d.length===0)return s!=null&&(i.layerId=s),c!=null&&(i.sourceJSON=c),new o(i);let f=new(await(e(async()=>{let{default:e}=await import(`./GroupLayer-Dny-W0bs.js`);return{default:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])))).default({title:l.title});return await _(f,a,i),f}function h(e,t){return e?e.find(({id:e})=>e===t):null}function g(e,t,n,r,i){let a={...i,layerId:t};return e!=null&&(a.url=e),n!=null&&(a.sourceJSON=n),`sublayerTitleMode`in r.prototype&&(a.sublayerTitleMode=`service-name`),new r(a)}async function _(e,t,n){let r=t.sublayerConstructorProvider;for(let{id:i,serverUrl:a}of t.layers){let o=h(t.sublayerInfos,i),s=g(a,i,o,(o&&r?.(o))??t.Constructor,n);e.add(s)}if(t.tables.length){let r=await C(`FeatureLayer`);t.tables.forEach(({id:i,serverUrl:a})=>{let o=g(a,i,h(t.tableInfos,i),r,n);e.tables.add(o)})}}async function v(e,n){let a=i(e);if(a??=await y(e,n),a==null)throw new t(`arcgis-layers:url-mismatch`,"The url '${url}' is not a valid arcgis resource",{url:e});let{serverType:o,sublayer:c}=a,d,f={FeatureServer:`FeatureLayer`,KnowledgeGraphServer:`KnowledgeGraphLayer`,StreamServer:`StreamLayer`,VectorTileServer:`VectorTileLayer`,VideoServer:`VideoLayer`},m=o===`FeatureServer`,h=o===`SceneServer`,g={parsedUrl:a,Constructor:null,layerId:m||h?c??void 0:void 0,layers:[],tables:[]};switch(o){case`MapServer`:if(c!=null){let{type:r}=await u(e,{customParameters:n});switch(d=`FeatureLayer`,r){case`Catalog Layer`:d=`CatalogLayer`;break;case`Catalog Dynamic Group Layer`:throw new t(`arcgis-layers:unsupported`,`fromUrl() not supported for "${r}" layers`)}}else d=await w(e,n)?`TileLayer`:`MapImageLayer`;break;case`ImageServer`:{let t=await u(e,{customParameters:n}),{tileInfo:r,cacheType:i}=t;d=r?r?.format?.toUpperCase()!==`LERC`||i&&i.toLowerCase()!==`elevation`?`ImageryTileLayer`:`ElevationLayer`:`ImageryLayer`;break}case`SceneServer`:{let e=await u(a.url.path,{customParameters:n});if(d=`SceneLayer`,e){let t=e?.layers;if(e?.layerType===`Voxel`)d=`VoxelLayer`;else if(t?.length){let e=t[0]?.layerType;e!=null&&r[e]!=null&&(d=r[e])}}break}case`3DTilesServer`:throw new t(`arcgis-layers:unsupported`,`fromUrl() not supported for 3DTiles layers`);case`FeatureServer`:if(d=`FeatureLayer`,c!=null){let t=await u(e,{customParameters:n});g.sourceJSON=t,g.preferredUrl=s(),d=l(t.type)}break;default:d=f[o]}if(p[d]&&c==null){let t=await x(e,o,n);if(m&&(g.preferredUrl=t.preferredUrl,g.sublayerInfos=t.layerInfos,g.tableInfos=t.tableInfos),t.layers.length+t.tables.length!==1)g.layers=t.layers,g.tables=t.tables,m&&t.layerInfos?.length&&(g.sublayerConstructorProvider=await T(t.layerInfos));else if(m||h){let e=t.layerInfos?.[0]??t.tableInfos?.[0];if(g.layerId=t.layers[0]?.id??t.tables[0]?.id,g.sourceJSON=e,m){let t=e?.type;d=l(t)}}}return g.Constructor=await C(d),g}async function y(e,t){let r=await u(e,{customParameters:t}),i=null,s=null,c=r.type;if(c===`Feature Layer`||c===`Table`?(i=`FeatureServer`,s=r.id??null):c===`indexedVector`?i=`VectorTileServer`:r.hasOwnProperty(`mapName`)?i=`MapServer`:r.hasOwnProperty(`bandCount`)&&r.hasOwnProperty(`pixelSizeX`)?i=`ImageServer`:r.hasOwnProperty(`maxRecordCount`)&&r.hasOwnProperty(`allowGeometryUpdates`)?i=`FeatureServer`:r.hasOwnProperty(`streamUrls`)?i=`StreamServer`:b(r)?(i=`SceneServer`,s=r.id):r.hasOwnProperty(`layers`)&&b(r.layers?.[0])&&(i=`SceneServer`),!i)return null;let l=s==null?null:o(e);return{title:l!=null&&r.name||n(e),serverType:i,sublayer:s,url:{path:l==null?a(e).path:l.serviceUrl}}}function b(e){return e!=null&&e.hasOwnProperty(`store`)&&e.hasOwnProperty(`id`)&&typeof e.id==`number`}async function x(e,t,n){let r,i,a,o=!1;switch(t){case`FeatureServer`:{let t=await d(e,{customParameters:n});a=s(e,{preferredHost:t.preferredHost}),o=!!t.layersJSON,r=t.layersJSON||t.serviceJSON;break}case`SceneServer`:{let t=await S(e,n);r=t.serviceInfo,i=t.tableServerUrl;break}default:r=await u(e,{customParameters:n})}let c=r?.layers,l=r?.tables;return{preferredUrl:a,layers:c?.map(e=>({id:e.id})).reverse()||[],tables:l?.map(e=>({serverUrl:i,id:e.id})).reverse()||[],layerInfos:o?c:[],tableInfos:o?l:[]}}async function S(e,t){let n=await u(e,{customParameters:t});if(!n.layers?.[0])return{serviceInfo:n};try{let{serverUrl:r}=await c(e),i=await u(r,{customParameters:t}).catch(()=>null);return i&&(n.tables=i.tables),{serviceInfo:n,tableServerUrl:r}}catch{return{serviceInfo:n}}}async function C(e){return(0,f[e])()}async function w(e,t){return(await u(e,{customParameters:t})).tileInfo}async function T(e){if(!e.length)return;let t=new Set,n=[];for(let{type:r}of e)t.has(r)||(t.add(r),n.push(C(l(r))));let r=await Promise.all(n),i=new Map;return Array.from(t).forEach((e,t)=>{i.set(e,r[t])}),e=>i.get(e.type)}export{m as fromUrl};