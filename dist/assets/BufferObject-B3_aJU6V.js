import{$E as e,CE as t,ED as n,HE as r,Ns as i,VE as a,Ws as o,js as s,vD as c}from"./index-BN8X5Ryz.js";var l=()=>t.getLogger(`esri.views.webgl.BufferObject`),u=!!n(`esri-tests-disable-gpu-memory-measurements`),d=class t{static createIndex(e,n,r){return new t(e,34963,n,r)}static createUniform(e,n,r){return new t(e,35345,n,r)}static createPixelPack(e,n=35041,r){let i=new t(e,35051,n);return r&&i.setSize(r),i}static createPixelUnpack(e,n=35040,r){return new t(e,35052,n,r)}static createTransformFeedback(e,n=35044,r){let i=new t(e,35982,n);return i.setSize(r),i}constructor(e,t,n,r){this._context=e,this.bufferType=t,this.usage=n,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(s.BufferObject,this),this._glName=this._context.gl.createBuffer(),o(this._context.gl),r&&this.setData(r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(this.bufferType===34963){if(this._indexType===i.UNSIGNED_INT)return 4*this._size;if(this._indexType===i.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return u?0:this.sizeBytes}get _isVAOAware(){return this.bufferType===34963||this.bufferType===34962}dispose(){this._context?.gl?(this._glName&&=(this._context.gl.deleteBuffer(this._glName),null),this._context.instanceCounter.decrement(s.BufferObject,this),this._context=null):this._glName&&l().warn(`Leaked WebGL buffer object`)}setSize(e,t=null){if(this.bufferType===34963&&t!=null)switch(this._indexType=t,t){case i.UNSIGNED_SHORT:e*=2;break;case i.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(t){if(!t)return;let n=t.byteLength;this.bufferType===34963&&(e(t)?this._indexType=i.UNSIGNED_BYTE:r(t)?(n/=2,this._indexType=i.UNSIGNED_SHORT):a(t)&&(n/=4,this._indexType=i.UNSIGNED_INT)),this._setBufferData(n,t)}_setBufferData(e,t=null){this._size=e;let n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);let r=this._context.gl;t==null?r.bufferData(this.bufferType,e,this.usage):r.bufferData(this.bufferType,t,this.usage),o(r),this._isVAOAware&&this._context.bindVAO(n)}setSubData(e,t,n,r){if(!e)return;let i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);let{gl:a}=this._context;a.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,n,r-n),o(a),this._isVAOAware&&this._context.bindVAO(i)}getSubData(e,t=0,n,r){if(n<0||r<0)return;let i=f(e)?e.BYTES_PER_ELEMENT:1;if(i*((n??0)+(r??0))>e.byteLength)return;t+i*(r??0)>this.usedMemory&&l().warn(`Potential problem getting subdata: requested data exceeds buffer size!`);let a=this._context.gl;this.bufferType===35982?(this._context.bindBuffer(this,35982),a.getBufferSubData(35982,t,e,n,r),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),a.getBufferSubData(36662,t,e,n,r),this._context.unbindBuffer(36662))}async getSubDataAsync(e,t=0,n,r){await this._context.clientWaitAsync(),this.getSubData(e,t,n,r)}};function f(e){return c(e)}export{d as t};