import{Dv as e,RS as t,SC as n,_S as r,du as i,fS as a,gC as o,hu as s}from"./index-CzMixifc.js";import{t as c}from"./urlUtils-7tPnOsRB.js";import"./queryUtils-fxq7u50x.js";import"./FixedIntervalBinParameters-5fcY6iRA.js";import{t as l}from"./AttributeBinsFeatureSet-CLvBH7iE.js";import{t as u}from"./AttributeBinsQuery-BqDFZU-T.js";function d(t){let n=t.geometry,i=t.toJSON(),o=i,s,c,l;if(n!=null&&(c=n.spatialReference,l=a(c),o.geometryType=e(n),o.geometry=JSON.stringify(n),o.inSR=l),i.outSR?(o.outSR=a(i.outSR),s=t.outSpatialReference):n&&(o.outSR=o.inSR,s=c),o.bin&&=JSON.stringify(o.bin),o.quantizationParameters&&=JSON.stringify(o.quantizationParameters),o.outStatistics&&=JSON.stringify(o.outStatistics),o.outTimeReference&&=JSON.stringify(o.outTimeReference),i.timeExtent){let e=i.timeExtent,{start:t,end:n}=e;t==null&&n==null||(o.time=t===n?t:`${t??`null`},${n??`null`}`),delete i.timeExtent}return t.defaultSpatialReference&&r(c,s)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function f(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?{data:{features:[]}}:await p(e,t,n)}async function p(e,r,a={}){let s=typeof e==`string`?o(e):e,l=r.geometry?[r.geometry]:[],u=await i(l,null,{signal:a.signal}),f=u?.[0];f!=null&&((r=r.clone()).geometry=f);let p=c({...s.query,f:`json`,...d(r)});return t(n(s.path,`queryBins`),{...a,query:{...p,...a.query}})}async function m(e,t,n){let{data:r}=await f(s(e),u.from(t),n);return l.fromJSON(r)}export{m as executeAttributeBinsQuery};