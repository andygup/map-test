import{Cv as e,Ev as t,Hx as n,Qx as r,Sy as i,Tv as a,Vx as o,_S as s,ay as c,bv as l,dy as u,gy as d,lS as f,my as p,py as m,qy as h,sy as g,vy as _,wx as v,wy as y,xv as b,xy as x,yv as S}from"./index-ByaFsVj4.js";import{t as C}from"./OptimizedGeometry-DX91by73.js";import{I as w,Jt as T,Wt as E,Xt as D,cn as O,gt as k,in as A,kt as j,ln as M,m as N,o as P,st as F,vn as I,wn as L}from"./Point2D-BslC4Gs9.js";import{Bn as R,D as z,Fn as ee,G as te,Gn as ne,Hn as B,Nn as re,On as ie,Pn as ae,Rn as oe,Rt as V,S as H,Tn as U,Wn as se,Z as W,_n as G,c as K,dn as ce,g as le,it as q,j as ue,kn as de,ln as fe,on as pe,pn as me,sn as he,un as ge,w as _e,wn as ve,xn as ye,yn as be,z as xe,zn as Se}from"./SpatialReference-Cd_hfGxp.js";xe()||_e(e=>{let t,i;typeof e==`number`?t=e:i=e;let a={wkid:t,wkt:i},s,c;if(i){s=n(i);let e=f(a);if(!s&&!e)throw Error(`Unsupported WKT type: ${i}`)}else s=!f(a);return c=t&&o.has(t)?Math.PI/200:s?r(a):Math.PI/180,{isPCS:s,metersOrRadiansPerUnit:c,semiMajor:0,wkidOrWkt:e}});var Ce=class{constructor({type:e,spatialReference:t,vertexCount:n,vertexXY:r,vertexZ:i,vertexM:a,partCount:o,partOffsets:s,partFlags:c,segmentFlags:l,segmentIndices:u,segmentParams:d,segmentCountArc:f,segmentCountBezier:p}){this.segmentCountArc=0,this.segmentCountBezier=0,this.type=e,this.spatialReference=t,this.vertexCount=n,this.vertexXY=r,this.vertexZ=i,this.vertexM=a,this.partCount=o,this.partOffsets=s,this.partFlags=c,this.segmentFlags=l,this.segmentIndices=u,this.segmentParams=d,this.segmentCountArc=f,this.segmentCountBezier=p}get segmentParamCount(){return Ne(4)*this.segmentCountArc+Ne(2)*this.segmentCountBezier}get segmentCountLine(){let{segmentCount:e,segmentCountArc:t,segmentCountBezier:n}=this;return e&&e-t-n}get segmentCount(){return this.type===`polyline`?this.vertexCount-this.partCount:this.type===`polygon`?this.vertexCount:0}get hasZ(){return this.vertexZ!=null}get hasM(){return this.vertexM!=null}get hasCurves(){return this.segmentFlags!=null}get isMultipart(){return this.type===`polyline`||this.type===`polygon`}toGeometryJSON(){let e=Me(this),{vertexCount:t,partCount:n,hasZ:r,hasM:i}=this,a=je(this);if(this.type===`point`){let[e,t]=this.vertexXY,n=this.vertexZ?.[0],r=this.vertexM?.[0];return{x:e,y:t,z:n,m:r,spatialReference:a}}let o=0;if(this.type===`multipoint`){let n=[];for(;o<t;)n.push(e(o++));return{points:n,spatialReference:a,hasZ:r,hasM:i}}let s=this.type===`polygon`;if(!this.hasCurves){let t=[];for(let r=0;r<n;++r){let n=this.partOffsets[r+1],i=[];for(;o<n;)i.push(e(o++));s&&i.length>0&&i.push(i[0]),t.push(i)}return s?{rings:t,hasZ:r,hasM:i,spatialReference:a}:{paths:t,hasZ:r,hasM:i,spatialReference:a}}let c=[];for(let{segments:e,startVertex:t}of this.parts){let n=[t];for(let{curve:t}of e)n.push(t);c.push(n)}return s?{rings:[],curveRings:c,hasZ:r,hasM:i,spatialReference:a}:{paths:[],curvePaths:c,hasZ:r,hasM:i,spatialReference:a}}toOptimizedGeometry(){let{vertexCount:e,vertexXY:t,vertexZ:n,vertexM:r,partOffsets:i,hasZ:a,hasM:o}=this,s=new C([],[],a,o),c=Math.max(this.partCount,1),l=this.type===`polygon`,u=0;for(let d=0;d<c;++d){let c=i?.[d+1]??e,f=s.coords.length;for(let e=u;e<c;++e)s.coords.push(t[2*e],t[2*e+1]),a&&s.coords.push(n[e]),o&&s.coords.push(r[e]);if(l){let e=u;s.coords.push(t[2*e],t[2*e+1]),a&&s.coords.push(n[e]),o&&s.coords.push(r[e])}s.lengths.push((s.coords.length-f)/s.stride),u=c}return this.type===`point`&&(s.lengths.length=0),s}clone(){let{type:e,vertexCount:t,partCount:n,hasZ:r,hasM:i,hasCurves:a,segmentCountArc:o,segmentCountBezier:s}=this,c=Fe(e,t,n,r,i,a,o,s);c.spatialReference=this.spatialReference;let{vertexXY:l,vertexZ:u,vertexM:d}=this;c.vertexXY.set(l.subarray(0,2*t),0),c.vertexZ?.set(u.subarray(0,t),0),c.vertexM?.set(d.subarray(0,t),0);let{partOffsets:f,partFlags:p}=this;c.partFlags?.set(p.subarray(0,n+1)),c.partOffsets?.set(f.subarray(0,n+1));let{segmentFlags:m,segmentIndices:h,segmentParams:g,segmentParamCount:_}=this;return c.segmentFlags?.set(m.subarray(0,t),0),c.segmentIndices?.set(h.subarray(0,t),0),c.segmentParams?.set(g.subarray(0,_),0),c}equals(e){return this.equalsWithinTolerance(e,0)}equalsWithinTolerance(e,t){if(e==null)return!1;if(this===e)return!0;if(!s(this.spatialReference,e.spatialReference)||this.vertexCount!==e.vertexCount||this.partCount!==e.partCount||this.hasZ!==e.hasZ||this.hasM!==e.hasM||this.hasCurves!==e.hasCurves||this.segmentCountArc!==e.segmentCountArc||this.segmentCountBezier!==e.segmentCountBezier)return!1;let n=t===0?(e,t)=>e!==t||isNaN(e)!==isNaN(t):(e,n)=>Math.abs(e-n)>t||isNaN(e)!==isNaN(n);for(let t=0;t<this.vertexCount;++t)if(n(this.vertexXY[2*t],e.vertexXY[2*t])||n(this.vertexXY[2*t+1],e.vertexXY[2*t+1]))return!1;if(this.hasZ){for(let t=0;t<this.vertexCount;++t)if(n(this.vertexZ[t],e.vertexZ[t]))return!1}if(this.hasM){for(let t=0;t<this.vertexCount;++t)if(n(this.vertexM[t],e.vertexM[t]))return!1}for(let t=0;t<this.partCount;++t)if(this.partFlags[t]!==e.partFlags[t]||this.partOffsets[t]!==e.partOffsets[t])return!1;if(this.hasCurves){for(let t=0;t<this.vertexCount;++t)if(this.segmentFlags[t]!==e.segmentFlags[t]||this.segmentIndices[t]!==e.segmentIndices[t])return!1;for(let t=0;t<this.segmentParamCount;++t)if(n(this.segmentParams[t],e.segmentParams[t]))return!1}return!0}get parts(){return new we(this)}},we=class{constructor(e){this.geometry=e,this.value=new Te(e)}get done(){return this.value.index>=this.geometry.partCount}next(){return++this.value.index,this}[Symbol.iterator](){return this}},Te=class{constructor(e){this.geometry=e,this.index=-1,this._readVertex=Me(e),this._segments=new Ee(this)}get segments(){return this._segments.reset(),this._segments}get startVertex(){return this._readVertex(this.geometry.partOffsets[this.index])}get vertexCount(){let e=this.geometry.partOffsets;return e[this.index+1]-e[this.index]}},Ee=class{constructor(e){this._part=e,this._partStart=0,this._partEnd=0,this._isPolygon=e.geometry.type===`polygon`,this.value=new De(e.geometry)}get done(){return this.value.indexOfStartVertex>this._partEnd}next(){++this.value.indexOfStartVertex;let e=this.value.indexOfStartVertex>=this._partEnd;return this.value.indexOfEndVertex=e&&this._isPolygon?this._partStart:this.value.indexOfStartVertex+1,this}[Symbol.iterator](){return this}reset(){let{index:e}=this._part,t=this._part.geometry.partOffsets;this._partStart=t[e],this._partEnd=t[e+1]-(this._isPolygon?1:2),this.value.indexOfStartVertex=this._partStart-1}},De=class{constructor(e){this.geometry=e,this.indexOfStartVertex=-1,this.indexOfEndVertex=-1,this._readVertex=Me(e)}get xStart(){return this.geometry.vertexXY[2*this.indexOfStartVertex]}get yStart(){return this.geometry.vertexXY[2*this.indexOfStartVertex+1]}get zStart(){return this.geometry.vertexZ[this.indexOfStartVertex]}get mStart(){return this.geometry.vertexM[this.indexOfStartVertex]}get xEnd(){return this.geometry.vertexXY[2*this.indexOfEndVertex]}get yEnd(){return this.geometry.vertexXY[2*this.indexOfEndVertex+1]}get zEnd(){return this.geometry.vertexZ[this.indexOfEndVertex]}get mEnd(){return this.geometry.vertexM[this.indexOfEndVertex]}get start(){return this._readVertex(this.indexOfStartVertex)}get end(){return this._readVertex(this.indexOfEndVertex)}get curve(){let e=this.geometry.segmentFlags?.[this.indexOfStartVertex]??1;if(e===1)return this.end;let t=this.geometry.segmentParams,n=this.geometry.segmentIndices[this.indexOfStartVertex];if(e===2){let e=t[n++],r=t[n++],i=t[n++],a=t[n++];return{b:[this.end,[e,r],[i,a]]}}let r=t[n++],i=t[n++],a=t[n++],o=t[n++],s=t[n++],c=t[n++];n++,n++;let l=t[n++],u=t[n++];if(!(4&r)&&a===1)return{c:[this.end,[l,u]]};let d=2&r?0:1,f=1&r?0:1;return{a:[this.end,[s,c],d,f,o,i,a]}}};function Oe(e){let n,r,o;if(t(e)){o=`point`;let{x:t,y:i,z:a,m:s}=e,c=[t,i];a!=null&&c.push(a),s!=null&&c.push(s),r=[[c]],n=1}else l(e)?(o=`multipoint`,r=[e.points],n=e.points.length):S(e)?(o=`polyline`,r=e.curvePaths??e.paths,n=r.reduce((e,t)=>e+t.length,0)):(o=`polygon`,r=e.curveRings??e.rings,n=r.reduce((e,t)=>e+t.length-Pe(t),0));let s=Fe(o,n,o.includes(`point`)?0:r.length,b(e),a(e),_(e));function f(e){s.vertexXY[2*C]=e[0],s.vertexXY[2*C+1]=e[1],s.hasZ&&(s.vertexZ[C]=e[2]),s.hasM&&(s.vertexM[C]=e[v]),++C}s.spatialReference=e.spatialReference??void 0;let v=s.hasZ?3:2,C=0;if(!s.isMultipart){if(!s.hasZ&&!s.hasM){for(let[e,t]of r[0])s.vertexXY[2*C]=e,s.vertexXY[2*C+1]=t,++C;return s}for(let e of r[0])f(e);return s}let w=s.type===`polygon`,T=0;if(!s.hasCurves){for(let e of r){s.partOffsets[T++]=C;let t=e.length;if(w&&(t-=Pe(e)),s.hasZ||s.hasM)for(let n=0;n<t;++n)f(e[n]);else for(let n=0;n<t;++n){let[t,r]=e[n];s.vertexXY[2*C]=t,s.vertexXY[2*C+1]=r,++C}}return s.partOffsets[T]=C,s}function E(e){let t=C-1;s.segmentFlags[t]=e;let n=Ne(e);s.segmentIndices[t]=n===0?Le:D,e===4?++s.segmentCountArc:e===2&&++s.segmentCountBezier;let r=D+n;if(r<=(s.segmentParams?.length??0))return;let i=r*Ie;i=20*Math.ceil(i/20);let a=s.segmentParams;if(s.segmentParams=new Float64Array(i),a!=null)for(let e=0;e<a.length;++e)s.segmentParams[e]=a[e]}let D=0;for(let e of r){s.partOffsets[T++]=C,f(e[0]);let t=e.length;w&&(t-=Pe(e));for(let n=1;n<t;++n){let t=e[n];if(d(t)){E(4);let r=s.segmentParams,[i,[a,o],l,u,d,p,h]=t.a,_=4;u||(_|=1),l||(_|=2);let v=g(m(e[n-1]),t),[y,b]=c(v,.5);r[D++]=_,r[D++]=p,r[D++]=h,r[D++]=d,r[D++]=a,r[D++]=o,r[D++]=v.u2-v.u1,r[D++]=v.u1,r[D++]=y,r[D++]=b,f(i);continue}let r=i(t);if(p(t)||r){E(4);let i=s.segmentParams,a=m(t),o=r?y(m(e[n-1]),t):u(m(e[n-1]),t),{cx:c,cy:l,thetaStart:d,thetaEnd:p,radius:g}=o,_=r?0:4;d>p||(_|=1),Math.abs(p-d)<=Math.PI||(_|=2);let[v,b]=r?t.c[1]:h(o,.5);i[D++]=_,i[D++]=g,i[D++]=1,i[D++]=0,i[D++]=c,i[D++]=l,i[D++]=p-d,i[D++]=d,i[D++]=v,i[D++]=b,f(a);continue}if(x(t)){E(2);let e=s.segmentParams,[n,[r,i],[a,o]]=t.b;e[D++]=r,e[D++]=i,e[D++]=a,e[D++]=o,f(n);continue}E(1),f(t)}}return s.partOffsets[T]=C,s}function ke(e,t){return`getSpatialReference`in e&&(t=Ae(e.getSpatialReference()),e=e.getGeometry()),new Ce({...e.toFlatGeometry(),spatialReference:t})}function Ae(e){if(e==null)return;let t=e.getText()||void 0,n=e.isCustomWkid()?0:e.getOldID();if(n<=0)return{wkt:t};let r=e.getLatestID();(r<=0||r===n)&&(r=void 0);let i=e.getVCS();if(i==null)return{wkid:n,latestWkid:r,wkt:t};let a=i.isCustomWkid()?0:i.getOldID();if(a<=0)return{wkt:t};let o=e.getLatestVerticalID();return(o<=0||o===a)&&(o=void 0),{wkid:n,wkt:t,latestWkid:r,vcsWkid:a,latestVcsWkid:o}}Symbol.dispose;function je({spatialReference:e}){return e instanceof v?e.toJSON():e}function Me({vertexXY:e,vertexZ:t,vertexM:n}){return t?n?r=>[e[2*r],e[2*r+1],t[r],n[r]]:n=>[e[2*n],e[2*n+1],t[n]]:n?t=>[e[2*t],e[2*t+1],n[t]]:t=>[e[2*t],e[2*t+1]]}function Ne(e){switch(e){case 1:return 0;case 4:return 10;case 2:return 4}}function Pe(e){if(e.length>0){let t=e[0],n=m(e.at(-1));return t.every((e,t)=>e===n[t])?1:0}return 0}function Fe(e,t,n,r,i,a,o,s){o??=0,s??=0;let c=new Ce({type:e,vertexCount:t,vertexXY:null,vertexZ:void 0,vertexM:void 0,partCount:n,partOffsets:void 0,partFlags:void 0,segmentFlags:void 0,segmentIndices:void 0,segmentParams:void 0,segmentCountArc:o,segmentCountBezier:s}),l=2*Float64Array.BYTES_PER_ELEMENT*t;r&&(l+=Float64Array.BYTES_PER_ELEMENT*t),i&&(l+=Float64Array.BYTES_PER_ELEMENT*t),c.isMultipart&&(l+=(n+1)*Int32Array.BYTES_PER_ELEMENT,l+=(n+1)*Int8Array.BYTES_PER_ELEMENT),a&&(l+=t*Int8Array.BYTES_PER_ELEMENT,l+=t*Int32Array.BYTES_PER_ELEMENT,l+=c.segmentParamCount*Float64Array.BYTES_PER_ELEMENT);let u=new ArrayBuffer(l),d=0;if(c.vertexXY=new Float64Array(u,d,2*t),d+=c.vertexXY.byteLength,r&&(c.vertexZ=new Float64Array(u,d,t),d+=c.vertexZ.byteLength),i&&(c.vertexM=new Float64Array(u,d,t),d+=c.vertexM.byteLength),a&&(c.segmentParams=new Float64Array(u,d,c.segmentParamCount),d+=c.segmentParams.byteLength,c.segmentIndices=new Int32Array(u,d,t),c.segmentIndices.fill(Le),d+=c.segmentIndices.byteLength),c.isMultipart&&(c.partOffsets=new Int32Array(u,d,n+1),d+=c.partOffsets.byteLength,c.partFlags=new Int8Array(u,d,n+1),d+=c.partFlags.byteLength),a&&(c.segmentFlags=new Int8Array(u,d,t),c.segmentFlags.fill(1),d+=c.segmentFlags.byteLength),c.type===`polygon`)for(let e=0;e<n;++e)c.partFlags[e]=1;return c}var Ie=1.61803,Le=-1;function Re({type:e,vertexCount:t,vertexXY:n,vertexZ:r,vertexM:i,partCount:a,partOffsets:o,partFlags:s,segmentFlags:c,segmentIndices:l,segmentParams:u,segmentCountArc:d,segmentCountBezier:f}){let p=new ze[e];if(p instanceof se)return p.setXYCoords(n[0],n[1]),r&&p.setZ(r[0]),i&&p.setM(i[0]),p;let m=new B({fromArray:n});if(p.setAttributeStreamRef(0,m),r){let e=new B({fromArray:r});p.setAttributeStreamRef(1,e)}if(i){let e=new B({fromArray:i});p.setAttributeStreamRef(2,e)}if(p instanceof G)return p.resizeNoInit(t),p;{let e=a+1,t=new ne({fromArray:o,size:e}),n=new oe({fromArray:s,size:e});p.setPathStreamRef(t),p.setPathFlagsStreamRef(n)}if(c==null)return p.resizeImpl(t),p;let h=new oe({fromArray:c}),g=new ne({fromArray:l}),_=new B({fromArray:u});return p.setSegmentData(g,_,h,u.length),p.incCurveType(4,d),p.incCurveType(2,f),p.modifyCurveCounter(d+f),p.resizeImpl(t),p}var ze={point:se,multipoint:G,polyline:ge,polygon:be};function Be(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){let e=this.m_bReturnKey,t=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,e?{value:{m_token:5,m_value:this.m_keys[t]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[t]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function Ve(){if(this.m_i===-1)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){let e={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||e.value.m_value===void 0&&(e.value.m_value=NaN),e}return{value:{m_token:4,m_value:null},done:!0}}var He=class{createJSONObjectIterator(e){return{m_iteratorType:`object`,m_o:e,m_keys:this.m_options.strict?Object.keys(e):Object.keys(e).filter(t=>e[t]!==void 0),m_i:-1,m_bReturnKey:!0,next:Be}}createJSONArrayIterator(e){return{m_iteratorType:`array`,m_strict:this.m_options.strict,m_i:-1,m_a:e,next:Ve}}constructor(e,t){this.m_currentToken=0,this.m_options=t?{...t}:{strict:!0};let n=e;this.m_iteratorStack=[n instanceof Array?this.createJSONArrayIterator(n):this.createJSONObjectIterator(n)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(this.m_iteratorStack.length===0)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(typeof this.m_nextFlatToken.m_value==`number`)return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=E()&&this.m_currentValue<=k()?this.m_currentToken=8:this.m_currentToken=7;if(typeof this.m_nextFlatToken.m_value==`string`)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if(typeof this.m_nextFlatToken.m_value==`boolean`)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if(typeof this.m_nextFlatToken.m_value==`object`)return this.m_currentValue=null,this.m_currentToken=10;M(`unrecognized json element type`)}M(`unrecognized json element type`)}currentToken(){return this.m_currentToken}skipChildren(){if(this.m_iteratorStack.length!==0)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,this.m_currentToken=3;return;case 2:this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,this.m_currentToken=4;return}}currentString(){return this.m_currentToken!==6&&this.m_currentToken!==5&&A(`invalid token`),this.m_currentValue}currentDoubleValue(){return this.m_currentToken!==7&&this.m_currentToken!==8&&A(`invalid token`),this.m_currentValue}currentInt32Value(){return this.m_currentToken!==8&&A(`invalid token`),this.m_currentValue}currentInt64Value(){return I(0),0n}currentBoolValue(){return this.m_currentToken!==12&&this.m_currentToken!==11&&A(`invalid token`),this.m_currentValue}isError(){return 0}},Ue=class{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){let e={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}startArray(){let e=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(e){this.m_pendingKey=e}addValue_(e){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):this.m_currentObject.at(-1).push(e)}addString(e){this.addValue_(e)}addDouble(e,t){this.addValue_(e)}addInt64(e){I(0)}addInt32(e){this.addValue_(e)}addBool(e){this.addValue_(e)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}},We=class e{constructor(e){this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),e.sz===void 0?e.move?(this.m_sz=e.move.m_sz,this.m_buffer=e.move.m_buffer,this.m_view=e.move.m_view,this.m_bOwnsBuffer=e.move.m_bOwnsBuffer,this.m_bLittleEndian=e.move.m_bLittleEndian,e.move.m_buffer=null,e.move.m_view=null,e.move.m_sz=0,e.move.m_bOwnsBuffer=!0):M(`unrecognized constructor options`):(this.m_sz=e.sz,e.buffer?(this.m_sz<0&&T(`size out of range`),this.m_buffer=e.buffer,this.m_offset=e.offset===void 0?0:e.offset,this.m_view=e.offset===void 0?new DataView(this.m_buffer):new DataView(e.buffer,e.offset,e.sz),this.m_bOwnsBuffer=!1,this.m_bLittleEndian=!0):(this.m_sz<0&&T(`size out of range`),this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(e){return this===e||(this.clear(),this.m_sz=e.m_sz,this.m_buffer=e.m_buffer,this.m_view=e.m_view,this.m_bOwnsBuffer=e.m_bOwnsBuffer,this.m_bLittleEndian=e.m_bLittleEndian,e.m_buffer=null,e.m_sz=0,e.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(e.getNativeByteOrder()===1)}setNativeByteOrder(){this.m_bLittleEndian=e.getNativeByteOrder()===1}setOrder(e){this.m_bLittleEndian=e===1}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||D(`buffer not defined`),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(e){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(e,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(e,this.m_bLittleEndian)}writeDouble(e,t){this.m_elementDouble[0]=t,this.swapBytesDouble(),this.m_view.setFloat64(e,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(e){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(e,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(e,this.m_bLittleEndian)}writeInt32(e,t){this.m_elementInt32[0]=t,this.swapBytesInt32(),this.m_view.setInt32(e,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(e){I(e>=0&&e<=this.m_sz),this.m_sz=e}};function Ge(e,t,n,r,i,a){let o=!1,s=!1,c=!1,l=!1,u=!1,d=!1,f=!1,p=!1,m=!1,h=!1,g=!1,_=!1,v=!1,y=!1,b=!1,x=!1,S=!1,C=!1,w=!1,T=!1,E=!1,D=!1,k=!1,j=!1,M=NaN,N=NaN,P=NaN,F=NaN,L=0,R=NaN,z=NaN,te=NaN,ne=NaN,B=NaN,re=NaN,ie=NaN,ae=NaN,oe=0,V=0,H=!1,W=!1,G=null,K=null,ce=null,le=null,q=null;for(;n.nextToken()!==3;){let a=n.currentString();if(n.nextToken(),a===`spatialReference`){if(i&&!o){o=!0,n.currentToken()===1?le=qe(n):n.currentToken()!==10&&A(`failed to parse spatial reference: object or null is expected`);continue}}else if(r)if(a===`hasZ`){if(!s){s=!0,H=n.currentToken()===11;continue}}else if(a===`hasM`){if(!c){c=!0,W=n.currentToken()===11;continue}}else if(a===`rings`){if(!(u||d||e!==O.enumUnknown&&e!==O.enumPolygon)){u=!0,{geometry:q,as:G,bs:K}=Je(!0,!1,t,n);continue}}else if(a===`curveRings`){if(!d&&(e===O.enumUnknown||e===O.enumPolygon)){d=!0,{geometry:q,as:G,bs:K}=Je(!0,!0,t,n);continue}}else if(a===`paths`){if(!(f||p||e!==O.enumUnknown&&e!==O.enumPolyline)){f=!0,{geometry:q,as:G,bs:K}=Je(!1,!1,t,n);continue}}else if(a===`curvePaths`){if(!p&&(e===O.enumUnknown||e===O.enumPolyline)){p=!0,{geometry:q,as:G,bs:K}=Je(!1,!0,t,n);continue}}else if(a===`points`){if(!m&&(e===O.enumUnknown||e===O.enumMultiPoint)){m=!0,{geometry:q,as:G,bs:K}=Ye(t,n);continue}}else if(a===`ids`){if(!l){l=!0,ce=Xe(t,n);continue}}else if(a===`x`){if(!h&&(e===O.enumUnknown||e===O.enumPoint)){h=!0,M=J(n);continue}}else if(a===`y`){if(!g&&(e===O.enumUnknown||e===O.enumPoint)){g=!0,N=J(n);continue}}else if(a===`z`){if(!_&&(e===O.enumUnknown||e===O.enumPoint)){_=!0,P=J(n);continue}}else if(a===`m`){if(!v&&(e===O.enumUnknown||e===O.enumPoint)){v=!0,F=J(n);continue}}else if(a===`id`){if(!y&&(e===O.enumUnknown||e===O.enumPoint)){y=!0,L=Ze(n);continue}}else if(a===`xmin`){if(!b&&(e===O.enumUnknown||e===O.enumEnvelope)){b=!0,R=J(n);continue}}else if(a===`ymin`){if(!x&&(e===O.enumUnknown||e===O.enumEnvelope)){x=!0,z=J(n);continue}}else if(a===`mmin`){if(!E&&(e===O.enumUnknown||e===O.enumEnvelope)){E=!0,ie=J(n);continue}}else if(a===`zmin`){if(!w&&(e===O.enumUnknown||e===O.enumEnvelope)){w=!0,B=J(n);continue}}else if(a===`idmin`){if(!k&&(e===O.enumUnknown||e===O.enumEnvelope)){k=!0,oe=Ze(n);continue}}else if(a===`xmax`){if(!S&&(e===O.enumUnknown||e===O.enumEnvelope)){S=!0,te=J(n);continue}}else if(a===`ymax`){if(!C&&(e===O.enumUnknown||e===O.enumEnvelope)){C=!0,ne=J(n);continue}}else if(a===`mmax`){if(!D&&(e===O.enumUnknown||e===O.enumEnvelope)){D=!0,ae=J(n);continue}}else if(a===`zmax`){if(!T&&(e===O.enumUnknown||e===O.enumEnvelope)){T=!0,re=J(n);continue}}else if(a===`idmax`){if(!j&&(e===O.enumUnknown||e===O.enumEnvelope)){j=!0,V=Ze(n);continue}}else a===`materials`&&I(0);n.skipChildren()}if(u||d||f||p||m){let e=null,t=null,n=q;H&&(q.addAttribute(1),e=G,e||=U(n.getPointCount(),NaN)),W&&(q.addAttribute(2),t=H?K:G),ce!=null&&q.addAttribute(3),H&&e!=null&&n.setAttributeStreamRef(1,e),W&&t!=null&&n.setAttributeStreamRef(2,t),ce!=null&&Qe(n,ce)}else if(h||g||v||_||y){ee(M,N)||A(`failed to parse point: x and y must be finite or nan`),(Number.isNaN(N)||Number.isNaN(M))&&(M=NaN,N=NaN);let e=new se({x:M,y:N});_&&e.setZ(P),v&&e.setM(F),y&&e.setID(L),q=e}else if(b||x||S||C||w||T||E||D||k||j){(Number.isNaN(z)||Number.isNaN(te)||Number.isNaN(ne))&&(R=NaN);let e=new Se({xmin:R,ymin:z,xmax:te,ymax:ne});w&&T&&e.setInterval(1,0,B,re),E&&D&&e.setInterval(2,0,ie,ae),k&&j&&e.setInterval(3,0,oe,V),q=e}return{...q?{geom:q}:{},...le?{sr:le}:{}}}function Ke(e){let t=!1;for(;e.nextToken()!==3;){let n=e.currentString();e.nextToken(),n===`uwkid`?t||(t=!0,e.currentToken()===8&&e.currentInt32Value()):e.skipChildren()}return null}function qe(e){let t=!1,n=!1,r=!1,i=!1,a=!1,o=!1,s=!1,c=!1,l=!1,u=!1,d=!1,f=!1,p=!1,m=!1,h=!1,g=!1,_=!1,v=-1,y=-1,b=-1,x=-1,S=0,C=0,w=0,T=0,E=0,D=0,O=0,k=0,A=0,j=0,M=``,N=``,P=null;for(;e.nextToken()!==3;){let F=e.currentString();e.nextToken(),F===`wkid`?t||(t=!0,e.currentToken()===8&&(v=e.currentInt32Value())):F===`latestWkid`?n||(n=!0,e.currentToken()===8&&(y=e.currentInt32Value())):F===`wkt`?a||(a=!0,e.currentToken()===6&&(M=e.currentString())):F===`wkt2`?a||e.currentToken()===6&&(N=e.currentString()):F===`vcsWkid`?r||(r=!0,e.currentToken()===8&&(b=e.currentInt32Value())):F===`latestVcsWkid`?i||(i=!0,e.currentToken()===8&&(x=e.currentInt32Value())):F===`xyTolerance`?s||(s=!0,o=!0,S=e.currentDoubleValue()):F===`zTolerance`?c||(c=!0,o=!0,C=e.currentDoubleValue()):F===`mTolerance`?l||(l=!0,o=!0,w=e.currentDoubleValue()):F===`falseX`?u||(u=!0,o=!0,O=e.currentDoubleValue()):F===`falseY`?d||(d=!0,o=!0,k=e.currentDoubleValue()):F===`falseZ`?f||(f=!0,o=!0,A=e.currentDoubleValue()):F===`falseM`?p||(p=!0,o=!0,j=e.currentDoubleValue()):F===`xyUnits`?m||(m=!0,o=!0,T=e.currentDoubleValue()):F===`zUnits`?h||(h=!0,o=!0,E=e.currentDoubleValue()):F===`mUnits`?g||(g=!0,o=!0,D=e.currentDoubleValue()):F===`unit`?_||(_=!0,P=Ke(e)):e.skipChildren()}x<=0&&b>0&&(x=b),b<=0&&x>0&&(b=x);let F=null,I=!0;if(M.length!==0&&(I=!1,ue(M)&&(F=W(M))),F||N.length===0||(I=!1,ue(N)&&(F=W(N))),!F&&y>0&&(I=!1,le(y)&&(x<=0||K())&&(F=z(y,x))),!F&&v>0&&(I=!1,le(v)&&(b<=0||K())&&(F=z(v,b))),I&&(F=te(P)),o&&F){let e=new q;F.queryPrecisionDescriptorWithoutFalseXY(e),s&&e.setTolerance(0,S),c&&e.setTolerance(1,C),l&&e.setTolerance(2,w),m&&u&&d&&e.setGridParams(O,k,T),h&&f&&e.setZParams(A,E),g&&p&&e.setMParams(j,D),F=H(F,e)}return F}function Je(e,t,n,r){r.currentToken()!==2&&A(`failed to parse multipath: array of array of vertices is expected`);let i=e?new be:new ge,a=i,o=ie(0),s=U(2,0),c=de(0),l=null,u=null,d=null,f=null,p=null,m=0,h=0,g=0,_=new fe,v=j.getNAN(),y=0,b=0,x=e?1:0;for(;r.nextToken()!==4;){r.currentToken()!==2&&A(`failed to parse multipath: ring/path array is expected`);let n=2,i=0,S=!0,C=0,w=0,T=j.getNAN(),E=F(4,NaN),D=F(4,NaN),O=!1;for(r.nextToken();r.currentToken()!==4;){if(t&&r.currentToken()===1)S&&A(`failed to parse multipath: starting vertex array is expected`),d||(d=de(y-1,1),f=ie(y-1,-1),p=U(0)),O=!0,n=1,{segFlag:g,toPointSz:C}=it(_,E,v,r);else{for(O=!1,r.currentToken()!==2&&A(`failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates`),C=0;r.nextToken()!==4;)C===4&&A(`failed to parse multipath: each vertex array has to have at most 4 elements`),E[C++]=J(r);C<2&&A(`failed to parse multipath: each vertex array has to have at least 2 elements`),ae(E[0],E[1])||A(`failed to parse multipath: x and y must be finite`)}r.nextToken();do{if(s.size()===2*y&&s.resize($e(y)),s.writePoint2D(2*y,T.setCoords(E[0],E[1])),l&&l.size()===y&&l.resize(Y(y)),C>2?(l||=U(y+1,NaN),l.write(y,E[2])):l&&l.write(y,NaN),u&&u.size()===y&&u.resize(Y(y)),C>3?(u||=U(y+1,NaN),u.write(y,E[3])):u&&u.write(y,NaN),S)b++,o.add(y),c.add(x),S=!1,w=C,N(D,E,0,0,w);else if(d!==null)if(O){let e=pe(g),t=p.size();p.resize(t+e),d.add(g),f.add(m),_.get().writeInBufferStream(p,m),m+=e,a.incCurveType(g,1),h++}else d.add(1),f.add(-1);y++,i++,v.setCoords(E[0],E[1])}while(i<n&&r.currentToken()===4)}i!==0&&(e&&i>n&&C===w&&P(E,D,C)===0?(y--,i--):d!==null&&(d.add(1),f.add(-1)))}return y&&(o.resize(b),c.resize(b),y>0&&(o.add(y),c.add(0)),a.setAttributeStreamRef(0,s),a.setPathFlagsStreamRef(c),a.setPathStreamRef(o),d!==null&&(a.updateCurveCounter(h),a.setSegmentData(f,p,d,m)),a.notifyModifiedFlags(65535)),{geometry:i,as:l,bs:u}}function Ye(e,t){t.currentToken()!==2&&A(`failed to parse multipoint: array of vertices is expected`);let n=0,r=new G,i=U(2,0),a=0,o=F(4,NaN),s=new j,c=null,l=null;for(;t.nextToken()!==4;){for(t.currentToken()!==2&&A(`failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates`),a=0;t.nextToken()!==4;)a===4&&A(`failed to parse multipoint: each vertex array has to have at most 4 elements`),o[a++]=J(t);a<2&&A(`failed to parse multipoint: each vertex array has to have at least 2 elements`),ae(o[0],o[1])||A(`failed to parse multipoint: x and y must be finite`),i.size()===2*n&&i.resize($e(n)),i.writePoint2D(2*n,s.setCoords(o[0],o[1])),c&&c.size()===n&&c.resize(Y(n)),a>2?(c||=U(n+1,NaN),c.write(n,o[2])):c&&c.write(n,NaN),l&&l.size()===n&&l.resize(Y(n)),a>3?(l||=U(n+1,NaN),l.write(n,o[3])):l&&l.write(n,NaN),n++}if(n){let e=r.getImpl();e.setAttributeStreamRef(0,i),e.resizeNoInit(n),e.notifyModifiedFlags(65535)}return{geometry:r,as:c,bs:l}}function Xe(e,t){t.currentToken()!==2&&A(`failed to parse array of IDs: array of array of integers is expected`);let n=re(2,0),r=0,i=-1;for(;t.nextToken()!==4;){let e=r;n.size()===r&&n.resize(Y(r)),r++;let a=0;for(i===-1?i=t.currentToken()===2?1:0:i===1&&t.currentToken()!==2&&A(`failed to parse array of IDs: array of array of integers is expected`),i===0&&(n.size()===r&&n.resize(Y(r)),n.write(r,Ze(t)),a++,r++);t.nextToken()!==4;)n.size()===r&&n.resize(Y(r)),n.write(r,Ze(t)),a++,r++;if(n.write(e,a),i===0)break}return n.resize(r),n}function J(e){let t=e.currentToken();if(t===10||t===6&&e.currentString()===`NaN`)return NaN;{let t=e.currentDoubleValue();return Number.isNaN(t)?NaN:t}}function Ze(e){return e.currentInt32Value()}function Qe(e,t){if(e.isEmpty())return;let n=re(2,0),r=e.getGeometryType(),i=0;r===G.type?i=1:r===ge.type||r===be.type?i=e.getPathCount():M(`not implemented`),n.resize(e.getPointCount(),0);let a=0;for(let o=0;o<i;++o){let i=t.read(a);a++;let s=a+i,c=0,l=0;r===G.type?c=e.getPointCount():r===ge.type||r===be.type?(c=e.getPathSize(o),l=e.getPathStart(o)):M(`not implemented`);for(let e=0,r=Math.min(i,c);e<r;++e)n.write(l,t.read(a)),a++,l++;a=s}e.getImpl().setAttributeStreamRef(3,n)}function $e(e){let t=2*Math.trunc(3*(e+1)/2);return t<8?t=8:t<32&&(t=32),t}function Y(e){let t=Math.trunc(3*(e+1)/2);return t<4?t=4:t<16&&(t=16),t}function et(e,t,n,r,i){i>=r.size()&&T(`Byte_buffer out of range access`),e.m_bits=0,e.m_rotation=0,e.m_cosr=1,e.m_sinr=0,e.setStartXY(t),e.setEndXY(n);let a=j.getNAN();a.x=r.readDouble(i),a.y=r.readDouble(i+8);let o=r.readInt32(i+16);if(1&o)return e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,ve(e),!1;let s=!!(64&o),c=!!(128&o),l=!!(32&o),u=!!(8&o),d=!!(16&o),f=t.equals(n);return s&&!f&&(s=!1,l=!0),l&&f&&(s=!0,l=!1,a.setCoords(0,0)),s||(c?l?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0):(e.constructCircularArcThreePoint(t,n,a),f&&u===e.isClockwise()&&e.reverse()):l?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,ve(e),e.queryCoord2D(.5,e.m_interior)):he(e,t,n,a,u,d)),s&&(e.m_center.assign(t),e.m_startAngle=a.x,e.m_sweepAngle=a.y,me(e,NaN,u,d),e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.setCoordsPoint2D(t)),e.setProjectionBehavior(0),ve(e),!0}function tt(e,t,n,r,i){e.m_bits=0,e.m_center.x=r.readDouble(i),e.m_center.y=r.readDouble(i+8),e.m_rotation=r.readDouble(i+16),e.m_semiMajorAxis=r.readDouble(i+24),e.m_minorMajorRatio=r.readDouble(i+32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y;let a=r.readInt32(i+40);if(1&a)return!1;let o=!!(64&a),s=!!(128&a),c=!!(2048&a),l=!!(4096&a);return!(512&a)&&!(1024&a)||s||(o=!0),s&&!t.equals(n)?(s=!1,o=!0):o&&t.equals(n)&&(s=!0,o=!1),s?(e.m_center.assign(t),e.m_startAngle=e.m_center.x,e.m_sweepAngle=e.m_center.y,me(e,NaN,c,l),e.m_semiMajorAxis=0,e.m_interior.setCoordsPoint2D(t)):o?(e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,ve(e),e.queryCoord2D(.5,e.m_interior)):e.constructEllipticArcEndPointsCenter(t,n,e.m_semiMajorAxis,e.m_minorMajorRatio,e.m_rotation,!l,c,e.m_center),e.setProjectionBehavior(1),ve(e),!0}function nt(e,t,n,r,i){return I(i+32<=r.size()),e.m_cp=w(j,2),e.m_cp[0].x=r.readDouble(i),e.m_cp[0].y=r.readDouble(i+8),e.m_cp[1].x=r.readDouble(i+16),e.m_cp[1].y=r.readDouble(i+24),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y,!0}function rt(e,t,n,r,i){return e.m_cp.x=r.readDouble(i),e.m_cp.y=r.readDouble(i+8),e.m_weights[0]=r.readDouble(i+16),e.m_weights[1]=r.readDouble(i+24),e.m_weights[2]=r.readDouble(i+32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y,!0}function it(e,t,n,r,i){let a={segFlag:0,toPointSz:0},o=r.currentToken();o=r.nextToken();let s=r.currentString(),c=s[0];for((s.length!==1||c!==`a`&&c!==`b`&&c!==`c`&&c!==`n`&&c!==`q`)&&A(`failed to parse curve: expecting "a", "b", "n", "q", or "c"`),o=r.nextToken(),o!==2&&A(`failed to parse curve: start array is expected for curve parameters`),o=r.nextToken(),o!==2&&A(`failed to parse curve: start array is expected for to point`),a.toPointSz=0;r.nextToken()!==4;)a.toPointSz===4&&A(`failed to parse curve: vertex array cannot have more than 4 elements`),t[a.toPointSz++]=J(r);a.toPointSz<2&&A(`failed to parse curve: vertex array must have at least 2 elements`);let l=j.construct(t[0],t[1]),u=j.getNAN(),d=-1,f=-1,p=!1,m=NaN,h=NaN,g=NaN,_=[j.getNAN(),j.getNAN(),j.getNAN()],v=j.getNAN();if(c===`a`){o=r.nextToken(),o!==2&&A(`failed to parse curve: start array is expected for center point`),o=r.nextToken();let e=J(r);o=r.nextToken();let t=J(r);o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for center point`),u.setCoords(e,t),o=r.nextToken(),d=r.currentInt32Value(),o=r.nextToken(),f=r.currentInt32Value(),o=r.nextToken(),o===4?p=!0:(p=!1,m=J(r),o=r.nextToken(),h=J(r),o=r.nextToken(),g=J(r),o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for curve parameters`)),a.segFlag=4}else if(c===`b`){for(let e=0;e<2;e++){o=r.nextToken(),o!==2&&A(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let t=J(r);o=r.nextToken();let n=J(r);o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for control point`),_[e].setCoords(t,n)}o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=2}else if(c===`n`){{o=r.nextToken(),o!==2&&A(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let e=J(r);o=r.nextToken();let t=J(r);o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for control point`),_[0].setCoords(e,t)}o=r.nextToken();let e=J(r);o=r.nextToken();let t=J(r);o=r.nextToken();let n=J(r);_[1].setCoords(e,t),_[2].setCoords(n,n),o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=8}else if(c===`q`){for(let e=0;e<1;e++){o=r.nextToken(),o!==2&&A(`failed to parse curve: start array is expected for control point`),o=r.nextToken();let t=J(r);o=r.nextToken();let n=J(r);o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for control point`),_[e].setCoords(t,n)}o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=16}else{o=r.nextToken(),o!==2&&A(`failed to parse curve: start array is expected for interior point`),o=r.nextToken();let e=J(r);o=r.nextToken();let t=J(r);o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for interior point`),v.setCoords(e,t),o=r.nextToken(),o!==4&&A(`failed to parse curve: end array is expected for curve parameters`),a.segFlag=4}return o=r.nextToken(),o!==3&&A(`failed to parse curve: end object is expected for curve`),c===`a`?(e.createEllipticArc(),p?at(e.get(),n,l,u,!0,d,f):ot(e.get(),n,l,u,d,f,m,h,g)):c===`b`?(e.createCubicBezier(),st(e.get(),n,l,_)):c===`n`?(e.createQuadraticRationalBezier(),ct(e.get(),n,l,_[0],_[1].x,_[1].y,_[2].x)):c===`q`?(e.createQuadraticBezier(),e.get().construct(n,_[0],l)):(e.createEllipticArc(),at(e.get(),n,l,v,!1,-1,-1)),a}function at(e,t,n,r,i,a,o){e.dropAllAttributes();let s=new ArrayBuffer(20),c=new We({sz:20,buffer:s}),l=0;c.writeDouble(l,r.x),l+=8,c.writeDouble(l,r.y),l+=8;let u=0;i?(o||(u|=8),a&&(u|=16)):u|=128,c.writeInt32(l,u),l+=4,et(e,t,n,c,0)}function ot(e,t,n,r,i,a,o,s,c){e.dropAllAttributes();let l=new ArrayBuffer(44),u=new We({sz:44,buffer:l}),d=0;u.writeDouble(d,r.x),d+=8,u.writeDouble(d,r.y),d+=8,u.writeDouble(d,o),d+=8,u.writeDouble(d,s),d+=8,u.writeDouble(d,c),d+=8;let f=0;a||(f|=2048),i&&(f|=4096),u.writeInt32(d,f),d+=4,tt(e,t,n,u,0)}function st(e,t,n,r){e.dropAllAttributes();let i=new ArrayBuffer(32),a=new We({sz:32,buffer:i}),o=0;a.writeDouble(o,r[0].x),o+=8,a.writeDouble(o,r[0].y),o+=8,a.writeDouble(o,r[1].x),o+=8,a.writeDouble(o,r[1].y),o+=8,nt(e,t,n,a,0)}function ct(e,t,n,r,i,a,o){e.dropAllAttributes();let s=new ArrayBuffer(40),c=new We({sz:40,buffer:s}),l=0;c.writeDouble(l,r.x),l+=8,c.writeDouble(l,r.y),l+=8,c.writeDouble(l,i),l+=8,c.writeDouble(l,a),l+=8,c.writeDouble(l,o),l+=8,rt(e,t,n,c,0)}function lt(e,t,n,r,i){let a=e.getGeometryType();if(a===O.enumEllipticArc)return ut(e,t,n,r,i);if(a===O.enumBezier)return dt(e,t,n,r,i);if(a===O.enumRationalBezier2)return ft(e,t,n,r,i);if(a===O.enumBezier2){let a=new ye;return a.constructFromQuadraticSegment(e),dt(a,t,n,r,i)}L(``)}function ut(e,t,n,r,i){I(!ce(e));let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;if(o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),e.isDegenerateToLine()||e.isDegenerate(0))return X(o,s,a.x,a.y,c,l,r,i),!0;let u=e.projectionBehavior()===0,d=!!u&&e.isClosed();if(u&&!d)i.startObject(),i.addFieldName(`c`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i),Z(e.m_interior.x,e.m_interior.y,17,i),i.endArray(),i.endObject();else if(u){i.startObject(),i.addFieldName(`a`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i),Z(e.m_center.x+0,e.m_center.y+0,17,i);let t=!e.isMajor();i.addInt32(t?1:0);let n=e.isClockwise();i.addInt32(n?1:0),i.endArray(),i.endObject()}else{i.startObject(),i.addFieldName(`a`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i);let t=e;Z(t.m_center.x,t.m_center.y,17,i);let n=!t.isMajor();i.addInt32(n?1:0);let u=t.isClockwise();i.addInt32(u?1:0),i.addDouble(t.m_rotation,17),i.addDouble(t.m_semiMajorAxis,17),i.addDouble(t.m_minorMajorRatio,17),i.endArray(),i.endObject()}return!1}function dt(e,t,n,r,i){let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;return o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName(`b`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i),Z(e.m_cp[0].x,e.m_cp[0].y,r,i),Z(e.m_cp[1].x,e.m_cp[1].y,r,i),i.endArray(),i.endObject(),!1}function ft(e,t,n,r,i){let a=e.getEndXY(),o=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n,c=NaN,l=NaN;o&&(c=e.getEndAttributeAsDbl(1,0)),s&&(l=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName(`n`),i.startArray(),X(o,s,a.x,a.y,c,l,r,i),Z(e.m_cp.x,e.m_cp.y,r,i);let u=r;return i.addDouble(e.m_weights[0],u),i.addDouble(e.m_weights[1],u),i.addDouble(e.m_weights[2],u),i.endArray(),i.endObject(),!1}function X(e,t,n,r,i,a,o,s){s.startArray(),s.addDouble(n,o),s.addDouble(r,o),e&&s.addDouble(i,o),t&&s.addDouble(a,o),s.endArray()}function Z(e,t,n,r){r.startArray(),r.addDouble(e,n),r.addDouble(t,n),r.endArray()}var pt=class{getOperatorType(){return 10405}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,n,r,i,a){mt(e,t,n,r)}exportSpatialReference(e,t,n,r){I(0)}exportProjectionTransformation(e,t,n,r){I(0)}exportDatumTransformation(e,t,n,r){I(0)}static geometryTypeToString(e){return I(0),``}};function mt(e,t,n,r,i){if(t||n){if(r.startObject(),t!==null)switch(t.getGeometryType()){case O.enumPolygon:ht(!0,e,t,r);break;case O.enumPolyline:ht(!1,e,t,r);break;case O.enumMultiPoint:gt(e,t,r);break;case O.enumPoint:_t(e,t,r);break;case O.enumEnvelope:vt(e,t,r);break;case O.enumMultipatch:I(0);break;default:M(`exportToJSON`)}n!==null&&(r.addFieldName(`spatialReference`),bt(e,n,r)),r.endObject()}}function ht(e,t,n,r){let i=n.getImpl(),a=!!(2&t),o=!!(4&t),s=!!(8&t),c=i.hasAttribute(1)&&!a,l=i.hasAttribute(2)&&!o,u=i.hasAttribute(3)&&!s,d=i.hasNonLinearSegments();c&&(r.addFieldName(`hasZ`),r.addBool(!0)),l&&(r.addFieldName(`hasM`),r.addBool(!0)),e?d?r.addFieldName(`curveRings`):r.addFieldName(`rings`):d?r.addFieldName(`curvePaths`):r.addFieldName(`paths`);let f=null,p=[];if(n.isEmpty())r.startArray(),r.endArray();else{let e=17-(31&t>>13);r.startArray();let s=n.getPathCount(),m=0,h=i.getAttributeStreamRef(0),g=null,_=null,v=null,y=new fe,b=null,x=null,S=null;d&&(b=i.getSegmentFlagsStreamRef(),x=i.getSegmentIndexStreamRef(),S=i.getSegmentDataStreamRef()),c&&(g=i.getAttributeStreamRef(1)),l&&(_=i.getAttributeStreamRef(2)),u&&(v=i.getAttributeStreamRef(3),f=R(3,0));for(let t=0;t<s;t++){r.startArray(),u&&p.push(0);let i=n.getPathEnd(t);if(m===i){r.endArray();continue}let s=n.isClosedPath(t),d=h.read(2*m),C=h.read(2*m+1),w=c?g.read(m):NaN,T=l?_.read(m):NaN,E=u?v.read(m):0;xt(c,l,d,C,w,T,e,r);let D=1;u&&(f.add(E),p[p.length-1]++);let O=d,k=C,A=w,j=T,M=E,N=!1,P=0,F=NaN,I=NaN,R=0;for(let t=m+1,n=m,z=s?i+1:i;t<z;t++,n++){let s=b===null?1:31&b.read(n),m,z;if(t<i?(m=h.read(2*t),z=h.read(2*t+1),c&&(F=g.read(t)),l&&(I=_.read(t)),u&&(R=v.read(t))):(m=O,z=k,F=A,I=j,R=M),s!==1){N=!0,s===4?y.createEllipticArc():s===2?y.createCubicBezier():s===16?y.createQuadraticBezier():s===8?y.createQuadraticRationalBezier():L(`JSON export.unsupported curve`);let t=y.get(),i=x.read(n);t.setStartXYCoords(d,C),t.setEndXYCoords(m,z),c&&(t.setStartAttribute(1,0,w),t.setEndAttribute(1,0,F)),l&&(t.setStartAttribute(2,0,T),t.setEndAttribute(2,0,I)),t.readFromBufferStream(S,i),lt(y.get(),a,o,e,r)&&P++}else xt(c,l,m,z,F,I,e,r);u&&(f.add(R),p[p.length-1]++),D++,d=m,C=z,w=F,T=I,E=R}N&&P===0||(D<2&&P<1&&(xt(c,l,d,C,w,T,e,r),D++,u&&(f.add(E),p[p.length-1]++)),s&&D<3&&P<2&&(xt(c,l,O,k,A,j,e,r),D++,d=O,C=k,w=A,T=j,E=M,u&&(f.add(M),p[p.length-1]++))),r.endArray(),m=i}r.endArray()}if(u){r.addFieldName(`ids`),r.startArray();let e=0;for(let t=0,n=p.length;t<n;++t){let n=p[t];I(n===0||f!==null&&e+n<=f.size()),r.startArray();for(let t=0;t<n;++t)r.addInt32(f.read(e)),e++;r.endArray()}r.endArray()}}function gt(e,t,n){let r=t.getImpl(),i=r.hasAttribute(1)&&!(2&e),a=r.hasAttribute(2)&&!(4&e),o=r.hasAttribute(3)&&!(8&e);i&&(n.addFieldName(`hasZ`),n.addBool(!0)),a&&(n.addFieldName(`hasM`),n.addBool(!0)),n.addFieldName(`points`);let s=t.getPointCount();if(t.isEmpty())n.startArray(),n.endArray();else{let t=17-(31&e>>13);n.startArray();let o=r.getAttributeStreamRef(0),c=null,l=null;i&&(c=r.getAttributeStreamRef(1)),a&&(l=r.getAttributeStreamRef(2));for(let e=0;e<s;e++){let r=o.read(2*e),s=o.read(2*e+1),u=NaN,d=NaN;i&&(u=c.read(e)),a&&(d=l.read(e)),xt(i,a,r,s,u,d,t,n)}n.endArray()}if(o){let e=null;r.isEmpty()||(e=r.getAttributeStreamRef(3)),I(s===0||e!==null&&e.size()>=s),n.addFieldName(`ids`),n.startArray();for(let t=0;t<s;t++)n.addInt32(e.read(t));n.endArray()}}function _t(e,t,n){let r=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),a=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return n.addFieldName(`x`),n.addNull(),n.addFieldName(`y`),n.addNull(),r&&(n.addFieldName(`z`),n.addNull()),i&&(n.addFieldName(`m`),n.addNull()),void(a&&(n.addFieldName(`id`),n.addInt32(0)));let o=17-(31&e>>13);n.addFieldName(`x`),n.addDouble(t.getX(),o),n.addFieldName(`y`),n.addDouble(t.getY(),o),r&&(n.addFieldName(`z`),n.addDouble(t.getZ(),o)),i&&(n.addFieldName(`m`),n.addDouble(t.getM(),o)),a&&(n.addFieldName(`id`),n.addInt32(t.getID()))}function vt(e,t,n){let r=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),a=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return n.addFieldName(`xmin`),n.addNull(),n.addFieldName(`ymin`),n.addNull(),n.addFieldName(`xmax`),n.addNull(),n.addFieldName(`ymax`),n.addNull(),r&&(n.addFieldName(`zmin`),n.addNull(),n.addFieldName(`zmax`),n.addNull()),i&&(n.addFieldName(`mmin`),n.addNull(),n.addFieldName(`mmax`),n.addNull()),void(a&&(n.addFieldName(`idmin`),n.addInt32(0),n.addFieldName(`idmax`),n.addInt32(0)));let o=17-(31&e>>13);if(n.addFieldName(`xmin`),n.addDouble(t.getXMin(),o),n.addFieldName(`ymin`),n.addDouble(t.getYMin(),o),n.addFieldName(`xmax`),n.addDouble(t.getXMax(),o),n.addFieldName(`ymax`),n.addDouble(t.getYMax(),o),r){let e=t.queryInterval(1,0);n.addFieldName(`zmin`),n.addDouble(e.vmin,o),n.addFieldName(`zmax`),n.addDouble(e.vmax,o)}if(i){let e=t.queryInterval(2,0);n.addFieldName(`mmin`),n.addDouble(e.vmin,o),n.addFieldName(`mmax`),n.addDouble(e.vmax,o)}if(a){let e=t.queryInterval(3,0);n.addFieldName(`idmin`),n.addInt32(e.vmin),n.addFieldName(`idmax`),n.addInt32(e.vmax)}}function yt(e,t,n){n.startObject();let r=t.getID();r<=0&&A(`cannot export unit that has no valid WKID`),n.addFieldName(`uwkid`),n.addInt32(r),n.endObject()}function bt(e,t,n){n.startObject();let r=0;t.isCustomWkid()||(r=t.getOldID());let i=0,a=t.getVCS();if(a!==null&&(a.isCustomWkid()||(i=a.getOldID()),i<=0&&(r=0)),r>0){n.addFieldName(`wkid`),n.addInt32(r);let e=t.getLatestID();if(e>0&&e!==r&&(n.addFieldName(`latestWkid`),n.addInt32(e)),i>0){n.addFieldName(`vcsWkid`),n.addInt32(i);let e=t.getLatestVerticalID();e!==i&&(n.addFieldName(`latestVcsWkid`),n.addInt32(e))}}if(t.getCoordinateSystemType()===0)n.addFieldName(`wkid`),n.addNull(),t.getUnit()!==null&&(n.addFieldName(`unit`),yt(e,t.getUnit(),n));else if(r<=0||1&e){let r=``;64&e&&(r=t.getText2(),n.addFieldName(`wkt2`),n.addString(r));let i=t.getText();i!==r&&(n.addFieldName(`wkt`),n.addString(i))}if(16&e){let e=new q;t.queryPrecisionDescriptor(e),n.addFieldName(`xyTolerance`),n.addDouble(e.getTolerance(0)),n.addFieldName(`zTolerance`),n.addDouble(e.getTolerance(1)),n.addFieldName(`mTolerance`),n.addDouble(e.getTolerance(2)),n.addFieldName(`falseX`),n.addDouble(e.getFalseX()),n.addFieldName(`falseY`),n.addDouble(e.getFalseY()),n.addFieldName(`xyUnits`),n.addDouble(e.getGridUnitsXY()),n.addFieldName(`falseZ`),n.addDouble(e.getFalseZ()),n.addFieldName(`zUnits`),n.addDouble(e.getGridUnitsZ()),n.addFieldName(`falseM`),n.addDouble(e.getFalseM()),n.addFieldName(`mUnits`),n.addDouble(e.getGridUnitsM())}n.endObject()}function xt(e,t,n,r,i,a,o,s){s.startArray(),s.addDouble(n,o),s.addDouble(r,o),e&&s.addDouble(i,o),t&&s.addDouble(a,o),s.endArray()}var Q={s_a:97,s_A:65,s_asterisk:42,s_b:98,s_backslash:92,s_beginArray:91,s_beginObject:123,s_colon:58,s_period:46,s_comma:44,s_doubleQuote:34,s_endArray:93,s_endObject:125,s_e:101,s_E:69,s_f:102,s_F:70,s_forwardslash:47,s_minus:45,s_plus:43,s_n:110,s_N:78,s_r:114,s_t:116,s_u:117,s_zero:48,s_nine:57},St=class{constructor(e){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder(`utf-8`,{fatal:!0}),e===void 0?(this.m_startToken=2**53-1,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push(()=>this.accept_()),this.m_jsonString=null,this.m_bHasEscapes=!1):e.jsonString?this.resetParserFromString(e.jsonString):e.jsonStream?L(`streaming json parsing not yet impl`):M(`invalid constructor parameter`)}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(e){let t=this.m_jsonString?.slice(this.m_startToken,this.m_startToken+e-1);return this.m_endToken+=e-1,{s:t,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){L(`streaming json parsing not yet impl`)}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=2**53-1,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push(()=>this.start_()),this.m_pushPositions.length=0}resetParserFromString(e){this.reset_(),this.setStringFunctions_(),this.m_jsonString=e}resetParserFromStream(e){L(`streaming json parsing not yet impl`)}resetToPosition(e){return!!this.m_jsonString&&(this.m_endToken=e,this.m_startToken=Number.MAX_VALUE,this.m_currentTokenType=0,this.m_functionStack.length=0,e>=this.m_jsonString.length?(this.m_functionStack.push(()=>this.accept_()),!1):(this.m_functionStack.push(()=>this.start_()),!0))}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return I(0),``}childrenAsString(){return I(0),``}skipChildren(){this.skipChildren_()}skipChildren_(){if(this.m_currentTokenType===1){let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===1?e++:this.m_currentTokenType===3&&e--;while(this.m_currentTokenType!==3||e!==0);return}if(this.m_currentTokenType===2){let e=1;do this.m_currentTokenType=this.nextToken(),this.m_currentTokenType===2?e++:this.m_currentTokenType===4&&e--;while(this.m_currentTokenType!==4||e!==0);return}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return`null`;case 11:return`true`;case 12:return`false`}A(`invalid token`)}toUTF8_(e,t){let n=0,r=e;for(;t.charCodeAt(r)===Q.s_backslash&&t.charCodeAt(r+1)===Q.s_u;)n++,r+=6;r=e;let i=new Uint8Array(n),a=0;for(;t.charCodeAt(r)===Q.s_backslash&&t.charCodeAt(r+1)===Q.s_u;)i[a++]=Number.parseInt(t.slice(r+2,r+6),16),r+=6;return{u8s:this.m_utf8Decoder.decode(i),end:r}}unquoteCurrentString_(){let e=``,t=1,n=this.m_endToken-this.m_startToken-1,r=0,i=this.m_getCurrentSubstr();for(let a=t;a<n;a++)if(i.charCodeAt(a)!==Q.s_backslash)r++;else{switch(r>0&&(e+=i.slice(t,t+r)),i.charCodeAt(++a)){case Q.s_doubleQuote:e+=`"`;break;case Q.s_u:{let{u8s:t,end:n}=this.toUTF8_(a-1,i);a=n-1,e+=t;break}case Q.s_backslash:e+=`\\`;break;case Q.s_forwardslash:e+=`/`;break;case Q.s_b:e+=`\b`;break;case Q.s_f:e+=`\f`;break;case Q.s_n:e+=`
`;break;case Q.s_r:e+=`\r`;break;case Q.s_t:e+=`	`}t=a+1,r=0}return r>0&&(e+=i.slice(t,t+r)),e}currentString(){return this.m_currentTokenType!==5&&this.m_currentTokenType!==6?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(this.m_currentTokenType!==7&&this.m_currentTokenType!==8&&this.m_currentTokenType!==9&&this.m_currentTokenType!==6&&this.m_currentTokenType!==10&&A(`invalid token`),this.m_currentTokenType===10)return NaN;let e=this.m_getCurrentSubstr(),t=this.m_endToken-this.m_startToken;if(this.m_currentTokenType===6){if(this.currentString()===`NaN`)return NaN;e=e.slice(1),t-=2,t===0&&A(`invalid token`)}let n=Number.parseFloat(e);if(this.m_currentTokenType===6)Number.isNaN(n)&&A(`invalid token`);else if(Number.isNaN(n))return NaN;return n}currentInt32Value(){this.m_currentTokenType!==8&&this.m_currentTokenType!==6&&A(`invalid token`);let e=this.m_getCurrentSubstr(),t=this.m_endToken-this.m_startToken;this.m_currentTokenType===6&&(e=e.slice(1),t-=2,t===0&&A(`invalid token`));let n=parseInt(e);return Number.isNaN(n)&&A(`invalid token`),n}currentInt64Value(){return I(0),0n}currentBoolValue(){return I(0),!1}isError(){return 0}JSONString(){return I(0),``}pushPosition(){return I(0),!1}popPosition(){return I(0),!1}skipCStyleComments_(){I(0)}skipCppStyleComments_(){I(0)}skipComments_(){this.m_prepSubstr();let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),e=this.m_peekChar(),e===Q.s_asterisk?this.skipCStyleComments_():e===Q.s_forwardslash?this.skipCppStyleComments_():A(`invalid token`)}skipWhiteSpace_(){let e;do{this.m_eof()&&A(`invalid token`);let t=this.m_peekChar();for(;t>=9&&t<=13||t===32;)this.m_increment(),this.m_eof()&&A(`invalid token`),t=this.m_peekChar();t===Q.s_forwardslash?(this.m_startToken=this.m_endToken,e=!0,this.skipComments_()):e=!1}while(e)}rightBracket_(){return this.m_peekChar()===Q.s_endArray&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===Q.s_endObject&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&A(`invalid token`);let e=this.m_peekChar();for(;e!==Q.s_doubleQuote;){let t=e===Q.s_backslash;if(this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),e=this.m_peekChar(),t)if(this.m_bHasEscapes=!0,e===Q.s_doubleQuote||e===Q.s_backslash||e===Q.s_forwardslash||e===Q.s_b||e===Q.s_f||e===Q.s_n||e===Q.s_r||e===Q.s_t)this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),e=this.m_peekChar();else if(e===Q.s_u)for(let t=0;t<4;t++)this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),e=this.m_peekChar(),e>=Q.s_zero&&e<=Q.s_nine||e>=Q.s_a&&e<=Q.s_f||e>=Q.s_A&&e<=Q.s_F||A(`invalid token`);else A(`invalid token`)}this.m_stepOverChar()}comma_(){return this.m_peekChar()===Q.s_comma&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===Q.s_colon&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):A(`invalid token`)}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==Q.s_doubleQuote&&A(`invalid token`),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push(()=>this.fieldNameEnd_())}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():A(`invalid token`)}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push(()=>this.elementEnd_()),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():A(`invalid token`)}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push(()=>this.pairEnd_()),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push(()=>this.objectStart_())}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push(()=>this.arrayStart_())}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()===Q.s_zero?this.m_stepOverChar():this.digits_()}digits_(){let e=this.m_peekChar();do this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),e=this.m_peekChar();while(e>=Q.s_zero&&e<=Q.s_nine)}frac_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),e=this.m_peekChar(),e>=Q.s_zero&&e<=Q.s_nine||A(`invalid token`),this.digits_()}exp_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),e=this.m_peekChar(),e!==Q.s_plus&&e!==Q.s_minus||(this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),e=this.m_peekChar()),e>=Q.s_zero&&e<=Q.s_nine||A(`invalid token`),this.digits_()}valueNumber_(){this.m_prepSubstr();let e=!1,t=this.m_peekChar();if(t===Q.s_minus?(this.m_stepOverChar(),this.m_eof()&&A(`invalid token`),t=this.m_peekChar(),e=!0,t>=Q.s_zero&&t<=Q.s_nine||A(`invalid token`),this.int_()):this.int_(),t=this.m_peekChar(),t===Q.s_period)this.m_currentTokenType=7,this.frac_(),t=this.m_peekChar(),t!==Q.s_e&&t!==Q.s_E||this.exp_();else if(t===Q.s_e||t===Q.s_E)this.m_currentTokenType=7,this.exp_();else{let t=0;e&&t++;let n=this.m_endToken-this.m_startToken-t;if(n<10)this.m_currentTokenType=8;else if(n===10){let n=this.m_getCurrentSubstr();e?n.slice(t)<=`2147483648`?this.m_currentTokenType=8:this.m_currentTokenType=9:n.slice(t)<=`2147483647`?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(n<19)this.m_currentTokenType=9;else if(n===19){let n=this.m_getCurrentSubstr();e?n.slice(t)<=`9223372036854775808`?this.m_currentTokenType=9:this.m_currentTokenType=7:n.slice(t)<=`9223372036854775807`?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){let{s:e,bDone:t}=this.m_get(5);t&&A(`invalid token`),e!==`null`&&A(`invalid token`),this.m_currentTokenType=10}valueTrue_(){let{s:e,bDone:t}=this.m_get(5);t&&A(`invalid token`),e!==`true`&&A(`invalid token`),this.m_currentTokenType=11}valueFalse_(){let{s:e,bDone:t}=this.m_get(6);t&&A(`invalid token`),e!==`false`&&A(`invalid token`),this.m_currentTokenType=12}valueNan_(){let{s:e,bDone:t}=this.m_get(4);t&&A(`invalid token`),e!==`NaN`&&A(`invalid token`),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;let e=this.m_peekChar();e===Q.s_beginObject?this.valueStartObject_():e===Q.s_beginArray?this.valueStartArray_():e===Q.s_doubleQuote?this.valueString_():e===Q.s_minus||e>=Q.s_zero&&e<=Q.s_zero+9?this.valueNumber_():e===Q.s_n?this.valueNull_():e===Q.s_t?this.valueTrue_():e===Q.s_f?this.valueFalse_():e===Q.s_N?this.valueNan_():A(`invalid token`)}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push(()=>this.accept_());let e=this.m_peekChar();e!==Q.s_beginObject&&e!==Q.s_beginArray&&A(`invalid token`),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}},Ct=class{getOperatorType(){return 10404}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,n,r,i,a,o){let s;typeof n==`string`?(s=new St({jsonString:n}),s.nextToken()):s=n,s.currentToken()!==1&&A(`failed to import map geometry: start of object is expected`);let c=Ge(t,e,s,r,i);return new V(c)}importSpatialReference(e){let t=qe(e);return t===null&&M(`failed to import spatial reference`),t}importProjectionTransformation(e,t){return I(0),{}}importDatumTransformation(e,t){return I(0),{}}static stringToGeometryType(e){return(e=e.toLowerCase()).startsWith(`esrigeometry`)||A(`string_to_geometry_type`),e.endsWith(`point`)?O.enumPoint:e.endsWith(`envelope`)?O.enumEnvelope:e.endsWith(`multipoint`)?O.enumMultiPoint:e.endsWith(`polyline`)?O.enumPolyline:e.endsWith(`polygon`)?O.enumPolygon:void A(`string_to_geometry_type`)}},$=new Ue,wt=new pt,Tt=new Ct;function Et(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference}function Dt(n,r=!1){if(!r&&(t(n)||l(n)||S(n)||e(n))){let e=new V;return e.setGeometry(Re(Oe(n))),e}let i=new He(n,{strict:!1});return i.nextToken(),Tt.execute(0,O.enumUnknown,i,!0,!1)}function Ot(e){let t=null;return[e.map(e=>{if(t==null){let n=kt(e);return t=n.getSpatialReference(),n.getGeometry()}return At(e)}),t]}function kt(e){let t=Dt(e),n=Mt(e.spatialReference);return n&&t.setSpatialReference(n),t}function At(e){return Dt(e).getGeometry()}function jt(e){return Dt(e,!0).getGeometry()}function Mt(e){if(e==null)return null;let t=!1;if(e instanceof v){let{wkt2:n}=e;e=e.toJSON(),e.wkt2??=n,t=!0}(e.latestVcsWkid||e.vcsWkid)&&(t||(e={...e}),delete e?.latestVcsWkid,delete e?.vcsWkid);let n=new He(e,{strict:!1});n.nextToken();let r=Tt.importSpatialReference(n);return r.getCoordinateSystemType()===0?null:r}function Nt(e,t){if(e instanceof V&&(t=e.getSpatialReference(),e=e.getGeometry()),e==null||e.isEmpty())return null;switch(e.getGeometryType()){case O.enumPoint:case O.enumMultiPoint:case O.enumPolyline:case O.enumPolygon:{let n=ke(e,Pt(t)??void 0).toGeometryJSON();return n.spatialReference??delete n.spatialReference,n}}return $.reset(),wt.execute(0,e,t??null,$),$.getObject()}function Pt(e){return e==null||e.getCoordinateSystemType()===0?null:($.reset(),wt.execute(0,null,e,$),$.getObject().spatialReference)}export{Et as a,Ot as c,jt as i,Mt as n,At as o,kt as r,Pt as s,Nt as t};