import{Bl as e,C_ as t,Mw as n,Nl as r,Ul as i,VT as a,kD as o,pT as s,y_ as c,zl as l}from"./index-BN8X5Ryz.js";import"./quatf64-D37SEdPg.js";import"./Indices-tJiSUK6w.js";import"./plane-Da5EsY0J.js";import"./vectorStacks-Cuo89CNO.js";import"./deduplicate-D-tDe87s.js";import"./BufferView-BW77W5ev.js";import"./Util-BQgFCZvD.js";import"./types-BEunqM4i.js";import"./ObjectStack-l5kM7JZu.js";import"./ray-LkJ58wpZ.js";import"./VertexAttributeLocations-BScEla0R.js";import"./VertexElementDescriptor-Cl_nC_ty.js";import"./vec3-B94Y7ih2.js";import{r as u}from"./sphere-d9-4vNcj.js";import{d,o as f,r as p}from"./lineSegment-BudcKS0C.js";import"./frustum-LgSQ4wIS.js";import{t as m}from"./Octree-czER3kAP.js";import"./FloatArray-Dt98pDp2.js";import"./TextureBackedBufferLayout-C3PSJOOo.js";import"./Normals-B0YlgMdD.js";import{t as h}from"./edgeProcessing-BiG5KLu5.js";var g=1e3;function _(t,n,a){let o=new u;return r(o.center,t,.5),e(o.center,o.center,n,.5),o.radius=l(o.center,t),i(o.center,o.center,a),o}var v=class{constructor(e,t,n){this.objectId=e,this.target=t,this.distance=n}},y=class extends v{constructor(e,t,n){super(e,t,n),this.type=`vertex`}},b=class extends v{constructor(e,t,n,r,i){super(e,t,n),this.start=r,this.end=i,this.type=`edge`}},x=class{constructor(){this._idToComponent=new Map,this._components=new m(e=>e.bounds),this._edges=new m(e=>e.bounds),this._tmpLineSegment=d(),this._tmpP1=c(),this._tmpP2=c(),this._tmpP3=c(),this.remoteClient=null}async fetchCandidates(e,t){await Promise.resolve(),s(t);let n=e;n.mbs=new u(e.mbsJSON),await this._ensureEdgeLocations(n,t);let r=[];return this._edges.forEachNeighbor(e=>(this._addCandidates(n,e,r),r.length<g),n.mbs),{result:{candidates:r}}}async _ensureEdgeLocations(e,t){let n=[];if(this._components.forEachNeighbor(e=>{if(e.info==null){let{id:t,uid:r}=e;n.push({id:t,uid:r})}return!0},e.mbs),!n.length)return;let r={components:n},i=await this.remoteClient.invoke(`fetchAllEdgeLocations`,r,t??{});for(let e of i.components)this._setFetchEdgeLocations(e)}async add(e){let t=new w(e.id,new u(e.bounds));return this._idToComponent.set(t.id,t),this._components.add([t]),{result:{}}}async remove(e){let t=this._idToComponent.get(e.id);if(t){let e=[];this._edges.forEachNeighbor(n=>(n.component===t&&e.push(n),!0),t.bounds),this._edges.remove(e),this._components.remove([t]),this._idToComponent.delete(t.id)}return{result:{}}}_setFetchEdgeLocations(e){let t=this._idToComponent.get(e.id);if(t==null||e.uid!==t.uid)return;let n=h.createView(e.locations),r=Array(n.count),i=c(),a=c();for(let o=0;o<n.count;o++){n.position0.getVec(o,i),n.position1.getVec(o,a);let s=_(i,a,e.origin);r[o]=new T(t,o,s)}this._edges.add(r);let{objectIds:o,origin:s}=e;t.info={locations:n,objectIds:o,origin:s}}_addCandidates(e,t,n){let{info:r}=t.component,{origin:a,objectIds:o}=r,s=r.locations,c=s.position0.getVec(t.index,this._tmpP1),l=s.position1.getVec(t.index,this._tmpP2);i(c,c,a),i(l,l,a);let u=o[s.componentIndex.get(t.index)];this._addEdgeCandidate(e,u,c,l,n),C(e,u,c,n),C(e,u,l,n)}_addEdgeCandidate(e,n,r,i,a){if(!e.returnEdge)return;let o=e.mbs.center,s=f(r,i,this._tmpLineSegment),c=p(s,o,this._tmpP3);e.mbs.contains(c)&&a.push(new b(n,t(c),l(o,c),t(r),t(i)))}};x=o([a(`esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker`)],x);var S=x;function C(e,n,r,i){e.returnVertex&&e.mbs.contains(r)&&i.push(new y(n,t(r),l(e.mbs.center,r)))}var w=class{constructor(e,t){this.id=e,this.bounds=t,this.info=null,this.uid=n()}},T=class{constructor(e,t,n){this.component=e,this.index=t,this.bounds=n}};export{S as default};