const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-icon-QCQFZW6c.js","assets/dom-CJuMMUk1.js","assets/guid-DciZyXg4.js","assets/logger-DwD0cLmT.js","assets/index-CZ4oMP1N.js","assets/index-CDgdHpAj.css","assets/observers-B4A_FKeK.js","assets/calcite-icon-B-4rZ_0i.js","assets/calcite-loader-ClJ4YlRu.js","assets/controllers-D431norp.js","assets/useT9n-BxnHsNZS.js","assets/calcite-loader-gT6XLLpR.js","assets/calcite-notice-ZuvCufOF.js","assets/useSetFocus-qmstydT5.js","assets/openCloseComponent-Bh_XfECY.js","assets/calcite-chip-CYjklxqg.js","assets/interactive-BXtusLaV.js","assets/key-De5LEij1.js","assets/calcite-list-BtV5jDmq.js","assets/calcite-input-CUF3-0ZW.js","assets/form-Dvh-rvhZ.js","assets/label-D7Uu9l3T.js","assets/keyed-Chb4buFh.js","assets/static-DWcgv99t.js","assets/useCancelable-Cppkg7nZ.js","assets/utils2-BYN04F8t.js","assets/calcite-input-message-DmXDblRf.js","assets/calcite-scrim-CdaP-AFA.js","assets/debounce-bXEsmoNp.js","assets/calcite-list-item-CapZUrQu.js","assets/dynamicClasses-BuEj70BV.js","assets/floating-ui-cQPNaiyr.js","assets/resources5-D5TVK2bO.js","assets/resources7-BgVQZlxR.js","assets/calcite-action-C6xwvLMq.js","assets/calcite-dropdown-group-RPsc4mLr.js","assets/calcite-dropdown-item--p-JAr40.js","assets/calcite-dropdown-D6w9DNJT.js","assets/calcite-tooltip-B2oKFO03.js","assets/FloatingArrow-Bpa7woMQ.js","assets/Feature-BF2GlcXu.js","assets/Feature-C9LkNKwU.js","assets/shared-CBxUlSgW.js","assets/throttle-LYImypwQ.js","assets/unitFormatUtils-3ZxnJ6-6.js","assets/quantity-CPor8qMe.js","assets/isImageryGraphicOrigin-F105T3Jm.js","assets/isImageryTileGraphicOrigin-DkUl-5nl.js","assets/AttachmentInfo-CF5-3_Di.js","assets/streamLayerUtils-82UmlW-3.js","assets/executeQueryJSON-DqSFIBMl.js","assets/query-C5yhs-oW.js","assets/urlUtils-BholpLvl.js","assets/pbfQueryUtils-q4mcHKpQ.js","assets/pbf-wXxPPz7x.js","assets/memoryEstimations-DQOvnrRz.js","assets/OptimizedFeatureSet-CTIqq8fn.js","assets/OptimizedGeometry-hOUTi-cB.js","assets/queryUtils-D1dUonfL.js","assets/utils-DhzlDVJ-.js","assets/utils-Cuuurg5i.js","assets/cimSymbolUtils-Q6FkyqJB.js","assets/FeatureUtilityNetworkAssociationsViewModel-iy2UpB7W.js","assets/featureUtils-CYV1Iiyw.js"])))=>i.map(i=>d[i]);
import{BS as e,DT as t,Io as n,Lo as r,OT as i,Xa as a,Ya as o,__ as s,gD as c,gd as l,mg as u,nv as d,pE as f,y_ as p}from"./index-CZ4oMP1N.js";import"./utils-DhzlDVJ-.js";import"./featureUtils-CYV1Iiyw.js";import{n as m,t as h}from"./FeatureUtilityNetworkAssociationsViewModel-iy2UpB7W.js";var g=`esri-utility-network-association-list`,_={featureObserver:`${g}__feature-observer`,limitNoticeContainer:`${g}__limit-notice-container`,loadingContainer:`${g}__loading-container`},v=class extends o{constructor(e,t){super(e,t),this._isFeatureCountNoticeOpen=!0,this._observer=new IntersectionObserver(([e])=>{e?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._observerNode=null,this.featuresPerPage=50,this.headingLevel=5,this.maxFeatureCount=1e3,this.messagesFeature=null,this.messagesCommon=null,this.selectedLayer=null,this.tooltipReferenceMap=new l,this.viewModel=new h}initialize(){this.setUpObserver()}loadDependencies(){return a({icon:()=>e(()=>import(`./calcite-icon-QCQFZW6c.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),loader:()=>e(()=>import(`./calcite-loader-ClJ4YlRu.js`),__vite__mapDeps([8,9,4,5,2,10,11])),notice:()=>e(()=>import(`./calcite-notice-ZuvCufOF.js`),__vite__mapDeps([12,4,5,9,13,1,2,3,6,14,10,7]))})}destroy(){this.tooltipReferenceMap.clear()}get associatedFeatureCount(){let e=this.viewModel.associationViewModels,t=this.selectedLayer?e.get(this.selectedLayer):null;return t?t.length:0}set currentFeaturePage(e){let{featuresPerPage:t,associatedFeatureCount:n}=this,r=Math.ceil(n/t)||1,i=Math.max(Math.min(e,r),1);this._set(`currentFeaturePage`,i)}get currentFeaturePage(){return this._get(`currentFeaturePage`)??1}get endIndex(){let{currentFeaturePage:e,featuresPerPage:t,maxFeatureCount:n}=this;return Math.min(e*t,n)}renderConnectivityIcon(e,t){let{tooltipReferenceMap:n}=this,i;switch(e){case`junction-edge-from-connectivity`:i=`connection-end-left`;break;case`junction-edge-to-connectivity`:i=`connection-end-right`;break;case`junction-edge-midspan-connectivity`:i=`connection-middle`;break;default:i=`connection-to-connection`}return r(`calcite-icon`,{afterCreate:e=>n.set(t,e),afterRemoved:()=>n.delete(t),icon:i,scale:`s`,slot:`content-start`})}renderFeatureCountWarning(){let{associatedFeatureCount:e,maxFeatureCount:t,messagesFeature:n}=this;return e>t?r(`calcite-notice`,{class:this._isFeatureCountNoticeOpen?_.limitNoticeContainer:void 0,closable:!0,icon:`information`,kind:`info`,open:!0,scale:`s`,width:`full`,onCalciteNoticeBeforeOpen:()=>this._isFeatureCountNoticeOpen=!0,onCalciteNoticeClose:()=>this._isFeatureCountNoticeOpen=!1},r(`div`,{slot:`title`},n.associationsLimitNoticeTitle),r(`div`,{slot:`message`},p(n.associationsLimitNoticeMessage,{number:t}))):null}renderFeatureObserver(){return r(`div`,{afterCreate:this._onObserverCreate,bind:this,class:_.featureObserver,key:`feature-observer`})}renderLoading(){return r(`div`,{class:_.loadingContainer,key:`loading-container`},this.renderLoadingIcon())}renderLoadingIcon(){return r(`calcite-loader`,{inline:!0,label:this.messagesCommon.loading})}getConnectivityTooltip(e){let{messagesFeature:t}=this;switch(e){case`connectivity`:case`junction-junction-connectivity`:return t.associationsJunctionJunction;case`junction-edge-from-connectivity`:return t.associationsJunctionEdgeFrom;case`junction-edge-midspan-connectivity`:return t.associationsJunctionEdgeMidspan;case`junction-edge-to-connectivity`:return t.associationsJunctionEdgeTo;default:return``}}setUpObserver(){this.addHandles(d(()=>this._observerNode,()=>this._onObserverChange()))}_increaseFeaturePage(){this.currentFeaturePage++}_onObserverChange(){this._observerNode&&this._observer.unobserve(this._observerNode);let{state:e,showAllEnabled:t}=this.viewModel;this._observerNode&&e===`ready`&&t&&this._observer.observe(this._observerNode)}_onObserverCreate(e){this._observerNode=e}};c([t()],v.prototype,`_observer`,void 0),c([t()],v.prototype,`_observerNode`,void 0),c([t()],v.prototype,`associatedFeatureCount`,null),c([t()],v.prototype,`currentFeaturePage`,null),c([t()],v.prototype,`endIndex`,null),c([t()],v.prototype,`featuresPerPage`,void 0),c([t()],v.prototype,`headingLevel`,void 0),c([t()],v.prototype,`maxFeatureCount`,void 0),c([t(),n(`esri/widgets/Feature/t9n/Feature`)],v.prototype,`messagesFeature`,void 0),c([t(),n(`esri/t9n/common`)],v.prototype,`messagesCommon`,void 0),c([t()],v.prototype,`selectedLayer`,void 0),c([t()],v.prototype,`tooltipReferenceMap`,void 0),c([t({type:h})],v.prototype,`viewModel`,void 0),v=c([i(`esri.widgets.support.UtilityNetworkAssociations.UtilityNetworkAssociationList`)],v);function y(e){let{percentAlong:t}=e;return t==null?``:s(t,{style:`percent`,maximumFractionDigits:2})}function b(e){let{associationType:t}=e;return t===`connectivity`||t===`junction-junction-connectivity`||t===`junction-edge-from-connectivity`||t===`junction-edge-midspan-connectivity`||t===`junction-edge-to-connectivity`}function x(e){return e.associationType===`junction-edge-midspan-connectivity`}var S,C=`esri-feature-utility-network-associations`,w={base:C,listItemHidden:`${C}__list-item--hidden`},T=`nested`,E=S=class extends v{constructor(e,t){super(e,t),this.description=null,this.flowItems=null,this.flowType=`feature-utility-network-association-type`,this.listType=null,this.parentFeatureViewModel=null,this.title=null,this.viewModel=new h,this.visibleElements=new m}initialize(){this.setUpObserver()}loadDependencies(){return a({chip:()=>e(()=>import(`./calcite-chip-CYjklxqg.js`),__vite__mapDeps([15,4,5,9,13,1,2,16,17,3,6,10,7])),icon:()=>e(()=>import(`./calcite-icon-QCQFZW6c.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),list:()=>e(()=>import(`./calcite-list-BtV5jDmq.js`),__vite__mapDeps([18,4,5,9,19,13,1,20,16,17,21,10,22,23,2,3,6,24,25,7,26,11,27,28])),"list-item":()=>e(()=>import(`./calcite-list-item-CapZUrQu.js`),__vite__mapDeps([29,4,5,9,13,1,30,31,28,20,2,16,17,3,6,14,32,33,10,25,34,22,35,36,37,7,11])),tooltip:()=>e(()=>import(`./calcite-tooltip-B2oKFO03.js`),__vite__mapDeps([38,4,5,39,22,1,31,28,2,14]))})}destroy(){this.tooltipReferenceMap.clear()}render(){let e=this.viewModel.associationViewModels,{state:t,showAllEnabled:n}=this.viewModel,{state:i}=this.parentFeatureViewModel??{};return r(`div`,{class:this.classes(w.base,u.widget)},t===`loading`||t===`querying`||i===`loading`?this.renderLoading():n&&this.selectedLayer?r(`calcite-list`,{displayMode:T,filterEnabled:!0,filterLabel:this.messagesFeature.associationFilterPlaceholder,filterPlaceholder:this.messagesFeature.associationFilterPlaceholder,label:this.selectedLayer?.title??this.messagesCommon.untitled},this.renderFeatureCountWarning(),this._renderAssociatedFeatureListPage(),this.renderFeatureObserver()):r(`calcite-list`,{displayMode:T,label:this.selectedLayer?.title??this.messagesCommon.untitled},Array.from(e.keys(),t=>this._renderTypeList(t,e.get(t)))))}_showAllAssociations(e){let{flowItems:t,viewModel:n,description:r}=this;if(!t||!e)return;n.showAllEnabled=!0;let i=new S({selectedLayer:e,title:e?.title,flowItems:t,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:r,visibleElements:new m({title:!1,description:!1}),viewModel:n});t.push(i)}_renderAssociatedFeatureListPage(){let e=this.viewModel.associationViewModels.get(this.selectedLayer).slice(0,this.endIndex);return[...this._renderTooltips(e),...this._renderAssociatedFeatureList(e)]}_renderItemTooltip(e){let{tooltipReferenceMap:t}=this;return b(e.association)?r(`calcite-tooltip`,{key:`tooltip-${e.featureViewModel.uid}`,overlayPositioning:`fixed`,referenceElement:t.get(e.featureViewModel.uid)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){let{featureViewModel:t,title:n}=e,i=t.state===`loading`,a=this._findFlowItem(t),o=a<0&&this._isParentFeature(t),s=o||a>=0;return r(`calcite-list-item`,{class:i?w.listItemHidden:void 0,description:f(e.terminalName??``),key:`associated-feature-type-${t.uid}`,label:f(n),onCalciteListItemSelect:()=>this._handleFeatureClick(o,a,t)},b(e.association)?this.renderConnectivityIcon(e.association.associationType,e.featureViewModel.uid):null,x(e.association)?r(`calcite-chip`,{label:y(e.association),scale:`s`,slot:`content-end`},y(e.association)):null,this._renderChevronIconNode(s))}async _selectAssociation(t){let{flowItems:n,featureVisibleElements:r}=this;if(!n)return;t.abilities={utilityNetworkAssociationsContent:!0};let{default:i}=await e(async()=>{let{default:e}=await import(`./Feature-BF2GlcXu.js`);return{default:e}},__vite__mapDeps([40,41,4,5,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63]));n.push(new i({flowItems:n,flowType:`feature-association`,viewModel:t,visibleElements:r}))}_handleFeatureClick(e,t,n){if(e)this.flowItems.drain(e=>{`showAllEnabled`in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()});else if(t<0||!this.flowItems)this._selectAssociation(n);else for(;this.flowItems.length>t+1;){let e=this.flowItems.pop();e&&(`showAllEnabled`in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy())}}_featureViewModelMatch(e,t){let n=e.graphic,r=n?.layer,i=null;r?.type===`subtype-sublayer`&&r.parent?i=r.parent.globalIdField??null:r&&`globalIdField`in r&&(i=r.globalIdField);let a=i?n?.attributes[i]:null,o=t.graphic,s=o?.layer,c=null;s?.type===`subtype-sublayer`&&s.parent?c=s.parent.globalIdField??null:s&&`globalIdField`in s&&(c=s.globalIdField);let l=c?o?.attributes[c]:null;return a&&l&&a===l}_isParentFeature(e){let t=this.flowItems?.getItemAt(0);if(!t)return!1;let n=t.parentFeatureViewModel;return this._featureViewModelMatch(n,e)}_findFlowItem(e){return this.flowItems?.findIndex(t=>{if(t.flowType!==`feature-association`)return!1;let n=t.viewModel;return this._featureViewModelMatch(n,e)})??-1}_renderTooltips(e){return e.toArray().map(e=>this._renderItemTooltip(e))}_renderAssociatedFeatureList(e){return e.toArray().map(e=>this._renderAssociatedFeature(e))}_renderChevronIconNode(e){return r(`calcite-icon`,{flipRtl:!0,icon:e?`move-up`:`chevron-right`,scale:`s`,slot:`content-end`})}_renderTypeList(e,t){let{messagesFeature:n}=this,{displayCount:i}=this.viewModel,a=t.slice(0,i),o=a.length<t.length;return r(`calcite-list-item`,{expanded:!0,key:`show-all`,label:e.title,value:e.id},r(`calcite-chip`,{label:String(t.length),scale:`s`,slot:`content-end`},t.length),r(`calcite-list`,{group:e.id,label:e.title??``},[this._renderTooltips(a),this._renderAssociatedFeatureList(a)],o?r(`calcite-list-item`,{description:p(n?.numberRecords,{number:t.length.toString()}),key:`show-all-item`,label:n.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(e)},r(`calcite-icon`,{icon:`list`,scale:`s`,slot:`content-end`})):null))}};c([t()],E.prototype,`description`,void 0),c([t()],E.prototype,`featureVisibleElements`,void 0),c([t()],E.prototype,`flowItems`,void 0),c([t()],E.prototype,`flowType`,void 0),c([t()],E.prototype,`listType`,void 0),c([t()],E.prototype,`parentFeatureViewModel`,void 0),c([t()],E.prototype,`title`,void 0),c([t({type:h})],E.prototype,`viewModel`,void 0),c([t({type:m,nonNullable:!0})],E.prototype,`visibleElements`,void 0),E=S=c([i(`esri.widgets.Feature.FeatureUtilityNetworkAssociationList`)],E);var D=E;export{D as default};