import{$x as e,Ax as t,BS as n,BT as r,Bv as i,Ex as a,FE as o,Jv as s,Kx as c,Lx as l,MS as u,Mu as d,Nl as f,Nx as p,Ol as m,Qv as h,Sl as g,VT as _,_l as v,cy as y,dS as b,fS as x,gE as ee,gS as te,iy as S,ju as C,kD as w,kl as T,mD as E,pl as D,sD as O,tS as k,xl as A,y_ as j,zu as ne,zv as re}from"./index-BN8X5Ryz.js";import{n as ie}from"./distanceOperator-Cfhn9VMw.js";import{r as ae,t as oe}from"./simplifyOperator-C6TgASU6.js";import{t as M}from"./quatf64-D37SEdPg.js";import{i as N,t as P}from"./quat-C8PgLo31.js";import{i as F}from"./geodesicUtils-D99LxQ6q.js";var I,L=I=class extends i{constructor(e){super(e),this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit=`meters`}initialize(){let e=this.center,r=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,this.rings.length!==0||!e)return;let i=c(this.radius,this.radiusUnit,`meters`),a=e.spatialReference,o,s=`geographic`;if(a.isWebMercator?s=`webMercator`:((a.wkid&&n[a.wkid])!=null||(a.wkt2||a.wkt)&&k(a.wkt2||a.wkt))&&(s=`projected`),this.geodesic){let n;switch(s){case`webMercator`:n=t(e);break;case`projected`:console.error(`Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system`);break;case`geographic`:n=e}o=this._createGeodesicCircle(n,i,r),s===`webMercator`&&(o=p(o))}else{let t;s===`webMercator`||s===`projected`?t=i/b(e.spatialReference):s===`geographic`&&(t=x(i,`meters`,te(e.spatialReference).radius)),o=this._createPlanarCircle(e,t,r)}this.spatialReference=o.spatialReference,this.addRing(o.rings[0])}get center(){return this._get(`center`)}set center(e){this._set(`center`,ee(a,e))}clone(){let{center:e,numberOfPoints:t,radius:n,radiusUnit:r,geodesic:i}=this;return new I({center:e?.clone(),numberOfPoints:t,radius:n,radiusUnit:r,geodesic:i})}_createGeodesicCircle(e,t,n){let r=[],a=[e.x,e.y];for(let i=0;i<360;i+=360/n){let n=this.hasZ?[0,0,e.z??0]:[0,0];F(n,a,i,t,l.WGS84),r.push(n)}return r.push(r[0]),new i({rings:[r]})}_createPlanarCircle(e,t,n){let r=[],a=2*Math.PI/n;for(let i=0;i<n;++i){let n=a*i,o=[e.x+Math.cos(-n)*t,e.y+Math.sin(-n)*t];this.hasZ&&o.push(e.z??0),r.push(o)}return r.push(r[0]),new i({spatialReference:e.spatialReference,rings:[r]})}};w([r({type:a,useTypeForAutocast:!1,value:null})],L.prototype,`center`,null),w([r()],L.prototype,`geodesic`,void 0),w([r()],L.prototype,`numberOfPoints`,void 0),w([r()],L.prototype,`radius`,void 0),w([r()],L.prototype,`radiusUnit`,void 0),L=I=w([_(`esri.geometry.Circle`)],L);var R=L;function z(e,t,n=null){return n==null?[e,t]:[e,t,n]}function B(e,t,n=null){return n==null?{x:e,y:t}:{x:e,y:t,z:n}}var V=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(e=>this.mapToLocal(e)).filter(O)}get doUnnormalization(){return!1}},H=class extends V{constructor(e,t,n=null){super(t),this._defaultZ=n,this.transform=C(),this.transformInv=C(),this.transform=d(e),ne(this.transformInv,this.transform)}makeMapPoint(e,t){return z(e,t,this._defaultZ)}mapToLocal(e){return B(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return z(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},U=class extends V{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=j(),this.tangentFrameUpWS=j(),this.tangentFrameRightWS=j(),this.tangentFrameForwardWS=j(),this.localFrameRightWS=j(),this.localFrameUpWS=j(),this.worldToLocalTransform=M(),this.localToWorldTransform=M(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;let n=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,0,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,1,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,2,this.tangentFrameForwardWS);let r=j();f(r,this.tangentFrameForwardWS,A(n,this.tangentFrameForwardWS)),T(this.localFrameRightWS,n,r),D(this.localFrameRightWS,this.localFrameRightWS),m(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),N(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),P(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode===`global`}makeMapPoint(e,t){return z(e,t,this.defaultZ)}mapToLocal(e){let t=j();this.view.renderCoordsHelper.toRenderCoords(new a({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),g(t,t,this.worldToLocalTransform);let n=this.view.renderCoordsHelper.fromRenderCoords(t,new a({spatialReference:this.view.spatialReference}));return n==null?null:B(n.x/this.scale,n.y/this.scale)}localToMap(e){let t=j();this.view.renderCoordsHelper.toRenderCoords(new a({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),g(t,t,this.localToWorldTransform);let n=this.view.renderCoordsHelper.fromRenderCoords(t,new a({spatialReference:this.view.spatialReference}));return n==null?null:z(n.x,n.y,this.defaultZ)}};function W(e,t){if(e.type===`2d`)return new H(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type===`3d`){let n=t.length>2?new a({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new a({x:t[0],y:t[1],spatialReference:e.spatialReference});return new U(e,n)}return null}function G(e,t){let n=new a({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function K(e,t){return new y({points:e,spatialReference:t})}function se(e,t,n){let r=new re({paths:e,spatialReference:t});return n&&S(r),r}function q(e,t,n,r=!0){let a=o(e);a.forEach(e=>{let t=e[0],n=e[e.length-1];E(t,n)&&e.length!==1||e.push(e[0])});let s=new i({rings:a,spatialReference:t});return s.rings.forEach(e=>{h(e)||e.reverse()}),n&&S(s),r&&!oe(s)&&u(t)&&(s=ae(s)||s),s}function ce(e,t,n){let r=t.mapToLocalMultiple(e),i=[],a={x:r[0].x,y:r[0].y},o={x:r[1].x,y:r[1].y},s=Math.round(o.x-a.x),c=Math.round(o.y-a.y),l=Math.max(Math.abs(s),Math.abs(c));if(n){let e={x:a.x+l,y:a.y+l},t={x:a.x-l,y:a.y-l};i.push(B(e.x,t.y),B(t.x,t.y),B(t.x,e.y),B(e.x,e.y))}else{let e={x:s>0?a.x+l:a.x-l,y:c>0?a.y+l:a.y-l};i.push(B(a.x,a.y),B(e.x,a.y),B(e.x,e.y),B(a.x,e.y))}return J(q([i.map(e=>t.localToMap(e)).filter(O)],t.spatialReference,t.doUnnormalization,!0),i,t)}function le(e,t,n){let r=t.mapToLocalMultiple(e);if(r.length===1){let e=r[0];r=[B(e.x-48,e.y+48),B(e.x+48,e.y-48),B(e.x+48,e.y-48),B(e.x-48,e.y+48)]}let i=[],a={x:r[0].x,y:r[0].y},o={x:r[1].x,y:r[1].y};if(n){let e=Math.round(o.x-a.x),t=Math.round(o.y-a.y);i.push(B(a.x-e,a.y-t),B(o.x,a.y-t),B(o.x,o.y),B(a.x-e,o.y))}else i.push(B(a.x,a.y),B(o.x,a.y),B(o.x,o.y),B(a.x,o.y));return J(q([i.map(e=>t.localToMap(e)).filter(O)],t.spatialReference,t.doUnnormalization,!0),i,t)}function J(e,t,n){let r=Y(t[3],t[2],n),i=Y(t[1],t[2],n),a=Y(t[0],t[1],n),o=Y(t[0],t[3],n);return{geometry:e,midpoints:r!=null&&i!=null&&a!=null&&o!=null?{top:r,right:i,bottom:a,left:o}:null}}function Y(e,t,n){Z[0]=e.x,Z[1]=e.y,Z[2]=0,Q[0]=t.x,Q[1]=t.y,Q[2]=0,v(Z,Z,Q,.5),X.x=Z[0],X.y=Q[1],X.z=Q[2];let r=n.localToMap(X);return r==null?null:G(r,n.spatialReference)}var X=B(0,0,0),Z=j(),Q=j();function $(t,n,r,i){let a=n.mapToLocalMultiple(t),o=null,c=null;if(r)o=a[0],c=a[1];else{let e=a[0],t=a[1],n=Math.round(t.x-e.x),r=Math.round(t.y-e.y),i=Math.max(Math.abs(n),Math.abs(r));o=B(n>0?e.x+i/2:e.x-i/2,r>0?e.y+i/2:e.y-i/2),c=B(Math.abs(n)>Math.abs(r)?o.x-i/2:o.x,Math.abs(n)>Math.abs(r)?o.y:o.y-i/2)}let l=n.localToMap(o),d=n.localToMap(c);if(l==null||d==null)return null;n.doUnnormalization&&s([[l,d]],n.spatialReference);let f=G(l,n.spatialReference),p=G(d,n.spatialReference),m=e(n.spatialReference),h=0;if(u(n.spatialReference))h=m*ie(f,p);else{let e=o.x-c.x,t=o.y-c.y;h=m*Math.sqrt(e*e+t*t)*(i||1)}let g=new R({center:f,radius:h,radiusUnit:`meters`,spatialReference:n.spatialReference});return{geometry:q(g.rings,g.spatialReference,!1),center:f,edge:p}}function ue(e,t,n){let r=t.mapToLocalMultiple(e),i=r[0],a=r[1],o=Math.round(a.x-i.x),s=Math.round(a.y-i.y),c=B(n?i.x:i.x+o/2,n?i.y:i.y+s/2),l=n?o:o/2,u=n?s:s/2,d=[],f=2*Math.PI/60;function p(e){let t=Math.cos(e),n=Math.sin(e);return B(l*t+c.x,u*n+c.y)}for(let e=0;e<60;e++)d.push(p(e*f));d.push(d[0]);let{spatialReference:m,doUnnormalization:h}=t,g=q([d.map(e=>t.localToMap(e)).filter(O)],m,h,!1),_=t.localToMap(p(Math.PI/2)),v=t.localToMap(p(0)),y=t.localToMap(p(-Math.PI/2)),b=t.localToMap(p(Math.PI));return{geometry:g,midpoints:_!=null&&v!=null&&y!=null&&b!=null?{top:G(_,m),right:G(v,m),bottom:G(y,m),left:G(b,m)}:null}}export{se as a,W as c,ce as i,q as n,$ as o,le as r,ue as s,K as t};