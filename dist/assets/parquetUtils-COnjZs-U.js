import{BT as e,DT as t,GC as n,OT as r,PT as i,gD as a,gw as o,ud as s,wx as c}from"./index-ByaFsVj4.js";import{t as l}from"./locationUtils--XC6iMLt.js";import{n as u,r as d,t as f}from"./parquet-CnsHOdiv.js";var p=class extends o(n){constructor(e){super(e),this.type=null}};a([t({type:[`wkb`,`location`],nonNullable:!0,readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],p.prototype,`type`,void 0),p=a([r(`esri.layers.support.ParquetGeometryEncodingBase`)],p);var m=class extends p{constructor(e){super(e),this.type=`location`,this.xField=null,this.yField=null}};a([t({type:[`location`]})],m.prototype,`type`,void 0),a([t({type:String,json:{write:{isRequired:!0}}})],m.prototype,`xField`,void 0),a([t({type:String,json:{write:{isRequired:!0}}})],m.prototype,`yField`,void 0),m=a([r(`esri.layers.support.ParquetGeometryEncodingLocation`)],m);var h=class extends p{constructor(e){super(e),this.type=`wkb`,this.field=null}};a([t({type:[`wkb`]})],h.prototype,`type`,void 0),a([t({type:[`counter-clockwise`],json:{write:!0}})],h.prototype,`orientation`,void 0),a([t({type:String,json:{write:{isRequired:!0}}})],h.prototype,`field`,void 0),h=a([r(`esri.layers.support.ParquetGeometryEncodingWkb`)],h);var g=new i({esriGeometryPoint:`point`,esriGeometryPolygon:`polygon`,esriGeometryPolyline:`polyline`,esriGeometryMultipoint:`multipoint`});function _(e){return g.toJSON(e)}function v(e){return g.fromJSON(e)}async function y(t,n={}){if(t.urls.length<1)throw new e(`parquet:bad-input`,`At least one url must be specified`,t);if(t.geometryType&&t.spatialReference&&t.geometryEncoding&&t.fields)return t;let r=await f(t.urls.getItemAt(0),{getCustomParameters:()=>n.customParameters}),i=d(r),a={...t,file:r};a.fields??=r.fields().map(e=>s.fromJSON({name:e.name,alias:e.name,type:e.type})),a.geometryEncoding??=b(i,a.fields);let o=u(r);if(o)switch(o.mode){case`z`:a.displayOptimization={mode:`z`};break;case`xz`:{let t=o.multiscale;if(!t)throw new e(`parquet:bad-format`,`XZ display optimization requires multiscale geometries`);a.displayOptimization={mode:`xz`,multiscale:t};break}}if(!a.geometryEncoding)return a;switch(a.geometryEncoding.type){case`location`:a.spatialReference??=c.WGS84,a.geometryType??=`point`;break;case`wkb`:{if(!i)return a;let e=i.primary_column,t=i.columns[e];if(a.geometryType||=S(t),a.spatialReference||=C(t),a.fields)for(let e of Object.keys(i.columns))a.fields=a.fields.filter(t=>t.name!==e)}}return a}function b(e,t){if(e!=null){let t=e.primary_column,n=e.columns[t];return new h({field:t,orientation:n.orientation===`counterclockwise`?`counter-clockwise`:null})}let n=l(t.map(e=>e.name));return n.latitudeFieldName&&n.longitudeFieldName?new m({xField:n.longitudeFieldName,yField:n.latitudeFieldName}):null}function x(e){switch(e){case`Point`:return`point`;case`Polygon`:case`MultiPolygon`:return`polygon`;case`LineString`:return`polyline`;case`MultiPoint`:return`multipoint`;default:return null}}function S(t){let{geometry_types:n}=t,r=new Set;for(let e of n){let t=x(e);t&&r.add(t)}if(r.size>1)throw new e(`parquet:unsupported`,`Parquet mixed geometry types are not supported`,{geometryTypes:r});return r.size===1?r.values().next().value:void 0}function C(e){let t=e.crs?.id?.code;return t&&typeof t==`number`?new c({wkid:t}):void 0}export{h as a,_ as i,y as n,m as o,v as r,p as s,g as t};