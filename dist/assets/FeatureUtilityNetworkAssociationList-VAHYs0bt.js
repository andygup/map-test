const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-icon-ZCv5ZmNZ.js","assets/dom-Bpg08XkK.js","assets/guid-DXI_j_tE.js","assets/logger-1v_TMxSk.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/observers-CUqeLQzx.js","assets/calcite-icon-D_31OgfB.js","assets/calcite-loader-BYP4y81j.js","assets/controllers-Cmbr8Uab.js","assets/useT9n-DZyTN8nl.js","assets/calcite-loader-woZHFNIn.js","assets/calcite-notice-RreQMm4_.js","assets/useSetFocus-BrI7c0jD.js","assets/openCloseComponent-D7k9ypaE.js","assets/calcite-chip-CdLGsOXt.js","assets/interactive-DmKyCklX.js","assets/key-B8qHARd6.js","assets/calcite-list-qO7YWIzN.js","assets/calcite-input-CnRnt-tx.js","assets/form-lIz1QVng.js","assets/label-CqUqf6rY.js","assets/keyed-kzgDmr9j.js","assets/static-Cg6ZlIUu.js","assets/useCancelable-1RHajUTE.js","assets/utils2-B3pQ6l0Q.js","assets/calcite-input-message-DWA0a61n.js","assets/calcite-scrim-BnPV8oup.js","assets/debounce-lAdGmXcC.js","assets/calcite-list-item-D-SEOpez.js","assets/dynamicClasses-rPflUtDl.js","assets/floating-ui-BsOg9dhd.js","assets/resources5-2xqnzFHZ.js","assets/resources7-DDltrXrR.js","assets/calcite-action-BAFbTsa7.js","assets/calcite-dropdown-group-B9uHF3Ku.js","assets/calcite-dropdown-item-CFMjCXhP.js","assets/calcite-dropdown-D8cqVK7j.js","assets/calcite-tooltip-BCXDzpxj.js","assets/FloatingArrow-CBjlsvWq.js","assets/Feature-DNGDXoJM.js","assets/Feature-CtpWygbX.js","assets/shared-Bq4SQ-mm.js","assets/throttle-DtObBf3w.js","assets/unitFormatUtils-DIX5VDC2.js","assets/quantity-Co6flzuS.js","assets/isImageryGraphicOrigin-b14Iy_JD.js","assets/isImageryTileGraphicOrigin-C3baAvdY.js","assets/AttachmentInfo-DsQfdj7K.js","assets/streamLayerUtils-82UmlW-3.js","assets/executeQueryJSON-DJO3NDvM.js","assets/query-BXrgTHrc.js","assets/urlUtils-CW4cnJ3W.js","assets/pbfQueryUtils-CmJPTrN7.js","assets/pbf-CO6WFbVS.js","assets/memoryEstimations-D_IbKyOk.js","assets/OptimizedFeatureSet-CLjmRHYn.js","assets/OptimizedGeometry-BQJ7w5VU.js","assets/queryUtils-8f7b9mi_.js","assets/utils-Bftaersa.js","assets/utils-BGjabRH0.js","assets/cimSymbolUtils-CLt57XQ8.js","assets/FeatureUtilityNetworkAssociationsViewModel-SiG0AZCc.js","assets/featureUtils-7G9M0Fu-.js"])))=>i.map(i=>d[i]);
import{$S as e,A_ as t,BT as n,EE as r,Ed as i,Lo as a,O_ as o,Ro as s,Tg as c,VT as l,Xa as u,Za as d,kD as f,pv as p}from"./index-BN8X5Ryz.js";import"./utils-Bftaersa.js";import"./featureUtils-7G9M0Fu-.js";import{n as m,t as h}from"./FeatureUtilityNetworkAssociationsViewModel-SiG0AZCc.js";var g=`esri-utility-network-association-list`,_={featureObserver:`${g}__feature-observer`,limitNoticeContainer:`${g}__limit-notice-container`,loadingContainer:`${g}__loading-container`},v=class extends u{constructor(e,t){super(e,t),this._isFeatureCountNoticeOpen=!0,this._observer=new IntersectionObserver(([e])=>{e?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._observerNode=null,this.featuresPerPage=50,this.headingLevel=5,this.maxFeatureCount=1e3,this.messagesFeature=null,this.messagesCommon=null,this.selectedLayer=null,this.tooltipReferenceMap=new i,this.viewModel=new h}initialize(){this.setUpObserver()}loadDependencies(){return d({icon:()=>e(()=>import(`./calcite-icon-ZCv5ZmNZ.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),loader:()=>e(()=>import(`./calcite-loader-BYP4y81j.js`),__vite__mapDeps([8,9,4,5,2,10,11])),notice:()=>e(()=>import(`./calcite-notice-RreQMm4_.js`),__vite__mapDeps([12,4,5,9,13,1,2,3,6,14,10,7]))})}destroy(){this.tooltipReferenceMap.clear()}get associatedFeatureCount(){let e=this.viewModel.associationViewModels,t=this.selectedLayer?e.get(this.selectedLayer):null;return t?t.length:0}set currentFeaturePage(e){let{featuresPerPage:t,associatedFeatureCount:n}=this,r=Math.ceil(n/t)||1,i=Math.max(Math.min(e,r),1);this._set(`currentFeaturePage`,i)}get currentFeaturePage(){return this._get(`currentFeaturePage`)??1}get endIndex(){let{currentFeaturePage:e,featuresPerPage:t,maxFeatureCount:n}=this;return Math.min(e*t,n)}renderConnectivityIcon(e,t){let{tooltipReferenceMap:n}=this,r;switch(e){case`junction-edge-from-connectivity`:r=`connection-end-left`;break;case`junction-edge-to-connectivity`:r=`connection-end-right`;break;case`junction-edge-midspan-connectivity`:r=`connection-middle`;break;default:r=`connection-to-connection`}return s(`calcite-icon`,{afterCreate:e=>n.set(t,e),afterRemoved:()=>n.delete(t),icon:r,scale:`s`,slot:`content-start`})}renderFeatureCountWarning(){let{associatedFeatureCount:e,maxFeatureCount:n,messagesFeature:r}=this;return e>n?s(`calcite-notice`,{class:this._isFeatureCountNoticeOpen?_.limitNoticeContainer:void 0,closable:!0,icon:`information`,kind:`info`,open:!0,scale:`s`,width:`full`,onCalciteNoticeBeforeOpen:()=>this._isFeatureCountNoticeOpen=!0,onCalciteNoticeClose:()=>this._isFeatureCountNoticeOpen=!1},s(`div`,{slot:`title`},r.associationsLimitNoticeTitle),s(`div`,{slot:`message`},t(r.associationsLimitNoticeMessage,{number:n}))):null}renderFeatureObserver(){return s(`div`,{afterCreate:this._onObserverCreate,bind:this,class:_.featureObserver,key:`feature-observer`})}renderLoading(){return s(`div`,{class:_.loadingContainer,key:`loading-container`},this.renderLoadingIcon())}renderLoadingIcon(){return s(`calcite-loader`,{inline:!0,label:this.messagesCommon.loading})}getConnectivityTooltip(e){let{messagesFeature:t}=this;switch(e){case`connectivity`:case`junction-junction-connectivity`:return t.associationsJunctionJunction;case`junction-edge-from-connectivity`:return t.associationsJunctionEdgeFrom;case`junction-edge-midspan-connectivity`:return t.associationsJunctionEdgeMidspan;case`junction-edge-to-connectivity`:return t.associationsJunctionEdgeTo;default:return``}}setUpObserver(){this.addHandles(p(()=>this._observerNode,()=>this._onObserverChange()))}_increaseFeaturePage(){this.currentFeaturePage++}_onObserverChange(){this._observerNode&&this._observer.unobserve(this._observerNode);let{state:e,showAllEnabled:t}=this.viewModel;this._observerNode&&e===`ready`&&t&&this._observer.observe(this._observerNode)}_onObserverCreate(e){this._observerNode=e}};f([n()],v.prototype,`_observer`,void 0),f([n()],v.prototype,`_observerNode`,void 0),f([n()],v.prototype,`associatedFeatureCount`,null),f([n()],v.prototype,`currentFeaturePage`,null),f([n()],v.prototype,`endIndex`,null),f([n()],v.prototype,`featuresPerPage`,void 0),f([n()],v.prototype,`headingLevel`,void 0),f([n()],v.prototype,`maxFeatureCount`,void 0),f([n(),a(`esri/widgets/Feature/t9n/Feature`)],v.prototype,`messagesFeature`,void 0),f([n(),a(`esri/t9n/common`)],v.prototype,`messagesCommon`,void 0),f([n()],v.prototype,`selectedLayer`,void 0),f([n()],v.prototype,`tooltipReferenceMap`,void 0),f([n({type:h})],v.prototype,`viewModel`,void 0),v=f([l(`esri.widgets.support.UtilityNetworkAssociations.UtilityNetworkAssociationList`)],v);function y(e){let{percentAlong:t}=e;return t==null?``:o(t,{style:`percent`,maximumFractionDigits:2})}function b(e){let{associationType:t}=e;return t===`connectivity`||t===`junction-junction-connectivity`||t===`junction-edge-from-connectivity`||t===`junction-edge-midspan-connectivity`||t===`junction-edge-to-connectivity`}function x(e){return e.associationType===`junction-edge-midspan-connectivity`}var S,C=`esri-feature-utility-network-associations`,w={base:C,listItemHidden:`${C}__list-item--hidden`},T=`nested`,E=S=class extends v{constructor(e,t){super(e,t),this.description=null,this.flowItems=null,this.flowType=`feature-utility-network-association-type`,this.listType=null,this.parentFeatureViewModel=null,this.title=null,this.viewModel=new h,this.visibleElements=new m}initialize(){this.setUpObserver()}loadDependencies(){return d({chip:()=>e(()=>import(`./calcite-chip-CdLGsOXt.js`),__vite__mapDeps([15,4,5,9,13,1,2,16,17,3,6,10,7])),icon:()=>e(()=>import(`./calcite-icon-ZCv5ZmNZ.js`),__vite__mapDeps([0,1,2,3,4,5,6,7])),list:()=>e(()=>import(`./calcite-list-qO7YWIzN.js`),__vite__mapDeps([18,4,5,9,19,13,1,20,16,17,21,10,22,23,2,3,6,24,25,7,26,11,27,28])),"list-item":()=>e(()=>import(`./calcite-list-item-D-SEOpez.js`),__vite__mapDeps([29,4,5,9,13,1,30,31,28,20,2,16,17,3,6,14,32,33,10,25,34,22,35,36,37,7,11])),tooltip:()=>e(()=>import(`./calcite-tooltip-BCXDzpxj.js`),__vite__mapDeps([38,4,5,39,22,1,31,28,2,14]))})}destroy(){this.tooltipReferenceMap.clear()}render(){let e=this.viewModel.associationViewModels,{state:t,showAllEnabled:n}=this.viewModel,{state:r}=this.parentFeatureViewModel??{};return s(`div`,{class:this.classes(w.base,c.widget)},t===`loading`||t===`querying`||r===`loading`?this.renderLoading():n&&this.selectedLayer?s(`calcite-list`,{displayMode:T,filterEnabled:!0,filterLabel:this.messagesFeature.associationFilterPlaceholder,filterPlaceholder:this.messagesFeature.associationFilterPlaceholder,label:this.selectedLayer?.title??this.messagesCommon.untitled},this.renderFeatureCountWarning(),this._renderAssociatedFeatureListPage(),this.renderFeatureObserver()):s(`calcite-list`,{displayMode:T,label:this.selectedLayer?.title??this.messagesCommon.untitled},Array.from(e.keys(),t=>this._renderTypeList(t,e.get(t)))))}_showAllAssociations(e){let{flowItems:t,viewModel:n,description:r}=this;if(!t||!e)return;n.showAllEnabled=!0;let i=new S({selectedLayer:e,title:e?.title,flowItems:t,parentFeatureViewModel:this.parentFeatureViewModel,featureVisibleElements:this.featureVisibleElements,description:r,visibleElements:new m({title:!1,description:!1}),viewModel:n});t.push(i)}_renderAssociatedFeatureListPage(){let e=this.viewModel.associationViewModels.get(this.selectedLayer).slice(0,this.endIndex);return[...this._renderTooltips(e),...this._renderAssociatedFeatureList(e)]}_renderItemTooltip(e){let{tooltipReferenceMap:t}=this;return b(e.association)?s(`calcite-tooltip`,{key:`tooltip-${e.featureViewModel.uid}`,overlayPositioning:`fixed`,referenceElement:t.get(e.featureViewModel.uid)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){let{featureViewModel:t,title:n}=e,i=t.state===`loading`,a=this._findFlowItem(t),o=a<0&&this._isParentFeature(t),c=o||a>=0;return s(`calcite-list-item`,{class:i?w.listItemHidden:void 0,description:r(e.terminalName??``),key:`associated-feature-type-${t.uid}`,label:r(n),onCalciteListItemSelect:()=>this._handleFeatureClick(o,a,t)},b(e.association)?this.renderConnectivityIcon(e.association.associationType,e.featureViewModel.uid):null,x(e.association)?s(`calcite-chip`,{label:y(e.association),scale:`s`,slot:`content-end`},y(e.association)):null,this._renderChevronIconNode(c))}async _selectAssociation(t){let{flowItems:n,featureVisibleElements:r}=this;if(!n)return;t.abilities={utilityNetworkAssociationsContent:!0};let{default:i}=await e(async()=>{let{default:e}=await import(`./Feature-DNGDXoJM.js`);return{default:e}},__vite__mapDeps([40,41,4,5,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63]));n.push(new i({flowItems:n,flowType:`feature-association`,viewModel:t,visibleElements:r}))}_handleFeatureClick(e,t,n){if(e)this.flowItems.drain(e=>{`showAllEnabled`in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()});else if(t<0||!this.flowItems)this._selectAssociation(n);else for(;this.flowItems.length>t+1;){let e=this.flowItems.pop();e&&(`showAllEnabled`in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy())}}_featureViewModelMatch(e,t){let n=e.graphic,r=n?.layer,i=null;r?.type===`subtype-sublayer`&&r.parent?i=r.parent.globalIdField??null:r&&`globalIdField`in r&&(i=r.globalIdField);let a=i?n?.attributes[i]:null,o=t.graphic,s=o?.layer,c=null;s?.type===`subtype-sublayer`&&s.parent?c=s.parent.globalIdField??null:s&&`globalIdField`in s&&(c=s.globalIdField);let l=c?o?.attributes[c]:null;return a&&l&&a===l}_isParentFeature(e){let t=this.flowItems?.getItemAt(0);if(!t)return!1;let n=t.parentFeatureViewModel;return this._featureViewModelMatch(n,e)}_findFlowItem(e){return this.flowItems?.findIndex(t=>{if(t.flowType!==`feature-association`)return!1;let n=t.viewModel;return this._featureViewModelMatch(n,e)})??-1}_renderTooltips(e){return e.toArray().map(e=>this._renderItemTooltip(e))}_renderAssociatedFeatureList(e){return e.toArray().map(e=>this._renderAssociatedFeature(e))}_renderChevronIconNode(e){return s(`calcite-icon`,{flipRtl:!0,icon:e?`move-up`:`chevron-right`,scale:`s`,slot:`content-end`})}_renderTypeList(e,n){let{messagesFeature:r}=this,{displayCount:i}=this.viewModel,a=n.slice(0,i),o=a.length<n.length;return s(`calcite-list-item`,{expanded:!0,key:`show-all`,label:e.title,value:e.id},s(`calcite-chip`,{label:String(n.length),scale:`s`,slot:`content-end`},n.length),s(`calcite-list`,{group:e.id,label:e.title??``},[this._renderTooltips(a),this._renderAssociatedFeatureList(a)],o?s(`calcite-list-item`,{description:t(r?.numberRecords,{number:n.length.toString()}),key:`show-all-item`,label:r.showAll,onCalciteListItemSelect:()=>this._showAllAssociations(e)},s(`calcite-icon`,{icon:`list`,scale:`s`,slot:`content-end`})):null))}};f([n()],E.prototype,`description`,void 0),f([n()],E.prototype,`featureVisibleElements`,void 0),f([n()],E.prototype,`flowItems`,void 0),f([n()],E.prototype,`flowType`,void 0),f([n()],E.prototype,`listType`,void 0),f([n()],E.prototype,`parentFeatureViewModel`,void 0),f([n()],E.prototype,`title`,void 0),f([n({type:h})],E.prototype,`viewModel`,void 0),f([n({type:m,nonNullable:!0})],E.prototype,`visibleElements`,void 0),E=S=f([l(`esri.widgets.Feature.FeatureUtilityNetworkAssociationList`)],E);var D=E;export{D as default};