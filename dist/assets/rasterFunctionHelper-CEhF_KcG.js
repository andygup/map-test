import{$T as e,BT as t,Cw as n,Dv as r,FE as i,GT as a,HT as o,UT as s,VT as c,WT as l,bd as u,bi as d,iw as f,kD as p,kv as m,qT as h,xi as g}from"./index-BN8X5Ryz.js";import{F as _,I as v,P as y,R as b,T as ee,_ as te,a as ne,c as re,f as ie,h as ae,i as oe,j as se,k as ce,l as le,n as ue,o as de,p as fe,r as pe,s as me,u as he,v as ge}from"./RasterSymbolizer-C04g1f48.js";import{c as x,i as _e,l as S,n as ve,o as ye,r as be,t as C}from"./PixelBlock-D0vUlFM9.js";import{A as xe,E as Se,M as Ce,S as we,T as Te,b as Ee,d as De,g as Oe,j as ke,k as Ae,x as je}from"./vectorFieldUtils-BkGOIhR4.js";import{n as Me}from"./colorUtils-CzajW9E7.js";import{a as Ne,r as Pe}from"./rasterProjectionHelper-BpX32CQ6.js";import{n as Fe}from"./clipUtils-D_rTuWN2.js";var Ie=class extends f{constructor(){super(...arguments),this.raster=void 0}};p([t({json:{write:!0}})],Ie.prototype,`raster`,void 0),Ie=p([c(`esri.layers.raster.functions.BaseFunctionArguments`)],Ie);var w=Ie,Le,Re=Le=class extends w{constructor(){super(...arguments),this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new Le({raster:this.raster,raster2:this.raster2,operation:this.operation})}};p([t({json:{write:!0}})],Re.prototype,`operation`,void 0),p([t({json:{write:!0}})],Re.prototype,`raster2`,void 0),p([t({readOnly:!0})],Re.prototype,`rasters`,null),Re=Le=p([c(`esri.layers.raster.functions.ArithmeticFunctionArguments`)],Re);var ze=Re,Be=new Set([`slope`,`aspect`,`curvature`,`hillshade`,`shadedrelief`,`statistics`]),T=class extends f{constructor(){super(...arguments),this.functionArguments=null,this.readingBufferSize=0,this.id=-1,this.isNoopProcess=!1,this.rawInputBandIds=[],this.rawSourceRasterInfos=null,this.isInputBandIdsSwizzled=!1,this.swizzledBandSelection=[],this.isBranch=!1,this.isRoot=!1,this._bindingResult=null}get supportsGPU(){return this._bindingResult.supportsGPU}get flatWebGLFunctionChain(){let e=this.getWebGLProcessorDefinition();if(!e)return null;let t=[e],{parameters:n}=e,r=n.rasters||n.raster&&[n.raster];for(;r?.length;){t.unshift(...r);let e=[];for(let t=0;t<r.length;t++){let{parameters:n}=r[t],i=n.rasters||n.raster&&[n.raster];i?.length&&e.push(...i)}r=e}for(let e=t.length-1;e>=0;e--)t[e].isNoopProcess&&t.splice(e,1);let i=!1;for(let e=0;e<t.length;e++){let n=t[e];n.id=t.length-e-1;let{rasters:r}=n.parameters;i||=r!=null&&r.length>1}let a=t.some(({name:e})=>Be.has(e.toLowerCase())),{rawSourceRasterInfos:o}=this;return{functions:t,hasBranches:i,hasFocalFunction:a,isSourceSingleBand:o?.[0]?.bandCount===1}}bind(e,t=!1,n=-1){this.id=n+1;let r=this._getRasterValues(),i=!0;for(let n=0;n<r.length;n++){let a=r[n];if(a!=null&&this._isRasterFunctionValue(a)){let r=a.bind(e,t,this.id+n);if(!r.success)return this._bindingResult=r,r;i&&=r.supportsGPU}}return!this.rasterInfo||t?(this.sourceRasterInfos=this._getSourceRasterInfos(e),this._bindingResult=this._bindSourceRasters(),i&&=this._bindingResult.supportsGPU,this._bindingResult.success&&(this._patchRasterInfo(),i&&this.isRoot)&&(this.processInputBandIds(),this.swizzleInputBandIds(this.rawInputBandIds)||(i=this.rawInputBandIds.length<=3)),this._bindingResult.supportsGPU=i,this._bindingResult):(this._bindingResult={success:!0,supportsGPU:!0},this._bindingResult)}process(e){let t=this._getRasterValues(),n=t.length===0?e.pixelBlocks??e.primaryPixelBlocks:t.map(t=>this._readRasterValue(t,e));return this._processPixels({...e,pixelBlocks:n})}processInputBandIds(){let e=this._getRasterValues().filter(this._isRasterFunctionValue);if(e.length>1){let t=e.map(e=>e.processInputBandIds());return this.rawInputBandIds=[...new Set(t.flat())],this.rawInputBandIds}let t=e[0];if(t)return this.rawInputBandIds=t.processInputBandIds(),this.rawInputBandIds;let{bandCount:n}=this.sourceRasterInfos[0],r=Array.from({length:n},(e,t)=>t);return this.rawInputBandIds=this._getInputBandIds(r),this.rawInputBandIds}swizzleInputBandIds(e){let t=this._getRasterValues().filter(this._isRasterFunctionValue),n=!0;for(let r of t)n=r.swizzleInputBandIds(e)&&n;return!!n&&this._swizzleBandIds(e)}getPrimaryRasters(){let e=[],t=[];return this._getPrimaryRasters(this,e,t),{rasters:e,rasterIds:t}}getWebGLProcessorDefinition(){let e=this._getWebGLParameters(),{raster:t,rasters:n}=this.functionArguments;return n&&Array.isArray(n)&&n.length?(e.rasters=n.map(e=>this._isRasterFunctionValue(e)?e.getWebGLProcessorDefinition():typeof e==`number`?{name:`Constant`,parameters:{value:e},pixelType:`f32`,id:-1,isNoopProcess:!1}:{name:`Identity`,parameters:{value:e},pixelType:`f32`,id:-1,isNoopProcess:!1}),e.rasters.some(e=>e!=null)||(e.rasters=null)):this._isRasterFunctionValue(t)&&(e.raster=t.getWebGLProcessorDefinition()),{name:this.functionName,parameters:e,pixelType:this.outputPixelType,id:this.id,isNoopProcess:this.isNoopProcess}}getClippingGeometries(){let e=[];this.functionName===`Clip`&&e.push(this.functionArguments);let{raster:t,rasters:n}=this.functionArguments;if(n&&Array.isArray(n)&&n.length)n.forEach(t=>{if(this._isRasterFunctionValue(t)){let n=t.getClippingGeometries();e.push(...n)}});else if(this._isRasterFunctionValue(t)){let n=t.getClippingGeometries();e.push(...n)}return e}_getOutputPixelType(e){return this.outputPixelType===`unknown`?e:this.outputPixelType??e}_getWebGLParameters(){return{}}_getInputBandIds(e){return e}_swizzleBandIds(e){return!0}_isInputRasterPrimaryOrConstant(){return!this._getRasterValues().some(e=>e&&typeof e==`object`&&`rasterFunction`in e&&e.rasterFunction)}_removeStatsHistColormapVAT(e){e.statistics=null,e.histograms=null,e.colormap=null,e.attributeTable=null,e.multidimensionalInfo?.variables.forEach(e=>{e.statistics=void 0,e.histograms=void 0})}_getRasterValues(){let{rasterArgumentNames:e}=this;return e[0]===`rasters`?this.functionArguments.rasters??[]:e.flatMap(e=>this.functionArguments[e])}_getSourceRasterInfos(e){let t=this._getRasterValues(),{rasterInfos:n,rasterIds:r}=e;if(t.length===0)return n;let i=t.map(e=>e&&typeof e==`object`&&`bind`in e&&e.rasterInfo?e.rasterInfo:typeof e==`string`&&r.includes(e)?n[r.indexOf(e)]:typeof e==`number`?void 0:n[0]),a=i.find(e=>e)??n[0];return i.forEach((e,t)=>{e===void 0&&(i[t]=a)}),i}_getPrimaryRasterId(e){return e?.rasterId}_getPrimaryRasters(e,t=[],n=[]){for(let r=0;r<e.sourceRasters.length;r++){let i=e.sourceRasters[r];if(typeof i!=`number`)if(`bind`in i)this._getPrimaryRasters(i,t,n);else{let e=i,r=this._getPrimaryRasterId(e);if(r==null)continue;n.includes(r)||(this.mainPrimaryRasterId===r?(t.unshift(e),n.unshift(r)):(t.push(e),n.push(r)))}}}_isRasterFunctionValue(e){return typeof e==`object`&&!!e&&`getWebGLProcessorDefinition`in e}_readRasterValue(e,t){let{primaryPixelBlocks:n}=t;if(e==null||e===`$$`){let e=n[0];return e==null?null:e.clone()}if(typeof e==`string`){let r=t.primaryRasterIds.indexOf(e);return r===-1?null:n[r]}if(typeof e==`number`){let t=n[0];if(t==null)return null;let{width:r,height:i,pixelType:a}=t,o=new Float32Array(r*i);o.fill(e);let s=this.sourceRasterInfos[0].bandCount,c=Array(s).fill(o);return new C({width:r,height:i,pixelType:a,pixels:c})}return e.process(t)}_patchRasterInfo(){let{rasterInfo:e}=this;if(!e?.keyProperties)return;let{bandCount:t,keyProperties:n,statistics:r,histograms:i}=e,a=n.BandProperties;a&&a.length!==t&&(e.keyProperties={...n,BandProperties:void 0}),r&&r.length!==t&&(e.statistics=r.length>t?r.slice(0,t):null),i&&i.length!==t&&(e.histograms=i.length>t?i.slice(0,t):null),n.BAND_COUNT&&Number(n.BAND_COUNT)!==t&&(e.keyProperties={...n,BAND_COUNT:typeof n.BAND_COUNT==`string`?String(t):t})}};p([t({json:{write:!0}})],T.prototype,`functionName`,void 0),p([t({json:{write:!0}})],T.prototype,`functionArguments`,void 0),p([t()],T.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}}),o(e=>e?.toLowerCase())],T.prototype,`outputPixelType`,void 0),p([t({json:{write:!0}})],T.prototype,`mainPrimaryRasterId`,void 0),p([t()],T.prototype,`sourceRasters`,void 0),p([t({type:[ee],json:{write:!0}})],T.prototype,`sourceRasterInfos`,void 0),p([t({json:{write:!0}})],T.prototype,`rasterInfo`,void 0),p([t({json:{write:!0}})],T.prototype,`readingBufferSize`,void 0),p([t({json:{write:!0}})],T.prototype,`id`,void 0),p([t()],T.prototype,`isNoopProcess`,void 0),p([t()],T.prototype,`supportsGPU`,null),p([t({json:{write:!0}})],T.prototype,`rawInputBandIds`,void 0),p([t()],T.prototype,`rawSourceRasterInfos`,void 0),p([t({json:{write:!0}})],T.prototype,`isInputBandIdsSwizzled`,void 0),p([t({json:{write:!0}})],T.prototype,`swizzledBandSelection`,void 0),p([t()],T.prototype,`isBranch`,void 0),p([t()],T.prototype,`isRoot`,void 0),p([t({readOnly:!0})],T.prototype,`flatWebGLFunctionChain`,null),p([t()],T.prototype,`_bindingResult`,void 0),T=p([c(`esri.layers.raster.functions.BaseRasterFunction`)],T);var E=T,D={userDefined:-1,lineDetectionHorizontal:0,lineDetectionVertical:1,lineDetectionLeftDiagonal:2,lineDetectionRightDiagonal:3,gradientNorth:4,gradientWest:5,gradientEast:6,gradientSouth:7,gradientNorthEast:8,gradientNorthWest:9,smoothArithmeticMean:10,smoothing3x3:11,smoothing5x5:12,sharpening3x3:13,sharpening5x5:14,laplacian3x3:15,laplacian5x5:16,sobelHorizontal:17,sobelVertical:18,sharpen:19,sharpen2:20,pointSpread:21,none:255},Ve={plus:1,minus:2,times:3,sqrt:4,power:5,abs:10,divide:23,exp:25,exp10:26,exp2:27,int:30,float:32,ln:35,log10:36,log2:37,mod:44,negate:45,roundDown:48,roundUp:49,square:53,floatDivide:64,floorDivide:65},O={bitwiseAnd:11,bitwiseLeftShift:12,bitwiseNot:13,bitwiseOr:14,bitwiseRightShift:15,bitwiseXOr:16,booleanAnd:17,booleanNot:18,booleanOr:19,booleanXOr:20,equalTo:24,greaterThan:28,greaterThanEqual:29,lessThan:33,lessThanEqual:34,isNull:31,notEqual:46},k={acos:6,asin:7,atan:8,atanh:9,cos:21,cosh:22,sin:51,sinh:52,tan:56,tanh:57,acosh:59,asinh:60,atan2:61},He={majority:38,max:39,mean:40,med:41,min:42,minority:43,range:47,stddev:54,sum:55,variety:58,majorityIgnoreNoData:66,maxIgnoreNoData:67,meanIgnoreNoData:68,medIgnoreNoData:69,minIgnoreNoData:70,minorityIgnoreNoData:71,rangeIgnoreNoData:72,stddevIgnoreNoData:73,sumIgnoreNoData:74,varietyIgnoreNoData:75},Ue={setNull:50,conditional:78},We={...Ve,...O,...k,...He,...Ue},Ge=new Map([[k.acos,{domain:[0,Math.PI],isInteger:!1}],[k.asin,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[k.atan,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[k.cos,{domain:[-1,1],isInteger:!1}],[k.sin,{domain:[-1,1],isInteger:!1}],[O.booleanAnd,{domain:[0,1],isInteger:!0}],[O.booleanNot,{domain:[0,1],isInteger:!0}],[O.booleanOr,{domain:[0,1],isInteger:!0}],[O.booleanXOr,{domain:[0,1],isInteger:!0}],[O.equalTo,{domain:[0,1],isInteger:!0}],[O.notEqual,{domain:[0,1],isInteger:!0}],[O.greaterThan,{domain:[0,1],isInteger:!0}],[O.greaterThanEqual,{domain:[0,1],isInteger:!0}],[O.lessThan,{domain:[0,1],isInteger:!0}],[O.lessThanEqual,{domain:[0,1],isInteger:!0}],[O.isNull,{domain:[0,1],isInteger:!0}]]);function Ke(e){return Ge.get(e)}var qe=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3];function Je(e,t=!1){let n=e.map(e=>e.mask),r=n.filter(e=>e!=null),i=e[0].pixels[0].length;if(r.length===0||t&&r.length!==n.length)return new Uint8Array(i).fill(255);let a=r[0],o=new Uint8Array(a);if(r.length===1)return o;if(!t){for(let e=1;e<r.length;e++){let t=r[e];for(let e=0;e<o.length;e++)o[e]&&(o[e]=t[e]?255:0)}return o}for(let e=1;e<r.length;e++){let t=r[e];for(let e=0;e<o.length;e++)o[e]===0&&(o[e]=t[e]?255:0)}return o}function Ye(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]+i[e]);return o}function Xe(e,t,n){let[r]=e,i=r.length,a=C.createEmptyBand(`f32`,i);return a.set(r),a}function Ze(e,t,n){let[r]=e,i=r.length,a=C.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(a[e]=r[e]*r[e]);return a}function Qe(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]-i[e]);return o}function $e(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]*i[e]);return o}function et(e,t,n){let[r]=e,i=r.length,a=C.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(a[e]=Math.sign(r[e])*Math.floor(Math.abs(r[e])));return a}function tt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]/i[e]);return o}function nt(e,t,n){return tt(e,t,`f32`)}function rt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=Math.floor(r[e]/i[e]));return o}function it(e,t,n,r){let i=e[0],a=i.length,o=C.createEmptyBand(n,a);if(r===k.atanh){for(let e=0;e<a;e++)if(t[e]){let n=i[e];Math.abs(n)>=1?t[e]=0:o[e]=Math.atanh(n)}return o}let s=r===k.asin?Math.asin:Math.acos;for(let e=0;e<a;e++)if(t[e]){let n=i[e];Math.abs(n)>1?t[e]=0:o[e]=s(n)}return o}function at(e,t,n,r){let[i]=e,a=i.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r(i[e]));return o}function ot(e,t,n,r){let[i,a]=e,o=i.length,s=C.createEmptyBand(n,o);for(let e=0;e<o;e++)t&&!t[e]||(s[e]=r(i[e],a[e]));return s}function st(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]&i[e]);return o}function ct(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]<<i[e]);return o}function lt(e,t,n){let[r]=e,i=r.length,a=C.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(a[e]=~r[e]);return a}function ut(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]|i[e]);return o}function dt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]>>i[e]);return o}function ft(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]^i[e]);return o}function pt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]&&i[e]?1:0);return o}function mt(e,t,n){let[r]=e,i=r.length,a=C.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(a[e]=r[e]?0:1);return a}function ht(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]||i[e]?1:0);return o}function gt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=(r[e]?1:0)^(i[e]?1:0));return o}function _t(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]===i[e]?1:0);return o}function vt(e,t,n,r){let[i]=e,a=i.length,o=C.createEmptyBand(n,a),s=r===Math.E;for(let e=0;e<a;e++)t&&!t[e]||(o[e]=s?Math.exp(i[e]):r**i[e]);return o}function yt(e,t,n){return vt(e,t,n,10)}function bt(e,t,n){return vt(e,t,n,2)}function xt(e,t,n){return vt(e,t,n,Math.E)}function St(e,t,n,r){let[i]=e,a=i.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(i[e]<=0?t[e]=0:o[e]=r(i[e]));return o}function Ct(e,t,n){return St(e,t,n,Math.log10)}function wt(e,t,n){return St(e,t,n,Math.log2)}function Tt(e,t,n){return St(e,t,n,Math.log)}function Et(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]>i[e]?1:0);return o}function Dt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]>=i[e]?1:0);return o}function Ot(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]<i[e]?1:0);return o}function kt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]<=i[e]?1:0);return o}function At(e,t,n){let[r]=e,i=r.length,a=C.createEmptyBand(n,i);if(!t)return a;for(let e=0;e<i;e++)a[e]=t[e]?0:1;return a}function jt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]%i[e]);return o}function Mt(e,t,n){let[r]=e,i=r.length,a=C.createEmptyBand(n,i);for(let e=0;e<i;e++)t&&!t[e]||(a[e]=-r[e]);return a}function Nt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]===i[e]?0:1);return o}function Pt(e,t,n){let[r,i]=e,a=r.length,o=C.createEmptyBand(n,a),s=new Uint8Array(a);for(let e=0;e<a;e++)t!=null&&!t[e]||r[e]!==0||(o[e]=i[e],s[e]=255);return{band:o,mask:s}}function Ft(e,t,n){let[r,i,a]=e,o=r.length,s=C.createEmptyBand(n,o);for(let e=0;e<o;e++)t&&!t[e]||(s[e]=r[e]?i[e]:a[e]);return s}function It(e,t,n){let r=e.length;if(r<2)return e[0];let[i]=e,a=i.length,o=C.createEmptyBand(n,a);for(let n=0;n<a;n++)if(!t||t[n]){let t=i[n];for(let i=1;i<r;i++){let r=e[i][n];t<r&&(t=r)}o[n]=t}return o}function Lt(e,t,n){let r=e.length;if(r<2)return e[0];let[i]=e,a=i.length,o=C.createEmptyBand(n,a);for(let n=0;n<a;n++)if(!t||t[n]){let t=i[n];for(let i=1;i<r;i++){let r=e[i][n];t>r&&(t=r)}o[n]=t}return o}function Rt(e,t,n){let r=e.length;if(r<2)return e[0];let[i]=e,a=i.length,o=C.createEmptyBand(n,a);for(let n=0;n<a;n++)if(!t||t[n]){let t=i[n],a=t;for(let i=1;i<r;i++){let r=e[i][n];a<r?a=r:t>r&&(t=r)}o[n]=a-t}return o}function zt(e,t,n){let r=e.length;if(r<2)return e[0];let[i]=e,a=i.length,o=C.createEmptyBand(n,a);for(let n=0;n<a;n++)if(!t||t[n]){let t=0;for(let i=0;i<r;i++)t+=e[i][n];o[n]=t/r}return o}function Bt(e,t,n){let r=e.length;if(r<2)return e[0];let[i]=e,a=i.length,o=C.createEmptyBand(n,a);for(let n=0;n<a;n++)if(!t||t[n])for(let t=0;t<r;t++){let r=e[t];o[n]+=r[n]}return o}function Vt(e,t,n){let r=e.length;if(r<2)return e[0];let[i]=e,a=i.length,o=C.createEmptyBand(n,a);for(let n=0;n<a;n++)if(!t||t[n]){let t=new Float32Array(r),i=0;for(let a=0;a<r;a++){let r=e[a];i+=r[n],t[a]=r[n]}i/=r;let a=0;for(let e=0;e<r;e++)a+=(t[e]-i)**2;o[n]=Math.sqrt(a/r)}return o}function Ht(e,t,n){let r=e.length;if(r<2)return e[0];let i=Math.floor(r/2),[a]=e,o=a.length,s=C.createEmptyBand(n,o),c=new Float32Array(r),l=r%2==1;for(let n=0;n<o;n++)if(!t||t[n]){for(let t=0;t<r;t++)c[t]=e[t][n];c.sort(),s[n]=l?c[i]:(c[i]+c[i-1])/2}return s}function Ut(e,t,n){let[r,i]=e;if(i==null)return r;let a=r.length,o=C.createEmptyBand(n,a);for(let e=0;e<a;e++)t&&!t[e]||(o[e]=r[e]<i[e]?r[e]:i[e]);return o}function Wt(e,t,n){let r=e.length;if(r<=2)return Ut(e,t,n);let i=e[0].length,a=C.createEmptyBand(n,i),o=new Map;for(let n=0;n<i;n++)if(!t||t[n]){o.clear();for(let t=0;t<r;t++){let r=e[t][n];o.set(r,o.has(r)?o.get(r)+1:1)}let t=0,i=0,s=[];for(let e of o.keys())t=o.get(e),t>i?(i=t,s.length=0,s.push(e)):t===i&&s.push(e);s.length>1&&s.sort((e,t)=>e-t),a[n]=s[0]}return a}function Gt(e,t,n){let r=e.length;if(r<=2)return Ut(e,t,n);let i=e[0].length,a=C.createEmptyBand(n,i),o=new Map;for(let n=0;n<i;n++)if(!t||t[n]){o.clear();for(let t=0;t<r;t++){let r=e[t][n];o.set(r,o.has(r)?o.get(r)+1:1)}let t=0,i=e.length,s=[];for(let e of o.keys())t=o.get(e),t<i?(i=t,s.length=0,s.push(e)):t===i&&s.push(e);s.length>1&&s.sort((e,t)=>e-t),a[n]=s[0]}return a}function Kt(e,t,n){let r=e.length;if(r<2)return e[0];let[i]=e,a=i.length,o=C.createEmptyBand(n,a),s=new Set;for(let n=0;n<a;n++)if(!t||t[n]){let t;s.clear();for(let i=0;i<r;i++)t=e[i][n],s.add(t);o[n]=s.size}return o}var A=new Map,qt=new Map,j=new Map,M=new Map;function Jt(){A.size||(A.set(4,Math.sqrt),A.set(6,Math.acos),A.set(7,Math.asin),A.set(8,Math.atan),A.set(9,Math.atanh),A.set(10,Math.abs),A.set(21,Math.cos),A.set(22,Math.cosh),A.set(48,Math.floor),A.set(49,Math.ceil),A.set(51,Math.sin),A.set(52,Math.sinh),A.set(56,Math.tan),A.set(57,Math.tanh),A.set(59,Math.acosh),A.set(60,Math.asinh),A.set(65,Math.floor),qt.set(5,Math.pow),qt.set(61,Math.atan2),j.set(1,Ye),j.set(2,Qe),j.set(3,$e),j.set(11,st),j.set(12,ct),j.set(13,lt),j.set(14,ut),j.set(15,dt),j.set(16,ft),j.set(17,pt),j.set(18,mt),j.set(19,ht),j.set(20,gt),j.set(23,tt),j.set(24,_t),j.set(25,xt),j.set(26,yt),j.set(27,bt),j.set(28,Et),j.set(29,Dt),j.set(30,et),j.set(31,At),j.set(32,Xe),j.set(33,Ot),j.set(34,kt),j.set(35,Tt),j.set(36,Ct),j.set(37,wt),j.set(44,jt),j.set(45,Mt),j.set(46,Nt),j.set(53,Ze),j.set(64,nt),j.set(65,rt),j.set(76,Ft),j.set(78,Ft),M.set(38,Wt),M.set(39,It),M.set(40,zt),M.set(41,Ht),M.set(42,Lt),M.set(43,Gt),M.set(47,Rt),M.set(54,Vt),M.set(55,Bt),M.set(58,Kt),M.set(66,Wt),M.set(67,It),M.set(68,zt),M.set(69,Ht),M.set(70,Lt),M.set(71,Gt),M.set(72,Rt),M.set(73,Vt),M.set(74,Bt),M.set(75,Kt))}function Yt(e,t,n={}){Jt();let r=Je(e,t>=66&&t<=75),{outputPixelType:i=`f32`}=n,a=!M.has(t)||n.processAsMultiband,o=a?e[0].pixels.length:1,s=[];for(let n=0;n<o;n++){let o=M.has(t)&&!a?e.flatMap(e=>e.pixels):e.map(e=>e.pixels[n]),c,l=!0;if(t===Ue.setNull){let e=Pt(o,r,i);c=e.band,r=e.mask,l=!1}else j.has(t)?c=j.get(t)(o,r,`f64`):A.has(t)?c=t===k.asin||t===k.acos||t===k.atanh?it(o,r,`f64`,t):at(o,r,`f64`,A.get(t)):qt.has(t)?c=ot(o,r,`f64`,qt.get(t)):M.has(t)?c=M.get(t)(o,r,`f64`):(c=o[0],l=!1);if(l&&t!==O.isNull&&!Ge.has(t)){let e=C.createEmptyBand(i,c.length);r||=new Uint8Array(c.length).fill(255),_e(c,r),be(c,r,i,e),c=e}s.push(c)}let c=e[0];return new C({width:c.width,height:c.height,pixelType:i,mask:t===O.isNull?null:r,pixels:s})}function Xt(e,t,n){return Yt(e,t=[null,1,2,3,23,5,44][t]??1,{outputPixelType:n})}var Zt=class extends E{constructor(){super(...arguments),this.functionName=`Arithmetic`,this.functionArguments=null,this.rasterArgumentNames=[`raster`,`raster2`]}_bindSourceRasters(){let{operation:e}=this.functionArguments;if(e<1||e>6)return{success:!1,supportsGPU:!1,error:`unsupported operation`};let t=this.sourceRasterInfos[0].clone();return this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,{success:!0,supportsGPU:t.bandCount<=3}}_processPixels(e){let{pixelBlocks:t}=e;return t?.[0]==null||t?.[1]==null?null:Xt(t,this.functionArguments.operation,this.outputPixelType)}_getWebGLParameters(){let{operation:e}=this.functionArguments,t=[``,`plus`,`minus`,`times`,`divide`,`power`,`mod`][e],n=this.outputPixelType??`f32`,[r,i]=S(n),a=x(n);return a&&(r-=1e-4,i+=1e-4),{imageCount:2,operationName:t,domainRange:[r,i],isOutputRounded:a}}};p([t({json:{write:!0,name:`rasterFunction`}})],Zt.prototype,`functionName`,void 0),p([t({type:ze,json:{write:!0,name:`rasterFunctionArguments`}})],Zt.prototype,`functionArguments`,void 0),p([t()],Zt.prototype,`rasterArgumentNames`,void 0),Zt=p([c(`esri.layers.raster.functions.ArithmeticFunction`)],Zt);var Qt=Zt,$t,en=$t=class extends w{clone(){return new $t({raster:this.raster})}};en=$t=p([c(`esri.layers.raster.functions.AspectFunctionArguments`)],en);var tn=en,nn=class extends E{constructor(){super(...arguments),this.functionName=`Aspect`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isGCS=!1}_bindSourceRasters(){let e=this.sourceRasterInfos[0];this.isGCS=e.spatialReference?.isGeographic??!1,this.outputPixelType=this._getOutputPixelType(`f32`);let t=e.clone();return t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),t.statistics=[{min:-1,max:360,avg:180,stddev:30}],t.bandCount=1,this.rasterInfo=t,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return null;let{extent:n,primaryPixelSizes:r}=e,i=r?.[0],a=i??(n?{x:n.width/t.width,y:n.height/t.height}:{x:1,y:1});return le(t,{resolution:a})}};p([t({json:{write:!0,name:`rasterFunction`}})],nn.prototype,`functionName`,void 0),p([t({type:tn,json:{write:!0,name:`rasterFunctionArguments`}})],nn.prototype,`functionArguments`,void 0),p([t()],nn.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],nn.prototype,`isGCS`,void 0),nn=p([c(`esri.layers.raster.functions.AspectFunction`)],nn);var rn=nn,an=new Set([`+`,`-`,`*`,`/`,`(`,`)`]);function on(e,t){(e=e.replaceAll(` `,``)).startsWith(`-`)&&(e=`0`+e),e.startsWith(`+`)&&(e=e.slice(1));let n=e.split(``),r=[],i=[],a=``;for(let e=0;e<n.length;e++){let o=n[e];an.has(o)?(a.length&&i.push(sn(a,t)),r.push(o),a=``):a=a.concat(o)}return a.length&&i.push(sn(a,t)),{ops:r,nums:i}}function sn(e,t){return e.toLowerCase().startsWith(`b`)?t[parseInt(e.slice(1),10)-1]:parseFloat(e)}function cn(e,t,n,r){if(typeof n==`number`&&typeof r==`number`)return n+r;let i,a,o;typeof n==`number`?(o=r,i=o.length,a=new Float32Array(i),a.fill(n)):(i=n.length,a=n,r.constructor===Number?(o=new Float32Array(i),o.fill(r)):o=r);let s=new Float32Array(i);switch(t){case`+`:for(let t=0;t<i;t++)(e==null||e[t])&&(s[t]=a[t]+o[t]);break;case`-`:for(let t=0;t<i;t++)(e==null||e[t])&&(s[t]=a[t]-o[t]);break;case`*`:for(let t=0;t<i;t++)(e==null||e[t])&&(s[t]=a[t]*o[t]);break;case`/`:for(let t=0;t<i;t++)(e==null||e[t])&&o[t]&&(s[t]=a[t]/o[t]);break;case`(`:case`)`:throw Error(`encountered error with custom band index equation`)}return s}function ln(e,t){e.splice(t,1);let n=0,r=0;do{n=0,r=0;for(let t=0;t<e.length;t++)if(e[t]===`(`)n=t;else if(e[t]===`)`){r=t;break}r===n+1&&e.splice(n,2)}while(r===n+1);return e}function un(e){if(e.length===1)return{opIndex:0,numIndex:0};let t=0,n=0;for(let r=0;r<e.length;r++)if(e[r]===`(`)t=r;else if(e[r]===`)`){n=r;break}let r=n===0?e:e.slice(t+1,n),i=-1;for(let e=0;e<r.length;e++)if(r[e]===`*`||r[e]===`/`){i=e;break}if(i>-1)n>0&&(i+=t+1);else{for(let e=0;e<r.length;e++)if(r[e]===`+`||r[e]===`-`){i=e;break}n>0&&(i+=t+1)}let a=0;for(let t=0;t<i;t++)e[t]===`(`&&a++;return{opIndex:i,numIndex:i-a}}function dn(e,t,n){let r,{ops:i,nums:a}=on(n,t);if(i.length===0){let e=a.length===1?a[0]:t[0];if(e instanceof Float32Array)return[e];let n=new Float32Array(t[0].length);return typeof e==`number`?n.fill(e):n.set(e),[n]}for(;i.length>0;){let{numIndex:t,opIndex:n}=un(i);if(r=cn(e,i[n],a[t],a[t+1]),i.length===1)break;i=ln(i,n),a.splice(t,2,r)}return[r]}var fn=new h({0:`custom`,1:`ndvi`,2:`savi`,3:`tsavi`,4:`msavi`,5:`gemi`,6:`pvi`,7:`gvitm`,8:`sultan`,9:`vari`,10:`gndvi`,11:`sr`,12:`ndvi-re`,13:`sr-re`,14:`mtvi2`,15:`rtvi-core`,16:`ci-re`,17:`ci-g`,18:`ndwi`,19:`evi`,20:`iron-oxide`,21:`ferrous-minerals`,22:`clay-minerals`,23:`wndwi`,24:`bai`,25:`nbr`,26:`ndbi`,27:`ndmi`,28:`ndsi`,29:`mndwi`},{useNumericKeys:!0});function pn(e,t){if(!ke(e))return e;let{equation:n,method:r}=t,i=t.bandIndexes.map(e=>e-1),{pixels:a,mask:o}=e,s;switch(r){case`gndvi`:case`nbr`:case`ndbi`:case`ndvi`:case`ndvi-re`:case`ndsi`:case`ndmi`:case`mndwi`:s=hn(o,a[i[0]],a[i[1]]);break;case`ndwi`:s=hn(o,a[i[1]],a[i[0]]);break;case`sr`:case`sr-re`:case`iron-oxide`:case`ferrous-minerals`:case`clay-minerals`:s=gn(o,a[i[0]],a[i[1]]);break;case`ci-g`:case`ci-re`:s=_n(o,a[i[0]],a[i[1]]);break;case`savi`:s=vn(o,a[i[0]],a[i[1]],i[2]+1);break;case`tsavi`:s=yn(o,a[i[0]],a[i[1]],i[2]+1,i[3]+1,i[4]+1);break;case`msavi`:s=bn(o,a[i[0]],a[i[1]]);break;case`gemi`:s=xn(o,a[i[0]],a[i[1]]);break;case`pvi`:s=Sn(o,a[i[0]],a[i[1]],i[2]+1,i[3]+1);break;case`gvitm`:s=Cn(o,[a[i[0]],a[i[1]],a[i[2]],a[i[3]],a[i[4]],a[i[5]]]);break;case`sultan`:s=wn(o,[a[i[0]],a[i[1]],a[i[2]],a[i[3]],a[i[4]]]);break;case`vari`:s=Tn(o,[a[i[0]],a[i[1]],a[i[2]]]);break;case`mtvi2`:s=En(o,[a[i[0]],a[i[1]],a[i[2]]]);break;case`rtvi-core`:s=Dn(o,[a[i[0]],a[i[1]],a[i[2]]]);break;case`evi`:s=On(o,[a[i[0]],a[i[1]],a[i[2]]]);break;case`wndwi`:s=kn(o,[a[i[0]],a[i[1]],a[i[2]]],i[3]?i[3]+1:.5);break;case`bai`:s=An(o,a[i[0]],a[i[1]]);break;case`custom`:s=dn(o,a,n);break;default:return e}let{outputPixelType:c=`f32`}=t,l=c!=null&&x(c),u;o?(u=new Uint8Array(e.width*e.height),u.set(o)):l&&(u=new Uint8Array(e.width*e.height).fill(255)),l&&(s=s.map(e=>{let t=C.createEmptyBand(c,e.length);return be(e,u,c,t),t}));let d=new C({width:e.width,height:e.height,pixelType:c,pixels:s,mask:u});return d.updateStatistics(),d}function mn(e,t,n,r){let{mask:i,pixels:a,width:o,height:s}=e,c=a[n],l=a[t],u=l.length,d=r?new Uint8Array(u):new Float32Array(u),f=r?100:1,p=r?100.5:0;for(let e=0;e<u;e++)if(i==null||i[e]){let t=c[e],n=l[e],r=t+n;r&&(d[e]=(t-n)/r*f+p)}let m=new C({width:o,height:s,mask:i,pixelType:r?`u8`:`f32`,pixels:[d]});return m.updateStatistics(),m}function N(e){let t=new Float32Array(9);return t[3*e[0]]=1,t[3*e[1]+1]=1,t[3*e[2]+2]=1,t}function hn(e,t,n){let r=n.length,i=new Float32Array(r);for(let a=0;a<r;a++)if(e==null||e[a]){let e=t[a],r=n[a],o=e+r;o&&(i[a]=(e-r)/o)}return[i]}function gn(e,t,n){let r=n.length,i=new Float32Array(r);for(let a=0;a<r;a++)if(e==null||e[a]){let e=t[a],r=n[a];r&&(i[a]=e/r)}return[i]}function _n(e,t,n){let r=t.length,i=new Float32Array(r);for(let a=0;a<r;a++)if(e==null||e[a]){let e=t[a],r=n[a];r&&(i[a]=e/r-1)}return[i]}function vn(e,t,n,r){let i=n.length,a=new Float32Array(i);for(let o=0;o<i;o++)if(e==null||e[o]){let e=n[o],i=t[o],s=i+e+r;s&&(a[o]=(i-e)/s*(1+r))}return[a]}function yn(e,t,n,r,i,a){let o=n.length,s=new Float32Array(o),c=-i*r+a*(1+r*r);for(let a=0;a<o;a++)if(e==null||e[a]){let e=n[a],o=t[a],l=i*o+e+c;l&&(s[a]=r*(o-r*e-i)/l)}return[s]}function bn(e,t,n){let r=n.length,i=new Float32Array(r);for(let a=0;a<r;a++)if(e==null||e[a]){let e=n[a],r=t[a],o=2*r+1;i[a]=.5*(o-Math.sqrt(o*o-8*(r-e)))}return[i]}function xn(e,t,n){let r=n.length,i=new Float32Array(r);for(let a=0;a<r;a++)if(e==null||e[a]){let e=n[a],r=t[a];if(e!==1&&r+e+.5!==0){let t=(2*(r*r-e*e)+1.5*r+.5*e)/(r+e+.5);i[a]=t*(1-.25*t)-(e-.125)/(1-e)}}return[i]}function Sn(e,t,n,r,i){let a=n.length,o=new Float32Array(a),s=1/Math.sqrt(1+r*r);for(let c=0;c<a;c++)if(e==null||e[c]){let e=n[c];o[c]=(t[c]-r*e-i)*s}return[o]}function Cn(e,t){let[n,r,i,a,o,s]=t,c=n.length,l=new Float32Array(c);for(let t=0;t<c;t++)(e==null||e[t])&&(l[t]=-.2848*n[t]-.2435*r[t]-.5436*i[t]+.7243*a[t]+.084*o[t]-.18*s[t]);return[l]}function wn(e,t){let[n,r,i,a,o]=t,s=n.length,c=new Float32Array(s),l=new Float32Array(s),u=new Float32Array(s);for(let t=0;t<s;t++)(e==null||e[t])&&(c[t]=o[t]?a[t]/o[t]*100:0,l[t]=n[t]?a[t]/n[t]*100:0,u[t]=i[t]?r[t]/i[t]*(a[t]/i[t])*100:0);return[c,l,u]}function Tn(e,t){let[n,r,i]=t,a=n.length,o=new Float32Array(a);for(let t=0;t<a;t++)if(e==null||e[t])for(t=0;t<a;t++){let e=n[t],a=r[t],s=a+e-i[t];s&&(o[t]=(a-e)/s)}return[o]}function En(e,t){let[n,r,i]=t,a=n.length,o=new Float32Array(a);for(let t=0;t<a;t++)if(e==null||e[t])for(t=0;t<a;t++){let e=n[t],a=r[t],s=i[t],c=Math.sqrt((2*e+1)**2-(6*e-5*Math.sqrt(a))-.5);c&&(o[t]=1.5*(1.2*(e-s)-2.5*(a-s))/c)}return[o]}function Dn(e,t){let[n,r,i]=t,a=n.length,o=new Float32Array(a);for(let t=0;t<a;t++)if(e==null||e[t])for(t=0;t<a;t++){let e=n[t],a=r[t],s=i[t];o[t]=100*(e-a)-10*(e-s)}return[o]}function On(e,t){let[n,r,i]=t,a=n.length,o=new Float32Array(a);for(let t=0;t<a;t++)if(e==null||e[t])for(t=0;t<a;t++){let e=n[t],a=r[t],s=e+6*a-7.5*i[t]+1;s&&(o[t]=2.5*(e-a)/s)}return[o]}function kn(e,t,n=.5){let[r,i,a]=t,o=i.length,s=new Float32Array(o);for(let t=0;t<o;t++)if(e==null||e[t])for(t=0;t<o;t++){let e=r[t],o=i[t],c=a[t],l=e+n*o+(1-n)*c;l&&(s[t]=(e-n*o-(1-n)*c)/l)}return[s]}function An(e,t,n){let r=n.length,i=new Float32Array(r);for(let a=0;a<r;a++)if(e==null||e[a])for(a=0;a<r;a++){let e=(.1-t[a])**2+(.06-n[a])**2;e&&(i[a]=1/e)}return[i]}var jn,Mn=jn=class extends w{constructor(){super(...arguments),this.method=`custom`}clone(){return new jn({method:this.method,bandIndexes:this.bandIndexes,raster:i(this.raster)})}};p([t({json:{type:String,write:!0}})],Mn.prototype,`bandIndexes`,void 0),p([a(fn)],Mn.prototype,`method`,void 0),Mn=jn=p([c(`esri.layers.raster.functions.BandArithmeticFunctionArguments`)],Mn);var Nn=Mn,Pn=new Set([`vari`,`mtvi2`,`rtvi-core`,`evi`]),Fn=class extends E{constructor(){super(...arguments),this.functionName=`BandArithmetic`,this.functionArguments=null,this.rasterArgumentNames=[`raster`]}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType(`f32`);let e=this.sourceRasterInfos[0];if(e.bandCount<2)return{success:!1,supportsGPU:!1,error:`band-arithmetic-function: source raster has insufficient amount of raster bands`};let t=e.clone();return t.pixelType=this.outputPixelType,t.bandCount=this.functionArguments.method===`sultan`?3:1,this._removeStatsHistColormapVAT(t),t.keyProperties={...t.keyProperties,BandProperties:void 0},this.rasterInfo=t,{success:!0,supportsGPU:![`custom`,`gvitm`,`sultan`].includes(this.functionArguments.method)}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return t;let{method:n,bandIndexes:r}=this.functionArguments,i=r.split(` `).map(e=>parseFloat(e));if(this.rasterInfo.storageInfo.isBsqTile){let{rawInputBandIds:e}=this,t=Pn.has(this.functionArguments.method)?3:2,n=i.slice(0,t).map(t=>e.indexOf(t-1));i.splice(0,t,...n)}return pn(t,{method:n,bandIndexes:i,equation:r,outputPixelType:this.outputPixelType})}_getWebGLParameters(){let e=this.functionArguments.bandIndexes.split(` `).map(e=>parseFloat(e)-1);e.length===2&&e.push(0);let t=this.isInputBandIdsSwizzled?[0,1,2]:e,n,r,i=new Float32Array(3),{method:a}=this.functionArguments;switch(a){case`gndvi`:case`nbr`:case`ndbi`:case`ndvi`:case`ndvi-re`:case`ndsi`:case`ndmi`:case`mndwi`:n=N([t[0],t[1],0]),r=`ndxi`;break;case`ndwi`:n=N([t[1],t[0],0]),r=`ndxi`;break;case`sr`:case`sr-re`:case`iron-oxide`:case`ferrous-minerals`:case`clay-minerals`:n=N([t[0],t[1],0]),r=`sr`;break;case`ci-g`:case`ci-re`:n=N([t[0],t[1],0]),r=`ci`;break;case`savi`:n=N([t[0],t[1],0]),r=`savi`,i[0]=e[2]+1;break;case`tsavi`:n=N([t[0],t[1],0]),r=`tsavi`,i[0]=e[2]+1,i[1]=e[3]+1,i[2]=e[4]+1;break;case`msavi`:n=N([t[0],t[1],0]),r=`msavi`;break;case`gemi`:n=N([t[0],t[1],0]),r=`gemi`;break;case`pvi`:n=N([t[0],t[1],0]),r=`tsavi`,i[0]=e[2]+1,i[1]=e[3]+1;break;case`vari`:n=N([t[0],t[1],t[2]]),r=`vari`;break;case`mtvi2`:n=N([t[0],t[1],t[2]]),r=`mtvi`;break;case`rtvi-core`:n=N([t[0],t[1],t[2]]),r=`rtvicore`;break;case`evi`:n=N([t[0],t[1],t[2]]),r=`evi`;break;case`wndwi`:n=N([t[0],t[1],0]),r=`wndwi`,i[0]=e[3]?e[3]+1:.5;break;case`bai`:n=N([t[1],t[0],0]),r=`bai`;break;default:n=N([0,1,2]),r=`custom`}return{bandIndexMat3:n,indexType:r,adjustments:i,isOutputRounded:x(this.outputPixelType)}}_getInputBandIds(e){if(this.functionArguments.method===`custom`)return e;let t=this.functionArguments.bandIndexes.split(` `).map(e=>parseFloat(e)-1),n=e.length,r=t.map(e=>e>=n?n-1:e),i=Pn.has(this.functionArguments.method)?3:2,a=r.slice(0,i).map(t=>e[t]);return a.length===2&&a.push(0),a}_swizzleBandIds(e){let t=this.functionArguments.bandIndexes.split(` `).map(e=>parseFloat(e)-1);t.length===2&&t.push(0);let{method:n}=this.functionArguments,r=([`vari`,`mtvi2`,`rtvi-core`,`evi`].includes(n)?t.slice(0,3):n===`bai`||n===`ndwi`?[t[1],t[0]]:t.slice(0,2)).map(t=>e.indexOf(t));return r[2]??=r[1],this.isInputBandIdsSwizzled=!0,this.swizzledBandSelection=r,!1}};p([t({json:{write:!0,name:`rasterFunction`}})],Fn.prototype,`functionName`,void 0),p([t({type:Nn,json:{write:!0,name:`rasterFunctionArguments`}})],Fn.prototype,`functionArguments`,void 0),p([t()],Fn.prototype,`rasterArgumentNames`,void 0),Fn=p([c(`esri.layers.raster.functions.BandArithmeticFunction`)],Fn);var In=Fn,Ln,Rn=new h({1:`outside`,2:`inside`},{useNumericKeys:!0}),zn=Ln=class extends w{constructor(){super(...arguments),this.clippingType=`outside`}clone(){return new Ln({clippingGeometry:this.clippingGeometry.clone(),clippingType:this.clippingType})}};p([t({types:r,json:{read:m,write:!0}})],zn.prototype,`clippingGeometry`,void 0),p([t({json:{read:Rn.read,write:Rn.write}})],zn.prototype,`clippingType`,void 0),zn=Ln=p([c(`esri.layers.raster.functions.ClipFunctionArguments`)],zn);var Bn=zn,Vn=class extends E{constructor(){super(...arguments),this.functionName=`Clip`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isNoopProcess=!0}_bindSourceRasters(){let e=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(e.pixelType),e.pixelType=this.outputPixelType,this.rasterInfo=e;let{functionArguments:t}=this,{clippingGeometry:n,clippingType:r}=t;if(!n)return{success:!1,supportsGPU:!1,error:`missing clipping geometry`};if(r===`outside`)try{let{spatialReference:t}=e,r=n.type===`extent`?Pe(n,t):Ne(n,t).extent;r&&Fe(e,r)}catch{}return{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}_getWebGLParameters(){let{clippingGeometry:e,clippingType:t}=this.functionArguments;return{clippingGeometry:e.toJSON(),clippingType:t}}};p([t({json:{write:!0,name:`rasterFunction`}})],Vn.prototype,`functionName`,void 0),p([t({type:Bn,json:{write:!0,name:`rasterFunctionArguments`}})],Vn.prototype,`functionArguments`,void 0),p([t()],Vn.prototype,`rasterArgumentNames`,void 0),p([t()],Vn.prototype,`isNoopProcess`,void 0),Vn=p([c(`esri.layers.raster.functions.ClipFunction`)],Vn);var Hn=Vn,Un,P=Un=class extends w{castColormapName(e){if(!e)return null;let t=e.toLowerCase();return v.includes(t)?t:null}readColorRamp(e){return g(e)}readColorRampName(e,t){if(!e)return null;let n=_.jsonValues.find(t=>t.toLowerCase()===e.toLowerCase());return n?_.fromJSON(n):null}clone(){return new Un({colormap:i(this.colormap),colormapName:this.colormapName,colorRamp:this.colorRamp?.clone(),colorRampName:this.colorRampName})}};p([t({type:[[Number]],json:{write:!0}})],P.prototype,`colormap`,void 0),p([t({type:String,json:{write:!0}})],P.prototype,`colormapName`,void 0),p([o(`colormapName`)],P.prototype,`castColormapName`,null),p([t({types:d,json:{write:!0}})],P.prototype,`colorRamp`,void 0),p([l(`colorRamp`)],P.prototype,`readColorRamp`,null),p([t({type:_.apiValues,json:{type:_.jsonValues,write:_.write}})],P.prototype,`colorRampName`,void 0),p([l(`colorRampName`)],P.prototype,`readColorRampName`,null),P=Un=p([c(`esri.layers.raster.functions.ColormapFunctionArguments`)],P);var Wn=P,Gn=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[112,75,3],[113,76,3],[114,77,3],[115,77,3],[116,78,3],[117,79,3],[118,79,3],[119,80,3],[121,81,4],[122,82,4],[123,82,4],[124,83,4],[125,84,4],[126,84,4],[127,85,4],[128,86,4],[129,86,4],[130,87,4],[131,88,4],[132,89,4],[133,89,4],[134,90,4],[135,91,4],[136,91,4],[137,92,4],[138,93,4],[139,94,4],[140,94,4],[142,95,5],[143,96,5],[144,96,5],[145,97,5],[146,98,5],[147,99,5],[148,99,5],[149,100,5],[150,101,5],[151,101,5],[152,102,5],[153,103,5],[154,104,5],[155,104,5],[156,105,5],[157,106,5],[158,106,5],[159,107,5],[160,108,5],[161,108,5],[162,109,5],[164,110,6],[165,111,6],[166,111,6],[167,112,6],[168,113,6],[169,113,6],[170,114,6],[171,115,6],[172,116,6],[173,116,6],[174,117,6],[245,0,0],[245,5,0],[245,10,0],[246,15,0],[246,20,0],[246,25,0],[246,30,0],[247,35,0],[247,40,0],[247,45,0],[247,50,0],[247,55,0],[248,60,0],[248,65,0],[248,70,0],[248,75,0],[249,81,0],[249,86,0],[249,91,0],[249,96,0],[250,101,0],[250,106,0],[250,111,0],[250,116,0],[250,121,0],[251,126,0],[251,131,0],[251,136,0],[251,141,0],[252,146,0],[252,151,0],[252,156,0],[252,156,0],[251,159,0],[250,162,0],[249,165,0],[248,168,0],[247,171,0],[246,174,0],[245,177,0],[245,179,0],[244,182,0],[243,185,0],[242,188,0],[241,191,0],[240,194,0],[239,197,0],[238,200,0],[237,203,0],[236,206,0],[235,209,0],[234,212,0],[233,215,0],[232,218,0],[231,221,0],[230,224,0],[230,226,0],[229,229,0],[228,232,0],[227,235,0],[226,238,0],[225,241,0],[224,244,0],[223,247,0],[165,247,0],[163,244,0],[161,240,0],[158,237,0],[156,233,1],[154,230,1],[152,227,1],[149,223,1],[147,220,1],[145,216,1],[143,213,1],[140,210,2],[138,206,2],[136,203,2],[134,200,2],[132,196,2],[129,193,2],[127,189,2],[125,186,3],[123,183,3],[120,179,3],[118,176,3],[116,172,3],[114,169,3],[111,166,3],[109,162,4],[107,159,4],[105,155,4],[103,152,4],[100,149,4],[98,145,4],[96,142,4],[94,138,5],[91,135,5],[89,132,5],[87,128,5],[85,125,5],[82,121,5],[80,118,5],[78,115,6],[76,111,6],[73,108,6],[71,105,6],[69,101,6],[67,98,6],[65,94,6],[62,91,7],[60,88,7],[58,84,7],[56,81,7],[53,77,7],[51,74,7],[49,71,7],[47,67,8],[44,64,8],[42,60,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8],[40,57,8]],Kn=[[36,0,255],[36,0,255],[36,0,255],[36,0,255],[245,20,0],[245,24,0],[245,29,0],[245,31,0],[247,33,0],[247,33,0],[247,37,0],[247,41,0],[247,41,0],[247,41,0],[247,45,0],[247,45,0],[247,47,0],[247,49,0],[247,49,0],[247,54,0],[247,54,0],[247,56,0],[247,58,0],[247,58,0],[250,62,0],[250,62,0],[250,62,0],[250,67,0],[250,67,0],[250,67,0],[250,69,0],[250,71,0],[250,71,0],[250,75,0],[250,75,0],[250,78,0],[250,79,0],[250,79,0],[250,79,0],[250,81,0],[250,83,0],[250,83,0],[250,87,0],[250,87,0],[250,90,0],[250,92,0],[252,93,0],[252,93,0],[252,97,0],[252,97,0],[252,97,0],[252,97,0],[252,101,0],[252,101,0],[252,101,0],[252,101,0],[252,105,0],[252,105,0],[252,107,0],[252,109,0],[252,109,0],[252,113,13],[255,118,20],[255,119,23],[255,121,25],[255,126,33],[255,132,38],[255,133,40],[255,135,43],[255,141,48],[255,144,54],[255,150,59],[255,152,61],[255,153,64],[255,159,69],[255,163,77],[255,165,79],[255,168,82],[255,174,87],[255,176,92],[255,181,97],[255,183,99],[255,186,102],[255,191,107],[255,197,115],[255,201,120],[255,203,123],[255,205,125],[255,209,130],[255,214,138],[255,216,141],[255,218,143],[255,224,150],[255,228,156],[255,234,163],[255,236,165],[255,238,168],[255,243,173],[255,248,181],[255,252,186],[253,252,186],[250,252,187],[244,250,180],[238,247,176],[234,246,173],[231,245,169],[223,240,163],[217,237,157],[211,235,150],[205,233,146],[200,230,142],[195,227,136],[189,224,132],[184,222,126],[180,220,123],[174,217,119],[169,214,114],[163,212,108],[160,210,105],[154,207,101],[148,204,96],[143,201,93],[138,199,88],[134,197,84],[130,194,81],[126,191,77],[117,189,70],[115,186,68],[112,184,64],[106,181,60],[100,179,55],[94,176,49],[92,174,47],[90,173,45],[81,168,37],[75,166,33],[71,163,28],[66,160,24],[62,158,21],[56,156,14],[51,153,0],[51,153,0],[51,153,0],[50,150,0],[50,150,0],[50,150,0],[50,150,0],[49,148,0],[49,148,0],[49,148,0],[48,145,0],[48,145,0],[48,145,0],[48,145,0],[48,143,0],[48,143,0],[48,143,0],[48,143,0],[47,140,0],[47,140,0],[47,140,0],[47,140,0],[46,138,0],[46,138,0],[46,138,0],[46,138,0],[45,135,0],[45,135,0],[45,135,0],[45,135,0],[44,133,0],[44,133,0],[44,133,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[43,130,0],[42,128,0],[42,128,0],[42,128,0],[42,125,0],[42,125,0],[42,125,0],[42,125,0],[41,122,0],[41,122,0],[41,122,0],[41,122,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[40,120,0],[39,117,0],[39,117,0],[39,117,0],[39,117,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0],[38,115,0]];function qn(e,t){let n=[],r=[];for(let t=0;t<e.length-1;t++)n.push({type:`algorithmic`,algorithm:`esriHSVAlgorithm`,fromColor:e[t].slice(1),toColor:e[t+1].slice(1)}),r.push(e[t+1][0]-e[t][0]);let i=e[e.length-1][0];return b({type:`multipart`,colorRamps:n},{numColors:i,weights:t??=r})}function Jn(){return qn([[0,0,191,191],[51,0,0,255],[102,255,0,255],[153,255,0,127],[204,191,63,127],[256,20,20,20]])}function Yn(){let e=qn([[0,255,255,255],[70,0,255,0],[80,205,173,193],[100,150,150,150],[110,120,51,100],[130,120,100,200],[140,28,3,144],[160,6,0,55],[180,10,25,30],[201,6,7,27]]);for(let t=e.length;t<256;t++)e.push([6,27,7]);return e}function Xn(){return b({type:`algorithmic`,algorithm:`esriHSVAlgorithm`,fromColor:[0,0,0],toColor:[255,255,255]})}function Zn(){let e=[];for(let t=0;t<256;t++){let t=[];for(let e=0;e<3;e++)t.push(Math.round(255*Math.random()));e.push(t)}return e}function Qn(){return qn([[0,38,41,54],[69,79,82,90],[131,156,156,156],[256,253,253,241]],[.268,.238,.495])}function $n(e){let t;switch(e){case`elevation`:t=Jn();break;case`gray`:t=Xn();break;case`hillshade`:t=Qn();break;case`ndvi`:t=Gn;break;case`ndvi2`:t=Yn();break;case`ndvi3`:t=Kn;break;case`random`:t=Zn()}return t?(t=t.map((e,t)=>[t,...e]),t):null}var F=class extends E{constructor(){super(...arguments),this.functionName=`Colormap`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isNoopProcess=!0}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:`colormap-function: source data must be single band`};let{colormap:t,colormapName:n,colorRamp:r,colorRampName:i}=this.functionArguments;if(!t?.length)if(r)this.colorRamp=r,t=ce(r,{interpolateAlpha:!0});else if(i){let e=y(i);e&&(t=ce(e),this.colorRamp=g(e))}else n&&(t=$n(n));if(!t?.length)return{success:!1,supportsGPU:!1,error:`colormap-function: missing colormap argument`};let a=this._getOutputPixelType(e.pixelType);this.outputPixelType=a.startsWith(`f`)?`s32`:a;let o=e.clone();return o.pixelType=this.outputPixelType,o.colormap=t,o.bandCount=1,this.rasterInfo=o,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];return!t||x(t.pixelType)||(t=t.clone(),t.clamp(this.outputPixelType)),t}};p([t({json:{write:!0,name:`rasterFunction`}})],F.prototype,`functionName`,void 0),p([t({type:Wn,json:{write:!0,name:`rasterFunctionArguments`}})],F.prototype,`functionArguments`,void 0),p([t()],F.prototype,`rasterArgumentNames`,void 0),p([t()],F.prototype,`isNoopProcess`,void 0),p([t({json:{write:!0}})],F.prototype,`indexedColormap`,void 0),p([t()],F.prototype,`colorRamp`,void 0),F=p([c(`esri.layers.raster.functions.ColormapFunction`)],F);var er=F,tr,nr=tr=class extends w{clone(){return new tr({raster:this.raster})}};nr=tr=p([c(`esri.layers.raster.functions.ColormapToRGBFunctionArguments`)],nr);var rr=nr,ir=class extends E{constructor(){super(...arguments),this.functionName=`ColormapToRGB`,this.functionArguments=null,this.rasterArgumentNames=[`raster`]}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1||!e.colormap?.length)return{success:!1,supportsGPU:!1,error:`colormap-to-rgb-function: source data must be single band with a colormap`};let t=e.clone();t.pixelType=this.outputPixelType=this._getOutputPixelType(`u8`),this._removeStatsHistColormapVAT(t),t.bandCount=3,t.statistics=[{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20}],this.rasterInfo=t;let n=[...e.colormap].sort((e,t)=>e[0]-t[0]),{indexedColormap:r,offset:i}=je({colormap:n});return r?(this.lookup={indexedColormap:r,offset:i},{success:!0,supportsGPU:ge(r)}):{success:!1,supportsGPU:!1,error:`colormap-to-rgb-function: the colormap is not supported`}}_processPixels(e){let t=e.pixelBlocks?.[0];if(!t||!this.lookup)return t;t=t.clone();let n=t.pixels[0],r=t.mask??new Uint8Array(n.length).fill(255),i=new Uint8Array(n.length),a=new Uint8Array(n.length),o=new Uint8Array(n.length),{indexedColormap:s,offset:c}=this.lookup,l=s.length;for(let e=0;e<n.length;e++)if(r[e]){let t=4*(n[e]-c);t<0||t>l-4?r[e]=0:(i[e]=s[t++],a[e]=s[t++],o[e]=s[t++])}return t.pixels=[i,a,o],t.statistics=[new ve(0,255),new ve(0,255),new ve(0,255)],t.pixelType=this.outputPixelType,t}_getWebGLParameters(){return this.lookup}};p([t({json:{write:!0,name:`rasterFunction`}})],ir.prototype,`functionName`,void 0),p([t({type:rr,json:{write:!0,name:`rasterFunctionArguments`}})],ir.prototype,`functionArguments`,void 0),p([t()],ir.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],ir.prototype,`lookup`,void 0),ir=p([c(`esri.layers.raster.functions.ColormapToRGBFunction`)],ir);var ar=ir,or,sr=or=class extends w{constructor(){super(...arguments),this.rasters=[]}writeRasters(e,t){t.rasters=e.map(e=>typeof e==`number`||typeof e==`string`?e:e.toJSON())}clone(){return new or({rasters:i(this.rasters)})}};p([t({json:{write:!0}})],sr.prototype,`rasters`,void 0),p([s(`rasters`)],sr.prototype,`writeRasters`,null),sr=or=p([c(`esri.layers.raster.functions.CompositeBandFunctionArguments`)],sr);var cr=sr,lr=class extends E{constructor(){super(...arguments),this.functionName=`CompositeBand`,this.functionArguments=null,this.rasterArgumentNames=[`rasters`]}_bindSourceRasters(){let{sourceRasterInfos:e}=this,t=e[0];this.outputPixelType=this._getOutputPixelType(t.pixelType);let n=t.clone();if(n.attributeTable=null,n.colormap=null,n.pixelType=this.outputPixelType,n.bandCount=e.map(({bandCount:e})=>e).reduce((e,t)=>e+t),e.every(({statistics:e})=>e!=null&&e.length)){let t=[];e.forEach(({statistics:e})=>e!=null&&t.push(...e)),n.statistics=t}if(e.every(({histograms:e})=>e!=null&&e.length)){let t=[];e.forEach(({histograms:e})=>e!=null&&t.push(...e)),n.histograms=t}n.multidimensionalInfo&&n.multidimensionalInfo.variables.forEach(t=>{let n=e.map(e=>e.multidimensionalInfo?.variables.find(({name:e})=>e===t.name)),r=n.map(e=>e?.statistics?.length?e.statistics:null),i=n.map(e=>e?.histograms?.length?e.histograms:null);t.statistics=r.every(e=>e!=null)?r.flat():null,t.histograms=i.every(e=>e!=null)?i.flat():null}),n.bandCount>1&&(n.colormap=null,n.attributeTable=null);let r=e.every(e=>e.keyProperties.BandProperties?.length)?e.flatMap(e=>e.keyProperties.BandProperties):void 0;return n.keyProperties={...n.keyProperties,BandProperties:r},this.rasterInfo=n,{success:!0,supportsGPU:n.bandCount<=3}}_processPixels(e){let{pixelBlocks:t}=e;return t?t?.[0]==null?null:Ce(t):null}_getWebGLParameters(){return{bandCount:this.rasterInfo.bandCount}}};p([t({json:{write:!0,name:`rasterFunction`}})],lr.prototype,`functionName`,void 0),p([t({type:cr,json:{write:!0,name:`rasterFunctionArguments`}})],lr.prototype,`functionArguments`,void 0),p([t()],lr.prototype,`rasterArgumentNames`,void 0),lr=p([c(`esri.layers.raster.functions.CompositeBandFunction`)],lr);var ur=lr,dr=new h({0:`difference`,1:`relative-difference`,2:`categorical`,3:`euclidean-distance`,4:`angle-difference`,5:`band-with-most-change`},{useNumericKeys:!0}),fr=new h({0:`all`,1:`changed`,2:`unchanged`},{useNumericKeys:!0});function pr(e,t,n,r){let[i,a]=e,o=x(n)&&!x(i.pixelType)&&!x(a.pixelType),s=[i.mask,a.mask].filter(e=>e),c=C.combineBandMasks(s),l=e.map(e=>e.pixels[0]),{width:u,height:d}=i,f=C.createEmptyBand(n,u*d);switch(t){case`difference`:case`relative-difference`:mr({bands:l,mask:c,outBand:f,isRoundingNeeded:o,isRelative:t===`relative-difference`});break;case`categorical`:hr({bands:l,mask:c,outBand:f,...r});break;case`euclidean-distance`:gr({pixels:e.map(e=>e.pixels),mask:c,outBand:f});break;case`angle-difference`:_r({pixels:e.map(e=>e.pixels),mask:c,outBand:f});break;case`band-with-most-change`:vr({pixels:e.map(e=>e.pixels),mask:c,outBand:f})}let p=new C({width:u,height:d,pixels:[f],pixelType:n,mask:c});return p.updateStatistics(),p}function mr(e){let{bands:[t,n],mask:r,isRelative:i,isRoundingNeeded:a,outBand:o}=e,s=t.length;for(let e=0;e<s;e++)if(!r||r[e]){let r=t[e]-n[e];if(i){let i=Math.max(Math.abs(t[e])-Math.abs(n[e]));r=i>0?r/i:0}o[e]=a?Math.round(r):r}}function hr(e){let{bands:[t,n],categoryIndexLookups:[r,i],classNames:[a,o],mask:s,keepMethod:c,outBand:l}=e,u=t.length,d=a.length,f=o.length,p=d*f,m=p+1,h=p+2;for(let e=0;e<u;e++)if(!s||s[e]){let s=t[e],u=n[e],d=r[s],g=i[u],_=a[d],v=o[g];l[e]=d==null||g==null?p:c===`changed`&&_===v?m:c===`unchanged`&&_!==v?h:d*f+g}}function gr(e){let{pixels:[t,n],mask:r,outBand:i}=e,a=t[0].length,o=t.length;for(let e=0;e<a;e++)if(!r||r[e]){let r=0;for(let i=0;i<o;i++){let a=t[i][e]-n[i][e];r+=a*a}i[e]=Math.sqrt(r)}}function _r(e){let{pixels:[t,n],mask:r,outBand:i}=e,a=t[0].length,o=t.length;for(let e=0;e<a;e++)if(!r||r[e]){let r=0,a=0,s=0;for(let i=0;i<o;i++){let o=t[i][e],c=n[i][e];r+=o*c,a+=o*o,s+=c*c}let c=Math.sqrt(a*s);i[e]=c?Math.acos(r/c):1.5707963267948966}}function vr(e){let{pixels:[t,n],mask:r,outBand:i}=e,a=t[0].length,o=t.length;for(let e=0;e<a;e++)if(!r||r[e]){let r=0,a=0;for(let i=0;i<o;i++){let o=Math.abs(t[i][e]-n[i][e]);o>r&&(r=o,a=i)}i[e]=a}}var yr,I=yr=class extends w{constructor(){super(...arguments),this.method=`difference`,this.keepMethod=`all`,this.raster2=void 0}get rasters(){return[this.raster,this.raster2]}clone(){return new yr({raster:this.raster,raster2:this.raster2,method:this.method,keepMethod:this.keepMethod})}};p([a(dr)],I.prototype,`method`,void 0),p([a(fr)],I.prototype,`keepMethod`,void 0),p([t({json:{write:!0}})],I.prototype,`raster2`,void 0),p([t({readOnly:!0})],I.prototype,`rasters`,null),I=yr=p([c(`esri.layers.raster.functions.ComputeChangeFunctionArguments`)],I);var br=I,L=class extends E{constructor(){super(...arguments),this.functionName=`ComputeChange`,this.functionArguments=null,this.rasterArgumentNames=[`raster`,`raster2`]}_bindSourceRasters(){let{method:e}=this.functionArguments,t=this.sourceRasterInfos[0].clone();if(this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(t),e===`categorical`){let e=this.sourceRasterInfos.map(e=>e.attributeTable),n=this._getFieldNames(e,`value`),r=e.map(e=>this._getClassFieldName(e));if(n[0]==null||n[1]==null||r[0]==null||r[1]==null)return{success:!1,supportsGPU:!1,error:`both inputs must have proper attribute table with value and class fields`};this._updateAttributeTable(t,n,r)}return t.bandCount=1,this.rasterInfo=t,{success:!0,supportsGPU:e===`difference`||e===`relative-difference`}}_processPixels(e){let{pixelBlocks:t}=e;if(t?.[0]==null||t?.[1]==null)return null;let{method:n}=this.functionArguments;return pr(t,n,this.outputPixelType,this._categoryConfig)}_getWebGLParameters(){let e=this.outputPixelType??`f32`,[t,n]=S(e),r=x(e);return r&&(t-=1e-4,n+=1e-4),{method:this.functionArguments.method,domainRange:[t,n],isOutputRounded:r}}_updateAttributeTable(e,t,n){let r=this.sourceRasterInfos.map(e=>e.attributeTable),i=r.map((e,n)=>e.features.map(e=>e.attributes[t[n]])),a=r.map((e,t)=>e.features.map(e=>e.attributes[n[t]])),o=i.map(e=>{let t=[];return e.forEach((e,n)=>t[e]=n),t}),{keepMethod:s}=this.functionArguments;this._categoryConfig={categoryIndexLookups:o,classNames:a,keepMethod:s};let c=r[0].clone();c.fields=[new u({name:`OID`,type:`oid`}),new u({name:`Value`,type:`integer`}),new u({name:`ClassName`,type:`string`}),new u({name:`Class_From`,type:`string`}),new u({name:`Class_To`,type:`string`})];let l=this._getFieldNames(r,`red`),d=this._getFieldNames(r,`green`),f=this._getFieldNames(r,`blue`),p=[],m=l.length===2&&d.length===2&&f.length===2;m&&(p.push(...r.map((e,t)=>e.features.map(e=>[e.attributes[l[t]],e.attributes[d[t]],e.attributes[f[t]]]))),c.fields.push(new u({name:`Red`,type:`integer`}),new u({name:`Green`,type:`integer`}),new u({name:`Blue`,type:`integer`})));let h=c.features[0].clone();h.geometry=null;let g=[],[_,v]=i.map(e=>e.length),y=1;for(let e=0;e<_;e++){let t=a[0][e];for(let n=0;n<v;n++){let r=a[1][n];if(s===`changed`&&t===r||s===`unchanged`&&t!==r)continue;let i=h.clone();i.attributes={OID:y++,Value:e*v+n,ClassName:t===r?t:`${t} -> ${r}`,Class_From:t,Class_To:r},m&&(i.attributes.Red=p[0][e][0]+p[1][n][0]>>1,i.attributes.Green=p[0][e][1]+p[1][n][1]>>1,i.attributes.Blue=p[0][e][2]+p[1][n][2]>>1),g.push(i)}}if(s===`changed`){let e=h.clone();e.attributes={OID:y++,Value:_*v+1,ClassName:`No Change`,Class_From:`Same`,Class_To:`Same`},g.push(e)}else if(s===`unchanged`){let e=h.clone();e.attributes={OID:y++,Value:_*v+2,ClassName:`Changed`,Class_From:`Any`,Class_To:`Any`},g.push(e)}c.features=g,e.attributeTable=c}_getFieldNames(e,t){return e.map(({fields:e})=>e.find(e=>e.name.toLowerCase()===t)?.name).filter(e=>e)}_getClassFieldName(e){return(e.fields.find(e=>e.type===`string`&&e.name.toLowerCase().startsWith(`class`))??e.fields.find(e=>e.type===`string`&&e.name.toLowerCase().includes(`class`)||e.name.toLowerCase().includes(`type`)||e.name.toLowerCase().includes(`name`))??e.fields.find(e=>e.type===`string`))?.name}};p([t({json:{write:!0,name:`rasterFunction`}})],L.prototype,`functionName`,void 0),p([t({type:br,json:{write:!0,name:`rasterFunctionArguments`}})],L.prototype,`functionArguments`,void 0),p([t()],L.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],L.prototype,`_categoryConfig`,void 0),L=p([c(`esri.layers.raster.functions.ComputeChangeFunction`)],L);var xr=L,Sr,Cr=Sr=class extends w{constructor(){super(...arguments),this.contrastOffset=0,this.brightnessOffset=0}clone(){return new Sr({contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset,raster:this.raster})}};p([t({json:{write:!0}})],Cr.prototype,`contrastOffset`,void 0),p([t({json:{write:!0}})],Cr.prototype,`brightnessOffset`,void 0),Cr=Sr=p([c(`esri.layers.raster.functions.ContrastBrightnessFunctionArguments`)],Cr);var wr=Cr,R=class extends E{constructor(){super(...arguments),this.functionName=`ContrastBrightness`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.lookup=null}_bindSourceRasters(){let{sourceRasterInfos:e}=this,t=e[0];if(t.pixelType!==`u8`)return{success:!1,supportsGPU:!1,error:`Only unsigned 8 bit raster is supported by ContrastBrightness function.`};this.outputPixelType=this._getOutputPixelType(`u8`);let n=t.clone();this._removeStatsHistColormapVAT(n),this.rasterInfo=n;let{contrastOffset:r,brightnessOffset:i}=this.functionArguments;return this.lookup=fe(r,i),{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];return t==null?null:Se(t,{lut:t.pixels.map(()=>this.lookup),offset:0,outputPixelType:`u8`})}_getWebGLParameters(){let{contrastOffset:e,brightnessOffset:t}=this.functionArguments;return{contrastOffset:e,brightnessOffset:t}}};p([t({json:{write:!0,name:`rasterFunction`}})],R.prototype,`functionName`,void 0),p([t({type:wr,json:{write:!0,name:`rasterFunctionArguments`}})],R.prototype,`functionArguments`,void 0),p([t()],R.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],R.prototype,`lookup`,void 0),R=p([c(`esri.layers.raster.functions.ContrastBrightnessFunction`)],R);var Tr=R;function Er(e,t,n,r,i){let a=Math.floor(r/2);for(let r=0;r<a;r++)for(let a=0;a<t;a++)e[r*t+a]=e[(i-1-r)*t+a],e[(n-1-r)*t+a]=e[(n-i+r)*t+a];let o=Math.floor(i/2);for(let r=0;r<n;r++){let n=r*t;for(let r=0;r<o;r++)e[n+r]=e[n+i-1-r],e[n+t-r-1]=e[n+t+r-i]}}var z=new Map;function Dr(e){let t=Math.sqrt(e.length),n=e.slice(0,t),r=[1];for(let n=1;n<t;n++){let i=null;for(let r=0;r<t;r++){let a=e[r+n*t],o=e[r];if(i==null)if(o===0){if(a)return{separable:!1,row:null,col:null}}else i=a/o;else if(a/o!==i)return{separable:!1,row:null,col:null}}if(i==null)return{separable:!1,row:null,col:null};r.push(i)}return{separable:!0,row:n,col:r}}function Or(e,t,n,r,i,a,o){let s=new Float32Array(t*n),c=a.length,l=o?0:r,u=o?r:0,d=o?1:t;for(let o=l;o<n-l;o++){let n=o*t;for(let o=u;o<t-u;o++){if(i&&!i[n+o])continue;let t=0;for(let i=0;i<c;i++)t+=e[n+o+(i-r)*d]*a[i];s[n+o]=t}}return s}function kr(e,t,n,r,i,a,o){let s=new Float32Array(t*n),c=Math.floor(r/2),l=Math.floor(i/2);for(let u=c;u<n-c;u++){let n=u*t;for(let u=l;u<t-l;u++){if(a&&!a[n+u])continue;let d=0;for(let a=0;a<r;a++)for(let r=0;r<i;r++)d+=e[n+u+(a-c)*t+r-l]*o[a*i+r];s[n+u]=d}}return s}function Ar(e,t,n=!0){let{pixels:r,width:i,height:a,pixelType:o,mask:s}=e,c=r.length,l=[],{kernel:u,rows:d,cols:f}=t;for(let e=0;e<c;e++){let t=kr(r[e],i,a,d,f,s,u);n&&Er(t,i,a,d,f),l.push(t)}return new C({width:i,height:a,pixelType:o,pixels:l,mask:s})}function jr(e,t,n,r=!0){let{pixels:i,width:a,height:o,pixelType:s,mask:c}=e,l=i.length,u=[],d=t.length,f=n.length,p=Math.floor(d/2),m=Math.floor(f/2);for(let e=0;e<l;e++){let s=Or(i[e],a,o,p,c,t,!0);s=Or(s,a,o,m,c,n,!1),r&&Er(s,a,o,d,f),u.push(s)}return new C({width:a,height:o,pixelType:s,pixels:u,mask:c})}function Mr(e,t){let n=Dr(t.kernel),r=!1!==t.mirrorEdges,i=n.separable?jr(e,n.row,n.col,r):Ar(e,t,r),{outputPixelType:a}=t;return a&&i.clamp(a),i}z.set(D.none,[0,0,0,0,1,0,0,0,0]),z.set(D.lineDetectionHorizontal,[-1,-1,-1,2,2,2,-1,-1,-1]),z.set(D.lineDetectionVertical,[-1,2,-1,-1,2,-1,-1,2,-1]),z.set(D.lineDetectionLeftDiagonal,[2,-1,-1,-1,2,-1,-1,-1,2]),z.set(D.lineDetectionRightDiagonal,[-1,-1,2,-1,2,-1,2,-1,-1]),z.set(D.gradientNorth,[-1,-2,-1,0,0,0,1,2,1]),z.set(D.gradientWest,[-1,0,1,-2,0,2,-1,0,1]),z.set(D.gradientEast,[1,0,-1,2,0,-2,1,0,-1]),z.set(D.gradientSouth,[1,2,1,0,0,0,-1,-2,-1]),z.set(D.gradientNorthEast,[0,-1,-2,1,0,-1,2,1,0]),z.set(D.gradientNorthWest,[-2,-1,0,-1,0,1,0,1,2]),z.set(D.smoothArithmeticMean,[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111]),z.set(D.smoothing3x3,[.0625,.125,.0625,.125,.25,.125,.0625,.125,.0625]),z.set(D.smoothing5x5,[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1]),z.set(D.sharpening3x3,[-1,-1,-1,-1,9,-1,-1,-1,-1]),z.set(D.sharpening5x5,[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1]),z.set(D.laplacian3x3,[0,-1,0,-1,4,-1,0,-1,0]),z.set(D.laplacian5x5,[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0]),z.set(D.sobelHorizontal,[-1,-2,-1,0,0,0,1,2,1]),z.set(D.sobelVertical,[-1,0,1,-2,0,2,-1,0,1]),z.set(D.sharpen,[0,-.25,0,-.25,2,-.25,0,-.25,0]),z.set(D.sharpen2,[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25]),z.set(D.pointSpread,[-.627,.352,-.627,.352,2.923,.352,-.627,.352,-.627]);var Nr,B=Nr=class extends w{constructor(){super(...arguments),this.rows=3,this.cols=3,this.kernel=[0,0,0,0,1,0,0,0,0]}set convolutionType(e){this._set(`convolutionType`,e);let t=z.get(e);if(!t||e===D.userDefined||e===D.none)return;let n=Math.sqrt(t.length);this._set(`kernel`,t),this._set(`cols`,n),this._set(`rows`,n)}clone(){return new Nr({cols:this.cols,rows:this.rows,kernel:[...this.kernel],convolutionType:this.convolutionType,raster:i(this.raster)})}};p([t({json:{type:Number,write:!0}})],B.prototype,`rows`,void 0),p([t({json:{type:Number,write:!0}})],B.prototype,`cols`,void 0),p([t({json:{name:`type`,type:Number,write:!0}})],B.prototype,`convolutionType`,null),p([t({json:{type:[Number],write:!0}})],B.prototype,`kernel`,void 0),B=Nr=p([c(`esri.layers.raster.functions.ConvolutionFunctionArguments`)],B);var Pr=B,Fr=25,V=class extends E{constructor(){super(...arguments),this.functionName=`Convolution`,this.rasterArgumentNames=[`raster`]}get _normalizedKernel(){let{kernel:e,convolutionType:t}=this.functionArguments,n=e.reduce((e,t)=>e+t);return t===-1||n===0||n===1?e:e.map(e=>e/n)}_bindSourceRasters(){let{convolutionType:e,rows:t,cols:n,kernel:r}=this.functionArguments;if(!Object.values(D).includes(e))return{success:!1,supportsGPU:!1,error:`convolution-function: the specified kernel type is not supported ${e}`};if(e!==D.none&&t*n!==r.length)return{success:!1,supportsGPU:!1,error:`convolution-function: the specified rows and cols do not match the length of the kernel`};let i=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(i.pixelType);let a=i.clone();a.pixelType=this.outputPixelType;let o=[D.none,D.sharpen,D.sharpen2,D.sharpening3x3,D.sharpening5x5];return(e===-1||this.outputPixelType!==`u8`&&!o.includes(e))&&(a.statistics=null,a.histograms=null),a.colormap=null,a.attributeTable=null,this.rasterInfo=a,{success:!0,supportsGPU:r.length<=Fr}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null||this.functionArguments.convolutionType===D.none)return t;let{rows:n,cols:r}=this.functionArguments,{_normalizedKernel:i}=this;return Mr(t,{kernel:i,rows:n,cols:r,outputPixelType:this.outputPixelType})}_getWebGLParameters(){let e=new Float32Array(Fr),{rows:t,cols:n}=this.functionArguments,{_normalizedKernel:r}=this;for(let i=0;i<t;i++)for(let t=0;t<n;t++)e[5*i+t]=r[i*n+t];return{kernelRows:t,kernelCols:n,kernel:e,clampRange:S(this.outputPixelType)}}};p([t({json:{write:!0,name:`rasterFunction`}})],V.prototype,`functionName`,void 0),p([t({type:Pr,json:{write:!0,name:`rasterFunctionArguments`}})],V.prototype,`functionArguments`,void 0),p([t()],V.prototype,`rasterArgumentNames`,void 0),p([t()],V.prototype,`_normalizedKernel`,null),V=p([c(`esri.layers.raster.functions.ConvolutionFunction`)],V);var Ir=V,Lr,Rr=new h({0:`standard`,1:`planform`,2:`profile`},{useNumericKeys:!0}),zr=Lr=class extends w{constructor(){super(...arguments),this.curvatureType=`standard`,this.zFactor=1}readCurvatureType(e,t){return Rr.fromJSON(t.type??t.curvatureType??0)}clone(){return new Lr({curvatureType:this.curvatureType,zFactor:this.zFactor,raster:this.raster})}};p([t({json:{write:{target:`type`}}}),a(Rr)],zr.prototype,`curvatureType`,void 0),p([l(`curvatureType`,[`type`,`curvatureType`])],zr.prototype,`readCurvatureType`,null),p([t({type:Number,json:{write:!0}})],zr.prototype,`zFactor`,void 0),zr=Lr=p([c(`esri.layers.raster.functions.CurvatureFunctionArguments`)],zr);var Br=zr,H=class extends E{constructor(){super(...arguments),this.functionName=`Curvature`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType(`f32`);let e=this.sourceRasterInfos[0].clone();return e.pixelType=this.outputPixelType,e.bandCount=1,this._removeStatsHistColormapVAT(e),this.rasterInfo=e,this.isGCS=e.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return null;let{zFactor:n,curvatureType:r}=this.functionArguments,{extent:i,primaryPixelSizes:a}=e,o=a?.[0],s=o??(i?{x:i.width/t.width,y:i.height/t.height}:{x:1,y:1}),c=this.isGCS&&n>=1?n*de:n;return oe(t,{zFactor:c,curvatureType:r,resolution:s})}_getWebGLParameters(){let{zFactor:e,curvatureType:t}=this.functionArguments;return{curvatureType:t,zFactor:this.isGCS&&e>=1?e*de:e}}};p([t({json:{write:!0,name:`rasterFunction`}})],H.prototype,`functionName`,void 0),p([t({type:Br,json:{write:!0,name:`rasterFunctionArguments`}})],H.prototype,`functionArguments`,void 0),p([t()],H.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],H.prototype,`isGCS`,void 0),H=p([c(`esri.layers.raster.functions.CurvatureFunction`)],H);var Vr=H,Hr,U=Hr=class extends w{constructor(){super(...arguments),this.bandIds=[],this.bandNames=[],this.bandWavelengths=[],this.missingBandAction=0}clone(){return new Hr({bandIds:this.bandIds?.slice(),bandNames:this.bandNames?.slice(),bandWavelengths:this.bandWavelengths?.slice(),missingBandAction:this.missingBandAction,method:this.method,wavelengthMatchTolerance:this.wavelengthMatchTolerance})}};p([t({json:{write:!0}})],U.prototype,`bandIds`,void 0),p([t({json:{write:!0}})],U.prototype,`bandNames`,void 0),p([t({json:{write:!0}})],U.prototype,`bandWavelengths`,void 0),p([a({0:`name`,1:`wavelength`,2:`id`})],U.prototype,`method`,void 0),p([t({json:{write:!0}})],U.prototype,`missingBandAction`,void 0),p([t({json:{write:!0}})],U.prototype,`wavelengthMatchTolerance`,void 0),U=Hr=p([c(`esri.layers.raster.functions.ExtractBandFunctionArguments`)],U);var Ur=U,Wr=class extends E{constructor(){super(...arguments),this.functionName=`ExtractBand`,this.functionArguments=null,this.rasterArgumentNames=[`raster`]}_bindSourceRasters(){let{functionArguments:e,sourceRasterInfos:t}=this,n=t[0],{method:r,bandNames:i,bandWavelengths:a,bandIds:o,missingBandAction:s}=e,c=i?.length&&(r===`name`||r!==`id`&&!o?.length),l=a?.length&&(r===`wavelength`||r!==`id`&&!o?.length),u=s===1,d=c?Kr(n,i):l?Jr(n,a,this.functionArguments,u):qr(n,o,u);if(d==null)return{success:!1,supportsGPU:!1,error:`extract-band-function: Invalid ${c?`band names`:l?`band wavelengths`:`band ids`} for the imagery data source`};this.functionArguments.bandIds=d,this.functionArguments.method=`id`,this.outputPixelType=this._getOutputPixelType(`f32`);let f=n.clone();f.pixelType=this.outputPixelType,f.bandCount=d.length;let{statistics:p,histograms:m}=f;p!=null&&p.length&&(f.statistics=d.map(e=>p[e]||p[p.length-1])),m!=null&&m.length&&(f.histograms=d.map(e=>m[e]||m[m.length-1])),f.multidimensionalInfo&&f.multidimensionalInfo.variables.forEach(e=>{let{statistics:t,histograms:n}=e;t!=null&&t.length&&(e.statistics=d.map(e=>t[e]||t[t.length-1])),n!=null&&n.length&&(e.histograms=d.map(e=>n[e]||n[n.length-1]))});let h=f.keyProperties?.BandProperties;return h?.length&&(h=d.map(e=>e>=h.length?h[h.length-1]:h[e]),f.keyProperties={...f.keyProperties,BandProperties:h}),this.rasterInfo=f,{success:!0,supportsGPU:f.bandCount<=3}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return null;let{bandIds:n}=this.functionArguments;if(this.rasterInfo.storageInfo.isBsqTile){let{rawInputBandIds:e}=this;n=n.map(t=>e.indexOf(t))}else{let e=t.pixels.length;n=n.map(t=>t>=e?e-1:t)}return t.extractBands(n)}_getWebGLParameters(){let e;if(this.isInputBandIdsSwizzled)e=this.swizzledBandSelection.length?this.swizzledBandSelection:[0,1,2];else{e=[...this.functionArguments.bandIds],e.length===0?e=[0,1,2]:e.length<3&&(e[1]=e[1]??e[0],e[2]=e[2]??e[1]);for(let t=0;t<3;t++)e[t]=Math.min(e[t],2)}return{bandIndexMat3:N(e)}}_getInputBandIds(e){let t=e.length;return this.functionArguments.bandIds.map(e=>e>=t?t-1:e).map(t=>e[t])}_swizzleBandIds(e){let t=this.functionArguments.bandIds.map(t=>e.indexOf(t));return this.isInputBandIdsSwizzled=!0,t[1]??=t[0],t[2]??=t[1],this.swizzledBandSelection=t,!1}};p([t({json:{write:!0,name:`rasterFunction`}})],Wr.prototype,`functionName`,void 0),p([t({type:Ur,json:{write:!0,name:`rasterFunctionArguments`}})],Wr.prototype,`functionArguments`,void 0),p([t()],Wr.prototype,`rasterArgumentNames`,void 0),Wr=p([c(`esri.layers.raster.functions.ExtractBandFunction`)],Wr);var Gr=Wr;function Kr(e,t){let n=e.bandInfos.map(({name:e})=>e.toLowerCase()),r=[];for(let e=0;e<t.length;e++){let i=t[e].toLowerCase(),a=n.indexOf(i);if(a===-1&&i===`nearinfrared`&&(a=n.findIndex(e=>e.startsWith(`nearinfrared_1`)),a===-1&&(a=n.findIndex(e=>e.startsWith(`nearinfrared`)))),a===-1)return null;r.push(a)}return r}function qr(e,t,n){let{bandCount:r}=e;return!t?.length||n&&t.some(e=>e<0||e>=r)?null:t}function Jr(e,t,{wavelengthMatchTolerance:n},r){let{bandInfos:i}=e,a=[];for(let e=0;e<i.length;e++){let{minWavelength:t,maxWavelength:n}=i[e];if(!t||!n)return null;a.push({minWavelength:t,maxWavelength:n})}let o=[];for(let e=0;e<t.length;e++){let i=t[e],s=!1,c=-1,l=Number.MAX_VALUE;for(let e=0;e<a.length;e++){let t=a[e],n=i>=t.minWavelength&&i<=t.maxWavelength,r=Math.abs(i-(t.minWavelength+t.maxWavelength)/2);n?r<l&&(s=!0,c=e,l=r):!s&&r<l&&(c=e,l=r)}if(!s&&n&&l<n&&(s=!0),!s&&r)return null;o.push(c)}return o}function Yr(e,t,n){let{pixels:r,width:i,height:a,mask:o,bandMasks:s}=e,c=i*a,l=s?.length?C.combineBandMasks(s):o,u=Math.min(t.length,r.length),d=n.startsWith(`f`),f=!d&&n!==e.pixelType,[p,m]=S(n),h=C.createEmptyBand(n,c);for(let e=0;e<a;e++){let n=e*i;for(let e=0;e<i;e++,n++)if(!l||l[n]){let e=0;for(let i=0;i<u;i++)e+=t[i]*r[i][n];d||(e=Math.round(e),f&&(e=e>m?m:e<p?p:e)),h[n]=e}}let g=new C({width:i,height:a,pixels:[h],pixelType:n,mask:l});return g.updateStatistics(),g}var Xr,Zr=Xr=class extends w{clone(){return new Xr({conversionParameters:[...this.conversionParameters],raster:this.raster})}};p([t({type:[Number],json:{write:!0}})],Zr.prototype,`conversionParameters`,void 0),Zr=Xr=p([c(`esri.layers.raster.functions.GrayscaleFunctionArguments`)],Zr);var Qr=Zr,$r=class extends E{constructor(){super(...arguments),this.functionName=`Grayscale`,this.functionArguments=null,this.rasterArgumentNames=[`raster`]}get _normalizedWeights(){let{conversionParameters:e}=this.functionArguments,t=e.reduce((e,t)=>e+t);return e.map(e=>e/t)}_bindSourceRasters(){let{conversionParameters:e}=this.functionArguments;if(!e?.length)return{success:!1,supportsGPU:!1,error:`missing valid conversion parameters.`};let t=this.sourceRasterInfos[0].clone();this.outputPixelType=this._getOutputPixelType(t.pixelType),t.pixelType=this.outputPixelType;let n=e.length===3||t.bandCount===3&&e.length>3;return t.bandCount=1,this._removeStatsHistColormapVAT(t),this.rasterInfo=t,{success:!0,supportsGPU:n}}_processPixels(e){let t=e.pixelBlocks?.[0];return t==null?null:Yr(t,this._normalizedWeights,this.outputPixelType)}_getWebGLParameters(){return{weights:this._normalizedWeights}}};p([t({json:{write:!0,name:`rasterFunction`}})],$r.prototype,`functionName`,void 0),p([t({type:Qr,json:{write:!0,name:`rasterFunctionArguments`}})],$r.prototype,`functionArguments`,void 0),p([t()],$r.prototype,`rasterArgumentNames`,void 0),p([t()],$r.prototype,`_normalizedWeights`,null),$r=p([c(`esri.layers.raster.functions.GrayscaleFunction`)],$r);var ei=$r,ti,ni=new h({0:`traditional`,1:`multi-directional`},{useNumericKeys:!0}),ri=new h({1:`degree`,2:`percent-rise`,3:`scaled`},{useNumericKeys:!0}),W=ti=class extends w{constructor(){super(...arguments),this.altitude=45,this.azimuth=315,this.hillshadeType=`traditional`,this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.slopeType=`degree`,this.zFactor=1,this.removeEdgeEffect=!1}clone(){return new ti({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,slopeType:this.slopeType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};p([t({type:Number,json:{write:!0}})],W.prototype,`altitude`,void 0),p([t({type:Number,json:{write:!0}})],W.prototype,`azimuth`,void 0),p([t(),a(ni)],W.prototype,`hillshadeType`,void 0),p([t({type:Number,json:{write:!0,name:`psPower`}})],W.prototype,`pixelSizePower`,void 0),p([t({type:Number,json:{write:!0,name:`psZFactor`}})],W.prototype,`pixelSizeFactor`,void 0),p([t(),a(ri)],W.prototype,`slopeType`,void 0),p([t({type:Number,json:{write:!0}})],W.prototype,`zFactor`,void 0),p([t({type:Boolean,json:{write:!0}})],W.prototype,`removeEdgeEffect`,void 0),W=ti=p([c(`esri.layers.raster.functions.HillshadeFunctionArguments`)],W);var ii=W,ai=class extends E{constructor(){super(...arguments),this.functionName=`Hillshade`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isGCS=!1}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:`hillshade-function: source data must be single band`};this.outputPixelType=this._getOutputPixelType(`u8`);let t=e.clone();return this._removeStatsHistColormapVAT(t),t.pixelType=this.outputPixelType,t.bandCount=1,t.statistics=[{min:0,max:255,avg:60,stddev:10}],this.rasterInfo=t,this.isGCS=t.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(!t)return null;let{extent:n,primaryPixelSizes:r}=e,i=r?.[0],a=i??(n?{x:n.width/t.width,y:n.height/t.height}:{x:1,y:1}),o=pe(this.functionArguments,a,this.isGCS),s=re(t,o);return s.pixelType=this.outputPixelType,s}_getWebGLParameters(){let e=pe(this.functionArguments,{x:1,y:1},this.isGCS),t=me(e),{slopeType:n,zFactor:r,pixelSizeFactor:i,pixelSizePower:a}=this.functionArguments,o=n===`scaled`,s=x(this.outputPixelType);return{...t,zFactor:r,gcsFactor:this.isGCS?de:1,pixelSizeFactor:o?i:0,pixelSizePower:o?a:0,isOutputRounded:s}}};p([t({json:{write:!0,name:`rasterFunction`}})],ai.prototype,`functionName`,void 0),p([t({type:ii,json:{write:!0,name:`rasterFunctionArguments`}})],ai.prototype,`functionArguments`,void 0),p([t()],ai.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],ai.prototype,`isGCS`,void 0),ai=p([c(`esri.layers.raster.functions.HillshadeFunction`)],ai);var oi=ai,si,ci=si=class extends w{constructor(){super(...arguments),this.rasters=[],this.processAsMultiband=!0}writeRasters(e,t){t.rasters=e.map(e=>typeof e==`number`||typeof e==`string`?e:e.toJSON())}clone(){return new si({operation:this.operation,processAsMultiband:this.processAsMultiband,rasters:i(this.rasters)})}};p([t({json:{write:!0}})],ci.prototype,`operation`,void 0),p([t({json:{write:!0}})],ci.prototype,`rasters`,void 0),p([s(`rasters`)],ci.prototype,`writeRasters`,null),p([t({json:{write:!0}})],ci.prototype,`processAsMultiband`,void 0),ci=si=p([c(`esri.layers.raster.functions.LocalFunctionArguments`)],ci);var li=ci,ui=class extends E{constructor(){super(...arguments),this.functionName=`Local`,this.functionArguments=null,this.rasterArgumentNames=[`rasters`]}_bindSourceRasters(){let{sourceRasterInfos:e}=this,t=e[0],{bandCount:n}=t,{processAsMultiband:r}=this.functionArguments;if(e.some(e=>e.bandCount!==n))return{success:!1,supportsGPU:!1,error:`local-function: input rasters do not have same band count`};let{operation:i,rasters:a}=this.functionArguments,o=qe[i];if(!(o===999||a.length===o||a.length<=1&&o===1))return{success:!1,supportsGPU:!1,error:`local-function: the length of functionArguments.rasters does not match operation's requirement: ${o}`};let s=t.clone();return s.bandCount=o!==999||r?n:1,this._removeStatsHistColormapVAT(s),this._updateStatistics(s),this._updatePixelType(s),this.rasterInfo=s,{success:!0,supportsGPU:s.bandCount===1&&o<=3}}_processPixels(e){let{pixelBlocks:t}=e;return t==null||t.some(e=>e==null)?null:Yt(t,this.functionArguments.operation,{processAsMultiband:this.functionArguments.processAsMultiband,outputPixelType:this.outputPixelType??void 0})}_getWebGLParameters(){let{operation:e}=this.functionArguments,t=qe[e],n=Object.keys(We).find(t=>We[t]===e)?.toLowerCase()??`undefined`,r=this.outputPixelType??`f32`,[i,a]=S(r),o=x(r);return o&&(i-=1e-4,a+=1e-4),{imageCount:t,operationName:n,domainRange:[i,a],isOutputRounded:o}}_updateStatistics(e){let t=this.sourceRasterInfos[0],{operation:n}=this.functionArguments,r=Ke(n)?.domain;if(r){e.statistics=[];for(let t=0;t<e.bandCount;t++)e.statistics[t]={min:r[0],max:r[1],avg:(r[0]+r[1])/2,stddev:(r[0]+r[1])/10}}else n===45&&t.statistics?.length&&(e.statistics=t.statistics.map(e=>({min:-e.max,max:-e.min,avg:e.avg==null?void 0:-e.avg,stddev:e.stddev==null?void 0:-e.stddev})))}_updatePixelType(e){let{statistics:t,pixelType:n}=this.sourceRasterInfos[0],{operation:r}=this.functionArguments,{domain:i,isInteger:a}=Ke(r)??{domain:null,isInteger:!1},o=`f32`;if(i&&a)o=ye(i[0],i[1]);else if(r===30){let e=t?.[0];o=e?ye(e.min,e.max):x(n)?n:`s32`}else if(r===45&&x(n)){let e=t?.map(({max:e})=>-e),r=t?.map(({min:e})=>-e),i=e?.length?Math.min(...e):null,a=r?.length?Math.min(...r):null;o=i!=null&&a!=null?ye(i,a):n.startsWith(`s`)?n.replace(`s`,`u`):n===`u1`||n===`u2`||n===`u4`?`s8`:n===`u8`?`s16`:`s32`}e.pixelType=this.outputPixelType=this._getOutputPixelType(o)}};p([t({json:{write:!0,name:`rasterFunction`}})],ui.prototype,`functionName`,void 0),p([t({type:li,json:{write:!0,name:`rasterFunctionArguments`}})],ui.prototype,`functionArguments`,void 0),p([t()],ui.prototype,`rasterArgumentNames`,void 0),ui=p([c(`esri.layers.raster.functions.LocalFunction`)],ui);var di=ui,fi,pi=fi=class extends w{constructor(){super(...arguments),this.includedRanges=null,this.noDataValues=null,this.noDataInterpretation=0}get normalizedNoDataValues(){let{noDataValues:e}=this;if(!e?.length)return null;let t=!1,n=e.map(e=>{if(typeof e==`number`)return t=!0,[e];if(typeof e==`string`){let n=e.trim().split(` `).filter(e=>e.trim()!==``).map(e=>Number(e));return t||=n.length>0,n.length===0?null:n}return null});return t?n:null}clone(){return new fi({includedRanges:this.includedRanges?.slice()??[],noDataValues:this.noDataValues?.slice()??[],noDataInterpretation:this.noDataInterpretation})}};p([t({json:{write:!0}})],pi.prototype,`includedRanges`,void 0),p([t({json:{write:!0}})],pi.prototype,`noDataValues`,void 0),p([t()],pi.prototype,`normalizedNoDataValues`,null),p([t({json:{write:!0}})],pi.prototype,`noDataInterpretation`,void 0),pi=fi=p([c(`esri.layers.raster.functions.MaskFunctionArguments`)],pi);var mi=pi,hi=class extends E{constructor(){super(...arguments),this.functionName=`Mask`,this.functionArguments=null,this.rasterArgumentNames=[`raster`]}_bindSourceRasters(){let e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;this.outputPixelType=this._getOutputPixelType(t),e.pixelType=this.outputPixelType,this.rasterInfo=e;let{includedRanges:n,normalizedNoDataValues:r}=this.functionArguments;if(!n?.length&&!r?.length)return{success:!1,supportsGPU:!1,error:`missing includedRanges or noDataValues argument`};let i=[];for(let a=0;a<e.bandCount;a++){let e=Ee(t,n?.slice(2*a,2*a+2),r?.[a]);if(e==null){i=null;break}i.push(e)}this.lookups=i;let a=r!=null&&r.every(e=>e?.length===r[0]?.length);return{success:!0,supportsGPU:(!n||n.length<=18)&&(!r||a&&r[0].length<=9)}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return null;let{outputPixelType:n,lookups:r}=this,{includedRanges:i,noDataInterpretation:a,normalizedNoDataValues:o}=this.functionArguments;return Oe(t,{includedRanges:i,noDataValues:o,outputPixelType:n,matchAll:a===1,lookups:r})}_getWebGLParameters(){let{includedRanges:e,normalizedNoDataValues:t}=this.functionArguments,r=new Float32Array(9);r.fill(n),t?.[0]?.length&&r.set(t[0]);let i=new Float32Array(6);for(let t=0;t<i.length;t+=2)i[t]=e?.[t]??-n,i[t+1]=e?.[t+1]??n;return e?.length&&i.set(e),{bandCount:this.sourceRasterInfos[0].bandCount,noDataValues:r,includedRanges:i}}};p([t({json:{write:!0,name:`rasterFunction`}})],hi.prototype,`functionName`,void 0),p([t({type:mi,json:{write:!0,name:`rasterFunctionArguments`}})],hi.prototype,`functionArguments`,void 0),p([t()],hi.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],hi.prototype,`lookups`,void 0),hi=p([c(`esri.layers.raster.functions.MaskFunction`)],hi);var gi=hi,_i,vi=_i=class extends w{constructor(){super(...arguments),this.visibleBandID=0,this.infraredBandID=1,this.scientificOutput=!1}clone(){let{visibleBandID:e,infraredBandID:t,scientificOutput:n}=this;return new _i({visibleBandID:e,infraredBandID:t,scientificOutput:n})}};p([t({json:{write:!0}})],vi.prototype,`visibleBandID`,void 0),p([t({json:{write:!0}})],vi.prototype,`infraredBandID`,void 0),p([t({json:{write:!0}})],vi.prototype,`scientificOutput`,void 0),vi=_i=p([c(`esri.layers.raster.functions.NDVIFunctionArguments`)],vi);var yi=vi,bi=class extends E{constructor(){super(...arguments),this.functionName=`NDVI`,this.functionArguments=null,this.rasterArgumentNames=[`raster`]}_bindSourceRasters(){let{scientificOutput:e,visibleBandID:t,infraredBandID:n}=this.functionArguments;this.outputPixelType=this._getOutputPixelType(e?`f32`:`u8`);let r=this.sourceRasterInfos[0],i=Math.max(t,n);if(r.bandCount<2||i>=r.bandCount)return{success:!1,supportsGPU:!1,error:`ndvi-function: source raster has insufficient amount of raster bands`};if(t<0||n<0)return{success:!1,supportsGPU:!1,error:`ndvi-function: invalid visible or infrared band id`};let a=r.clone();a.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(a),a.bandCount=1,a.keyProperties={...a.keyProperties,BandProperties:void 0};let[o,s,c,l]=e?[-1,1,0,.1]:[0,200,100,10];return a.statistics=[{min:o,max:s,avg:c,stddev:l}],this.rasterInfo=a,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return null;let{visibleBandID:n,infraredBandID:r,scientificOutput:i}=this.functionArguments;if(this.rasterInfo.storageInfo.isBsqTile){let{rawInputBandIds:e}=this;r=e.indexOf(r),n=e.indexOf(n)}return mn(t,n,r,!i)}_getWebGLParameters(){let{visibleBandID:e,infraredBandID:t,scientificOutput:n}=this.functionArguments,r=this.isInputBandIdsSwizzled?[0,1,2]:[t,e,0];return{bandIndexMat3:N(r),scaled:!n}}_getInputBandIds(e){let{visibleBandID:t,infraredBandID:n}=this.functionArguments;return[n,t,0].map(t=>e[t])}_swizzleBandIds(e){let{visibleBandID:t,infraredBandID:n}=this.functionArguments,r=[t,n].map(t=>e.indexOf(t));return r[2]=r[1],this.isInputBandIdsSwizzled=!0,this.swizzledBandSelection=r,!1}};p([t({json:{write:!0,name:`rasterFunction`}})],bi.prototype,`functionName`,void 0),p([t({type:yi,json:{write:!0,name:`rasterFunctionArguments`}})],bi.prototype,`functionArguments`,void 0),p([t()],bi.prototype,`rasterArgumentNames`,void 0),bi=p([c(`esri.layers.raster.functions.NDVIFunction`)],bi);var xi=bi,Si,G=Si=class extends w{constructor(){super(...arguments),this.inputRanges=null,this.outputValues=null,this.noDataRanges=null,this.allowUnmatched=!1,this.isLastInputRangeInclusive=!1}clone(){return new Si({inputRanges:[...this.inputRanges],outputValues:[...this.outputValues],noDataRanges:[...this.noDataRanges],allowUnmatched:this.allowUnmatched,isLastInputRangeInclusive:this.isLastInputRangeInclusive})}};p([t({json:{write:!0}})],G.prototype,`inputRanges`,void 0),p([t({json:{write:!0}})],G.prototype,`outputValues`,void 0),p([t({json:{write:!0}})],G.prototype,`noDataRanges`,void 0),p([t({json:{write:!0}})],G.prototype,`allowUnmatched`,void 0),p([t({json:{write:!0}})],G.prototype,`replacementValue`,void 0),p([t({json:{write:!0}})],G.prototype,`isLastInputRangeInclusive`,void 0),G=Si=p([c(`esri.layers.raster.functions.RemapFunctionArguments`)],G);var Ci=G,wi=class extends E{constructor(){super(...arguments),this.functionName=`Remap`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.lookup=null}_bindSourceRasters(){let e=this.sourceRasterInfos[0].clone(),{pixelType:t}=e;e.bandCount=1;let{statistics:n}=e;this._removeStatsHistColormapVAT(e);let{allowUnmatched:r,replacementValue:i,outputValues:a,inputRanges:o,noDataRanges:s,isLastInputRangeInclusive:c}=this.functionArguments,l=this.outputPixelType===`unknown`||this.outputPixelType==null;if(this.outputPixelType=this._getOutputPixelType(t),a?.length){let o=n?.[0];if(r&&i==null){let t=o?.min??a[0],n=o?.max??a[0];t=Math.min.apply(null,[...a,t]),n=Math.max.apply(null,[...a,n]),e.statistics=[{min:t,max:n,avg:o?.avg??0,stddev:o?.stddev??-1}]}else{let t=a[0],n=t;for(let e=0;e<a.length;e++)t=t>a[e]?a[e]:t,n=n>a[e]?n:a[e];r&&i!=null&&(t=Math.min(t,i),n=Math.max(n,i)),e.statistics=[{min:t,max:n,avg:o?.avg??0,stddev:o?.stddev??-1}]}if(l){let{min:n,max:o}=e.statistics[0],s=[`u8`,`s8`,`u16`,`s16`,`u32`,`s32`,`f32`],c=s.find(e=>{let[t,r]=S(e);return n>=t&&o<=r})??`f64`;a.some(e=>Math.floor(e)!==e)?this.outputPixelType=c===`f64`?`f64`:`f32`:this.outputPixelType=r&&i==null&&s.indexOf(t)>s.indexOf(c)?t:c}}return e.pixelType=this.outputPixelType,this.rasterInfo=e,this.lookup=r?null:De({srcPixelType:t,inputRanges:o,outputValues:a,noDataRanges:s,allowUnmatched:r,isLastInputRangeInclusive:c,outputPixelType:this.outputPixelType}),{success:!0,supportsGPU:(!a||a.length<=9)&&(!s||s.length<=9)}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return null;let{lookup:n,outputPixelType:r}=this;if(n){let e=Se(t,{lut:[n.lut],offset:n.offset,outputPixelType:r});return e!=null&&n.mask&&(e.mask=we(t.pixels[0],t.mask,n.mask,n.offset,`u8`)),e}let{inputRanges:i,outputValues:a,noDataRanges:o,allowUnmatched:s,isLastInputRangeInclusive:c,replacementValue:l}=this.functionArguments;return xe(t,{inputRanges:i,outputValues:a,noDataRanges:o,outputPixelType:r,allowUnmatched:s,isLastInputRangeInclusive:c,replacementValue:l})}_getWebGLParameters(){let{allowUnmatched:e,noDataRanges:t,isLastInputRangeInclusive:r}=this.functionArguments,i=this.functionArguments.inputRanges??[],a=this.functionArguments.outputValues??[],o=Te(i,a,r),s=new Float32Array(18);return s.fill(n),t?.length&&s.set(t),{allowUnmatched:e,rangeMaps:o,noDataRanges:s,clampRange:S(this.outputPixelType),replacementValue:this.functionArguments.replacementValue}}};p([t({json:{write:!0,name:`rasterFunction`}})],wi.prototype,`functionName`,void 0),p([t({type:Ci,json:{write:!0,name:`rasterFunctionArguments`}})],wi.prototype,`functionArguments`,void 0),p([t()],wi.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],wi.prototype,`lookup`,void 0),wi=p([c(`esri.layers.raster.functions.RemapFunction`)],wi);var Ti=wi,Ei,Di=Ei=class extends ii{readColorRamp(e){if(typeof e==`string`){let t=_.jsonValues.find(t=>t.toLowerCase()===e.toLowerCase());return t?y(_.fromJSON(t)):null}return`toJSON`in e?e.toJSON():e}clone(){return new Ei({hillshadeType:this.hillshadeType,altitude:this.altitude,azimuth:this.azimuth,zFactor:this.zFactor,slopeType:this.slopeType,pixelSizeFactor:this.pixelSizeFactor,pixelSizePower:this.pixelSizePower,removeEdgeEffect:this.removeEdgeEffect,colorRamp:this.colorRamp,colormap:this.colormap,raster:this.raster})}};p([t({json:{write:!0}})],Di.prototype,`colorRamp`,void 0),p([l(`colorRamp`)],Di.prototype,`readColorRamp`,null),p([t({type:[[Number]],json:{write:!0}})],Di.prototype,`colormap`,void 0),Di=Ei=p([c(`esri.layers.raster.functions.ShadedReliefFunctionArguments`)],Di);var Oi=Di,K=class extends E{constructor(){super(...arguments),this.functionName=`ShadedRelief`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isGCS=!1}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1)return{success:!1,supportsGPU:!1,error:`shadedrelief-function: source data must be single band`};let{colorRamp:t,colormap:n}=this.functionArguments;if(!t&&!n?.length)return{success:!1,supportsGPU:!1,error:`shadedrelief-function: a color ramp argument must be specified`};this.outputPixelType=this._getOutputPixelType(`u8`);let r=e.clone();this._removeStatsHistColormapVAT(r),r.pixelType=this.outputPixelType,r.bandCount=3,r.statistics=[{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10},{min:0,max:255,avg:60,stddev:10}],this.rasterInfo=r,this.isGCS=r.spatialReference?.isGeographic??!1,n?.length||(n=ce(t,{interpolateAlpha:!0}));let{indexedColormap:i,offset:a}=je({colormap:n});if(!i?.length)return{success:!1,supportsGPU:!1,error:`shadedrelief-function: a valid colorramp is required`};let o=se(i);return this.lookup={indexedColormap:i,offset:a,hsvMap:o},{success:!0,supportsGPU:ge(i)}}_processPixels(e){let t=e.pixelBlocks?.[0];if(!t||!this.lookup)return null;let n=e.primaryPixelSizes?.[0];if(n==null){let{extent:r}=e;n=r?{x:r.width/t.width,y:r.height/t.height}:{x:1,y:1}}let r=pe(this.functionArguments,n,this.isGCS),i=re(t,r),a=this.sourceRasterInfos[0].statistics?.[0]??{min:0,max:8e3};return ue(i,t,this.lookup.hsvMap,a),i.pixelType=this.outputPixelType,i}_getWebGLParameters(){let e=pe(this.functionArguments,{x:1,y:1},this.isGCS),t=me(e),{slopeType:n,zFactor:r,pixelSizeFactor:i,pixelSizePower:a}=this.functionArguments,o=n===`scaled`,{indexedColormap:s,offset:c}=this.lookup,l=this.sourceRasterInfos[0].statistics?.[0],u=x(this.outputPixelType);return{...t,indexedColormap:s,offset:c,zFactor:r,gcsFactor:this.isGCS?de:1,pixelSizeFactor:o?i:0,pixelSizePower:o?a:0,minValue:l?.min??0,maxValue:l?.max??8e3,isOutputRounded:u}}};p([t({json:{write:!0,name:`rasterFunction`}})],K.prototype,`functionName`,void 0),p([t({type:Oi,json:{write:!0,name:`rasterFunctionArguments`}})],K.prototype,`functionArguments`,void 0),p([t()],K.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],K.prototype,`isGCS`,void 0),p([t({json:{write:!0}})],K.prototype,`lookup`,void 0),K=p([c(`esri.layers.raster.functions.ShadedReliefFunction`)],K);var ki=K,Ai,ji=new h({1:`degree`,2:`percent-rise`,3:`adjusted`},{useNumericKeys:!0}),q=Ai=class extends w{constructor(){super(...arguments),this.slopeType=`degree`,this.zFactor=1,this.pixelSizePower=.664,this.pixelSizeFactor=.024,this.removeEdgeEffect=!1}clone(){return new Ai({slopeType:this.slopeType,zFactor:this.zFactor,pixelSizePower:this.pixelSizePower,pixelSizeFactor:this.pixelSizeFactor,removeEdgeEffect:this.removeEdgeEffect,raster:this.raster})}};p([a(ji)],q.prototype,`slopeType`,void 0),p([t({type:Number,json:{write:!0}})],q.prototype,`zFactor`,void 0),p([t({type:Number,json:{name:`psPower`,write:!0}})],q.prototype,`pixelSizePower`,void 0),p([t({type:Number,json:{name:`psZFactor`,write:!0}})],q.prototype,`pixelSizeFactor`,void 0),p([t({type:Boolean,json:{write:!0}})],q.prototype,`removeEdgeEffect`,void 0),q=Ai=p([c(`esri.layers.raster.functions.SlopeFunctionArguments`)],q);var Mi=q,Ni=class extends E{constructor(){super(...arguments),this.functionName=`Slope`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isGCS=!1}_bindSourceRasters(){this.outputPixelType=this._getOutputPixelType(`f32`);let e=this.sourceRasterInfos[0].clone();return e.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(e),e.statistics=this.functionArguments.slopeType===`percent-rise`?null:[{min:0,max:90,avg:1,stddev:1}],e.bandCount=1,this.rasterInfo=e,this.isGCS=e.spatialReference?.isGeographic??!1,{success:!0,supportsGPU:!0}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return null;let{zFactor:n,slopeType:r,pixelSizePower:i,pixelSizeFactor:a}=this.functionArguments,{isGCS:o}=this,{extent:s,primaryPixelSizes:c}=e,l=c?.[0],u=l??(s?{x:s.width/t.width,y:s.height/t.height}:{x:1,y:1});return ne(t,{zFactor:n,slopeType:r,pixelSizePower:i,pixelSizeFactor:a,isGCS:o,resolution:u})}_getWebGLParameters(){let{zFactor:e,slopeType:t,pixelSizeFactor:n,pixelSizePower:r}=this.functionArguments;return{zFactor:this.isGCS&&e>=1?e*de:e,slopeType:t,pixelSizeFactor:n??0,pixelSizePower:r??0,isOutputRounded:x(this.outputPixelType)}}};p([t({json:{write:!0,name:`rasterFunction`}})],Ni.prototype,`functionName`,void 0),p([t({type:Mi,json:{write:!0,name:`rasterFunctionArguments`}})],Ni.prototype,`functionArguments`,void 0),p([t()],Ni.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],Ni.prototype,`isGCS`,void 0),Ni=p([c(`esri.layers.raster.functions.SlopeFunction`)],Ni);var Pi=Ni,Fi=new h({1:`min`,2:`max`,3:`mean`,4:`stddev`,5:`median`,6:`majority`,7:`minority`},{useNumericKeys:!0});function Ii(e,t){let{fillNoDataOnly:n}=t,{band:r,width:i,height:a,mask:o,outBand:s}=e;if(n&&!o)return void s.set(r);let{statisticsType:c,kernelRows:l,kernelCols:u}=t,d=c===`stddev`,f=i*a,p=new Float64Array(f),m=new Float64Array(f),h=new Uint32Array(f);for(let e=0;e<a;e++){let t=e*i,n=0,a=0,s=0;for(let e=0;e<u;e++)o&&!o[t+e]||(n+=r[t+e],d&&(a+=r[t+e]**2),s++);p[t]=n,m[t]=a,h[t]=s;for(let e=1;e<=i-u;e++){let i=t+e-1,c=i+u;o?(o[i]&&(s--,n-=r[i],d&&(a-=r[i]**2)),o[c]&&(s++,n+=r[c],d&&(a+=r[c]**2))):(n-=r[i],n+=r[c],d&&(a-=r[i]**2,a+=r[c]**2)),p[t+e]=n,h[t+e]=s,d&&(m[t+e]=a)}}let g=new Float64Array(f),_=new Float64Array(f),v=new Uint32Array(f),y=l*i;for(let e=0;e<=i-u;e++){let t=0,n=0,r=0;for(let a=0;a<l;a++){let o=a*i+e;t+=p[o],r+=h[o],d&&(n+=m[o])}g[e]=t,_[e]=n,v[e]=r;for(let o=1;o<=a-l;o++){let a=(o-1)*i+e,s=a+y;t-=p[a],t+=p[s],r-=h[a],r+=h[s],d&&(n-=m[a],n+=m[s]),g[o*i+e]=t,_[o*i+e]=n,v[o*i+e]=r}}let b=Math.floor(l/2),ee=Math.floor(u/2);for(let e=b;e<a-b;e++){let t=e*i;for(let r=ee;r<i-ee;r++){let a=(e-b)*i+r-ee,c=v[a];if(c===0||n&&(!o||o[t+r]))continue;let l=g[a]/c,u=d?Math.sqrt((_[a]-g[a]*l)/c):l;s[t+r]=u,o&&(o[t+r]=255)}}}function Li(e,t){let{fillNoDataOnly:n}=t,{band:r,width:i,height:a,mask:o,outBand:s}=e;if(n&&!o)return void s.set(r);let{kernelRows:c,kernelCols:l,statisticsType:u}=t,d=Math.floor(c/2),f=Math.floor(l/2),p=u===`min`,m=s.slice(),h=new Uint32Array(i*a);for(let e=d;e<a-d;e++){let t=e*i;for(let e=f;e<i-f;e++){let n=p?Number.MAX_VALUE:-Number.MAX_VALUE,a=0;for(let s=0;s<c;s++)for(let c=0;c<l;c++){let l=t+e+(s-d)*i+c-f;o&&!o[l]||(n=p?Math.min(n,r[l]):Math.max(n,r[l]),a++)}o?(m[t+e]=a===0?0:n,h[t+e]=a):s[t+e]=a===0?0:n}}if(o)for(let e=d;e<a-d;e++){let t=e*i;for(let e=f;e<i-f;e++)if(h[t+e]){if(n&&o[t+e])continue;s[t+e]=m[t+e],o[t+e]=255}}}function Ri(e,t){let{fillNoDataOnly:n}=t,{band:r,width:i,height:a,mask:o,outBand:s}=e;if(n&&!o)return void s.set(r);let{kernelRows:c,kernelCols:l}=t,u=Math.floor(c/2),d=Math.floor(l/2),f=s.slice(),p=new Uint32Array(i*a);for(let e=u;e<a-u;e++){let t=e*i;for(let e=d;e<i-d;e++){if(n&&o?.[t+e])continue;let a=[];for(let n=0;n<c;n++)for(let s=0;s<l;s++){let c=t+e+(n-u)*i+s-d;o&&!o[c]||a.push(r[c])}a.length&&(a.sort((e,t)=>e-t),o?(f[t+e]=a[Math.floor((a.length-1)/2)],p[t+e]=a.length):s[t+e]=a[Math.floor((a.length-1)/2)])}}if(o)for(let e=u;e<a-u;e++){let t=e*i;for(let e=d;e<i-d;e++)if(p[t+e]){if(n&&o[t+e])continue;s[t+e]=f[t+e],o[t+e]=255}}}function zi(e,t){let{fillNoDataOnly:n}=t,{band:r,width:i,height:a,mask:o,outBand:s}=e;if(n&&!o)return void s.set(r);let{kernelRows:c,kernelCols:l}=t,u=Math.floor(c/2),d=Math.floor(l/2),f=t.statisticsType===`majority`,p=c*l,m=s.slice(),h=new Uint32Array(i*a);for(let e=u;e<a-u;e++){let t=e*i;for(let e=d;e<i-d;e++){if(n&&o?.[t+e])continue;let a=new Map;for(let n=0;n<c;n++)for(let s=0;s<l;s++){let c=t+e+(n-u)*i+s-d;if(o&&!o[c])continue;let l=r[c];a.set(l,a.has(l)?a.get(l)+1:1)}if(a.size===0)continue;let g=0,_=0,v=f?0:p+1;for(let e of a.keys())_=a.get(e),f===_>v&&(v=_,g=e);o?(m[t+e]=g,h[t+e]=a.size):s[t+e]=g}}if(o)for(let e=u;e<a-u;e++){let t=e*i;for(let e=d;e<i-d;e++)if(h[t+e]){if(n&&o[t+e])continue;s[t+e]=m[t+e],o[t+e]=255}}}function Bi(e,t){let{mask:n}=e,{fillNoDataOnly:r}=t;if(r&&!n)return e;let{pixels:i,width:a,height:o,bandMasks:s,pixelType:c}=e,l=i.length,u=a*o,d=[],{kernelRows:f,kernelCols:p,statisticsType:m,mirrorEdges:h}=t;if(r&&!n)return e;let g=t.outputPixelType??c,_=[];for(let e=0;e<l;e++){let c=i[e],l=C.createEmptyBand(g,u);r&&l.set(c);let v=s?.[e]??n,y=v?.slice()??null,b={band:c,width:a,height:o,mask:y,outBand:l};switch(m){case`min`:case`max`:Li(b,t);break;case`mean`:case`stddev`:Ii(b,t);break;case`median`:Ri(b,t);break;case`majority`:case`minority`:zi(b,t)}h&&!r&&Er(l,a,o,f,p),d.push(l),y&&_.push(y)}let v=_[0]??n;_.length!==l&&(_.length=0),l>1&&s?.length&&(v=C.combineBandMasks(s));let y=new C({pixelType:g,width:a,height:o,pixels:d,bandMasks:s&&_.length?_:null,mask:v});return y.updateStatistics(),y}var Vi,J=Vi=class extends w{constructor(){super(...arguments),this.rows=3,this.cols=3,this.fillNoDataOnly=!1,this.statisticsType=`min`}clone(){return new Vi({rows:this.rows,cols:this.cols,fillNoDataOnly:this.fillNoDataOnly,statisticsType:this.statisticsType,raster:i(this.raster)})}};p([t({json:{write:!0,read:{source:[`kernelRows`,`rows`],reader:(e,t)=>Number(e??t?.kernelRows??3)}}})],J.prototype,`rows`,void 0),p([t({json:{write:!0,read:{source:[`kernelCols`,`cols`],reader:(e,t)=>Number(e??t?.kernelCols??3)}}})],J.prototype,`cols`,void 0),p([t({json:{write:!0}})],J.prototype,`fillNoDataOnly`,void 0),p([t({json:{read:{source:[`statisticsType`,`type`],reader:(e,t)=>Fi.fromJSON(t?.statisticsType??t?.type)??`min`},write:{target:`type`}}}),a(Fi)],J.prototype,`statisticsType`,void 0),J=Vi=p([c(`esri.layers.raster.functions.StatisticsFunctionArguments`)],J);var Hi=J,Ui=class extends E{constructor(){super(...arguments),this.functionName=`Statistics`,this.rasterArgumentNames=[`raster`]}_bindSourceRasters(){let{type:e}=this.functionArguments.toJSON();if(e<1||e>7)return{success:!1,supportsGPU:!1,error:`statistics-function: the given statistics type is not supported ${e}`};let t=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(t.pixelType);let n=t.clone();n.pixelType=this.outputPixelType;let{statisticsType:r}=this.functionArguments;return r===`stddev`&&this._removeStatsHistColormapVAT(n),this.rasterInfo=n,{success:!0,supportsGPU:n.bandCount<=3&&e<5}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return t;let{statisticsType:n,rows:r,cols:i,fillNoDataOnly:a}=this.functionArguments;return Bi(t,{kernelRows:r,kernelCols:i,fillNoDataOnly:a,outputPixelType:this.outputPixelType,statisticsType:n,mirrorEdges:!0})}_getWebGLParameters(){let{rows:e,cols:t,statisticsType:n,fillNoDataOnly:r}=this.functionArguments;return{fillNoDataOnly:r,kernelRows:e,kernelCols:t,statisticsType:n,clampRange:S(this.outputPixelType)}}};p([t({json:{write:!0,name:`rasterFunction`}})],Ui.prototype,`functionName`,void 0),p([t({type:Hi,json:{write:!0,name:`rasterFunctionArguments`}})],Ui.prototype,`functionArguments`,void 0),p([t()],Ui.prototype,`rasterArgumentNames`,void 0),Ui=p([c(`esri.layers.raster.functions.StatisticsFunction`)],Ui);var Wi=Ui,Gi,Ki=Gi=class extends w{constructor(){super(...arguments),this.statistics=null,this.histograms=null}readStatistics(e,t){if(!e?.length)return null;let n=[];return e.forEach(e=>{let t={min:e.min,max:e.max,avg:e.avg??e.mean,stddev:e.stddev??e.standardDeviation};n.push(t)}),n}writeStatistics(e,t,n){if(!e?.length)return;let r=[];e.forEach(e=>{let t={...e,mean:e.avg,standardDeviation:e.stddev};delete t.avg,delete t.stddev,r.push(t)}),t[n]=r}clone(){return new Gi({statistics:i(this.statistics),histograms:i(this.histograms)})}};p([t({json:{write:!0}})],Ki.prototype,`statistics`,void 0),p([l(`statistics`)],Ki.prototype,`readStatistics`,null),p([s(`statistics`)],Ki.prototype,`writeStatistics`,null),p([t({json:{write:!0}})],Ki.prototype,`histograms`,void 0),Ki=Gi=p([c(`esri.layers.raster.functions.StatisticsHistogramFunctionArguments`)],Ki);var qi=Ki,Y=class extends E{constructor(){super(...arguments),this.functionName=`StatisticsHistogram`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isNoopProcess=!0}_bindSourceRasters(){let e=this.sourceRasterInfos[0];this.outputPixelType=this._getOutputPixelType(`u8`);let t=e.clone(),{statistics:n,histograms:r}=this.functionArguments;return r&&(t.histograms=r),n&&(t.statistics=n),this.rasterInfo=t,{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}};p([t({json:{write:!0,name:`rasterFunction`}})],Y.prototype,`functionName`,void 0),p([t({type:qi,json:{write:!0,name:`rasterFunctionArguments`}})],Y.prototype,`functionArguments`,void 0),p([t()],Y.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],Y.prototype,`indexedColormap`,void 0),p([t()],Y.prototype,`isNoopProcess`,void 0),Y=p([c(`esri.layers.raster.functions.StatisticsHistogramFunction`)],Y);var Ji=Y,Yi,Xi=new h({0:`none`,3:`standard-deviation`,4:`histogram-equalization`,5:`min-max`,6:`percent-clip`,9:`sigmoid`},{useNumericKeys:!0}),X=Yi=class extends w{constructor(){super(...arguments),this.computeGamma=!1,this.dynamicRangeAdjustment=!1,this.gamma=[],this.histograms=null,this.statistics=null,this.stretchType=`none`,this.useGamma=!1}writeStatistics(e,t,n){e?.length&&(Array.isArray(e[0])||(e=e.map(e=>[e.min,e.max,e.avg,e.stddev])),t[n]=e)}clone(){return new Yi({stretchType:this.stretchType,outputMin:this.outputMin,outputMax:this.outputMax,useGamma:this.useGamma,computeGamma:this.computeGamma,statistics:i(this.statistics),gamma:i(this.gamma),sigmoidStrengthLevel:this.sigmoidStrengthLevel,numberOfStandardDeviations:this.numberOfStandardDeviations,minPercent:this.minPercent,maxPercent:this.maxPercent,histograms:i(this.histograms),dynamicRangeAdjustment:this.dynamicRangeAdjustment,raster:this.raster})}};p([t({type:Boolean,json:{write:!0}})],X.prototype,`computeGamma`,void 0),p([t({type:Boolean,json:{name:`dra`,write:!0}})],X.prototype,`dynamicRangeAdjustment`,void 0),p([t({type:[Number],json:{write:!0}})],X.prototype,`gamma`,void 0),p([t()],X.prototype,`histograms`,void 0),p([t({type:Number,json:{write:!0}})],X.prototype,`maxPercent`,void 0),p([t({type:Number,json:{write:!0}})],X.prototype,`minPercent`,void 0),p([t({type:Number,json:{write:!0}})],X.prototype,`numberOfStandardDeviations`,void 0),p([t({type:Number,json:{name:`max`,write:!0}})],X.prototype,`outputMax`,void 0),p([t({type:Number,json:{name:`min`,write:!0}})],X.prototype,`outputMin`,void 0),p([t({type:Number,json:{write:!0}})],X.prototype,`sigmoidStrengthLevel`,void 0),p([t({json:{type:[[Number]],write:!0}})],X.prototype,`statistics`,void 0),p([s(`statistics`)],X.prototype,`writeStatistics`,null),p([a(Xi)],X.prototype,`stretchType`,void 0),p([t({type:Boolean,json:{write:!0}})],X.prototype,`useGamma`,void 0),X=Yi=p([c(`esri.layers.raster.functions.StretchFunctionArguments`)],X);var Zi=X,Z=class extends E{constructor(){super(...arguments),this.functionName=`Stretch`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.lookup=null,this.cutOffs=null}_bindSourceRasters(){this.lookup=null,this.cutOffs=null;let e=this.sourceRasterInfos[0],{pixelType:t}=e,{functionArguments:n}=this,{dynamicRangeAdjustment:r,gamma:i,useGamma:a}=n;if(!r&&[`u8`,`u16`,`s8`,`s16`].includes(t)){let r=he(n.toJSON(),{rasterInfo:e}),o=x(this.outputPixelType)?`round`:`float`;this.lookup=ie({pixelType:t,...r,gamma:a?i:null,rounding:o}),this.cutOffs=r}else r||(this.cutOffs=he(n.toJSON(),{rasterInfo:e}));this.outputPixelType=this._getOutputPixelType(t);let o=e.clone();o.pixelType=this.outputPixelType,this._removeStatsHistColormapVAT(o),this.outputPixelType===`u8`&&(o.keyProperties.DataType=`processed`);let{outputMin:s=0,outputMax:c=255}=this.functionArguments;o.statistics=[];for(let e=0;e<o.bandCount;e++)o.statistics[e]={min:s,max:c};return this.rasterInfo=o,{success:!0,supportsGPU:!r}}_processPixels(e){let t=e.pixelBlocks?.[0];if(t==null)return t;let{lookup:n}=this;if(n)return Se(t,{...n,outputPixelType:this.rasterInfo.pixelType});let{functionArguments:r}=this,i=this.cutOffs||he(r.toJSON(),{rasterInfo:this.sourceRasterInfos[0],pixelBlock:t}),a=r.useGamma?r.gamma:null;return te(t,{...i,gamma:a,outputPixelType:this.outputPixelType})}_getWebGLParameters(){let{outputMin:e=0,outputMax:t=255,gamma:n,useGamma:r}=this.functionArguments,i=this.rasterInfo.bandCount>=2?3:1,a=r&&n?.length?ae(i,n):[1,1,1],{minCutOff:o,maxCutOff:s}=this.cutOffs??{minCutOff:[0,0,0],maxCutOff:[255,255,255]};o.length===1&&(o[1]=o[2]=o[0],s[1]=s[2]=s[0]);let c=s.map((n,r)=>(t-e)/(s[r]-o[r])),l=x(this.outputPixelType),u=r&&n?[n[0],n[1]??n[0],n[2]??n[0]]:[1,1,1],d=r?[a[0],a[1]??a[0],a[2]??a[0]]:[1,1,1];return{bandCount:i,minOutput:e,maxOutput:t,minCutOff:o,maxCutOff:s,factor:c,useGamma:r,gamma:u,gammaCorrection:d,stretchType:this.functionArguments.stretchType,isOutputRounded:l,type:`stretch`}}};p([t({json:{write:!0,name:`rasterFunction`}})],Z.prototype,`functionName`,void 0),p([t({type:Zi,json:{write:!0,name:`rasterFunctionArguments`}})],Z.prototype,`functionArguments`,void 0),p([t()],Z.prototype,`rasterArgumentNames`,void 0),p([t({json:{write:!0}})],Z.prototype,`lookup`,void 0),p([t({json:{write:!0}})],Z.prototype,`cutOffs`,void 0),Z=p([c(`esri.layers.raster.functions.StretchFunction`)],Z);var Qi=Z,$i,ea=$i=class extends w{constructor(){super(...arguments),this.attributeTableAsRecordSet=null}clone(){return new $i({attributeTableAsRecordSet:i(this.attributeTableAsRecordSet)})}};p([t({json:{write:!0}})],ea.prototype,`attributeTableAsRecordSet`,void 0),ea=$i=p([c(`esri.layers.raster.functions.TableFunctionArguments`)],ea);var ta=ea,Q=class extends E{constructor(){super(...arguments),this.functionName=`Table`,this.functionArguments=null,this.rasterArgumentNames=[`raster`],this.isNoopProcess=!0}_bindSourceRasters(){let e=this.sourceRasterInfos[0];if(e.bandCount>1||e.pixelType.startsWith(`f`))return{success:!1,supportsGPU:!1,error:`table-function: Source data must be single band and integer pixel type.`};let{attributeTableAsRecordSet:t}=this.functionArguments;if(!t)return{success:!1,supportsGPU:!1,error:`table-function: Missing attributeTableAsRecordSet argument.`};this.outputPixelType=this._getOutputPixelType(e.pixelType);let n=e.clone();return n.pixelType=this.outputPixelType,n.bandCount=1,n.dataType!==`thematic`&&(n.keyProperties=n.keyProperties?{...n.keyProperties,DataType:`thematic`}:{DataType:`thematic`}),this.rasterInfo=n,{success:!0,supportsGPU:!0}}_processPixels(e){return e.pixelBlocks?.[0]}};p([t({json:{write:!0,name:`rasterFunction`}})],Q.prototype,`functionName`,void 0),p([t({type:ta,json:{write:!0,name:`rasterFunctionArguments`}})],Q.prototype,`functionArguments`,void 0),p([t()],Q.prototype,`rasterArgumentNames`,void 0),p([t()],Q.prototype,`isNoopProcess`,void 0),Q=p([c(`esri.layers.raster.functions.TableFunction`)],Q);var na=Q,$=new Map;function ra(e,t){let{rasterFunctionArguments:n}=e;n&&(n.rasters||[n.raster,n.raster2]).forEach(e=>{e&&typeof e!=`number`&&(typeof e==`string`?e.startsWith(`http`)&&(t.includes(e)||t.push(e)):`rasterFunctionArguments`in e&&ra(e,t))})}function ia(t,n){n??={};try{if(`function`in(t=i(t))&&`arguments`in t&&t.arguments){let r=fa(t,new Map,n);if(ma(r),!r.renderingRule)throw new e(`raster-function-helper`,`Unsupported raster function json.`);t=r.renderingRule}if(`rasterFunction`in t){let e=ca(t=sa(t),n);return e.isRoot=!0,e}}catch{}throw new e(`raster-function-helper`,`unsupported raster function json.`)}function aa(e,t){return t[0]===`rasters`&&Array.isArray(e.rasters)?e.rasters:t.map(t=>e[t])}function oa(e){return!!(e&&typeof e==`object`&&e.rasterFunction&&e.rasterFunctionArguments)}function sa(e){let{rasterFunction:t,rasterFunctionArguments:n}=e,r={};for(let e in n){let t=n[e],i=e.toLowerCase();if(i===`rasters`&&Array.isArray(t))r.rasters=t.map(e=>oa(e)?sa(e):e);else switch(oa(t)&&(t=sa(t)),i){case`dra`:r.dra=t;break;case`pspower`:r.psPower=t;break;case`pszfactor`:r.psZFactor=t;break;case`bandids`:r.bandIds=t;break;default:r[e[0].toLowerCase()+e.slice(1)]=t}}return t!==`Local`||r.rasters?.length||(r.rasters=[`$$`]),{...e,rasterFunctionArguments:r}}function ca(t,n){let{rasterFunction:r,rasterFunctionArguments:i}=t,a=t.outputPixelType?.toLowerCase();if(r==null||!$.has(r))throw new e(`raster-function-helper`,`unsupported raster function: ${r}`);let o=$.get(r),s=(typeof o.ctor==`function`?o.ctor:o.ctor.default).fromJSON({...t,outputPixelType:a}),{rasterArgumentNames:c}=s,l=[],u=aa(i,c),d=c[0]===`rasters`||c.length>1,f=[];for(let e=0;e<u.length;e++){let t=u[e],r;t==null||typeof t==`string`&&t.startsWith(`$`)?l.push(n?.raster):typeof t==`string`?n[t]&&l.push(n[t]):typeof t!=`number`&&`rasterFunction`in t&&(r=ca(t,n),d||(s.functionArguments[c[e]]=r),l.push(r)),d&&f.push(r??t)}if(d&&(c[0]===`rasters`?s.functionArguments.rasters=f:c.forEach((e,t)=>{s.functionArguments[e]=f[t]})),n){s.sourceRasters=l;let e=n.raster?.url;e&&(s.mainPrimaryRasterId=e)}return s}function la(e,t){if(e&&t)for(let n in e){let r=e[n];r&&typeof r==`object`&&`type`in r&&(r.type===`RasterFunctionTemplate`?la(r.arguments,t):r.type===`RasterFunctionVariable`&&t[r.name]!=null&&(r.value=t[r.name]))}}function ua(t,n){if(!t||typeof t!=`object`)return t;let{value:r}=t;if(!r||typeof r!=`object`)return t.isDataset?`$$`:r;if(Array.isArray(r))return r.length===0?[]:r.map(e=>e&&typeof e==`object`&&e.type===`RasterFunctionVariable`?ua(e,n):e);if(`value`in r&&[`number`,`string`,`boolean`].includes(typeof r.value))return r.value;if(t.isDataset&&r.type!==`Scalar`)return`$$`;if(!(`type`in r))return r;let i=r;switch(r.type){case`Scalar`:i=r.value;break;case`AlgorithmicColorRamp`:i=da(r);break;case`MultiPartColorRamp`:i={type:`multipart`,colorRamps:r.ArrayOfColorRamp.map(da)};break;case`ArgumentArray`:if(r.elements?.length&&r.elements[0].type!==`RasterStatistics`){let t=[];for(let i=0;i<r.elements.length;i++){let a=r.elements[i],{type:o}=a;if(o)if(o===`RasterFunctionTemplate`){let{renderingRule:e}=fa(a,n);t.push(e),a._object_id!=null&&n.set(a._object_id,e)}else{if(o!==`RasterFunctionVariable`)throw new e(`raster-function-helper`,`unsupported raster function json.`);{let e=ua(a,n);t.push(e),a._object_id!=null&&n.set(a._object_id,e)}}else t.push(a)}i=t}else i=r.elements}return r._object_id!=null&&n.set(r._object_id,i),i}function da(e){let t=e.algorithm??`esriHSVAlgorithm`,{FromColor:n,ToColor:r}=e;if(!Array.isArray(n)){let{r:e,g:t,b:r}=Me({h:n.Hue,s:n.Saturation,v:n.Value});n=[e,t,r,n.AlphaValue]}if(!Array.isArray(r)){let{r:e,g:t,b:n}=Me({h:r.Hue,s:r.Saturation,v:r.Value});r=[e,t,n,r.AlphaValue]}return{type:`algorithmic`,algorithm:t,fromColor:n,toColor:r}}function fa(e,t,n){n&&la(e,n);let r={renderingRule:{},templates:t};return pa(e,r),r}function pa(e,t){if(!e||!t.renderingRule)return;let{renderingRule:n,templates:r}=t,{function:i,arguments:a,_object_id:o}=e;if(!i||!a)return;o!=null&&r.set(o,n),n.rasterFunction=i.type.replace(`Function`,``),n.outputPixelType=i.pixelType;let s={};for(let e in n.rasterFunctionArguments=s,a){if(e===`type`||e===`object_id`||e===`_object_ref_id`)continue;let t=a[e];t&&typeof t==`object`&&`type`in t&&(t.type===`RasterFunctionTemplate`||t.type===`RasterFunctionVariable`)?(t.type===`RasterFunctionVariable`?s[e]=ua(t,r):(n.rasterFunctionArguments[e]={},pa(t,{renderingRule:n.rasterFunctionArguments[e],templates:r})),t._object_id!=null&&r.set(t._object_id,s[e])):s[e]=t}switch(s.DEM&&!s.Raster&&(s.Raster=s.DEM,delete s.DEM),n.rasterFunction){case`Stretch`:ha(s);break;case`Colormap`:ga(s);break;case`Convolution`:_a(s);break;case`Mask`:va(s)}}function ma(t){let{renderingRule:n,templates:r}=t;if(typeof n!=`object`||!n?.rasterFunctionArguments||!r.size)return;let{rasterFunctionArguments:i}=n;for(let t in i){let n=i[t],a=t===`_object_ref_id`?n:n&&typeof n==`object`&&`_object_ref_id`in n?n._object_ref_id:null;if(a!=null){if(!r.has(a))throw new e(`raster-function-helper`,`unsupported raster function json. _object_ref_id: ${a} does not exist`);let n=r.get(a);t===`_object_ref_id`?n&&typeof n==`object`&&Object.assign(i,n):i[t]=n;continue}n&&typeof n==`object`&&(n.rasterFunctionArguments&&ma({renderingRule:n,templates:r}),Array.isArray(n)&&n.forEach((t,i)=>{if(t&&typeof t==`object`)if(t._object_ref_id!=null){if(!r.has(t._object_ref_id))throw new e(`raster-function-helper`,`unsupported raster function json. _object_ref_id: ${n} does not exist`);let o=r.get(a);o&&typeof o==`object`?Object.assign(t,o):n[i]=o}else ma({renderingRule:t,templates:r})}))}}function ha(e){e.Statistics?.length&&typeof e.Statistics==`object`&&(e.Statistics=e.Statistics.map(e=>[e.min,e.max,e.mean,e.standardDeviation])),e.NumberOfStandardDeviation!=null&&(e.NumberOfStandardDeviations=e.NumberOfStandardDeviation,delete e.NumberOfStandardDeviation)}function ga(e){e.ColorRamp?.type?.toLowerCase()===`randomcolorramp`&&(delete e.ColorRamp,e.ColormapName=`Random`),e.ColorSchemeType===0&&delete e.ColorRamp}function _a(e){e.ConvolutionType!=null&&(e.Type=e.ConvolutionType,delete e.ConvolutionType)}function va(e){e.NoDataValues?.length&&typeof e.NoDataValues[0]==`string`&&(e.NoDataValues=e.NoDataValues.filter(e=>e!==``).map(e=>Number(e)))}$.set(`Arithmetic`,{desc:`Arithmetic Function`,ctor:Qt,rasterArgumentNames:[`rasters`]}),$.set(`Aspect`,{desc:`Aspect Function`,ctor:rn,rasterArgumentNames:[`raster`]}),$.set(`BandArithmetic`,{desc:`Band Arithmetic Function`,ctor:In,rasterArgumentNames:[`raster`]}),$.set(`Colormap`,{desc:`Colormap Function`,ctor:er,rasterArgumentNames:[`raster`]}),$.set(`ColormapToRGB`,{desc:`ColormapToRGB Function`,ctor:ar,rasterArgumentNames:[`raster`]}),$.set(`CompositeBand`,{desc:`CompositeBand Function`,ctor:ur,rasterArgumentNames:[`rasters`]}),$.set(`ComputeChange`,{desc:`ComputeChange Function`,ctor:xr,rasterArgumentNames:[`rasters`]}),$.set(`Convolution`,{desc:`Convolution Function`,ctor:Ir,rasterArgumentNames:[`raster`]}),$.set(`ContrastBrightness`,{desc:`Contrast Brightness Function`,ctor:Tr,rasterArgumentNames:[`raster`]}),$.set(`ExtractBand`,{desc:`ExtractBand Function`,ctor:Gr,rasterArgumentNames:[`raster`]}),$.set(`Curvature`,{desc:`Curvature Function`,ctor:Vr,rasterArgumentNames:[`raster`]}),$.set(`Hillshade`,{desc:`Hillshade Function`,ctor:oi,rasterArgumentNames:[`raster`]}),$.set(`ShadedRelief`,{desc:`ShadedRelief Function`,ctor:ki,rasterArgumentNames:[`raster`]}),$.set(`Grayscale`,{desc:`Grayscale Function`,ctor:ei,rasterArgumentNames:[`raster`]}),$.set(`Clip`,{desc:`Clip Function`,ctor:Hn,rasterArgumentNames:[`raster`]}),$.set(`Local`,{desc:`Local Function`,ctor:di,rasterArgumentNames:[`rasters`]}),$.set(`Mask`,{desc:`Mask Function`,ctor:gi,rasterArgumentNames:[`raster`]}),$.set(`NDVI`,{desc:`NDVI Function`,ctor:xi,rasterArgumentNames:[`raster`]}),$.set(`Remap`,{desc:`Remap Function`,ctor:Ti,rasterArgumentNames:[`raster`]}),$.set(`Slope`,{desc:`Slope Function`,ctor:Pi,rasterArgumentNames:[`raster`]}),$.set(`Statistics`,{desc:`Focal Statistics Function`,ctor:Wi,rasterArgumentNames:[`raster`]}),$.set(`StatisticsHistogram`,{desc:`Statistics Histogram Function`,ctor:Ji,rasterArgumentNames:[`raster`]}),$.set(`Stretch`,{desc:`Stretch Function`,ctor:Qi,rasterArgumentNames:[`raster`]}),$.set(`Table`,{desc:`Attribute Table Function`,ctor:na,rasterArgumentNames:[`raster`]});export{ra as n,ia as t};