import{DT as e,Gf as t,H_ as n,Hw as r,Kw as i,OT as a,Od as o,T_ as s,WT as c,_w as l,dg as u,ev as d,gD as f,jd as p,nv as m,pg as h,rT as g,rv as _,vd as v}from"./index-CZ4oMP1N.js";import"./memoryEstimations-DQOvnrRz.js";import"./OptimizedGeometry-hOUTi-cB.js";import"./Point2D-7VmvyXN4.js";import"./Envelope2D-Cwxt0azx.js";import"./SpatialReference-HLIf1Z5k.js";import"./Transformation2D-CPSmiNnd.js";import"./SimpleGeometryCursor-5wFw2ZZo.js";import"./OperatorDefinitions-CscAnk1m.js";import"./jsonConverter-CbeIyOFG.js";import"./apiConverter-BH2GqpH4.js";import"./geodeticCurveType-DoJa853C.js";import"./geodeticAreaOperator-CbAaN6Nl.js";import"./operatorGeodeticDensify-CnMr28Dz.js";import{i as y,o as b}from"./geodeticDensifyOperator-mOADqpSg.js";import{i as x,r as S}from"./geodeticLengthOperator-CWQiiddx.js";import{n as C}from"./lengthOperator-DHlVc34D.js";import"./operatorSimplify-CKtdefMF.js";import{r as w}from"./simplifyOperator-CdQI_hSF.js";import"./quatf64-BJJPhW0N.js";import"./earcut-BF1-mB58.js";import"./plane-Bg1a5O73.js";import"./vectorStacks-FfDNcZoS.js";import"./projectPointToVector-HYpbaZqA.js";import"./spatialReferenceEllipsoidUtils-B0E4spY0.js";import"./projectionZScaling-DAQiVc32.js";import{i as T,r as E}from"./projectOperator-CfopyaTY.js";import"./dehydratedPoint-rdg1UAtQ.js";import"./projectVectorToVector-DX3Yd1qf.js";import"./memoize-BNsZjv91.js";import"./elevationInfoUtils-9csVBlEH.js";import{r as D,s as O}from"./colorUtils-DJOs5VE1.js";import{t as k}from"./GraphicsLayer-Bx8Nz7ax.js";import"./ObjectStack-CBI5g-Qc.js";import"./ray-CWXoVP-g.js";import{t as A}from"./getDefaultUnitForView-BwZf47ZU.js";import{n as j,t as M}from"./ExclusiveOperationManager-CKK1qF1W.js";import{n as N}from"./quantity-CPor8qMe.js";import"./unitFormatUtils-3ZxnJ6-6.js";import{a as P}from"./quantityFormatUtils-DJ98D30D.js";import{c as F,o as I,s as L}from"./geodesicUtils-CbiJFASl.js";import{n as R,t as z}from"./SketchViewModel-NAjbn0Ca.js";import"./isSupportedObject-Ccal0viz.js";import"./layerUtils-VowzydxH.js";import"./SketchOptions-Dp8M5XoK.js";import"./LineSnappingHint-BOeMI0cS.js";import"./ParallelSnappingHint-C_mSlwpq.js";import"./snappingUtils-Od8uWW_a.js";import"./vec3-zq4-AU_O.js";import"./sphere-9YfqUkuX.js";import"./constraints-Bf0IRs4G.js";import"./SnappingCandidate-B4WtOFZq.js";import"./EdgeSnappingCandidate-BfgKjc_Z.js";import"./DrapedEdgeSnappingCandidate-BWx5lQgf.js";import"./IntersectionSnappingHint-CdcMZxUs.js";import"./IntersectionSnappingCandidate-b5Urq9uN.js";import"./LineSnappingCandidate-BsncFUer.js";import"./RightAngleTriangleSnappingCandidate-CRITbc5W.js";import"./RightAngleSnappingHint-BXbBqf-p.js";import"./viewUtils-D9SUkhqu.js";import"./viewUtils-BwKx9qtR.js";import"./euclideanLengthMeasurementUtils-C9WB-wbk.js";import"./lineSegment-BJ2rgalW.js";import"./triangle-_uWz9WdI.js";import"./hitTestSelectUtils-DQf3EOGe.js";var B=N(1e5,`meters`);async function V(e,t){if(!e?.paths.length||!e.paths[0].length)return null;await T();let n=E(e,t);return n?n.spatialReference.isGeographic?L(n.spatialReference)?U(n):H(n):n.spatialReference.isWebMercator?H(n):W(n):null}async function H(e){await Promise.all([b(),x()]);let t=w(e);if(!t)return null;let n=y(t,B.value,{unit:B.unit});if(!n)return null;let r=S(t,{unit:`meters`});return{display:{outline:n},mode:`geodesic`,length:N(r,`meters`)}}function U(e){let t=w(e);if(!t)return null;let n=F(t,B.value),r=I([t],`meters`)[0];return{display:{outline:n},mode:`geodesic`,length:N(r,`meters`)}}function W(e){let t=w(e);if(!t)return null;let n=C(t,{unit:`meters`});return{display:{outline:t},mode:`euclidean`,length:N(n,`meters`)}}var G=class extends l{constructor(e){super(e),this._result=null,this._updatingHandles=new h,this._debouncedGetResult=r(async e=>{this._result=await V(e,this.view.spatialReference)})}initialize(){this.addHandles(m(()=>this.measurementViewData.analysis.geometry,e=>{this._updatingHandles.addPromise(g(this._debouncedGetResult(e)))},_))}destroy(){this._updatingHandles.destroy()}get result(){return this._result}get updating(){return this._updatingHandles.updating}};f([e()],G.prototype,`_result`,void 0),f([e()],G.prototype,`measurementViewData`,void 0),f([e()],G.prototype,`result`,null),f([e()],G.prototype,`updating`,null),f([e()],G.prototype,`view`,void 0),G=f([a(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementController`)],G);function K(e,n){let r=D(O(n,160),.5),i=O(e);return new t({data:{type:`CIMSymbolReference`,primitiveOverrides:[{type:`CIMPrimitiveOverride`,primitiveName:`textOverride`,propertyName:`TextString`,valueExpressionInfo:{type:`CIMExpressionInfo`,title:`Custom`,expression:`$feature.lengthText`,returnType:`Default`}}],symbol:{type:`CIMLineSymbol`,symbolLayers:[{type:`CIMVectorMarker`,enable:!0,size:10,colorLocked:!0,anchorPointUnits:`Relative`,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:`CIMMarkerGraphic`,geometry:{x:0,y:0},symbol:{type:`CIMTextSymbol`,fontFamilyName:`sans-serif`,height:14,horizontalAlignment:`Center`,offsetX:0,offsetY:0,symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,enable:!0,color:n.toArray()}]},haloSymbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,enable:!0,color:r.toArray()}]},haloSize:2,verticalAlignment:`Center`,flipAngle:90},primitiveName:`textOverride`}],scaleSymbolsProportionally:!0,respectFrame:!0,markerPlacement:{type:`CIMMarkerPlacementOnLine`,angleToLine:!0,offset:8,relativeTo:`LineMiddle`,startPointOffset:0}},{type:`CIMSolidStroke`,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[14,12],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],enable:!0,capStyle:`Butt`,joinStyle:`Round`,width:3.5,color:i.toArray()},{type:`CIMSolidStroke`,enable:!0,capStyle:`Butt`,joinStyle:`Round`,width:5,color:e.toArray()}]}}})}var q=class extends l{get _messages(){return this._messagesTask?.value}constructor(e){super(e),this._graphicsLayer=new k({listMode:`hide`,internal:!0}),this._updatingHandles=new h}initialize(){this.view.map?.add(this._graphicsLayer),this.addHandles(n(()=>this._updateMessageBundle())),this._updatingHandles.add(()=>({accentColor:this.view.effectiveTheme.accentColor,length:this.measurementViewData.result?.length,messages:this._messages,outline:this.measurementViewData.result?.display.outline,textColor:this.view.effectiveTheme.textColor,unit:this.measurementViewData.unit,visible:this.measurementViewData.visible}),({accentColor:e,length:t,messages:n,outline:r,textColor:i,unit:a,visible:o},s)=>{if(this._graphicsLayer.visible=o,!o)return;if(!n||!t||!r)return void this._graphicsLayer.graphics.destroyAll();let c=this._graphicsLayer.graphics.at(0),l=n&&t?P(n,t,a):``;if(c&&e.equals(s?.accentColor)&&i.equals(s?.textColor))return c.attributes.lengthText=l,void(c.geometry=r);this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new v({attributes:{lengthText:l},geometry:r,symbol:K(e,i)}))},d),this._updateMessageBundle()}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get updating(){return!this._graphicsLayer.loaded||!this._messagesTask?.finished||this._updatingHandles.updating}_updateMessageBundle(){return this._messagesTask?.abort(),this._messagesTask=u(()=>s(`esri/core/t9n/Units`)),this._messagesTask.promise}};f([e()],q.prototype,`_messages`,null),f([e()],q.prototype,`_messagesTask`,void 0),f([e()],q.prototype,`measurementViewData`,void 0),f([e()],q.prototype,`updating`,null),f([e()],q.prototype,`view`,void 0),q=f([a(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementLineVisualization`)],q);var J=class extends l{constructor(e){super(e),this._emptyFillSymbol=new o({color:null,outline:null}),this._graphicsLayer=new k({listMode:`hide`,internal:!0}),this._updatingHandles=new h}initialize(){this.view.map?.add(this._graphicsLayer),this._updatingHandles.add(()=>({geometry:this.measurementViewData.analysis.geometry}),({geometry:e})=>{if(!e)return void this._graphicsLayer.graphics.destroyAll();let t=this._graphicsLayer.graphics.at(0);t?t.geometry=e:(this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.add(new v({geometry:e,symbol:this._emptyFillSymbol})))},d)}destroy(){this._emptyFillSymbol.destroy(),this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._updatingHandles.destroy()}get graphic(){return this._graphicsLayer.graphics.at(0)}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded||this._updatingHandles.updating}};f([e()],J.prototype,`graphic`,null),f([e()],J.prototype,`graphicsLayer`,null),f([e()],J.prototype,`measurementViewData`,void 0),f([e()],J.prototype,`updating`,null),f([e()],J.prototype,`view`,void 0),J=f([a(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementManipulatorVisualization`)],J);var Y=class extends l{constructor(e){super(e),this._graphicsLayer=new k({listMode:`hide`,internal:!0})}initialize(){this.view.map?.add(this._graphicsLayer)}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get graphicsLayer(){return this._graphicsLayer}get updating(){return!this._graphicsLayer.loaded}};f([e()],Y.prototype,`graphicsLayer`,null),f([e()],Y.prototype,`measurementViewData`,void 0),f([e()],Y.prototype,`updating`,null),f([e()],Y.prototype,`view`,void 0),Y=f([a(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementSketchVisualization`)],Y);function X(e){return e?.type===`polyline`}var Z=class extends l{constructor(e){super(e),this._invisibleLineSymbol=new p({color:null,width:0}),this._operationManager=new M,this._updatingHandles=new h}initialize(){this._sketchViewModel=new z({defaultCreateOptions:{mode:`click`},defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{edgeOperation:`none`,shapeOperation:`none`},toggleToolOnClick:!1,tool:`reshape`},updateOnGraphicClick:!1,view:this.view}),this.addHandles([m(()=>({interactive:this.measurementViewData.interactive,visible:this.measurementViewData.visible}),({interactive:e,visible:t})=>{this._operationManager.stop(),t&&e&&this.reshape()}),m(()=>this.measurementViewData.snappingOptions,e=>{this._sketchViewModel&&(this._sketchViewModel.snappingOptions=e)},d),m(()=>this.view.effectiveTheme.accentColor,e=>{this._lineSymbol=new p({color:D(e,.3),width:2})},d)])}destroy(){this._invisibleLineSymbol.destroy(),this._lineSymbol?.destroy(),this._operationManager.destroy(),this._sketchViewModel?.destroy(),this._updatingHandles.destroy()}get state(){if(!this.measurementViewData.visible||!this._operationManager.currentOperationType)return`idle`;switch(this._operationManager.currentOperationType){case`place`:return`placing`;case`reshape`:return`reshaping`}}get updating(){return!this._sketchViewModel||this._sketchViewModel.updating||this._updatingHandles.updating}async place(e){return this._operationManager.start(`place`,async t=>{if(!this._sketchViewModel||!this.measurementViewData.sketchGraphicsLayer)return;let n=this._sketchViewModel.on(`create`,e=>{switch(e.state){case`active`:{let t=e.graphic?.geometry;t?.type===`polyline`&&(this.measurementViewData.analysis.geometry=t);break}case`cancel`:case`complete`:t.stop()}});t.handles.push(n,c(()=>{if(n.remove(),this._sketchViewModel?.cancel(),this.measurementViewData.sketchGraphicsLayer?.removeAll(),i(e))return t.reject();t.resolve({})})),this._sketchViewModel.polylineSymbol=this._invisibleLineSymbol,this._sketchViewModel.layer=this.measurementViewData.sketchGraphicsLayer,this._updatingHandles.addPromise(g(this._sketchViewModel.create(`polyline`)))})}async reshape(e){return this._operationManager.start(`reshape`,async t=>{if(!this._sketchViewModel)return;let n=()=>this._lineSymbol&&this._sketchViewModel&&this.measurementViewData.manipulatorGraphic&&this.measurementViewData.manipulatorGraphicsLayer?(this._sketchViewModel.polylineSymbol=this._lineSymbol,this._sketchViewModel.layer=this.measurementViewData.manipulatorGraphicsLayer,this._updatingHandles.addPromise(g(this._sketchViewModel.update(this.measurementViewData.manipulatorGraphic,{tool:`reshape`})))):Promise.resolve(),r=this._sketchViewModel.on(`update`,e=>{let r=e.graphics[0]?.geometry;this.measurementViewData.analysis.geometry=X(r)?r:null,e.state===`complete`&&(this.measurementViewData.interactive?n():t.stop())});t.handles.push(r,c(()=>{if(r.remove(),this._sketchViewModel?.cancel(),i(e))return t.reject();t.resolve()})),await n()})}};f([e()],Z.prototype,`_sketchViewModel`,void 0),f([e()],Z.prototype,`measurementViewData`,void 0),f([e()],Z.prototype,`state`,null),f([e()],Z.prototype,`updating`,null),f([e()],Z.prototype,`view`,void 0),Z=f([a(`esri.views.2d.analysis.DistanceMeasurement.DistanceMeasurementTool`)],Z);var Q=class extends j{constructor(e){super(e),this.analysis=null,this.snappingOptions=new R,this.type=`distance-measurement-view-2d`}initialize(){let{view:e}=this;this._lineVisualization=new q({view:e,measurementViewData:this}),this._controller=new G({view:e,measurementViewData:this}),this._manipulatorVisualization=new J({view:e,measurementViewData:this}),this._sketchVisualization=new Y({view:e,measurementViewData:this}),this._tool=new Z({view:e,measurementViewData:this})}destroy(){this._lineVisualization?.destroy(),this._controller?.destroy(),this._manipulatorVisualization?.destroy(),this._sketchVisualization?.destroy(),this._tool?.destroy()}get manipulatorGraphic(){return this._manipulatorVisualization?.graphic}get manipulatorGraphicsLayer(){return this._manipulatorVisualization?.graphicsLayer}get sketchGraphicsLayer(){return this._sketchVisualization?.graphicsLayer}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get result(){return this._controller?.result}get unit(){return this.analysis.unit??A(this.view)}get updating(){return(this._controller?.updating??!0)||(this._lineVisualization?.updating??!0)||(this._sketchVisualization?.updating??!0)||(this._tool?.updating??!0)}get visible(){return super.visible}set visible(e){super.visible=e}async place(e){return this._tool.place(e)}};f([e()],Q.prototype,`_lineVisualization`,void 0),f([e()],Q.prototype,`_controller`,void 0),f([e()],Q.prototype,`_manipulatorVisualization`,void 0),f([e()],Q.prototype,`_sketchVisualization`,void 0),f([e()],Q.prototype,`_tool`,void 0),f([e({constructOnly:!0})],Q.prototype,`analysis`,void 0),f([e()],Q.prototype,`manipulatorGraphic`,null),f([e()],Q.prototype,`manipulatorGraphicsLayer`,null),f([e()],Q.prototype,`sketchGraphicsLayer`,null),f([e({readOnly:!0})],Q.prototype,`result`,null),f([e({type:R,nonNullable:!0})],Q.prototype,`snappingOptions`,void 0),f([e({readOnly:!0})],Q.prototype,`type`,void 0),f([e({readOnly:!0})],Q.prototype,`unit`,null),f([e({readOnly:!0})],Q.prototype,`updating`,null),Q=f([a(`esri.views.2d.analysis.DistanceMeasurementAnalysisView2D`)],Q);var $=Q;export{$ as default};