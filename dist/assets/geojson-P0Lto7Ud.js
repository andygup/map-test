import{BT as e,jp as t,kp as n,pS as r}from"./index-CzMixifc.js";import{t as i}from"./OptimizedGeometry-5fDazGe-.js";import{n as a}from"./OptimizedFeatureSet-D4F9ObY_.js";import{f as o,l as s}from"./featureConversionUtils-VvJ2pauf.js";import{r as c}from"./date-DKxAu4UK.js";var l={LineString:`esriGeometryPolyline`,MultiLineString:`esriGeometryPolyline`,MultiPoint:`esriGeometryMultipoint`,Point:`esriGeometryPoint`,Polygon:`esriGeometryPolygon`,MultiPolygon:`esriGeometryPolygon`};function u(e){return l[e]}function*d(e){switch(e.type){case`Feature`:yield e;break;case`FeatureCollection`:for(let t of e.features)t&&(yield t)}}function*f(e){if(e)switch(e.type){case`Point`:yield e.coordinates;break;case`LineString`:case`MultiPoint`:yield*e.coordinates;break;case`MultiLineString`:case`Polygon`:for(let t of e.coordinates)yield*t;break;case`MultiPolygon`:for(let t of e.coordinates)for(let e of t)yield*e}}function*p(e,t={}){let{geometryType:n,objectIdField:r}=t;for(let i of e){let{geometry:e,properties:o,id:s}=i;if(e&&u(e.type)!==n)continue;let c=o||{},l;r&&(l=c[r],s==null||l||(c[r]=l=s)),yield new a(e&&y(e,t),c,null,l)}}function m(e){for(let t of e)if(t.length>2)return!0;return!1}function h(e){return!_(e)}function g(e){return _(e)}function _(e){let t=0;for(let n=0;n<e.length;n++){let r=e[n],i=e[(n+1)%e.length];t+=r[0]*i[1]-i[0]*r[1]}return t<=0}function v(e){let t=e[0],n=e[e.length-1];t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t)}function y(e,t){let{coordinates:n,type:r}=e,a=t.hasZ??!1;switch(r){case`Point`:return new i([],[...n],a,!1);case`LineString`:return s({paths:[n],hasZ:!0},a,!1);case`MultiLineString`:return s({paths:n,hasZ:!0},a,!1);case`MultiPoint`:return o({points:n,hasZ:!0},a,!1);case`Polygon`:case`MultiPolygon`:{let e=new i([],[],a,!1);for(let t of r===`Polygon`?[n]:n){b(e,t[0],a);for(let n=1;n<t.length;n++)x(e,t[n],a)}return e}}}function b(e,t,n){v(t),h(t)?C(e,t,n):S(e,t,n)}function x(e,t,n){v(t),g(t)?C(e,t,n):S(e,t,n)}function S(e,t,n){for(let r of t)w(e,r,n);e.lengths.push(t.length)}function C(e,t,n){for(let r=t.length-1;r>=0;r--)w(e,t[r],n);e.lengths.push(t.length)}function w(e,[t,n,r],i){e.coords.push(t,n),i&&e.coords.push(r||0)}function T(e){switch(typeof e){case`string`:return c(e)?`esriFieldTypeDate`:`esriFieldTypeString`;case`number`:return`esriFieldTypeDouble`;default:return`unknown`}}function E(t,n=4326){if(!t)throw new e(`geojson-layer:empty`,`GeoJSON data is empty`);if(t.type!==`Feature`&&t.type!==`FeatureCollection`)throw new e(`geojson-layer:unsupported-geojson-object`,`missing or not supported GeoJSON object type`,{data:t});let{crs:i}=t;if(!i)return;let a=typeof i==`string`?i:i.type===`name`?i.properties.name:i.type===`EPSG`?i.properties.code:null,o=r({wkid:n})?RegExp(`.*(CRS84H?|4326)$`,`i`):RegExp(`.*(${n})$`,`i`);if(!a||!o.test(a))throw new e(`geojson:unsupported-crs`,`unsupported GeoJSON 'crs' member`,{crs:i})}function D(e,r={}){let i=[],a=new Set,o=new Set,s,c=!1,l=null,p=!1,{geometryType:h=null}=r;for(let t of d(e)){let{geometry:e,properties:r,id:d}=t;if((!e||(h||=u(e.type),u(e.type)===h))&&(c||=m(f(e)),p||(p=d!=null,p&&(s=typeof d,r&&(l=Object.keys(r).filter(e=>r[e]===d)))),r&&l&&p&&d!=null&&(l.length>1?l=l.filter(e=>r[e]===d):l.length===1&&(l=r[l[0]]===d?l:[])),r))for(let e in r){if(a.has(e))continue;let t=T(r[e]);if(t===`unknown`){o.add(e);continue}o.delete(e),a.add(e);let s=n(e);s&&i.push({name:s,alias:e,type:t})}}let g=n(l?.length===1&&l[0]||null)??void 0;if(g){for(let e of i)if(e.name===g&&t(e)){e.type=`esriFieldTypeOID`;break}}return{fields:i,geometryType:h,hasZ:c,objectIdFieldName:g,objectIdFieldType:s,unknownFields:Array.from(o)}}function O(e,t){return Array.from(p(d(e),t))}export{u as i,O as n,D as r,E as t};