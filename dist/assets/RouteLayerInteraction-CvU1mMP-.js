import{DT as e,OT as t,UT as n,_w as r,ev as i,gD as a,nv as o,pg as s}from"./index-CzMixifc.js";import"./geodeticCurveType-B3tSXlNQ.js";import"./geodeticAreaOperator-Csb55Hyk.js";import"./geodeticLengthOperator-BOd67Z-X.js";import"./quatf64-eO7UAs9K.js";import"./earcut-CsNwSYFA.js";import"./plane--nqwMDYx.js";import"./vectorStacks-BQiry9fn.js";import"./projectPointToVector-D72S8Uh5.js";import"./spatialReferenceEllipsoidUtils-b6wDfyu0.js";import"./dehydratedPoint-CVzHYxaL.js";import"./projectVectorToVector-CZxjcyx6.js";import"./elevationInfoUtils-BcUBf70F.js";import{t as c}from"./GraphicsLayer-CSZ-X1QF.js";import"./networkEnums-B1KLygK2.js";import"./ObjectStack-DiVLRoBj.js";import"./ray-XqUMyuyU.js";import{i as l,n as u,r as d,t as f}from"./Stop-DrRRdYO-.js";import"./quantity-DI5We-W2.js";import"./geodesicUtils-DoIAZh7n.js";import{t as p}from"./SketchViewModel-Dri-bLEj.js";import"./isSupportedObject-B58JKqS1.js";import"./layerUtils-CCmUM-i4.js";import"./SketchOptions-CQ-6mB9z.js";import"./LineSnappingHint-C4TfMb_L.js";import"./ParallelSnappingHint-V0i1PzO4.js";import"./snappingUtils-BVQZFw4z.js";import"./vec3-D7a6REBc.js";import"./sphere-DkSdrT5o.js";import"./constraints-CZ12pnWC.js";import"./SnappingCandidate-CgOYxD9J.js";import"./EdgeSnappingCandidate-CRqUhTG1.js";import"./DrapedEdgeSnappingCandidate-yTm_e8W9.js";import"./IntersectionSnappingHint-GxnfNu8X.js";import"./IntersectionSnappingCandidate-CEWLdgd3.js";import"./LineSnappingCandidate-DrfbJnwY.js";import"./RightAngleTriangleSnappingCandidate-BnNMDbkx.js";import"./RightAngleSnappingHint-DDG9ajUd.js";import"./viewUtils-BjnASAVJ.js";import"./viewUtils-D2qwRYoF.js";import"./euclideanLengthMeasurementUtils-D4gy5vyI.js";import"./lineSegment-WEn1ku7V.js";import"./triangle-B4dfMIWc.js";import"./hitTestSelectUtils-B7XlogWA.js";function m(e,t){e.networkFeature=t}function h(e){let t=_(e.graphic);return{...e,networkFeature:t}}function g(e){let t=e.graphics.map(e=>_(e));return{...e,networkFeatures:t}}function _(e){return e.networkFeature}function v(e){return e?.type===`point`||e?.type===`polyline`||e?.type===`polygon`}var y=class extends r{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new c({internal:!0,listMode:`hide`}),this._sketchViewModel=new p({layer:this._graphicsLayer}),this._updatingHandles=new s,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case`update`:switch(e.state){case`active`:case`complete`:for(let t of e.graphics)_(t).geometry=v(t.geometry)?t.geometry.clone():null}break;case`undo`:case`redo`:break;case`delete`:for(let t of e.graphics){let e=_(t);this._removeNetworkFeature(e)}break;case`create`:if(e.graphic&&e.state===`complete`&&this._createMode){let t=e.graphic.geometry?.clone(),n=e.graphic.symbol?.clone();if(!t)break;switch(this._createMode){case`stop`:{if(t.type!==`point`)break;let{stops:n}=this.layer;if(n.length>0&&n.every(({geometry:e})=>!e)){n.at(0).geometry=t;break}if(n.length>1&&n.filter((e,t)=>t!==0).every(({geometry:e})=>!e)){n.at(1).geometry=t;break}let r=new f({geometry:t});n.add(r),m(e.graphic,r);break}case`point-barrier`:{if(t.type!==`point`)break;let r=new l({geometry:t,symbol:n});this.layer.pointBarriers.add(r),m(e.graphic,r);break}case`polyline-barrier`:{if(t.type!==`polyline`)break;let r=new u({geometry:t,symbol:n});this.layer.polylineBarriers.add(r),m(e.graphic,r);break}case`polygon-barrier`:{if(t.type!==`polygon`)break;let r=new d({geometry:t,symbol:n});this.layer.polygonBarriers.add(r),m(e.graphic,r);break}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,e.type===`create`?h(e):g(e))}}initialize(){this._sketchViewModel.view=this.view,this.addHandles([o(()=>this.enabled,e=>{e?this._activate():this._deactivate()},i),o(()=>{let{stops:e,pointBarriers:t,polylineBarriers:n,polygonBarriers:r}=this.layer;return{stops:e,pointBarriers:t,polylineBarriers:n,polygonBarriers:r}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on([`create`,`delete`,`redo`,`undo`,`update`],this._handleSketchViewModelEvents),n(this._updatingHandles)])}destroy(){this._graphicsLayer.removeFromParent(),this._graphicsLayer.graphics.destroyAll(),this._graphicsLayer.destroy(),this._sketchViewModel.destroy(),this._updatingHandles.destroy()}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>_(e))}get updating(){return this._updatingHandles.updating}create(e){switch(this._createMode=e,e){case`stop`:this.layer.defaultSymbols.stops?.unlocated&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case`point-barrier`:this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case`polyline-barrier`:this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case`polygon-barrier`:this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case`stop`:case`point-barrier`:return this._sketchViewModel.create(`point`);case`polyline-barrier`:return this._sketchViewModel.create(`polyline`);case`polygon-barrier`:return this._sketchViewModel.create(`polygon`)}}remove(e){let t=this._graphicsLayer.graphics.find(t=>_(t)===e);t&&this._graphicsLayer.remove(t),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){this._sketchViewModel.cancel(),this.view.map?.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){let e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(e=>e.toArray().map(e=>{let t=e.toGraphic();return t.networkFeature=e,t}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case`stop`:this.layer.stops.remove(e);break;case`point-barrier`:this.layer.pointBarriers.remove(e);break;case`polyline-barrier`:this.layer.polylineBarriers.remove(e);break;case`polygon-barrier`:this.layer.polygonBarriers.remove(e)}}};a([e()],y.prototype,`enabled`,void 0),a([e({constructOnly:!0})],y.prototype,`layer`,void 0),a([e({readOnly:!0})],y.prototype,`selectedNetworkFeatures`,null),a([e()],y.prototype,`updating`,null),a([e({constructOnly:!0})],y.prototype,`view`,void 0),y=a([t(`esri.views.2d.layers.support.RouteLayerInteraction`)],y);export{y as RouteLayerInteraction};