import{$T as e,Af as t,CE as n,_v as r,mx as i,sD as a,uf as o}from"./index-BN8X5Ryz.js";import{x as s}from"./featureConversionUtils-o9-cJXzl.js";import{t as c}from"./BoundsStore-DE7p6f_c.js";import{c as l}from"./timeSupport-vK4lVcYW.js";import{t as u}from"./optimizedFeatureQueryEngineAdapter-DQyaY_b1.js";var d=t(),f=class{constructor(e){this.geometryInfo=e,this._boundsStore=new c,this._featuresById=new Map,this._usedMemory=0,this.events=new r,this.featureAdapter=u}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach(t=>{t.geometry!=null&&t.geometry.coords&&(e+=t.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(this.fullBounds==null)return null;let[t,n,r,i]=this.fullBounds;return{xmin:t,ymin:n,xmax:r,ymax:i,spatialReference:l(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(let t of e)this._add(t);this._emitChanged()}upsertMany(e){let t=e.map(e=>this._upsert(e));return this._emitChanged(),t.filter(a)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){let t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(let t of e){let e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(let n of e){let e=this._boundsStore.get(n.objectId);e&&t(o(d,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach(t=>e(t))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,e=>{t(this._featuresById.get(e))})}_emitChanged(){this.events.emit(`changed`,void 0)}_add(t){if(!t)return;let r=t.objectId;if(r==null)return void n.getLogger(`esri.layers.graphics.data.FeatureStore`).error(new e(`featurestore:invalid-feature`,`feature id is missing`,{feature:t}));let a=this._featuresById.get(r),o;if(a?(t.displayId=a.displayId,o=this._boundsStore.get(r),this._boundsStore.delete(r),this._usedMemory-=this.estimateFeatureUsedMemory?.(a)??0):this.onFeatureAdd!=null&&this.onFeatureAdd(t),!t.geometry?.coords?.length)return this._boundsStore.set(r,null),void this._featuresById.set(r,t);o=s(o??i(),t.geometry),o!=null&&this._boundsStore.set(r,o),this._featuresById.set(r,t),this._usedMemory+=this.estimateFeatureUsedMemory?.(t)??0}_upsert(t){let r=t?.objectId;if(r==null)return n.getLogger(`esri.layers.graphics.data.FeatureStore`).error(new e(`featurestore:invalid-feature`,`feature id is missing`,{feature:t})),null;let a=this._featuresById.get(r);if(!a)return this._add(t),t;this._usedMemory-=this.estimateFeatureUsedMemory?.(a)??0;let{geometry:o,attributes:c}=t;for(let e in c)a.attributes[e]=c[e];return o&&(a.geometry=o,this._boundsStore.set(r,s(i(),o)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(a)??0,a}_remove(e){this.onFeatureRemove!=null&&this.onFeatureRemove(e);let t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}};export{f as t};