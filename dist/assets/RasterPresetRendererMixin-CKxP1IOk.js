import{BT as e,Du as t,Eu as n,Ex as r,GT as i,Lx as a,Tu as o,VT as s,ZS as c,_E as l,ha as u,iw as d,kD as f,kw as p,vx as m}from"./index-BN8X5Ryz.js";import{E as h,T as g}from"./RasterSymbolizer-C04g1f48.js";import{c as _,s as v}from"./RasterJobHandlerMixin-v7ic83Yl.js";async function y(e,i,s){let l=o(e),{rasterFunction:d,sourceJSON:f}=i||{},p=d?JSON.stringify(d.rasterFunctionDefinition||d):null,_=t({...l.query,renderingRule:p,f:`json`}),v=n(_,s);e=l.path;let y=f||await c(e,v).then(e=>e.data),b=y.hasRasterAttributeTable?c(`${e}/rasterAttributeTable`,v):null,x=y.hasColormap?c(`${e}/colormap`,v):null,S=y.hasHistograms?c(`${e}/histograms`,v):null,C=y.currentVersion>=10.3?c(`${e}/keyProperties`,v):null,w=y.hasMultidimensions?c(`${e}/multidimensionalInfo`,v):null,T=await Promise.allSettled([b,x,S,C,w]),E=null;if(y.minValues&&y.minValues.length===y.bandCount){E=[];for(let e=0;e<y.minValues.length;e++)E.push({min:y.minValues[e],max:y.maxValues[e],avg:y.meanValues[e],stddev:y.stdvValues[e]})}let D=m.fromJSON(y.extent),O=Math.ceil(D.width/y.pixelSizeX-.1),k=Math.ceil(D.height/y.pixelSizeY-.1),A=a.fromJSON(y.spatialReference||y.extent.spatialReference),j=T[0].status===`fulfilled`?T[0].value?.data:null,M=j?.features?.length?u.fromJSON(j):null,N=T[1].status===`fulfilled`?T[1].value?.data.colormap:null,P=N?.length?N:null,F=T[2].status===`fulfilled`?T[2].value?.data.histograms:null,I=F?.[0]?.counts?.length?F:null,L=T[3].status===`fulfilled`?T[3].value?.data??{}:{},R=T[4].status===`fulfilled`?T[4].value?.data.multidimensionalInfo:null,z=R?.variables?.length?R:null;z&&z.variables.forEach(e=>{e.statistics?.length&&e.statistics.forEach(e=>{e.avg=e.mean,e.stddev=e.standardDeviation}),e.dimensions?.forEach(e=>{e.name!==`StdTime`||e.recurring||e.unit||(e.unit=`ISO8601`)})});let{defaultVariable:B,serviceDataType:V}=y;B&&B!==L.DefaultVariable&&(L.DefaultVariable=B),V?.includes(`esriImageServiceDataTypeVector`)&&!V.includes(L.DataType)&&(L.DataType=V.replace(`esriImageServiceDataType`,``));let H=y.noDataValue;y.noDataValues?.length&&y.noDataValues.some(e=>e!==H)&&(H=y.noDataValues);let U=y.transposeInfo?new h({blockWidth:256,blockHeight:256,pyramidBlockWidth:256,pyramidBlockHeight:256,pyramidScalingFactor:2,compression:`lerc`,origin:new r({x:y.extent.xmin,y:y.extent.ymax,spatialReference:A}),firstPyramidLevel:1,maximumPyramidLevel:Math.max(0,Math.round(Math.log(Math.max(O,k))/Math.LN2-8)),transposeInfo:y.transposeInfo}):void 0;return new g({width:O,height:k,bandCount:y.bandCount,extent:m.fromJSON(y.extent),spatialReference:A,pixelSize:new r({x:y.pixelSizeX,y:y.pixelSizeY,spatialReference:A}),pixelType:y.pixelType.toLowerCase(),statistics:E,attributeTable:M,colormap:P,histograms:I,keyProperties:L,noDataValue:H,multidimensionalInfo:z,storageInfo:U})}function b(e,t,n){return y(e,{sourceJSON:t},n)}function x(e,t,n){return y(e,{rasterFunction:t},n)}function S(e,t){e.attributeTable||(t.hasRasterAttributeTable=!1),e.histograms||(t.hasHistograms=!1),e.colormap||(t.hasColormap=!1),e.multidimensionalInfo||(t.hasMultidimensions=!1)}var C=class extends p(d){constructor(e){super(e),this.name=void 0,this.method=`none`,this.value=void 0,this.bandIds=void 0,this.renderer=void 0}};f([e({type:String,json:{write:{isRequired:!0}}})],C.prototype,`name`,void 0),f([e({type:[`raster-function-template`,`variable`,`none`],json:{write:{isRequired:!0}}}),i({rasterFunctionTemplate:`raster-function-template`,variable:`variable`,none:`none`})],C.prototype,`method`,void 0),f([e({type:String,json:{write:{isRequired:!0}}})],C.prototype,`value`,void 0),f([e({type:[l],json:{write:{isRequired:!0}}})],C.prototype,`bandIds`,void 0),f([e({types:v,json:{write:!0,origins:{"web-scene":{types:_,write:{overridePolicy:e=>({enabled:e&&e.type!==`vector-field`})}}}}})],C.prototype,`renderer`,void 0),C=f([s(`esri.renderers.support.RasterPresetRenderer`)],C);var w=t=>{let n=t,r=class extends n{constructor(){super(...arguments),this.activePresetRendererName=null,this.presetRenderers=null}};return f([e({type:String,json:{name:`layerDefinition.activePresetRendererName`,write:{allowNull:!0}}})],r.prototype,`activePresetRendererName`,void 0),f([e({type:[C],json:{name:`layerDefinition.presetRenderers`,write:!0}})],r.prototype,`presetRenderers`,void 0),r=f([s(`esri.layers.mixins.RasterPresetRendererMixin`)],r),r};export{x as i,S as n,b as r,w as t};