import{X as e,cn as t,dn as n,in as r,kt as i,ln as a,st as o}from"./Point2D-BslC4Gs9.js";import{t as s}from"./Envelope2D-n2TB2v9l.js";import{$t as c,Gt as l,In as u,Kt as d,N as f,en as p,ft as m,l as h,un as g,yn as _}from"./SpatialReference-Cd_hfGxp.js";function v(){return{m_pGcs:new i,m_xyz:new u,m_factor:NaN,m_geoLength:NaN,setValues:y,setLength:b,assign:x}}function y(e,t,n,r){this.m_factor=e,this.m_pGcs.assign(t),this.m_xyz.assign(r),this.m_geoLength=n}function b(e){this.m_geoLength=e}function x(e){this.m_pGcs.assign(e.m_pGcs),this.m_xyz.assign(e.m_xyz),this.m_factor=e.m_factor,this.m_geoLength=e.m_geoLength}var S=class{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,r,i){if(e.hasNonLinearSegments()&&(e=new c().execute(e,0,t.getTolerance(0),0,i)),t.isPannable()){let r=90,a=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(r*=Math.PI/180,a*=Math.PI/180),t.getCoordinateSystemType()===2){let e=null,n=[0,0,0,0];e=t.getPECoordSys(),n[0]=0,n[1]=r,n[2]=0,n[3]=a,l.geogToProj(e,2,n),r=n[1],a=n[3]}let o=new s;e.queryEnvelope(o),o.ymin=a,o.ymax=r,e=new p().execute(e,o,t,i)}else{let n=t.getPCSHorizon();(e=new d().execute(e,n,t,i))===n&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,r,1,i)}_ExecuteIterativeApproach(t,n,r,s,c,d){let f=h();r.querySpheroidData(f);let p=f.majorSemiAxis,m=f.e2,g=r.getUnit().getUnitToBaseFactor(),_=e(v,40),y=o(40,NaN),b=v(),x=v(),S,T=[0,0,0,0],E=n.getPECoordSys(),D=new i,O=new i,k=new i,A=new i,j=new i,M=0,N=t.querySegmentIterator();for(;N.nextPath();)for(;N.hasNextSegment();){let e=N.nextSegment();D.assign(e.getStartXY()),O.assign(e.getEndXY()),n.getCoordinateSystemType()===2?(T[0]=D.x,T[1]=D.y,T[2]=O.x,T[3]=O.y,l.projToGeog(E,2,T),k.x=T[0]*g,k.y=T[1]*g,A.x=T[2]*g,A.y=T[3]*g):(k.setCoordsPoint2D(D),A.setCoordsPoint2D(O),k.scale(g),A.scale(g));let t=new u,r=new u;C(p,m,k,t),C(p,m,A,r);let i=w(p,t,r);b.setValues(0,k,NaN,t),x.setValues(1,A,i,r),S=c,_[0].assign(x),y[0]=c;let o=0;for(;;){o>128&&a(`iterations exceeded`);let t=.5*(b.m_factor+x.m_factor),r=e.getCoord2D(t);n.getCoordinateSystemType()===2?(T[0]=r.x,T[1]=r.y,l.projToGeog(E,1,T),j.x=T[0]*g,j.y=T[1]*g):(j.setCoordsPoint2D(r),j.scale(g)),k.setCoordsPoint2D(b.m_pGcs),A.setCoordsPoint2D(x.m_pGcs);let s=new u;C(p,m,j,s);let d=w(p,b.m_xyz,s),f=w(p,x.m_xyz,s);i=x.m_geoLength,Number.isNaN(i)&&(i=w(p,b.m_xyz,x.m_xyz));let h=d+f,v=S===c&&h>=20&&Math.abs(h-i)>1e-8*(i+h);if(o+2<40&&(v||Math.abs(h-i)>0&&S>0))x.setLength(f),_[o].assign(x),x.setValues(t,j,d,s),_[++o].assign(x),v?(S=c,y[o]=c):(S--,y[o-1]=S,y[o]=S);else{if(M+=h,o===0)break;b.assign(x),x.assign(_[--o]),S=y[o]}}}return M}execute(e,i,a){if(i&&i.getCoordinateSystemType()!==0||r(``),e.isEmpty()||e.getDimension()<1)return 0;let o=null,s=i.getGCS();s!==i&&(o=f(i,s,null));let c=e.getGeometryType();if(c===t.enumEnvelope){let t=new _;return t.addEnvelope(e,!1),this._ExecuteShapePreservingLength(t,i,s,o,a)}if(n(c)){let t=new g;return t.addSegment(e,!0),this._ExecuteShapePreservingLength(t,i,s,o,a)}return this._ExecuteShapePreservingLength(e,i,s,o,a)}};function C(e,t,n,r){r.assign(m(e,t,n))}function w(e,t,n){let r=e,i=new u;i.setSub(t,n);let a=i.length();return 2*r*Math.asin(a/(2*r))}export{S as t};