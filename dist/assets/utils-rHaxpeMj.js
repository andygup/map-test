import{BT as e,Fa as t,Fh as n,Ih as r,Na as i,Ra as a}from"./index-ByaFsVj4.js";import{t as o}from"./originUtils-BJaUzj5W.js";import{r as s}from"./saveUtils-BB0-rUbr.js";function c(t,n,r){let i=r(t);if(!i.isValid)throw new e(`${n}:invalid-parameters`,i.errorMessage,{layer:t})}async function l(e){let{layer:t,errorNamePrefix:n,validateLayer:r}=e;await t.load(),c(t,n,r)}function u(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function d(t){let{item:n,errorNamePrefix:r,layer:i,validateItem:a}=t;if(f(t),a){let t=a(n);if(!t.isValid)throw new e(`${r}:invalid-parameters`,t.errorMessage,{layer:i})}}function f(t){let{item:n,itemType:r,additionalItemType:i,errorNamePrefix:a,layer:o}=t,s=[r];if(i&&s.push(i),!s.includes(n.type)){let t=s.map(e=>`'${e}'`).join(`, `);throw new e(`${a}:portal-item-wrong-type`,`Portal item type should be one of: "${t}"`,{item:n,layer:o})}}function p(t){let{layer:n,errorNamePrefix:r}=t,{portalItem:i}=n;if(!i)throw new e(`${r}:portal-item-not-set`,u(n,`requires the portalItem property to be set`));if(!i.loaded)throw new e(`${r}:portal-item-not-loaded`,u(n,`cannot be saved to a portal item that does not exist or is inaccessible`));d({...t,item:i})}function m(e){let{newItem:t,itemType:i}=e,a=n.from(t);return a.id&&=(a=a.clone(),null),a.type??=i,a.portal??=r.getDefault(),d({...e,item:a}),a}function h(e){return i(e,`portal-item`)}async function g(e,t,n){`beforeSave`in e&&typeof e.beforeSave==`function`&&await e.beforeSave();let r=e.write({},t);return await Promise.all(t.resources?.pendingOperations??[]),s(t,{errorName:`layer-write:unsupported`},n),r}function _(e){a(e,t.JSAPI),e.typeKeywords&&=e.typeKeywords.filter((e,t,n)=>n.indexOf(e)===t)}async function v(e,t,n){let r=e.portal;await r.signIn(),await r.user.addItem({item:e,data:t,folder:n?.folder})}async function y(e,t){let{layer:n,createItemData:r,createJSONContext:i,setItemProperties:a,saveResources:s,supplementalUnsupportedErrors:c}=e;await l(e),p(e);let u=n.portalItem,d=i?i(u):h(u),f=await g(n,d,{...t,supplementalUnsupportedErrors:c}),m=await r({layer:n,layerJSON:f},u);return await a?.(n,u,m),_(u),await u.update({data:m}),o(d),await s?.(u,d),u}async function b(e,t){let{layer:n,createItemData:r,createJSONContext:i,setItemProperties:a,saveResources:s,supplementalUnsupportedErrors:c}=e;await l(e);let u=m(e),d=i?i(u):h(u),f=await g(n,d,{...t,supplementalUnsupportedErrors:c}),p=await r({layer:n,layerJSON:f},u);return await a(n,u,p),_(u),await v(u,p,t),n.portalItem=u,o(d),await s?.(u,d),u}export{y as n,b as t};