import{BT as e,DT as t,Gi as n,Ki as r,OT as i,Qp as a,WT as o,XT as s,gD as c,ha as l,nv as u}from"./index-CZ4oMP1N.js";import"./memoryEstimations-DQOvnrRz.js";import"./OptimizedGeometry-hOUTi-cB.js";import"./OptimizedFeatureSet-CTIqq8fn.js";import"./featureConversionUtils-_DSSMFQ2.js";import"./streamLayerUtils-82UmlW-3.js";import"./QueueProcessor-BtMHt_WC.js";import"./urlUtils-BholpLvl.js";import"./bundle-BeTxitUr.js";import"./earcut-BF1-mB58.js";import"./featurePopupQueryUtils-BIpfiKXw.js";import"./layerViewUtils-RSw-QNoB.js";import"./popupUtils-Bb88Y0DD.js";import"./pbf-wXxPPz7x.js";import"./pbfQueryUtils-q4mcHKpQ.js";import"./queryUtils-D1dUonfL.js";import"./query-C5yhs-oW.js";import"./tagSymbols-CazaFvX8.js";import"./constants-hGT2UJiZ.js";import"./queryUtils-DcyDFw5_.js";import"./FixedIntervalBinParameters-Dvwocz3j.js";import"./floorFilterUtils-TMZ7AjwL.js";import"./locationUtils-DHi0m037.js";import"./parquetUtils-yufJTvRq.js";import"./parquet-Z-9I3S-h.js";import"./GeometryUtils-Dmca5Xm4.js";import"./VertexAttributeLocations-CfzeuYMz.js";import"./VertexElementDescriptor-ju-1bdWe.js";import"./AttributeBinsFeatureSet-D0PNU62h.js";import"./labelPoint-vGsL2GFc.js";import"./FeatureMetadata-i54qdN5K.js";import"./AttributeBinsQuery-BT2fajrO.js";import"./CIMSymbolHelper-l5sn5wJj.js";import"./rasterizingUtils-CKtfcOpu.js";import"./Rect-BhUrWpQm.js";import"./BoundingBox-CLkiiRfJ.js";import"./BidiEngine-BrFXRv7y.js";import"./FeatureCommandQueue-CjFmAvd1.js";import"./config-BSvujflG.js";import"./WGLContainer-D_aBMsnu.js";import"./utils-DS5dbHj4.js";import"./ProgramTemplate-BXau1qoF.js";import"./VertexArrayObject-DEfjd5y-.js";import"./BufferObject-q8zuTMny.js";import"./VertexBuffer-xVpphTb4.js";import"./vec3f32-B2H3-fiA.js";import"./Container-BuEih3Ua.js";import"./GraphShaderModule-D5RCsL2_.js";import"./FramebufferObject-BhBPSr-C.js";import"./ShaderBuilder-D3cV1oap.js";import"./LayerView2D-BsKgTWnO.js";import{t as d}from"./LayerView-2jeNRFkG.js";import"./RefreshableLayerView-CXmtIjA5.js";import{r as f,t as p}from"./FeatureLayerView2D-C6knFFc9.js";import"./timeSupport-CpSaGF8C.js";import"./UpdateTracking2D-BiwypiBP.js";import"./TechniqueInstance-B37K-FPt.js";import"./TileContainer-B6yQthEI.js";import"./constants-BuH6TGxi.js";import"./utils-Czjlo_U1.js";import"./CircularArray-CE2T6ZES.js";import"./FeatureIdInfo-t7CytnF0.js";import"./SDFHelper-Cc3DUmXZ.js";import"./highlightOptionsUtils-C8mtOR7S.js";import{t as m}from"./HighlightLayerViewMixin-Ck9bRH3l.js";var h=e=>{let a=m(e),o=class extends a{resume(){this._isUserPaused=!1,this.suspended||this._doResume()}pause(){this._isUserPaused=!0,this.suspended||this._doPause()}disconnect(){this._doDisconnect()}connect(){this._doConnect()}clear(){this._doClear()}constructor(...e){super(...e),this._isUserPaused=!1,this.filter=null}get connectionStatus(){return(this._isUserPaused||this.suspended)&&this._streamConnectionStatus===`connected`?`paused`:this._streamConnectionStatus}_onSuspendedChange(e){e?this._doPause():this._isUserPaused||this._doResume()}};return c([t()],o.prototype,`_isUserPaused`,void 0),c([t({type:n})],o.prototype,`featureEffect`,void 0),c([t({readOnly:!0})],o.prototype,`connectionStatus`,null),c([t({type:r})],o.prototype,`filter`,void 0),o=c([i(`esri.views.layers.StreamLayerView`)],o),o};h(d);var g=class extends h(p){constructor(){super(...arguments),this.pipelineConnectionStatus=`disconnected`,this.pipelineErrorString=null}initialize(){this.addHandles([u(()=>this.layer.customParameters,async e=>{(await this.getWorker()).streamMessenger.updateCustomParameters(e)}),this.layer.on(`send-message-to-socket`,async e=>{(await this.getWorker()).streamMessenger.sendMessageToSocket(e)}),this.layer.on(`send-message-to-client`,async e=>{(await this.getWorker()).streamMessenger.sendMessageToClient(e),this._isUserPaused&&`type`in e&&e.type===`clear`&&this.incrementSourceRefreshVersion()}),u(()=>this.layer.purgeOptions,()=>this._update()),u(()=>this.suspended,this._onSuspendedChange.bind(this))],`constructor`),this._doResume()}destroy(){this._doPause()}get connectionError(){return this.pipelineErrorString?new e(`stream-controller`,this.pipelineErrorString):null}on(e,t){if(Array.isArray(e))return s(e.map(e=>this.on(e,t)));let n=[`data-received`,`message-received`].includes(e);n&&this.getWorker().then(t=>t.streamMessenger.enableEvent(e,!0));let r=super.on(e,t),i=this;return o(()=>{r.remove(),n&&(i._workerProxy.closed||i.hasEventListener(e)||i.getWorker().then(t=>t.streamMessenger.enableEvent(e,!1)))})}async queryLatestObservations(t,n){if(!(this.layer.timeInfo?.endField||this.layer.timeInfo?.startField||this.layer.timeInfo?.trackIdField))throw new e(`streamlayer-no-timeField`,`queryLatestObservation can only be used with services that define a TrackIdField`);let r=await this.getWorker();return f(r.features.executeQueryForLatestObservations(this._cleanUpQuery(t),n).then(e=>{let t=l.fromJSON(e);return t.features.forEach(e=>{e.layer=this.layer,e.sourceLayer=this.layer,e.origin=this.layer.graphicOrigin}),t}),new l({features:[]}))}detach(){super.detach(),this.pipelineConnectionStatus=`disconnected`}async queryObjectIds(e,t){return(await super.queryObjectIds(e,t)).filter(a)}get _streamConnectionStatus(){return this.pipelineConnectionStatus}_doPause(){this._refreshInterval!=null&&(clearInterval(this._refreshInterval),this._refreshInterval=null)}_doResume(){this._refreshInterval??=setInterval(()=>this.incrementSourceRefreshVersion(),this.layer.updateInterval)}_doDisconnect(){this.getWorker().then(e=>e.streamMessenger.disconnect()),this._doPause()}_doConnect(){this.getWorker().then(e=>e.streamMessenger.connect()),this.resume()}_doClear(){this.getWorker().then(e=>e.streamMessenger.clear()),this._refreshInterval??this.incrementSourceRefreshVersion()}_createClientOptions(){let e=super._createClientOptions(),t=this;return{...e,get container(){return t.featureContainer},setProperty:e=>{this.set(e.propertyName,e.value)}}}};c([t()],g.prototype,`pipelineConnectionStatus`,void 0),c([t()],g.prototype,`pipelineErrorString`,void 0),c([t({readOnly:!0})],g.prototype,`connectionError`,null),c([t({readOnly:!0})],g.prototype,`_streamConnectionStatus`,null),g=c([i(`esri.views.2d.layers.StreamLayerView2D`)],g);var _=g;export{_ as default};