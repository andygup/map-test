import{$p as e,Qp as t,Sn as n,Xp as r,Zp as i,fD as a,tm as o,uE as s,wn as c,wx as l}from"./index-CZ4oMP1N.js";import{n as u,t as d}from"./arcadeEnvironment-dH-3dXN2.js";import"./ImmutableArray-C3KNQCVd.js";import{A as f,C as p,D as m,G as h,Q as ee,T as g,U as te,X as _,at as v,b as y,ct as b,ft as x,g as S,gt as ne,ht as C,k as w,m as T,mt as re,nt as E,pt as D,s as O,t as k,x as ie,z as A}from"./Dictionary-ByWMrwnf.js";import"./shared-CBxUlSgW.js";import"./number-bp6QQFrm.js";import{n as ae}from"./Feature-BfVJqHKS.js";import"./memoryEstimations-DQOvnrRz.js";import"./OptimizedGeometry-hOUTi-cB.js";import"./OptimizedFeatureSet-CTIqq8fn.js";import"./featureConversionUtils-_DSSMFQ2.js";import{a as oe,b as se,c as ce,h as le,i as ue,l as de,o as fe,r as pe,s as me,t as he,v as ge,x as j,y as _e}from"./track-443DPZkO.js";import{a as ve,i as M,n as ye,o as be,r as xe}from"./containerUtils-CNnsTsDa.js";import{n as Se}from"./aiServices-6rsb7Tmq.js";import"./commonProperties-CaHgSHvW.js";import"./WhereClause-CO9FHcAq.js";import"./streamLayerUtils-82UmlW-3.js";import"./measures-CvGGokgB.js";import"./functions-CNuMQhsa.js";import"./fieldStats-B5F0iEW-.js";import"./ArcadePortal-CDC0x4Mh.js";import"./Attachment-BMWxhZED.js";import"./portalUtils-zhbwePYw.js";import"./operatorsWorkerConnection-CuQJvT6f.js";import{t as Ce}from"./geomasync-OC-9FBV9.js";var N=()=>s.getLogger(`esri.arcade.arcadeAsyncRuntime`),P=Symbol(`uninitialized`);function F(e){if(e===P)throw new c(null,`InvalidIdentifier`,null)}function I(e){return F(e),e}function L(e,t){let n=d(t);if(e.localScope!==null){let t=e.localScope[n];if(t!==void 0)return{scope:e.localScope,id:n,var:t}}let r=e.globalScope[n];if(r!==void 0)return{scope:e.globalScope,id:n,var:r};throw new c(e,`InvalidIdentifier`,t)}function R(e,t,n=`InvalidIdentifier`){let r=d(t);if(e.localScope!==null){let t=e.localScope[r];if(t!==void 0)return F(t),t.value}let i=e.globalScope[r];if(i!==void 0)return F(i),i.value;throw new c(e,n,t)}var z=function(){};async function B(e,t){let n=[];for(let r=0;r<t.arguments.length;r++)n.push(await G(e,t.arguments[r]));return n}async function V(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await B(e,t))}z.prototype=Object.freeze(Object.create(null));var we=class extends re{constructor(e,t,n,r){super(),this.definition=e,this.context=t,this._params=n,this._locals=r}createFunction(e){return(...t)=>{let n={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,services:this.context.services,abortSignal:this.context.abortSignal,localScope:new z,depthCounter:{depth:e.depthCounter.depth+1},globalScope:this.context.globalScope,track:this.context.track};if(n.depthCounter.depth>64)throw new c(e,`MaximumCallDepth`,null);return H(n,this.definition.body,this._params,this._locals,t,null)}}call(e,t){return W(e,t,(n,r,i)=>{let a={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:new z,abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1},track:e.track};if(a.depthCounter.depth>64)throw new c(e,`MaximumCallDepth`,t);return H(a,this.definition.body,this._params,this._locals,i,t)})}marshalledCall(e,t,n,r){return r(e,t,async(i,a,o)=>{let s={spatialReference:e.spatialReference,services:e.services,globalScope:n.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:new z,track:e.track};return o=o.map(t=>!y(t)||t instanceof C?t:D(t,e,r)),D(await H(s,this.definition.body,this._params,this._locals,o,t),n,r)})}};async function H(e,t,n,r,i,a){if(n.length!==i.length)throw new c(e,`WrongNumberOfParameters`,a);if(e.localScope!=null){for(let t=0;t<n.length;t++)e.localScope[n[t]]={value:i[t]};for(let t of r)e.localScope[t]=P}let o=await K(e,t);if(o instanceof m)return o.value;if(o===A||o===S)throw new c(e,`UnexpectedToken`,a);return o instanceof v?o.value:o}var U=class e extends ne{constructor(e){super(),this.moduleGlobalContext=e}global(e){let t=d(e);if(this.moduleGlobalContext.exports.has(t))throw new c(null,`ModuleExportNotFound`,null);let n=this.moduleGlobalContext.globalScope[t];if(F(n),y(n.value)&&!(n.value instanceof C)){let e=new C;return e.fn=n.value,e.parameterEvaluator=V,e.context=this.moduleGlobalContext,this.moduleGlobalContext.globalScope[t]={value:e},e}return n.value}setGlobal(e,t){if(y(t))throw new c(null,`AssignModuleFunction`,null);let n=d(e);if(this.moduleGlobalContext.exports.has(n))throw new c(null,`ModuleExportNotFound`,null);this.moduleGlobalContext.globalScope[n]={value:t}}hasGlobal(e){return this.moduleGlobalContext.exports.has(d(e))}static async load(t,n){let{globals:r,exports:i}=se(n),a=new Z;for(let e of r)e in a||(a[e]=P);let o=t.spatialReference??l.WebMercator,s={lrucache:t.lrucache,interceptor:t.interceptor,services:t.services,console:t.console??ut,abortSignal:t.abortSignal??u,timeZone:t.timeZone??null,spatialReference:o,track:null,depthCounter:{depth:1},libraryResolver:new j(t.libraryResolver._moduleSingletons,n.loadedModules),exports:i,localScope:null,globalScope:a};return await Y(s,n),new e(s)}};async function W(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await B(e,t))}async function G(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case`UpdateExpression`:return await Pe(e,t);case`AssignmentExpression`:return await Fe(e,t);case`TemplateLiteral`:return await nt(e,t);case`Identifier`:return X(e,t);case`MemberExpression`:return await Ge(e,t);case`Literal`:return t.value;case`CallExpression`:return await et(e,t);case`UnaryExpression`:return await Xe(e,t);case`BinaryExpression`:return await Qe(e,t);case`LogicalExpression`:return await $e(e,t);case`ArrayExpression`:return await Ze(e,t);case`ObjectExpression`:return await Te(e,t);case`MemberAccessChainExpression`:return await Ye(e,t);case`SafeMemberExpression`:throw N().error(`SafeMemberExpression outside of MemberAccessChainExpression`),new c(null,`Unrecognized`,t);default:throw a(t),new c(e,`Unrecognized`,t)}}catch(r){throw n(e,t,r)}}async function K(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case`ImportDeclaration`:return await Ve(e,t);case`ExportNamedDeclaration`:return await He(e,t);case`VariableDeclaration`:return await Ue(e,t);case`BlockStatement`:return await Y(e,t);case`FunctionDeclaration`:return await Be(e,t);case`ReturnStatement`:return await ze(e,t);case`IfStatement`:return await Le(e,t);case`ExpressionStatement`:return await Ie(e,t);case`ForStatement`:return await De(e,t);case`WhileStatement`:return await Ee(e,t);case`ForInStatement`:return await Me(e,t);case`ForOfStatement`:return await Ne(e,t);case`BreakStatement`:return A;case`EmptyStatement`:return p;case`ContinueStatement`:return S;default:throw a(t),new c(e,`Unrecognized`,t)}}catch(r){throw n(e,t,r)}}async function Te(e,t){let n=[];for(let r=0;r<t.properties.length;r++){let i=t.properties[r],a=await G(e,i.value);n[r]={key:i.key.type===`Identifier`?i.key.name:await G(e,i.key),value:a}}let i=Object.create(null),a=new Map;for(let o=0;o<n.length;o++){let s=n[o];if(y(s.value))throw new c(e,`NoFunctionInDictionary`,t);if(!1===r(s.key))throw new c(e,`KeyMustBeString`,t);let l=s.key.toString(),u=l.toLowerCase();a.has(u)?l=a.get(u):a.set(u,l),s.value===p?i[l]=null:i[l]=s.value}let o=new k(i);return o.immutable=!1,o}async function Ee(e,t){let n=await G(e,t.test);if(!1===n)return p;if(!0!==n)throw new c(e,`BooleanConditionRequired`,t);for(;!0===n;){let r=await K(e,t.body);if(r===A)break;if(r instanceof m)return r;if(n=await G(e,t.test),!0!==n&&!1!==n)throw new c(e,`BooleanConditionRequired`,t)}return p}async function De(e,t){try{for(t.init!==null&&(t.init.type===`VariableDeclaration`?await K(e,t.init):await G(e,t.init));;){if(t.test!==null){let n=await G(e,t.test);if(!0===e.abortSignal?.aborted)throw new c(e,`Cancelled`,t);if(!1===n)break;if(!0!==n)throw new c(e,`BooleanConditionRequired`,t)}let n=await K(e,t.body);if(n===A)break;if(n instanceof m)return n;t.update!==null&&await G(e,t.update)}return p}catch(e){throw e}}async function q(e,t,n,r,i=`i`){let a=n.length;for(let o=0;o<a;o++){if(i===`k`){if(o>=n.length)throw new c(e,`OutOfBounds`,t);r.scope[r.id]={value:n[o]}}else r.scope[r.id]={value:o};let a=await K(e,t.body);if(a===A)break;if(a instanceof m)return a}return p}async function Oe(e,t,n,r,i=`i`){let a=n.length();for(let o=0;o<a;o++){r.scope[r.id]=i===`k`?{value:n.get(o)}:{value:o};let a=await K(e,t.body);if(a===A)break;if(a instanceof m)return a}return p}async function ke(e,t,n,r){e:for await(let i of await n.queryAll(e.abortSignal))for(let a of i){r.scope[r.id]={value:ae.createFromGraphicLikeObject(a.geometry,a.attributes,n,e.timeZone)};let i=await K(e,t.body);if(i===A)break e;if(i instanceof m)return i}return p}async function Ae(e,t,n,r){for(let i of n.keys()){let a=n.field(i);r.scope[r.id]={value:k.containerEntry(i,a)};let o=await K(e,t.body);if(o===A)break;if(o instanceof m)return o}return p}async function je(e,t,n,r){for(let i of M(n)){let a=be(n,i,e,t);r.scope[r.id]={value:k.containerEntry(i,a)};let o=await K(e,t.body);if(o===A)break;if(o instanceof m)return o}return p}async function Me(t,n){let i=await G(t,n.right);n.left.type===`VariableDeclaration`&&await K(t,n.left);let a=L(t,n.left.type===`VariableDeclaration`?n.left.declarations[0].id:n.left);return e(i)||r(i)?await q(t,n,i,a):E(i)?await Oe(t,n,i,a):i instanceof k||g(i)?await q(t,n,i.keys(),a,`k`):O(i)?await ke(t,n,i,a):f(i)?await q(t,n,M(i),a,`k`):p}async function Ne(t,n){let i=await G(t,n.right);n.left.type===`VariableDeclaration`&&await K(t,n.left);let a=L(t,n.left.type===`VariableDeclaration`?n.left.declarations[0].id:n.left);return e(i)||r(i)?await q(t,n,i,a,`k`):E(i)?await Oe(t,n,i,a,`k`):i instanceof k||g(i)?await Ae(t,n,i,a):O(i)?await ke(t,n,i,a):f(i)?await je(t,n,i,a):p}async function Pe(n,i){let a=i.argument;if(a.type===`CallExpression`)throw new c(n,`NeverReach`,i);if(a.type===`MemberExpression`){let o=await G(n,a.object),s,l;if(!0===a.computed)s=await G(n,a.property);else{if(a.property.type!==`Identifier`)throw new c(n,`Unrecognized`,i);s=a.property.name}if(e(o)){if(!t(s))throw new c(n,`ArrayAccessMustBeNumber`,i);if(s<0&&(s=o.length+s),s<0||s>=o.length)throw new c(n,`OutOfBounds`,i);l=w(o[s]),o[s]=i.operator===`++`?l+1:l-1}else if(o instanceof k){if(!1===r(s))throw new c(n,`KeyAccessorMustBeString`,i);if(!0!==o.hasField(s))throw new c(n,`FieldNotFound`,i,{key:s});l=w(o.field(s)),o.setField(s,i.operator===`++`?l+1:l-1)}else if(o instanceof U){if(!1===r(s))throw new c(n,`ModuleAccessorMustBeString`,i);if(!0!==o.hasGlobal(s))throw new c(n,`ModuleExportNotFound`,i);l=w(o.global(s)),o.setGlobal(s,i.operator===`++`?l+1:l-1)}else{if(!T(o))throw E(o)?new c(n,`Immutable`,i):new c(n,`InvalidParameter`,i);if(!1===r(s))throw new c(n,`KeyAccessorMustBeString`,i);if(!0!==o.hasField(s))throw new c(n,`FieldNotFound`,i,{key:s});l=w(o.field(s)),o.setField(s,i.operator===`++`?l+1:l-1)}return!1===i.prefix?l:i.operator===`++`?l+1:l-1}let o=L(n,a),s=w(I(o.var).value),l=i.operator===`++`?s+1:s-1;return o.scope[o.id]={value:l},!1===i.prefix?s:i.operator===`++`?s+1:s-1}function J(e,t,n,i,a){switch(t){case`=`:return e===p?null:e;case`/=`:return w(n)/w(e);case`*=`:return w(n)*w(e);case`-=`:return w(n)-w(e);case`+=`:return r(n)||r(e)?h(n)+h(e):w(n)+w(e);case`%=`:return w(n)%w(e);default:throw new c(a,`UnsupportedOperator`,i)}}async function Fe(n,i){let a=i.left;if(a.type===`MemberExpression`){let o=await G(n,a.object),s;if(!0===a.computed)s=await G(n,a.property);else{if(a.property.type!==`Identifier`)throw new c(n,`InvalidIdentifier`,i);s=a.property.name}let l=await G(n,i.right);if(e(o)){if(!t(s))throw new c(n,`ArrayAccessMustBeNumber`,i);if(s<0&&(s=o.length+s),s<0||s>o.length)throw new c(n,`OutOfBounds`,i);if(s===o.length){if(i.operator!==`=`)throw new c(n,`OutOfBounds`,i);o[s]=J(l,i.operator,o[s],i,n)}else o[s]=J(l,i.operator,o[s],i,n)}else if(o instanceof k){if(!1===r(s))throw new c(n,`KeyAccessorMustBeString`,i);if(!0===o.hasField(s))o.setField(s,J(l,i.operator,o.field(s),i,n));else{if(i.operator!==`=`)throw new c(n,`FieldNotFound`,i,{key:s});o.setField(s,J(l,i.operator,null,i,n))}}else if(o instanceof U){if(!1===r(s))throw new c(n,`KeyAccessorMustBeString`,i);if(!0!==o.hasGlobal(s))throw new c(n,`ModuleExportNotFound`,i);o.setGlobal(s,J(l,i.operator,o.global(s),i,n))}else{if(!T(o))throw E(o)?new c(n,`Immutable`,i):new c(n,`InvalidParameter`,i);if(!1===r(s))throw new c(n,`KeyAccessorMustBeString`,i);if(!0===o.hasField(s))o.setField(s,J(l,i.operator,o.field(s),i,n));else{if(i.operator!==`=`)throw new c(n,`FieldNotFound`,i,{key:s});o.setField(s,J(l,i.operator,null,i,n))}}return p}let o=L(n,a),s=await G(n,i.right);return o.scope[o.id]={value:J(s,i.operator,i.operator===`=`?null:I(o.var).value,i,n)},p}async function Ie(e,t){let n=await G(e,t.expression);return n===p?p:new v(n)}async function Le(e,t){let n=await G(e,t.test);if(!0===n)return K(e,t.consequent);if(!1===n)return t.alternate===null?p:K(e,t.alternate);throw new c(e,`BooleanConditionRequired`,t)}async function Y(e,t){return Re(e,t,0)}async function Re(e,t,n){if(n>=t.body.length)return p;let r=await K(e,t.body[n]);return r instanceof m||r===A||r===S||n===t.body.length-1?r:Re(e,t,n+1)}async function ze(e,t){if(t.argument===null)return new m(p);let n=await G(e,t.argument);return new m(n)}async function Be(e,t){if(e.localScope!=null)throw N().error(`Function declarations are only valid in global scope.`),new c(e,`NeverReach`,t);let n=d(t.id);if(!(n in e.globalScope))throw N().error(`Function "${n}" not declared.`),new c(e,`NeverReach`,t);let r=ge(t),i=t.params.map(e=>d(e)),a=Array.from(r).filter(e=>!i.includes(e));return e.globalScope[n]={value:new we(t,e,i,a)},p}async function Ve(e,t){let n=L(e,t.specifiers[0].local),r=e.libraryResolver;if(r==null)throw N().error(`Internal error: module loader not initialized`),new c(e,`NeverReach`,t);let i=r.loadLibrary(n.id),a;return r._moduleSingletons?.has(i.uri)?a=r._moduleSingletons.get(i.uri):(a=await U.load(e,i.syntax),r._moduleSingletons?.set(i.uri,a)),n.scope[n.id]={value:a},p}async function He(e,t){return await K(e,t.declaration),p}async function Ue(e,t){for(let n of t.declarations)await We(e,n);return p}async function We(e,t){let n=null;n=t.init===null?null:await G(e,t.init),n===p&&(n=null);let r=L(e,t.id);r.scope[r.id]={value:n}}async function Ge(e,t){return Ke(e,await G(e,t.object),t)}async function Ke(e,t,n){let r=n.computed?await G(e,n.property):n.property.name;return ye(t,r)}async function qe(e,t,n){for(let r of n)switch(r.type){case`MemberExpression`:t=await Ke(e,t,r);break;case`CallExpression`:t=await tt(e,t,r);break;default:throw new c(null,`Unrecognized`,r)}return t}async function Je(e,t,n){let r=n.computed?await G(e,n.property):n.property.name;return ve(t,r)}async function Ye(e,t){let n=_e(t),r=await G(e,n.root);for(let t of n.sections){let n=await Je(e,r,t.checked);if(n==null)return null;r=await qe(e,n,t.unchecked)}return r}async function Xe(e,t){let n=await G(e,t.argument);if(o(n)){if(t.operator===`!`)return!n;if(t.operator===`-`)return-1*w(n);if(t.operator===`+`)return 1*w(n);if(t.operator===`~`)return~w(n);throw new c(e,`UnsupportUnaryOperator`,t)}if(t.operator===`-`)return-1*w(n);if(t.operator===`+`)return 1*w(n);if(t.operator===`~`)return~w(n);throw new c(e,`UnsupportUnaryOperator`,t)}async function Ze(e,t){let n=[];for(let r=0;r<t.elements.length;r++)n.push(await G(e,t.elements[r]));for(let r=0;r<n.length;r++){if(y(n[r]))throw new c(e,`NoFunctionInArray`,t);n[r]===p&&(n[r]=null)}return n}async function Qe(e,t){let n=await G(e,t.left),i=await G(e,t.right);switch(t.operator){case`|`:case`<<`:case`>>`:case`>>>`:case`^`:case`&`:return ie(w(n),w(i),t.operator);case`==`:return b(n,i);case`!=`:return!b(n,i);case`<`:case`>`:case`<=`:case`>=`:return te(n,i,t.operator);case`+`:return r(n)||r(i)?h(n)+h(i):w(n)+w(i);case`-`:return w(n)-w(i);case`*`:return w(n)*w(i);case`/`:return w(n)/w(i);case`%`:return w(n)%w(i);default:throw a(t.operator),new c(e,`UnsupportedOperator`,t)}}async function $e(e,t){let n=await G(e,t.left);if(!o(n))throw new c(e,`LogicalExpressionOnlyBoolean`,t);switch(t.operator){case`||`:{if(!0===n)return n;let r=await G(e,t.right);if(o(r))return r;throw new c(e,`LogicExpressionOrAnd`,t)}case`&&`:{if(!1===n)return n;let r=await G(e,t.right);if(o(r))return r;throw new c(e,`LogicExpressionOrAnd`,t)}default:throw a(t.operator),new c(e,`LogicExpressionOrAnd`,t)}}function X(e,t){return R(e,t)}async function et(e,t){return tt(e,t.callee.type===`Identifier`?R(e,t.callee,`FunctionNotFound`):await G(e,t.callee),t)}async function tt(e,t,n){if(y(t))return t.call(e,n);throw new c(e,`CallNonFunction`,n)}async function nt(e,t){let n=``,r=0;for(let i of t.quasis)if(n+=i.value?i.value.cooked:``,!1===i.tail){if(t.expressions[r]){let i=await G(e,t.expressions[r]);if(y(i))throw new c(e,`NoFunctionInTemplateLiteral`,t);n+=h(i)}r++}return n}async function rt(e,t){_(t.arguments===null?[]:t.arguments,3,3,e,t);let n=await G(e,t.arguments[0]);if(!1===o(n))throw new c(e,`BooleanConditionRequired`,t);return G(e,n?t.arguments[1]:t.arguments[2])}async function it(e,t){_(t.arguments===null?[]:t.arguments,2,3,e,t);let n=await G(e,t.arguments[0]);if(t.arguments.length===3){let r=await G(e,t.arguments[1]),i=xe(n,r);return i!=null&&i!==``?i:G(e,t.arguments[2])}return n==null||n===``?G(e,t.arguments[1]):n}async function at(e,t){if(t.arguments.length<2)throw new c(e,`WrongNumberOfParameters`,t);if(t.arguments.length===2)return G(e,t.arguments[1]);if((t.arguments.length-1)%2==0)throw new c(e,`WrongNumberOfParameters`,t);return ot(e,t,1,await G(e,t.arguments[0]))}async function ot(e,t,n,r){let i=await G(e,t.arguments[n]);if(b(i,r))return G(e,t.arguments[n+1]);let a=t.arguments.length-n;return a===1?G(e,t.arguments[n]):a===2?null:a===3?G(e,t.arguments[n+2]):ot(e,t,n+2,r)}async function st(e,t){if(t.arguments.length<3||t.arguments.length%2==0)throw new c(e,`WrongNumberOfParameters`,t);let n=await G(e,t.arguments[0]);if(!1===o(n))throw new c(e,`BooleanConditionRequired`,t.arguments[0]);return ct(e,t,0,n)}async function ct(e,t,n,r){if(!0===r)return G(e,t.arguments[n+1]);if(t.arguments.length-n===3)return G(e,t.arguments[n+2]);let i=await G(e,t.arguments[n+2]);if(!1===o(i))throw new c(e,`ModuleExportNotFound`,t.arguments[n+2]);return ct(e,t,n+2,i)}function lt(){let e=Object.create(null);ce(e,V),pe(e,V),me(e,V,X),oe(e,V),fe(e,V),ue(e,V),he(e,V),Ce({functions:e,compiled:!1,signatures:null,evaluateIdentifier:null,mode:`async`,standardFunction:V,standardFunctionAsync:W}),e.iif=rt,e.defaultvalue=it,e.decode=at,e.when=st;let t=function(){this.textformatting={value:k.textFormatting()}};t.prototype=Object.create(null),t.prototype.infinity=Object.freeze({value:1/0}),t.prototype.pi=Object.freeze({value:Math.PI});for(let[n,r]of Object.entries(e))t.prototype[n]=Object.freeze({value:new x(r)});return t}var Z=lt();function Q(e){let t={mode:`async`,compiled:!1,functions:Object.create(null),signatures:[],standardFunction:V,standardFunctionAsync:W,evaluateIdentifier:X};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(let[e,n]of Object.entries(t.functions))Z.prototype[e]=Object.freeze({value:new x(n)});for(let e=0;e<t.signatures.length;e++)le(t.signatures[e],`async`)}function ut(e){console.log(e)}function $(e,t){let n=new Set(Object.keys(t?.vars||{}).map(e=>d(e))),r=new Set(Object.keys(t?.customfunctions||{}).map(e=>d(e))),{globals:a,exports:o}=se(e);return async t=>{let s=t.spatialReference??l.WebMercator,d=null;e.usesModules&&(d=new j(new Map,e.loadedModules));let f=new Z;for(let e of r)t.customfunctions!=null&&e in t.customfunctions?f[e]={value:new x(t.customfunctions[e])}:f[e]=P;for(let e of n){if(t.vars==null||!(e in t.vars)){e in f||(f[e]=P);continue}let n=t.vars[e]??null;i(n)?f[e]={value:ae.createFromGraphic(n,t.timeZone??null)}:f[e]={value:n}}for(let e of a)e in f||(f[e]=P);let p={lrucache:t.lrucache,interceptor:t.interceptor,services:t.services,console:t.console??ut,abortSignal:t.abortSignal??u,timeZone:t.timeZone??null,spatialReference:s,track:t.track,depthCounter:{depth:1},libraryResolver:d,exports:o,localScope:null,globalScope:f},h=await Y(p,e);if(h instanceof m||h instanceof v){let e=h.value;if(ee(e))return null;if(y(e))throw new c(p,`IllegalResult`,null);return e}if(ee(h))return null;throw h===A||h===S?new c(p,`IllegalResult`,null):new c(p,`NeverReach`,null)}}function dt(e,t){return $(e,t)(t)}Q([de]),Q([Se]);export{dt as executeScript,Q as extend,$ as prepareScript};