import{$h as e,Bl as t,Bx as n,Cb as r,Cl as i,DT as a,Db as o,Fg as s,Fl as c,Gx as l,Hw as u,JE as d,Jr as f,Jx as p,Lw as m,Ml as h,Nl as g,OT as _,Og as ee,Ol as v,Qh as y,SE as b,Vl as x,Vr as S,WT as C,Z_ as te,_b as ne,_w as re,bb as ie,c_ as ae,dg as oe,dw as se,eg as ce,fT as le,gD as w,hT as ue,hb as de,i_ as fe,ig as T,iv as pe,kl as me,nv as E,ov as he,pT as ge,pg as _e,px as ve,qx as ye,rE as be,rT as xe,rv as Se,sv as Ce,tv as we,u_ as Te,ub as Ee,vT as D,vb as De,vd as Oe,vw as ke,wx as Ae,xb as je,yb as Me,yl as Ne,zi as Pe}from"./index-CZ4oMP1N.js";import{n as Fe}from"./meshVertexSpaceUtils-CsTvVRUI.js";import{a as O}from"./vectorStacks-FfDNcZoS.js";import{n as Ie}from"./projectPointToVector-HYpbaZqA.js";import{n as Le}from"./dehydratedPoint-rdg1UAtQ.js";import{t as Re}from"./projectVectorToVector-DX3Yd1qf.js";import{t as ze}from"./memoize-BNsZjv91.js";import{b as Be,f as Ve,i as He,l as Ue,m as We,r as Ge,s as Ke,x as qe}from"./elevationInfoUtils-9csVBlEH.js";import{t as Je}from"./GraphicsLayer-Bx8Nz7ax.js";import{d as Ye,f as Xe,i as k,n as Ze,r as Qe,t as A}from"./quantity-CPor8qMe.js";import{t as $e}from"./geodesicUtils-CbiJFASl.js";import{i as et,t as tt}from"./SketchOptions-Dp8M5XoK.js";import{d as j,f as nt,p as rt}from"./LineSnappingHint-BOeMI0cS.js";import{s as it}from"./snappingUtils-Od8uWW_a.js";import{a as at,d as ot,i as st,l as ct,n as lt,r as ut,s as dt,u as ft}from"./constraints-Bf0IRs4G.js";import{t as pt}from"./euclideanLengthMeasurementUtils-C9WB-wbk.js";import{a as mt,c as ht,i as gt,n as _t,o as vt,r as yt,s as bt,t as xt}from"./createUtils-BdtfcpTy.js";import{_ as St,c as Ct,d as M,f as wt,h as Tt,i as Et,l as Dt,m as Ot,n as kt,o as At,p as jt,r as Mt,s as Nt,t as Pt,u as Ft,y as It}from"./SnappingContext-BtkpPzK4.js";import{c as Lt,i as N,l as Rt,s as zt,u as Bt,y as Vt}from"./rotate-CRgbbiZK.js";import{n as Ht,t as Ut}from"./dehydratedFeatureComparison-Uk3aLNrk.js";import{a as Wt,n as Gt,r as P,s as Kt}from"./angularMeasurementUtils-DzYsrBw4.js";import{t as qt}from"./ReactiveSet-Jf4MiUGe.js";import{a as Jt,n as Yt}from"./hydratedFeatures-B670wkRA.js";import{t as Xt}from"./drapedUtils-BIPbWxSw.js";import{i as Zt,n as Qt}from"./boundedPlane-C8nQBQLB.js";var $t={UndoRedoUpdating:`Cannot perform operation whilst undo redo is updating`,UndoInvalidError:`There are no items to Undo`,RedoInvalidError:`There are no items to Redo`,ApplyInvalidError:`Cannot apply an item that is already applied`},F=class extends Error{constructor(){super($t.UndoRedoUpdating),this.type=`undo-redo-updating-error`}},en=class extends Error{constructor(){super($t.UndoInvalidError),this.type=`undo-redo-undo-error`}},tn=class extends Error{constructor(){super($t.RedoInvalidError),this.type=`undo-redo-redo-error`}},I=class extends re{constructor(){super(...arguments),this._stack=new pe,this._stackPosition=-1,this._updatingHandles=new _e}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new en;if(this.updating)throw new F;let e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(1),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new tn;if(this.updating)throw new F;let e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new tn;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new F;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new F;await this._updatingHandles.addPromise((async()=>{e.status===0&&await e.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await we(()=>!this.updating);let n=new pe;for(let t=0;t<this._stack.length;t++){let r=this._stack.getItemAt(t);r&&(r.tag===e?(r.destroy(),t===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(r))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(e=!1){if(this.updating&&!e)throw new F;await we(()=>!this.updating),this._drainStack()}};w([a()],I.prototype,`_stack`,void 0),w([a()],I.prototype,`_stackPosition`,void 0),w([a()],I.prototype,`updating`,null),w([a({readOnly:!0})],I.prototype,`canUndo`,null),w([a({readOnly:!0})],I.prototype,`hasUndo`,null),w([a({readOnly:!0})],I.prototype,`canRedo`,null),w([a({readOnly:!0})],I.prototype,`hasRedo`,null),I=w([_(`esri.UndoRedo`)],I);var nn=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function L(e,t,n){if(e==null)return`noTool`;switch(e){case`point`:return rn();case`multipoint`:return`multipoint`;case`polyline`:return an(t,n);case`polygon`:return on(t,n);case`rectangle`:case`circle`:return sn(t,n);default:return}}function rn(e){return`point`}function an(e,t){let n=e!=null&&e.type===`polyline`&&e.paths.length?e.paths[0].length:0;return t===`freehand`?n<2?`freehandStart`:`freehandEnd`:n<2?`polylineZeroVertices`:`polylineOneVertex`}function on(e,t){let n=e!=null&&e.type===`polygon`&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case`freehand`:return`freehandStart`;case`hybrid`:return`polygonZeroVerticesHybrid`;default:return`polygonZeroVertices`}else if(n<4)return t===`freehand`?`freehandEnd`:`polygonOneVertex`;return`polygonTwoVertices`}function sn(e,t){if((e!=null&&e.type===`polygon`&&e.rings.length?e.rings[0].length:0)<3)switch(t){case`freehand`:return`freehandStart`;case`click`:return`shapeStartClick`;default:return`shapeStartHybrid`}switch(t){case`freehand`:return`freehandEnd`;case`click`:return`shapeEndClick`;default:return`shapeEndHybrid`}}function cn(e,t){let r=e?.geometry;if(!e||r?.type!==`mesh`||!t)return;let{renderCoordsHelper:i,elevationProvider:a}=t,{camera:o}=t.state,{extent:s}=r,{center:c,spatialReference:l}=s,u=n(l),d=p(l),f=n(i.spatialReference),m=s.width*u,h=s.height*d,g=(s.zmax??0)*d,_=g-(s.zmin??0)*d,ee=Math.max(m,h,_)/f,{x:y,y:b}=c,x=c.z??0;v(fn,y,b,x),i.toRenderCoords(fn,l,fn);let S=ee/o.computeScreenPixelSizeAt(fn);if(S>Math.min(o.width,o.height)/o.pixelRatio*un)return`meshTooClose`;if(S<ln)return`meshTooFar`;let C=Ue(e),{absoluteZ:te}=qe(y,b,g,l,t,C);return te<(a.getElevation(y,b,x,l,`ground`)??0)*d+_*dn?`meshUnderground`:`mesh`}var ln=20,un=1,dn=.1,fn=ae();function pn(e,t,n,r,i,a){let o=`geodesic`,s=$e(n),c=j();return rt(e,t,r,c),c[2]=0,s&&Re(c,n,c,s)||(o=`euclidean`,s=n),{mode:o,view:t,elevationInfo:r,hasZ:i,directionMode:a,spatialReference:e.spatialReference,measurementSR:s,origin:c}}function mn(e,t,n){if(t==null||e==null)return;let r=ye(n.measurementSR);if(r==null)return;let i=Cn(e,n);if(i==null)return;let a=Ye(t,r);return new ct(i,a)}function hn(e,t,n,r){if(n==null||e==null)return;let i=Cn(e,r);if(i==null)return;let a=P(n),o=e=>{if(e==null)return;let t=j(),n=Qe(e,`degrees`,`geographic`);return Gt(t,i,r.measurementSR,10,n,r.mode)?new ft(i,t):void 0},s=()=>{if(t!=null&&e!=null)return P(Wt(t,e))};switch(r.directionMode){case`absolute`:return o(a);case`relative`:{let e=s();return e==null?void 0:o(e+a)}case`relative-bilateral`:{let e=s();return e==null?void 0:st([o(e+a),o(e-a)])}}}function gn(e,t){let n=Tn(e,t);return n==null?void 0:new ot(n)}function _n(e,t,n){let{context:r,longitude:i,latitude:a,direction:o,distance:s,elevation:c}=n;if(i!=null||a!=null||s!=null||c!=null||o!=null){if(i!=null||a!=null){let e=P(i),t=P(a),n=Tn(c,r);return new ut(e,t,n)}return vn(e,t,n)}}function vn(e,t,{context:n,direction:r,distance:i,elevation:a}){if(t==null)return gn(a,n);let{view:o,elevationInfo:s,measurementSR:c}=n,l=rt(t,o,s);if(!c||!Re(l,t.spatialReference,Dn,c))return;let[u,d]=Dn,f=i==null?void 0:Ye(i,`meters`),p=P(r),m=Tn(a,n),h=e=>{let t=new lt([u,d],c,f,m,e);return f==null||e==null||m==null&&n.hasZ?t:new at(t.closestTo(l))};if(p==null)return h(void 0);let g=()=>{if(e!=null&&t!=null)return P(Wt(e,t))};switch(n.directionMode){case`absolute`:return h(p);case`relative`:{let e=g();return e==null?void 0:h(e+p)}case`relative-bilateral`:{let e=g();return e==null?void 0:st([h(e+p),h(e-p)])}}}function yn(e){return e.context.mode===`geodesic`?_n(null,null,e):xn(e)}function bn(e,t,n){let{context:r,x:i,y:a,distance:o,direction:s,elevation:c}=n;return r.mode===`geodesic`?_n(t,e,n):i!=null||a!=null?xn(n):Sn([mn(e,o,r),hn(e,t,s,r),gn(c,r)])}function xn({x:e,y:t,elevation:n,context:r}){kn.x=e?.value??0,kn.y=t?.value??0,kn.spatialReference=r.spatialReference;let i=Cn(kn,r,On);return new ut(e!=null&&i!=null?i[0]:void 0,t!=null&&i!=null?i[1]:void 0,Tn(n,r))}function Sn(e){let t;for(let n of e)n&&(t=t?.intersect(n)??n);return t}function Cn(e,t,n=j()){let{view:r,elevationInfo:i,measurementSR:a,origin:o,mode:s}=t;if(rt(e,r,i,n),Re(n,e.spatialReference,n,a))return s!==`geodesic`&&Ne(n,n,o),n}function wn(e,t,n,r){let{view:i,measurementSR:a,spatialReference:o,origin:s,mode:c}=n;if(c===`geodesic`?h(R,e):g(R,e,s),Re(R,a,R,o))return nt(R,i,t,n,r)}function Tn(e,t){return En(e,t)?.value??void 0}function En(e,{view:t,origin:n,elevationInfo:r,hasZ:i,measurementSR:a}){if(e==null||!i)return;let o=l(a);if(o==null)return;let[s,c]=n,u=Ye(e,o),d=t?.type===`3d`?He(t,s,c,u,a,r):u;return d==null?void 0:Ze(d,o)}var Dn=j(),On=j(),R=j(),kn=Le(0,0,0,Ae.WGS84),z=class extends N{constructor(e){super(e),this.type=`draw-circle`,this.radius=null,this.xSize=null,this.ySize=null,this.area=A}get allFields(){return[]}};w([a()],z.prototype,`type`,void 0),w([a()],z.prototype,`radius`,void 0),w([a()],z.prototype,`xSize`,void 0),w([a()],z.prototype,`ySize`,void 0),w([a()],z.prototype,`area`,void 0),w([a()],z.prototype,`helpMessage`,void 0),w([a()],z.prototype,`allFields`,null),z=w([_(`esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo`)],z);var B=class extends M(N){constructor(e){super(e),this.type=`draw-mesh`,this.orientation=Ot({lockable:!1}),this.scale=St({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};w([a()],B.prototype,`helpMessage`,void 0),w([a()],B.prototype,`allFields`,null),B=w([_(`esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo`)],B);var V=class extends M(N){constructor(e){super(e),this.type=`draw-multipoint`}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};w([a()],V.prototype,`helpMessage`,void 0),w([a()],V.prototype,`allFields`,null),V=w([_(`esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo`)],V);var H=class extends M(N){constructor(e){super(e),this.type=`draw-point`}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};w([a()],H.prototype,`helpMessage`,void 0),w([a()],H.prototype,`allFields`,null),H=w([_(`esri.views.interactive.tooltip.infos.DrawPointTooltipInfo`)],H);var U=class extends M(N){constructor(e){super(e),this.type=`draw-polygon`,this.direction=jt(),this.distance=wt(),this.area=Tt(),this.xyMode=`direction-distance`}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};w([a()],U.prototype,`xyMode`,void 0),w([a()],U.prototype,`helpMessage`,void 0),w([a()],U.prototype,`allFields`,null),U=w([_(`esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo`)],U);var W=class extends M(N){constructor(e){super(e),this.type=`draw-polyline`,this.direction=jt(),this.distance=wt(),this.totalLength=It(),this.xyMode=`direction-distance`}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};w([a()],W.prototype,`helpMessage`,void 0),w([a()],W.prototype,`xyMode`,void 0),w([a()],W.prototype,`allFields`,null),W=w([_(`esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo`)],W);var G=class extends N{constructor(e){super(e),this.type=`draw-rectangle`,this.xSize=k,this.ySize=k,this.area=A}get allFields(){return[]}};w([a()],G.prototype,`type`,void 0),w([a()],G.prototype,`xSize`,void 0),w([a()],G.prototype,`ySize`,void 0),w([a()],G.prototype,`area`,void 0),w([a()],G.prototype,`helpMessage`,void 0),w([a()],G.prototype,`allFields`,null),G=w([_(`esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo`)],G);function An(e,t){return{point:new H({sketchOptions:t,viewType:e}),multipoint:new V({sketchOptions:t,viewType:e}),polyline:new W({sketchOptions:t,viewType:e}),polygon:new U({sketchOptions:t,viewType:e}),mesh:new B({sketchOptions:t,viewType:e}),rectangle:new G({sketchOptions:t}),circle:new z({sketchOptions:t})}}function jn(e){let{directionOptions:t,geometryType:n,sketchOptions:r,tooltipInfos:i}=e,a=t=>{let n=er(e).mode,r=i[t].elevation;n===`relative-to-ground`||n===`relative-to-scene`||n===`on-the-ground`?r.lock(tr(e)):r.unlock()},o=e=>{if(t){let n=i[e].direction;n.committed=t.angle,n.unlockOnVertexPlacement=!1,r.values.directionMode=t.mode}};switch(n){case`polygon`:case`polyline`:a(n),o(n);break;case`point`:case`mesh`:a(n)}}function Mn(e,t){let{drawOperation:n,view:r}=t,i=Pn(t),a=er(t);if(r.type===`2d`||!e||a.mode!==`absolute-height`||n?.numCommittedVertices!==1||!i||i.type!==`draw-polyline`&&i.type!==`draw-polygon`||i.elevation.locked)return;let[o,s,c]=e,l=$n(o,s,c,a,t);l!=null&&i.elevation.lock(l)}function Nn(e){Pn(e)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function Pn({geometryType:e,graphic:t,tooltipInfos:n}){return t?.geometry?.type===Fn[e]||e===`circle`||e===`rectangle`?n[e]:null}var Fn={point:`point`,multipoint:`multipoint`,mesh:`mesh`,polyline:`polyline`,polygon:`polygon`,circle:`polygon`,rectangle:`polygon`,freehandPolygon:`polygon`,freehandPolyline:`polyline`,text:`point`};function In(e,t){switch(e?.type){case`draw-point`:Ln(e,t);break;case`draw-multipoint`:Rn(e,t);break;case`draw-polyline`:Vn(e,t);break;case`draw-polygon`:Hn(e,t);break;case`draw-rectangle`:Kn(e,t);break;case`draw-circle`:qn(e,t);break;case`draw-mesh`:zn(e,t)}}function Ln(e,t){let n=t.graphic?.geometry;n?.type===`point`&&(Bn(e,t),e.helpMessage=L(`point`,n,t.drawOperation.drawingMode))}function Rn(e,t){let n=t.graphic?.geometry;n?.type===`multipoint`&&(Bn(e,t),e.helpMessage=L(`multipoint`,n,t.drawOperation.drawingMode))}function zn(e,t){let{graphic:n,view:r}=t,i=n?.geometry;r.type!==`3d`||i&&i.type!==`mesh`||(Bn(e,t),i&&Bt(e,i),e.helpMessage=cn(n,r))}function Bn(e,t){let{drawOperation:n,view:r,sketchOptions:i}=t,{cursorVertex:a,hasZ:o}=n;e.sketchOptions=i,e.viewType=r.type,e.setLocationFromPoint(a,K(t)),e.setElevationFromPoint(a,{hasZ:o}),n.constraints=a?{context:nr(a,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}:void 0}function Vn(e,t){let{createOperationGeometry:n,drawOperation:r,automaticLengthMeasurementUtils:i}=t,a=n==null?null:n.full;a&&a.type!==`polyline`||(Wn(e,t),e.totalLength.actual=r.lastVertex?(a?i.autoLength2D(a):null)??k:null,e.helpMessage=L(`polyline`,a,t.drawOperation.drawingMode))}function Hn(e,t){let{createOperationGeometry:n,drawOperation:r}=t,i=n==null?null:n.full;i&&i.type!==`polygon`||(Wn(e,t),e.area.actual=r.lastVertex?(i?t.automaticAreaMeasurementUtils.autoArea2D(i):null)??A:null,e.helpMessage=L(`polygon`,i,t.drawOperation.drawingMode))}var Un=be(ve);function Wn(e,t){let{drawOperation:n,sketchOptions:r,view:i,automaticLengthMeasurementUtils:a}=t,{cursorVertex:o,lastVertex:s,secondToLastVertex:c,hasZ:l}=n,u=r.values.effectiveDirectionMode;e.sketchOptions=r,e.viewType=i.type;let d=s&&o?a.autoDistanceBetweenPoints2D(Un(s),Un(o))??k:null;e.distance.actual=d,e.distance.readOnly=s==null;let f=s!==null&&(u===`absolute`||c);if(e.direction.actual=null,e.direction.readOnly=!f,f&&o){let t=Kt(c,s,o,u);e.direction.actual=t??Xe}e.setLocationFromPoint(o,K(t)),e.setElevationFromPoint(o,{hasZ:l});let p=Gn(s,t);e.xyMode=p,e.direction.visible=p===`direction-distance`,e.distance.visible=p===`direction-distance`,e.effectiveX.visible=p===`coordinates`,e.effectiveY.visible=p===`coordinates`;let m=o??s;n.constraints=m?{context:nr(m,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function Gn(e,{sketchOptions:t}){let n=t.tooltips.xyMode;return n===`auto`?e?`direction-distance`:`coordinates`:n}function Kn(e,t){e.sketchOptions=t.sketchOptions,e.xSize=Yn(t),e.ySize=Xn(t),e.area=Jn(t),e.helpMessage=L(`rectangle`,t.graphic?.geometry,t.drawOperation.drawingMode)}function qn(e,t){let{forceUniformSize:n,sketchOptions:r}=t;e.sketchOptions=r,e.radius=n?Zn(t):null,e.xSize=n?null:Yn(t),e.ySize=n?null:Xn(t),e.area=Jn(t),e.helpMessage=L(`circle`,t.graphic?.geometry,t.drawOperation.drawingMode)}function Jn(e){let t=e.createOperationGeometry?.full;return t?.type===`polygon`?e.automaticAreaMeasurementUtils.autoArea2D(t)??A:A}function Yn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){let n=e?.rectangle?.midpoints;return(n==null?null:t.autoDistanceBetweenPoints2D(n.left,n.right))??k}function Xn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){let n=e?.rectangle?.midpoints;return(n==null?null:t.autoDistanceBetweenPoints2D(n.top,n.bottom))??k}function Zn({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){return(e?.circle?.center!=null&&e.circle.edge!=null?t.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??k}function Qn(e){let{geometryType:t,tooltipInfos:n}=e;switch(t){case`point`:case`multipoint`:case`mesh`:case`polyline`:case`polygon`:{let r=n[t].elevation.committed;return r?Ye(r,`meters`)/p(K(e)):void 0}default:return}}function $n(e,t,n,r,i){let{view:a,drawOperation:o}=i;if(a.type!==`3d`||!o)return;n??=0;let s=K(i),c=er(i),l=He(a,e,t,n,s,c,r);return pt(l,s)??tr(i)}function er(e){return e.drawOperation.elevationInfo??We}function K(e){return e.drawOperation.coordinateHelper.spatialReference}function tr(e){let t=p(K(e));return Ze(e.defaultZ*t,`meters`)}function nr(e,t){return pn(e,t.view,K(t),er(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var rr=class{constructor(){this._isToolEditable=!0,this._manipulators=new pe,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=0){this.addMany([e],t)}addMany(e,t=0){for(let n of e){let e={manipulator:n,visibilityPredicate:t,attached:!1};this._manipulators.add(e),this._attached&&this._updateManipulatorAttachment(e)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){let e=this._manipulators.splice(t,1)[0];this._detachManipulator(e);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,e=>{t(e)})}forEach(e){for(let t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){let e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let n=null,r=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:i,attached:a})=>{if(!a||!i.interactive)return;let o=i.intersectionDistance(e,t);o!=null&&o<r&&(r=o,n=i)}),n}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||=(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),!0)}_detachManipulator(e){if(!e.attached)return;let t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===2||(this._isToolEditable?e.visibilityPredicate===0:e.visibilityPredicate===1)}},q=class extends Ce{constructor(e){super(e),this.manipulators=new rr,this.automaticManipulatorSelection=!0,this.multiTouchEnabled=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[1,!0],[0,!0]]),this._creationFinishedResolver=m()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get(`visible`)!==e&&(this._set(`visible`,e),this._syncVisible())}get editable(){return this.getEditableFlag(0)}set editable(e){this.setEditableFlag(0,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set(`view`,null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit(`cancel`)}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===0&&this.notifyChange(`editable`),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){let e=this.view.inputManager.latestPointerInfo?.location;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:n})=>{n.dragging&&(t=!0,n.events.emit(`drag`,{action:`end`,start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set(`created`,!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};w([a({constructOnly:!0})],q.prototype,`view`,void 0),w([a({readOnly:!0})],q.prototype,`active`,null),w([a({value:!0})],q.prototype,`visible`,null),w([a({value:!0})],q.prototype,`editable`,null),w([a({readOnly:!0})],q.prototype,`manipulators`,void 0),w([a({readOnly:!0})],q.prototype,`updating`,null),w([a()],q.prototype,`cursor`,null),w([a({readOnly:!0})],q.prototype,`automaticManipulatorSelection`,void 0),w([a({readOnly:!0})],q.prototype,`multiTouchEnabled`,void 0),w([a()],q.prototype,`hasFocusedManipulators`,null),w([a()],q.prototype,`hasGrabbedManipulators`,void 0),w([a()],q.prototype,`hasHoveredManipulators`,void 0),w([a()],q.prototype,`firstGrabbedManipulator`,void 0),w([a({readOnly:!0})],q.prototype,`created`,void 0),w([a({readOnly:!0})],q.prototype,`removeIncompleteOnCancel`,void 0),q=w([_(`esri.views.interactive.InteractiveToolBase`)],q);var J=class extends q{constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new tt}initialize(){let{view:e}=this;this.internalGraphicsLayer=new Je({listMode:`hide`,internal:!0,title:`DrawGraphicTool layer`}),this.view.map.layers.add(this.internalGraphicsLayer);let t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=An(e.type,this.sketchOptions);let n=Rt(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=n,jn(this._tooltipsContext),this._coordinateFormatterLoadTask=oe(()=>Vt()),this.addHandles([t.on(`vertex-add`,e=>this.onVertexAdd(e)),t.on(`vertex-remove`,e=>this.onVertexRemove(e)),t.on(`vertex-update`,e=>this.onVertexUpdate(e)),t.on(`cursor-update`,e=>this.onCursorUpdate(e)),t.on(`cursor-remove`,()=>this._updateGraphic()),t.on(`complete`,e=>this.onComplete(e)),this._coordinateFormatterLoadTask,n.on(`paste`,e=>Lt(e,this.activeTooltipInfo)),E(()=>this.cursor,e=>{t.cursor=e},Se),ke(()=>{let{activeTooltipInfo:e,sketchOptions:t}=this;In(e,this._tooltipsContext),n.info=t.tooltips.effectiveEnabled?e:null}),ke(()=>{t.constraintZ=Qn(this._tooltipsContext)},te)]),this.finishToolCreation(),t.initializePointer()}destroy(){this.drawOperation=D(this.drawOperation),this.tooltip=D(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=D(this.internalGraphicsLayer),this._set(`view`,null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){let{defaultZ:e,directionOptions:t,drawOperation:n,forceUniformSize:r,geometryType:i,graphic:a,sketchOptions:o,tooltipInfos:s,view:c,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:u}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:e,directionOptions:t,drawOperation:n,forceUniformSize:r,geometryType:i,graphic:a,sketchOptions:o,tooltipInfos:s,view:c,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:u}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set(`centered`,e),this._updateGraphic()}get cursor(){return this._get(`cursor`)}set cursor(e){this._set(`cursor`,e)}set enabled(e){this.drawOperation.interactive=e,this._set(`enabled`,e)}set forceUniformSize(e){this._set(`forceUniformSize`,e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set(`graphicSymbol`,e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){let t=this.drawOperation;t&&(t.drawingMode=e),this._set(`mode`,e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){let{view:{type:e,map:t}}=this;return e===`2d`&&t&&`undoRedo`in t&&t.undoRedo instanceof I?t.undoRedo:null}set undoRedo(e){this._override(`undoRedo`,e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||zt(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&jn(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(Y.outline),this.removeHandles(Y.regularVertices),this.removeHandles(Y.activeVertex),this.removeHandles(Y.activeEdge),this.removeHandles(ir)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;let t=new Oe({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange(`graphic`),this.addHandles(C(()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)}),ir),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(this.drawOperation==null)return;let{coordinateHelper:t,view:n,visualizationCursorVertex:r,lastVertex:i,committedVertices:a,geometryIncludingUncommittedVertices:o,numCommittedVertices:s}=this.drawOperation;if(!(s>0||r!=null))return;let c=e.operationComplete?a:o,l=c.length,u=r==null?null:t.pointToArray(r),d=this._drawSpatialReference,f=n.type===`3d`&&n.viewingMode===`global`,p=new nn;p.committedVertices=a,p.cursorVertex=u;let{geometryType:m}=this;switch(m){case`point`:case`mesh`:p.full=t.arrayToPoint(c[0]);break;case`multipoint`:p.full=l>0?xt(c,d):null;break;case`polyline`:case`polygon`:l>0&&(p.full=m===`polygon`?_t([c],d,f,!0):mt([c],d,f),p.cursorEdge=u!=null&&i&&!Ut(r,i)?mt([[u,t.pointToArray(i)]],d,f):null,p.outline=l>1?p.full:null);break;case`circle`:case`rectangle`:{if(p.committedVertices=p.cursorVertex=null,!l)break;let t=ht(n,c[0]),r=c[0],i=t.makeMapPoint(r[0]+or*n.resolution,r[1]);m===`circle`?l===1&&e.operationComplete?p.circle=vt([r,i],t,!0):l===2&&(this.forceUniformSize?p.circle=vt(c,t,this.centered):p.rectangle=bt(c,t,this.centered)):l===1&&e.operationComplete?p.rectangle=gt([r,i],t,!0):l===2&&(p.rectangle=this.forceUniformSize?gt(c,t,this.centered):yt(c,t,this.centered)),p.full=p.circle==null?p.rectangle?.geometry:p.circle.geometry,p.outline=p.full?.type===`polygon`?p.full:null;break}default:return null}return p}initializeGraphic(e){return C()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){let e=this._getCreateOperationGeometry({operationComplete:!0});e!=null&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit(`complete`,{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit(`cursor-update`,e)}onDeactivate(){let{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return C()}onCursorEdgeChanged(e){return C()}onVertexAdd(e){Nn(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Mn(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit(`vertex-add`,e)}onVertexRemove(e){Nn(this._tooltipsContext),this._updateGraphic(),this.emit(`vertex-remove`,e)}onVertexUpdate(e){this._updateGraphic(),this.emit(`vertex-update`,e)}_updateGraphic(){let e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e==null?this._destroyAllVisualizations():(e.cursorEdge==null?this.removeHandles(Y.activeEdge):this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),Y.activeEdge),e.outline==null?this.removeHandles(Y.outline):this.addHandles(this.onOutlineChanged(e.outline),Y.outline),e.committedVertices==null?this.removeHandles(Y.regularVertices):this.addHandles(this.onRegularVerticesChanged(e.committedVertices),Y.regularVertices),e.cursorVertex==null?this.removeHandles(Y.activeVertex):this.addHandles(this.onActiveVertexChanged(e.cursorVertex),Y.activeVertex),e.full==null?this.removeHandles(ir):this._createOrUpdateGraphic(e.full))}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?Pn(this._tooltipsContext):null}};w([a()],J.prototype,`_coordinateFormatterLoadTask`,void 0),w([a()],J.prototype,`_createOperationGeometry`,void 0),w([a()],J.prototype,`_tooltipsContext`,null),w([a({value:!0})],J.prototype,`centered`,null),w([a()],J.prototype,`cursor`,null),w([a({nonNullable:!0})],J.prototype,`defaultZ`,void 0),w([a({constructOnly:!0})],J.prototype,`directionOptions`,void 0),w([a()],J.prototype,`drawOperation`,void 0),w([a()],J.prototype,`elevationLockOnVertexAddDisabled`,void 0),w([a({value:!0})],J.prototype,`enabled`,null),w([a({value:!0})],J.prototype,`forceUniformSize`,null),w([a({constructOnly:!0})],J.prototype,`geometryType`,void 0),w([a()],J.prototype,`graphic`,null),w([a({constructOnly:!0})],J.prototype,`graphicProperties`,void 0),w([a()],J.prototype,`graphicSymbol`,null),w([a({constructOnly:!0})],J.prototype,`hasZ`,void 0),w([a({constructOnly:!0})],J.prototype,`geometryToPlace`,void 0),w([a()],J.prototype,`mode`,null),w([a()],J.prototype,`snappingManager`,void 0),w([a()],J.prototype,`snapToScene`,void 0),w([a()],J.prototype,`tooltip`,void 0),w([a()],J.prototype,`tooltipInfos`,void 0),w([a({constructOnly:!0,type:tt})],J.prototype,`sketchOptions`,void 0),w([a()],J.prototype,`updating`,null),w([a({constructOnly:!0,nonNullable:!0})],J.prototype,`view`,void 0),w([a({constructOnly:!0})],J.prototype,`automaticAreaMeasurementUtils`,void 0),w([a({constructOnly:!0})],J.prototype,`automaticLengthMeasurementUtils`,void 0),w([a({constructOnly:!0})],J.prototype,`undoRedo`,null),w([a()],J.prototype,`activeTooltipInfo`,null),J=w([_(`esri.views.draw.DrawGraphicTool`)],J);var ir=Symbol(`create-operation-graphic`),Y={outline:Symbol(`outline-visual`),regularVertices:Symbol(`regular-vertices-visual`),activeVertex:Symbol(`active-vertex-visual`),activeEdge:Symbol(`active-edge-visual`)};function ar(e){switch(e){case`point`:case`polyline`:case`polygon`:case`multipoint`:return e;case`circle`:case`rectangle`:return`segment`;case`mesh`:return`point`}}var or=48,sr=`click`,X=class extends re{constructor(e){super(e),this.events=new he,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};w([a()],X.prototype,`interactive`,void 0),w([a()],X.prototype,`selectable`,void 0),w([a()],X.prototype,`cursor`,void 0),w([a()],X.prototype,`grabbing`,void 0),w([a()],X.prototype,`grabbable`,void 0),w([a()],X.prototype,`consumesClicks`,void 0),w([a()],X.prototype,`grabbableForEvent`,void 0),w([a()],X.prototype,`dragging`,void 0),w([a()],X.prototype,`hovering`,void 0),w([a()],X.prototype,`selected`,void 0),X=w([_(`esri.views.draw.LegacyDrawManipulator`)],X);function cr(e,t){let n=null,r=null;return i=>{if(i.action===`cancel`)return void(r!=null&&(r.execute({action:`cancel`}),n=null,r=null));let a={action:i.action,screenStart:i.start,screenEnd:i.screenPoint};i.action===`start`&&n==null&&(n=new wr,r=new wr,t(e,n,r,i.pointerType,a)),n?.execute(a),i.action===`end`&&n!=null&&(n=null,r=null)}}function lr(e,t){return e.events.on(`drag`,cr(e,t))}function ur(e,t){let n=[e.x,e.y,e.z??0],r=t,i=[Math.cos(r),Math.sin(r)],a=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(a===0)return null;i[0]/=a,i[1]/=a;let o=e=>{let t=(e.x-n[0])*i[0]+(e.y-n[1])*i[1];e.x=n[0]+t*i[0],e.y=n[1]+t*i[1]};return e=>(o(e.mapStart),o(e.mapEnd),{...e,axis:i})}function dr(e){let t=null,n=br();return r=>{if(r.action===`start`&&(t=pr(e,r.mapStart.spatialReference)),t==null)return null;let i=n(r);if(!i)return null;let{translationX:a,translationY:o,translationZ:s}=i;return t.move(a,o,s,r.action),i}}function fr(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():s(e,t)}function pr(e,t){let n=e.operations;if(!n)return null;let r=n.data.geometry,i=Yt(t);if(r.spatialReference.equals(i))return mr(e,n,()=>{});if(r.type!==`mesh`){let t=fr(r,i);if(t==null)return null;let a=r.spatialReference,o=kt.fromGeometry(t,n.viewingMode);return mr(e,o,()=>{let e=o.data.geometry,t=s(e,a);n.trySetGeometry(t)})}if(Fe(r)){let t=fr(r.origin,i);if(!t)return null;let a=r.spatialReference,o=kt.fromGeometry(t,n.viewingMode);return mr(e,n,()=>{let e=s(o.data.geometry,a),t=e.x-r.origin.x,i=e.y-r.origin.y,c=(e.z??0)-(r.origin.z??0);n.move(t,i,c)})}return null}function mr(e,t,n){let r=0,i=0,a=0;return{move:(o,s,c,l)=>{l===`start`&&(r=0,i=0,a=0);let u=o-r,d=s-i,f=c-a;t.move(u,d,f),r+=u,i+=d,a+=f,n(),l===`end`&&e.endInteraction?.()}}}function hr(e,t=null,n){let r=null,i=t==null||e.spatialReference?.equals(t)?e=>e:e=>e==null?e:s(e,t),a={exclude:[],...n};return t=>{if(t.action===`start`&&(r=i(e.toMap(t.screenStart,a))),r==null)return null;let n=i(e.toMap(t.screenEnd,a));return n==null?null:{...t,mapStart:r,mapEnd:n}}}function gr(e){let t=e.map(e=>dr(e)).filter(d),n=br();return e=>{let r=n(e);return t.forEach(t=>t(e)),r}}function _r(e){let t=e.operations?.createResetState();return e=>(t?.remove(),e)}function vr(e){let t=e.map(e=>_r(e)).filter(e=>e!=null);return e=>(t.forEach(t=>t(e)),e)}function yr(){let e=0,t=0,n=0;return r=>{r.action===`start`&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z??0);let i=r.mapEnd.x-e,a=r.mapEnd.y-t,o=(r.mapEnd.z??0)-n;return e=r.mapEnd.x,t=r.mapEnd.y,n=r.mapEnd.z,{...r,mapDeltaX:i,mapDeltaY:a,mapDeltaZ:o,mapDeltaSpatialReference:r.mapStart.spatialReference}}}function br(){let e=0,t=0,n=0;return r=>{r.action===`start`&&(e=r.mapStart.x,t=r.mapStart.y,n=r.mapStart.z??0);let i=r.mapEnd.x-e,a=r.mapEnd.y-t,o=(r.mapEnd.z??0)-n;return{...r,translationX:i,translationY:a,translationZ:o}}}function xr(){let e=0,t=0;return n=>{n.action===`start`&&(e=n.screenStart.x,t=n.screenStart.y);let r=n.screenEnd.x-e,i=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:r,screenDeltaY:i}}}function Sr(e,t){let n=null,r=0,i=0;return a=>{if(a.action===`start`&&(n=e.toScreen?.(t),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(r=a.screenStart.x-n.x,i=a.screenStart.y-n.y))),n==null)return null;let o=se(a.screenEnd.x-r,0,e.width),s=se(a.screenEnd.y-i,0,e.height),c=ce(o,s);return a.screenStart=n,a.screenEnd=c,a}}var Cr=()=>{},wr=class e{constructor(){this.execute=Cr}next(t,n=new e){return t!=null&&(this.execute=e=>{let r=t(e);r!=null&&n.execute(r)}),n}};function Tr(e,t,n=[]){if(e.type===`2d`)return e=>e;let r=null;return i=>{i.action===`start`&&(r=e.toMap(i.screenStart,{exclude:n}),r!=null&&(r.z=Be(r,e,t)));let a=e.toMap(i.screenEnd,{exclude:n});a!=null&&(a.z=Be(a,e,t));let o=r!=null&&a!=null?{sceneStart:r,sceneEnd:a}:null;return{...i,scenePoints:o}}}function Er(e,t,n){let r=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,`scene`)??0,i=Jt(e);return i.z=r,i.hasZ=!0,i.z=Be(i,t,n),i}function Dr(e,t){if(e.type===`2d`)return e=>e;let n=null;return r=>{r.action===`start`&&(n=Er(r.mapStart,e,t));let i=Er(r.mapEnd,e,t),a=n!=null&&i!=null?{sceneStart:n,sceneEnd:i}:null;return{...r,scenePoints:a}}}function Or({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:r,useZ:i=!0}){let a=new wr;if(t==null)return{snappingStep:[Lr,a],cancelSnapping:Lr};let o,s=null,c=null,l=null,u=()=>{s=le(s),t.doneSnapping(),c?.frameTask.remove(),c=null,o=ge(o),l=null},d=kr(t,i,a),f=null,p=null,m=null;return{snappingStep:[a=>{if(!e(a))return a;let{action:h}=a;if(h===`start`){let{info:e}=a,r=Ar(t.view);if(c=jr(n,a,r),c.context.selfSnappingZ=null,!i&&e!=null){let t=Ir(n.coordinateHelper,e.handle.part);t!=null&&(c.context.selfSnappingZ={value:t,elevationInfo:n.elevationInfo??We})}}if(c!=null){let{context:e,originalScenePos:n,originalPos:u}=c,{mapEnd:g,mapStart:_,scenePoints:ee}=a,v=Mr(u,Pr(g,_)),y=Pr(_,u),b={...a,action:`update`},x=c.context,S=Nr(n,ee),C=t.update({point:v,scenePoint:S,context:e});if(m=C,Fr(g,C,y,i),f=v,p=S,h!==`end`){let{frameTask:e}=c;s??=new AbortController,l=t=>{r.addPromise(xe(d({frameTask:e,event:b,context:x,point:v,scenePoint:S,delta:y,getLastState:()=>({point:f,scenePoint:p,updatePoint:t.forceUpdate?null:m})},s.signal)))},l({forceUpdate:!1}),o??=E(()=>t.options.effectiveEnabled,()=>l?.({forceUpdate:!0}))}}return h===`end`&&u(),a},a],cancelSnapping:e=>(u(),e)}}function kr(e,t,n){return u(async({frameTask:r,point:i,scenePoint:a,context:o,event:s,delta:c,getLastState:l},u)=>{let d=await r.schedule(()=>e.snap({point:i,scenePoint:a,context:o,signal:u}),u);if(d.valid){let a=await r.schedule(()=>d.apply(),u),f=l();f.point!=null&&i!==f.point&&(a=e.update({point:f.point,scenePoint:f.scenePoint,context:o})),f.updatePoint!=null&&Ut(a,f.updatePoint)||(Fr(s.mapEnd,a,c,t),n.execute(s))}})}function Ar(e){return e.type===`3d`?e.resourceController.scheduler.registerTask(x.SNAPPING):t}function jr(e,t,n){return{context:new Pt({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info==null?null:t.info.handle,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin==null?t.mapStart:e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin),originalScenePos:t.scenePoints==null?null:t.scenePoints.sceneStart,frameTask:n}}function Mr(e,[t,n,r]){let i=Jt(e);return i.x+=t,i.y+=n,i.hasZ&&(i.z+=r),i}function Nr(e,t){return e==null||t==null?null:Mr(e,Pr(t.sceneEnd,t.sceneStart))}function Pr(e,t){let n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function Fr(e,t,[n,r,i],a){e.x=t.x+n,e.y=t.y+r,a&&e.hasZ&&t.hasZ&&(e.z=t.z+i)}function Ir(e,t){if(!e.hasZ())return null;let n=t.vertices,r=null;for(let t of n){let n=e.getZ(t.pos);if(r!=null&&n!=null&&Math.abs(n-r)>1e-6)return null;r??=n}return r}function Lr(e){return e}var Z=class extends re{constructor(e){super(e),this.constrainResult=e=>e,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=u(async(e,t,n,r)=>{let i=this._frameTask;if(i==null)return;let a=await i.schedule(()=>t.snap({...e,context:n,signal:r}),r);a.valid&&await i.schedule(()=>{this.stagedPoint=a.apply(),e!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=t.update({...this._snapPoints,context:n}))},r)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){let e=this.view.type===`3d`?this.view?.resourceController?.scheduler:null;this._frameTask=e==null?t:e.registerTask(x.SNAPPING)}destroy(){this._abortController=le(this._abortController),this._frameTask=ge(this._frameTask)}update(e,t,n){this._snapPoints=e;let{point:r,scenePoint:i}=e,a=t.update({point:r,scenePoint:i,context:n});return this.stagedPoint=a,a}async snap(e,t,n){let{point:r,scenePoint:i}=e;return this.stagedPoint=t.update({point:r,scenePoint:i,context:n}),this._snapPoints=e,this._abortController??=new AbortController,this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=le(this._abortController),this._snapPoints=null}};w([a({constructOnly:!0})],Z.prototype,`view`,void 0),w([a()],Z.prototype,`stagedPoint`,null),w([a()],Z.prototype,`constrainResult`,void 0),w([a()],Z.prototype,`_stagedPoint`,void 0),Z=w([_(`esri.views.interactive.snapping.SnappingOperation`)],Z);var Rr=`progress`,zr=Symbol(),Br=Symbol(),Q=class extends Ce{constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new qt,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new _e,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=ze(yn),this._getPolylineOrPolygonConstraint=ze(bn),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new et,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo??(this.elevationInfo=Ve(!!e.hasZ))}initializePointer(){let e=this.view.inputManager?.latestPointerInfo;e!=null&&this._updatePointer(e.location,e.id,e.type)}initialize(){let{geometryType:e,view:t}=this,n=t.spatialReference,r=`viewingMode`in t.state?t.state.viewingMode:2,i=e===`segment`||e===`multipoint`?`polyline`:e;this.coordinateHelper=Ft(this.hasZ,this.hasM,n),this._editGeometryOperations=new kt(new Dt(i,this.coordinateHelper),r),this._snappingOperation=new Z({view:t}),this.addHandles([E(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:e,constraint:t},n)=>{let{snappingOptions:r}=this;if(r&&(r.forceDisabled=t!=null&&dt(t)),n!=null&&e===n.stagedPoint&&t!==n.constraint)return this._onKeyboardBasedChange();this._processCursor(e??this._screenToMap(this._stagedScreenPoint))},{equals:(e,t)=>e.stagedPoint===t.stagedPoint&&ue(e.constraint,t.constraint)}),E(()=>this.view.viewpoint,(e,t)=>{e&&t&&S(e,t)&&this._onKeyboardBasedChange()})]),this._activePart=new Ct(n,r),this._editGeometryOperations.data.parts.push(this._activePart);let a=this.segmentLabels;a!=null&&(a.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},this.addHandles(E(()=>this.labelOptions.enabled,e=>{a.visible=e},Se))),this.addHandles(this._editGeometryOperations.on([`vertex-add`,`vertex-update`,`vertex-remove`],e=>{let t=e.vertices.map(e=>({componentIndex:0,vertexIndex:e.index,coordinates:this.coordinateHelper.vectorToArray(e.pos)})),n=t.map(e=>e.coordinates),r=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.getFirstVertex()?.pos)??null;Ut(r,this.firstVertex)||(this.firstVertex=r);let i=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.getLastVertex()?.pos)??null;Ut(i,this.lastVertex)||(this.lastVertex=i);let a=this.coordinateHelper.vectorToDehydratedPoint(this._activePart.segments.at(-1)?.leftVertex?.pos)??null;switch(Ut(a,this.secondToLastVertex)||(this.secondToLastVertex=a),this._processCursor(this.cursorVertex),e.type){case`vertex-add`:this.emit(e.type,{...e,added:n,vertices:t});break;case`vertex-update`:this.emit(e.type,{...e,updated:n,vertices:t});break;case`vertex-remove`:this.emit(e.type,{...e,removed:n,vertices:t})}}));let o=this._manipulator=new X({consumesClicks:!1,grabbableForEvent:e=>this.drawingMode!==`click`||e.pointerType===`touch`&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(o),o.grabbable=e!==`point`&&e!==`multipoint`,this.addHandles([o.events.on(`immediate-click`,e=>this._onImmediateClick(e)),o.events.on(`immediate-double-click`,e=>this._onImmediateDoubleClick(e)),E(()=>this.drawingMode,()=>{this.removeHandles(zr),this.addHandles(this._createManipulatorDragPipeline(o),zr)},Se),E(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:e})=>{o.cursor=e},Se)]),it(this,()=>{let e=this.view.inputManager.latestPointerInfo?.type??`mouse`,t=this._getSnappingContext(e);if(this.snappingManager!=null){let e=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,t);this._updatingHandles.addPromise(xe(e))}})}destroy(){D(this.segmentLabels),D(this._snappingOperation),this._editGeometryOperations=D(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){let{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){let e=this._updateAndGetEffectiveDrawSurface();return this.view.type===`3d`&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activePart.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){let{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case`point`:case`multipoint`:return this._getPointConstraint(e);case`polygon`:case`polyline`:return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set(`drawingMode`,e??`click`)}get effectiveCursor(){return this.loading?Rr:this._hideDefaultCursor?null:this.cursor||`crosshair`}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activePart.vertices.length}get snappingOptions(){return this.snappingManager==null?null:this.snappingManager.options}get cursorVertex(){return this._get(`cursorVertex`)}get visualizationCursorVertex(){return this._stagedPointerType===`mouse`?this.cursorVertex:null}get committableVertex(){let{cursorVertex:e,lastVertex:t,firstVertex:n,geometryType:r}=this;return r===`polygon`&&Ht(e,n)||Ht(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){let{committedVertices:e,committableVertex:t,coordinateHelper:n}=this,r=e.slice();return t!=null&&r.push(n.pointToArray(t)),r}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();let{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e),this._activePart)}complete(e){let t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();let{geometryType:n,numCommittedVertices:r}=this,i=n===`multipoint`&&r===0||n===`polyline`&&r<2||n===`polygon`&&r<3;n!==`segment`&&n!==`point`||this.commitStagedVertex(),this._createOperationCompleted=!i,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit(`complete`,{vertices:this.committedVertices.map((e,t)=>({componentIndex:0,vertexIndex:t,coordinates:e})),aborted:t,type:`complete`}))}onInputEvent(e){switch(e.type){case`pointer-down`:this._pointerDownStates.add(e.pointerId);break;case`pointer-up`:this._pointerDownStates.delete(e.pointerId)}switch(e.type){case`pointer-move`:return this._onPointerMove(e);case`hold`:return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){let t=b(this.cursorVertex),n=b(e),r=n&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(n)??n),i=this._snapToClosingVertex(r),a=this._applyConstraints(i);Ht(t,a)||(this._set(`cursorVertex`,a),this.segmentLabels?.set(`stagedVertex`,a==null?null:this.coordinateHelper.pointToVector(a)),a==null||this._stagedPointerType!==`mouse`?this.emit(`cursor-remove`):this.emit(`cursor-update`,{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activePart.vertices.length,coordinates:this.coordinateHelper.pointToArray(a)}],operation:`apply`,type:`vertex-update`}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!==`polygon`||this.numCommittedVertices<=2)return e;let t=this._mapToScreen(e);if(!t)return e;let n=this._activePart;return this._vertexWithinPointerDistance(n.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case`click`:return this._createManipulatorDragPipelineClick(e);case`freehand`:return this._createManipulatorDragPipelineFreehand(e);case`hybrid`:return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return lr(e,(e,t,n,r)=>{let i=r===`touch`&&this._snappingEnabled;if(this.isCompleted||!i)return;let{snappingStep:a,cancelSnapping:o}=Or({predicate:()=>i,snappingManager:this.snappingManager,snappingContext:new Pt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:r,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next(e=>(i&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),e)).next(o),t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._processCursor(e.mapStart),(this.geometryType===`segment`||i&&!this.numCommittedVertices)&&this.commitStagedVertex()),e)).next(Tr(this.view,this.elevationInfo)).next(...a).next(e=>(i&&(this._processCursor(e.mapEnd),e.action===`end`&&this.commitStagedVertex()),e)).next(e=>(e.action===`end`&&(this._stagedPointerType!==`mouse`&&this._snappingOperation.abort(),this.geometryType!==`segment`&&this.geometryType!==`point`||this.complete()),e))})}_createManipulatorDragPipelineFreehand(e){return lr(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._snappingOperation.abort(),this.committableVertex??this._processCursor(e.mapStart),this.geometryType===`segment`&&this.commitStagedVertex()),e)).next(e=>{switch(e.action){case`start`:case`update`:this._processCursor(e.mapEnd),this.geometryType!==`polygon`&&this.geometryType!==`polyline`||this.commitStagedVertex();break;case`end`:this.complete()}return e})})}_createManipulatorDragPipelineHybrid(e){return lr(e,(e,t)=>{this.isCompleted||t.next(this._screenToMapDragEventStep()).next(e=>(e.action===`start`&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),Br),this._processCursor(e.mapStart),this.commitStagedVertex()),e)).next(e=>{switch(e.action){case`start`:case`update`:this._processCursor(e.mapEnd),this.geometryType!==`polygon`&&this.geometryType!==`polyline`||this.commitStagedVertex();break;case`end`:this._stagedPointerType!==`mouse`&&this._snappingOperation.abort(),this.removeHandles(Br),this.geometryType!==`segment`&&this.geometryType!==`point`||this.complete()}return e})})}get _drawAtFixedElevation(){let{constraintsEnabled:e,constraintZ:t,geometryType:n,numCommittedVertices:r}=this;return e?t!=null||n===`segment`&&r>0:(n===`segment`||n===`polygon`)&&r>0}_updateAndGetEffectiveDrawSurface(){let{constraintsEnabled:e,coordinateHelper:t,drawSurface:n,elevationDrawSurface:r,snapToSceneEnabled:i}=this;if(r==null)return n;if(!this.hasZ)return r.defaultZ=null,r;let a=this.elevationInfo?.mode,o=this.defaultZ,s=e||a===`absolute-height`;return i!=null&&(s=i),a===`on-the-ground`&&(s=!1),this._drawAtFixedElevation&&(o=(e?this.constraintZ:null)??t.getZ(this._activePart.vertices[0].pos),s=!1),s?n:(r.defaultZ=o,r)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode===`click`&&e.pointerType===`touch`&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType===`mouse`&&e.button===2||this._manipulator.dragging))try{let{drawingMode:t,geometryType:n}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;let r=this._screenToMap(e.screenPoint);if(r==null||r==null||t===`freehand`&&n!==`point`&&n!==`multipoint`)return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(r),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!==`mouse`&&this._processCursor(null),(t===`freehand`&&this.geometryType!==`multipoint`||n===`point`||n===`segment`&&this.numCommittedVertices===2||n===`segment`&&t===`hybrid`&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType===`point`||(this.complete(),e.stopPropagation())}_onPointerMove(e){let t=ce(e.x,e.y);this._updatePointer(t,e.pointerId,e.pointerType)&&e.stopPropagation()}_updatePointer(e,t,n){return this._stagedScreenPoint=e,this._stagedPointerType=n,this._stagedPointerId=t,this._isDragging?(this._snappingOperation.abort(),!1):(this._processCursorMovementRelativeToSurface(e,n),!0)}_onKeyboardBasedChange(){this._stagedPointerType===`mouse`&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){let n=this._snappingOperation,r=this._screenToMap(e),i=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(r==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;let a=this.snappingManager;if(a==null)return this._processCursor(r),void n.abort();let o=this._getSnappingContext(t);this._updatingHandles.addPromise(xe(n.snap({point:r,scenePoint:i},a,o)))}_applyConstraints(e){let{_constraint:t,constraints:n}=this;if(!e||!n||!t)return e;let{context:r}=n,i=Cn(e,r),a=i?t.closestTo(i):void 0;if(!a)return e;let o=wn(a,e,r),s=this.view.type===`2d`||r.elevationInfo.mode!==`absolute-height`;return o!=null&&s&&this.constraintZ!=null&&this.hasZ&&(o.z=this.constraintZ),o}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action===`start`&&(e=this._screenToMap(t.screenStart)),e==null)return null;let n=this._screenToMap(t.screenEnd);return n==null?null:{...t,mapStart:e,mapEnd:n}}}_vertexWithinPointerDistance(e,t){let n=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return n!=null&&Vr(n,t,25)}_getSnappingContext(e){let t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new Pt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t==null?null:{value:t,elevationInfo:this.elevationInfo},drawConstraints:this.constraints})}};function Vr(e,t,n){let r=e.x-t.x,i=e.y-t.y;return r*r+i*i<=n}w([a()],Q.prototype,`_hideDefaultCursor`,void 0),w([a()],Q.prototype,`_stagedPointerId`,void 0),w([a()],Q.prototype,`_isDragging`,null),w([a()],Q.prototype,`_snappingOperation`,void 0),w([a()],Q.prototype,`_snappingEnabled`,null),w([a({constructOnly:!0})],Q.prototype,`graphic`,void 0),w([a()],Q.prototype,`constraintsEnabled`,void 0),w([a()],Q.prototype,`constraints`,void 0),w([a()],Q.prototype,`_constraint`,null),w([a()],Q.prototype,`constraintZ`,void 0),w([a()],Q.prototype,`defaultZ`,void 0),w([a()],Q.prototype,`isDraped`,void 0),w([a({constructOnly:!0})],Q.prototype,`automaticLengthMeasurementUtils`,void 0),w([a({value:sr})],Q.prototype,`drawingMode`,null),w([a({constructOnly:!0})],Q.prototype,`elevationDrawSurface`,void 0),w([a({constructOnly:!0})],Q.prototype,`elevationInfo`,void 0),w([a({constructOnly:!0,type:et})],Q.prototype,`labelOptions`,void 0),w([a({constructOnly:!0})],Q.prototype,`geometryType`,void 0),w([a({constructOnly:!0})],Q.prototype,`hasM`,void 0),w([a({constructOnly:!0})],Q.prototype,`hasZ`,void 0),w([a()],Q.prototype,`cursor`,void 0),w([a()],Q.prototype,`effectiveCursor`,null),w([a()],Q.prototype,`loading`,void 0),w([a({constructOnly:!0})],Q.prototype,`manipulators`,void 0),w([a({constructOnly:!0})],Q.prototype,`drawSurface`,void 0),w([a({constructOnly:!0})],Q.prototype,`segmentLabels`,void 0),w([a({constructOnly:!0})],Q.prototype,`snappingManager`,void 0),w([a({constructOnly:!0})],Q.prototype,`snappingVisualizer`,void 0),w([a()],Q.prototype,`snapToSceneEnabled`,void 0),w([a({readOnly:!0})],Q.prototype,`cursorVertex`,null),w([a({readOnly:!0})],Q.prototype,`visualizationCursorVertex`,null),w([a()],Q.prototype,`committableVertex`,null),w([a()],Q.prototype,`firstVertex`,void 0),w([a()],Q.prototype,`lastVertex`,void 0),w([a()],Q.prototype,`secondToLastVertex`,void 0),w([a()],Q.prototype,`updating`,null),w([a({constructOnly:!0})],Q.prototype,`view`,void 0),Q=w([_(`esri.views.draw.DrawOperation`)],Q);var Hr=class{constructor(e,t,n,r=null){this._elevationInfo=e,this.defaultZ=t,this._view=n,this._excludeGraphics=r}screenToMap(e){let{defaultZ:t,_view:n}=this,r=n.sceneIntersectionHelper.intersectElevationFromScreen(y(e.x,e.y),this._elevationInfo,t??0,this._excludeGraphics);return t==null&&r!=null&&(r.z=void 0),r}mapToScreen(e){let t=Le(e.x,e.y,Ge(this._view,e,this._elevationInfo),e.spatialReference);return this._view.toScreen(t)}constrainZ(e){let{defaultZ:t}=this;return t!=null&&e.z!==t&&((e=Jt(e)).z=t),e}},Ur=class{constructor(e,t,n=[]){this.view=e,this.elevationInfo=t,this.exclude=n}screenToMap(e){let t=this.view.toMap(e,{exclude:this.exclude,excludeLabels:!0});return t!=null&&(t.z=Be(t,this.view,this.elevationInfo)),t}mapToScreen(e){let t=e;return this.elevationInfo!=null&&(t=Le(e.x,e.y,Ge(this.view,e,this.elevationInfo),e.spatialReference)),this.view.toScreen(t)}constrainZ(e){return e}},Wr=class{constructor(e,t=!1,n=0){this.view=e,this.hasZ=t,this.defaultZ=n,this.mapToScreen=t=>e.toScreen(t),this.screenToMap=t?t=>{let r=e.toMap(t);return r.z=n,r}:t=>e.toMap(t)}constrainZ(e){let{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=Jt(e)).z=t),e}};(class e{screenToMap(t){let{x:n,y:r}=t;return new ve({x:n,y:r,spatialReference:e.spatialReference})}mapToScreen(e){return ce(e.x,e.y)}constrainZ(e){return e}static{this.spatialReference=new Ae}});function Gr(e){let t=0,n=0,r=0;return e?(e.type===`cim`&&e.data.symbol&&`symbolLayers`in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map(e=>{e.type===`CIMVectorMarker`&&e.anchorPoint&&(Math.abs(e.anchorPoint.x)>t&&(t=e.anchorPoint.x),Math.abs(e.anchorPoint.y)>n&&(n=e.anchorPoint.y),e.size!=null&&e.size>r&&(r=e.size))}),t=T(t),n=T(n),r=T(r),{offsetX:t,offsetY:n,size:r}):{offsetX:t,offsetY:n,size:r}}var $=class extends re{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set(`graphic`,e),this.attachSymbolChanged()}get elevationInfo(){let{layer:e}=this.graphic,t=e&&`elevationInfo`in e?e.elevationInfo:null,n=Ke(this.graphic),r=t?t.offset:0;return new Pe({mode:n,offset:r})}set focusedSymbol(e){e!==this._get(`focusedSymbol`)&&(this._set(`focusedSymbol`,e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get(`grabbing`)&&(this._set(`grabbing`,e),this._updateGraphicSymbol())}set hovering(e){e!==this._get(`hovering`)&&(this._set(`hovering`,e),this._updateGraphicSymbol())}set selected(e){e!==this._get(`selected`)&&(this._set(`selected`,e),this._updateGraphicSymbol(),this.events.emit(`select-changed`,{action:e?`select`:`deselect`}))}get _focused(){return this._get(`hovering`)||this._get(`grabbing`)}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new he,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set(`view`,null)}intersectionDistance(e){let t=this.graphic;if(!1===t.visible)return null;let n=t.geometry;if(n==null)return null;let r=this._get(`focusedSymbol`),i=r??t.symbol;return this.view.type===`2d`?this._intersectDistance2D(this.view,e,n,i):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=E(()=>this.graphic?.symbol,e=>{e!=null&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},te)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(t,n,r,i){if((i||=f(r))==null)return null;let a=this._circleCollisionCache;if(r.type===`point`&&i.type===`cim`&&i.data.symbol?.type===`CIMPointSymbol`&&i.data.symbol.symbolLayers){let{offsetX:a,offsetY:o,size:s}=Gr(i),c=e(n,qr),l=s/2,u=t.toScreen(r),d=u.x+a,f=u.y+o;return de(c,[d,f])<l*l?1:null}if(r.type!==`point`||i.type!==`simple-marker`)return Xt(n,r,t)?1:null;if(a==null||!a.originalPoint.equals(r)){let e=r,n=t.spatialReference;if(ee(e.spatialReference,n)){let t=s(e,n);a={originalPoint:e.clone(),mapPoint:t,radiusPx:T(i.size)},this._circleCollisionCache=a}}if(a!=null){let r=e(n,qr),o=t.toScreen?.(a.mapPoint);if(!o)return null;let s=a.radiusPx,c=o.x+T(i.xoffset),l=o.y-T(i.yoffset);return de(r,[c,l])<s*s?1:null}return null}_intersectDistance3D(e,t,n){let r=e.toMap(t,{include:[n]});return r&&Ie(r,Kr,e.renderSpatialReference)?me(Kr,e.state.camera.eye):null}};w([a({constructOnly:!0,nonNullable:!0})],$.prototype,`graphic`,null),w([a()],$.prototype,`elevationInfo`,null),w([a({constructOnly:!0,nonNullable:!0})],$.prototype,`view`,void 0),w([a({value:null})],$.prototype,`focusedSymbol`,null),w([a({constructOnly:!0})],$.prototype,`layer`,void 0),w([a()],$.prototype,`interactive`,void 0),w([a()],$.prototype,`selectable`,void 0),w([a()],$.prototype,`grabbable`,void 0),w([a({value:!1})],$.prototype,`grabbing`,null),w([a()],$.prototype,`dragging`,void 0),w([a()],$.prototype,`hovering`,null),w([a({value:!1})],$.prototype,`selected`,null),w([a()],$.prototype,`cursor`,void 0),$=w([_(`esri.views.interactive.GraphicManipulator`)],$);var Kr=ae(),qr=y();function Jr(e,t){return Xr(e,t,!1)}function Yr(e,t){return Xr(e,t,!0)}function Xr(e,t,n){if(e instanceof Nt){if(e.operation instanceof At)return Zr(e.operation,t,n),!0;if(e.operation instanceof Et)return Qr(e.operation,t,n),!0;if(e.operation instanceof Mt)return $r(e.operation,t,n),!0}return!1}function Zr(e,t,n=!1){let r=n?-1:1,i=Te(r*e.dx,r*e.dy,r*e.dz);g(t.origin,t.origin,i),Zt(t)}function Qr(e,t,n=!1){let r=n?-e.angle:e.angle;c(t.basis1,t.basis1,fe,r),c(t.basis2,t.basis2,fe,r),Zt(t)}function $r(e,t,n=!1){let r=n?1/e.factor1:e.factor1,a=n?1/e.factor2:e.factor2;i(t.basis1,t.basis1,r),i(t.basis2,t.basis2,a),ie(t.origin,t.origin,e.origin,e.axis1,r),ie(t.origin,t.origin,e.origin,e.axis2,a),Zt(t)}function ei(e,t,n,i,a=!1){i||=Qt();let s=r(O.get(),e[1],-e[0]),c=r(O.get(),1/0,1/0),l=r(O.get(),-1/0,-1/0),u=O.get(),d=t.allVerticesUnordered;d.forEach(({pos:t})=>{r(u,Me(e,t),Me(s,t)),De(c,c,u),Ee(l,l,u)});let f=1e-6,p=r(O.get(),l[0]-c[0]<f?n/2:0,l[1]-c[1]<f?n/2:0);ne(c,c,p),o(l,l,p);let m=a?d.reduce((e,t)=>e+(t.pos[2]??0),0)/d.length:0;return je(i.basis1,e,(l[0]-c[0])/2),je(i.basis2,s,(l[1]-c[1])/2),v(i.origin,c[0]*e[0]+c[1]*s[0],c[0]*e[1]+c[1]*s[1],m),g(i.origin,i.origin,i.basis1),g(i.origin,i.origin,i.basis2),Zt(i),i}export{yr as C,q as E,vr as S,ar as T,dr as _,Gr as a,lr as b,Ur as c,wr as d,hr as f,Tr as g,gr as h,$ as i,Q as l,Sr as m,Yr as n,Hr as o,xr as p,Jr as r,Wr as s,ei as t,Or as u,_r as v,J as w,Dr as x,ur as y};