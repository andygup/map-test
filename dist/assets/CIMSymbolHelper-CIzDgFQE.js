const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/bufferOperator-DdZkpCKY.js","assets/index-CzMixifc.js","assets/index-CDgdHpAj.css","assets/Bufferer-Dw9Qi4T1-DhA-VaoB.js","assets/SpatialReference-BzfAMI5E.js","assets/Envelope2D-n2TB2v9l.js","assets/Point2D-BslC4Gs9.js","assets/OperatorDefinitions-DoM9xd5U.js","assets/SimpleGeometryCursor-BbFgAuic.js","assets/Transformation2D-B6W9saMR.js","assets/GeometryCleaner-BEJM7I4l-DmXngI4N.js","assets/OperatorGeneralize-BLGQlbuY.js","assets/OperatorSimplifyOGC-DxjvEeiR.js","assets/memoryEstimations-C3WUBUZI.js","assets/jsonConverter-CYYMdpyx.js","assets/OptimizedGeometry-5fDazGe-.js","assets/operatorBuffer-R3dHRBHV.js","assets/convexHullOperator-B0KTO63v.js","assets/operatorConvexHull-GQ46qBvq.js","assets/lengthOperator-CcAqyK5q.js","assets/generalizeOperator-Db6ZZo-s.js","assets/operatorGeneralize-DuPed5x1.js","assets/graphicBufferOperator-DOYrwC9-.js","assets/offsetOperator-Brtz-vRl.js","assets/operatorOffset-CMFMz4i9.js","assets/simplifyOperator-DxgNjclK.js","assets/operatorSimplify-HaL4veBZ.js","assets/jsonConverter-Brg4vNP0.js"])))=>i.map(i=>d[i]);
import{$b as e,$l as t,$r as n,At as r,Av as i,BS as a,BT as o,Bc as s,Cb as c,Cu as l,Cv as u,Dc as d,Dt as f,Ec as p,Eu as m,Ev as h,Ft as g,Gt as _,Hd as v,Hv as y,It as b,Jl as x,Lc as S,Lt as C,Mt as w,Mv as T,Ot as E,Ou as D,Pc as ee,Qb as te,Ql as ne,SE as re,Sv as O,Tt as k,Tu as ie,Ud as ae,Vb as oe,Wb as se,Xv as ce,Yv as A,Zb as le,Zh as j,_E as ue,bt as de,bv as fe,cn as M,dT as pe,en as me,ey as he,fb as N,fc as ge,fw as _e,ig as P,in as ve,jv as ye,kv as be,lD as xe,pD as Se,qb as Ce,qt as we,rn as Te,ry as Ee,tx as De,uE as Oe,uc as ke,wt as Ae,wx as je,yt as Me,yv as F,zb as Ne}from"./index-CzMixifc.js";import{_ as I,g as Pe,p as Fe}from"./GeometryUtils-C6BJBMi9.js";import{n as L,t as Ie}from"./labelPoint-D95l1mBc.js";import{o as Le}from"./rasterizingUtils-L-rXtdWe.js";import{t as Re}from"./Rect-BMNJQxpm.js";import{t as ze}from"./BoundingBox-CW0_Ka-z.js";import{t as Be}from"./BidiEngine-CpIovbIK.js";var Ve=`arial-unicode-ms`,He=`woff2`,Ue=new Map,We=new Set,Ge=class{constructor(e,t){this.fontFace=e,this.promise=t}};async function Ke(e){let t=Xe(e),n=Ye(e),r=Ue.get(t);if(r)return r.promise;let i=new FontFace(e.family,`url('${ue.fontsUrl}/woff2/${n}.${He}') format('${He}')`,{style:e.style,weight:e.weight}),a=document.fonts;if(a.has(i)&&i.status===`loading`)return i.loaded;let o=i.load().then(()=>(a.add(i),i));return Ue.set(t,new Ge(i,o)),We.add(i),o}function qe(e){return We.has(e)}function Je(e){if(!e)return Ve;let t=e.toLowerCase().split(` `).join(`-`);switch(t){case`serif`:return`noto-serif`;case`sans-serif`:return`arial-unicode-ms`;case`monospace`:return`ubuntu-mono`;case`fantasy`:return`cabin-sketch`;case`cursive`:return`redressed`;default:return t}}function Ye(e){let t=Ze(e)+Qe(e);return Je(e.family)+(t.length>0?t:`-regular`)}function Xe(e){let t=Ze(e)+Qe(e);return(e.family||`arial-unicode-ms`)+(t.length>0?t:`-regular`)}function Ze(e){if(!e.weight)return``;switch(e.weight.toLowerCase()){case`bold`:case`bolder`:return`-bold`}return``}function Qe(e){if(!e.style)return``;switch(e.style.toLowerCase()){case`italic`:case`oblique`:return`-italic`}return``}var $e=w(()=>a(()=>import(`./bufferOperator-DdZkpCKY.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),et=w(()=>a(()=>import(`./convexHullOperator-B0KTO63v.js`),__vite__mapDeps([17,4,1,2,5,6,7,8,9,13,14,15,18]))),tt=w(()=>a(()=>import(`./lengthOperator-CcAqyK5q.js`),__vite__mapDeps([19,1,2,4,5,6,7,8,9,13,14,15]))),nt=w(()=>a(()=>import(`./generalizeOperator-Db6ZZo-s.js`),__vite__mapDeps([20,1,2,4,5,6,7,8,9,11,13,14,15,21]))),rt=w(()=>a(()=>import(`./graphicBufferOperator-DOYrwC9-.js`),__vite__mapDeps([22,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]))),it=w(()=>a(()=>import(`./offsetOperator-Brtz-vRl.js`),__vite__mapDeps([23,1,2,4,5,6,7,8,9,13,14,15,24]))),at=w(()=>a(()=>import(`./simplifyOperator-DxgNjclK.js`),__vite__mapDeps([25,4,1,2,5,6,7,8,9,13,14,15,26]))),ot=w(()=>a(()=>import(`./jsonConverter-Brg4vNP0.js`),__vite__mapDeps([27,4,1,2,5,6,7,8,9,13,14,15]))),st=512,R;function ct(e){switch(e.type){case`CIMGeometricEffectDonut`:case`CIMGeometricEffectBuffer`:return $e.getImportPromise();case`CIMGeometricEffectEnclosingPolygon`:return et.getImportPromise();case`CIMGeometricEffectOffset`:return Promise.all([it.getImportPromise(),rt.getImportPromise()]);case`CIMGeometricEffectTaperedPolygon`:return Promise.all([at.getImportPromise(),tt.getImportPromise(),nt.getImportPromise()]);default:return Promise.resolve()}}function lt(e){return e.type===`CIMMarkerPlacementAtMeasuredUnits`?ot.getImportPromise():Promise.resolve()}var ut=class{constructor(e){this._geometry=e}next(){let e=this._geometry;return this._geometry=null,e}};function dt(e,t,n){if(!e)return null;R||=new Pe(0,0,0,1);let r=n?-1:1,i=e.geometryType===`esriGeometryPolygon`,a=i?3:2,o=i?3:2,s,c;for(R.reset(a),R.setPixelMargin(t+1),R.setExtent(st);e.nextPath();)if(!(e.pathSize<o)){for(e.nextPoint(),s=e.x,c=r*e.y,R.moveTo(s,c);e.nextPoint();)s=e.x,c=r*e.y,R.lineTo(s,c);i&&R.close()}let l=R.result(!1);if(l){let t=L.createEmptyOptimizedCIM(e.geometryType);for(let e of l){t.startPath();for(let n of e)t.pushXY(n.x,r*n.y)}return t.reset(),t}return null}var ft=class{applyColorSubstitution(e,t){if(!t)return e;this._rasterizationCanvas||=document.createElement(`canvas`);let{width:n,height:r}=e,i=this._rasterizationCanvas,a=i.getContext(`2d`,{willReadFrequently:!0});e!==i&&(i.width=n,i.height=r,a.drawImage(e,0,0,n,r));let o=a.getImageData(0,0,n,r).data;if(t){for(let e of t)if(e&&e.oldColor&&e.oldColor.length===4&&e.newColor&&e.newColor.length===4){let[t,n,r,i]=e.oldColor,[a,s,c,l]=e.newColor;if(t===a&&n===s&&r===c&&i===l)continue;for(let e=0;e<o.length;e+=4)t===o[e]&&n===o[e+1]&&r===o[e+2]&&i===o[e+3]&&(o[e]=a,o[e+1]=s,o[e+2]=c,o[e+3]=l)}}let s=new ImageData(o,n,r);return a.putImageData(s,0,0),i}tintImageData(e,t){if(!t||t.length<4)return e;this._rasterizationCanvas||=document.createElement(`canvas`);let{width:n,height:r}=e,i=this._rasterizationCanvas,a=i.getContext(`2d`,{willReadFrequently:!0});e!==i&&(i.width=n,i.height=r,a.drawImage(e,0,0,n,r));let o=a.getImageData(0,0,n,r),s=new Uint8Array(o.data),c=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];for(let e=0;e<s.length;e+=4)s[e]*=c[0],s[e+1]*=c[1],s[e+2]*=c[2],s[e+3]*=c[3];let l=new ImageData(new Uint8ClampedArray(s.buffer),n,r);return a.putImageData(l,0,0),i}},pt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t){return new mt(e,t)}},mt=class{constructor(e,t){this._inputGeometries=e,this._angleTolerance=t.angleTolerance===void 0?120:t.angleTolerance,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();if(!e)return null;for(;e;){if(e.geometryType===`esriGeometryPolygon`)this._isClosed=!0;else if(e.geometryType===`esriGeometryPolyline`)this._isClosed=!1;else{if(e.geometryType!==`esriGeometryEnvelope`){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){let t=e.x,n=e.y,r=t,i=n,a=e.pathSize,o=0,s=0,c=0,l=0,u=0,d=0;this._isClosed&&++a;for(let f=1;e.nextPoint()||f<a;++f){let p,m;this._isClosed&&f===a-1?(p=t,m=n):(p=e.x,m=e.y);let h=p-r,g=m-i,_=Math.sqrt(h*h+g*g);f>1&&_>0&&c>0&&(o*h+s*g)/_/c<=this._maxCosAngle&&e.setControlPointAt(f-1),f===1&&(l=h,u=g,d=_),_>0&&(r=p,i=m,o=h,s=g,c=_)}this._isClosed&&c>0&&d>0&&(o*l+s*u)/d/c<=this._maxCosAngle&&e.setControlPointAt(0)}}},z=class{constructor(){this.setIdentity()}getAngle(){return(this.rz==null||this.rz===0&&this.rzCos!==1&&this.rzSin!==0)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rzCos=e,this.rzSin=t}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}};function ht(e,t){e[4]=t}var B=class{constructor(e,t=!0,n=!0,r=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!t&&e.geometryType===`esriGeometryPolygon`||!n&&e.geometryType===`esriGeometryPolyline`?null:e,this.geomUnitsPerPoint=r,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new z}next(){if(!this.geometryCursor)return null;let e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;let t=this.processPath(e);if(t)return t}return this.iterateMultiPath=!1,null}},V=class{constructor(e,t,n,r=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=n,this.geomUnitsPerPoint=r,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&e.geometryType===`esriGeometryPolygon`||e.geometryType===`esriGeometryEnvelope`,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();let e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}},gt=.03,H=class{constructor(e=0,t=!1){}isEmpty(e){if(!e.nextPoint())return!0;let t,n,r,i;for(t=e.x,n=e.y;e.nextPoint();t=n,n=i)if(r=e.x,i=e.y,r!==t||i!==n)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){let t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);t!==0&&(e[0]/=t,e[1]/=t)}getLength(e,t,n,r){let i=n-e,a=r-t;return Math.sqrt(i*i+a*a)}getSegLength(e){let[[t,n],[r,i]]=e;return this.getLength(t,n,r,i)}getCoord2D(e,t,n,r,i){return[e+(n-e)*i,t+(r-t)*i]}getSegCoord2D(e,t){let[[n,r],[i,a]]=e;return this.getCoord2D(n,r,i,a,t)}getAngle(e,t,n,r,i){let a=n-e,o=r-t;return Math.atan2(o,a)}getAngleCS(e,t,n,r,i,a){e??=[0,0];let o=r-t,s=i-n,c=Math.sqrt(o*o+s*s);return c===0?(e[0]=1,e[1]=0,e):(e[0]=o/c,e[1]=s/c,e)}getSegAngleCS(e,t,n){let[[r,i],[a,o]]=t;return this.getAngleCS(e,r,i,a,o,n)}cut(e,t,n,r,i,a){return[i<=0?[e,t]:this.getCoord2D(e,t,n,r,i),a>=1?[n,r]:this.getCoord2D(e,t,n,r,a)]}getSubCurve(e,t,n){let r=L.createEmptyOptimizedCIM(`esriGeometryPolyline`);return this.appendSubCurve(r,e,t,n)?r:null}appendSubCurve(e,t,n,r){e.startPath(),t.seekPathStart();let i=0,a=!0;if(!t.nextPoint())return!1;let o=t.x,s=t.y;for(;t.nextPoint();){let c=this.getLength(o,s,t.x,t.y);if(c!==0){if(a){if(i+c>n){let l=(n-i)/c,u=1,d=!1;i+c>=r&&(u=(r-i)/c,d=!0);let f=this.cut(o,s,t.x,t.y,l,u);if(f&&e.pushPoints(f),d)break;a=!1}}else{if(i+c>r){let n=this.cut(o,s,t.x,t.y,0,(r-i)/c);n&&e.pushPoint(n[1]);break}e.pushXY(t.x,t.y)}i+=c,o=t.x,s=t.y}else o=t.x,s=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let n,r,i,a,o=0;for(n=e.x,r=e.y;e.nextPoint();n=i,r=a){i=e.x,a=e.y;let s=this.getLength(n,r,i,a);if(s!==0){if(o+s>t){let e=(t-o)/s;return this.getCoord2D(n,r,i,a,e)}o+=s}}return null}offset(e,t,n,r,i){if(!e||e.length<2)return null;let a=0,o=e[a++],s=a;for(;a<e.length;){let t=e[a];t[0]===o[0]&&t[1]===o[1]||(a!==s&&(e[s]=e[a]),o=e[s++]),a++}let c=e[0][0]===e[s-1][0]&&e[0][1]===e[s-1][1];if(c&&--s,s<(c?3:2))return null;let l=[];o=c?e[s-1]:null;let u=e[0];for(let i=0;i<s;i++){let a=i===s-1?c?e[0]:null:e[i+1];if(o)if(a){let e=[a[0]-u[0],a[1]-u[1]];this.normalize(e);let i=[u[0]-o[0],u[1]-o[1]];this.normalize(i);let s=i[0]*e[1]-i[1]*e[0],c=i[0]*e[0]+i[1]*e[1];if(s===0&&c===1){u=a;continue}if(s>=0==t<=0){if(c<1){let n=[e[0]-i[0],e[1]-i[1]];this.normalize(n);let a=Math.sqrt((1+c)/2);if(a>1/r){let e=-Math.abs(t)/a;l.push([u[0]-n[0]*e,u[1]-n[1]*e])}}}else switch(n){case`Mitered`:{let n=Math.sqrt((1+c)/2);if(n>0&&1/n<r){let r=[e[0]-i[0],e[1]-i[1]];this.normalize(r);let a=Math.abs(t)/n;l.push([u[0]-r[0]*a,u[1]-r[1]*a]);break}}case`Bevelled`:l.push([u[0]+i[1]*t,u[1]-i[0]*t]),l.push([u[0]+e[1]*t,u[1]-e[0]*t]);break;case`Rounded`:if(c<1){l.push([u[0]+i[1]*t,u[1]-i[0]*t]);let n=Math.floor(2.5*(1-c));if(n>0){let r=1/n,a=r;for(let o=1;o<n;o++,a+=r){let n=[i[1]*(1-a)+e[1]*a,-i[0]*(1-a)-e[0]*a];this.normalize(n),l.push([u[0]+n[0]*t,u[1]+n[1]*t])}}l.push([u[0]+e[1]*t,u[1]-e[0]*t])}break;default:if(s<0)l.push([u[0]+(i[1]+i[0])*t,u[1]+(i[1]-i[0])*t]),l.push([u[0]+(e[1]-e[0])*t,u[1]-(e[0]+e[1])*t]);else{let n=Math.sqrt((1+Math.abs(c))/2),r=[e[0]-i[0],e[1]-i[1]];this.normalize(r);let a=t/n;l.push([u[0]-r[0]*a,u[1]-r[1]*a])}}}else{let e=[u[0]-o[0],u[1]-o[1]];this.normalize(e),l.push([u[0]+e[1]*t,u[1]-e[0]*t])}else{let e=[a[0]-u[0],a[1]-u[1]];this.normalize(e),l.push([u[0]+e[1]*t,u[1]-e[0]*t])}o=u,u=a}return l.length<(c?3:2)?null:(c&&l.push([l[0][0],l[0][1]]),l)}},_t=1.7320508075688772,vt=5,yt=`OpenEnded`,bt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new xt(e,t,n)}},xt=class extends V{constructor(e,t,n){super(e,!1,!0),this._curveHelper=new H,this._width=(t.width===void 0?vt:t.width)*n,this._arrowType=t.geometricEffectArrowType===void 0?t.arrowType===void 0?yt:t.arrowType:t.geometricEffectArrowType,this._offsetFlattenError=gt*n}processPath(e){let t=L.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case`OpenEnded`:default:this._constructSimpleArrow(t,e,!0);break;case`Block`:this._constructSimpleArrow(t,e,!1);break;case`Crossed`:this._constructCrossedArrow(t,e)}return t}_constructSimpleArrow(e,t,n){let r=t.pathLength(),i=this._width;r<2*i&&(i=r/2);let a=this._curveHelper.getSubCurve(t,0,r-i);if(!a||!a.nextPath())return;a.seekPathStart();let o=i/2;if(this._curveHelper.isEmpty(a))return;let s=A(a),c=this._constructOffset(s,-o);if(!c)return;let l=this._constructOffset(s,o);if(!l)return;let u=this._constructArrowBasePoint(c,-o/2);if(!u)return;let d=this._constructArrowBasePoint(l,o/2);if(!d)return;t.seekInPath(t.pathSize-1);let f=[t.x,t.y];e.pushPath(l),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(u),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),n||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(l[0])),e.reset()}_constructCrossedArrow(e,t){let n=t.pathLength(),r=this._width;n<r*(1+_t+1)&&(r=n/(1+_t+1)),t.seekPathStart();let i=this._curveHelper.getSubCurve(t,0,n-r*(1+_t));if(!i)return;i.nextPath();let a=r/2;if(this._curveHelper.isEmpty(i))return;let o=A(i),s=this._constructOffset(o,a);if(!s)return;let c=this._constructOffset(o,-a);if(!c)return;let l=this._curveHelper.getSubCurve(t,0,n-r);if(!l||(l.nextPath(),this._curveHelper.isEmpty(l)))return;let u=A(l),d=this._constructOffset(u,a);if(!d)return;let f=this._constructOffset(u,-a);if(!f)return;let p=d[d.length-1],m=this._constructArrowBasePoint(d,a/2);if(!m)return;let h=f[f.length-1],g=this._constructArrowBasePoint(f,-a/2);if(!g)return;t.seekInPath(t.pathSize-1);let _=[t.x,t.y];e.pushPath(s),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,`Rounded`,4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;let n=e[e.length-2],r=e[e.length-1],i=[r[0]-n[0],r[1]-n[1]];return this._curveHelper.normalize(i),[r[0]+i[1]*t,r[1]-i[0]*t]}},St=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n,r,i,a){return new Ct(e,t,n,r,i,a)}},Ct=class{constructor(e,t,n,r,i,a){this._preventClipping=a,this._inputGeometries=e,this._tileKey=r,this._curveHelper=new H,this._size=(t.size===void 0?1:t.size)*n,this._maxInflateSize=i*n,this._offsetFlattenError=gt*n}next(){let e;for(;e=this._inputGeometries.next();){if(this._size===0)return e;if(e.geometryType===`esriGeometryEnvelope`){if(this._size>0){let t=L.createEmptyOptimizedCIM(e.geometryType),n=ce(e)[0],r=this._curveHelper.offset(n,this._size,`Rounded`,4,this._offsetFlattenError);if(r)return t.pushPath(r),t}else if(this._size<0){let t=e.asJSON();if(Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._size>0)return L.fromJSONCIM({xmin:t.xmin-this._size,xmax:t.xmax+this._size,ymin:t.ymin-this._size,ymax:t.ymax+this._size})}}let t=!this._preventClipping&&this._tileKey?dt(e,this._maxInflateSize,!0):e;if(!t)continue;let n=$e.module,r={...t.asJSON(),spatialReference:{wkid:je.WebMercator.wkid}},i=n.execute(r,this._size);return i?L.fromJSONCIM(i):null}return null}},wt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new Tt(e,t,n)}},Tt=class{constructor(e,t,n){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=n,this._rule=t.rule??`FullGeometry`,this._defaultSize=this._defaultPointSize*n}next(){let e;for(;e=this._inputGeometries.next();){let t=this._processGeom(ce(e));if(t?.length)return L.fromJSONCIM({paths:t})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,n,r){return[e[0]*t+n[0]*r,e[1]*t+n[1]*r]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,n){return[e[0]+t,e[1]+n]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,t=1){let n=t/this._norm(e);e[0]*=n,e[1]*=n}_leftPerpendicular(e){let t=-e[1],n=e[0];e[0]=t,e[1]=n}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){let t=e[1],n=-e[0];e[0]=t,e[1]=n}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,n){let r=e[0]*t-e[1]*n,i=e[0]*n+e[1]*t;e[0]=r,e[1]=i}_makeCtrlPt(e){let t=[e[0],e[1]];return ht(t,1),t}_addAngledTicks(e,t,n,r){let i=this._sub(n,t);this._normalize(i);let a=this._crossProduct(i,this._sub(r,t)),o;o=a>0?this._rightPerp(i):this._leftPerp(i);let s=Math.abs(a)/2,c=[];c.push([t[0]+(o[0]-i[0])*s,t[1]+(o[1]-i[1])*s]),c.push(t),c.push(n),c.push([n[0]+(o[0]+i[0])*s,n[1]+(o[1]+i[1])*s]),e.push(c)}_addBezier2(e,t,n,r,i){if(i--===0)return void e.push(r);let a=this._mid(t,n),o=this._mid(n,r),s=this._mid(a,o);this._addBezier2(e,t,a,s,i),this._addBezier2(e,s,o,r,i)}_addBezier3(e,t,n,r,i,a){if(a--===0)return void e.push(i);let o=this._mid(t,n),s=this._mid(n,r),c=this._mid(r,i),l=this._mid(o,s),u=this._mid(s,c),d=this._mid(l,u);this._addBezier3(e,t,o,l,d,a),this._addBezier3(e,d,u,c,i,a)}_add90DegArc(e,t,n,r,i){let a=i??this._crossProduct(this._sub(n,t),this._sub(r,t))>0,o=this._mid(t,n),s=this._sub(o,t);a?this._leftPerpendicular(s):this._rightPerpendicular(s),o[0]+=s[0],o[1]+=s[1],this._addBezier3(e,t,this._mix(t,.33333,o,.66667),this._mix(n,.33333,o,.66667),n,4)}_addArrow(e,t,n){let r=t[0],i=t[1],a=t[t.length-1],o=this._sub(r,i),s=this._norm(o);this._normalize(o);let c=Math.abs(this._crossProduct(o,this._sub(a,i))),l=this._dotProduct(o,this._sub(a,i));l<.05*s?l=.05*s:l>.95*s&&(l=.95*s);let u=.5*c,d=this._leftPerp(o),f=[i[0]+o[0]*l,i[1]+o[1]*l],p=t.length-1,m=[];m.push(n?[-d[0],-d[1]]:d);let h=[-o[0],-o[1]];for(let e=1;e<p-1;e++){let n=this._sub(t[e+1],t[e]);this._normalize(n);let r=this._dotProduct(n,h),i=this._crossProduct(n,h),a=Math.sqrt((1+r)/2),o=this._sub(n,h);this._normalize(o),o[0]/=a,o[1]/=a,m.push(i<0?[-o[0],-o[1]]:o),h=n}m.push(this._rightPerp(h));for(let n=m.length-1;n>0;n--)e.push([t[n][0]+m[n][0]*u,t[n][1]+m[n][1]*u]);e.push([f[0]+m[0][0]*u,f[1]+m[0][1]*u]),e.push([f[0]+m[0][0]*c,f[1]+m[0][1]*c]),e.push(r),e.push([f[0]-m[0][0]*c,f[1]-m[0][1]*c]),e.push([f[0]-m[0][0]*u,f[1]-m[0][1]*u]);for(let n=1;n<m.length;n++)e.push([t[n][0]-m[n][0]*u,t[n][1]-m[n][1]*u])}_addDash(e,t,n){let r=this._norm(n)/7;this._normalize(n);let i=[];for(let a=0;a<=7;a++)i.push([t[0]+n[0]*a*r,t[1]+n[1]*a*r]),1&a&&(e.push(i),i=[])}_cp2(e,t,n){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,n*this._defaultSize)}_cp3(e,t,n,r){if(e.length>=3)return e[2];let i=this._mix(e[0],1-n,t,n),a=this._sub(t,e[0]);return this._normalize(a),this._rightPerpendicular(a),[i[0]+a[0]*r*this._defaultSize,i[1]+a[1]*r*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;let t=e[0],n=this._cp2(e,-4,0),r=this._sub(t,n);this._normalize(r);let i=this._rightPerp(r);return[t,n,[t[0]+(i[0]-r[0])*this._defaultSize,t[1]+(i[1]-r[1])*this._defaultSize]]}_arrowLastSeg(e){let t=e[0],n=this._cp2(e,-4,0),r;if(e.length>=3)r=e[e.length-1];else{let e=this._sub(t,n);this._normalize(e);let i=this._rightPerp(e);r=[t[0]+(i[0]-e[0])*this._defaultSize,t[1]+(i[1]-e[1])*this._defaultSize]}return[n,r]}_processGeom(e){if(!e)return null;let t=[];for(let n of e){let e=n.length>1&&y(n)<this._defaultSize;if(!n||n.length===0||e)continue;let r=n.length,i=n[0];switch(this._rule){case`PerpendicularFromFirstSegment`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,.5,4),a=[];a.push(r),a.push(this._mid(i,e)),t.push(a);break}case`ReversedFirstSegment`:{let e=this._cp2(n,0,-1);t.push([e,i]);break}case`PerpendicularToSecondSegment`:{if(n.length<3)return[];let e=this._cp2(n,-4,1),r=this._cp3(n,e,.882353,-1.94),a=[];a.push(this._mid(e,r)),a.push(i),t.push(a);break}case`SecondSegmentWithTicks`:{if(n.length<3)return[];let e=this._cp2(n,-4,1),r=this._cp3(n,e,.882353,-1.94),a=this._sub(r,e),o;o=this._crossProduct(a,this._sub(i,e))>0?this._rightPerp(a):this._leftPerp(a);let s=[];s.push([e[0]+(o[0]-a[0])/3,e[1]+(o[1]-a[1])/3]),s.push(e),s.push(r),s.push([r[0]+(o[0]+a[0])/3,r[1]+(o[1]+a[1])/3]),t.push(s);break}case`DoublePerpendicular`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,.5,3),a=this._mid(i,e),o=this._sub(a,r);this._normalize(o);let s=this._crossProduct(o,this._sub(i,r));this._leftPerpendicular(o);let c=[];c.push(i),c.push([r[0]+o[0]*s,r[1]+o[1]*s]),t.push(c);let l=[];l.push([r[0]-o[0]*s,r[1]-o[1]*s]),l.push(e),t.push(l);break}case`OppositeToFirstSegment`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,.5,3),a=this._mid(i,e),o=this._sub(a,r);this._normalize(o);let s=this._crossProduct(o,this._sub(i,r));this._leftPerpendicular(o);let c=[];c.push([r[0]+o[0]*s,r[1]+o[1]*s]),c.push([r[0]-o[0]*s,r[1]-o[1]*s]),t.push(c);break}case`TriplePerpendicular`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,.5,4),a=this._mid(i,e),o=this._sub(a,r);this._normalize(o);let s=this._crossProduct(o,this._sub(i,r));this._leftPerpendicular(o);let c=[];c.push([r[0]+o[0]*s*.8,r[1]+o[1]*s*.8]),c.push([a[0]+.8*(i[0]-a[0]),a[1]+.8*(i[1]-a[1])]),t.push(c),t.push([r,a]);let l=[];l.push([r[0]-o[0]*s*.8,r[1]-o[1]*s*.8]),l.push([a[0]+.8*(e[0]-a[0]),a[1]+.8*(e[1]-a[1])]),t.push(l);break}case`HalfCircleFirstSegment`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,.5,4),a=this._mid(i,e),o=this._sub(e,i),s=Math.cos(Math.PI/18),c=Math.sin(Math.PI/18),l=Math.sqrt((1+s)/2),u=Math.sqrt((1-s)/2),d=[],f;this._crossProduct(o,this._sub(r,i))>0?(d.push(i),o=this._sub(i,a),f=e):(d.push(e),o=this._sub(e,a),f=i),this._rotateDirect(o,l,u),o[0]/=l,o[1]/=l;for(let e=1;e<=18;e++)d.push(this._add(a,o)),this._rotateDirect(o,s,c);d.push(f),t.push(d);break}case`HalfCircleSecondSegment`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,1,-1),a=this._sub(i,e);this._normalize(a);let o=this._crossProduct(a,this._sub(r,e))/2;this._leftPerpendicular(a);let s=[e[0]+a[0]*o,e[1]+a[1]*o];a=this._sub(e,s);let c=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);o>0&&(l=-l);let u=[e];for(let e=1;e<=18;e++)this._rotateDirect(a,c,l),u.push(this._add(s,a));t.push(u);break}case`HalfCircleExtended`:{let e=this._cp2(n,0,-2),a=this._cp3(n,e,1,-1),o;if(r>=4)o=n[3];else{let t=this._sub(i,e);o=this._add(a,t)}let s=this._dist(e,a)/2/.75,c=this._sub(e,i);this._normalize(c,s);let l=this._sub(a,o);this._normalize(l,s);let u=[o,a];t.push(u);let d=[this._clone(a)];this._addBezier3(d,a,this._add(a,l),this._add(e,c),e,4),d.push(i),t.push(d);break}case`OpenCircle`:{let e=this._cp2(n,-2,0),r=this._sub(e,i),a=Math.cos(Math.PI/18),o=-Math.sin(Math.PI/18),s=[e];for(let e=1;e<=33;e++)this._rotateDirect(r,a,o),s.push(this._add(i,r));t.push(s);break}case`CoverageEdgesWithTicks`:{let e=this._cp2(n,0,-1),a,o;if(r>=3)a=n[2];else{let t=this._sub(e,i),n=this._leftPerp(t);a=[i[0]+n[0]-.25*t[0],i[1]+n[1]-.25*t[1]]}if(r>=4)o=n[3];else{let t=this._mid(i,e),n=this._sub(i,e);this._normalize(n),this._leftPerpendicular(n);let r=this._crossProduct(n,this._sub(a,t));this._rightPerpendicular(n),o=[a[0]+n[0]*r*2,a[1]+n[1]*r*2]}let s=this._sub(e,i),c,l;c=this._crossProduct(s,this._sub(a,i))>0?this._rightPerp(s):this._leftPerp(s),l=[],l.push(a),l.push(i),l.push([i[0]+(c[0]-s[0])/3,i[1]+(c[1]-s[1])/3]),t.push(l),c=this._crossProduct(s,this._sub(o,e))>0?this._rightPerp(s):this._leftPerp(s),l=[],l.push([e[0]+(c[0]+s[0])/3,e[1]+(c[1]+s[1])/3]),l.push(e),l.push(o),t.push(l);break}case`GapExtentWithDoubleTicks`:{let e=this._cp2(n,0,2),a=this._cp3(n,e,0,1),o;if(r>=4)o=n[3];else{let t=this._sub(e,i);o=this._add(a,t)}this._addAngledTicks(t,i,e,this._mid(a,o)),this._addAngledTicks(t,a,o,this._mid(i,e));break}case`GapExtentMidline`:{let e=this._cp2(n,2,0),a=this._cp3(n,e,0,1),o;if(r>=4)o=n[3];else{let t=this._sub(e,i);o=this._add(a,t)}let s=[];s.push(this._mid(i,a)),s.push(this._mid(e,o)),t.push(s);break}case`Chevron`:{let e=this._cp2(n,-1,-1),a;if(r>=3)a=n[2];else{let t=this._sub(e,i);this._leftPerpendicular(t),a=this._add(i,t)}t.push([e,this._makeCtrlPt(i),a]);break}case`PerpendicularWithArc`:{let e=this._cp2(n,0,-2),a=this._cp3(n,e,.5,-1),o=this._sub(e,i),s=this._norm(o);o[0]/=s,o[1]/=s;let c=this._crossProduct(o,this._sub(a,i)),l=this._dotProduct(o,this._sub(a,i));l<.05*s?l=.05*s:l>.95*s&&(l=.95*s);let u=[i[0]+o[0]*l,i[1]+o[1]*l],d=this._leftPerp(o),f=[];if(f.push([u[0]-d[0]*c,u[1]-d[1]*c]),f.push([u[0]+d[0]*c,u[1]+d[1]*c]),t.push(f),r>=4){let e=n[3],r=this._dotProduct(o,this._sub(e,i));r<.1*s?r=.1*s:r>.9*s&&(r=.9*s);let a=[i[0]+o[0]*r,i[1]+o[1]*r],c=this._crossProduct(o,this._sub(e,i)),l=[];l.push([a[0]-d[0]*c,a[1]-d[1]*c]),l.push([a[0]+d[0]*c,a[1]+d[1]*c]),t.push(l)}let p=[e[0]+d[0]*c,e[1]+d[1]*c];d=this._sub(e,p);let m=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18);c<0&&(h=-h),f=[i,e];for(let e=1;e<=9;e++)this._rotateDirect(d,m,h),f.push(this._add(p,d));t.push(f);break}case`ClosedHalfCircle`:{let e=this._cp2(n,2,0),r=this._mid(i,e),a=this._sub(e,r),o=Math.cos(Math.PI/18),s=Math.sin(Math.PI/18),c=[i,e];for(let e=1;e<=18;e++)this._rotateDirect(a,o,s),c.push(this._add(r,a));t.push(c);break}case`TripleParallelExtended`:{let e=this._cp2(n,0,-2),r=this._cp3(n,e,1,-2),a=this._mid(i,e),o=this._sub(r,e);this._normalize(o);let s=Math.abs(this._crossProduct(o,this._sub(a,e)))/2,c=this._dist(e,r),l=[e,i];l.push([i[0]+o[0]*c*.5,i[1]+o[1]*c*.5]),t.push(l);let u=[];u.push([a[0]-o[0]*s,a[1]-o[1]*s]),u.push([a[0]+o[0]*c*.375,a[1]+o[1]*c*.375]),ht(u[u.length-1],1),u.push([a[0]+o[0]*c*.75,a[1]+o[1]*c*.75]),t.push(u);let d=[e,r];t.push(d);break}case`ParallelWithTicks`:{let e=this._cp2(n,3,0),r=this._cp3(n,e,.5,-1),a=this._sub(r,e);this._normalize(a);let o=this._crossProduct(a,this._sub(r,i));this._leftPerpendicular(a),this._addAngledTicks(t,i,e,r),this._addAngledTicks(t,this._mix(i,1,a,o),this._mix(e,1,a,o),this._mid(i,e));break}case`Parallel`:{let e=this._cp2(n,3,0),r=this._cp3(n,e,.5,-1),a=this._sub(e,i);this._normalize(a);let o=this._leftPerp(a),s=this._crossProduct(a,this._sub(r,i)),c=[i,e];t.push(c),c=[],c.push([i[0]+o[0]*s,i[1]+o[1]*s]),c.push([e[0]+o[0]*s,e[1]+o[1]*s]),t.push(c);break}case`PerpendicularToFirstSegment`:{let e=this._cp2(n,3,0),r=this._cp3(n,e,.5,-1),a=this._mid(i,e),o=this._sub(e,i);this._normalize(o);let s=this._crossProduct(o,this._sub(r,i));this._leftPerpendicular(o);let c=[];c.push([a[0]-o[0]*s*.25,a[1]-o[1]*s*.25]),c.push([a[0]+o[0]*s*1.25,a[1]+o[1]*s*1.25]),t.push(c);break}case`ParallelOffset`:{let e=this._cp2(n,3,0),r=this._cp3(n,e,.5,-1),a=this._sub(e,i);this._normalize(a);let o=this._crossProduct(a,this._sub(r,i));this._leftPerpendicular(a);let s=[];s.push([i[0]-a[0]*o,i[1]-a[1]*o]),s.push([e[0]-a[0]*o,e[1]-a[1]*o]),t.push(s);let c=[];c.push([i[0]+a[0]*o,i[1]+a[1]*o]),c.push([e[0]+a[0]*o,e[1]+a[1]*o]),t.push(c);break}case`OffsetOpposite`:{let e=this._cp2(n,3,0),r=this._cp3(n,e,.5,-1),a=this._sub(e,i);this._normalize(a);let o=this._crossProduct(a,this._sub(r,i));this._leftPerpendicular(a);let s=[];s.push([i[0]-a[0]*o,i[1]-a[1]*o]),s.push([e[0]-a[0]*o,e[1]-a[1]*o]),t.push(s);break}case`OffsetSame`:{let e=this._cp2(n,3,0),r=this._cp3(n,e,.5,-1),a=this._sub(e,i);this._normalize(a);let o=this._crossProduct(a,this._sub(r,i));this._leftPerpendicular(a);let s=[];s.push([i[0]+a[0]*o,i[1]+a[1]*o]),s.push([e[0]+a[0]*o,e[1]+a[1]*o]),t.push(s);break}case`CircleWithArc`:{let e=this._cp2(n,3,0),a=this._cp3(n,e,.5,-1),o,s;if(r>=4)o=n[3],s=this._crossProduct(this._sub(o,e),this._sub(a,e))>0;else{o=e,s=this._crossProduct(this._sub(o,i),this._sub(a,i))>0;let t=24*this._geomUnitsPerPoint,n=this._sub(o,i);this._normalize(n,t);let r=Math.sqrt(2)/2;this._rotateDirect(n,r,s?r:-r),e=this._add(i,n)}let c=this._sub(e,i),l=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),d=[e];for(let e=1;e<=36;e++)this._rotateDirect(c,l,u),d.push(this._add(i,c));this._add90DegArc(d,e,o,a,s),ht(d[d.length-8],1),t.push(d);break}case`DoubleJog`:{let e,a=this._cp2(n,-3,1),o=this._cp3(n,a,-1,-.5);if(r>=4)e=n[3];else{let t=i;i=a,e=o;let n=this._dist(i,t),r=this._dist(e,t),s=30*this._geomUnitsPerPoint;.5*n<s&&(s=.5*n),.5*r<s&&(s=.5*r),a=this._mix(i,s/n,t,(n-s)/n),o=this._mix(e,s/r,t,(r-s)/r)}let s=this._mid(i,a),c=this._mid(e,o),l=this._dist(i,a),u=this._dist(o,e),d=Math.min(l,u)/8;d=Math.min(d,24*this._geomUnitsPerPoint);let f=Math.cos(Math.PI/4),p=this._sub(i,a);this._normalize(p,d),this._crossProduct(p,this._sub(e,a))>0?this._rotateDirect(p,f,-f):this._rotateDirect(p,f,f);let m=[];m.push(a),m.push(this._add(s,p)),m.push(this._sub(s,p)),m.push(i),t.push(m),p=this._sub(e,o),this._normalize(p,d),this._crossProduct(p,this._sub(i,o))<0?this._rotateDirect(p,f,f):this._rotateDirect(p,f,-f),m=[],m.push(o),m.push(this._add(c,p)),m.push(this._sub(c,p)),m.push(e),t.push(m);break}case`PerpendicularOffset`:{let e=this._cp2(n,-4,1),r=this._cp3(n,e,.882353,-1.94),a=this._sub(r,e);this._crossProduct(a,this._sub(i,e))>0?this._rightPerpendicular(a):this._leftPerpendicular(a);let o=[a[0]/8,a[1]/8],s=this._sub(this._mid(e,r),o);t.push([s,i]);break}case`LineExcludingLastSegment`:{let e=this._arrowPath(n),r=[],i=e.length-2;for(;i--;)r.push(e[i]);t.push(r);break}case`MultivertexArrow`:{let e=this._arrowPath(n),r=[];this._addArrow(r,e,!1),t.push(r);break}case`CrossedArrow`:{let e=this._arrowPath(n),r=[];this._addArrow(r,e,!0),t.push(r);break}case`ChevronArrow`:{let[e,r]=this._arrowLastSeg(n),a=10*this._geomUnitsPerPoint,o=this._sub(i,e),s=this._norm(o);this._normalize(o);let c=this._crossProduct(o,this._sub(r,e)),l=this._dotProduct(o,this._sub(r,e));l<.05*s?l=.05*s:l>.95*s-a&&(l=.95*s-a);let u=[e[0]+o[0]*l,e[1]+o[1]*l],d=this._leftPerp(o),f=[];f.push([u[0]+d[0]*c+o[0]*a,u[1]+d[1]*c+o[1]*a]),f.push(i),f.push([u[0]-d[0]*c+o[0]*a,u[1]-d[1]*c+o[1]*a]),t.push(f);break}case`ChevronArrowOffset`:{let[e,r]=this._arrowLastSeg(n),a=this._sub(i,e),o=this._norm(a);this._normalize(a);let s=this._crossProduct(a,this._sub(r,e)),c=this._dotProduct(a,this._sub(r,e));c<.05*o?c=.05*o:c>.95*o&&(c=.95*o);let l=[e[0]+a[0]*c,e[1]+a[1]*c];this._leftPerpendicular(a);let u=[];u.push([l[0]+a[0]*s*.5,l[1]+a[1]*s*.5]),u.push(this._mid(l,i)),u.push([l[0]-a[0]*s*.5,l[1]-a[1]*s*.5]),t.push(u);break}case`PartialFirstSegment`:{let[e,r]=this._arrowLastSeg(n),a=this._sub(i,e),o=this._norm(a);this._normalize(a);let s=this._dotProduct(a,this._sub(r,e));s<.05*o?s=.05*o:s>.95*o&&(s=.95*o);let c=[e[0]+a[0]*s,e[1]+a[1]*s];t.push([e,c]);break}case`Arch`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,.5,1),a=this._sub(i,e),o=this._mix(r,1,a,.55),s=this._mix(r,1,a,-.55),c=[i];this._addBezier2(c,i,o,r,4),this._addBezier2(c,r,s,e,4),t.push(c);break}case`CurvedParallelTicks`:{let e=this._cp2(n,-4,1),r=this._cp3(n,e,.882353,-1.94),a=this._sub(r,e);this._crossProduct(a,this._sub(i,e))>0?this._rightPerpendicular(a):this._leftPerpendicular(a);let o=[a[0]/8,a[1]/8],s=this._sub(this._mid(e,r),o),c=this._sub(this._mix(e,.75,r,.25),o),l=this._sub(this._mix(e,.25,r,.75),o),u=[e];this._addBezier2(u,e,c,s,3),this._addBezier2(u,s,l,r,3),t.push(u);for(let e=0;e<8;e++){let n=u[2*e+1],r=[this._clone(n)];r.push(this._add(n,[a[0]/4,a[1]/4])),t.push(r)}break}case`Arc90Degrees`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,.5,1),a=[e];this._add90DegArc(a,e,i,r),t.push(a);break}case`TipWithPerpendicularAndTicks`:{let[e,r]=this._arrowLastSeg(n),a=10*this._geomUnitsPerPoint,o=this._sub(i,e),s=this._norm(o);this._normalize(o);let c=this._crossProduct(o,this._sub(r,e)),l=this._dotProduct(o,this._sub(r,e));l<.05*s?l=.05*s:l>.95*s-a&&(l=.95*s-a);let u=this._leftPerp(o),d=[i[0]-o[0]*a,i[1]-o[1]*a],f=.5*Math.max(s-l-a,a);c=Math.abs(c);let p=[];p.push([d[0]+u[0]*(c+f)-o[0]*f,d[1]+u[1]*(c+f)-o[1]*f]),p.push([d[0]+u[0]*c,d[1]+u[1]*c]),p.push([d[0]-u[0]*c,d[1]-u[1]*c]),p.push([d[0]-u[0]*(c+f)-o[0]*f,d[1]-u[1]*(c+f)-o[1]*f]),t.push(p),t.push([d,i]);break}case`ConcentricCircles`:{let e=this._cp2(n,1,0),a=this._cp3(n,e,2,0),o=Math.cos(Math.PI/18),s=Math.sin(Math.PI/18),c=this._dist(e,i),l=[c,0],u=[];for(let e=0;e<=36;e++)u.push(this._add(i,l)),this._rotateDirect(l,o,s);if(t.push(u),r>=4){u=[];let e=n[3];c=this._dist(e,i),l=[c,0];for(let e=0;e<=36;e++)u.push(this._add(i,l)),e===0&&(u.push(this._add(i,l)),ht(u[1],1)),this._rotateDirect(l,o,s);t.push(u)}u=[],c=this._dist(a,i),l=[c,0];for(let e=0;e<=36;e++)u.push(this._add(i,l)),this._rotateDirect(l,o,s);t.push(u);break}case`DoubleJogArrow`:{i=this._arrowPath(n)[0];let[e,r]=this._arrowLastSeg(n),a=this._sub(i,e),o=this._norm(a);this._normalize(a);let s=Math.abs(this._crossProduct(a,this._sub(r,i))),c=Math.abs(this._dotProduct(a,this._sub(r,i)));c<.05*o?c=.05*o:c>.95*o&&(c=.95*o);let l=Math.max(s,c),u=this._leftPerp(a),d=[],f=[i[0]-a[0]*c*.5+u[0]*s*.5,i[1]-a[1]*c*.5+u[1]*s*.5];d.push([f[0],f[1]]),f[0]+=a[0]*l*.5+u[0]*l*.4,f[1]+=a[1]*l*.5+u[1]*l*.4,d.push([f[0],f[1]]),f[0]-=u[0]*l*.25,f[1]-=u[1]*l*.25,d.push([f[0],f[1]]),f[0]+=a[0]*l*.5+u[0]*l*.4,f[1]+=a[1]*l*.5+u[1]*l*.4,d.push([f[0],f[1]]),t.push(d),d=[],f[0]=i[0]-a[0]*c*.5-u[0]*s*.5,f[1]=i[1]-a[1]*c*.5-u[1]*s*.5,d.push([f[0],f[1]]),f[0]+=a[0]*l*.5-u[0]*l*.4,f[1]+=a[1]*l*.5-u[1]*l*.4,d.push([f[0],f[1]]),f[0]+=u[0]*l*.25,f[1]+=u[1]*l*.25,d.push([f[0],f[1]]),f[0]+=a[0]*l*.5-u[0]*l*.4,f[1]+=a[1]*l*.5-u[1]*l*.4,d.push([f[0],f[1]]),t.push(d);break}case`LinkedChevrons`:{let e=this._cp2(n,-5,0),r=this._cp3(n,e,-.2,1),a=this._sub(i,e);this._normalize(a);let o=this._leftPerp(a),s=Math.abs(this._crossProduct(a,this._sub(r,e)));t.push([e,i]);let c=[];c.push([i[0]-a[0]*s+o[0]*s,i[1]-a[1]*s+o[1]*s]),c.push(i),c.push([i[0]-a[0]*s-o[0]*s,i[1]-a[1]*s-o[1]*s]),t.push(c),this._addDash(t,e,[-a[0]*s+o[0]*s,-a[1]*s+o[1]*s]),this._addDash(t,e,[-a[0]*s-o[0]*s,-a[1]*s-o[1]*s]);break}case`SegmentThenHalfCircle`:{let e=this._cp2(n,2,0),a=this._cp3(n,e,1.5,0),o;o=r>=4?n[3]:this._cp3(n,e,1.25,-.5);let s=this._sub(e,i);this._normalize(s);let c=.5*this._dist(e,a),l=this._crossProduct(s,this._sub(o,i))>0,u=Math.cos(Math.PI/18),d=Math.sin(Math.PI/18);l&&(d=-d);let f=[i,e];s[0]*=c,s[1]*=c;let p=this._add(e,s);s[0]=-s[0],s[1]=-s[1];for(let e=1;e<=18;e++)this._rotateDirect(s,u,d),f.push(this._add(p,s));t.push(f);break}case`LineWithStraightTicks`:{let e=this._cp2(n,-2,1),r=this._cp3(n,e,-1,-.5),a=this._sub(r,e);this._normalize(a);let o=this._dotProduct(a,this._sub(e,i)),s=this._dotProduct(a,this._sub(r,i)),c=[i];c.push([i[0]+a[0]*o,i[1]+a[1]*o]),c.push(e),t.push(c),c=[i],c.push([i[0]+a[0]*s,i[1]+a[1]*s]),c.push(r),t.push(c);break}case`DoubleCurve`:{let e=this._cp2(n,-5,-1),r=this._cp3(n,e,2,0),a=Math.atan2(1,5),o=Math.cos(a),s=Math.sin(a),c=this._sub(e,i),l=this._dist(i,e);this._normalize(c),this._rotateDirect(c,o,-s);let u=[i];u.push([i[0]+c[0]*l*.5,i[1]+c[1]*l*.5]),ht(u[1],1),u.push([i[0]+c[0]*l*.8,i[1]+c[1]*l*.8]),this._addBezier2(u,u[2],[i[0]+c[0]*l,i[1]+c[1]*l],e,3);let d=this._sub(r,e),f=this._dist(e,r);this._normalize(d),this._rotateDirect(d,o,-s),this._addBezier2(u,e,[r[0]-d[0]*f,r[1]-d[1]*f],[r[0]-d[0]*f*.8,r[1]-d[1]*f*.8],3),u.push(r),t.push(u);break}case`ParallelWithTicksByWidth`:{let e=this._cp2(n,0,-1),r=this._cp3(n,e,.5,3),a=this._sub(e,i);this._normalize(a);let o=this._crossProduct(a,this._sub(r,i));this._leftPerpendicular(a),o>0?(this._addAngledTicks(t,i,[i[0]+a[0]*o,i[1]+a[1]*o],e),this._addAngledTicks(t,e,[e[0]+a[0]*o,e[1]+a[1]*o],i)):(this._addAngledTicks(t,[i[0]+a[0]*o,i[1]+a[1]*o],i,e),this._addAngledTicks(t,[e[0]+a[0]*o,e[1]+a[1]*o],i,e));break}case`EnclosingRoundedRectangle`:{let e=this._cp2(n,3,-2),t=[Math.min(i[0],e[0]),Math.max(i[1],e[1])],r=[Math.max(i[0],e[0]),Math.min(i[1],e[1])],a=r[0]-t[0],o=t[1]-r[1],s=Math.min(a,o)/10,c=[];c.push([t[0]+s+.75*(a-2*s),t[1]]),c.push([r[0]-s,t[1]]),this._add90DegArc(c,[r[0]-s,t[1]],[r[0],t[1]-s],[r[0],t[1]]),c.push([r[0],r[1]+s]),this._add90DegArc(c,[r[0],r[1]+s],[r[0]-s,r[1]],r),c.push([t[0]+s,r[1]]),this._add90DegArc(c,[t[0]+s,r[1]],[t[0],r[1]+s],[t[0],r[1]]),c.push([t[0],t[1]-s]),this._add90DegArc(c,[t[0],t[1]-s],[t[0]+s,t[1]],t),c.push([t[0]+s+.75*(a-2*s),t[1]]);break}default:t.push(n)}}return t}},Et=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new Dt(e,t,n)}},Dt=class extends V{constructor(e,t,n){super(e,!0,!0),this._curveHelper=new H,this._beginCut=(t.beginCut===void 0?1:t.beginCut)*n,this._endCut=(t.endCut===void 0?1:t.endCut)*n,this._middleCut=(t.middleCut===void 0?0:t.middleCut)*n,this._invert=t.invert!==void 0&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){let{_beginCut:t,_endCut:n,_middleCut:r}=this,i=e.pathLength(),a=L.createEmptyOptimizedCIM(`esriGeometryPolyline`);if(this._invert){if(t!==0||n!==0||r!==0)if(t+n+r>=i)for(a.startPath();e.nextPoint();)a.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(a,e,0,t),this._curveHelper.appendSubCurve(a,e,.5*(i-r),.5*(i+r)),this._curveHelper.appendSubCurve(a,e,i-n,n)}else if(t===0&&n===0&&r===0)for(a.startPath();e.nextPoint();)a.pushXY(e.x,e.y);else t+n+r<i&&(r===0?this._curveHelper.appendSubCurve(a,e,t,i-n):(this._curveHelper.appendSubCurve(a,e,t,.5*(i-r)),this._curveHelper.appendSubCurve(a,e,.5*(i+r),i-n)));return a.totalSize===0?null:a}},Ot=1e-7,kt=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return this._values.length===0}size(){return this._values.length}init(e,t,n=!0){if(this._setEmpty(),!e||e.length===0)return!1;for(let t=0;t<e.length;t++){let r=Math.abs(e[t]);n&&r<Ot&&(r=Ot),this._values.push(r),this._length+=r}return t&&1&e.length&&(this._length*=2),this._length!==0&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){let t=this._values?this._values.length:0;for(let n=0;n<t;++n)this._values[n]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},U=class{constructor(){this.pt=null,this.ca=0,this.sa=0}},At=class{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return this.segment!==null}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}},jt=class extends H{constructor(e=0,t=!1){super(e,t),this._tempPos=new At,this._tempPt=[0,0],this._tolerance=gt,this._currentPosition=new At}updateTolerance(e){this._tolerance=gt*e}init(e,t,n=!0){return n?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=0){let n=new At;return!!this._nextPosition(e,n,null,t)&&(n.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);let[t,n]=this._getAngleCS(this._tempPt,this._currentPosition);e.ca=t,e.sa=n}nextPointAndAngle(e,t,n=0){let r=this._tempPos;if(!this._nextPosition(e,r,null,n))return!1;r.copyTo(this._currentPosition),t.pt=this._getPoint(r);let[i,a]=this._getAngleCS(this._tempPt,r);return t.ca=i,t.sa=a,!0}nextCurve(e){if(e===0)return null;let t=L.createEmptyOptimizedCIM(`esriGeometryPolyline`);t.startPath(),t.nextPath();let n=new At;return this._nextPosition(e,n,t,1)?(n.copyTo(this._currentPosition),t):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,n,r){if(this._currentPosition.isPathEnd)return!1;let i=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(i/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(n){if(n.pathSize===0)if(i===0){let e=t.segment[0];n.pushXY(e[0],e[1])}else n.pushPoint(this.getSegCoord2D(t.segment,i));let e=t.segment[1];n.pushXY(e[0],e[1])}if(i=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return r!==0&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,r===1?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,n){n.pathSize===0&&(i===0?n.pushPoint(t.segment[0]):n.pushPoint(this.getSegCoord2D(t.segment,i)));let e=t.abscissa/t.segmentLength;e===1?n.pushPoint(t.segment[1]):n.pushPoint(this.getSegCoord2D(t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){let t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,t)}_getAngleCS(e,t){let n=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(e,this._currentPosition.segment,n)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;let t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let n=t+this._partSegCount+1;if(n>=this._pathCursor.pathSize&&(n=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(n),this._patternLength>0){let e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap,n=Math.round((this._partLength-(e+t))/this._patternLength);n<=0&&(n=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+n*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}},Mt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new Nt(e,t,n)}},Nt=class extends V{constructor(e,t,n){super(e,!0,!0),this._firstCurve=null,this._walker=new jt,this._walker.updateTolerance(n),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*n,this._offsetAtEnd=(t.customEndingOffset??0)*n;let r=de(t).dashTemplate;r??=[],r.length%2&&(r=[...r,...r]),this._pattern=new kt,this._pattern.init(r,!0),this._pattern.scale(n)}processPath(e){if(this._pattern.length()===0){this.iteratePath=!1;let t=A(e);return L.fromJSONCIM({paths:[t]})}if(!this.iteratePath){let t=!0;switch(this._endings){case`HalfPattern`:case`HalfGap`:default:this._pattern.extPtGap=0;break;case`FullPattern`:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case`FullGap`:this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case`NoConstraint`:this.isClosed||(t=!1);break;case`Custom`:this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}let n=e.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){let t=A(e);return L.fromJSONCIM({paths:[t]})}if(!this._walker.init(e,this._pattern,t)){let t=A(e);return L.fromJSONCIM({paths:[t]})}}let t;if(this.iteratePath)t=this._pattern.nextValue();else{let e;switch(this._endings){case`HalfPattern`:default:e=.5*this._pattern.firstValue();break;case`HalfGap`:e=.5*-this._pattern.lastValue();break;case`FullGap`:e=-this._pattern.lastValue();break;case`FullPattern`:e=0;break;case`NoConstraint`:case`Custom`:e=-this._customDashPos}let n=e/this._pattern.length();n-=Math.floor(n),e=n*this._pattern.length(),this._pattern.reset(),t=this._pattern.nextValue();let r=!1;for(;e>=t;)e-=t,t=this._pattern.nextValue(),r=!r;t-=e,r?(this._walker.nextPosition(t),t=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(t),t=this._pattern.nextValue(),this._walker.nextPosition(t),t=this._pattern.nextValue())}let n=this._walker.nextCurve(t);if(n)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)n.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else t=this._pattern.nextValue(),!this._walker.nextPosition(t)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&=(n.pushCursor(this._firstCurve),null)):this.iteratePath=!0;else this.iteratePath=!1,n=this._firstCurve,this._firstCurve=null;return n?.reset(),n}},Pt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n,r,i,a){return new Ft(e,t,n,r,i,a)}},Ft=class{constructor(e,t,n,r,i,a){this._preventClipping=a,this._inputGeometries=e,this._tileKey=r,this._maxInflateSize=i*n,this._width=(t.width===void 0?2:t.width)*n,t.method,this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if(e.geometryType===`esriGeometryEnvelope`&&this._width>0){let t=e.asJSON();return Math.min(t.xmax-t.xmin,t.ymax-t.ymin)-2*this._width<0?e:L.fromJSONCIM({paths:[[[t.xmin+this._width,t.ymin+this._width],[t.xmax-this._width,t.ymin+this._width],[t.xmax-this._width,t.ymax-this._width],[t.xmin+this._width,t.ymax-this._width],[t.xmin+this._width,t.ymin+this._width]],[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}if(e.geometryType===`esriGeometryPolygon`){if(this._width===0)return e.clone();let t=$e.module,n=!this._preventClipping&&this._tileKey?dt(e,this._maxInflateSize,!0):e.clone();if(!n)continue;let r={...n.asJSON(),spatialReference:{wkid:je.WebMercator.wkid}},i=t.execute(r,-this._width);if(i){for(let e of i.rings)if(e){n.startPath();for(let t of e.reverse())n.pushXY(t[0],n.yFactor*t[1])}}return n}}return null}},It=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t){return new Lt(e,t)}},Lt=class{constructor(e,t){this._inputGeometries=e,this._medhod=t.method}next(){let e=this._inputGeometries.next(),t=this._medhod;for(;e!=null;){if(e.totalSize>0)switch(t){case`RectangularBox`:return Rt(e);case`ConvexHull`:return this._constructConvexHull(e);default:return zt(e)}e=this._inputGeometries.next()}return null}_constructConvexHull(e){switch(e.geometryType){case`esriGeometryPolyline`:case`esriGeometryPolygon`:{let t=et.module,n={...e.asJSON(),spatialReference:{wkid:je.WebMercator.wkid}},r=t.execute(n);return r?L.fromJSONCIM(r):null}case`esriGeometryEnvelope`:return e;default:return null}}};function Rt(e){let t=Ee(e),n={xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3]};return L.fromJSONCIM(n)}function zt(e){switch(e.geometryType){case`esriGeometryPolyline`:{let t=[];for(;e.nextPath();)Bt(e,t);return L.fromJSONCIM({rings:t})}case`esriGeometryPolygon`:case`esriGeometryEnvelope`:return e;default:return null}}function Bt(e,t){if(e.seekPathStart(),!e.nextPoint())return;let n=e.x,r=e.y,i=[[n,r]];for(t.push(i);e.nextPoint();)i.push([e.x,e.y]);i.push([n,r])}var Vt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new Ht(e,t,n)}},Ht=class extends V{constructor(e,t,n){super(e,!1,!0),this._curveHelper=new H,this._length=(t.length===void 0?20:t.length)*n,this._angle=t.angle===void 0?225:t.angle,this._position=t.position===void 0?50:t.position,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){let t=L.createEmptyOptimizedCIM(`esriGeometryPolyline`);if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);let n=e.x,r=e.y;e.seekInPath(e.pathSize-1);let i=e.x,a=e.y,o=[i-n,a-r];this._curveHelper.normalize(o);let s=n+(i-n)*this._position/100,c=r+(a-r)*this._position/100,l=Math.cos((90-this._angle)/180*Math.PI),u=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(u=-u),this._mirror=!this._mirror;let d=[s-this._length/2*l,c-this._length/2*u],f=[s+this._length/2*l,c+this._length/2*u];return t.pushPath([[n,r],d,f,[i,a]]),t}},Ut=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new Wt(e,t,n)}},Wt=class{constructor(e,t,n){this._inputGeometries=e,this._offsetX=t.offsetX===void 0?0:t.offsetX*n,this._offsetY=t.offsetY===void 0?0:t.offsetY*n}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,n){for(;e.nextPath();)for(;e.nextPoint();)e.x+=t,e.y+=n;return e.reset(),e}},Gt=10,Kt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n,r,i,a){return new qt(e,t,n,r,i,a)}},qt=class{constructor(e,t,n,r,i,a){this._preventClipping=a,this._inputGeometries=e,this._tileKey=r,this._curveHelper=new H,this._offset=(t.offset??1)*n,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(i*n),Gt),this._option=t.option,this._offsetFlattenError=gt*n}next(){let e;for(;e=this._inputGeometries.next();){if(this._offset===0)return e.clone();if(e.geometryType===`esriGeometryEnvelope`){if(this._method===`Rounded`&&this._offset>0){let t=A(e),n=this._curveHelper.offset(t,-this._offset,this._method,4,this._offsetFlattenError);if(n){let t=L.createEmptyOptimizedCIM(e.geometryType);return t.pushPath(n),t}return null}let t=e.asJSON();if(O(t)&&Math.min(t.xmax-t.xmin,t.ymax-t.ymin)+2*this._offset>0)return L.fromJSONCIM({xmin:t.xmin-this._offset,xmax:t.xmax+this._offset,ymin:t.ymin-this._offset,ymax:t.ymax+this._offset})}let t=!this._preventClipping&&this._tileKey?dt(e,this._maxInflateSize,!0):e.clone();if(!t)continue;let n=it.module,r=rt.module,i={...t.asJSON(),spatialReference:{wkid:je.WebMercator.wkid}},a,o=Jt(this._method);return e.geometryType===`esriGeometryPolygon`&&this._offset>0?(o===`square`&&(o=`bevel`),a=r.executeMany([i],[this._offset],o,`round`)[0]):a=n.execute(i,-this._offset,{joins:o,flattenError:this._offsetFlattenError,miterLimit:4}),a?L.fromJSONCIM(a):null}return null}};function Jt(e){switch(e){case`Rounded`:return`round`;case`Bevelled`:return`bevel`;case`Mitered`:return`miter`;case`Square`:return`square`}}var Yt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new Xt(e,t,n)}},Xt=class{constructor(e,t,n){this._inputGeometries=e,this._length=(t.length===void 0?M.CIMGeometricEffectRadial.length:t.length)*n,this._angle=t.angle===void 0?M.CIMGeometricEffectRadial.angle:t.angle*Math.PI/180,this._lx=Math.cos(this._angle)*this._length,this._ly=Math.sin(this._angle)*this._length}next(){let e=this._inputGeometries.next();for(;e;){if(e.geometryType===`esriGeometryPoint`||e.geometryType===`esriGeometryMultipoint`){let t=L.createEmptyOptimizedCIM(`esriGeometryPolyline`);return e.nextPath()&&e.nextPoint()&&t.pushPath([[e.x,e.y],[e.x+this._lx,e.y+this._ly]]),t}if(e.geometryType===`esriGeometryPolygon`){let t=i(e);if(!t)return null;let n=L.createEmptyOptimizedCIM(`esriGeometryPolyline`);return n.pushPath([[t[0],t[1]],[t[0]+this._lx,t[1]+this._ly]]),n}e=this._inputGeometries.next()}return null}},Zt=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new Qt(e,t,n)}},Qt=class{constructor(e,t,n){this._inputGeometries=e,this._reverse=t.reverse===void 0||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if(e.geometryType===`esriGeometryPolyline`)return $t(e.clone());e=this._inputGeometries.next()}return null}};function $t(e){for(;e.nextPath();)for(let t=0;t<e.pathSize/2;t++){e.seekInPath(t);let n=e.x,r=e.y;e.seekInPath(e.pathSize-t-1);let i=e.x,a=e.y;e.x=n,e.y=r,e.seekInPath(t),e.x=i,e.y=a}return e.reset(),e}var en=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new tn(e,t,n)}},tn=class{constructor(e,t,n){this._inputGeometries=e,this._rotateAngle=t.angle===void 0?0:t.angle*Math.PI/180}next(){let e=this._inputGeometries.next();for(;e;){if(this._rotateAngle===0||e.geometryType===`esriGeometryPoint`)return e;if(e.totalSize>0){let t=Ee(e),n=(t[2]+t[0])/2,r=(t[3]+t[1])/2;return e.reset(),this._rotate(e.clone(),n,r)}e=this._inputGeometries.next()}return null}_rotate(e,t,n){let r=Math.cos(this._rotateAngle),i=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){let a=e.x-t,o=e.y-n;e.x=t+a*r-o*i,e.y=n+a*i+o*r}return e.reset(),e}},nn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new rn(e,t,n)}},rn=class{constructor(e,t,n){this._inputGeometries=e,this._xFactor=t.xScaleFactor===void 0?1.15:t.xScaleFactor,this._yFactor=t.yScaleFactor===void 0?1.15:t.yScaleFactor}next(){let e=this._inputGeometries.next();if(e){if(this._xFactor===1&&this._yFactor===1||e.geometryType===`esriGeometryPoint`)return e;if(e.totalSize>0){let t=Ee(e),n=(t[2]+t[0])/2,r=(t[3]+t[1])/2;return e.reset(),this._scaleCursor(e.clone(),n,r)}}return null}_scaleCursor(e,t,n){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=n+(e.y-n)*this._yFactor;return e.reset(),e}},an=class{constructor(){this._polyline=[]}beginPath(e){this._polyline.push([e])}lineTo(e){if(this._polyline.length===0)throw Error(`No path started. Call beginPath first.`);this._polyline[this._polyline.length-1].push(e)}getPointCount(){return this._polyline.reduce((e,t)=>e+t.length,0)}addSegment(e,t,n){n&&this.beginPath(e),this.lineTo(t)}getXY(e){let t=0;for(let n of this._polyline){if(e<t+n.length)return n[e-t];t+=n.length}return null}getGeometry(){return this._polyline}},on=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new sn(e,t,n)}},sn=class extends V{constructor(e,t,n){super(e,!1,!0),this._suppress=t.suppress!==void 0&&t.suppress,this._invert=t.invert!==void 0&&t.invert}processPath(e){if(e.totalSize<=0)return null;if(!this._suppress){let t=L.createEmptyOptimizedCIM(`esriGeometryPolygon`,!1,!1,e.yFactor);for(e.seekPathEnd();e.nextPoint();)t.pushXY(e.x,e.y);return t}let t=[],n=Array(e.pathSize),r=0;for(e.seekPathStart();e.nextPoint();)n[r++]=e.getControlPoint(),t.push([e.x,e.y]);let i=!0,a=!0,o=!1,s=!this._invert;r=0;let c=new an,l=t[0];for(;r<t.length-1;){let e=t[r+1],u=n[r],d=n[r+1];r++,a&&=(s=u||d?this._invert:!this._invert,!1),s?(c.addSegment(l,e,i),i=!1):o=!0,l=e,d&&(s?(s=!1,i=!0):s=!0)}let u=c.getGeometry();if(u.length===0)return null;if(!o&&t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]){let e=u[u.length-1];return e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]),L.fromJSONCIM({paths:u})}let d=u[u.length-1];return c.getPointCount()>1&&e.geometryType===`esriGeometryPolygon`&&d[0][0]===d[d.length-1][0]&&d[0][1]===d[d.length-1][1]&&u.length>1&&(u[u.length-1].push(...u[0]),u.splice(0,1)),L.fromJSONCIM({paths:u})}},cn=()=>Oe.getLogger(`esri.symbols.cim.effects.EffectTaperedPolygon`),ln=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new un(e,t,n)}},un=class extends V{constructor(e,t,n){super(e,!1,!0),this._slopeS=0,this._slopeC=1,this._lastTangent1=new I(NaN,NaN),this._lastWidth=0,this._geomUnitsPerPoint=n,this._halfFromWidth=Math.abs(t.fromWidth===void 0?0:t.fromWidth)*n*.5,this._halfToWidth=Math.abs(t.toWidth===void 0?1:t.toWidth)*n*.5,this._originalLength=(t.length===void 0?0:t.length)*n,this._length=0}processPath(e){if(e.totalSize<=0)return null;if(this._halfFromWidth<=0&&this._halfToWidth<=0){let t=L.createEmptyOptimizedCIM(`esriGeometryPolygon`,!1,!1,e.yFactor);for(e.seekPathEnd();e.prevPoint();)t.pushXY(e.x,e.y);for(e.seekPathStart();e.nextPoint();)t.pushXY(e.x,e.y);return t}let t=e.getCurrentPath().asJSON(),n=nt.module.execute(t,.25*this._geomUnitsPerPoint,{removeDegenerateParts:!0}),r=n==null?null:u(n)?n.rings:F(n)?n.paths:null;if(!r)return cn().error(new o(`mapview-bad-resource`,`Unable to process geometry`)),null;let i=tt.module.execute(n);if((this._originalLength===0||this._originalLength>i)&&i>0){this._length=i;let e=(this._halfToWidth-this._halfFromWidth)/this._length;if(Math.abs(e)<1){let t=e*e;this._slopeC=Math.sqrt(1/(1+t)),this._slopeS=Math.sqrt(t/(1+t)),e<0&&(this._slopeS=-this._slopeS)}else this._slopeC=this._slopeS=.7071}else this._length=this._originalLength,this._slopeC=1,this._slopeS=0;let a=[];for(let e of r){let t=new an,n=new an,r=0;this._setFromOffset(e.slice(0,2),t,n);for(let i=0,a=3;a<=e.length;++i,++a)r=this._setOffset(e.slice(i,a),r,t,n);this._setToOffset(e.slice(-2),r,t,n);let[i]=t.getGeometry(),[o]=n.getGeometry();a.push([...i,...o.reverse()])}let s={rings:a,spatialReference:{wkid:je.WebMercator.wkid}},c=at.module.execute(s);return L.fromJSONCIM(c)}_setFromOffset([[e,t],[n,r]],i,a){let o=this._halfFromWidth,s=new I(n-e,r-t).normalize().scale(o);i.beginPath([e-s.y,t+s.x]),a.beginPath([e+s.y,t-s.x])}_setToOffset([[e,t],[n,r]],i,a,o){let s;s=(i+=Math.sqrt((n-e)**2+(r-t)**2))>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*i/this._length;let c=new I(n-e,r-t).normalize().scale(s);a.lineTo([n-c.y,r+c.x]),o.lineTo([n+c.y,r-c.x])}_setOffset([[e,t],[n,r],[i,a]],s,c,l){let u=Math.sqrt((n-e)**2+(r-t)**2),d;d=s+u>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*(s+u)/this._length,s+=u;let f=new I(n,r),p=new I(n-e,r-t).normalize(),m=new I(i-n,a-r).normalize(),h=I.sub(m,p),g=c.getPointCount(),_=l.getPointCount();p.leftPerpendicular(),m.leftPerpendicular();let v=p.x*m.x+p.y*m.y;if(v>.99){let e=I.add(p,m).scale(d/2),t=e.clone().rotate(this._slopeC,this._slopeS);c.lineTo([f.x+t.x,f.y+t.y]);let n=e.rotateReverse(this._slopeC,this._slopeS);l.lineTo([f.x-n.x,f.y-n.y])}else{let n=p.x*m.y-p.y*m.x;if(h.scale(1/n),n<0){h.scale(-d).rotateReverse(this._slopeC,this._slopeS);let e=l.getXY(_-1);e||cn().error(new o(`mapview-bad-resource`,`Unable to process geometry, index out of scope`));let t=I.add(f,h).sub(I.fromArray(e));if(p.x*t.y-p.y*t.x>0){let e=p.clone().scale(-d).rotateReverse(this._slopeC,this._slopeS),t=m.clone().scale(-d).rotateReverse(this._slopeC,this._slopeS);l.lineTo([f.x+e.x,f.y+e.y]),l.lineTo([f.x,f.y]),l.lineTo([f.x+t.x,f.y+t.y])}else l.lineTo([f.x+h.x,f.y+h.y])}else{h.scale(d).rotate(this._slopeC,this._slopeS);let e=c.getXY(g-1);e||cn().error(new o(`mapview-bad-resource`,`Unable to process geometry, index out of scope`));let t=I.add(f,h).sub(I.fromArray(e));if(p.x*t.y-p.y*t.x>0){let e=p.clone().scale(d).rotate(this._slopeC,this._slopeS),t=m.clone().scale(d).rotate(this._slopeC,this._slopeS);c.lineTo([f.x+e.x,f.y+e.y]),c.lineTo([f.x,f.y]),c.lineTo([f.x+t.x,f.y+t.y])}else c.lineTo([f.x+h.x,f.y+h.y])}let r=Math.acos(v),i=1;if(d>.25){let e=2*Math.acos(1-.25/d);e<r&&(i=Math.round(r/e))}let a=Math.cos(r/i),s=Math.sin(r/i),u=p.clone();if(n<0){u.rotate(this._slopeC,this._slopeS);let n=c.getXY(g-1);n||cn().error(new o(`mapview-bad-resource`,`Unable to process geometry, index out of scope`));let r=I.add(f,u.clone().scale(this._lastWidth)),i=I.sub(r,I.fromArray(n)),a=p.x*i.y-p.y*i.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&a>0){let n=new I(e,t),r=this._lastTangent1.clone().scale(this._lastWidth);r.rotate(this._slopeC,this._slopeS);let i=p.clone().scale(this._lastWidth);i.rotate(this._slopeC,this._slopeS),c.lineTo([n.x+r.x,n.y+r.y]),c.lineTo([n.x,n.y]),c.lineTo([n.x+i.x,n.y+i.y])}}else{u.scale(-1).rotateReverse(this._slopeC,this._slopeS);let n=l.getXY(_-1);n||cn().error(new o(`mapview-bad-resource`,`Unable to process geometry, index out of scope`));let r=I.add(f,u.clone().scale(this._lastWidth)),i=I.sub(r,I.fromArray(n)),a=p.x*i.y-p.y*i.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&a>0){let n=new I(e,t),r=this._lastTangent1.clone().scale(-this._lastWidth);r.rotateReverse(this._slopeC,this._slopeS);let i=p.clone().scale(-this._lastWidth);i.rotateReverse(this._slopeC,this._slopeS),l.lineTo([n.x+r.x,n.y+r.y]),l.lineTo([n.x,n.y]),l.lineTo([n.x+i.x,n.y+i.y])}}u.scale(d);for(let e=0;e<=i;e++)n<0?(c.lineTo([f.x+u.x,f.y+u.y]),u.rotateReverse(a,s)):(l.lineTo([f.x+u.x,f.y+u.y]),u.rotate(a,s))}return this._lastTangent1.setCoords(p.x,p.y),this._lastWidth=d,s}},dn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new fn(e,t,n)}},fn=class{constructor(e,t,n){this._inputGeometries=e,this._height=(t.amplitude===void 0?2:t.amplitude)*n,this._period=(t.period===void 0?3:t.period)*n,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new kt,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new jt,this._walker.updateTolerance(n)}next(){let e=this._inputGeometries.next();for(;e;){if(this._height===0||this._period===0)return e;let t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){let t=L.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){t.startPath();let n=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case`Sinus`:default:this._constructCurve(t,n,!1);break;case`Square`:this._constructSquare(t,n);break;case`Triangle`:this._constructTriangle(t,n);break;case`Random`:this._constructCurve(t,n,!0)}else for(;e.nextPoint();)t.pushXY(e.x,e.y)}return t}_constructCurve(e,t,n){let r=Math.round(t/this._period);r===0&&(r=1);let i=r*16+1,a=t/r,o=this._period/16,s=1/i,c=2*Math.PI*t/a,l=2*Math.PI*Math.random(),u=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=.75-Math.random()/2,p=.75-Math.random()/2,m=new U;this._walker.curPointAndAngle(m),e.pushPoint(m.pt);let h=0;for(;;){if(!this._walker.nextPointAndAngle(o,m)){e.pushPoint(this._walker.getPathEnd());break}{let t=h,r;if(h+=s,n){let e=this._height/2*(1+.3*Math.sin(f*c*t+l));r=e*Math.sin(c*t+u),r+=e*Math.sin(p*c*t+d),r/=2}else r=.5*this._height*Math.sin(.5*c*t);e.pushXY(m.pt[0]-r*m.sa,m.pt[1]+r*m.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let n=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){let r=new U;this._walker.curPointAndAngle(r);let i=new U;if(this._walker.nextPointAndAngle(this._period,i)){let a=new U;this._walker.nextPointAndAngle(this._period,a)&&(n?(e.pushPoint(r.pt),n=!1):e.pushPoint(r.pt),e.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),e.pushXY(i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca),e.pushXY(i.pt[0]+this._height/2*i.sa,i.pt[1]-this._height/2*i.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let n=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){let r=new U;this._walker.curPointAndAngle(r);let i=new U;if(this._walker.nextPointAndAngle(this._period/2,i)){let a=new U;this._walker.nextPointAndAngle(this._period,a)&&(this._walker.nextPosition(this._period/2)&&(n?(e.pushPoint(r.pt),n=!1):e.pushPoint(r.pt),e.pushXY(i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca),e.pushXY(a.pt[0]+this._height/2*a.sa,a.pt[1]-this._height/2*a.ca)),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}},pn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new mn(e,t,n)}},mn=class extends B{constructor(e,t,n){super(e),this._geometryWalker=new jt,this._geometryWalker.updateTolerance(n),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*n,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*n,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*n,this._pattern=new kt,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(n),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{this._originalEndings===`WithFullGap`&&this.isClosed?this._endings=`WithMarkers`:this._endings=this._originalEndings,this._pattern.extPtGap=0;let n,r=!0;switch(this._endings){case`NoConstraint`:n=-this._position,n=this._adjustPosition(n),r=!1;break;case`WithHalfGap`:default:n=-this._pattern.lastValue()/2;break;case`WithFullGap`:n=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case`WithMarkers`:n=0;break;case`Custom`:n=-this._position,n=this._adjustPosition(n),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,r))return null;this._pattern.reset();let i=0;for(;n>i;)n-=i,i=this._pattern.nextValue();i-=n,t=i,this.iteratePath=!0}let n=new U;return this._geometryWalker.nextPointAndAngle(t,n)?this._endings===`WithFullGap`&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):this._endings===`WithMarkers`&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(n.pt[0]-this._offset*n.sa,n.pt[1]+this._offset*n.ca),this._angleToLine&&this.internalPlacement.setRotateCS(n.ca,n.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}},hn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new gn(e,t,n)}},gn=class extends B{constructor(e,t,n){super(e,!1,!0),this._curveHelper=new H,this._placePerPart=t.placePerPart??!1,this._angleToLine=t.angleToLine===void 0||t.angleToLine,this._offset=t.offset===void 0?0:t.offset*n,this._type=t.extremityPlacement,this._position=t.offsetAlongLine===void 0?0:t.offsetAlongLine*n,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let t;switch(this._type){case`Both`:default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case`JustBegin`:t=this._atExtremities(e,this._position,!0);break;case`JustEnd`:t=this._atExtremities(e,this._position,!1);case`None`:}return t}_atExtremities(e,t,n){if(this._placePerPart||(n?e.seekPath(0):e.seekPath(e.totalSize-1)),n||e.seekPathEnd(),n?e.nextPoint():e.prevPoint()){let r=0,[i,a]=[0,0],[o,s]=[e.x,e.y],c=[0,0];for(;n?e.nextPoint():e.prevPoint();){i=o,a=s,o=e.x,s=e.y;let n=this._curveHelper.getLength(i,a,o,s);if(r+n>t){let e=(t-r)/n,[l,u]=this._curveHelper.getAngleCS(c,i,a,o,s,e),d=this._curveHelper.getCoord2D(i,a,o,s,e);return this.internalPlacement.setTranslate(d[0]-this._offset*u,d[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(-l,-u),this.internalPlacement}r+=n}}return null}},_n=2,W=.001,vn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new yn(e,t,n)}},yn=class extends B{constructor(e,t,n){super(e),this._segmentIterator=null,this._segCount=0,this._firstSeg=!0,this._seg=null,this._ms=[],this._from=0,this._to=0,this._pt=null,this._walker=new jt,this._walker.updateTolerance(n),this._placePerPart=t.placePerPart??!1,this._angleToLine=t.angleToLine??!1,this._offset=(t.offset??0)*n,this._interval=(t.interval??0)*n,this._interval<=0&&(this._interval=10*W),this._skipRate=t.skipMarkerRate??0,this._skipRate<=1&&(this._skipRate=0),this._placeAtExtremities=t.placeAtExtremities??!1}processPath(e){if(!this.iteratePath){let{fromGeometry:t}=ot.module,n=t(e.getCurrentPath().asJSON()).getGeometry(),r=n.getPathStart(0);this._segmentIterator=n.querySegmentIteratorAtVertex(r),this._segCount=n.getSegmentCountPath(0),this._firstSeg=!0,this.iteratePath=!0,this._pt=n.getXY(0).clone()}for(;this._ms.length===0&&this._segmentIterator?.hasNextSegment();){--this._segCount,this._seg=this._segmentIterator.nextSegment(),this._from=this._seg.getStartAttributeAsDbl(_n,0),this._to=this._seg.getEndAttributeAsDbl(_n,0);let t=!isNaN(this._from),n=!isNaN(this._to);t&&(this._from=Math.round(this._from/W)*W,Math.abs(this._from)<W&&(this._from=0)),n&&(this._to=Math.round(this._to/W)*W,Math.abs(this._to)<W&&(this._to=0));let r=t?Math.floor(this._from/this._interval):0,i=n?Math.floor(this._to/this._interval):0;if(t&&(this._placeAtExtremities||!this._firstSeg||!this._placePerPart&&e.pathIndex>0)&&Math.abs(r*this._interval-this._from)<W&&(!this._skipRate||r%this._skipRate)&&this._ms.push(this._from),this._firstSeg=!1,t&&n&&!(Math.abs(this._from-this._to)<W))if(this._from<=this._to){r*this._interval<this._from+W&&++r,i*this._interval>this._to-W&&--i;for(let e=r;e<=i;++e)(!this._skipRate||e%this._skipRate)&&this._ms.push(e*this._interval)}else{r*this._interval>this._from-W&&--r,i*this._interval<this._to+W&&++i;for(let e=i;e<=r;++e)(!this._skipRate||e%this._skipRate)&&this._ms.push(e*this._interval)}}let t=0;if(this._ms.length===0){if(this.iteratePath=!1,!this._segCount&&this._placeAtExtremities&&!isNaN(this._to)&&(this._placePerPart||e.pathIndex===e.totalSize-1)){let e=Math.floor(this._to/this._interval);Math.abs(e*this._interval-this._to)<W&&(!this._skipRate||e%this._skipRate)&&(this._ms.push(this._to),t=1)}if(this._ms.length===0)return null}let n=this._ms.pop(),r=isNaN(this._from)||isNaN(this._to)||Math.abs(this._from-this._to)<W?t:(n-this._from)/(this._to-this._from);this._seg.queryCoord2D(r,this._pt);let i=this._seg.getTangent(r),{x:a,y:o}=i.normalize();return this.internalPlacement.setTranslate(this._pt.x-this._offset*o,this._pt.y+this._offset*a),this._angleToLine&&this.internalPlacement.setRotateCS(a,o),this.internalPlacement.setMeasure(n),this.internalPlacement}},bn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new xn(e,t,n)}},xn=class extends B{constructor(e,t,n){super(e),this._walker=new jt,this._walker.updateTolerance(n),this._angleToLine=t.angleToLine===void 0||t.angleToLine,this._offset=t.offset===void 0?0:t.offset*n,this._beginGap=t.beginPosition===void 0?0:t.beginPosition*n,this._endGap=t.endPosition===void 0?0:t.endPosition*n,this._flipFirst=t.flipFirst===void 0||t.flipFirst,this._pattern=new kt,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){let e=this._pattern.nextValue()*this._subPathLen,n=this._beginGap+e;t=n-this._prevPos,this._prevPos=n}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();let n=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+n;t=r-this._prevPos,this._prevPos=r,this.iteratePath=!0}let n=new U;if(!this._walker.nextPointAndAngle(t,n,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(n.pt[0]-this._offset*n.sa,n.pt[1]+this._offset*n.ca);let r=this._isFirst&&this._flipFirst,i,a;return this._angleToLine?(i=n.ca,a=n.sa):(i=1,a=0),r&&(i=-i,a=-a),this.internalPlacement.setRotateCS(i,a),this._isFirst=!1,this._posCount--,this._posCount===0&&(this.iteratePath=!1),this.internalPlacement}},G=512,Sn=10,K=24,Cn=1e-6,wn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n,r){return new Tn(e,t,n,r)}},Tn=class e{constructor(e,t,n,r){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(t.stepX??16)*n,this._stepY=Math.abs(t.stepY??16)*n,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,this._stepX!==0&&this._stepY!==0){if(this._gridType=t.gridType??`Fixed`,this._gridType===`Random`){let e=t.seed??13;this._randomLCG=new xe(e*1),this._randomness=(t.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=t.gridAngle??0,this._shiftOddRows=t.shiftOddRows??!1,this._offsetX=(t.offsetX??0)*n,this._offsetY=(t.offsetY??0)*n,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,r!=null){let[e,t,n,i]=r.split(`/`),a=parseFloat(e),o=parseFloat(t),s=parseFloat(n);this._graphicOriginX=-(parseFloat(i)*2**a+s)*G,this._graphicOriginY=o*G,this._testInsidePolygon=!0}this._internalPlacement=new z,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!e._randValues){e._randValues=[];for(let t=0;t<K;t++)for(let t=0;t<K;t++)e._randValues.push(this._randomLCG.getFloat()),e._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,n,r,i,a,o,s,c,l,u,d,f,p,m;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,s=c=p=d=Number.MAX_VALUE,l=u=m=f=-Number.MAX_VALUE;let h=this._cosAngle!==1;for(e.reset();e.nextPath();)for(;e.nextPoint();)o=e.x,a=e.y,t=o-this._graphicOriginX-this._offsetX,n=a-this._graphicOriginY-this._offsetY,h?(r=this._cosAngle*t-this._sinAngle*n,i=this._sinAngle*t+this._cosAngle*n):(r=t,i=n),s=Math.min(s,r),l=Math.max(l,r),c=Math.min(c,i),u=Math.max(u,i),d=Math.min(d,a),f=Math.max(f,a),p=Math.min(p,o),m=Math.max(m,o);d=d===Number.MAX_VALUE?-G-this._stepY:d,f=f===-Number.MAX_VALUE?this._stepY:f,p=p===Number.MAX_VALUE?-this._stepX:p,m=m===-Number.MAX_VALUE?G+this._stepX:m;let g=f-d,_=m-p;if(this._verticalSubdivision=g>=_,this._polygonMin=this._verticalSubdivision?d:p,this._testInsidePolygon){let e=0-this._graphicOriginX-this._offsetX-this._stepX,t=G-this._graphicOriginX-this._offsetX+this._stepX,n=-G-this._graphicOriginY-this._offsetY-this._stepY,r=0-this._graphicOriginY-this._offsetY+this._stepY;if(h){let i=[[e,n],[e,r],[t,n],[t,r]];e=n=Number.MAX_VALUE,t=r=-Number.MAX_VALUE;for(let a of i){let i=this._cosAngle*a[0]-this._sinAngle*a[1],o=this._sinAngle*a[0]+this._cosAngle*a[1];e=Math.min(e,i),t=Math.max(t,i),n=Math.min(n,o),r=Math.max(r,o)}}s=s===Number.MAX_VALUE?e:Math.max(s,e),c=c===Number.MAX_VALUE?n:Math.max(c,n),l=l===-Number.MAX_VALUE?t:Math.min(l,t),u=u===-Number.MAX_VALUE?r:Math.min(u,r)}this._xMin=Math.round(s/this._stepX),this._xMax=Math.round(l/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(u/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,p,m,d,f)}_buildAccelerationMap(e,t,n,r,i){e.reset();let a=new Map,o=this._verticalSubdivision,s=o?i-r:n-t,c=Math.ceil(s/Sn);if(c<=1)return;let l=Math.floor(s/c),u,d,f,p,m,h,g,_,v,y,b;for(c++,this._delta=l,o?(v=-G-2*this._stepY,y=2*this._stepY,b=r):(v=-2*this._stepX,y=G+2*this._stepX,b=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(u=e.x,d=e.y;e.nextPoint();u=f,d=p){if(f=e.x,p=e.y,o){if(d===p||d<v&&p<v||d>y&&p>y)continue;m=Math.min(d,p),h=Math.max(d,p)}else{if(u===f||u<v&&f<v||u>y&&f>y)continue;m=Math.min(u,f),h=Math.max(u,f)}for(;m<h;)g=Math.floor((m-b)/l),Dn(g,u,d,f,p,a),m+=l;_=Math.floor((h-b)/l),_>g&&Dn(_,u,d,f,p,a)}this._accelerationMap=a}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let t=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(t+=.5*this._stepX);let n=this._currentY*this._stepY+this._offsetY,r,i;if(this._currentX++,this._gridType===`Random`){let a=(this._currentX%K+K)%K,o=(this._currentY%K+K)%K;r=this._graphicOriginX+t+this._stepX*this._randomness*(.5-e._randValues[o*K+a])*2/3,i=this._graphicOriginY+n+this._stepY*this._randomness*(.5-e._randValues[o*K+a+1])*2/3}else r=this._graphicOriginX+this._cosAngle*t+this._sinAngle*n,i=this._graphicOriginY-this._sinAngle*t+this._cosAngle*n;if(!this._testInsidePolygon||this._isInsidePolygon(r,i,this._geometryCursor))return this._internalPlacement.setTranslate(r,i),this._internalPlacement}}_isInsidePolygon(e,t,n){if(this._accelerationMap==null)return En(e,t,n);e+=Cn,t+=Cn;let r=this._verticalSubdivision,i=r?t:e,a=Math.floor((i-this._polygonMin)/this._delta),o=this._accelerationMap.get(a);if(!o)return!1;let s,c,l,u=0;for(let n of o){if(s=n[0],c=n[1],r){if(s[1]>t==c[1]>t)continue;l=(c[0]-s[0])*(t-s[1])-(c[1]-s[1])*(e-s[0])}else{if(s[0]>e==c[0]>e)continue;l=(c[1]-s[1])*(e-s[0])-(c[0]-s[0])*(t-s[1])}l>0?u++:u--}return u!==0}};function En(e,t,n){let r,i,a,o,s=0;for(e+=Cn,t+=Cn,n.reset();n.nextPath();)if(n.nextPoint())for(r=n.x,i=n.y;n.nextPoint();r=a,i=o)a=n.x,o=n.y,i>t!=o>t&&((a-r)*(t-i)-(o-i)*(e-r)>0?s++:s--);return s!==0}function Dn(e,t,n,r,i,a){let o=a.get(e);o||(o=[],a.set(e,o)),o.push([[t,n],[r,i]])}var On=.001,kn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new An(e,t,n)}},An=class extends B{constructor(e,t,n){super(e),this._curveHelper=new H,this._angleToLine=t.angleToLine===void 0||t.angleToLine,this._offset=t.offset===void 0?0:t.offset*n,this._relativeTo=t.relativeTo,this._position=t.startPointOffset===void 0?0:t.startPointOffset*n,this._epsilon=On*n}processPath(e){let t=this._position;if(this._relativeTo===`SegmentMidpoint`){if(this.iteratePath||=!0,e.nextPoint()){let[t,n]=[e.x,e.y],[r,i]=[0,0],a=[0,0];for(;e.nextPoint();){r=e.x,i=e.y;let o=this._curveHelper.getLength(t,n,r,i);if(o<this._epsilon){t=r,n=i;continue}let s=.5+this._position/o,[c,l]=this._curveHelper.getAngleCS(a,t,n,r,i,s),u=this._curveHelper.getCoord2D(t,n,r,i,s);return this.internalPlacement.setTranslate(u[0]-this._offset*l,u[1]+this._offset*c),this._angleToLine&&this.internalPlacement.setRotateCS(c,l),this.internalPlacement}}return this.iteratePath=!1,null}let n=this._relativeTo===`LineEnd`;return this.onLine(e,t,n)}onLine(e,t,n){let r,i=!1;switch(this._relativeTo){case`LineMiddle`:default:e.seekPathStart(),r=e.pathLength()/2+t;break;case`LineBeginning`:r=t;break;case`LineEnd`:r=t,i=!0}n?e.seekPathEnd():e.seekPathStart();let a=0;if(n?e.prevPoint():e.nextPoint()){let[t,o]=[e.x,e.y],[s,c]=[0,0],l=[0,0];for(;n?e.prevPoint():e.nextPoint();){s=e.x,c=e.y;let n=this._curveHelper.getLength(t,o,s,c);if(a+n>r){let e=(r-a)/n,[u,d]=this._curveHelper.getAngleCS(l,t,o,s,c,e),f=this._curveHelper.getCoord2D(t,o,s,c,e),p=i?-this._offset:this._offset;return this.internalPlacement.setTranslate(f[0]-p*d,f[1]+p*u),this._angleToLine&&(i?this.internalPlacement.setRotateCS(-u,-d):this.internalPlacement.setRotateCS(u,d)),this.internalPlacement}t=s,o=c,a+=n}}return null}},jn=1e-15,Mn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new Nn(e,t,n)}},Nn=class extends B{constructor(e,t,n){super(e),this._curveHelper=new H,this._angleToLine=t.angleToLine===void 0||t.angleToLine,this._offset=t.offset===void 0?0:t.offset*n,this._endPoints=t.placeOnEndPoints===void 0||t.placeOnEndPoints,this._controlPoints=t.placeOnControlPoints===void 0||t.placeOnControlPoints,this._regularVertices=t.placeOnRegularVertices===void 0||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||=(this._preparePath(e),!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;let t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let n=t[0],r=t[1];if(this._offset!==0){let e=Math.cos(t[2]),i=Math.sin(t[2]);n-=this._offset*i,r+=this._offset*e}return this.internalPlacement.setTranslate(n,r),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();let t=e.isClosed(),n=0,r=!1,i=0,a=0;if(e.seekPathStart(),e.nextPoint()){let o=e.x,s=e.y,c=e.getControlPoint(),l=!0,u=e.nextPoint();for(;u;){let d=e.x,f=e.y,p=e.getControlPoint();(this._angleToLine||this._offset!==0)&&(i=this._curveHelper.getAngle(o,s,d,f,0)),l?(l=!1,t?(n=i,r=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([o,s,i])):c?this._controlPoints&&this._tags.push([o,s,Pn(a,i)]):this._regularVertices&&this._tags.push([o,s,Pn(a,i)]),(this._angleToLine||this._offset!==0)&&(a=this._curveHelper.getAngle(o,s,d,f,1)),u=e.nextPoint(),u||(t?p||r?this._controlPoints&&this._tags.push([d,f,Pn(a,n)]):this._regularVertices&&this._tags.push([d,f,Pn(a,n)]):(this._endPoints||this._controlPoints&&p)&&this._tags.push([d,f,a])),o=d,s=f,c=p}}this._tagIterator=0}};function Pn(e,t){let n=Math.PI;for(;Math.abs(t-e)>n+2*jn;)t-e>n?t-=2*n:t+=2*n;return(e+t)/2}var Fn=class e{static{this.instance=null}static local(){return e.instance===null&&(e.instance=new e),e.instance}execute(e,t,n){return new In(e,t,n)}},In=class{constructor(e,t,n){this._geometryCursor=e,this._offsetX=t.offsetX===void 0?0:t.offsetX*n,this._offsetY=t.offsetY===void 0?0:t.offsetY*n,this._method=t.method===void 0?`OnPolygon`:t.method,this._placementPerPart=t.placePerPart!==void 0&&t.placePerPart,this._internalPlacement=new z}next(){let e=this._geometryCursor;if(!e)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(e);for(;e.nextPath();)if(!(e.getCurrentRingArea()<0))return this._polygonCenter(e.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(e){let t=!1;switch(this._method){case`CenterOfMass`:{let n=ye(e);n&&(this._internalPlacement.setTranslate(n[0]+this._offsetX,n[1]+this._offsetY),t=!0)}break;case`BoundingBoxCenter`:{let n=Ee(e);n&&(this._internalPlacement.setTranslate((n[2]+n[0])/2+this._offsetX,(n[3]+n[1])/2+this._offsetY),t=!0)}break;default:{let n=Ie(e);n!==null&&(this._internalPlacement.setTranslate(n[0]+this._offsetX,n[1]+this._offsetY),t=!0)}}return t?this._internalPlacement:null}};function Ln(e){if(!e)return null;switch(e.type){case`CIMGeometricEffectAddControlPoints`:return pt.local();case`CIMGeometricEffectArrow`:return bt.local();case`CIMGeometricEffectBuffer`:return St.local();case`CIMGeometricEffectControlMeasureLine`:return wt.local();case`CIMGeometricEffectCut`:return Et.local();case`CIMGeometricEffectDashes`:return Mt.local();case`CIMGeometricEffectDonut`:return Pt.local();case`CIMGeometricEffectJog`:return Vt.local();case`CIMGeometricEffectMove`:return Ut.local();case`CIMGeometricEffectOffset`:return Kt.local();case`CIMGeometricEffectRadial`:return Yt.local();case`CIMGeometricEffectReverse`:return Zt.local();case`CIMGeometricEffectRotate`:return en.local();case`CIMGeometricEffectScale`:return nn.local();case`CIMGeometricEffectSuppress`:return on.local();case`CIMGeometricEffectTaperedPolygon`:return ln.local();case`CIMGeometricEffectWave`:return dn.local();case`CIMGeometricEffectEnclosingPolygon`:return It.local()}return null}function Rn(e){if(!e)return null;switch(e.type){case`CIMMarkerPlacementAlongLineSameSize`:return pn.local();case`CIMMarkerPlacementAtExtremities`:return hn.local();case`CIMMarkerPlacementAtMeasuredUnits`:return vn.local();case`CIMMarkerPlacementAtRatioPositions`:return bn.local();case`CIMMarkerPlacementInsidePolygon`:return wn.local();case`CIMMarkerPlacementOnLine`:return kn.local();case`CIMMarkerPlacementOnVertices`:return Mn.local();case`CIMMarkerPlacementPolygonCenter`:return Fn.local()}return null}function zn(e){let t=e.getFrame(0);if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)return t;let n=document.createElement(`canvas`);n.width=e.width,n.height=e.height;let r=n.getContext(`2d`);return t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0),n}function q(e,t=0){if(t===0)return e;let n=Math.cos(t),r=Math.sin(t),[i,a]=e;return[i*n+a*-r,i*r+a*n]}var Bn=class e{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.width=n,this.height=r}static fromExtent(t){return new e(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}};function Vn(e){return`rgb(${e.slice(0,3).toString()})`}function Hn(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}var Un=class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,t){this._textRasterizationCanvas||=document.createElement(`canvas`);let n=this._textRasterizationCanvas,r=n.getContext(`2d`,{willReadFrequently:!0});Wn(r,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();let{decoration:i,weight:a}=t.font;this._lineThroughWidthOffset=i&&i===`line-through`?.1*this._lineHeight:0;let o=t.backgroundColor!=null||t.borderLine!=null,s=o?8:0,c=this._computeTextWidth(r,t)+2*s,l=this._lineHeight*this._textLines.length+2*s;if(n.width=c+2*this._lineThroughWidthOffset,n.height=l,n.width===0||n.height===0)return n.width=n.height=1,{size:[0,0],image:new Uint32Array,sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:n};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(t.outline.size||0)*t.pixelRatio,this._renderedHaloSize=(t.halo.size||0)*t.pixelRatio,this._renderedWidth=c,this._renderedHeight=l,this._lineThroughWidthOffset*=t.pixelRatio;let u=(t.outline&&t.outline.color)??[0,0,0,0],d=t.color??[0,0,0,0],f=t.halo&&t.halo.color?t.halo.color:[0,0,0,0];this._fillStyle=Hn(d),this._outlineStyle=Hn(u),this._haloStyle=Vn(f);let p=this._renderedLineHeight,m=this._renderedOutlineSize,h=this._renderedHaloSize;r.save(),r.clearRect(0,0,n.width,n.height),Wn(r,t);let g=s*t.pixelRatio,_=Gn(r.textAlign,this._renderedWidth-2*g,this._renderedHaloSize+this._renderedOutlineSize)+g,v=h+m+g,y=h>0,b=this._lineThroughWidthOffset,x=0;if(o){r.save();let e=t.backgroundColor??[0,0,0,0],i=t.borderLine?.color??[0,0,0,0],a=2*(t.borderLine?.size??0);r.fillStyle=Hn(e),r.strokeStyle=Hn(i),r.lineWidth=a,r.fillRect(0,0,n.width,n.height),r.strokeRect(0,0,n.width,n.height),r.restore()}y&&this._renderHalo(r,_,v,b,x,t),m>0&&this._renderOutline(r,_,v,b,x,t),x+=v,b+=_;for(let e of this._textLines)y?(r.globalCompositeOperation=`destination-out`,r.fillStyle=`rgb(0, 0, 0)`,r.fillText(e,b,x),r.globalCompositeOperation=`source-over`,r.fillStyle=this._fillStyle,r.fillText(e,b,x)):(r.fillStyle=this._fillStyle,r.fillText(e,b,x)),i&&i!==`none`&&this._renderDecoration(r,b,x,i,a),x+=p;r.restore();let S=this._renderedWidth+2*this._lineThroughWidthOffset,C=this._renderedHeight,w=r.getImageData(0,0,S,C),T=new Uint8Array(w.data);if(t.premultiplyColors){let e;for(let t=0;t<T.length;t+=4)e=T[t+3]/255,T[t]=T[t]*e,T[t+1]=T[t+1]*e,T[t+2]=T[t+2]*e}let E,D;switch(t.horizontalAlignment){case`left`:E=-.5;break;case`right`:E=.5;break;default:E=0}switch(t.verticalAlignment){case`bottom`:D=-.5;break;case`top`:D=.5;break;case`baseline`:D=-1/6;break;default:D=0}return{size:[S,C],image:new Uint32Array(T.buffer),sdf:!1,simplePattern:!1,anchorX:E,anchorY:D,canvas:n}}_renderHalo(e,t,n,r,i,a){let o=this._renderedWidth,s=this._renderedHeight;this._outlineRasterizationCanvas||=document.createElement(`canvas`),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=s;let c=this._outlineRasterizationCanvas,l=c.getContext(`2d`);l.clearRect(0,0,o,s),Wn(l,a);let{decoration:u,weight:d}=a.font;l.fillStyle=this._haloStyle,l.strokeStyle=this._haloStyle,l.lineJoin=`round`,this._renderOutlineNative(l,t,n,u,d,this._renderedHaloSize+this._renderedOutlineSize),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,o,s,r,i,o,s),e.globalAlpha=1}_renderOutline(e,t,n,r,i,a){let o=this._renderedWidth,s=this._renderedHeight;this._outlineRasterizationCanvas||=document.createElement(`canvas`),this._outlineRasterizationCanvas.width=o,this._outlineRasterizationCanvas.height=s;let c=this._outlineRasterizationCanvas,l=c.getContext(`2d`);l.clearRect(0,0,o,s),Wn(l,a);let{decoration:u,weight:d}=a.font;l.fillStyle=this._outlineStyle,l.strokeStyle=this._outlineStyle,l.lineJoin=`round`,this._renderOutlineNative(l,t,n,u,d,this._renderedOutlineSize),e.globalAlpha=this._parameters.outline.color[3],e.drawImage(c,0,0,o,s,r,i,o,s),e.globalAlpha=1}_renderOutlineNative(e,t,n,r,i,a){let o=this._renderedLineHeight;for(let s of this._textLines){let c=2*a,l=.1;for(let a=0;a<5;a++){let o=(1-4*l+a*l)*c;e.lineWidth=o,e.strokeText(s,t,n),r&&r!==`none`&&this._renderDecoration(e,t,n,r,i,o)}n+=o}}computeTextSize(e,t){this._textRasterizationCanvas||=document.createElement(`canvas`);let n=this._textRasterizationCanvas,r=n.getContext(`2d`);Wn(r,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();let i=this._computeTextWidth(r,t),a=this._lineHeight*this._textLines.length;return n.width=i,n.height=a,[i*t.pixelRatio,a*t.pixelRatio]}_computeTextWidth(e,t){let n=0;for(let t of this._textLines)n=Math.max(n,e.measureText(t).width);let r=t.font;return(r.style===`italic`||r.style===`oblique`||typeof r.weight==`string`&&(r.weight===`bold`||r.weight===`bolder`)||typeof r.weight==`number`&&r.weight>600)&&(n+=.3*e.measureText(`w`).width),n+=2*P(this._parameters.halo.size),Math.round(n)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let e=this._computeLineHeightBase(),t=this._parameters.font.decoration;return t&&t===`underline`&&(e*=1.3),Math.round(e+2*P(this._parameters.halo.size))}_renderDecoration(e,t,n,r,i,a){let o=.9*this._lineHeight,s=i===`bold`?.06:i===`bolder`?.09:.04;switch(e.textAlign){case`center`:t-=this._renderedWidth/2;break;case`right`:t-=this._renderedWidth}let c=e.textBaseline;if(r===`underline`)switch(o=.9*this._computeLineHeightBase(),c){case`top`:n+=o;break;case`middle`:n+=o/2}else if(r===`line-through`)switch(c){case`top`:n+=o/1.5;break;case`middle`:n+=o/3}let l=a?1.5*a:Math.ceil(o*s);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=l,e.moveTo(t-this._lineThroughWidthOffset,n),e.lineTo(t+this._renderedWidth+2*this._lineThroughWidthOffset,n),e.stroke(),e.restore()}};function Wn(e,t){let n=Math.max(t.size,.5),r=t.font,i=`${r.style} ${r.weight} ${P(n).toFixed(1)}px ${r.family}, sans-serif`,a;switch(e.font=i,e.textBaseline=`top`,t.horizontalAlignment){case`left`:default:a=`left`;break;case`right`:a=`right`;break;case`center`:a=`center`}e.textAlign=a}function Gn(e,t,n){return e===`center`?.5*t:e===`right`?t-n:n}function Kn(e){return document.createElementNS(`http://www.w3.org/2000/svg`,e)}function qn(){let e=Kn(`svg`);return e.setAttribute(`style`,`position: absolute;`),e.setAttribute(`width`,`0`),e.setAttribute(`height`,`0`),e.setAttribute(`aria-hidden`,`true`),e.setAttribute(`role`,`presentation`),document.body.appendChild(e),e}function Jn(e){return e!=null&&document.body.removeChild(e),null}var Yn=()=>Oe.getLogger(`esri.views.2d.engine.webgl.alignmentUtils`);function Xn(e){if(!e)return 0;switch(e){case`Left`:case`left`:return-1;case`Right`:case`right`:return 1;case`Justify`:return Yn().warnOnce(`Horizontal alignment 'justify' is not implemented. Falling back to 'center'.`),0;case`Center`:case`center`:return 0}}function Zn(e){if(!e)return 0;switch(e){case`Top`:case`top`:return 1;case`Center`:case`middle`:return 0;case`Baseline`:case`baseline`:return 2;case`Bottom`:case`bottom`:return-1}}function Qn(e){switch(e){case`above-left`:case`esriServerPointLabelPlacementAboveLeft`:return[`right`,`bottom`];case`above-center`:case`above-along`:case`esriServerPointLabelPlacementAboveCenter`:case`esriServerLinePlacementAboveAlong`:return[`center`,`bottom`];case`above-right`:case`esriServerPointLabelPlacementAboveRight`:return[`left`,`bottom`];case`center-left`:case`esriServerPointLabelPlacementCenterLeft`:return[`right`,`middle`];case`center-center`:case`center-along`:case`esriServerPointLabelPlacementCenterCenter`:case`esriServerLinePlacementCenterAlong`:case`always-horizontal`:case`esriServerPolygonPlacementAlwaysHorizontal`:return[`center`,`middle`];case`center-right`:case`esriServerPointLabelPlacementCenterRight`:return[`left`,`middle`];case`below-left`:case`esriServerPointLabelPlacementBelowLeft`:return[`right`,`top`];case`below-center`:case`below-along`:case`esriServerPointLabelPlacementBelowCenter`:case`esriServerLinePlacementBelowAlong`:return[`center`,`top`];case`below-right`:case`esriServerPointLabelPlacementBelowRight`:return[`left`,`top`];default:return console.debug(`Found invalid placement type ${e}`),[`center`,`middle`]}}function $n(e){switch(e){case 1:case`right`:return-1;case 0:case`center`:return 0;case-1:case`left`:return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function er(e){switch(e){case 1:case`top`:return 1;case 0:case`middle`:return 0;case-1:case 2:case`baseline`:case`bottom`:return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}var tr=22,nr=4,rr=tr+nr,ir=tr-6,ar=3,or=Math.PI/180,J=8,sr=1.5,cr=class{constructor(e,n,r,i){this._rotationT=t(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;let a=r.rect,o=new Float32Array(8);e*=i,n*=i;let s=r.code?a.width*i:r.metrics.width,c=r.code?a.height*i:r.metrics.height;this.width=s,this.height=c,o[0]=e,o[1]=n,o[2]=e+s,o[3]=n,o[4]=e,o[5]=n+c,o[6]=e+s,o[7]=n+c,this._data=o,this._setTextureCoords(a),this._scale=i,this._mosaic=r,this.x=e,this.y=n,this.maxOffset=Math.max(e+s,n+c)}get mosaic(){return this._mosaic}set angle(e){this._angle=e,l(this._rotationT,-e),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){let{height:e,width:n}=this._mosaic.metrics,r=n*this._scale,i=Math.abs(e)*this._scale,a=new Float32Array(8);a[0]=this.x,a[1]=this.y,a[2]=this.x+r,a[3]=this.y,a[4]=this.x,a[5]=this.y+i,a[6]=this.x+r,a[7]=this.y+i;let o=ie(t(),this._rotationT,this._transform);ne(a,a,o);let s=1/0,c=1/0,l=-1/0,u=-1/0;for(let e=0;e<4;e++){let t=a[2*e],n=a[2*e+1];s=Math.min(s,t),c=Math.min(c,n),l=Math.max(l,t),u=Math.max(u,n)}let d=l-s,f=u-c,p=s+d/2,m=c+f/2;this._bounds=new ze(p,m,d,f)}return this._bounds}setTransform(e){this._transform=e,this._offsets=null}_setOffsets(){this._offsets||={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]};let e=ie(t(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],N(this._offsets.topLeft,this._offsets.topLeft,e),N(this._offsets.topRight,this._offsets.topRight,e),N(this._offsets.bottomLeft,this._offsets.bottomLeft,e),N(this._offsets.bottomRight,this._offsets.bottomRight,e)}_setTextureCoords({x:e,y:t,width:n,height:r}){this._texcoords={topLeft:[e,t],topRight:[e+n,t],bottomLeft:[e,t+r],bottomRight:[e+n,t+r]}}},lr=(e,t)=>({code:0,page:0,sdf:!0,rect:new Re(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});function ur(e,t){return e.forEach(e=>N(e,e,t)),{topLeft:e[0],topRight:e[1],bottomLeft:e[2],bottomRight:e[3]}}var dr=class{constructor(e,t,n){this._rotation=0,this._decorate(e,t,n),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=n.angle!==0,this._transform=this._createGlyphTransform(this.bounds,n),this._borderLineSizePx=n.borderLineSizePx,(n.borderLineSizePx||n.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(let t of e)t.setTransform(this._transform)}setRotation(e){if(e===0&&this._rotation===0)return;this._rotation=e;let n=this._transform,r=l(t(),e);ie(n,r,n);for(let e of this.glyphs)e.setTransform(this._transform)}_decorate(e,t,n){if(!n.decoration||n.decoration===`none`||!e.length)return;let r=n.scale,i=n.decoration===`underline`?rr:ir,a=e[0].textureBinding;for(let n of t){let t=n.startX*r,o=n.startY*r,s=(n.width+n.glyphWidthEnd)*r;e.push(new cr(t,o+i*r,lr(s,a),1))}}shapeBackground(e){let t=this._borderLineSizePx||0,n=(sr+t)/2,r=this._borderLineSizePx?n:0,{xmin:i,ymin:a,xmax:o,ymax:s,x:c,y:l,width:u,height:d}=this.bounds,f=[i-J,a-J],p=[o+J,a-J],m=[i-J,s+J],h=[o+J,s+J],g=ur([[f[0]-n,f[1]-n],[p[0]+n,p[1]-n],[f[0]+r,f[1]+r],[p[0]-r,p[1]+r]],e),_=ur([[m[0]+r,m[1]-r],[h[0]-r,h[1]-r],[m[0]-n,m[1]+n],[h[0]+n,h[1]+n]],e),v=ur([[f[0]-n,f[1]-n],[f[0]+r,f[1]+r],[m[0]-n,m[1]+n],[m[0]+r,m[1]-r]],e),y=ur([[p[0]-r,p[1]+r],[p[0]+n,p[1]-n],[h[0]-r,h[1]-r],[h[0]+n,h[1]+n]],e),b={main:ur([f,p,m,h],e),top:g,bot:_,left:v,right:y};return[new ze(c,l,u+2*n,d+2*n),b]}get boundsT(){let e=this.bounds,t=c(x(),e.x,e.y);if(N(t,t,this._transform),this._hasRotation){let n=Math.max(e.width,e.height);return new ze(t[0],t[1],n,n)}return new ze(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,n=1/0,r=0,i=0;for(let a of e)t=Math.min(t,a.xTopLeft),n=Math.min(n,a.yTopLeft),r=Math.max(r,a.xBottomRight),i=Math.max(i,a.yBottomRight);let a=r-t,o=i-n;return new ze(t+a/2,n+o/2,a,o)}_createGlyphTransform(e,n){let r=or*n.angle,i=t(),a=x();return m(i,i,c(a,n.xOffset,-n.yOffset)),n.useCIMAngleBehavior?D(i,i,r):(m(i,i,c(a,e.x,e.y)),D(i,i,r),m(i,i,c(a,-e.x,-e.y))),i}},fr=class{constructor(e,t,n,r,i,a){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,n)),this.end=Math.max(0,Math.max(t,n)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=r,this.yMin=i,this.yMax=a}},pr=e=>e===10,mr=e=>e===32;function hr(e,t,n){let r=[],i=1/n.scale,a=n.maxLineWidth*i,o=t?e.length-1:0,s=t?-1:e.length,c=t?-1:1,l=o,u=0,d=0,f=l,p=f,m=0,h=1/0,g=0;for(;l!==s;){let{code:t,metrics:n}=e[l],i=Math.abs(n.top);if(pr(t)||mr(t)||(h=Math.min(h,i),g=Math.max(g,i+n.height)),pr(t))l!==o&&(r.push(new fr(e,f,l-c,u,h===1/0?0:h,g)),h=1/0,g=0),u=0,f=l+c,p=l+c,d=0;else if(mr(t))p=l+c,d=0,m=n.advance,u+=n.advance;else if(u>a){if(p!==f){let t=p-2*c;u-=m,r.push(new fr(e,f,t,u-d,h,g)),h=1/0,g=0,f=p,u=d}else r.push(new fr(e,f,l-c,u,h,g)),h=1/0,g=0,f=l,p=l,u=0;u+=n.advance,d+=n.advance}else u+=n.advance,d+=n.advance;l+=c}let _=new fr(e,f,l-c,u,h,g);return _.start>=0&&_.end<e.length&&r.push(_),r}function gr(e,t){let n=0;for(let t=0;t<e.length;t++){let{width:r}=e[t];n=Math.max(r,n)}let r=t.decoration===`underline`?nr:0,i=e[0].yMin;return{x:0,y:i,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+r-i,width:n}}function _r(e,t){let n=t.scale,r=[],{glyphs:i,isRightToLeft:a}=e,o=hr(i,a,t),s=o.length?gr(o,t):{y:0,height:0},c=Xn(t.horizontalAlignment),l=Zn(t.verticalAlignment),u=l===2?1:0,d=u?0:l-1,f=(1-u)*-s.y+d*(s.height/2)+(u?1:0)*-tr;for(let a=0;a<o.length;a++){let{start:s,end:l,width:u}=o[a],d=-1*(c+1)*(u/2)-ar,p=(e.isRightToLeft?o.length-1-a:a)*t.lineHeight+f-ar;o[a].startX=d,o[a].startY=p;for(let e=s;e<=l;e++){let t=i[e];if(pr(t.code))continue;let a=new cr(d+t.metrics.left,p-t.metrics.top,t,n);d+=t.metrics.advance,r.push(a)}}return new dr(r,o,t)}var vr=50;function yr(e){if(!e)return null;let{xmin:t,ymin:n,xmax:r,ymax:i,spatialReference:a}=e;return new be({rings:[[[t,n],[t,i],[r,i],[r,n],[t,n]]],spatialReference:a})}function br(e){return j(Math.round(P(e)))}function xr(e){let t=j(32),n=j(512);return Math.max(t,Math.min(e||n,n))}var Y=Math.PI/180,Sr=.5,Cr=()=>Oe.getLogger(`esri.symbols.cim.CIMSymbolDrawHelper`),X=class e{constructor(e){this._t=e}static createIdentity(){return new e([1,0,0,0,1,0])}clone(){let t=this._t;return new e(t.slice())}transform(e){let t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(t,n){return new e([t,0,0,0,n,0])}scale(e,t){let n=this._t;return n[0]*=e,n[1]*=e,n[2]*=e,n[3]*=t,n[4]*=t,n[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(t,n){return new e([0,0,t,0,0,n])}translate(e,t){let n=this._t;return n[2]+=e,n[5]+=t,this}static createRotate(t){let n=Math.cos(t),r=Math.sin(t);return new e([n,-r,0,r,n,0])}rotate(t){return e.multiply(this,e.createRotate(t),this)}angle(){let e=this._t[0],t=this._t[3],n=Math.sqrt(e*e+t*t);return[e/n,t/n]}static multiply(e,t,n){let r=e._t,i=t._t,a=r[0]*i[0]+r[3]*i[1],o=r[1]*i[0]+r[4]*i[1],s=r[2]*i[0]+r[5]*i[1]+i[2],c=r[0]*i[3]+r[3]*i[4],l=r[1]*i[3]+r[4]*i[4],u=r[2]*i[3]+r[5]*i[4]+i[5],d=n._t;return d[0]=a,d[1]=o,d[2]=s,d[3]=c,d[4]=l,d[5]=u,n}invert(){let t=this._t,n=t[0]*t[4]-t[1]*t[3];if(n===0)return new e([0,0,0,0,0,0]);n=1/n;let r=(t[1]*t[5]-t[2]*t[4])*n,i=(t[2]*t[3]-t[0]*t[5])*n,a=t[4]*n,o=-t[1]*n,s=-t[3]*n,c=t[0]*n;return new e([a,o,r,s,c,i])}},wr=class{constructor(e,t){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new pe(()=>new z,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(t||X.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}setTransform(e,t){this._transfos=[e||X.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,t){let n=t?e.scaleRatio():1;X.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*n)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t,n){if(e)switch(e.type){case`CIMPointSymbol`:case`CIMLineSymbol`:case`CIMPolygonSymbol`:this.drawMultiLayerSymbol(e,t);break;case`CIMTextSymbol`:this.drawTextSymbol(e,t,n)}}drawMultiLayerSymbol(e,t){if(!e||!t)return;let n=e.symbolLayers;if(!n)return;let r=e.effects;if(r&&r.length>0){let e=this.executeEffects(r,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(n,t.asJSON()),t=e.next()}}else this.drawSymbolLayers(n,t)}executeEffects(e,t){let n=new ut(L.fromJSONCIM(t));for(let t of e){let e=Ln(t);e&&(n=e.execute(n,t,this.geomUnitsPerPoint(),null))}return n}drawSymbolLayers(e,t){let n=e.length;for(;n--;){let r=e[n];if(!r||!1===r.enable)continue;let i=r.effects;if(i&&i.length>0){let e=this.executeEffects(i,t);if(e){let t=null;for(;(t=e.next())&&(this.drawSymbolLayer(r,t.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(r,t);if(this._earlyReturn)return}}drawSymbolLayer(e,t){switch(e.type){case`CIMSolidFill`:this.drawSolidFill(t,e.color,e.path);break;case`CIMHatchFill`:this.drawHatchFill(t,e);break;case`CIMPictureFill`:this.drawPictureFill(t,e);break;case`CIMGradientFill`:this.drawGradientFill(t,e);break;case`CIMSolidStroke`:this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit,e.path);break;case`CIMPictureStroke`:this.drawPictureStroke(t,e);break;case`CIMGradientStroke`:this.drawGradientStroke(t,e);break;case`CIMCharacterMarker`:case`CIMPictureMarker`:case`CIMVectorMarker`:this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){let n=Or(t,e,this.geomUnitsPerPoint());n&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,n),this.popClipPath())}drawPictureFill(e,t){}drawGradientFill(e,t){}drawPictureStroke(e,t){}drawGradientStroke(e,t){}drawMarkerLayer(e,t){let n=e.markerPlacement;if(n){let r=Rn(n);if(r){let i=n.type===`CIMMarkerPlacementInsidePolygon`||n.type===`CIMMarkerPlacementPolygonCenter`&&n.clipAtBoundary;i&&this.pushClipPath(t);let a=r.execute(L.fromJSONCIM(t),n,this.geomUnitsPerPoint(),null);if(a){let t=null;for(;(t=a.next())&&(this.drawMarker(e,t),!this._earlyReturn););}i&&this.popClipPath()}}else{let n=this._placementPool.acquire();if(h(t))n.tx=t.x,n.ty=t.y,this.drawMarker(e,n);else if(u(t)){let r=T(t);r&&([n.tx,n.ty]=r,this.drawMarker(e,n))}else if(F(t)){for(let r of t.paths)for(let t of r)if(n.tx=t[0],n.ty=t[1],this.drawMarker(e,n),this._earlyReturn)break}else for(let r of t.points)if(n.tx=r[0],n.ty=r[1],this.drawMarker(e,n),this._earlyReturn)break;this._placementPool.release(n)}}drawMarker(e,t){switch(e.type){case`CIMCharacterMarker`:case`CIMPictureMarker`:this.drawPictureMarker(e,t);break;case`CIMVectorMarker`:this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(!e)return;let n=this._resourceManager.getResource(e.url),r=f(e.size,M.CIMPictureMarker.size);if(n==null||r<=0)return;let i=n.width,a=n.height;if(!i||!a)return;let o=i/a,s=f(e.scaleX,1),c=X.createIdentity(),l=e.anchorPoint;if(l){let t=l.x,n=l.y;e.anchorPointUnits!==`Absolute`&&(t*=r*o*s,n*=r),c.translate(-t,-n)}let u=f(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&c.rotate(u*Y);let d=f(e.offsetX),p=f(e.offsetY);if(d||p){if(this._mapRotation){let e=Y*this._mapRotation,t=Math.cos(e),n=Math.sin(e),r=d*n+p*t;d=d*t-p*n,p=r}c.translate(d,p)}let m=this.geomUnitsPerPoint();m!==1&&c.scale(m,m);let h=t.getAngle();h&&c.rotate(h),c.translate(t.tx,t.ty),this.push(c,!1),this.drawImage(e,r),this.pop()}drawVectorMarker(e,t){if(!e)return;let n=e.markerGraphics;if(!n)return;let r=f(e.size,M.CIMVectorMarker.size),i=e.frame,a=i?i.ymax-i.ymin:0,o=r&&a?r/a:1,s=X.createIdentity();i&&s.translate(.5*-(i.xmax+i.xmin),.5*-(i.ymax+i.ymin));let c=e.anchorPoint;if(c){let t=c.x,n=c.y;e.anchorPointUnits===`Absolute`?(t/=o,n/=o):i&&(t*=i.xmax-i.xmin,n*=i.ymax-i.ymin),s.translate(-t,-n)}o!==1&&s.scale(o,o);let l=f(e.rotation);e.rotateClockwise&&(l=-l),this._mapRotation&&(l+=this._mapRotation),l&&s.rotate(l*Y);let u=f(e.offsetX),d=f(e.offsetY);if(u||d){if(this._mapRotation){let e=Y*this._mapRotation,t=Math.cos(e),n=Math.sin(e),r=u*n+d*t;u=u*t-d*n,d=r}s.translate(u,d)}let p=this.geomUnitsPerPoint();p!==1&&s.scale(p,p);let m=t.getAngle();m&&s.rotate(m),s.translate(t.tx,t.ty),this.push(s,e.scaleSymbolsProportionally);for(let e of n){e?.symbol&&e.geometry||Cr().error(`Invalid marker graphic`,e);let t=e.textString;if(typeof t==`number`&&(t=t.toString()),this.drawSymbol(e.symbol,e.geometry,t),this._earlyReturn)break}this.pop()}drawTextSymbol(e,t,n){if(!e||!h(t)||f(e.height,M.CIMTextSymbol.height)<=0)return;let r=X.createIdentity(),i=f(e.angle);i=-i,i&&r.rotate(i*Y);let a=f(e.offsetX),o=f(e.offsetY);(a||o)&&r.translate(a,o);let s=this.geomUnitsPerPoint();s!==1&&r.scale(s,s),r.translate(t.x,t.y),this.push(r,!1),this.drawText(e,n),this.pop()}},Tr=class extends wr{constructor(e,t){super(e,t),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new Bn(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return le(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(u(e))this._processPath(e.rings,0);else if(F(e))this._processPath(e.paths,0);else if(O(e)){let t=Z(e);t&&this._processPath(t.rings,0)}else console.error(`drawSolidFill Unexpected geometry type!`)}drawSolidStroke(e,t,n){if(!e||this._clipCount>0||n==null||n<=0)return;let r=Math.max(.5*this.transformSize(f(n,M.CIMSolidStroke.width)),.5*Sr);if(u(e))this._processPath(e.rings,r);else if(F(e))this._processPath(e.paths,r);else if(O(e)){let t=Z(e);t&&this._processPath(t.rings,r)}else console.error(`drawSolidStroke unexpected geometry type!`)}drawMarkerLayer(e,t){u(t)&&e.markerPlacement&&(e.markerPlacement.type===`CIMMarkerPlacementInsidePolygon`||e.markerPlacement.type===`CIMMarkerPlacementPolygonCenter`&&e.markerPlacement.clipAtBoundary)?this._processPath(t.rings,0):super.drawMarkerLayer(e,t)}drawHatchFill(e,t){this.drawSolidFill(e)}drawPictureFill(e,t){this.drawSolidFill(e)}drawGradientFill(e,t){this.drawSolidFill(e)}drawPictureStroke(e,t){this.drawSolidStroke(e,null,t.width)}drawGradientStroke(e,t){this.drawSolidStroke(e,null,t.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,t){let{url:n}=e,r=f(e.scaleX,1),i=r*t,a=t,o=this._resourceManager.getResource(n);if(o!=null){let e=o.height/o.width;i=r*(t?e>1?t:t/e:o.width),a=t?e>1?t*e:t:o.height}this._merge(this.transformPt([-i/2,-a/2]),0),this._merge(this.transformPt([-i/2,a/2]),0),this._merge(this.transformPt([i/2,-a/2]),0),this._merge(this.transformPt([i/2,a/2]),0)}drawText(e,t){if(!t||t.length===0)return;this._textRasterizer||=new Un;let n=Nr(e),[r,i]=this._textRasterizer.computeTextSize(t,n);r=j(r),i=j(i);let a=this.transformSize(1)*this.reverseTransformScalar(1);r*=a,i*=a;let o=0;switch(e.horizontalAlignment){case`Left`:o=r/2;break;case`Right`:o=-r/2}let s=0;switch(e.verticalAlignment){case`Bottom`:s=i/2;break;case`Top`:s=-i/2;break;case`Baseline`:s=i/6}this._merge(this.transformPt([-r/2+o,-i/2+s]),0),this._merge(this.transformPt([-r/2+o,i/2+s]),0),this._merge(this.transformPt([r/2+o,-i/2+s]),0),this._merge(this.transformPt([r/2+o,i/2+s]),0)}_processPath(e,t){if(e)for(let n of e){let e=n?n.length:0;if(e>1){this._merge(this.transformPt(n[0]),t);for(let r=1;r<e;r++)this._merge(this.transformPt(n[r]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}},Er=class extends wr{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=Jn(this._svg),this._path=null,this._canvas=null}hitTest(e,t,n,r,i,a){let o=a*P(1);if(this.setTransform(),this.setGeomUnitsPerPoint(o),this._searchPoint=[(e[0]+e[2])/2,(e[1]+e[3])/2],this._searchDistPoint=(e[2]-e[0])/2/o,this._textInfo=r,this._mapRotation=t&&(t.type===`CIMPointSymbol`&&t.angleAlignment!==`Map`||t.type===`CIMTextSymbol`)?i:0,!Se(`esri-mobile`)){let e=j(3*window.devicePixelRatio),n=j(3);!((t?.type===`CIMLineSymbol`||t?.type===`CIMPolygonSymbol`)&&t.symbolLayers?.some(me))&&t?.type!==`CIMMeshSymbol`&&(b(t)??0)<n&&(this._searchDistPoint=e)}return this._earlyReturn=!1,this.drawSymbol(t,n),this._earlyReturn}executeEffects(e,t){return e.at(-1)?.type===`CIMGeometricEffectDashes`&&(e=e.slice(0,-1)),super.executeEffects(e,t)}drawSolidFill(e,t,n){n==null?this._hitTestFill(e):this._hittestSvgPath(e,n,!0)}drawHatchFill(e,t){this._hitTestFill(e)}drawPictureFill(e,t){this._hitTestFill(e)}drawGradientFill(e,t){this._hitTestFill(e)}drawSolidStroke(e,t,n,r,i,a,o){o==null?this._hitTestStroke(e,n):this._hittestSvgPath(e,o,!1,n)}drawPictureStroke(e,t){this._hitTestStroke(e,t.width)}drawGradientStroke(e,t){this._hitTestStroke(e,t.width)}drawMarkerLayer(e,t){e.markerPlacement&&(e.markerPlacement.type===`CIMMarkerPlacementInsidePolygon`||e.markerPlacement.type===`CIMMarkerPlacementPolygonCenter`&&e.markerPlacement.clipAtBoundary)?this._hitTestFill(t):super.drawMarkerLayer(e,t)}pushClipPath(e){}popClipPath(){}drawImage(e,t){let{url:n}=e,r=f(e.scaleX,1),i=this._resourceManager.getResource(n);if(i==null||i.height===0||t===0)return;let a=t*this.geomUnitsPerPoint(),o=a*r*(i.width/i.height),s=this.reverseTransformPt(this._searchPoint),c=this._searchDistPoint;Math.abs(s[0])<o/2+c&&Math.abs(s[1])<a/2+c&&(this._earlyReturn=!0)}drawText(e,t){let n=this._textInfo;if(!n)return;let r=n.get(e);if(!r||!r.glyphMosaicItems.glyphs.length)return;let i=br(f(e.height,M.CIMTextSymbol.height)),{lineGapType:a,lineGap:o}=e,s=a?Mr(a,f(o),i):0,c=e.callout?.type===`CIMBackgroundCallout`,l=_r(r.glyphMosaicItems,{scale:i/24,angle:0,xOffset:0,yOffset:0,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:xr(e.lineWidth),lineHeight:29*Math.max(.25,Math.min(s||1,4)),decoration:e.font.decoration||`none`,useCIMAngleBehavior:!0,hasBackground:c}),u=this.reverseTransformPt(this._searchPoint),d=u[0],p=u[1];for(let e of l.glyphs)if(d>e.xTopLeft&&d<e.xBottomRight&&p>-e.yBottomRight&&p<-e.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(e){let t=null;if(O(e)){let n=e;t=[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]]}else if(u(e))t=e.rings;else{if(!F(e))return;t=e.paths}let n=this.reverseTransformPt(this._searchPoint);kr(n,t)&&(this._earlyReturn=!0),!this._earlyReturn&&Ar(n,t,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return this._svg!=null&&this._path!=null||(this._svg??=qn(),this._path??=Kn(`path`),this._svg.appendChild(this._path)),this._path}_getCanvasContext(e,t){return this._canvas??=document.createElement(`canvas`),this._canvas.width=e,this._canvas.height=t,this._canvas.getContext(`2d`,{willReadFrequently:!0})}_hittestSvgPath(e,t,n,r=0){let i=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),a=this.reverseTransformPt(this._searchPoint),o=De();he(o,e);let s={x:o[0],y:o[1],width:o[2]-o[0],height:o[3]-o[1]},c=this._getSvgPath();c.setAttribute(`d`,t);let l=c.getBBox(),u=Math.max(l.width/s.width,l.height/s.height),d=1,f=2*i*u;f<1&&(d=2/f,u*=d,l.x*=d,l.y*=d,l.width*=d,l.height*=d);let p=1+r*u/2,m=this._getCanvasContext(l.width+2*p,l.height+2*p);m.setTransform(d,0,0,d,-l.x+p,-l.y+p);let h=new Path2D(t);n?m.fill(h):(m.lineWidth=r*(u/d),m.stroke(h));let g=(s.width*u-l.width)/2,_=(s.height*u-l.height)/2,v=Math.floor((a[0]-s.x-i)*u-g+p),y=Math.floor((s.height-(a[1]-s.y)-i)*u+_+p),b=Math.ceil(2*i*u),x=Math.ceil(2*i*u),S=m.getImageData(v,y,b,x).data;for(let e=3;e<S.length;e+=4)if(S[e]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(e,t){let n=null;if(O(e)){let t=e;n=[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}else if(u(e))n=e.rings;else{if(!F(e))return;n=e.paths}Ar(this.reverseTransformPt(this._searchPoint),n,f(t,M.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}},Dr=class extends wr{constructor(e,t,n,r){super(t,n),this._applyAdditionalRenderProps=r,this._colorSubstitutionHelper=new ft,this._ctx=e}drawSolidFill(e,t){if(!e)return;if(u(e))this._buildPath(e.rings,!0);else if(F(e))this._buildPath(e.paths,!0);else if(O(e))this._buildPath(Z(e).rings,!0);else{if(!fe(e))return;console.log(`CanvasDrawHelper.drawSolidFill - No implementation!`)}let n=this._ctx;n.fillStyle=typeof t==`string`?t:`rgba(`+Math.round(t[0])+`,`+Math.round(t[1])+`,`+Math.round(t[2])+`,`+(t[3]??255)/255+`)`,n.fill(`evenodd`)}drawSolidStroke(e,t,n,r,i,a){if(!e||!t||n===0)return;if(u(e))this._buildPath(e.rings,!0);else if(F(e))this._buildPath(e.paths,!1);else{if(!O(e))return void console.log(`CanvasDrawHelper.drawSolidStroke isn't implemented!`);this._buildPath(Z(e).rings,!0)}let o=this._ctx;o.strokeStyle=typeof t==`string`?t:`rgba(`+Math.round(t[0])+`,`+Math.round(t[1])+`,`+Math.round(t[2])+`,`+(t[3]??255)/255+`)`,o.lineWidth=Math.max(this.transformSize(n),Sr),this._setCapStyle(r),this._setJoinStyle(i),o.miterLimit=a,o.stroke()}pushClipPath(e){if(this._ctx.save(),u(e))this._buildPath(e.rings,!0);else if(F(e))this._buildPath(e.paths,!0);else{if(!O(e))return;this._buildPath(Z(e).rings,!0)}this._ctx.clip(`evenodd`)}popClipPath(){this._ctx.restore()}drawImage(e,t){let{colorSubstitutions:n,url:r,tintColor:i}=e,a=f(e.scaleX,1),o=this._resourceManager.getResource(r);if(o==null)return;let s=t*(o.width/o.height),c=t;t||(s=o.width,c=o.height);let l=k(r)||`src`in o&&k(o.src),u=`getFrame`in o?zn(o):o;n&&(u=this._colorSubstitutionHelper.applyColorSubstitution(u,n)),this._applyAdditionalRenderProps&&!l&&i&&(u=this._colorSubstitutionHelper.tintImageData(u,i));let d=this.transformPt([0,0]),[p,m]=this.getTransformAngle(),h=this.transformSize(1),g=this._ctx;g.save(),g.setTransform({m11:a*h*p,m12:a*h*m,m21:-h*m,m22:h*p,m41:d[0],m42:d[1]}),g.drawImage(u,-s/2,-c/2,s,c),g.restore()}drawText(e,t){if(!t||t.length===0)return;this._textRasterizer||=new Un;let n=Nr(e,this.transformSize(j(1))),r=this._textRasterizer.rasterizeText(t,n);if(!r)return;let{size:i,anchorX:a,anchorY:o,canvas:s}=r,c=i[0]*(a+.5),l=i[1]*(o-.5),u=this._ctx,d=this.transformPt([0,0]),[f,p]=this.getTransformAngle();u.save(),u.setTransform({m11:1*f,m12:1*p,m21:-1*p,m22:1*f,m41:d[0]-1*c,m42:d[1]+1*l}),u.drawImage(s,0,0),u.restore()}drawPictureFill(e,t){if(!e)return;let{colorSubstitutions:n,height:r,offsetX:i,offsetY:a,rotation:o,scaleX:s,tintColor:c,url:l}=t,d=this._resourceManager.getResource(l);if(d==null)return;if(u(e))this._buildPath(e.rings,!0);else if(F(e))this._buildPath(e.paths,!0);else if(O(e))this._buildPath(Z(e).rings,!0);else{if(!fe(e))return;console.log(`CanvasDrawHelper.drawPictureFill - No implementation!`)}let f=this._ctx,p=k(l)||`src`in d&&k(d.src),m,h=`getFrame`in d?zn(d):d;if(n&&(h=this._colorSubstitutionHelper.applyColorSubstitution(h,n)),this._applyAdditionalRenderProps){p||c&&(h=this._colorSubstitutionHelper.tintImageData(h,c)),m=f.createPattern(h,`repeat`);let e=this.transformSize(1);o||=0,i?i*=e:i=0,a?a*=e:a=0,r&&(r*=e);let t=r?r/d.height:1,n=s&&r?s*r/d.width:1;if(o!==0||t!==1||n!==1||i!==0||a!==0){let e=new DOMMatrix;e.rotateSelf(0,0,-o).translateSelf(i,a).scaleSelf(n,t,1),m.setTransform(e)}}else m=f.createPattern(h,`repeat`);f.save(),f.fillStyle=m,f.fill(`evenodd`),f.restore()}drawPictureStroke(e,t){if(!e)return;let{colorSubstitutions:n,capStyle:r,joinStyle:i,miterLimit:a,tintColor:o,url:s,width:c}=t,l=this._resourceManager.getResource(s);if(l==null)return;let d;if(u(e))d=e.rings;else if(F(e))d=e.paths;else{if(!O(e))return fe(e)?void console.log(`CanvasDrawHelper.drawPictureStroke - No implementation!`):void 0;d=Z(e).rings}c||=l.width;let f=k(s)||`src`in l&&k(l.src),p=`getFrame`in l?zn(l):l;n&&(p=this._colorSubstitutionHelper.applyColorSubstitution(p,n)),this._applyAdditionalRenderProps&&(f||o&&(p=this._colorSubstitutionHelper.tintImageData(p,o)));let m=Math.max(this.transformSize(P(c)),.5),h=m/p.width,g=this._ctx,_=g.createPattern(p,`repeat-y`),v,y;g.save(),this._setCapStyle(r),this._setJoinStyle(i),a!==void 0&&(g.miterLimit=a),g.lineWidth=m;for(let e of d)if(e=re(e),Fr(e),e&&!(e.length<=1)){v=this.transformPt(e[0]);for(let t=1;t<e.length;t++){y=this.transformPt(e[t]);let n=jr(v,y),r=new DOMMatrix;r.translateSelf(0,v[1]-m/2).scaleSelf(h,h,1).rotateSelf(0,0,90-n),_.setTransform(r),g.strokeStyle=_,g.beginPath(),g.moveTo(v[0],v[1]),g.lineTo(y[0],y[1]),g.stroke(),v=y}}g.restore()}drawGradientFill(t,n){if(!t)return;let r;if(u(t))r=t.rings;else if(F(t))r=t.paths;else{if(!O(t))return void Cr().error(`Unable to draw gradient fill`);r=Z(t).rings}this._buildPath(r,!0);let{angle:i,gradientMethod:a,gradientSize:o,gradientSizeUnits:s}=n,c=M.CIMGradientFill,l=n.gradientType??c.gradientType,d=-_e(i??0),f=oe();for(let e of r){let t=e?e.length:0;if(t>1)for(let n=0;n<t;n++){let t=this.transformPt(e[n]);a!==`Linear`&&a!==`Rectangular`||(t=q(t,-d)),Ce(f,t)}}let[p,m,h,g]=f,v=this._ctx;switch(v.save(),a){case`Buffered`:Cr().error(`Gradient method "${a}" currently unsupported.`);break;case`Linear`:{let e=(m+g)/2,t=s===`Absolute`?this.transformSize(P(o)):_(o,c.gradientSize)*(h-p),[r,i]=l===`Discrete`?[h,h-t]:[p+t,p],a=q([r,e],d),u=q([i,e],d),f=v.createLinearGradient(a[0],a[1],u[0],u[1]);Le(f,n),v.fillStyle=f,v.fill(`evenodd`);break}case`Circular`:{let t=Ne(f),r=e(f)/2,i=s===`Absolute`?this.transformSize(P(o)):_(o,c.gradientSize)*r,[a,u]=l===`Discrete`?[r,r-i]:[i,0],d=v.createRadialGradient(t[0],t[1],a,t[0],t[1],u);Le(d,n),v.fillStyle=d,v.fill(`evenodd`);break}case`Rectangular`:{let e=Ne(f),r=e[0],i=e[1],a=q(e,d),u=(e,r,i,o,s,c,l,u)=>{v.save(),this.pushClipPath(t);let f=q([s,c],d),p=q([l,u],d);v.beginPath(),v.moveTo(a[0],a[1]),v.lineTo(f[0],f[1]),v.lineTo(p[0],p[1]),v.lineTo(a[0],a[1]),v.clip();let m=q([e,r],d),h=q([i,o],d),g=v.createLinearGradient(m[0],m[1],h[0],h[1]);Le(g,n),v.fillStyle=g,v.fill(`evenodd`),v.restore()},y=s===`Absolute`?this.transformSize(P(o)):_(o,c.gradientSize)*(te(f)/2),[b,x]=l===`Discrete`?[h,h-y]:[r+y,r];u(b,i,x,i,h,m,h,g),[b,x]=l===`Discrete`?[p,p+y]:[r-y,r],u(b,i,x,i,p,g,p,m),y=s===`Absolute`?this.transformSize(P(o)):_(o,c.gradientSize)*(se(f)/2);let[S,C]=l===`Discrete`?[g,g-y]:[i+y,i];u(r,S,r,C,h,g,p,g),[S,C]=l===`Discrete`?[m,m+y]:[i-y,i],u(r,S,r,C,p,m,h,m);break}}v.restore()}drawGradientStroke(e,t){let{capStyle:n,gradientMethod:r,gradientSize:i,gradientSizeUnits:a,joinStyle:o,miterLimit:s,width:c}=t;if(!e||c===0)return;let l;if(u(e))l=e.rings;else if(F(e))l=e.paths;else{if(!O(e))return void Cr().error(`Unable to draw gradient stroke`);l=Z(e).rings}let d=t.gradientType??M.CIMGradientStroke.gradientType,f=Math.max(this.transformSize(P(c)),.5),p=this._ctx,m,h;p.save(),this._setCapStyle(n),this._setJoinStyle(o),s!==void 0&&(p.miterLimit=s),p.lineWidth=f;for(let e of l){if(e=re(e),Fr(e),!e||e.length<=1)continue;let n=0;m=this.transformPt(e[0]);for(let t=1;t<e.length;t++){h=this.transformPt(e[t]);let r=h[0]-m[0],i=h[1]-m[1];n+=Math.sqrt(r*r+i*i),m=h}let o=a===`Absolute`?this.transformSize(P(i)):_(i,M.CIMGradientStroke.gradientSize)*(r===`AcrossLine`?f:n),s=0;m=this.transformPt(e[0]);for(let i=1;i<e.length;i++){h=this.transformPt(e[i]);let a=h[0]-m[0],c=h[1]-m[1],l=Math.sqrt(a*a+c*c),u,g,_,v;switch(r){case`AcrossLine`:{let[e,t]=q([a/l,c/l],-Math.PI/2),n=f/2,r=d===`Discrete`?n:o-n;u=(m[0]+h[0])/2+e*r,g=(m[1]+h[1])/2+t*r,_=u-e*o,v=g-t*o;break}case`AlongLine`:{let e=a/l,t=c/l;d===`Discrete`?(u=m[0]-e*s,g=m[1]-t*s,_=u+e*o,v=g+t*o):(_=m[0]+e*(n-s),v=m[1]+t*(n-s),u=_-e*o,g=v-t*o);break}default:Cr().error(`Unrecognized gradient method:`,r),p.restore();return}let y=p.createLinearGradient(u,g,_,v);Le(y,t),p.strokeStyle=y,p.beginPath(),p.moveTo(m[0],m[1]),p.lineTo(h[0],h[1]),p.stroke(),s+=l,m=h}}p.restore()}_buildPath(e,t){let n=this._ctx;if(n.beginPath(),e)for(let r of e){let e=r?r.length:0;if(e>1){let i=this.transformPt(r[0]);n.moveTo(i[0],i[1]);for(let t=1;t<e;t++)i=this.transformPt(r[t]),n.lineTo(i[0],i[1]);t&&n.closePath()}}}_setCapStyle(e){switch(e){case`Butt`:this._ctx.lineCap=`butt`;break;case`Round`:this._ctx.lineCap=`round`;break;case`Square`:this._ctx.lineCap=`square`}}_setJoinStyle(e){switch(e){case`Bevel`:this._ctx.lineJoin=`bevel`;break;case`Round`:this._ctx.lineJoin=`round`;break;case`Miter`:this._ctx.lineJoin=`miter`}}};function Or(e,t,n){let r=f(e.separation,M.CIMHatchFill.separation)*n,i=f(e.rotation);if(r===0)return null;r<0&&(r=-r);let a=0,o=.5*r;for(;a>o;)a-=r;for(;a<-o;)a+=r;let s=De();he(s,t),s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o;let c=[[s[0],s[1]],[s[0],s[3]],[s[2],s[3]],[s[2],s[1]]];for(;i>180;)i-=180;for(;i<0;)i+=180;let l=Math.cos(i*Y),u=Math.sin(i*Y),d=-r*u,p=r*l,m,h,g,_;a=f(e.offsetX)*n*u-f(e.offsetY)*n*l,m=g=Number.MAX_VALUE,h=_=-Number.MAX_VALUE;for(let e of c){let t=e[0],n=e[1],r=l*t+u*n,i=-u*t+l*n;m=Math.min(m,r),g=Math.min(g,i),h=Math.max(h,r),_=Math.max(_,i)}g=Math.floor(g/r)*r;let v=l*m-u*g-d*a/r,y=u*m+l*g-p*a/r,b=l*h-u*g-d*a/r,x=u*h+l*g-p*a/r,S=1+Math.round((_-g)/r),C=[];for(let e=0;e<S;e++)v+=d,y+=p,b+=d,x+=p,C.push([[v,y],[b,x]]);return{paths:C}}function kr(e,t){let n=0;for(let r of t){let t=r.length;for(let i=1;i<t;i++){let t=r[i-1],a=r[i];t[1]>e[1]!=a[1]>e[1]&&((a[0]-t[0])*(e[1]-t[1])-(a[1]-t[1])*(e[0]-t[0])>0?n++:n--)}}return n!==0}function Ar(e,t,n){for(let r of t){let t=r.length;for(let i=1;i<t;i++){let t=r[i-1],a=r[i],o=(a[0]-t[0])*(a[0]-t[0])+(a[1]-t[1])*(a[1]-t[1]);if(o===0)continue;o=Math.sqrt(o);let s=((a[0]-t[0])*(e[1]-t[1])-(a[1]-t[1])*(e[0]-t[0]))/o;if(Math.abs(s)<n){let r=((a[0]-t[0])*(e[0]-t[0])+(a[1]-t[1])*(e[1]-t[1]))/o;if(r>-n&&r<o+n)return!0}}}return!1}function jr(e,t){let n=t[0]-e[0],r=t[1]-e[1];return 180/Math.PI*Math.atan2(r,n)}var Z=e=>e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null,Mr=(e,t,n)=>{switch(e){case`ExtraLeading`:return 1+t/n;case`Multiple`:return t;case`Exact`:return t/n}};function Nr(e,t=1){let n=Me(e),i=E(e.fontStyleName),a=e.fontFamilyName??`arial-unicode-ms`,{weight:o,style:s}=i,c=t*(e.height||5),l=Ae(e.horizontalAlignment),u=C(e.verticalAlignment),d=g(e),f=g(e.haloSymbol),p=f==null?0:t*(e.haloSize??0),m=r(e.symbol),h=t*(Te(e.symbol)||0),_=e.callout?.type===`CIMBackgroundCallout`?e.callout.backgroundSymbol:null,v=g(_),y=Te(_),b=r(_);return{color:d,size:c,horizontalAlignment:l,verticalAlignment:u,font:{family:a,style:we(s),weight:ve(o),decoration:n},outline:{size:h||0,color:m},halo:{size:p||0,color:f,style:s},backgroundColor:v,borderLine:y!=null&&b!=null?{size:y,color:b}:null,pixelRatio:1,premultiplyColors:!0}}var Pr=1e-4;function Fr(e){let t,n,r,i,a,o=e[0],s=1;for(;s<e.length;)t=e[s][0]-o[0],n=e[s][1]-o[1],i=t===0?Math.PI/2:n/t,r!==void 0&&Math.abs(i-r)<=Pr?(e.splice(s-1,1),o=a):(a=o,o=e[s],s++),r=i}var Ir=new Be;function Lr(e){if(e==null)return[``,!1];if(!Ir.hasBidiChar(e))return[e,!1];let t;return t=Ir.checkContextual(e)===`rtl`?`IDNNN`:`ICNNN`,[Ir.bidiTransform(e,t,`VLYSN`),!0]}var Rr=Math.PI,zr=Rr/2,Br=Math.PI/180,Vr=96/72,Hr=1.4142135623730951,Ur=2,Wr=4,Gr=()=>Oe.getLogger(`esri.symbols.cim.CIMSymbolHelper`);function Kr(e){let t;switch(e.type){case`cim`:return e.data;case`web-style`:return e;case`simple-marker`:{let n=Q.fromSimpleMarker(e);if(!n)throw Error(`InternalError: Cannot convert symbol to CIM`);t=n;break}case`picture-marker`:t=Q.fromPictureMarker(e);break;case`simple-line`:t=Q.fromSimpleLineSymbol(e);break;case`simple-fill`:t=Q.fromSimpleFillSymbol(e);break;case`picture-fill`:t=Q.fromPictureFillSymbol(e);break;case`text`:t=Q.fromTextSymbol(e)}return{type:`CIMSymbolReference`,symbol:t}}function qr(e,t,n){switch(t.type){case`CIMSymbolReference`:return qr(e,t.symbol,n);case`CIMPointSymbol`:n??={x:0,y:0},e.drawSymbol(t,n);break;case`CIMLineSymbol`:n??={paths:[[[0,0],[10,0]]]},e.drawSymbol(t,n);break;case`CIMPolygonSymbol`:n??={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]},e.drawSymbol(t,n);break;case`CIMTextSymbol`:e.drawSymbol(t,{x:0,y:0});break;case`CIMVectorMarker`:{let n=new z;e.drawMarker(t,n);break}}return e.envelope()}function Jr(e){if(!e)return 0;switch(e.type){case`CIMMarkerPlacementAlongLineSameSize`:case`CIMMarkerPlacementAlongLineRandomSize`:case`CIMMarkerPlacementAtExtremities`:case`CIMMarkerPlacementAtMeasuredUnits`:case`CIMMarkerPlacementAtRatioPositions`:case`CIMMarkerPlacementOnLine`:case`CIMMarkerPlacementOnVertices`:return Math.abs(e.offset);default:return 0}}function Yr(e){if(!e)return 0;switch(e.type){case`CIMGeometricEffectArrow`:return Math.abs(.5*e.width);case`CIMGeometricEffectBuffer`:return Math.abs(e.size);case`CIMGeometricEffectControlMeasureLine`:return 500;case`CIMGeometricEffectExtension`:case`CIMGeometricEffectRadial`:return Math.abs(e.length);case`CIMGeometricEffectJog`:return Math.abs(.5*e.length);case`CIMGeometricEffectMove`:return Math.max(Math.abs(f(e.offsetX)),Math.abs(f(e.offsetY)));case`CIMGeometricEffectOffset`:case`CIMGeometricEffectOffsetTangent`:return Math.abs(e.offset);case`CIMGeometricEffectRegularPolygon`:return Math.abs(e.radius);case`CIMGeometricEffectRotate`:case`CIMGeometricEffectScale`:default:return 0;case`CIMGeometricEffectTaperedPolygon`:return .5*Math.max(Math.abs(e.fromWidth),Math.abs(e.toWidth));case`CIMGeometricEffectWave`:return Math.abs(e.amplitude);case`CIMGeometricEffectDonut`:return Math.abs(e.width)}}function Xr(e){if(!e)return 0;let t=0;for(let n of e)t+=Yr(n);return t}var Zr=class{static getSymbolInflateSize(e,t,n,r,i){return e||=[0,0,0,0],t?this._getInflateSize(e,t,n,r,i):e}static safeSize(e){let t=Math.max(Math.abs(e[0]),Math.abs(e[2])),n=Math.max(Math.abs(e[1]),Math.abs(e[3]));return Math.sqrt(t*t+n*n)}static _vectorMarkerBounds(e,t,n,r){let i=!0,a=De();if(t?.markerGraphics)for(let o of t.markerGraphics){let t=[0,0,0,0];o.geometry&&(he(a,o.geometry),t[0]=0,t[1]=0,t[2]=0,t[3]=0,this.getSymbolInflateSize(t,o.symbol,n,0,r),a[0]+=t[0],a[1]+=t[1],a[2]+=t[2],a[3]+=t[3],i?(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],i=!1):(e[0]=Math.min(e[0],a[0]),e[1]=Math.min(e[1],a[1]),e[2]=Math.max(e[2],a[2]),e[3]=Math.max(e[3],a[3])))}return e}static _getInflateSize(e,t,n,r,i){if(si(t)){let a=this._getLayersInflateSize(e,t.symbolLayers,n,r,i),o=Xr(t.effects);return o>0&&(a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o),a}return this._getTextInflatedSize(e,t,i)}static _getLayersInflateSize(e,t,n,r,i){let a=!0;if(!t)return e;for(let o of t){if(!o)continue;let t=[0,0,0,0];switch(o.type){case`CIMSolidFill`:case`CIMPictureFill`:case`CIMHatchFill`:case`CIMGradientFill`:break;case`CIMSolidStroke`:case`CIMPictureStroke`:case`CIMGradientStroke`:{let e=o,n=e.width;n!=null&&(e.capStyle===`Square`||e.joinStyle===`Miter`?n/=Hr:n/=2,t[0]=-n,t[1]=-n,t[2]=n,t[3]=n);break}case`CIMCharacterMarker`:case`CIMVectorMarker`:case`CIMPictureMarker`:{let e=o;if(o.type===`CIMVectorMarker`){let e=o;if(t=this._vectorMarkerBounds(t,e,n,i),e.frame){let n=(e.frame.xmin+e.frame.xmax)/2,r=(e.frame.ymin+e.frame.ymax)/2;if(t[0]-=n,t[1]-=r,t[2]-=n,t[3]-=r,e.size!=null){let n=e.size/(e.frame.ymax-e.frame.ymin);t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n}}}else if(o.type===`CIMPictureMarker`){let r=o,i=n.getResource(r.url),a=1;if(i!=null&&i.height&&(a=i.width/i.height),e.size!=null){let n=e.size/2,i=e.size*a*r.scaleX/2;t=[-i,-n,i,n]}}else if(e.size!=null){let n=e.size/2;t=[-n,-n,n,n]}if(e.anchorPoint){let n,r;e.anchorPointUnits===`Absolute`?(n=e.anchorPoint.x,r=e.anchorPoint.y):(n=e.anchorPoint.x*(t[2]-t[0]),r=e.anchorPoint.y*(t[3]-t[1]));let i=1.25*Math.sqrt(n*n+r*r);t[0]-=i,t[1]-=i,t[2]+=i,t[3]+=i}let a=f(e.rotation);if(e.rotateClockwise&&(a=-a),r&&(a-=r),a){let e=Br*a,n=Math.cos(e),r=Math.sin(e),i=De([Fe,Fe,-Fe,-Fe]);Ce(i,[t[0]*n-t[1]*r,t[0]*r+t[1]*n]),Ce(i,[t[0]*n-t[3]*r,t[0]*r+t[3]*n]),Ce(i,[t[2]*n-t[1]*r,t[2]*r+t[1]*n]),Ce(i,[t[2]*n-t[3]*r,t[2]*r+t[3]*n]),t=i}let s=f(e.offsetX),c=f(e.offsetY);if(r){let e=Br*r,t=Math.cos(e),n=Math.sin(e),i=s*n+c*t;s=s*t-c*n,c=i}t[0]+=s,t[1]+=c,t[2]+=s,t[3]+=c;let l=Jr(e.markerPlacement);l>0&&(t[0]-=l,t[1]-=l,t[2]+=l,t[3]+=l);break}}let s=Xr(o.effects);s>0&&(t[0]-=s,t[1]-=s,t[2]+=s,t[3]+=s),a?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],a=!1):(e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]))}return e}static _getTextInflatedSize(e,t,n){let r=br(t.height??M.CIMTextSymbol.height);if(e[0]=-r/2,e[1]=-r/2,e[2]=r/2,e[3]=r/2,!n)return e;let i=n.get(t);if(!i||!i.glyphMosaicItems.glyphs.length)return e;let{lineGapType:a,lineGap:o}=t,s=a?Mr(a,o??0,r):0,c=t.callout?.type===`CIMBackgroundCallout`,l=_r(i.glyphMosaicItems,{scale:r/24,angle:f(t.angle),xOffset:f(t.offsetX),yOffset:f(t.offsetY),horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:xr(t.lineWidth),lineHeight:29*Math.max(.25,Math.min(s||1,4)),decoration:t.font.decoration||`none`,useCIMAngleBehavior:!0,hasBackground:c}).boundsT,u=Math.sqrt(l.width*l.width+l.height*l.height);return e[0]-=l.x+u,e[1]-=l.y-u,e[2]+=l.x+u,e[3]+=-l.y+u,e}},Q=class e{static getEnvelope(e,t,n){if(!e)return null;let r=new Tr(n);if(Array.isArray(e)){let n;for(let i of e)n?n.union(qr(r,i,t)):n=qr(r,i,t);return n}return qr(r,e,t)}static getTextureInfo(e,t,n,r,i){let a=r??this.getEnvelope(e,null,t);if(!a)return[0,0,0,0,1];let o=Math.max(a.width,a.height)*Vr,s=i==null?1:Math.max(i/o,1);s*=Vr,a.x*=s,a.y*=s,a.width*=s,a.height*=s,a.width=Math.max(Math.ceil(a.x+a.width)-Math.floor(a.x),1)-1,a.height=Math.max(Math.ceil(a.y+a.height)-Math.floor(a.y),1)-1;let c=a.x+.5*a.width,l=a.y+.5*a.height;return c+=a.x-Math.floor(a.x),l+=a.y-Math.floor(a.y),r||(a.width+=n,a.height+=n,c+=n/2,l+=n/2),[a.width,a.height,c,l,s]}static getTextureAnchor(e,t,n){let[r,i,a,o,s]=this.getTextureInfo(e,t,Ur,null,n);return[-a/r,-o/i,i/s*Vr]}static rasterize(e,t,n,r,i=!0,a){let[o,s,c,l,u]=this.getTextureInfo(t,r,Ur,n,a);e.width=o,e.height=s;let d=e.getContext(`2d`,{willReadFrequently:!0}),f=X.createScale(u,-u);f.translate(.5*o-c,.5*s+l);let p=new Dr(d,r,f);switch(t.type){case`CIMPointSymbol`:p.drawSymbol(t,{type:`point`,x:0,y:0});break;case`CIMVectorMarker`:{let e=new z;p.drawMarker(t,e);break}}let m=d.getImageData(0,0,e.width,e.height),h=new Uint8Array(m.data);if(i){let e;for(let t=0;t<h.length;t+=4)e=h[t+3]/255,h[t]=h[t]*e,h[t+1]=h[t+1]*e,h[t+2]=h[t+2]*e}return[h,e.width,e.height,-c/o,-l/s]}static fromTextSymbol(t){let{text:n}=t;return{type:`CIMPointSymbol`,symbolLayers:[{type:`CIMVectorMarker`,enable:!0,anchorPointUnits:`Relative`,dominantSizeAxis3D:`Y`,size:10,billboardMode3D:`FaceNearPlane`,frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:`CIMMarkerGraphic`,geometry:{x:0,y:0},symbol:e.createCIMTextSymbolfromTextSymbol(t),textString:n}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:`Display`}}static fromPictureFillSymbol(e){let{height:t,outline:n,width:r,xoffset:i,xscale:a,yoffset:o,yscale:s}=e,c=[],l={type:`CIMPolygonSymbol`,symbolLayers:c};if(n){let e=ui(n);e&&c.push(e)}let u=e.url;e.type===`esriPFS`&&e.imageData&&(u=e.imageData);let d=`angle`in e?e.angle??0:0,p=(r??0)*(a||1),m=(t??0)*(s||1);return c.push({type:`CIMPictureFill`,invertBackfaceTexture:!1,scaleX:1,textureFilter:`Picture`,tintColor:null,url:u,height:m,width:p,offsetX:f(i),offsetY:f(o),rotation:f(-d),colorSubstitutions:null}),l}static fromSimpleFillSymbol(e){let{color:t,style:n,outline:r}=e,i=[],a={type:`CIMPolygonSymbol`,symbolLayers:i};if(r){let e=ui(r);e&&i.push(e)}if(n&&n!==`solid`&&n!==`none`&&n!==`esriSFSSolid`&&n!==`esriSFSNull`){let e={type:`CIMLineSymbol`,symbolLayers:[{type:`CIMSolidStroke`,color:$(t),capStyle:`Butt`,joinStyle:`Miter`,width:.75}]},r=0,a=j(li(n)?8:10);switch(n){case`vertical`:case`esriSFSVertical`:r=90;break;case`forward-diagonal`:case`esriSFSForwardDiagonal`:case`diagonal-cross`:case`esriSFSDiagonalCross`:r=-45;break;case`backward-diagonal`:case`esriSFSBackwardDiagonal`:r=45;break;case`cross`:case`esriSFSCross`:r=0}i.push({type:`CIMHatchFill`,lineSymbol:e,offsetX:0,offsetY:0,rotation:r,separation:a}),n===`cross`||n===`esriSFSCross`?i.push({type:`CIMHatchFill`,lineSymbol:re(e),offsetX:0,offsetY:0,rotation:90,separation:a}):n!==`diagonal-cross`&&n!==`esriSFSDiagonalCross`||i.push({type:`CIMHatchFill`,lineSymbol:re(e),offsetX:0,offsetY:0,rotation:45,separation:a})}else !n||n!==`solid`&&n!==`esriSFSSolid`||i.push({type:`CIMSolidFill`,enable:!0,color:$(t)});return a}static fromSimpleLineSymbol(t){let{cap:n,color:r,join:i,marker:a,miterLimit:o,style:s,width:c}=t,l=null;s!==`solid`&&s!==`none`&&s!==`esriSLSSolid`&&s!==`esriSLSNull`&&(l=[{type:`CIMGeometricEffectDashes`,dashTemplate:oi(s,n),lineDashEnding:`NoConstraint`,scaleDash:!0,offsetAlongLine:null}]);let u=[];if(a){let t;switch(a.placement){case`begin-end`:t=`Both`;break;case`begin`:t=`JustBegin`;break;case`end`:t=`JustEnd`;break;default:t=`None`}let n=e.fromSimpleMarker(a,c,r).symbolLayers[0];n.markerPlacement={type:`CIMMarkerPlacementAtExtremities`,placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:t,offsetAlongLine:0},u.push(n)}return u.push({type:`CIMSolidStroke`,color:s!==`none`&&s!==`esriSLSNull`?$(r):[0,0,0,0],capStyle:$r(n),joinStyle:ei(i),miterLimit:o,width:c,effects:l}),{type:`CIMLineSymbol`,symbolLayers:u}}static fromPictureMarker(e){let{angle:t,height:n,width:r,xoffset:i,yoffset:a}=e,o=e.url;return e.type===`esriPMS`&&e.imageData&&(o=e.imageData),{type:`CIMPointSymbol`,symbolLayers:[{type:`CIMPictureMarker`,invertBackfaceTexture:!1,scaleX:1,textureFilter:`Picture`,tintColor:null,url:o,size:n,width:r,offsetX:f(i),offsetY:f(a),rotation:f(-t)}]}}static createCIMTextSymbolfromTextSymbol(e){let{angle:t,color:n,font:r,haloColor:i,haloSize:a,horizontalAlignment:o,kerning:s,lineWidth:c,text:l,verticalAlignment:u,xoffset:d,yoffset:p,backgroundColor:m,borderLineColor:h,borderLineSize:g}=e,_,v,y,b,x,S;r&&(_=r.family,v=r.style,y=r.weight,b=r.size,x=r.decoration);let C=!1;return l&&(C=Lr(l)[1]),(m||g)&&(S={type:`CIMBackgroundCallout`,margin:null,backgroundSymbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,color:$(m)},{type:`CIMSolidStroke`,color:$(h),width:g}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:`CIMTextSymbol`,angle:t,blockProgression:2,depth3D:1,extrapolateBaselines:!0,fontEffects:0,fontEncoding:1,fontFamilyName:_||`Arial`,fontStyleName:ri(v,y),fontType:0,haloSize:a,height:b,hinting:1,horizontalAlignment:ti(o??`center`),kerning:s,letterWidth:100,ligatures:!0,lineGapType:`Multiple`,lineWidth:c,offsetX:f(d),offsetY:f(p),strikethrough:x===`line-through`,underline:x===`underline`,symbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,enable:!0,color:$(n)}]},haloSymbol:{type:`CIMPolygonSymbol`,symbolLayers:[{type:`CIMSolidFill`,enable:!0,color:$(i)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:`Normal`,textDirection:C?1:0,verticalAlignment:ni(u??`baseline`),verticalGlyphOrientation:0,wordSpacing:100,billboardMode3D:2,callout:S}}static createPictureMarkerRasterizationParam(e){let{angle:t,height:n,width:r,xoffset:i,yoffset:a}=e,o=e.url??e.source?.url??e.source?.imageData;return o?{type:`sprite-rasterization-param`,overrides:[],resource:{type:`CIMPictureMarker`,invertBackfaceTexture:!1,scaleX:1,textureFilter:`Picture`,tintColor:null,url:o,size:n,width:r,offsetX:f(i),offsetY:f(a),rotation:f(-t)}}:null}static createPictureFillRasterizationParam(e){let{width:t,height:n,xoffset:r,yoffset:i,url:a}=e;return a?{type:`sprite-rasterization-param`,overrides:[],resource:{type:`CIMPictureFill`,scaleX:1,textureFilter:`Picture`,tintColor:null,url:a,width:t,height:n,offsetX:f(r),offsetY:f(i),rotation:0}}:null}static fromSimpleMarker(e,t,r){let{style:i}=e,a=e.color??r;if(i===`path`||i===`esriSMSPath`){let t=[];if(`outline`in e&&e.outline){let n=e.outline;t.push({type:`CIMSolidStroke`,enable:!0,width:n.width,color:$(n.color),path:e.path})}t.push({type:`CIMSolidFill`,enable:!0,color:$(a),path:e.path});let[n,r]=ci(`square`);return{type:`CIMPointSymbol`,symbolLayers:[{type:`CIMVectorMarker`,enable:!0,rotation:-f(e.angle),size:f(e.size||6),offsetX:f(e.xoffset),offsetY:f(e.yoffset),scaleSymbolsProportionally:!1,frame:n,markerGraphics:[{type:`CIMMarkerGraphic`,geometry:r,symbol:{type:`CIMPolygonSymbol`,symbolLayers:t}}]}]}}let o=[],s,c,l=e.size;if(`outline`in e&&e.outline&&e.outline.style!==`none`&&e.outline.style!==`esriSLSNull`){let t=e.outline,r=t.style!==`solid`&&t.style!==`esriSLSSolid`;[s,c]=r?ci(i,e.size):ci(i);let a=t.width??n.width;if(r){let t=a/e.size,n=(s.xmax-s.xmin)*t/2,r=(s.ymax-s.ymin)*t/2;s.xmin-=n,s.xmax+=n,s.ymin-=r,s.ymax+=r,l&&(l+=a)}let u=e.style!==`cross`&&e.style!==`x`||e?.outline.style===`dot`||e?.outline.style===`short-dot`?`HalfGap`:`FullPattern`,d=r?[{type:`CIMGeometricEffectAddControlPoints`},{type:`CIMGeometricEffectDashes`,dashTemplate:oi(t.style,null).map(e=>t.width&&t.width>0?e*t.width:e),lineDashEnding:u,controlPointEnding:`FullPattern`}]:void 0;o.push({type:`CIMSolidStroke`,capStyle:r?`Round`:`Butt`,enable:!0,width:a,color:$(t.color),effects:d})}else !t||e.type!==`line-marker`||e.style!==`cross`&&e.style!==`x`?[s,c]=ci(i):([s,c]=ci(i),o.push({type:`CIMSolidStroke`,enable:!0,width:t,color:$(a)}));o.push({type:`CIMSolidFill`,enable:!0,color:$(a)});let u={type:`CIMPolygonSymbol`,symbolLayers:o};return{type:`CIMPointSymbol`,symbolLayers:[{type:`CIMVectorMarker`,enable:!0,rotation:f(-e.angle),size:f(l||6*t),offsetX:f(e.xoffset),offsetY:f(e.yoffset),scaleSymbolsProportionally:!1,frame:s,markerGraphics:[{type:`CIMMarkerGraphic`,geometry:c,symbol:u}]}]}}static fromCIMHatchFill(e,t){let n=t*(e.separation??M.CIMHatchFill.separation),r=n/2,i=re(e.lineSymbol);i.symbolLayers?.forEach(e=>{switch(e.type){case`CIMSolidStroke`:e.width!=null&&(e.width*=t),e.effects?.forEach(e=>{e.type===`CIMGeometricEffectDashes`&&(e.dashTemplate=e.dashTemplate?.map(e=>e*t))});break;case`CIMVectorMarker`:{e.size!=null&&(e.size*=t);let n=e.markerPlacement;n!=null&&`placementTemplate`in n&&(n.placementTemplate=n.placementTemplate.map(e=>e*t));break}}});let a=this._getLineSymbolPeriod(i)||Wr;for(;a<Wr;)a*=2;let o=a/2;return{type:`CIMVectorMarker`,frame:{xmin:-o,xmax:o,ymin:-r,ymax:r},markerGraphics:[{type:`CIMMarkerGraphic`,geometry:{paths:[[[-o,0],[o,0]]]},symbol:i}],size:n}}static fetchResources(e,t,n,r=null){if(!e||!t)return n;switch(e.type){case`CIMMeshSymbol`:case`CIMPointSymbol`:case`CIMLineSymbol`:case`CIMPolygonSymbol`:for(let t of e.effects||[])n.push(ct(t))}return Qr(e,e=>{for(let t of e.effects||[])n.push(ct(t));e.type===`CIMVectorMarker`&&e.markerPlacement&&n.push(lt(e.markerPlacement)),`url`in e&&e.url&&n.push(t.fetchResource(e.url,{signal:r}))}),n}static fetchFonts(t,n,r){if(t&&n){if(`symbolLayers`in t&&t.symbolLayers){for(let i of t.symbolLayers)if(i.type===`CIMVectorMarker`&&i.markerGraphics)for(let t of i.markerGraphics)t?.symbol&&e.fetchFonts(t.symbol,n,r)}else if(t.type===`CIMTextSymbol`){let{fontFamilyName:e,fontStyleName:i}=t;if(!e||e.toLowerCase()===`calcitewebcoreicons`)return;let{style:a,weight:o}=E(i),s=Me(t),c=new v({family:e,style:a,weight:o,decoration:s});r.push(n.loadFont(c).catch(()=>{Gr().error(`Unsupported font ${e} in CIM symbol`)}))}}}static _getLineSymbolPeriod(e){if(e){let t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers){for(let t of e.symbolLayers)if(t){let e=this._getEffectsRepeat(t.effects);if(e)return e;switch(t.type){case`CIMCharacterMarker`:case`CIMPictureMarker`:case`CIMVectorMarker`:case`CIMObjectMarker3D`:case`CIMglTFMarker3D`:{let e=this._getPlacementRepeat(t.markerPlacement);if(e)return e}}}}}return 0}static _getEffectsRepeat(e){if(e){for(let t of e)if(t)switch(t.type){case`CIMGeometricEffectDashes`:{let e=t.dashTemplate;if(e&&e.length){let t=0;for(let n of e)t+=n;return 1&e.length&&(t*=2),t}break}case`CIMGeometricEffectWave`:return t.period;default:Gr().error(`unsupported geometric effect type ${t.type}`)}}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case`CIMMarkerPlacementAlongLineSameSize`:case`CIMMarkerPlacementAlongLineRandomSize`:case`CIMMarkerPlacementAlongLineVariableSize`:{let t=e.placementTemplate;if(t&&t.length){let e=0;for(let n of t)e+=+n;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){let t=e.markerPlacement,n={...e};n.markerPlacement=null,n.anchorPoint=null;let r=Math.abs(t.stepX),i=Math.abs(t.stepY),a=(t.randomness??100)/100,o,s,c,l;if(t.gridType===`Random`){let e=j(ee),n=Math.max(Math.floor(e/r),1),u=Math.max(Math.floor(e/i),1);o=n*r/2,s=u*i/2,c=2*s;let d=new xe(t.seed),f=a*r/1.5,p=a*i/1.5;l=[];for(let e=0;e<n;e++)for(let t=0;t<u;t++){let n=e*r-o+f*(.5-d.getFloat()),a=t*i-s+p*(.5-d.getFloat());l.push({x:n,y:a}),e===0&&l.push({x:n+2*o,y:a}),t===0&&l.push({x:n,y:a+2*s})}}else !0===t.shiftOddRows?(o=r/2,s=i,c=2*i,l=[{x:-o,y:0},{x:o,y:0},{x:0,y:s},{x:0,y:-s}]):(o=r/2,s=i/2,c=i,l=[{x:-r,y:0},{x:0,y:-i},{x:-r,y:-i},{x:0,y:0},{x:r,y:0},{x:0,y:i},{x:r,y:i},{x:-r,y:i},{x:r,y:-i}]);return{type:`CIMVectorMarker`,frame:{xmin:-o,xmax:o,ymin:-s,ymax:s},markerGraphics:l.map(e=>({type:`CIMMarkerGraphic`,geometry:e,symbol:{type:`CIMPointSymbol`,symbolLayers:[n]}})),size:c}}};function Qr(e,t){if(e)switch(e.type){case`CIMPointSymbol`:case`CIMLineSymbol`:case`CIMPolygonSymbol`:{let n=e.symbolLayers;if(!n)return;for(let e of n)if(t(e),e.type===`CIMVectorMarker`){let n=e.markerGraphics;if(!n)continue;for(let e of n)if(e){let n=e.symbol;n&&Qr(n,t)}}break}}}var $r=e=>{if(!e)return`Butt`;switch(e){case`butt`:return`Butt`;case`square`:return`Square`;case`round`:return`Round`}},ei=e=>{if(!e)return`Miter`;switch(e){case`miter`:return`Miter`;case`round`:return`Round`;case`bevel`:return`Bevel`}},ti=e=>{if(e==null)return`Center`;switch(e){case`left`:return`Left`;case`right`:return`Right`;case`center`:return`Center`}},ni=e=>{if(e==null)return`Center`;switch(e){case`baseline`:return`Baseline`;case`top`:return`Top`;case`middle`:return`Center`;case`bottom`:return`Bottom`}},$=e=>{if(!e)return[0,0,0,0];let{r:t,g:n,b:r,a:i}=e;return[t,n,r,255*i]},ri=(e,t)=>{let n=ii(t),r=ai(e);return n&&r?`${n}-${r}`:`${n}${r}`},ii=e=>{if(!e)return``;switch(e.toLowerCase()){case`bold`:case`bolder`:return`bold`}return``},ai=e=>{if(!e)return``;switch(e.toLowerCase()){case`italic`:case`oblique`:return`italic`}return``},oi=(e,t)=>{let n=Se(`safari`)?.001:0,r=t===`butt`;switch(e){case`dash`:case`esriSLSDash`:return r?[4,3]:[3,4];case`dash-dot`:case`esriSLSDashDot`:return r?[4,3,1,3]:[3,4,n,4];case`dot`:case`esriSLSDot`:return r?[1,3]:[n,4];case`long-dash`:case`esriSLSLongDash`:return r?[8,3]:[7,4];case`long-dash-dot`:case`esriSLSLongDashDot`:return r?[8,3,1,3]:[7,4,n,4];case`long-dash-dot-dot`:case`esriSLSDashDotDot`:return r?[8,3,1,3,1,3]:[7,4,n,4,n,4];case`short-dash`:case`esriSLSShortDash`:return r?[4,1]:[3,2];case`short-dash-dot`:case`esriSLSShortDashDot`:return r?[4,1,1,1]:[3,2,n,2];case`short-dash-dot-dot`:case`esriSLSShortDashDotDot`:return r?[4,1,1,1,1,1]:[3,2,n,2,n,2];case`short-dot`:case`esriSLSShortDot`:return r?[1,1]:[n,2];case`solid`:case`esriSLSSolid`:case`none`:return Gr().error(`Unexpected: style does not require rasterization`),[0,0];default:return Gr().error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),[0,0]}};function si(e){return e.symbolLayers!==void 0}var ci=(e,t=100)=>{let n=t/2,r,i,a=e;if(a===`circle`||a===`esriSMSCircle`){let e=Math.acos(1-.25/n),t=Math.ceil(Rr/e/4);t===0&&(t=1),e=zr/t,t*=4;let a=[];a.push([n,0]);for(let r=1;r<t;r++)a.push([n*Math.cos(r*e),-n*Math.sin(r*e)]);a.push([n,0]),r={rings:[a]},i={xmin:-n,ymin:-n,xmax:n,ymax:n}}else if(a===`cross`||a===`esriSMSCross`)r={paths:[[[0,n],[0,-n]],[[n,0],[-n,0]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n};else if(a===`diamond`||a===`esriSMSDiamond`)r={rings:[[[-n,0],[0,n],[n,0],[0,-n],[-n,0]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n};else if(a===`square`||a===`esriSMSSquare`)r={rings:[[[-n,-n],[-n,n],[n,n],[n,-n],[-n,-n]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n};else if(a===`x`||a===`esriSMSX`)r={paths:[[[n,n],[-n,-n]],[[n,-n],[-n,n]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n};else if(a===`triangle`||a===`esriSMSTriangle`){let e=t*.5773502691896257,n=-e,a=2/3*t,o=a-t;r={rings:[[[n,o],[0,a],[e,o],[n,o]]]},i={xmin:n,ymin:o,xmax:e,ymax:a}}else a===`arrow`&&(r={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},i={xmin:-n,ymin:-n,xmax:n,ymax:n});return[i,r]},li=e=>e===`vertical`||e===`horizontal`||e===`cross`||e===`esriSFSCross`||e===`esriSFSVertical`||e===`esriSFSHorizontal`;function ui(e){if(!e)return null;let t=null,{cap:n,color:r,join:i,miterLimit:a,style:o,width:s}=e;return o!==`solid`&&o!==`none`&&o!==`esriSLSSolid`&&o!==`esriSLSNull`&&(t=[{type:`CIMGeometricEffectDashes`,dashTemplate:oi(o,n),lineDashEnding:`NoConstraint`,scaleDash:!0,offsetAlongLine:null}]),{type:`CIMSolidStroke`,color:o!==`esriSLSNull`&&o!==`none`?$(r):[0,0,0,0],capStyle:$r(n),joinStyle:ei(i),miterLimit:a,width:s,effects:t}}export{dt as C,Ye as D,Ke as E,qe as O,Rn as S,ut as T,qn as _,Zr as a,Bn as b,X as c,vr as d,yr as f,er as g,$n as h,Xr as i,Je as k,Er as l,Qn as m,oi as n,Qr as o,_r as p,Kr as r,Lr as s,Q as t,Dr as u,Jn as v,ct as w,Ln as x,Kn as y};