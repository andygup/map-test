import{BT as e,CE as t,VT as n,gT as r,hv as i,im as a,kD as o,lE as s,rE as c,tT as l}from"./index-BN8X5Ryz.js";import"./layerViewUtils-CJcMVuwG.js";import"./Container-uEjPEzbR.js";import{t as u}from"./LayerView2D-Bgb1zyoa.js";import{t as d}from"./LayerView-DQaVI2FN.js";var f=Symbol(),p=u=>{let d=u,p=class extends d{constructor(...e){super(...e),this.layerViews=new i,this._debouncedUpdate=l(async()=>{let{layer:e,parent:t}=this,n=t?.footprintLayerView,r=[],i=this._createQuery();if(i&&n){let{features:t}=await n.queryFeatures(i);this.suspended||(r=t.map(t=>e.acquireLayer(t)))}this.removeHandles(f),this.addHandles(r,f)})}get creatingLayerViews(){return this.view?.layerViewManager.isCreatingLayerViewsForLayer(this.layer)??!1}isUpdating(){return this.creatingLayerViews||this.layer.updating||this.layerViews.some(e=>e.updating)}enableLayerUpdates(){return s([this._updatingHandles.addWhen(()=>!1===this.parent?.footprintLayerView?.dataUpdating,()=>this.updateLayers()),this._updatingHandles.add(()=>[this.layer.maximumVisibleSublayers,this.layer.parent?.orderBy,this.parent?.footprintLayerView?.filter,this.parent?.footprintLayerView?.timeExtent,this.suspended],()=>this.updateLayers()),c(()=>this.removeHandles(f))])}updateLayers(){this.suspended?this.removeHandles(f):this._updatingHandles.addPromise(r(this._debouncedUpdate()).catch(e=>{t.getLogger(this).error(e)}))}_createQuery(){let e=this.parent?.footprintLayerView,t=this.layer?.parent;if(!e||!t||t.destroyed)return null;let{layer:{maximumVisibleSublayers:n},view:{scale:r}}=this;if(!n)return null;let{itemTypeField:i,itemSourceField:o,itemNameField:s,minScaleField:c,maxScaleField:l,objectIdField:u,orderBy:d}=t,f=a(`${c} IS NULL OR ${r} <= ${c} OR ${c} = 0`,`${l} IS NULL OR ${r} >= ${l}`),p=d?.find(e=>e.field&&!e.valueExpression),m=e.createQuery();if(m.returnGeometry=!1,m.num=n,m.outFields=[u,o,s],m.where=a(m.where,f),this.unsupportedItemTypes!=null){let e=`${i} NOT IN (${this.unsupportedItemTypes.map(e=>`'${e}'`)})`;m.where=a(m.where,e)}return p?.field&&(m.orderByFields=[`${p.field} ${p.order===`descending`?`DESC`:`ASC`}`],m.outFields.push(p.field)),m}};return o([e({readOnly:!0})],p.prototype,`creatingLayerViews`,null),o([e()],p.prototype,`layer`,void 0),o([e()],p.prototype,`layerViews`,void 0),o([e({readOnly:!0})],p.prototype,`unsupportedItemTypes`,void 0),o([e()],p.prototype,`parent`,void 0),o([e({readOnly:!0})],p.prototype,`isUpdating`,null),p=o([n(`esri.views.layers.CatalogDynamicGroupLayerView`)],p),p};p(d);var m=class extends p(u(d)){constructor(){super(...arguments),this.unsupportedItemTypes=[`Scene Service`],this.layerViews=new i}attach(){this.addAttachHandles([this.layerViews.on(`after-changes`,()=>this._updateStageChildren()),this.enableLayerUpdates()])}detach(){this.container.removeAllChildren()}update(e){this.updateLayers()}viewChange(){}moveEnd(){this.requestUpdate()}_updateStageChildren(){this.container.removeAllChildren(),this.layerViews.forEach((e,t)=>this.container.addChildAt(e.container,t))}};m=o([n(`esri.views.2d.layers.CatalogDynamicGroupLayerView2D`)],m);var h=m;export{h as default};