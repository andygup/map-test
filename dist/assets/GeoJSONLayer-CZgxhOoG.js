const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/editingSupport-Cn-7fWLV.js","assets/editingSupport-Dl7cyYJi.js","assets/index-CzMixifc.js","assets/index-CDgdHpAj.css","assets/AttributeBinsQuery-DcXKSwnJ.js","assets/queryUtils-fxq7u50x.js","assets/FixedIntervalBinParameters-5fcY6iRA.js","assets/AttributeBinsQuery-BqDFZU-T.js"])))=>i.map(i=>d[i]);
import{A as e,Ai as t,BS as n,BT as r,C as i,DT as a,Dh as o,Di as s,E as c,Ha as l,Hp as u,Hw as d,Ii as ee,Jf as f,Jw as p,L as m,Li as h,M as g,Mi as _,N_ as te,Ni as ne,O as re,OT as v,Oh as ie,P as ae,Pa as y,Pi as b,Pn as x,Qf as S,R as C,S as w,Sr as T,T as E,U as D,Ui as O,Vh as k,W as A,Zf as j,_ as M,_v as N,ax as P,ba as F,ca as I,gC as L,gD as R,ha as oe,j as z,ji as B,kv as V,mp as H,pD as U,rd as W,ta as G,uE as K,ua as q,ud as se,wi as ce,wx as J,xa as le,ya as ue}from"./index-CzMixifc.js";import"./QueryEngineCapabilities-COyCnRVj.js";import{i as Y}from"./clientSideDefaults-4m0UtucK.js";var de=Symbol(`isGeoJSONGraphicOrigin`),X,fe=class extends F{get[(X=de,f)](){return this.layer}get[j](){return this.layer}get[le](){return this.layer}constructor(e){super(),this[X]=!0,this.type=`geojson`,this.layer=e}get id(){return this.layer.id}},Z=class extends k{constructor(){super(...arguments),this.type=`geojson`,this.refresh=d(async e=>{await this.load();let{extent:t,timeExtent:n}=await this._connection.invoke(`refresh`,e);return this.sourceJSON.extent=t,n&&(this.sourceJSON.timeInfo.timeExtent=[n.start,n.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryFeatures`,e?e.toJSON():null,t)).then(e=>oe.fromJSON(e))}queryFeaturesJSON(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryFeatures`,e?e.toJSON():null,t))}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryFeatureCount`,e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryObjectIds`,e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke(`queryExtent`,e?e.toJSON():null,t)).then(e=>({count:e.count,extent:P.fromJSON(e.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke(`querySnapping`,e,t))}async queryAttributeBins(e,t={}){return await this.load(),this._connection.invoke(`queryAttributeBins`,e?.toJSON(),t)}_applyEdits(e){if(!this._connection)throw new r(`geojson-layer-source:edit-failure`,`Memory source not loaded`);let t=this.layer.objectIdField,n=[],i=[],a=[];if(e.addFeatures)for(let t of e.addFeatures)n.push(this._serializeFeature(t));if(e.deleteFeatures)for(let n of e.deleteFeatures)`objectId`in n&&n.objectId!=null?i.push(n.objectId):`attributes`in n&&n.attributes[t]!=null&&i.push(n.attributes[t]);if(e.updateFeatures)for(let t of e.updateFeatures)a.push(this._serializeFeature(t));return this._connection.invoke(`applyEdits`,{adds:n,updates:a,deletes:i}).then(({extent:e,timeExtent:t,featureEditResults:n})=>(this.sourceJSON.extent=e,t&&(this.sourceJSON.timeInfo.timeExtent=[t.start,t.end]),this._createEditsResult(n)))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){let t=!0===e.success?null:e.error||{code:void 0,description:``};return{objectId:e.objectId,globalId:e.globalId,error:t?new r(`geojson-layer-source:edit-failure`,t.description,{code:t.code}):null}}_serializeFeature(e){let{attributes:t}=e,n=this._geometryForSerialization(e);return n?{geometry:n.toJSON(),attributes:t}:{attributes:t}}_geometryForSerialization(e){let{geometry:t}=e;return t==null?null:t.type===`mesh`||t.type===`extent`?V.fromExtent(t.extent):t}async _startWorker(e){this._connection=await ue(`GeoJSONSourceWorker`,{strategy:U(`feature-layers-workers`)?`dedicated`:`local`,signal:e,registryTarget:this});let{fields:t,spatialReference:n,hasZ:r,geometryType:i,objectIdField:a,url:o,timeInfo:s,customParameters:c}=this.layer,l=this.layer.originOf(`spatialReference`)===`defaults`,u={url:o,customParameters:c,fields:t&&t.map(e=>e.toJSON()),geometryType:N.toJSON(i),hasZ:r,objectIdField:a,timeInfo:s?s.toJSON():null,spatialReference:l?null:n&&n.toJSON()},d=await this._connection.invoke(`load`,u,{signal:e});for(let e of d.warnings)K.getLogger(this.layer).warn(`#load()`,`${e.message} (title: '${this.layer.title||`no title`}', id: '${this.layer.id??`no id`}')`,{warning:e});d.featureErrors.length&&K.getLogger(this.layer).warn(`#load()`,`Encountered ${d.featureErrors.length} validation errors while loading features. (title: '${this.layer.title||`no title`}', id: '${this.layer.id??`no id`}')`,{errors:d.featureErrors}),this.sourceJSON=d.layerDefinition,this.capabilities=Y(this.sourceJSON.hasZ,!0)}};R([a()],Z.prototype,`capabilities`,void 0),R([a()],Z.prototype,`type`,void 0),R([a({constructOnly:!0})],Z.prototype,`layer`,void 0),R([a()],Z.prototype,`sourceJSON`,void 0),Z=R([v(`esri.layers.graphics.sources.GeoJSONSource`)],Z);var Q=i(),$=class extends ae(G(I(C(O(q(re(c(e(z(m(g(l(o))))))))))))){constructor(e){super(e),this.attributeTableTemplate=null,this.copyright=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new fe(this),this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType=`GeoJSON`,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new Z({layer:this}),this.spatialReference=J.WGS84,this.templates=null,this.title=`GeoJSON`,this.type=`geojson`}destroy(){this.source?.destroy()}load(e){let t=this.loadFromPortal({supportedTypes:[`GeoJson`],supportsData:!1},e).catch(p).then(()=>this.source.load(e)).then(()=>{this.read(this.source.sourceJSON,{origin:`service`,url:this.parsedUrl}),this.revert([`objectIdField`,`fields`,`timeInfo`],`service`),u(this.renderer,this.fieldsIndex),H(this.timeInfo,this.fieldsIndex)});return this.addResolvingPromise(t),Promise.resolve(this)}get portalItem(){return super.portalItem}set portalItem(e){super.portalItem=e}get timeInfo(){return super.timeInfo}set timeInfo(e){super.timeInfo=e}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty(`definitionExpression`),this.commitProperty(`timeExtent`),this.commitProperty(`timeOffset`),this.commitProperty(`geometryType`),this.commitProperty(`capabilities`),(this._get(`createQueryVersion`)||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&this.geometryType==null}get parsedUrl(){return L(this.url)}set renderer(e){u(e,this.fieldsIndex),this._set(`renderer`,e)}set url(e){if(!e)return void this._set(`url`,e);let t=L(e);this._set(`url`,t.path),t.query&&(this.customParameters={...this.customParameters,...t.query})}async applyEdits(e,t){let{applyEdits:r}=await n(async()=>{let{applyEdits:e}=await import(`./editingSupport-Cn-7fWLV.js`);return{applyEdits:e}},__vite__mapDeps([0,1,2,3]));await this.load();let i=await r(this,this.source,e,t);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:`service`,ignoreDefaults:!0}),i}createPopupTemplate(e){return M(this,e)}createQuery(){let e=new W,t=this.capabilities?.data;e.returnGeometry=!0,t&&t.supportsZ&&(e.returnZ=!0),e.outFields=[`*`],e.where=this.definitionExpression||`1=1`;let{timeOffset:n,timeExtent:r}=this;return e.timeExtent=n!=null&&r!=null?r.offset(-n.value,n.unit):r||null,e}getFieldDomain(e,t){return this.getField(e)?.domain}getField(e){return this.fieldsIndex.get(e)}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(W.from(e)||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}queryObjectIds(e,t){return this.load().then(()=>this.source.queryObjectIds(W.from(e)||this.createQuery(),t))}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(W.from(e)||this.createQuery(),t))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(W.from(e)||this.createQuery(),t))}async queryAttributeBins(e,t){let{source:r,capabilities:i}=await this.load();T(e,i,`GeoJSONLayer`);let a=await n(()=>import(`./AttributeBinsQuery-DcXKSwnJ.js`),__vite__mapDeps([4,5,2,3,6,7])),o=await r.queryAttributeBins(a.default.from(e),t);if(o.features)for(let e of o.features)e.layer=e.sourceLayer=this;return o}async hasDataChanged(){try{let{dataChanged:e,updates:t}=await this.source.refresh(this.customParameters);return t!=null&&this.read(t,{origin:`service`,url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};R([a({type:ie})],$.prototype,`timeExtent`,void 0),R([a({type:y})],$.prototype,`timeOffset`,void 0),R([a(ce)],$.prototype,`attributeTableTemplate`,void 0),R([a({readOnly:!0,json:{read:!1,write:!1}})],$.prototype,`capabilities`,null),R([a({type:String})],$.prototype,`copyright`,void 0),R([a({readOnly:!0})],$.prototype,`createQueryVersion`,null),R([a(te(`dateFieldsTimeReference`))],$.prototype,`dateFieldsTimeZone`,void 0),R([a({readOnly:!0})],$.prototype,`defaultPopupTemplate`,null),R([a({type:String,json:{name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],$.prototype,`definitionExpression`,void 0),R([a({type:String})],$.prototype,`displayField`,void 0),R([a({type:Boolean})],$.prototype,`editingEnabled`,void 0),R([a(B)],$.prototype,`elevationInfo`,void 0),R([a({type:[se],json:{name:`layerDefinition.fields`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`fields`}}}})],$.prototype,`fields`,void 0),R([a(Q.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),R([a({type:P,json:{name:`extent`}})],$.prototype,`fullExtent`,void 0),R([a({type:[`point`,`polygon`,`polyline`,`multipoint`],json:{read:{reader:N.read}}})],$.prototype,`geometryType`,void 0),R([a({readOnly:!0,clonable:!1})],$.prototype,`graphicOrigin`,void 0),R([a({type:Boolean})],$.prototype,`hasZ`,void 0),R([a(b)],$.prototype,`id`,void 0),R([a({type:Boolean,readOnly:!0})],$.prototype,`isTable`,null),R([a(_)],$.prototype,`labelsVisible`,void 0),R([a({type:[x],json:{name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:w},write:!0}})],$.prototype,`labelingInfo`,void 0),R([a(s)],$.prototype,`legendEnabled`,void 0),R([a({type:[`show`,`hide`]})],$.prototype,`listMode`,void 0),R([a({type:String,json:{name:`layerDefinition.objectIdField`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`objectIdField`}}}})],$.prototype,`objectIdField`,void 0),R([a(ee)],$.prototype,`opacity`,void 0),R([a({type:[`GeoJSON`]})],$.prototype,`operationalLayerType`,void 0),R([a(Q.outFields)],$.prototype,`outFields`,void 0),R([a({readOnly:!0})],$.prototype,`parsedUrl`,null),R([a(t)],$.prototype,`popupEnabled`,void 0),R([a({type:S,json:{name:`popupInfo`,write:!0}})],$.prototype,`popupTemplate`,void 0),R([a({types:D,json:{name:`layerDefinition.drawingInfo.renderer`,write:!0,origins:{service:{name:`drawingInfo.renderer`},"web-scene":{types:A}}}})],$.prototype,`renderer`,null),R([a(ne)],$.prototype,`screenSizePerspectiveEnabled`,void 0),R([a({readOnly:!0})],$.prototype,`source`,void 0),R([a({type:J})],$.prototype,`spatialReference`,void 0),R([a({type:[E]})],$.prototype,`templates`,void 0),R([a()],$.prototype,`title`,void 0),R([a({json:{read:!1},readOnly:!0})],$.prototype,`type`,void 0),R([a(h)],$.prototype,`url`,null),$=R([v(`esri.layers.GeoJSONLayer`)],$);var pe=$;export{pe as default};