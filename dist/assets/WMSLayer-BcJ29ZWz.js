import{$T as e,A as t,AE as n,AS as r,BT as i,Di as a,FE as o,HT as s,J_ as c,L as l,Li as u,Lx as d,M as f,O as p,Od as m,Pa as h,Rh as g,SC as _,UT as v,Ua as y,VT as b,WT as x,Wa as S,Wh as C,ZC as ee,ZS as w,_E as T,aw as E,cp as D,cv as O,eC as te,gE as k,hv as A,j,jC as M,kC as ne,kD as N,kg as re,lv as P,oa as ie,ov as ae,pv as F,qT as oe,q_ as se,sD as I,sT as ce,ua as le,vx as L,zC as ue,zh as de}from"./index-BN8X5Ryz.js";import{n as fe}from"./imageBitmapUtils-CLE9aRyR.js";import{t as R}from"./crsUtils-DizqbFZW.js";import{t as z}from"./ExportWMSImageParameters-CAxQbJg0.js";var B,pe=0,V=B=class extends C(S){constructor(e){super(e),this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.legendUrl=null,this.legendEnabled=!0,this.layer=null,this.maxScale=0,this.minScale=0,this.name=null,this.parent=null,this.popupEnabled=!1,this.queryable=!1,this.spatialReferences=null,this.title=null,this.addHandles([P(()=>this.sublayers,`after-add`,({item:e})=>{e.parent=this,e.layer=this.layer},O),P(()=>this.sublayers,`after-remove`,({item:e})=>{e.layer=e.parent=null},O),F(()=>this.sublayers,(e,t)=>{if(t)for(let e of t)e.layer=e.parent=null;if(e)for(let t of e)t.parent=this,t.layer=this.layer},O),F(()=>this.layer,e=>{if(this.sublayers)for(let t of this.sublayers)t.layer=e},O)])}get id(){return this._get(`id`)??pe++}set id(e){this._set(`id`,e)}readLegendUrl(e,t){return t.legendUrl??t.legendURL??null}get effectiveScaleRange(){let{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}get sublayers(){return this._get(`sublayers`)}set sublayers(e){this._set(`sublayers`,e)}castSublayers(e){return k(A.ofType(B),e)}set visible(e){this._setAndNotifyLayer(`visible`,e)}clone(){let e=new B;return this.hasOwnProperty(`description`)&&(e.description=this.description),this.hasOwnProperty(`fullExtent`)&&(e.fullExtent=this.fullExtent.clone()),this.hasOwnProperty(`fullExtents`)&&(e.fullExtents=this.fullExtents?.map(e=>e.clone())??null),this.hasOwnProperty(`legendUrl`)&&(e.legendUrl=this.legendUrl),this.hasOwnProperty(`legendEnabled`)&&(e.legendEnabled=this.legendEnabled),this.hasOwnProperty(`layer`)&&(e.layer=this.layer),this.hasOwnProperty(`name`)&&(e.name=this.name),this.hasOwnProperty(`parent`)&&(e.parent=this.parent),this.hasOwnProperty(`queryable`)&&(e.queryable=this.queryable),this.hasOwnProperty(`sublayers`)&&(e.sublayers=this.sublayers?.map(e=>e.clone())),this.hasOwnProperty(`spatialReferences`)&&(e.spatialReferences=this.spatialReferences?.map(e=>e)),this.hasOwnProperty(`visible`)&&(e.visible=this.visible),this.hasOwnProperty(`title`)&&(e.title=this.title),e}_setAndNotifyLayer(e,t){let n=this.layer;this._get(e)!==t&&(this._set(e,t),n&&n.emit(`wms-sublayer-update`,{propertyName:e,id:this.id}))}};N([i()],V.prototype,`description`,void 0),N([i({readOnly:!0})],V.prototype,`dimensions`,void 0),N([i({type:L,json:{name:`extent`}})],V.prototype,`fullExtent`,void 0),N([i()],V.prototype,`fullExtents`,void 0),N([i({type:Number,json:{write:{enabled:!1,overridePolicy:()=>({ignoreOrigin:!0,enabled:!0})}}})],V.prototype,`id`,null),N([i({type:String,json:{name:`legendUrl`,write:{ignoreOrigin:!0}}})],V.prototype,`legendUrl`,void 0),N([x(`legendUrl`,[`legendUrl`,`legendURL`])],V.prototype,`readLegendUrl`,null),N([i({type:Boolean,json:{name:`showLegend`,origins:{"web-map":{read:!1,write:!1},"web-scene":{read:!1,write:!1}}}})],V.prototype,`legendEnabled`,void 0),N([i()],V.prototype,`layer`,void 0),N([i()],V.prototype,`maxScale`,void 0),N([i()],V.prototype,`minScale`,void 0),N([i({readOnly:!0})],V.prototype,`effectiveScaleRange`,null),N([i({type:String,json:{write:{ignoreOrigin:!0}}})],V.prototype,`name`,void 0),N([i()],V.prototype,`parent`,void 0),N([i({type:Boolean,json:{read:{source:`showPopup`},write:{ignoreOrigin:!0,target:`showPopup`}}})],V.prototype,`popupEnabled`,void 0),N([i({type:Boolean,json:{write:{ignoreOrigin:!0}}})],V.prototype,`queryable`,void 0),N([i()],V.prototype,`sublayers`,null),N([s(`sublayers`)],V.prototype,`castSublayers`,null),N([i({type:[Number],json:{read:{source:`spatialReferences`}}})],V.prototype,`spatialReferences`,void 0),N([i({type:String,json:{write:{ignoreOrigin:!0}}})],V.prototype,`title`,void 0),N([i({type:Boolean,value:!0,json:{read:{source:`defaultVisibility`}}})],V.prototype,`visible`,null),V=B=N([b(`esri.layers.support.WMSSublayer`)],V);var H={84:4326,83:4269,27:4267};function me(t){if(!t)return null;let n={idCounter:-1};typeof t==`string`&&(t=new DOMParser().parseFromString(t,`text/xml`));let r=t.documentElement;if(r.nodeName===`ServiceExceptionReport`){let t=Array.prototype.slice.call(r.childNodes).map(e=>e.textContent).join(`\r
`);throw new e(`wmslayer:wms-capabilities-xml-is-not-valid`,`The server returned errors when the WMS capabilities were requested.`,t)}let i=W(`Capability`,r),a=W(`Service`,r),o=i&&W(`Request`,i);if(!i||!a||!o)return null;let s=W(`Layer`,i);if(!s)return null;let c=r.nodeName===`WMS_Capabilities`||r.nodeName===`WMT_MS_Capabilities`?r.getAttribute(`version`):`1.3.0`,l=K(`Title`,a,``)||K(`Name`,a,``),u=K(`AccessConstraints`,a,``),d=/^none$/i.test(u)?``:u,f=K(`Abstract`,a,``),p=parseInt(K(`MaxWidth`,a,`5000`),10),m=parseInt(K(`MaxHeight`,a,`5000`),10),h=be(o,`GetMap`),g=ye(o,`GetMap`),_=J(s,c,n);if(!_)return null;let v,y=0,b=Array.prototype.slice.call(i.childNodes),x=_.sublayers??[],S=e=>{e!=null&&x.push(e)};b.forEach(e=>{e.nodeName===`Layer`&&(y===0?v=e:(y===1&&_.name&&(_.name=``,S(J(v,c,n))),S(J(e,c,n))),y++)});let C=_.sublayers??[],ee=_.fullExtents??[];C.length===0&&C.push(_),_.extent??=C[0].extent;let w=_.spatialReferences.length>0?_.spatialReferences:ge(_),T=ye(o,`GetFeatureInfo`),E=T?be(o,`GetFeatureInfo`):null,D=_e(C),O=_.minScale||0,te=_.maxScale||0,k=_.dimensions??[],A=D.reduce((e,t)=>e.concat(t.dimensions??[]),[]),j=k.concat(A).filter(Te),M=null;if(j.length){let e=j.map(e=>{let{extent:t}=e;return Se(t)?t.map(e=>e.getTime()):t?.map(e=>[e.min.getTime(),e.max.getTime()])}).flat(2).filter(I),{start:t,end:n}=e.reduce((e,t)=>({start:Math.min(e.start,t),end:Math.max(e.end,t)}),{start:1/0,end:-1/0});M={startTimeField:null,endTimeField:null,trackIdField:void 0,timeExtent:[t,n]}}return{copyright:d,description:f,dimensions:k,extent:_.extent,fullExtents:ee,featureInfoFormats:E,featureInfoUrl:T,mapUrl:g,maxWidth:p,maxHeight:m,maxScale:te,minScale:O,layers:D,spatialReferences:w,supportedImageFormatTypes:h,timeInfo:M,title:l,version:c}}function he(e){let t=e.filter(e=>e.popupEnabled&&e.name&&e.queryable);return t.length?t.map(({name:e})=>e).join():null}function ge(e){if(e.spatialReferences.length>0)return e.spatialReferences;if(e.sublayers)for(let t of e.sublayers){let e=ge(t);if(e.length>0)return e}return[]}function _e(e){let t=[];for(let n of e)t.push(n),n.sublayers?.length&&(t=t.concat(_e(n.sublayers)),delete n.sublayers);return t}function U(e,t,n){return t.getAttribute(e)??n}function ve(e,t,n,r){let i=W(e,n);return i?U(t,i,r):r}function W(e,t){for(let n=0;n<t.childNodes.length;n++){let r=t.childNodes[n];if(Ce(r)&&r.nodeName===e)return r}return null}function G(e,t){if(t==null)return[];let n=[];for(let r=0;r<t.childNodes.length;r++){let i=t.childNodes[r];Ce(i)&&i.nodeName===e&&n.push(i)}return n}function K(e,t,n){return W(e,t)?.textContent??n}function q(e,t,n){let r=parseFloat(e.getAttribute(`minx`)??`0`),i=parseFloat(e.getAttribute(`miny`)??`0`),a=parseFloat(e.getAttribute(`maxx`)??`0`),o=parseFloat(e.getAttribute(`maxy`)??`0`);return{xmin:n?isNaN(i)?-Number.MAX_VALUE:i:isNaN(r)?-Number.MAX_VALUE:r,ymin:n?isNaN(r)?-Number.MAX_VALUE:r:isNaN(i)?-Number.MAX_VALUE:i,xmax:n?isNaN(o)?Number.MAX_VALUE:o:isNaN(a)?Number.MAX_VALUE:a,ymax:n?isNaN(a)?Number.MAX_VALUE:a:isNaN(o)?Number.MAX_VALUE:o,spatialReference:{wkid:t}}}function ye(e,t){let n=W(t,e);if(n){let e=W(`DCPType`,n);if(e){let t=W(`HTTP`,e);if(t){let e=W(`Get`,t);if(e){let t=ve(`OnlineResource`,`xlink:href`,e,null);if(t){let e=t.indexOf(`&`);return e!==-1&&e===t.length-1&&(t=t.slice(0,-1)),Ee(t,[`service`,`request`])}}}}}return null}function be(e,t){let n=G(`Operation`,e);if(!n.length)return G(`Format`,W(t,e)).map(({textContent:e})=>e).filter(I);let r=[];for(let e of n)if(e.getAttribute(`name`)===t){let t=G(`Format`,e);for(let{textContent:e}of t)e!=null&&r.push(e)}return r}function xe(e,t,n){let r=W(t,e);if(!r)return n;let{textContent:i}=r;if(i==null||i===``)return n;let a=Number(i);return isNaN(a)?n:a}function J(e,t,n){if(!e)return null;let r=e.getAttribute(`queryable`)?.toLowerCase(),i=r===`1`||r===`true`,a={id:n.idCounter++,fullExtents:[],parentLayerId:null,queryable:i,spatialReferences:[],sublayers:null},o=W(`LatLonBoundingBox`,e),s=W(`EX_GeographicBoundingBox`,e),c=o?q(o,4326):s?{xmin:parseFloat(K(`westBoundLongitude`,s,`0`)),ymin:parseFloat(K(`southBoundLatitude`,s,`0`)),xmax:parseFloat(K(`eastBoundLongitude`,s,`0`)),ymax:parseFloat(K(`northBoundLatitude`,s,`0`)),spatialReference:{wkid:4326}}:{xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:{wkid:4326}};a.minScale=xe(e,`MaxScaleDenominator`,0),a.maxScale=xe(e,`MinScaleDenominator`,0);let l=[`1.0.0`,`1.1.0`,`1.1.1`].includes(t)?`SRS`:`CRS`;return Array.prototype.slice.call(e.childNodes).forEach(e=>{if(e.nodeName===`Name`)a.name=e.textContent||``;else if(e.nodeName===`Title`)a.title=e.textContent||``;else if(e.nodeName===`Abstract`)a.description=e.textContent||``;else if(e.nodeName===`BoundingBox`){let n=e.getAttribute(l),r=n?.indexOf(`:`);if(r&&r>-1){let i=parseInt(n.slice(r+1),10);i===0||isNaN(i)||(i=H[i]??i);let o=t===`1.3.0`?q(e,i,R(i)):q(e,i);o&&a.fullExtents&&a.fullExtents.push(o)}}else if(e.nodeName===l)(e.textContent?.split(` `)??[]).forEach(e=>{let t=NaN;if(e.includes(`:`)){let[n,r]=e.toUpperCase().split(`:`);n!==`CRS`&&n!==`EPSG`||(t=parseInt(r,10))}else t=parseInt(e,10);if(t!==0&&!isNaN(t)){let e=H[t]??t;a.spatialReferences.includes(e)||a.spatialReferences.push(e)}});else if(e.nodeName!==`Style`||a.legendUrl){if(e.nodeName===`Layer`){let r=J(e,t,n);r&&(r.parentLayerId=a.id,a.sublayers||=[],a.sublayers.push(r))}}else{let t=W(`LegendURL`,e);if(t){let e=W(`OnlineResource`,t);e&&(a.legendUrl=e.getAttribute(`xlink:href`))}}}),a.extent=c,a.dimensions=G(`Dimension`,e).filter(e=>e.getAttribute(`name`)&&e.getAttribute(`units`)&&e.textContent).map(e=>{let t=e.getAttribute(`name`),n=e.getAttribute(`units`),r=e.textContent,i=e.getAttribute(`unitSymbol`)??void 0,a=e.getAttribute(`default`)??void 0,o=U(`default`,e,`0`)!==`0`,s=U(`nearestValue`,e,`0`)!==`0`,c=U(`current`,e,`0`)!==`0`;return Te({name:t,units:n})?{name:`time`,units:`ISO8601`,extent:ke(r),default:ke(a),multipleValues:o,nearestValue:s,current:c}:we({name:t,units:n})?{name:`elevation`,units:n,extent:De(r),unitSymbol:i,default:De(a),multipleValues:o,nearestValue:s}:{name:t,units:n,extent:Oe(r),unitSymbol:i,default:Oe(a),multipleValues:o,nearestValue:s}}),a}function Se(e){return Array.isArray(e)&&e.length>0&&e[0]instanceof Date}function Ce(e){return e.nodeType===Node.ELEMENT_NODE}function we(e){return/^elevation$/i.test(e.name)&&/^(epsg|crs):\d+$/i.test(e.units)}function Te(e){return/^time$/i.test(e.name)&&/^iso8601$/i.test(e.units)}function Ee(e,t){let n=[],r=ne(e);for(let e in r.query)r.query.hasOwnProperty(e)&&(t.includes(e.toLowerCase())||n.push(e+`=`+r.query[e]));return r.path+(n.length?`?`+n.join(`&`):``)}function De(e){if(!e)return;let t=e.includes(`/`),n=e.split(`,`);return t?n.map(e=>{let t=e.split(`/`);return t.length<2?null:{min:parseFloat(t[0]),max:parseFloat(t[1]),resolution:t.length>=3&&t[2]!==`0`?parseFloat(t[2]):void 0}}).filter(I):n.map(e=>parseFloat(e))}function Oe(e){if(!e)return;let t=e.includes(`/`),n=e.split(`,`);return t?n.map(e=>{let t=e.split(`/`);return t.length<2?null:{min:t[0],max:t[1],resolution:t.length>=3&&t[2]!==`0`?t[2]:void 0}}).filter(I):n}function ke(e){if(!e)return;let t=e.includes(`/`),n=e.split(`,`);return t?n.map(e=>{let t=e.split(`/`);return t.length<2?null:{min:Y(t[0]),max:Y(t[1]),resolution:t.length>=3&&t[2]!==`0`?Ae(t[2]):void 0}}).filter(I):n.map(e=>Y(e))}function Y(e){return se.fromISO(e,{zone:c.utcInstance}).toJSDate()}function Ae(e){let t=/(?:p(\d+y|\d+(?:\.|,)\d+y)?(\d+m|\d+(?:\.|,)\d+m)?(\d+d|\d+(?:\.|,)\d+d)?)?(?:t(\d+h|\d+(?:\.|,)\d+h)?(\d+m|\d+(?:\.|,)\d+m)?(\d+s|\d+(?:\.|,)\d+s)?)?/i,n=e.match(t);return n?{years:X(n[1]),months:X(n[2]),days:X(n[3]),hours:X(n[4]),minutes:X(n[5]),seconds:X(n[6])}:null}function X(e){if(!e)return 0;let t=/(?:\d+(?:\.|,)\d+|\d+)/,n=e.match(t);if(!n)return 0;let r=n[0].replace(`,`,`.`);return Number(r)}function Z(e){return e.toISOString().replace(/\.[0-9]{3}/,``)}var je=`0000-01-01T00:00:00Z`,Me=`9999-12-31T23:59:59Z`;function Ne(e){if(!e||e.isAllTime||e.isEmpty)return;let{start:t,end:n}=e;return t&&n&&t.getTime()===n.getTime()?`${Z(t)}`:`${t?Z(t):je}/${n?Z(n):Me}`}var Pe=new Set([102100,3857,102113,900913]),Fe=new Set([3395,54004]);function Ie(e,t){let n=e.wkid;return t==null?n:(n!=null&&t.includes(n)||!e.latestWkid||(n=e.latestWkid),n!=null&&Pe.has(n)?t.find(e=>Pe.has(e))||t.find(e=>Fe.has(e))||102100:n)}var Q=new oe({bmp:`image/bmp`,gif:`image/gif`,jpg:`image/jpeg`,png:`image/png`,svg:`image/svg+xml`},{ignoreUnknown:!1});function Le(e){return e===`text/html`}function Re(e){return e===`text/plain`}var $=class extends le(p(j(t(l(f(y(g))))))){constructor(...e){super(...e),this.allSublayers=new ae({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.customParameters=null,this.customLayerParameters=null,this.copyright=null,this.description=null,this.dimensions=null,this.fullExtent=null,this.fullExtents=null,this.featureInfoFormats=null,this.featureInfoUrl=null,this.fetchFeatureInfoFunction=null,this.imageFormat=null,this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.legendEnabled=!0,this.mapUrl=null,this.isReference=null,this.operationalLayerType=`WMS`,this.spatialReference=null,this.spatialReferences=null,this.sublayers=null,this.type=`wms`,this.version=null,this.addHandles([P(()=>this.sublayers,`after-add`,({item:e})=>{e.parent=e.layer=this},O),P(()=>this.sublayers,`after-remove`,({item:e})=>{e.layer=e.parent=null},O),F(()=>this.sublayers,(e,t)=>{if(t)for(let e of t)e.layer=e.parent=null;if(e)for(let t of e)t.parent=t.layer=this},O)])}normalizeCtorArgs(e,t){return typeof e==`string`?{url:e,...t}:e}destroy(){this.allSublayers.destroy()}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`WMS`]},e).catch(ce).then(()=>this._fetchService(t)).then(()=>this._checkLayerValidity())),Promise.resolve(this)}get timeInfo(){return super.timeInfo}set timeInfo(e){super.timeInfo=e}readFullExtentFromItemOrMap(e,t){let n=t.extent;return n?new L({xmin:n[0][0],ymin:n[0][1],xmax:n[1][0],ymax:n[1][1]}):null}writeFullExtent(e,t){t.extent=[[e.xmin,e.ymin],[e.xmax,e.ymax]]}get featureInfoFormat(){return this.featureInfoFormats==null?null:this.featureInfoFormats.find(Le)??this.featureInfoFormats.find(Re)??null}set featureInfoFormat(e){e==null?(this.revert(`featureInfoFormat`,`service`),this._clearOverride(`featureInfoFormat`)):(Le(e)||Re(e))&&this._override(`featureInfoFormat`,e)}readImageFormat(e,t){let n=t.supportedImageFormatTypes;return n&&n.includes(`image/png`)?`image/png`:n&&n[0]}readSpatialReferenceFromItemOrDocument(e,t){return new d(t.spatialReferences[0])}writeSpatialReferences(e,t){let n=this.spatialReference?.wkid;e&&n?(t.spatialReferences=e.filter(e=>e!==n),t.spatialReferences.unshift(n)):t.spatialReferences=e}readSublayersFromItemOrMap(e,t,n){return Be(t.layers,n,t.visibleLayers)}readSublayers(e,t,n){return Be(t.layers,n)}writeSublayers(e,t,n,r){t.layers=[];let i=new Map,a=e.flatten(({sublayers:e})=>e??[]);for(let e of a)if(typeof e.parent?.id==`number`){let t=i.get(e.parent.id);t==null?i.set(e.parent.id,[e.id]):t.push(e.id)}for(let e of a){let n={sublayer:e,...r},a=e.write({parentLayerId:typeof e.parent?.id==`number`?e.parent.id:-1},n);if(i.has(e.id)&&(a.sublayerIds=i.get(e.id)),!e.sublayers&&e.name){let r=e.write({},n);delete r.id,t.layers.push(r)}}t.visibleLayers=a.filter(({visible:e,sublayers:t})=>e&&!t).map(({name:e})=>e).toArray()}set url(e){if(!e)return void this._set(`url`,e);let{path:t,query:n}=ne(e);for(let e in n)/^(request|service)$/i.test(e)&&delete n[e];let r=_(t,n??{});this._set(`url`,r)}createExportImageParameters(e,t,n,r){let i=r?.pixelRatio??1,a=ie({extent:e,width:t})*i,o=new z({layer:this,scale:a}),{xmin:s,ymin:c,xmax:l,ymax:u,spatialReference:d}=e,f=Ie(d,this.spatialReferences),p=this.version===`1.3.0`&&R(f)?`${c},${s},${u},${l}`:`${s},${c},${l},${u}`,m=o.toJSON(),h=this.version===`1.3.0`?`crs`:`srs`;return{bbox:p,[h]:f==null||isNaN(f)?void 0:`EPSG:`+f,...m}}async fetchImage(e,t,n,r){let i=this.mapUrl,a=this.createExportImageParameters(e,t,n,r);if(!a.layers){let e=document.createElement(`canvas`);return e.width=t,e.height=n,e}let o=Ne(r?.timeExtent),s={responseType:`image`,query:this._mixCustomParameters({width:t,height:n,...a,time:o,...this.refreshParameters}),signal:r?.signal};return w(i??``,s).then(e=>e.data)}async fetchImageBitmap(e,t,n,r){let i=this.mapUrl??``,a=this.createExportImageParameters(e,t,n,r);if(!a.layers){let e=document.createElement(`canvas`);return e.width=t,e.height=n,e}let o=Ne(r?.timeExtent),s={responseType:`blob`,query:this._mixCustomParameters({width:t,height:n,...a,time:o,...this.refreshParameters}),signal:r?.signal},{data:c}=await w(i,s);return fe(c,i,r?.signal)}fetchFeatureInfo(e,t,n,r,i){let a=ie({extent:e,width:t}),o=new z({layer:this,scale:a}),s=he(o.visibleSublayers);if(this.featureInfoUrl==null||s==null||this.fetchFeatureInfoFunction==null&&this.featureInfoFormat==null)return Promise.resolve([]);let c=this.version===`1.3.0`?{I:r,J:i}:{x:r,y:i},l={query_layers:s,request:`GetFeatureInfo`,info_format:this.featureInfoFormat,feature_count:25,width:t,height:n,...c},u={...this.createExportImageParameters(e,t,n),...l},d=this._mixCustomParameters(u);return this.fetchFeatureInfoFunction==null?this._defaultFetchFeatureInfoFunction(_(this.featureInfoUrl,d)):this.fetchFeatureInfoFunction(d)}findSublayerById(e){return this.allSublayers.find(t=>t.id===e)}findSublayerByName(e){return this.allSublayers.find(t=>t.name===e)}serviceSupportsSpatialReference(e){return te(this.url)||this.spatialReferences!=null&&this.spatialReferences.some(t=>{let n=t===900913?d.WebMercator:new d({wkid:t});return r(n,e)})}_defaultFetchFeatureInfoFunction(e){let t=document.createElement(`iframe`);t.src=M(re.sanitizeUrl(ue(e))),t.style.border=`none`,t.style.margin=`0`,t.style.width=`100%`,t.setAttribute(`sandbox`,``);let n=new D({title:this.title,content:t}),r=new m({sourceLayer:this,popupTemplate:n});return Promise.resolve([r])}async _fetchService(e){if(!this.resourceInfo&&this.parsedUrl?.path){let{path:t,query:n}=this.parsedUrl,{data:r}=await w(t,{query:{SERVICE:`WMS`,REQUEST:`GetCapabilities`,...n,...this.customParameters},responseType:`xml`,signal:e});this.resourceInfo=me(r)}if(this.parsedUrl){let e=new ee(this.parsedUrl.path),{httpsDomains:t}=n.request;e.scheme!==`https`||e.port&&e.port!==`443`||!e.host||t.includes(e.host)||t.push(e.host)}this.read(this.resourceInfo,{origin:`service`})}_checkLayerValidity(){if(!this.allSublayers.length)throw new e(`wmslayer:empty-layer`,`The layer doesn't have any sublayer`)}_mixCustomParameters(e){if(!this.customLayerParameters&&!this.customParameters)return e;let t={...this.customParameters,...this.customLayerParameters};for(let n in t)e[n.toLowerCase()]=t[n];return e}};function ze(e,t){return e.some(e=>{for(let n in e)if(E(e,n,null,t))return!0;return!1})}function Be(e,t,n){e??=[];let r=new Map;e.every(e=>e.id==null)&&(e=o(e)).forEach((e,t)=>e.id=t);for(let i of e){let e=new V;e.read(i,t),n&&!n.includes(e.name)&&(e.visible=!1),r.set(e.id,e)}let i=[];for(let t of e){let e=t.id==null?null:r.get(t.id);if(e)if(t.parentLayerId!=null&&t.parentLayerId>=0){let n=r.get(t.parentLayerId);if(!n)continue;n.sublayers||=new A,n.sublayers.push(e)}else i.push(e)}return i}N([i({type:de})],$.prototype,`timeExtent`,void 0),N([i({type:h})],$.prototype,`timeOffset`,void 0),N([i({readOnly:!0})],$.prototype,`allSublayers`,void 0),N([i({json:{type:Object,write:!0}})],$.prototype,`customParameters`,void 0),N([i({json:{type:Object,write:!0}})],$.prototype,`customLayerParameters`,void 0),N([i({type:String,json:{write:!0}})],$.prototype,`copyright`,void 0),N([i()],$.prototype,`description`,void 0),N([i({readOnly:!0})],$.prototype,`dimensions`,void 0),N([i({json:{type:[[Number]],read:{source:`extent`},write:{target:`extent`},origins:{"web-document":{write:{ignoreOrigin:!0}},"portal-item":{write:{ignoreOrigin:!0}}}}})],$.prototype,`fullExtent`,void 0),N([x([`web-document`,`portal-item`],`fullExtent`,[`extent`])],$.prototype,`readFullExtentFromItemOrMap`,null),N([v([`web-document`,`portal-item`],`fullExtent`,{extent:{type:[[Number]]}})],$.prototype,`writeFullExtent`,null),N([i({type:[L]})],$.prototype,`fullExtents`,void 0),N([i({type:String,json:{write:{ignoreOrigin:!0}}})],$.prototype,`featureInfoFormat`,null),N([i({type:[String],readOnly:!0})],$.prototype,`featureInfoFormats`,void 0),N([i({type:String,json:{write:{ignoreOrigin:!0}}})],$.prototype,`featureInfoUrl`,void 0),N([i()],$.prototype,`fetchFeatureInfoFunction`,void 0),N([i({type:String,json:{origins:{"web-document":{default:`image/png`,type:Q.jsonValues,read:{reader:Q.read,source:`format`},write:{writer:Q.write,target:`format`}}}}})],$.prototype,`imageFormat`,void 0),N([x(`imageFormat`,[`supportedImageFormatTypes`])],$.prototype,`readImageFormat`,null),N([i({type:Number,json:{read:{source:`maxHeight`},write:{target:`maxHeight`}}})],$.prototype,`imageMaxHeight`,void 0),N([i({type:Number,json:{read:{source:`maxWidth`},write:{target:`maxWidth`}}})],$.prototype,`imageMaxWidth`,void 0),N([i()],$.prototype,`imageTransparency`,void 0),N([i(a)],$.prototype,`legendEnabled`,void 0),N([i({type:[`show`,`hide`,`hide-children`]})],$.prototype,`listMode`,void 0),N([i({type:String,json:{write:{ignoreOrigin:!0}}})],$.prototype,`mapUrl`,void 0),N([i({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],$.prototype,`isReference`,void 0),N([i({type:[`WMS`]})],$.prototype,`operationalLayerType`,void 0),N([i()],$.prototype,`resourceInfo`,void 0),N([i({type:d,json:{origins:{service:{read:{source:`extent.spatialReference`}}},write:!1}})],$.prototype,`spatialReference`,void 0),N([x([`web-document`,`portal-item`],`spatialReference`,[`spatialReferences`])],$.prototype,`readSpatialReferenceFromItemOrDocument`,null),N([i({type:[T],json:{read:!1,origins:{service:{read:!0},"web-document":{read:!1,write:{ignoreOrigin:!0}},"portal-item":{read:!1,write:{ignoreOrigin:!0}}}}})],$.prototype,`spatialReferences`,void 0),N([v([`web-document`,`portal-item`],`spatialReferences`)],$.prototype,`writeSpatialReferences`,null),N([i({type:A.ofType(V),json:{write:{target:`layers`,overridePolicy(e,t,n){if(ze(this.allSublayers,n))return{ignoreOrigin:!0}}}}})],$.prototype,`sublayers`,void 0),N([x([`web-document`,`portal-item`],`sublayers`,[`layers`,`visibleLayers`])],$.prototype,`readSublayersFromItemOrMap`,null),N([x(`service`,`sublayers`,[`layers`])],$.prototype,`readSublayers`,null),N([v(`sublayers`,{layers:{type:[V]},visibleLayers:{type:[String]}})],$.prototype,`writeSublayers`,null),N([i({json:{read:!1},readOnly:!0,value:`wms`})],$.prototype,`type`,void 0),N([i(u)],$.prototype,`url`,null),N([i({type:String,json:{write:{ignoreOrigin:!0}}})],$.prototype,`version`,void 0),$=N([b(`esri.layers.WMSLayer`)],$);var Ve=$;export{Ve as default};