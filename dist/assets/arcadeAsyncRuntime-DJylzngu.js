import{$p as e,Cx as t,Qp as n,Sn as r,Xp as i,Zp as a,tm as o,uE as s,wn as c,wx as l}from"./index-CzMixifc.js";import{n as u,t as d}from"./arcadeEnvironment-BvmpPtDd.js";import"./ImmutableArray-C3KNQCVd.js";import{E as f,H as p,O as m,R as h,S as g,W as _,Y as v,Z as y,b as ee,dt as b,ft as x,h as S,ht as te,it as C,k as w,mt as T,p as ne,pt as re,s as ie,st as E,t as D,tt as O,w as k,y as A}from"./Dictionary-CGt1qKCN.js";import"./shared-DVF4C5pR.js";import"./number-D2fZD7kK.js";import{n as j}from"./Feature-2QyVo8eG.js";import"./memoryEstimations-C3WUBUZI.js";import"./OptimizedGeometry-5fDazGe-.js";import"./OptimizedFeatureSet-D4F9ObY_.js";import"./featureConversionUtils-VvJ2pauf.js";import{a as ae,b as oe,c as se,h as ce,i as le,l as ue,o as de,r as fe,s as pe,t as me,v as he,y as ge}from"./track-BkLI1XI_.js";import{i as _e,n as M,t as N}from"./containerUtils-BiL8DqKh.js";import{n as ve}from"./aiServices-CrDUD_oX.js";import"./commonProperties-CaHgSHvW.js";import"./WhereClause-2gh-KjwG.js";import"./streamLayerUtils-82UmlW-3.js";import"./functions-CroXKA2K.js";import"./fieldStats-zmanK7EC.js";import"./ArcadePortal-CAomFS7x.js";import"./Attachment-CF32PXLj.js";import"./portalUtils-bqU8Rp5_.js";import"./operatorsWorkerConnection-D_CeJsIM.js";import{t as ye}from"./geomasync-BX8rLxhY.js";var P=()=>s.getLogger(`esri.arcade.arcadeAsyncRuntime`),F=Symbol(`uninitialized`);function I(e){if(e===F)throw new c(null,`InvalidIdentifier`,null)}function be(e){return I(e),e}function L(e,t){let n=d(t);if(e.localScope!==null){let t=e.localScope[n];if(t!==void 0)return{scope:e.localScope,id:n,var:t}}let r=e.globalScope[n];if(r!==void 0)return{scope:e.globalScope,id:n,var:r};throw new c(e,`InvalidIdentifier`,t)}function xe(e,t,n=`InvalidIdentifier`){let r=d(t);if(e.localScope!==null){let t=e.localScope[r];if(t!==void 0)return I(t),t.value}let i=e.globalScope[r];if(i!==void 0)return I(i),i.value;throw new c(e,n,t)}var R=function(){};async function z(e,t){let n=[];for(let r=0;r<t.arguments.length;r++)n.push(await W(e,t.arguments[r]));return n}async function B(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await z(e,t))}R.prototype=Object.freeze(Object.create(null));var Se=class extends re{constructor(e,t,n,r){super(),this.definition=e,this.context=t,this._params=n,this._locals=r}createFunction(e){return(...t)=>{let n={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,services:this.context.services,abortSignal:this.context.abortSignal,localScope:new R,depthCounter:{depth:e.depthCounter.depth+1},globalScope:this.context.globalScope,track:this.context.track};if(n.depthCounter.depth>64)throw new c(e,`MaximumCallDepth`,null);return V(n,this.definition.body,this._params,this._locals,t,null)}}call(e,t){return U(e,t,(n,r,i)=>{let a={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:new R,abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1},track:e.track};if(a.depthCounter.depth>64)throw new c(e,`MaximumCallDepth`,t);return V(a,this.definition.body,this._params,this._locals,i,t)})}marshalledCall(e,t,n,r){return r(e,t,async(i,a,o)=>{let s={spatialReference:e.spatialReference,services:e.services,globalScope:n.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:new R,track:e.track};return o=o.map(t=>!A(t)||t instanceof T?t:x(t,e,r)),x(await V(s,this.definition.body,this._params,this._locals,o,t),n,r)})}};async function V(e,t,n,r,i,a){if(n.length!==i.length)throw new c(e,`WrongNumberOfParameters`,a);if(e.localScope!=null){for(let t=0;t<n.length;t++)e.localScope[n[t]]={value:i[t]};for(let t of r)e.localScope[t]=F}let o=await G(e,t);if(o instanceof f)return o.value;if(o===h||o===S)throw new c(e,`UnexpectedToken`,a);return o instanceof C?o.value:o}var H=class e extends te{constructor(e){super(),this.moduleGlobalContext=e}global(e){let t=d(e),n=this.moduleGlobalContext.globalScope[t];if(I(n),A(n.value)&&!(n.value instanceof T)){let e=new T;return e.fn=n.value,e.parameterEvaluator=B,e.context=this.moduleGlobalContext,this.moduleGlobalContext.globalScope[t]={value:e},e}return n.value}setGlobal(e,t){if(A(t))throw new c(null,`AssignModuleFunction`,null);let n=d(e);if(this.moduleGlobalContext.globalScope[n]===void 0)throw new c(null,`ModuleExportNotFound`,null);this.moduleGlobalContext.globalScope[n]={value:t}}hasGlobal(e){return this.moduleGlobalContext.exports.has(d(e))}static async load(t,n){let{globals:r,exports:i}=he(n),a=new Q;for(let e of r)e in a||(a[e]=F);let o=t.spatialReference??l.WebMercator,s={lrucache:t.lrucache,interceptor:t.interceptor,services:t.services,console:t.console??tt,abortSignal:t.abortSignal??u,timeZone:t.timeZone??null,spatialReference:o,track:null,depthCounter:{depth:1},libraryResolver:new oe(t.libraryResolver._moduleSingletons,n.loadedModules),exports:i,localScope:null,globalScope:a};return await Y(s,n),new e(s)}};async function U(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await z(e,t))}async function W(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case`UpdateExpression`:return await je(e,t);case`AssignmentExpression`:return await Me(e,t);case`TemplateLiteral`:return await qe(e,t);case`Identifier`:return Z(e,t);case`MemberExpression`:return await Ve(e,t);case`Literal`:return t.value;case`CallExpression`:return await Ke(e,t);case`UnaryExpression`:return await He(e,t);case`BinaryExpression`:return await We(e,t);case`LogicalExpression`:return await Ge(e,t);case`ArrayExpression`:return await Ue(e,t);case`ObjectExpression`:return await Ce(e,t);default:throw new c(e,`Unrecognized`,t)}}catch(n){throw r(e,t,n)}}async function G(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case`ImportDeclaration`:return await Le(e,t);case`ExportNamedDeclaration`:return await Re(e,t);case`VariableDeclaration`:return await ze(e,t);case`BlockStatement`:return await Y(e,t);case`FunctionDeclaration`:return await Ie(e,t);case`ReturnStatement`:return await Fe(e,t);case`IfStatement`:return await Pe(e,t);case`ExpressionStatement`:return await Ne(e,t);case`ForStatement`:return await Te(e,t);case`WhileStatement`:return await we(e,t);case`ForInStatement`:return await ke(e,t);case`ForOfStatement`:return await Ae(e,t);case`BreakStatement`:return h;case`EmptyStatement`:return g;case`ContinueStatement`:return S;default:throw new c(e,`Unrecognized`,t)}}catch(n){throw r(e,t,n)}}async function Ce(e,t){let n=[];for(let r=0;r<t.properties.length;r++){let i=t.properties[r],a=await W(e,i.value);n[r]={key:i.key.type===`Identifier`?i.key.name:await W(e,i.key),value:a}}let r=Object.create(null),a=new Map;for(let o=0;o<n.length;o++){let s=n[o];if(A(s.value))throw new c(e,`NoFunctionInDictionary`,t);if(!1===i(s.key))throw new c(e,`KeyMustBeString`,t);let l=s.key.toString(),u=l.toLowerCase();a.has(u)?l=a.get(u):a.set(u,l),s.value===g?r[l]=null:r[l]=s.value}let o=new D(r);return o.immutable=!1,o}async function we(e,t){let n=await W(e,t.test);if(!1===n)return g;if(!0!==n)throw new c(e,`BooleanConditionRequired`,t);for(;!0===n;){let r=await G(e,t.body);if(r===h)break;if(r instanceof f)return r;if(n=await W(e,t.test),!0!==n&&!1!==n)throw new c(e,`BooleanConditionRequired`,t)}return g}async function Te(e,t){try{for(t.init!==null&&(t.init.type===`VariableDeclaration`?await G(e,t.init):await W(e,t.init));;){if(t.test!==null){let n=await W(e,t.test);if(!0===e.abortSignal?.aborted)throw new c(e,`Cancelled`,t);if(!1===n)break;if(!0!==n)throw new c(e,`BooleanConditionRequired`,t)}let n=await G(e,t.body);if(n===h)break;if(n instanceof f)return n;t.update!==null&&await W(e,t.update)}return g}catch(e){throw e}}async function K(e,t,n,r,i=`i`){let a=n.length;for(let o=0;o<a;o++){if(i===`k`){if(o>=n.length)throw new c(e,`OutOfBounds`,t);r.scope[r.id]={value:n[o]}}else r.scope[r.id]={value:o};let a=await G(e,t.body);if(a===h)break;if(a instanceof f)return a}return g}async function q(e,t,n,r,i=`i`){let a=n.length();for(let o=0;o<a;o++){r.scope[r.id]=i===`k`?{value:n.get(o)}:{value:o};let a=await G(e,t.body);if(a===h)break;if(a instanceof f)return a}return g}async function Ee(e,t,n,r){e:for await(let i of await n.queryAll(e.abortSignal))for(let a of i){r.scope[r.id]={value:j.createFromGraphicLikeObject(a.geometry,a.attributes,n,e.timeZone)};let i=await G(e,t.body);if(i===h)break e;if(i instanceof f)return i}return g}async function De(e,t,n,r){for(let i of n.keys()){let a=n.field(i);r.scope[r.id]={value:D.containerEntry(i,a)};let o=await G(e,t.body);if(o===h)break;if(o instanceof f)return o}return g}async function Oe(e,t,n,r){for(let i of M(n)){let a=N(n,i,e,t,1);r.scope[r.id]={value:D.containerEntry(i,a)};let o=await G(e,t.body);if(o===h)break;if(o instanceof f)return o}return g}async function ke(t,n){let r=await W(t,n.right);n.left.type===`VariableDeclaration`&&await G(t,n.left);let a=L(t,n.left.type===`VariableDeclaration`?n.left.declarations[0].id:n.left);return e(r)||i(r)?await K(t,n,r,a):O(r)?await q(t,n,r,a):r instanceof D||k(r)?await K(t,n,r.keys(),a,`k`):ie(r)?await Ee(t,n,r,a):w(r)?await K(t,n,M(r),a,`k`):g}async function Ae(t,n){let r=await W(t,n.right);n.left.type===`VariableDeclaration`&&await G(t,n.left);let a=L(t,n.left.type===`VariableDeclaration`?n.left.declarations[0].id:n.left);return e(r)||i(r)?await K(t,n,r,a,`k`):O(r)?await q(t,n,r,a,`k`):r instanceof D||k(r)?await De(t,n,r,a):ie(r)?await Ee(t,n,r,a):w(r)?await Oe(t,n,r,a):g}async function je(t,r){let a=r.argument;if(a.type===`CallExpression`)throw new c(t,`NeverReach`,r);if(a.type===`MemberExpression`){let o=await W(t,a.object),s,l;if(!0===a.computed)s=await W(t,a.property);else{if(a.property.type!==`Identifier`)throw new c(t,`Unrecognized`,r);s=a.property.name}if(e(o)){if(!n(s))throw new c(t,`ArrayAccessMustBeNumber`,r);if(s<0&&(s=o.length+s),s<0||s>=o.length)throw new c(t,`OutOfBounds`,r);l=m(o[s]),o[s]=r.operator===`++`?l+1:l-1}else if(o instanceof D){if(!1===i(s))throw new c(t,`KeyAccessorMustBeString`,r);if(!0!==o.hasField(s))throw new c(t,`FieldNotFound`,r,{key:s});l=m(o.field(s)),o.setField(s,r.operator===`++`?l+1:l-1)}else if(o instanceof H){if(!1===i(s))throw new c(t,`ModuleAccessorMustBeString`,r);if(!0!==o.hasGlobal(s))throw new c(t,`ModuleExportNotFound`,r);l=m(o.global(s)),o.setGlobal(s,r.operator===`++`?l+1:l-1)}else{if(!ne(o))throw O(o)?new c(t,`Immutable`,r):new c(t,`InvalidParameter`,r);if(!1===i(s))throw new c(t,`KeyAccessorMustBeString`,r);if(!0!==o.hasField(s))throw new c(t,`FieldNotFound`,r,{key:s});l=m(o.field(s)),o.setField(s,r.operator===`++`?l+1:l-1)}return!1===r.prefix?l:r.operator===`++`?l+1:l-1}let o=L(t,a),s=m(be(o.var).value),l=r.operator===`++`?s+1:s-1;return o.scope[o.id]={value:l},!1===r.prefix?s:r.operator===`++`?s+1:s-1}function J(e,t,n,r,a){switch(t){case`=`:return e===g?null:e;case`/=`:return m(n)/m(e);case`*=`:return m(n)*m(e);case`-=`:return m(n)-m(e);case`+=`:return i(n)||i(e)?_(n)+_(e):m(n)+m(e);case`%=`:return m(n)%m(e);default:throw new c(a,`UnsupportedOperator`,r)}}async function Me(t,r){let a=r.left;if(a.type===`MemberExpression`){let o=await W(t,a.object),s;if(!0===a.computed)s=await W(t,a.property);else{if(a.property.type!==`Identifier`)throw new c(t,`InvalidIdentifier`,r);s=a.property.name}let l=await W(t,r.right);if(e(o)){if(!n(s))throw new c(t,`ArrayAccessMustBeNumber`,r);if(s<0&&(s=o.length+s),s<0||s>o.length)throw new c(t,`OutOfBounds`,r);if(s===o.length){if(r.operator!==`=`)throw new c(t,`OutOfBounds`,r);o[s]=J(l,r.operator,o[s],r,t)}else o[s]=J(l,r.operator,o[s],r,t)}else if(o instanceof D){if(!1===i(s))throw new c(t,`KeyAccessorMustBeString`,r);if(!0===o.hasField(s))o.setField(s,J(l,r.operator,o.field(s),r,t));else{if(r.operator!==`=`)throw new c(t,`FieldNotFound`,r,{key:s});o.setField(s,J(l,r.operator,null,r,t))}}else if(o instanceof H){if(!1===i(s))throw new c(t,`KeyAccessorMustBeString`,r);if(!0!==o.hasGlobal(s))throw new c(t,`ModuleExportNotFound`,r);o.setGlobal(s,J(l,r.operator,o.global(s),r,t))}else{if(!ne(o))throw O(o)?new c(t,`Immutable`,r):new c(t,`InvalidParameter`,r);if(!1===i(s))throw new c(t,`KeyAccessorMustBeString`,r);if(!0===o.hasField(s))o.setField(s,J(l,r.operator,o.field(s),r,t));else{if(r.operator!==`=`)throw new c(t,`FieldNotFound`,r,{key:s});o.setField(s,J(l,r.operator,null,r,t))}}return g}let o=L(t,a),s=await W(t,r.right);return o.scope[o.id]={value:J(s,r.operator,r.operator===`=`?null:be(o.var).value,r,t)},g}async function Ne(e,t){let n=await W(e,t.expression);return n===g?g:new C(n)}async function Pe(e,t){let n=await W(e,t.test);if(!0===n)return G(e,t.consequent);if(!1===n)return t.alternate===null?g:G(e,t.alternate);throw new c(e,`BooleanConditionRequired`,t)}async function Y(e,t){return X(e,t,0)}async function X(e,t,n){if(n>=t.body.length)return g;let r=await G(e,t.body[n]);return r instanceof f||r===h||r===S||n===t.body.length-1?r:X(e,t,n+1)}async function Fe(e,t){if(t.argument===null)return new f(g);let n=await W(e,t.argument);return new f(n)}async function Ie(e,t){if(e.localScope!=null)throw P().error(`Function declarations are only valid in global scope.`),new c(e,`NeverReach`,t);let n=d(t.id);if(!(n in e.globalScope))throw P().error(`Function "${n}" not declared.`),new c(e,`NeverReach`,t);let r=ge(t),i=t.params.map(e=>d(e)),a=Array.from(r).filter(e=>!i.includes(e));return e.globalScope[n]={value:new Se(t,e,i,a)},g}async function Le(e,t){let n=L(e,t.specifiers[0].local),r=e.libraryResolver;if(r==null)throw P().error(`Internal error: module loader not initialized`),new c(e,`NeverReach`,t);let i=r.loadLibrary(n.id),a;return r._moduleSingletons?.has(i.uri)?a=r._moduleSingletons.get(i.uri):(a=await H.load(e,i.syntax),r._moduleSingletons?.set(i.uri,a)),n.scope[n.id]={value:a},g}async function Re(e,t){return await G(e,t.declaration),g}async function ze(e,t){for(let n of t.declarations)await Be(e,n);return g}async function Be(e,t){let n=null;n=t.init===null?null:await W(e,t.init),n===g&&(n=null);let r=L(e,t.id);r.scope[r.id]={value:n}}async function Ve(r,a){let o=await W(r,a.object);if(o===null)throw new c(r,`MemberOfNull`,a);if(!1===a.computed){if(a.property.type===`Identifier`){if(o instanceof D||k(o))return o.field(a.property.name);if(o instanceof t)return N(o,a.property.name,r,a);if(o instanceof H){if(!o.hasGlobal(a.property.name))throw new c(r,`InvalidIdentifier`,a);return o.global(a.property.name)}throw new c(r,`InvalidMemberAccessKey`,a)}throw new c(r,`InvalidMemberAccessKey`,a)}let s=await W(r,a.property);if(o instanceof D||k(o)){if(i(s))return o.field(s);throw new c(r,`InvalidMemberAccessKey`,a)}if(o instanceof H){if(i(s))return o.global(s);throw new c(r,`InvalidMemberAccessKey`,a)}if(o instanceof t){if(i(s))return N(o,s,r,a);throw new c(r,`InvalidMemberAccessKey`,a)}if(e(o)){if(n(s)&&isFinite(s)&&Math.floor(s)===s){if(s<0&&(s=o.length+s),s>=o.length||s<0)throw new c(r,`OutOfBounds`,a);return o[s]}throw new c(r,`InvalidMemberAccessKey`,a)}if(O(o)){if(n(s)&&isFinite(s)&&Math.floor(s)===s){if(s<0&&(s=o.length()+s),s>=o.length()||s<0)throw new c(r,`OutOfBounds`,a);return o.get(s)}throw new c(r,`InvalidMemberAccessKey`,a)}if(i(o)){if(n(s)&&isFinite(s)&&Math.floor(s)===s){if(s<0&&(s=o.length+s),s>=o.length||s<0)throw new c(r,`OutOfBounds`,a);return o[s]}throw new c(r,`InvalidMemberAccessKey`,a)}throw new c(r,`InvalidMemberAccessKey`,a)}async function He(e,t){let n=await W(e,t.argument);if(o(n)){if(t.operator===`!`)return!n;if(t.operator===`-`)return-1*m(n);if(t.operator===`+`)return 1*m(n);if(t.operator===`~`)return~m(n);throw new c(e,`UnsupportUnaryOperator`,t)}if(t.operator===`-`)return-1*m(n);if(t.operator===`+`)return 1*m(n);if(t.operator===`~`)return~m(n);throw new c(e,`UnsupportUnaryOperator`,t)}async function Ue(e,t){let n=[];for(let r=0;r<t.elements.length;r++)n.push(await W(e,t.elements[r]));for(let r=0;r<n.length;r++){if(A(n[r]))throw new c(e,`NoFunctionInArray`,t);n[r]===g&&(n[r]=null)}return n}async function We(e,t){let n=await W(e,t.left),r=await W(e,t.right);switch(t.operator){case`|`:case`<<`:case`>>`:case`>>>`:case`^`:case`&`:return ee(m(n),m(r),t.operator);case`==`:return E(n,r);case`!=`:return!E(n,r);case`<`:case`>`:case`<=`:case`>=`:return p(n,r,t.operator);case`+`:return i(n)||i(r)?_(n)+_(r):m(n)+m(r);case`-`:return m(n)-m(r);case`*`:return m(n)*m(r);case`/`:return m(n)/m(r);case`%`:return m(n)%m(r);default:throw new c(e,`UnsupportedOperator`,t)}}async function Ge(e,t){let n=await W(e,t.left);if(!o(n))throw new c(e,`LogicalExpressionOnlyBoolean`,t);switch(t.operator){case`||`:{if(!0===n)return n;let r=await W(e,t.right);if(o(r))return r;throw new c(e,`LogicExpressionOrAnd`,t)}case`&&`:{if(!1===n)return n;let r=await W(e,t.right);if(o(r))return r;throw new c(e,`LogicExpressionOrAnd`,t)}default:throw new c(e,`LogicExpressionOrAnd`,t)}}function Z(e,t){return xe(e,t)}async function Ke(e,t){if(t.callee.type===`MemberExpression`){let n=await W(e,t.callee.object);if(!(n instanceof H))throw new c(e,`FunctionNotFound`,t);let r=!1===t.callee.computed?t.callee.property.name:await W(e,t.callee.property);if(!n.hasGlobal(r))throw new c(e,`FunctionNotFound`,t);let i=n.global(r);if(!A(i))throw new c(e,`CallNonFunction`,t);return i.call(e,t)}if(t.callee.type!==`Identifier`)throw new c(e,`FunctionNotFound`,t);let n=xe(e,t.callee,`FunctionNotFound`);if(A(n))return n.call(e,t);throw new c(e,`CallNonFunction`,t)}async function qe(e,t){let n=``,r=0;for(let i of t.quasis)if(n+=i.value?i.value.cooked:``,!1===i.tail){if(t.expressions[r]){let i=await W(e,t.expressions[r]);if(A(i))throw new c(e,`NoFunctionInTemplateLiteral`,t);n+=_(i)}r++}return n}async function Je(e,t){v(t.arguments===null?[]:t.arguments,3,3,e,t);let n=await W(e,t.arguments[0]);if(!1===o(n))throw new c(e,`BooleanConditionRequired`,t);return W(e,n?t.arguments[1]:t.arguments[2])}async function Ye(e,t){v(t.arguments===null?[]:t.arguments,2,3,e,t);let n=await W(e,t.arguments[0]);if(t.arguments.length===3){let r=await W(e,t.arguments[1]),i=_e(n,r);return i!=null&&i!==``?i:W(e,t.arguments[2])}return n==null||n===``?W(e,t.arguments[1]):n}async function Xe(e,t){if(t.arguments.length<2)throw new c(e,`WrongNumberOfParameters`,t);if(t.arguments.length===2)return W(e,t.arguments[1]);if((t.arguments.length-1)%2==0)throw new c(e,`WrongNumberOfParameters`,t);return Ze(e,t,1,await W(e,t.arguments[0]))}async function Ze(e,t,n,r){let i=await W(e,t.arguments[n]);if(E(i,r))return W(e,t.arguments[n+1]);let a=t.arguments.length-n;return a===1?W(e,t.arguments[n]):a===2?null:a===3?W(e,t.arguments[n+2]):Ze(e,t,n+2,r)}async function Qe(e,t){if(t.arguments.length<3||t.arguments.length%2==0)throw new c(e,`WrongNumberOfParameters`,t);let n=await W(e,t.arguments[0]);if(!1===o(n))throw new c(e,`BooleanConditionRequired`,t.arguments[0]);return $e(e,t,0,n)}async function $e(e,t,n,r){if(!0===r)return W(e,t.arguments[n+1]);if(t.arguments.length-n===3)return W(e,t.arguments[n+2]);let i=await W(e,t.arguments[n+2]);if(!1===o(i))throw new c(e,`ModuleExportNotFound`,t.arguments[n+2]);return $e(e,t,n+2,i)}function et(){let e=Object.create(null);se(e,B),fe(e,B),pe(e,B,Z),ae(e,B),de(e,B),le(e,B),me(e,B),ye({functions:e,compiled:!1,signatures:null,evaluateIdentifier:null,mode:`async`,standardFunction:B,standardFunctionAsync:U}),e.iif=Je,e.defaultvalue=Ye,e.decode=Xe,e.when=Qe;let t=function(){this.textformatting={value:D.textFormatting()}};t.prototype=Object.create(null),t.prototype.infinity=Object.freeze({value:1/0}),t.prototype.pi=Object.freeze({value:Math.PI});for(let[n,r]of Object.entries(e))t.prototype[n]=Object.freeze({value:new b(r)});return t}var Q=et();function $(e){let t={mode:`async`,compiled:!1,functions:Object.create(null),signatures:[],standardFunction:B,standardFunctionAsync:U,evaluateIdentifier:Z};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(let[e,n]of Object.entries(t.functions))Q.prototype[e]=Object.freeze({value:new b(n)});for(let e=0;e<t.signatures.length;e++)ce(t.signatures[e],`async`)}function tt(e){console.log(e)}function nt(e,t){let n=new Set(Object.keys(t?.vars||{}).map(e=>d(e))),r=new Set(Object.keys(t?.customfunctions||{}).map(e=>d(e))),{globals:i,exports:o}=he(e);return async t=>{let s=t.spatialReference??l.WebMercator,d=null;e.usesModules&&(d=new oe(new Map,e.loadedModules));let p=new Q;for(let e of r)t.customfunctions!=null&&e in t.customfunctions?p[e]={value:new b(t.customfunctions[e])}:p[e]=F;for(let e of n){if(t.vars==null||!(e in t.vars)){e in p||(p[e]=F);continue}let n=t.vars[e]??null;a(n)?p[e]={value:j.createFromGraphic(n,t.timeZone??null)}:p[e]={value:n}}for(let e of i)e in p||(p[e]=F);let m={lrucache:t.lrucache,interceptor:t.interceptor,services:t.services,console:t.console??tt,abortSignal:t.abortSignal??u,timeZone:t.timeZone??null,spatialReference:s,track:t.track,depthCounter:{depth:1},libraryResolver:d,exports:o,localScope:null,globalScope:p},g=await Y(m,e);if(g instanceof f||g instanceof C){let e=g.value;if(y(e))return null;if(A(e))throw new c(m,`IllegalResult`,null);return e}if(y(g))return null;throw g===h||g===S?new c(m,`IllegalResult`,null):new c(m,`NeverReach`,null)}}function rt(e,t){return nt(e,t)(t)}$([ue]),$([ve]);export{rt as executeScript,$ as extend,nt as prepareScript};