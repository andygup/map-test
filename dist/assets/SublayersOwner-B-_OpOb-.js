const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FeatureLayer-CD-B1rfh.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,Ai as n,Ar as r,BT as i,Bn as a,CE as o,CT as s,ED as c,En as l,F as u,FC as d,FE as f,HT as p,I as m,Ia as h,Ka as g,Lx as _,Ov as v,Pi as y,Pn as ee,Qh as te,Qp as ne,Ri as re,ST as b,Tu as ie,U as ae,UT as x,Ua as oe,VT as S,W as se,WT as C,Wh as ce,ZS as w,_ as le,_E as T,ba as E,bd as ue,cp as de,cv as D,er as fe,gE as pe,hE as me,hv as O,iC as k,im as he,jd as ge,kD as A,mE as j,ov as _e,pT as M,pd as ve,pv as N,rr as P,tE as F,vE as ye,vd as I,vx as L,w as be,wr as xe,x as Se,xC as Ce,xa as R,yd as z}from"./index-BN8X5Ryz.js";import{t as we}from"./QueryTask-6dVRoJFW.js";import{n as Te}from"./sublayerUtils-Dk4DSA02.js";var Ee=e=>{let t=e,r=class extends t{constructor(){super(...arguments),this.capabilities=void 0,this.copyright=null,this.fullExtent=null,this.legendEnabled=!0,this.spatialReference=null,this.version=void 0,this._allLayersAndTablesMap=null}readCapabilities(e,t){let n=t.capabilities&&t.capabilities.split(`,`).map(e=>e.toLowerCase().trim());if(!n)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};let r=this.type,i=r!==`tile`&&!!t.supportsDynamicLayers,a=n.includes(`query`),o=n.includes(`map`),s=!!t.exportTilesAllowed,c=n.includes(`tilemap`),l=n.includes(`data`),u=r!==`tile`&&(!t.tileInfo||i),d=r!==`tile`&&(!t.tileInfo||i),f=r!==`tile`,p=r!==`tile`&&i&&t.currentVersion>=11.1,m=t.cimVersion?g.parse(t.cimVersion):null,h=m?.greaterEqual(1,4)??!1,_=m?.greaterEqual(2,0)??!1;return{operations:{supportsExportMap:o,supportsExportTiles:s,supportsIdentify:a,supportsQuery:l,supportsTileMap:c},exportMap:o?{supportsArcadeExpressionForLabeling:h,supportsCIMSymbols:_,supportsDynamicLayers:i,supportsSublayerOrderBy:p,supportsSublayerDefinitionExpression:d,supportsSublayerVisibility:u,supportsSublayersChanges:f}:null,exportTiles:s?{maxExportTilesCount:+t.maxExportTilesCount}:null}}readVersion(e,t){let n=t.currentVersion;return n||=t.hasOwnProperty(`capabilities`)||t.hasOwnProperty(`tables`)?10:t.hasOwnProperty(`supportedImageFormatTypes`)?9.31:9.3,n}async fetchRelatedService(e){let t=this.portalItem;if(!t||!h(t))return null;this._relatedFeatureServicePromise||=t.fetchRelatedItems({relationshipType:`Service2Service`,direction:`reverse`},e).then(e=>e.find(e=>e.type===`Feature Service`)??null,()=>null);let n=await this._relatedFeatureServicePromise;return M(e),n?{itemId:n.id,url:n.url}:null}async fetchSublayerInfo(e,t){let{source:n}=e;if(this?.portalItem&&this.type===`tile`&&n?.type===`map-layer`&&h(this.portalItem)&&e.originIdOf(`url`)<2){let r=await this.fetchRelatedService(t);r&&(e.url=d(r.url,n.mapLayerId.toString()),e.layerItemId=r.itemId)}let{url:r}=e,i;if(n.type===`data-layer`)i=(await w(r,{responseType:`json`,query:{f:`json`,...this.customParameters,token:this.apiKey},...t})).data;else{let a=e.id;n?.type===`map-layer`&&(a=n.mapLayerId);try{i=(await this.fetchAllLayersAndTables(t)).get(a)}catch{}if(r&&e.originIdOf(`url`)>2)try{let e=await this._fetchAllLayersAndTablesFromService(r),t=k(r)?.sublayer??n.mapLayerId,a=structuredClone(e.get(t));if(a!=null){for(let e of[`drawingInfo`,`maxScale`,`minScale`,`name`])delete a[e];i={...i,...a}}}catch{}}return i}async fetchAllLayersAndTables(e){return this._fetchAllLayersAndTablesFromService(this.parsedUrl?.path,e)}async _fetchAllLayersAndTablesFromService(e,t){await this.load(t),this._allLayersAndTablesMap||=new Map;let n=k(e),r=ye(this._allLayersAndTablesMap,n?.url.path,()=>w(d(n?.url.path,`/layers`),{responseType:`json`,query:{f:`json`,...this.customParameters,token:this.apiKey}}).then(e=>{let t=new Map,{layers:n,tables:r}=e.data,i=[...n??[],...r??[]];for(let e of i)t.set(e.id,e);return{result:t}},e=>({error:e}))),i=await r;if(M(t),`result`in i)return i.result;throw i.error}};return A([i({readOnly:!0})],r.prototype,`capabilities`,void 0),A([C(`service`,`capabilities`,[`capabilities`,`cimVersion`,`currentVersion`,`exportTilesAllowed`,`maxExportTilesCount`,`supportsDynamicLayers`,`tileInfo`])],r.prototype,`readCapabilities`,null),A([i({json:{read:{source:`copyrightText`}}})],r.prototype,`copyright`,void 0),A([i({type:L})],r.prototype,`fullExtent`,void 0),A([i(y)],r.prototype,`id`,void 0),A([i({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:`showLegend`},write:{target:`showLegend`}}})],r.prototype,`legendEnabled`,void 0),A([i(n)],r.prototype,`popupEnabled`,void 0),A([i({type:_})],r.prototype,`spatialReference`,void 0),A([i({readOnly:!0})],r.prototype,`version`,void 0),A([C(`service`,`version`,[`currentVersion`,`capabilities`,`tables`,`supportedImageFormatTypes`])],r.prototype,`readVersion`,null),r=A([S(`esri.layers.mixins.ArcGISMapService`)],r),r},De=Symbol(`isMapImageGraphicOriginSymbol`),B,Oe=class extends E{get[(B=De,R)](){return this.layer}constructor(e,t){super(),this[B]=!0,this.type=`map-image`,this.layer=e,this.sublayer=t}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},ke=Symbol(`isTileGraphicOriginSymbol`),V,Ae=class extends E{get[(V=ke,R)](){return this.layer}constructor(e,t){super(),this[V]=!0,this.type=`tile`,this.layer=e,this.sublayer=t}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},H;function U(e){return e?.type===`esriSMS`}function W(e,t,n){let r=n.minimumWritableOrigin||n.origin;return!!r&&e.originIdOf(t)>=b(r)}function G(e,t,n){let r=W(this,t,n);return{ignoreOrigin:!0,allowNull:r,enabled:!!n&&n.layer?.type===`map-image`&&(n.writeSublayerStructure||r)}}function K(e,t,n){return{enabled:!!n&&n.layer?.type===`tile`&&(W(this,t,n)||this._isOverridden(t))}}function q(e,t,n){return{ignoreOrigin:!0,enabled:n&&n.writeSublayerStructure||!1}}function J(e,t,n){return{ignoreOrigin:!0,enabled:!!n?.writeSublayerStructure&&this.originIdOf(t)>2}}function Y(e,t,n){return{ignoreOrigin:!0,enabled:!!n&&(n.writeSublayerStructure||W(this,t,n))}}var X=0,je=new Set([`layer`,`parent`,`loaded`,`loadStatus`,`loadError`,`loadWarnings`]),Z=class extends oe(ce(te)){static{H=this}constructor(e){super(e),this.attributeTableTemplate=null,this.capabilities=void 0,this.maxScaleRange={minScale:0,maxScale:0},this.fields=null,this.fullExtent=null,this.geometryType=null,this.globalIdField=null,this.isTable=!1,this.legendEnabled=!0,this.objectIdField=null,this.parent=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.spatialReference=null,this.title=null,this.typeIdField=null,this.type=`sublayer`,this.types=null,this._lastParsedUrl=null}async load(e){return this.addResolvingPromise(this.reload(e)),this}readCapabilities(e,t){t=t.layerDefinition||t;let{attachment:n,operations:{supportsQuery:r,supportsQueryAttachments:i},query:{supportsFormatPBF:o,supportsOrderBy:s,supportsPagination:c},data:{supportsAttachment:l},queryRelated:u}=a(t,this.url);return{attachment:{supportsOrderByFields:n?.supportsOrderByFields??!1,supportsResize:n?.supportsResize??!1,supportsTypeWildcard:n?.supportsTypeWildcard??!1},exportMap:{supportsModification:!!t.canModifyLayer},operations:{supportsQuery:r,supportsQueryAttachments:i},data:{supportsAttachment:l},query:{supportsFormatPBF:o,supportsOrderBy:s,supportsPagination:c},queryRelated:u}}get defaultPopupTemplate(){return this.createPopupTemplate()}set definitionExpression(e){this._setAndNotifyLayer(`definitionExpression`,e)}get effectiveScaleRange(){let{minScale:e,maxScale:t}=this;return{minScale:e,maxScale:t}}readMaxScaleRange(e,t){return{minScale:(t=t.layerDefinition||t).minScale??0,maxScale:t.maxScale??0}}get fieldsIndex(){return new l(this.fields||[])}set floorInfo(e){this._setAndNotifyLayer(`floorInfo`,e)}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(let e of t.fields)if(e.type===`esriFieldTypeGlobalID`)return e.name}}get graphicOrigin(){if(!this.layer)return null;switch(this.layer.type){case`tile`:return new Ae(this.layer,this);case`map-image`:return new Oe(this.layer,this)}}get id(){return this._get(`id`)??X++}set id(e){this._get(`id`)!==e&&(!1===this.layer?.capabilities?.exportMap?.supportsDynamicLayers?this._logLockedError(`id`,`capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'`):this._set(`id`,e))}readIsTable(e,t){return t.type===`Table`}set labelingInfo(e){this._setAndNotifyLayer(`labelingInfo`,e)}writeLabelingInfo(e,t,n,r){e&&e.length&&(t.layerDefinition={drawingInfo:{labelingInfo:e.map(e=>e.write({},r))}})}set labelsVisible(e){this._setAndNotifyLayer(`labelsVisible`,e)}set layer(e){this._set(`layer`,e),this.sublayers?.forEach(t=>t.layer=e)}set listMode(e){this._set(`listMode`,e)}set minScale(e){this._setAndNotifyLayer(`minScale`,e)}readMinScale(e,t){return t.minScale||t.layerDefinition?.minScale||0}set maxScale(e){this._setAndNotifyLayer(`maxScale`,e)}readMaxScale(e,t){return t.maxScale||t.layerDefinition?.maxScale||0}readObjectIdFieldFromService(e,t){return(t=t.layerDefinition||t).objectIdField?t.objectIdField:t.fields?.find(e=>e.type===`esriFieldTypeOID`)?.name}set opacity(e){this._setAndNotifyLayer(`opacity`,e)}readOpacity(e,t){let{layerDefinition:n}=t;return 1-.01*(n?.transparency??n?.drawingInfo?.transparency??0)}writeOpacity(e,t,n,r){t.layerDefinition={drawingInfo:{transparency:100-100*e}}}set orderBy(e){this._setAndNotifyLayer(`orderBy`,e)}writeParent(e,t){this.parent&&this.parent!==this.layer?t.parentLayerId=me(this.parent.id):t.parentLayerId=-1}get queryTask(){if(!this.layer)return null;let{capabilities:e,fieldsIndex:t,layer:n,url:r}=this,{spatialReference:i}=n,a=`gdbVersion`in n?n.gdbVersion:void 0,o=c(`featurelayer-pbf`)&&e?.query.supportsFormatPBF;return new we({fieldsIndex:t,gdbVersion:a,pbfSupported:o,queryAttachmentsSupported:e?.operations?.supportsQueryAttachments??!1,sourceSpatialReference:i,url:r})}set renderer(e){if(ne(e,this.fieldsIndex),e){for(let t of e.symbols)if(ge(t)){o.getLogger(this).warn(`Sublayer renderer should use 2D symbols`);break}}this._setAndNotifyLayer(`renderer`,e)}get source(){return this._get(`source`)||new z({mapLayerId:this.id})}set source(e){this._setAndNotifyLayer(`source`,e)}get sublayers(){return this._get(`sublayers`)}set sublayers(e){this._handleSublayersChange(e,this._get(`sublayers`)),this._set(`sublayers`,e)}castSublayers(e){return pe(O.ofType(H),e)}writeSublayers(e,t,n){this.sublayers?.length&&(t[n]=this.sublayers.map(e=>e.id).toArray().reverse())}readTitle(e,t){return t.layerDefinition?.name??t.name}readTypeIdField(e,t){let n=(t=t.layerDefinition||t).typeIdField;if(n&&t.fields){n=n.toLowerCase();let e=t.fields.find(e=>e.name.toLowerCase()===n);e&&(n=e.name)}return n}get url(){let e=this.layer?.parsedUrl??this._lastParsedUrl,t=this.source;if(!e)return null;if(this._lastParsedUrl=e,t?.type===`map-layer`)return`${e.path}/${t.mapLayerId}`;let n={layer:JSON.stringify({source:this.source})};return`${e.path}/dynamicLayer?${Ce(n)}`}set url(e){this._overrideIfSome(`url`,e)}set visible(e){this._setAndNotifyLayer(`visible`,e)}writeVisible(e,t,n,r){t[n]=this.getAtOrigin(`defaultVisibility`,`service`)||e}clone(){let{store:e}=F(this),t=new H;return F(t).store=e.clone(je),this.commitProperty(`url`),t._lastParsedUrl=this._lastParsedUrl,t}createPopupTemplate(e){return le(this,e)}createQuery(){return new ve({returnGeometry:!0,where:this.definitionExpression||`1=1`})}async createFeatureLayer(){if(this.sublayers)return null;let n=(await e(async()=>{let{default:e}=await import(`./FeatureLayer-CD-B1rfh.js`);return{default:e}},__vite__mapDeps([0,1,2]))).default,{layer:r,url:i}=this,a;if(i&&this.originIdOf(`url`)>2)a=new n({url:i});else{if(!r?.parsedUrl)throw new t(`createFeatureLayer:missing-information`,`Cannot create a FeatureLayer without a url or a parent layer`);{let e=r.parsedUrl;a=new n({url:e.path}),e&&this.source&&(this.source.type===`map-layer`?a.layerId=this.source.mapLayerId:a.dynamicDataSource=this.source)}}return r?.refreshInterval!=null&&(a.refreshInterval=r.refreshInterval),this.definitionExpression&&(a.definitionExpression=this.definitionExpression),this.floorInfo&&(a.floorInfo=f(this.floorInfo)),this.originIdOf(`labelingInfo`)>2&&(a.labelingInfo=f(this.labelingInfo)),this.originIdOf(`labelsVisible`)>0&&(a.labelsVisible=this.labelsVisible),this.originIdOf(`legendEnabled`)>0&&(a.legendEnabled=this.legendEnabled),this.originIdOf(`visible`)>0&&(a.visible=this.visible),this.originIdOf(`minScale`)>0&&(a.minScale=this.minScale),this.originIdOf(`maxScale`)>0&&(a.maxScale=this.maxScale),this.originIdOf(`opacity`)>0&&(a.opacity=this.opacity),this.originIdOf(`popupTemplate`)>0&&(a.popupTemplate=f(this.popupTemplate)),this.originIdOf(`renderer`)>2&&(a.renderer=f(this.renderer)),this.source?.type===`data-layer`&&(a.dynamicDataSource=this.source.clone()),this.originIdOf(`title`)>0&&(a.title=this.title),r?.type===`map-image`&&r.originIdOf(`customParameters`)>0&&(a.customParameters=r.customParameters),r?.type===`tile`&&r.originIdOf(`customParameters`)>0&&(a.customParameters=r.customParameters),a}getField(e){return this.fieldsIndex.get(e)}getFeatureType(e){return xe(this.types,this.typeIdField,e)}getFieldDomain(e,t){let n=t?.feature,r=this.getFeatureType(n);if(r){let t=r.domains&&r.domains[e];if(t&&t.type!==`inherited`)return t}return this._getLayerDomain(e)}async queryAttachments(e,n){await this.load();let i=r.from(e),a=this.capabilities;if(!a?.data?.supportsAttachment)throw new t(`queryAttachments:not-supported`,`this layer doesn't support attachments`);let{attachmentTypes:o,objectIds:s,globalIds:c,num:l,size:u,start:d,where:f}=i;if(!a?.operations?.supportsQueryAttachments&&(o?.length>0||c?.length>0||u?.length>0||l||d||f))throw new t(`queryAttachments:option-not-supported`,`when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported`,i);if(!(s?.length||c?.length||f))throw new t(`queryAttachments:invalid-query`,`'objectIds', 'globalIds', or 'where' are required to perform attachment query`,i);return!a?.attachment?.supportsOrderByFields&&i.orderByFields?.length&&(i=i.clone(),i.orderByFields=null),this.queryTask.executeAttachmentQuery(i,n)}async queryFeatureCount(e=this.createQuery(),n){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new t(`queryFeatureCount:not-supported`,`this layer doesn't support queries.`);if(!this.url)throw new t(`queryFeatureCount:not-supported`,`this layer has no url.`);let r=this.layer?.apiKey;return await this.queryTask.executeForCount(e,{...n,query:{...this.layer?.customParameters,token:r}})}async queryFeatures(e=this.createQuery(),n){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new t(`queryFeatures:not-supported`,`this layer doesn't support queries.`);if(!this.url)throw new t(`queryFeatures:not-supported`,`this layer has no url.`);let r=await this.queryTask.execute(e,{...n,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(r?.features){let e=this.graphicOrigin;for(let t of r.features)t.sourceLayer=this,t.origin=e}return r}async queryObjectIds(e=this.createQuery(),n){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new t(`queryObjectIds:not-supported`,`this layer doesn't support queries.`);if(!this.url)throw new t(`queryObjectIds:not-supported`,`this layer has no url.`);let r=this.layer?.apiKey;return await this.queryTask.executeForIds(e,{...n,query:{...this.layer?.customParameters,token:r}})}async queryRelatedFeatures(e,n){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new t(`queryRelatedFeatures:not-supported`,`this layer doesn't support queries.`);if(!this.url)throw new t(`queryRelatedFeatures:not-supported`,`this layer has no url.`);let r=this.layer?.apiKey;return await this.queryTask.executeRelationshipQuery(e,{...n,query:{...this.layer?.customParameters,token:r}})}async queryRelatedFeaturesCount(e,n){if(await this.load(),!this.capabilities.operations.supportsQuery)throw new t(`queryRelatedFeaturesCount:not-supported`,`this layer doesn't support queries.`);if(!this.capabilities.queryRelated.supportsCount)throw new t(`queryRelatedFeaturesCount:not-supported`,`this layer doesn't support query related counts.`);if(!this.url)throw new t(`queryRelatedFeaturesCount:not-supported`,`this layer has no url.`);let r=this.layer?.apiKey;return await this.queryTask.executeRelationshipQueryForCount(e,{...n,query:{...this.layer?.customParameters,token:r}})}async reload(e){if(this.loadStatus===`not-loaded`)return this.load(e).then(()=>{});let{layer:n,url:r}=this;if(!n&&!r)throw new t(`sublayer:missing-layer`,`Sublayer can't be loaded without being part of a layer`,{sublayer:this});let i=n?await n.fetchSublayerInfo(this,e):(await w(r,{query:{f:`json`},...e})).data;i&&(this.sourceJSON={...this.sourceJSON,...i},this.read({layerDefinition:i},{origin:`service`,layer:n,url:ie(r)}))}toExportImageJSON(e){let t={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,type:`mapLayer`}},n=he(e,this.definitionExpression);n!=null&&(t.definitionExpression=n);let r=[`renderer`,`labelingInfo`,`opacity`,`labelsVisible`].reduce((e,t)=>(e[t]=this.originIdOf(t),e),{});if(Object.keys(r).some(e=>r[e]>2)){let e=t.drawingInfo={};if(r.renderer>2&&(e.renderer=this.renderer?this.renderer.toJSON():null),r.labelsVisible>2&&(e.showLabels=this.labelsVisible),this.labelsVisible&&r.labelingInfo>2)if(this.labelingInfo){!this.loaded&&this.labelingInfo?.some(e=>!e.labelPlacement)&&o.getLogger(this).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.`,{sublayer:this});let t=this.labelingInfo;this.geometryType!=null&&(t=Se(this.labelingInfo,v.toJSON(this.geometryType))),e.showLabels=!0,e.labelingInfo=t.filter(e=>e.labelPlacement).map(e=>e.toJSON({origin:`service`,layer:this.layer}))}else e.showLabels=!1;r.opacity>2&&(e.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(e.renderer)}return(this.layer?.capabilities?.exportMap?.supportsSublayerOrderBy??!1)&&this.originIdOf(`orderBy`)>2&&(t.orderBy=this.orderBy?.map(e=>e.toJSON())??null),t}_assignDefaultSymbolColors(e){this._forEachSimpleMarkerSymbols(e,e=>{e.color||e.style!==`esriSMSX`&&e.style!==`esriSMSCross`||(e.outline?.color?e.color=e.outline.color:e.color=[0,0,0,0])})}_forEachSimpleMarkerSymbols(e,t){if(e){let n=(`uniqueValueInfos`in e?e.uniqueValueInfos:`classBreakInfos`in e?e.classBreakInfos:null)??[];for(let e of n)U(e.symbol)&&t(e.symbol);`symbol`in e&&U(e.symbol)&&t(e.symbol),`defaultSymbol`in e&&U(e.defaultSymbol)&&t(e.defaultSymbol)}}_setAndNotifyLayer(e,t){let n=this.layer,r=this._get(e),i,a;switch(e){case`definitionExpression`:case`floorInfo`:i=`supportsSublayerDefinitionExpression`;break;case`minScale`:case`maxScale`:case`visible`:i=`supportsSublayerVisibility`;break;case`labelingInfo`:case`labelsVisible`:case`opacity`:case`renderer`:case`source`:i=`supportsDynamicLayers`,a=`supportsModification`;break;case`orderBy`:i=`supportsSublayerOrderBy`,a=`supportsModification`}let o=F(this).getDefaultOrigin();if(o!==`service`){if(i&&!1===this.layer?.capabilities?.exportMap?.[i])return void this._logLockedError(e,`capability not available 'layer.capabilities.exportMap.${i}'`);if(a&&!1===this.capabilities?.exportMap[a])return void this._logLockedError(e,`capability not available 'capabilities.exportMap.${a}'`)}e!==`source`||this.loadStatus===`not-loaded`?(this._set(e,t),o!==`service`&&r!==t&&n?.emit&&n.emit(`sublayer-update`,{propertyName:e,target:this})):this._logLockedError(e,`'source' can't be changed after calling sublayer.load()`)}_handleSublayersChange(e,n){n&&(n.forEach(e=>{e.parent=null,e.layer=null}),this.removeAllHandles()),e&&(e.forEach(e=>{e.parent=this,e.layer=this.layer}),this.addHandles([e.on(`after-add`,({item:e})=>{e.parent=this,e.layer=this.layer}),e.on(`after-remove`,({item:e})=>{e.parent=null,e.layer=null}),e.on(`before-changes`,e=>{(this.layer?.capabilities?.exportMap?.supportsSublayersChanges??1)||(o.getLogger(this).error(new t(`sublayer:sublayers-non-modifiable`,`Sublayer can't be added, moved, or removed from the layer's sublayers`,{sublayer:this,layer:this.layer})),e.preventDefault())})]))}_logLockedError(e,n){let{layer:r,declaredClass:i}=this;o.getLogger(i).error(new t(`sublayer:locked`,`Property '${String(e)}' can't be changed on Sublayer from the layer '${r?.id}'`,{reason:n,sublayer:this,layer:r}))}_getLayerDomain(e){return this.fieldsIndex.get(e)?.domain??null}static{this.test={isMapImageLayerOverridePolicy:e=>e===J||e===q||e===G,isTileImageLayerOverridePolicy:e=>e===K}}};A([i({type:re,json:{name:`attributeTableInfo`,write:{overridePolicy:G},origins:{"web-scene":{write:!1}}}})],Z.prototype,`attributeTableTemplate`,void 0),A([i({readOnly:!0})],Z.prototype,`capabilities`,void 0),A([C(`service`,`capabilities`,[`layerDefinition.canModifyLayer`,`layerDefinition.capabilities`])],Z.prototype,`readCapabilities`,null),A([i()],Z.prototype,`defaultPopupTemplate`,null),A([i({type:String,value:null,json:{name:`layerDefinition.definitionExpression`,write:{allowNull:!0,overridePolicy:G}}})],Z.prototype,`definitionExpression`,null),A([i({readOnly:!0})],Z.prototype,`effectiveScaleRange`,null),A([C(`service`,`maxScaleRange`,[`minScale`,`maxScale`])],Z.prototype,`readMaxScaleRange`,null),A([i({type:[ue],json:{origins:{service:{read:{source:`layerDefinition.fields`}}}}})],Z.prototype,`fields`,void 0),A([i({readOnly:!0})],Z.prototype,`fieldsIndex`,null),A([i({type:P,value:null,json:{name:`layerDefinition.floorInfo`,read:{source:`layerDefinition.floorInfo`},write:{target:`layerDefinition.floorInfo`,overridePolicy:G},origins:{"web-scene":{read:!1,write:!1}}}})],Z.prototype,`floorInfo`,null),A([i({type:L,json:{read:{source:`layerDefinition.extent`}}})],Z.prototype,`fullExtent`,void 0),A([i({type:v.apiValues,json:{origins:{service:{name:`layerDefinition.geometryType`,read:{reader:v.read}}}}})],Z.prototype,`geometryType`,void 0),A([i({type:String})],Z.prototype,`globalIdField`,void 0),A([C(`service`,`globalIdField`,[`layerDefinition.globalIdField`,`layerDefinition.fields`])],Z.prototype,`readGlobalIdFieldFromService`,null),A([i({readOnly:!0})],Z.prototype,`graphicOrigin`,null),A([i({type:T,json:{write:{ignoreOrigin:!0}}})],Z.prototype,`id`,null),A([i({readOnly:!0})],Z.prototype,`isTable`,void 0),A([C(`service`,`isTable`,[`type`])],Z.prototype,`readIsTable`,null),A([i({value:null,type:[ee],json:{read:{source:`layerDefinition.drawingInfo.labelingInfo`},write:{target:`layerDefinition.drawingInfo.labelingInfo`,overridePolicy:J}}})],Z.prototype,`labelingInfo`,null),A([x(`labelingInfo`)],Z.prototype,`writeLabelingInfo`,null),A([i({type:Boolean,value:!0,json:{read:{source:`layerDefinition.drawingInfo.showLabels`},write:{target:`layerDefinition.drawingInfo.showLabels`,overridePolicy:q}}})],Z.prototype,`labelsVisible`,null),A([i({value:null})],Z.prototype,`layer`,null),A([i({type:String,json:{write:{overridePolicy:K}}})],Z.prototype,`layerItemId`,void 0),A([i({type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:`showLegend`},write:{target:`showLegend`,overridePolicy:Y}}})],Z.prototype,`legendEnabled`,void 0),A([i({type:[`show`,`hide`,`hide-children`],value:`show`,json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Z.prototype,`listMode`,null),A([i({type:Number,value:0,json:{write:{overridePolicy:q}}})],Z.prototype,`minScale`,null),A([C(`minScale`,[`minScale`,`layerDefinition.minScale`])],Z.prototype,`readMinScale`,null),A([i({type:Number,value:0,json:{write:{overridePolicy:q}}})],Z.prototype,`maxScale`,null),A([C(`maxScale`,[`maxScale`,`layerDefinition.maxScale`])],Z.prototype,`readMaxScale`,null),A([i()],Z.prototype,`objectIdField`,void 0),A([C(`service`,`objectIdField`,[`layerDefinition.objectIdField`,`layerDefinition.fields`])],Z.prototype,`readObjectIdFieldFromService`,null),A([i({type:Number,value:1,json:{write:{target:`layerDefinition.drawingInfo.transparency`,overridePolicy:q}}})],Z.prototype,`opacity`,null),A([C(`opacity`,[`layerDefinition.drawingInfo.transparency`,`layerDefinition.transparency`])],Z.prototype,`readOpacity`,null),A([x(`opacity`)],Z.prototype,`writeOpacity`,null),A([i({value:null,type:[m],json:{name:`layerDefinition.orderBy`,read:{reader:u},write:{overridePolicy:G},origins:{"web-scene":{read:!1,write:!1}}}})],Z.prototype,`orderBy`,null),A([i({json:{type:T,write:{target:`parentLayerId`,writerEnsuresNonNull:!0,overridePolicy:q}}})],Z.prototype,`parent`,void 0),A([x(`parent`)],Z.prototype,`writeParent`,null),A([i({type:Boolean,value:!0,json:{read:{source:`disablePopup`,reader:(e,t)=>!t.disablePopup},write:{target:`disablePopup`,overridePolicy:Y,writer(e,t,n){t[n]=!e}}}})],Z.prototype,`popupEnabled`,void 0),A([i({type:de,json:{read:{source:`popupInfo`},write:{target:`popupInfo`,overridePolicy:Y}}})],Z.prototype,`popupTemplate`,void 0),A([i({readOnly:!0})],Z.prototype,`queryTask`,null),A([i({type:[fe],readOnly:!0,json:{origins:{service:{read:{source:`layerDefinition.relationships`}}}}})],Z.prototype,`relationships`,void 0),A([i({types:ae,value:null,json:{name:`layerDefinition.drawingInfo.renderer`,write:{overridePolicy:J},origins:{"web-scene":{types:se,name:`layerDefinition.drawingInfo.renderer`,write:{overridePolicy:J}}}}})],Z.prototype,`renderer`,null),A([i({types:{key:`type`,base:null,typeMap:{"data-layer":I,"map-layer":z}},cast(e){if(e){if(`mapLayerId`in e)return j(z,e);if(`dataSource`in e)return j(I,e)}return e},json:{name:`layerDefinition.source`,write:{overridePolicy:q}}})],Z.prototype,`source`,null),A([i()],Z.prototype,`sourceJSON`,void 0),A([i({type:_,json:{origins:{service:{read:{source:`layerDefinition.extent.spatialReference`}}}}})],Z.prototype,`spatialReference`,void 0),A([i({value:null,json:{type:[T],write:{target:`subLayerIds`,allowNull:!0,overridePolicy:q}}})],Z.prototype,`sublayers`,null),A([p(`sublayers`)],Z.prototype,`castSublayers`,null),A([x(`sublayers`)],Z.prototype,`writeSublayers`,null),A([i({type:String,json:{name:`name`,write:{overridePolicy:Y}}})],Z.prototype,`title`,void 0),A([C(`service`,`title`,[`name`,`layerDefinition.name`])],Z.prototype,`readTitle`,null),A([i({type:String})],Z.prototype,`typeIdField`,void 0),A([i({json:{read:!1},readOnly:!0,value:`sublayer`})],Z.prototype,`type`,void 0),A([C(`typeIdField`,[`layerDefinition.typeIdField`])],Z.prototype,`readTypeIdField`,null),A([i({type:[be],json:{origins:{service:{read:{source:`layerDefinition.types`}}}}})],Z.prototype,`types`,void 0),A([i({type:String,json:{name:`layerUrl`,write:{overridePolicy:K}}})],Z.prototype,`url`,null),A([i({type:Boolean,value:!0,json:{read:{source:`defaultVisibility`},write:{target:`defaultVisibility`,overridePolicy:q}}})],Z.prototype,`visible`,null),A([x(`visible`)],Z.prototype,`writeVisible`,null),Z=H=A([S(`esri.layers.support.Sublayer`)],Z);function Me(e,t){let n=[],r={};return e&&e.forEach(e=>{let i=new Z;if(i.read(e,t),r[i.id]=i,e.parentLayerId!=null&&e.parentLayerId!==-1){let t=r[e.parentLayerId];t.sublayers||=[],t.sublayers.unshift(i)}else n.unshift(i)}),n}var Q=O.ofType(Z);function $(e,t){e&&e.forEach(e=>{t(e),e.sublayers&&e.sublayers.length&&$(e.sublayers,t)})}var Ne=e=>{let n=e,r=class extends n{constructor(...e){super(...e),this.allSublayers=new _e({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.sublayers}),this.sublayersSourceJSON={2:{},3:{},4:{},5:{},6:{}},this.subtables=null,this.addHandles([N(()=>this.sublayers,(e,t)=>this._handleSublayersChange(e,t),D),N(()=>this.subtables,(e,t)=>this._handleSublayersChange(e,t),D)])}destroy(){this.allSublayers.destroy()}readSublayers(e,t){if(!t||!e)return;let{sublayersSourceJSON:n}=this,r=b(t.origin);if(r<2||(n[r]={context:t,visibleLayers:e.visibleLayers||n[r].visibleLayers,layers:e.layers||n[r].layers},r>2))return;this._set(`serviceSublayers`,this.createSublayersForOrigin(`service`).sublayers);let{sublayers:i,origin:a}=this.createSublayersForOrigin(`web-document`),o=F(this);o.setDefaultOrigin(a),this._set(`sublayers`,new Q(i)),o.setDefaultOrigin(`user`)}findSublayerById(e){return this.allSublayers.find(t=>t.id===e)}createServiceSublayers(){return this.createSublayersForOrigin(`service`).sublayers}createSublayersForOrigin(e){let t,n=b(e===`web-document`?`web-map`:e),r=2,i=this.sublayersSourceJSON[2].layers,a=this.sublayersSourceJSON[2].context,o=null,c=[3,4,5].filter(e=>e<=n);for(let e of c){let t=this.sublayersSourceJSON[e];Te(t.layers)&&(r=e,i=t.layers,a=t.context,t.visibleLayers&&(o={visibleLayers:t.visibleLayers,context:t.context}))}let l=[3,4,5].filter(e=>e>r&&e<=n),u=null;for(let e of l){let{layers:n,visibleLayers:r,context:i}=this.sublayersSourceJSON[e];n&&(u={layers:n,context:i},t??=e),r&&(o={visibleLayers:r,context:i})}let d=Me(i,a),f=new Map,p=new Set;if(u)for(let e of u.layers)f.set(e.id,e);if(o?.visibleLayers)for(let e of o.visibleLayers)p.add(e);return $(d,e=>{u&&e.read(f.get(e.id),u.context),o&&e.read({defaultVisibility:p.has(e.id)},o.context)}),{origin:s(r),originWithPartialOverrides:t?s(t):null,sublayers:new Q({items:d})}}read(e,t){super.read(e,t),this.readSublayers(e,t)}_handleSublayersChange(e,n){n&&(n.forEach(e=>{e.parent=null,e.layer=null}),this.removeHandles(`sublayers-owner`)),e&&(e.forEach(e=>{e.parent=this,e.layer=this}),this.addHandles([e.on(`after-add`,({item:e})=>{e.parent=this,e.layer=this}),e.on(`after-remove`,({item:e})=>{e.parent=null,e.layer=null})],`sublayers-owner`),this.type===`tile`&&this.addHandles(e.on(`before-changes`,e=>{o.getLogger(`esri.layers.TileLayer`).error(new t(`tilelayer:sublayers-non-modifiable`,`Sublayer can't be added, moved, or removed from the layer's sublayers`,{layer:this})),e.preventDefault()}),`sublayers-owner`))}};return A([i({readOnly:!0})],r.prototype,`allSublayers`,void 0),A([i({readOnly:!0,type:O.ofType(Z)})],r.prototype,`serviceSublayers`,void 0),A([i({value:null,type:Q,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],r.prototype,`sublayers`,void 0),A([i({readOnly:!0})],r.prototype,`sublayersSourceJSON`,void 0),A([i({type:Q,json:{read:{source:`tables`}}})],r.prototype,`subtables`,void 0),r=A([S(`esri.layers.mixins.SublayersOwner`)],r),r};export{Z as n,Ee as r,Ne as t};