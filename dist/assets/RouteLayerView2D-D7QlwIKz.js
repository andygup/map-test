const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RouteLayerInteraction-D8Hm2_fp.js","assets/index-ByaFsVj4.js","assets/index-DiFef-Um.css","assets/earcut-CsNwSYFA.js","assets/geodeticAreaOperator-Cpa3JaoL.js","assets/geodeticCurveType-B3tSXlNQ.js","assets/geodeticLengthOperator-BwyycYVe.js","assets/ObjectStack-C2IlraSC.js","assets/vectorStacks-DhZu7qGn.js","assets/quatf64-eO7UAs9K.js","assets/vec3-DP8KhY5h.js","assets/sphere-BCy4W-Wa.js","assets/plane-Dmhe_zL4.js","assets/ray-CUcS4KDu.js","assets/elevationInfoUtils-CyQsBf6_.js","assets/quantity-b_p_m453.js","assets/geodesicUtils-Dvm-3luO.js","assets/projectPointToVector-DjmX75N6.js","assets/projectVectorToVector-BnpPb96u.js","assets/dehydratedPoint-CVzHYxaL.js","assets/spatialReferenceEllipsoidUtils-nVny0a-O.js","assets/lineSegment-DXWFDhyj.js","assets/triangle-CX6dMEmo.js","assets/GraphicsLayer-DwoVChbR.js","assets/Stop-B37Caoi5.js","assets/networkEnums-DHenpW2q.js","assets/SketchViewModel-C7m1KDxp.js","assets/isSupportedObject-B58JKqS1.js","assets/layerUtils-Cj6yZbRW.js","assets/SketchOptions-QYfkQRrC.js","assets/LineSnappingHint-3ZzJwo5I.js","assets/ParallelSnappingHint-68YI0lzr.js","assets/DrapedEdgeSnappingCandidate-DzwVTBGe.js","assets/constraints-CFQ1UrIW.js","assets/EdgeSnappingCandidate-C48eD-43.js","assets/SnappingCandidate-CgOYxD9J.js","assets/IntersectionSnappingCandidate-DSIWvb7L.js","assets/IntersectionSnappingHint-DV5I0-bt.js","assets/LineSnappingCandidate-COvu3vdD.js","assets/RightAngleTriangleSnappingCandidate-CghH-bTz.js","assets/RightAngleSnappingHint-CU6G_WVm.js","assets/viewUtils-2ptPti_Q.js","assets/viewUtils-DLrdDgo8.js","assets/snappingUtils-C_5v3bem.js","assets/euclideanLengthMeasurementUtils-DIbCzEM_.js","assets/hitTestSelectUtils-B7XlogWA.js"])))=>i.map(i=>d[i]);
import{BS as e,DT as t,JE as n,OT as r,WT as i,Y_ as a,ev as o,gD as s,iv as c,nv as l,rv as u}from"./index-ByaFsVj4.js";import"./memoryEstimations-C5pKF3kD.js";import"./OptimizedGeometry-DX91by73.js";import"./OptimizedFeatureSet-DAaREXtE.js";import"./featureConversionUtils-C045qQF5.js";import"./streamLayerUtils-82UmlW-3.js";import"./QueueProcessor-B2D2Jh6F.js";import"./earcut-CsNwSYFA.js";import"./layerViewUtils--V83RFAv.js";import"./colorUtils-BunzVBdd.js";import"./networkEnums-DHenpW2q.js";import"./timeSupport-BE8MSrm_.js";import"./queryUtils-DJQEBA7c.js";import"./quantizationUtils-CzrQVcZ1.js";import"./normalizeUtilsSync-BT8jCZxT.js";import{i as d,r as f,t as p}from"./RouteInfo-8u82VFYO.js";import{i as m,n as h,r as g,t as _}from"./Stop-B37Caoi5.js";import"./GeometryUtils-BAHLKUGl.js";import"./VertexAttributeLocations-BMy2FGBT.js";import"./VertexElementDescriptor-C9CNG143.js";import"./labelPoint-DoaytHlZ.js";import"./callExpressionWithCursor-Bq5gauaR.js";import"./FeatureMetadata-L_8PG9_P.js";import"./CIMSymbolHelper-CZHBBcY6.js";import"./rasterizingUtils-LzhctegF.js";import"./Rect-BMNJQxpm.js";import"./BoundingBox-ClylkApr.js";import"./BidiEngine-CpIovbIK.js";import"./callExpressionWithFeature-DYNi0_LX.js";import"./OverrideHelper-xKJ6WRO1.js";import"./FeatureCommandQueue-BbpRY2Wt.js";import"./config-BY05DP3l.js";import"./dehydratedFeatureComparison-S5E2zKzh.js";import"./WGLContainer-CiXk9por.js";import"./utils-Dm-H4TMy.js";import"./ProgramTemplate-DWR5_pn_.js";import"./VertexArrayObject-IhETPpMJ.js";import"./BufferObject-DWz5bVRd.js";import"./VertexBuffer-BwGrH3vw.js";import"./vec3f32-BWuLbfSR.js";import"./Container-S9H9uxgl.js";import"./GraphShaderModule-VKGmZBI7.js";import"./FramebufferObject-D2tOc-fp.js";import"./ShaderBuilder-NkkCCxyc.js";import{t as v}from"./LayerView2D-CV9r4nac.js";import{t as y}from"./LayerView-yVmpY809.js";import"./UpdateTracking2D-VGFir_CJ.js";import"./TechniqueInstance-xWE1qGx4.js";import"./TileContainer-Jj89hEGy.js";import"./constants-TfCITEY_.js";import"./utils-CXmRmFbM.js";import{t as b}from"./highlightOptionsUtils-CtpxD6Lo.js";import"./AGraphicContainer-CjdmKveK.js";import{t as x}from"./GraphicContainer-Brizha6m.js";import"./ComputedAttributeStorage-BSjVwTFB.js";import{t as S}from"./GraphicsView2D-B7tBTM9T.js";import"./dehydratedFeatures-C-2nu7sF.js";var C=[`route-info`,`direction-line`,`direction-point`,`polygon-barrier`,`polyline-barrier`,`point-barrier`,`stop`],w={graphic:null,property:null,oldValue:null,newValue:null};function T(e){return e instanceof d||e instanceof f||e instanceof m||e instanceof g||e instanceof h||e instanceof p||e instanceof _}function E(e){return c.isCollection(e)&&e.length&&T(e.at(0))}function D(e){return Array.isArray(e)&&e.length>0&&T(e[0])}var O=class extends v(y){constructor(){super(...arguments),this._graphics=new c,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map,this._interaction=null,this._loadInteractionPromise=null,this.interactive=!1}get _routeItems(){return new a({getCollections:()=>this.layer&&!this.destroyed?[this.layer.routeInfo?new c([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]:[]})}initialize(){this.addHandles(l(()=>{let{interactive:e,suspended:t}=this;return{interactive:e,suspended:t}},({interactive:e,suspended:t})=>{let n=e&&!t;n&&this._getInteractionLoadPromise().then(e=>{e.enabled=this.interactive&&!this.suspended}),this._interaction&&(this._interaction.enabled=n)},u)),this._updatingHandles.addOnCollectionChange(()=>this._routeItems,e=>this._routeItemsChanged(e),o)}destroy(){this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),this._get(`_routeItems`)?.destroy()}attach(){this._createGraphicsView()}detach(){this._destroyGraphicsView(),this._interaction?.enabled&&(this._interaction.enabled=!1)}get selectedNetworkFeatures(){return this._interaction?.selectedNetworkFeatures??null}async create(e){if(this.interactive)return(await this._getInteractionLoadPromise()).create(e)}async fetchPopupFeaturesAtLocation(e,t){return this._graphicsView.hitTest(e).filter(({popupTemplate:e})=>!!e)}highlight(e,t){let r;r=T(e)?[this._getNetworkFeatureUid(e)]:D(e)?e.map(e=>this._getNetworkFeatureUid(e)):E(e)?e.map(e=>this._getNetworkFeatureUid(e)).toArray():[e.uid];let a=r.filter(n);if(!a.length)return i();let o=b(t);return this._addHighlights(a,o),i(()=>this._removeHighlights(a,o))}async hitTest(e,t){if(this.suspended)return null;let r=this._graphicsView.hitTest(e).filter(n).map(e=>this._networkGraphicMap.get(e));if(!r.length)return null;let{layer:i}=this;return r.reverse().map(t=>({type:`route`,layer:i,mapPoint:e,networkFeature:t}))}isUpdating(){return this._graphicsView.updating}moveEnd(){}remove(e){this._interaction?.remove(e)}update(e){this._graphicsView.processUpdate(e)}viewChange(){this._graphicsView.viewChange()}_createGraphic(e){let t=e.toGraphic();return t.layer=this.layer,t.sourceLayer=this.layer,t}_createGraphicsView(){let e=this.view,t=()=>this.requestUpdate(),n=new x(e.featuresTilingScheme);this._graphicsView=new S({container:n,graphics:this._graphics,requestUpdateCallback:t,view:e}),this.container.addChild(n),this._processHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(e){let t=this._networkGraphicMap.get(e);return C.indexOf(t.type)}_getInteractionLoadPromise(){return this._loadInteractionPromise||(this._loadInteractionPromise=this._loadInteraction(),this._updatingHandles.addPromise(this._loadInteractionPromise)),this._loadInteractionPromise}_getNetworkFeatureUid(e){return this._networkFeatureMap.has(e)?this._networkFeatureMap.get(e).uid:null}async _loadInteraction(){let{layer:t,view:n}=this,{RouteLayerInteraction:r}=await e(async()=>{let{RouteLayerInteraction:e}=await import(`./RouteLayerInteraction-D8Hm2_fp.js`);return{RouteLayerInteraction:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45]));return this._interaction=new r({view:n,layer:t}),this._interaction}_routeItemsChanged(e){if(e.removed.length){this._graphics.removeMany(e.removed.map(e=>{let t=this._networkFeatureMap.get(e);return this._networkFeatureMap.delete(e),this._networkGraphicMap.delete(t),t}));for(let t of e.removed)this.removeHandles(t)}if(e.added.length){this._graphics.addMany(e.added.map(e=>{let t=this._createGraphic(e);return t.symbol==null?null:(this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),t)}).filter(n));for(let t of e.added)this.addHandles([l(()=>t.geometry,(e,n)=>{this._updateGraphic(t,`geometry`,e,n)}),l(()=>t.symbol,(e,n)=>{this._updateGraphic(t,`symbol`,e,n)}),l(()=>t.popupTemplate,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).popupTemplate=e)}),l(()=>t.toGraphic().attributes,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).attributes=e)})],t);this._graphics.sort((e,t)=>this._getDrawOrder(e)-this._getDrawOrder(t))}}_updateGraphic(e,t,n,r){if(!this._networkFeatureMap.has(e)){let t=this._createGraphic(e);this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),this._graphics.add(t);return}let i=this._networkFeatureMap.get(e);i[t]=n,w.graphic=i,w.property=t,w.oldValue=r,w.newValue=n,this._graphicsView.graphicUpdateHandler(w)}_processHighlight(){let e=this._getHighlights();this._graphicsView?.setHighlight(e)}};s([t()],O.prototype,`_routeItems`,null),s([t()],O.prototype,`_interaction`,void 0),s([t()],O.prototype,`interactive`,void 0),s([t({readOnly:!0})],O.prototype,`selectedNetworkFeatures`,null),O=s([r(`esri.views.2d.layers.RouteLayerView2D`)],O);var k=O;export{k as default};