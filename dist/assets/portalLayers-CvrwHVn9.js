import{BT as e,Ba as t,Eh as n,Fh as r,_h as i,bh as a}from"./index-ByaFsVj4.js";import{t as o}from"./associatedFeatureServiceUtils-C4oO8OzZ.js";import{n as s}from"./fetchService-CCC5nmQq.js";import{a as c,i as l,l as u,n as d,r as f,s as p,u as m}from"./loadUtils-Bozh8QCP.js";import{t as h}from"./lazyLayerLoader-C-gbeYPV.js";async function g(e){let{portalItem:t}=e;!t||t instanceof r||(t=new r(t));let n=await _(t);return new n.constructor({portalItem:t,...n.properties})}async function _(e){await e.load();let t=new m;return y(await v(e,t))}async function v(t,n){switch(t.type){case`3DTiles Service`:return t.typeKeywords.includes(`3DObject`)?j():t.typeKeywords.includes(`GaussianSplat`)?A():k();case`CSV`:return M();case`Feature Collection`:return C(t);case`Feature Service`:return x(t,n);case`Feed`:return z();case`GeoJson`:return O();case`Group Layer`:return B();case`Image Service`:return w(t,n);case`KML`:return N();case`Knowledge Graph Layer`:return P();case`Map Service`:return b(t,n);case`Media Layer`:return V();case`Scene Service`:return S(t,n);case`Stream Service`:return T();case`Video Service`:return E(t,n);case`Vector Tile Service`:return D();case`WCS`:return F();case`WFS`:return I();case`WMS`:return L();case`WMTS`:return R();default:throw new e(`portal:unknown-item-type`,"Unknown item type '${type}'",{type:t.type})}}async function y(e){let t=e.className,n=h[t];return{constructor:await n(),properties:e.properties}}async function b(e,t){return await H(e,t)?{className:`TileLayer`}:{className:`MapImageLayer`}}async function x(e,t){let n=await U(e,t);if(typeof n==`object`){let{sourceJSON:e,className:t}=n,r={sourceJSON:e};return n.id!=null&&(r.layerId=n.id),{className:t||`FeatureLayer`,properties:r}}return{className:`GroupLayer`}}async function S(e,t){let r=await U(e,t,async()=>{try{if(!e.url)return[];let{serverUrl:n}=await o(e.url,{sceneLayerItem:e});return(await t.fetchServiceMetadata(n))?.tables??[]}catch{return[]}});if(typeof r==`object`){let i={},a;if(r.id==null?a=e.url:(i.layerId=r.id,a=`${e.url}/layers/${r.id}`),e.typeKeywords?.length){for(let t of Object.keys(n))if(e.typeKeywords.includes(t))return{className:n[t]}}let o=await t.fetchServiceMetadata(a,{customParameters:await t.fetchCustomParameters(e,e=>p(e)?.customParameters)});return{className:n[o?.layerType]||`SceneLayer`,properties:i}}return!1===r&&(await t.fetchServiceMetadata(e.url))?.layerType===`Voxel`?{className:`VoxelLayer`}:{className:`GroupLayer`}}async function C(e){await e.load();let n=t(e,`Map Notes`),r=t(e,`Markup`);if(n||r)return{className:`MapNotesLayer`};if(t(e,`Route Layer`))return{className:`RouteLayer`};let i=await e.fetchData();return d(i)===1?{className:`FeatureLayer`}:{className:`GroupLayer`}}async function w(e,t){await e.load();let n=e.typeKeywords?.map(e=>e.toLowerCase())??[];if(n.includes(`elevation 3d layer`))return{className:`ElevationLayer`};if(n.includes(`tiled imagery`))return{className:`ImageryTileLayer`};let r=await t.fetchItemData(e),i=r?.layerType;if(i===`ArcGISTiledImageServiceLayer`)return{className:`ImageryTileLayer`};if(i===`ArcGISImageServiceLayer`)return{className:`ImageryLayer`};let a=await t.fetchServiceMetadata(e.url,{customParameters:await t.fetchCustomParameters(e)}),o=a.cacheType?.toLowerCase(),s=a.capabilities?.toLowerCase().includes(`tilesonly`),c=a.tileInfo?.format?.toLowerCase()??``,l=o==null&&[`jpg`,`jpeg`,`png`,`png8`,`png24`,`png32`,`mixed`].includes(c);return o===`map`||l||s?{className:`ImageryTileLayer`}:{className:`ImageryLayer`}}function T(){return{className:`StreamLayer`}}async function E(e,t){return typeof await U(e,t)==`object`?{className:`VideoLayer`}:{className:`GroupLayer`}}function D(){return{className:`VectorTileLayer`}}function O(){return{className:`GeoJSONLayer`}}function k(){return{className:`IntegratedMesh3DTilesLayer`}}function A(){return{className:`GaussianSplatLayer`}}function j(){return{className:`UnsupportedLayer`}}function M(){return{className:`CSVLayer`}}function N(){return{className:`KMLLayer`}}function P(){return{className:`KnowledgeGraphLayer`}}function F(){return{className:`WCSLayer`}}function I(){return{className:`WFSLayer`}}function L(){return{className:`WMSLayer`}}function R(){return{className:`WMTSLayer`}}function z(){return{className:`StreamLayer`}}function B(){return{className:`GroupLayer`}}function V(){return{className:`MediaLayer`}}async function H(e,t){let{tileInfo:n}=await t.fetchServiceMetadata(e.url,{customParameters:await t.fetchCustomParameters(e)});return n}async function U(e,t,n){let{url:r,type:o}=e,m=o===`Feature Service`;if(!r)return{};if(/\/\d+$/.test(r)){if(m){let n=await t.fetchServiceMetadata(r,{customParameters:await t.fetchCustomParameters(e,e=>p(e)?.customParameters)});return a(e,i()),{id:n.id,className:s(n.type),sourceJSON:n}}return{}}if(o===`Video Service`)return!(((await t.fetchServiceMetadata(r)).layers?.length??0)>1)&&{};await e.load();let h=await t.fetchItemData(e);if(m){let{data:n,preferredHost:i}=await l(h,r,t);a(e,i);let o=W(n);if(typeof o==`object`){let e=c(n,o.id);o.className=f(e?.layerType)}return o}if(o===`Scene Service`&&(h=await u(e,h,t)),d(h)>0)return W(h);let g=await t.fetchServiceMetadata(r);return n&&(g.tables=await n()),W(g)}function W(e){return d(e)===1&&{id:p(e)?.id}}export{v as n,g as t};