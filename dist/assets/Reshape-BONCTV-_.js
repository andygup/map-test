const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SegmentLabels2D-D4unev2O.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css","assets/colorUtils-CzajW9E7.js","assets/vec3-B94Y7ih2.js","assets/memoize-Dl61_jt0.js","assets/quantity-Co6flzuS.js","assets/quantityFormatUtils-DorrZj0i.js","assets/unitFormatUtils-DIX5VDC2.js","assets/SegmentLabels-DAtgpVzT.js","assets/elevationInfoUtils-uoMH3ofe.js","assets/getDefaultUnitForView-DyZIV1hK.js"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,Aw as n,Ay as r,BT as i,CE as a,Cv as o,Cy as s,DT as c,Dy as l,Ex as u,Ey as d,Fh as f,Fy as p,Iy as m,Ld as h,Ly as g,Nh as _,Ny as v,Od as y,Oy as b,Py as x,Sg as S,Sv as C,Sy as w,TT as T,Tv as E,VT as D,Vd as O,Xv as ee,_y as te,ab as k,ay as ne,cb as re,cd as ie,cv as ae,dg as oe,dv as se,fb as ce,fv as A,hv as j,jT as M,jy as N,kD as P,ky as F,lE as I,mD as L,mv as le,ng as ue,ny as de,pT as fe,pb as pe,pv as R,rE as me,sv as he,uv as ge,vE as _e,vv as ve,wg as ye,wv as be,wy as xe,yy as Se,zv as z,zw as Ce}from"./index-BN8X5Ryz.js";import"./memoryEstimations-D_IbKyOk.js";import"./OptimizedGeometry-BQJ7w5VU.js";import"./Point2D-DJueHbCy.js";import"./Envelope2D-B7gkUj4e.js";import"./SpatialReference-CfUjvF_j.js";import"./Transformation2D-D07KwcEj.js";import"./SimpleGeometryCursor-BILtMaQf.js";import"./OperatorDefinitions-C5Pat-Jx.js";import"./jsonConverter-CoA5-zxu.js";import"./FlatGeometry-BsPiiSVP.js";import{d as we,n as Te}from"./apiConverter-Dsm0pxcs.js";import"./quatf64-D37SEdPg.js";import"./quat-C8PgLo31.js";import"./axisAngleDegrees-DzAS4tF-.js";import"./MeshLocalVertexSpace-vomIk0sx.js";import"./MeshTransform-BaPjlQwH.js";import"./meshVertexSpaceUtils-s2jLb8qI.js";import"./plane-Da5EsY0J.js";import"./vectorStacks-Cuo89CNO.js";import"./projectPointToVector-BkRdoTqD.js";import"./spatialReferenceEllipsoidUtils-qw9wv8RL.js";import"./dehydratedPoint-CWZQBefp.js";import"./projectVectorToVector-DGzn2p7I.js";import"./layerViewUtils-CJcMVuwG.js";import"./memoize-Dl61_jt0.js";import"./elevationInfoUtils-uoMH3ofe.js";import"./colorUtils-CzajW9E7.js";import"./cimSymbolUtils-CLt57XQ8.js";import"./utils-BGjabRH0.js";import{t as B}from"./GraphicsLayer-DBcl42yN.js";import{t as Ee}from"./symbolUtils-tTcNtU7T.js";import"./devEnvironmentUtils-Yxtjm7qW.js";import"./webStyleSymbolUtils-DnfhffQg.js";import"./getDefaultUnitForView-DyZIV1hK.js";import{i as V}from"./quantity-Co6flzuS.js";import"./unitFormatUtils-DIX5VDC2.js";import"./quantityFormatUtils-DorrZj0i.js";import"./geodesicUtils-D99LxQ6q.js";import{r as De,t as Oe}from"./layerUtils-BZgsYerz.js";import{t as ke}from"./SketchOptions-DjwJVzbR.js";import"./LineSnappingHint-CmFAetWF.js";import"./ParallelSnappingHint-CVYaPm-q.js";import"./IntersectionSnappingHint-CvQZ8eWi.js";import"./RightAngleSnappingHint-tXLlHR_t.js";import{o as Ae}from"./euclideanLengthMeasurementUtils-CvEUUrXw.js";import"./PointSnappingHint-F2JtYtXH.js";import{n as je,t as Me,u as Ne}from"./SnappingContext-CJ1Obe6m.js";import{t as Pe}from"./SnappingVisualizer2D-DBg2fFdu.js";import{a as Fe,i as Ie,l as Le,o as Re,s as ze}from"./rotate-Drb-fn66.js";import"./angularMeasurementUtils-DQYnovl-.js";import"./curveOperationUtils-CjGTFE3v.js";import{a as Be,i as Ve}from"./drawUtils-BUBS53Cs.js";import{n as He,r as Ue,t as We}from"./SelectedVertexTooltipInfo-BFQFy4wV.js";import{t as Ge}from"./TranslateTooltipInfo-_IhWPH6-.js";import{n as Ke,t as qe}from"./GraphicMover-C6nMhwuQ.js";import{t as Je}from"./settings-D0ZT6y9O.js";var Ye=()=>a.getLogger(`esri.views.draw.support.ConnectedReshapeManager`),Xe=Symbol(),H=class extends n{constructor(e){super(e),this.activeOperationType=null,this.providerFactories=[],this.view=null,this._activeProviders=new Set,this._graphics=new Map,this._modifiedFeatures=new Map,this._modifiedGraphicsLayer=new B({listMode:`hide`,internal:!0,title:`Connected Reshape Modified Graphics (Internal)`}),this._pendingGraphicsLayer=new B({listMode:`hide`,internal:!0,title:`Connected Reshape Pending Graphics (Internal)`}),this._pendingFeatures=new Map,this._updatingHandles=new ye}initialize(){this.view.map.addMany([this._modifiedGraphicsLayer,this._pendingGraphicsLayer])}destroy(){this.view.destroyed||this.view.map.removeMany([this._modifiedGraphicsLayer,this._pendingGraphicsLayer]),this._modifiedGraphicsLayer.destroy(),this._pendingGraphicsLayer.destroy(),this._updatingHandles.destroy()}get updating(){return this._updatingHandles.updating||Array.from(this._activeProviders).some(e=>e.updating)}startFeatureMove(e){this.activeOperationType=0,this._activeProviders.clear();for(let t of this.providerFactories)Ce(this._activeProviders,t.getFeatureReshapeProvider(e))}startVertexMove(e,t){this.activeOperationType=1,this._activeProviders.clear();for(let n of this.providerFactories)Ce(this._activeProviders,n.getVertexReshapeProvider(e,t))}finish(){this.activeOperationType=null,this._activeProviders.clear();for(let[e,t]of this._pendingFeatures){this._pendingFeatures.delete(e),this._modifiedFeatures.set(e,t);let n=this._graphics.get(e);n&&(this._modifiedGraphicsLayer.add(n),this._pendingGraphicsLayer.remove(n))}}translate(e,t,n=0){if(this.activeOperationType===null)return;let r=U(e),i=U(t),a=U(n);for(let e of this._activeProviders){let t=e.translate(r,i,a);this._update(t)}}async _initializeGraphic(e,t){e.symbol??=await this._updatingHandles.addPromise(Ee(e,{scale:this.view.scale,useSourceLayer:!0})),this._pendingFeatures.has(t.uniqueId)?this._pendingGraphicsLayer.add(e):this._modifiedFeatures.has(t.uniqueId)&&this._modifiedGraphicsLayer.add(e),this.addHandles(await Ze(t.originalGraphic,e,this.view),Xe)}_update(e){for(let t of e){let e=this._modifiedFeatures.delete(t.uniqueId);this._pendingFeatures.set(t.uniqueId,t);let n=_e(this._graphics,t.uniqueId,()=>{let e=t.graphic.cloneShallow();return this._initializeGraphic(e,t),e});n.geometry=t.graphic.geometry,e&&(this._modifiedGraphicsLayer.remove(n),this._pendingGraphicsLayer.add(n))}}get test(){return{activeProviders:this._activeProviders,modifiedFeatures:this._modifiedFeatures,modifiedGraphicsLayer:this._modifiedGraphicsLayer,pendingFeatures:this._pendingFeatures,pendingGraphicsLayer:this._pendingGraphicsLayer}}};async function Ze(e,t,n){let r=e.sourceLayer,i=e.getObjectId();if(i==null)return Ye().error(`editing:cannot-hide-graphic`,`Unable to hide original graphic because it has no objectId.`),me();let a=null;function o(e){a?.abort(),a=S(async t=>{let a=await et(n,r);fe(t),a&&a.setVisibility?.(i,e)})}return await $e(n,t),o(!1),I([Qe(n,t,e=>o(!e)),me(async()=>{o(!0);let e=await et(n,r);await A(()=>!e?.updating)})])}function Qe(e,t,n){if(e.type===`3d`){let r=new Ue({graphic:t});return I([e.trackGraphicState(r),R(()=>r.displaying,n)])}return R(()=>t.visible,n)}async function $e(e,t){if(e.type===`3d`){let n=new Ue({graphic:t}),r=e.trackGraphicState(n);await A(()=>n.displaying||n.error),r.remove()}else await A(()=>t.visible)}async function et(e,t){let n=_(t)||f(t)?t.parent:t;return n?e.whenLayerView(n):null}function U(e){return isNaN(e)?0:e}P([i()],H.prototype,`activeOperationType`,void 0),P([i()],H.prototype,`providerFactories`,void 0),P([i()],H.prototype,`updating`,null),P([i({constructOnly:!0})],H.prototype,`view`,void 0),H=P([D(`esri.views.draw.support.ConnectedReshapeManager`)],H);var W=class extends Ie{constructor(e){super(e),this.type=`translate-vertex`,this.distance=V,this.elevation=null,this.area=null,this.totalLength=null}clear(){this.distance=V,this.elevation=null,this.area=null,this.totalLength=null}};P([i()],W.prototype,`type`,void 0),P([i()],W.prototype,`distance`,void 0),P([i()],W.prototype,`elevation`,void 0),P([i()],W.prototype,`area`,void 0),P([i()],W.prototype,`totalLength`,void 0),W=P([D(`esri.views.interactive.tooltip.infos.TranslateVertexTooltipInfo`)],W);function tt(e){let t={sketchOptions:e,viewType:`2d`};return{movePoint:new He(t),selectedVertex:new We(t),translateGraphic:new Ge(t),translateVertices:new W(t)}}function nt(e,t){function n(){let e=t(),n=e.sketchOptions.tooltips.effectiveEnabled?e.activeTooltipInfo:null;return{...e,activeTooltipInfo:n}}let r=!1;function i(e){r||=(r=!0,e(),!1)}return I([R(()=>{let e=n();return{context:e,geometry:e.graphic?.geometry,vertexGeometry:e.selectedVertex?.geometry}},({context:t})=>{i(()=>{rt(t),e.info=t.activeTooltipInfo})},le),R(()=>{let e=n(),{activeTooltipInfo:t}=e;if(t&&`key`in t)return{context:e,key:t.key}},(e,t)=>{e&&t&&e.key!==t.key&&i(()=>st(e.context))},ae),Fe(e,{onBeforePaste:()=>{r=!0},onAfterPaste:()=>{st(n()),r=!1}})])}function rt(e){let t=e.activeTooltipInfo;if(t){switch(t?.type){case`move-point`:return it(t,e);case`selected-vertex`:return at(t,e)}t.sketchOptions=e.sketchOptions}}function it(e,{graphic:t}){ot(e,t,t?.geometry)}function at(e,{graphic:t,selectedVertex:n,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:a}){ot(e,t,n?.geometry);let o=t?.geometry;if(!o||!r(o))switch(o?.type){case`polygon`:e.geometryType=`polygon`,e.totalLength.visible=!1,e.area.actual=i.autoArea2D(o);break;case`polyline`:e.geometryType=`polyline`,e.totalLength.actual=a.autoLength2D(o),e.area.visible=!1;break;case`multipoint`:e.geometryType=`multipoint`,e.area.visible=!1,e.totalLength.visible=!1}}function ot(e,t,n){t&&n?.type===`point`&&(e.setLocationFromPoint(n),e.elevation.actual=Ae(n),e.elevation.visible=!!t.geometry?.hasZ,e.elevation.readOnly=!1,e.elevation.showAsZ=!0)}function st(e){function t(t,n){let r=n?.geometry;if(!r||r.type!==`point`)return;let{dx:i,dy:a,dz:o}=Re(t,r);if(i===0&&a===0&&o===0)return;let{x:s,y:c,z:l,m:d,spatialReference:f}=r,p=new u({x:s+i,y:c+a,z:l==null?void 0:l+o,m:d,spatialReference:f});e.updateGeometry(n,p,r,i,a)}let{activeTooltipInfo:n,graphic:r,selectedVertex:i}=e;switch(n?.type){case`move-point`:return t(n,r);case`selected-vertex`:return t(n,i)}}function ct(e,t,n,r){e.clear(),ut(e,t,r,n)}function lt(e,t,n,i,a){if(e.clear(),n&&r(n))return;let{automaticAreaMeasurementUtils:o,automaticLengthMeasurementUtils:s}=i;n?.type===`polygon`?e.area=o.autoArea2D(n):n?.type===`polyline`&&(e.totalLength=s.autoLength2D(n)),ut(e,t,a,i)}function ut(e,t,n,{automaticLengthMeasurementUtils:r}){if(!n)return;let{x:i,y:a}=n.origin,o=t.toMap(n),s=t.toMap(oe(i,a));e.distance=r.autoDistanceBetweenPoints2D(s,o)??V}var G={pathIndex:`pathIndex`,pointIndex:`pointIndex`,pointIndexStart:`pointIndexStart`,pointIndexEnd:`pointIndexEnd`,controlPointKind:`kind`,relatedGraphicIndices:`relatedGraphicIndices`,curveFromStraightEdgeFlag:`curveFromStraightEdgeFlag`,tool:`esriSketchTool`},K={bezier:{cp1:`bezier-cp-1`,cp2:`bezier-cp-2`,line1:`bezier-line-1`,line2:`bezier-line-2`},circle:{interior:`circle-interior`}},q=Je.reshapeGraphics,dt={vertices:{default:new h({style:`circle`,size:q.vertex.size,color:q.vertex.color,outline:{color:q.vertex.outlineColor,width:1}}),hover:new h({style:`circle`,size:q.vertex.hoverSize,color:q.vertex.hoverColor,outline:{color:q.vertex.hoverOutlineColor,width:1}}),selected:new h({style:`circle`,size:q.selected.size,color:q.selected.color,outline:{color:q.selected.outlineColor,width:1}})},controlPoints:{default:new h({style:`diamond`,size:q.vertex.size,color:q.vertex.color,outline:{color:q.vertex.outlineColor,width:1}}),hover:new h({style:`diamond`,size:q.vertex.hoverSize,color:q.vertex.hoverColor,outline:{color:q.vertex.hoverOutlineColor,width:1}}),selected:new h({style:`diamond`,size:q.selected.size,color:q.selected.color,outline:{color:q.selected.outlineColor,width:1}})},midpoints:{default:new h({style:`circle`,size:q.midpoint.size,color:q.midpoint.color,outline:{color:q.midpoint.outlineColor,width:1}}),hover:new h({style:`circle`,size:q.midpoint.size,color:q.midpoint.color,outline:{color:q.midpoint.outlineColor,width:1}})},constructionLines:new O({style:`solid`,width:1,color:q.vertex.color})};function ft(e,t,n){let r=[];return e?.forEach((e,i)=>{e.forEach((e,a)=>{r.push(new y({geometry:n.arrayToPoint(b(e)),symbol:t?.vertices?.default,attributes:{[G.tool]:`box`,[G.pathIndex]:i,[G.pointIndex]:a}}))})}),r}function pt(e,t,n){let r=[];for(let i=0;i<e.length;i++){let a=e[i];if(!_t(e,i))for(let e=1;e<a.length;e++){let o=a[e];if(F(o))continue;let c=b(a[e-1]),l={[G.tool]:`box`,[G.pathIndex]:i,[G.pointIndex]:e};if(v(o)){let e=o.b.slice(1);r.push(...e.map((e,r)=>new y({geometry:n.arrayToPoint(e),symbol:t?.controlPoints?.default,attributes:{...l,[G.controlPointKind]:r===0?K.bezier.cp1:K.bezier.cp2}})))}let u=x(o),f=d(o);if(u||f){let e=u?m(c,o):s(c,o),i=k(e,.25);r.push(new y({geometry:n.arrayToPoint(i),symbol:t?.controlPoints?.default,attributes:{...l,[G.controlPointKind]:K.circle.interior}}))}}}return r}function mt(e,t,n){let r=[],{spatialReference:i}=n;for(let n=0;n<e.length;n++){let a=e[n];for(let e=1;e<a.length;e++){let o=a[e];if(!v(o))continue;let[s,c,l]=o.b,u=b(a[e-1]),d={[G.tool]:`box`,[G.pathIndex]:n,[G.pointIndex]:e};r.push(new y({geometry:new z({paths:[[[u[0],u[1]],c]],spatialReference:i}),symbol:t?.constructionLines,attributes:{...d,[G.controlPointKind]:K.bezier.line1}}),new y({geometry:new z({paths:[[[s[0],s[1]],l]],spatialReference:i}),symbol:t?.constructionLines,attributes:{...d,[G.controlPointKind]:K.bezier.line2}}))}}return r}function ht(e,t,n,r){let i=[];for(let a=0;a<e.length;a++){let o=e[a],s=yt(e,a);for(let e=0;e<o.length;e++){let c=(e+1)%o.length;if((!r||s)&&c===0)continue;let l=gt(o[e],o[c],n);i.push(new y({geometry:l,symbol:t.midpoints.default,attributes:{[G.tool]:`box`,[G.pathIndex]:a,[G.pointIndexStart]:e,[G.pointIndexEnd]:c}}))}}return i}function gt(e,t,n){let r=b(e),i=b(t),{spatialReference:a}=n,o=n.arrayToVector(r),c=n.arrayToVector(i),l=n.toXYZ(o),f=n.toXYZ(c),[p,h,g]=ee(l,f),_=n.hasM()?0:void 0;if(F(t))return new u({x:p,y:h,z:g,m:_,spatialReference:a});if(v(t)){let[e,n]=ce(r,t,.5);return new u({x:e,y:n,z:g,m:_,spatialReference:a})}if(x(t)){let e=m(r,t),[n,i]=k(e,.5);return new u({x:n,y:i,z:g,m:_,spatialReference:a})}if(d(t)){let e=s(r,t),[n,i]=k(e,.5);return new u({x:n,y:i,z:g,m:_,spatialReference:a})}let y=Se(r,t),[S,C]=te(y,.5);return new u({x:S,y:C,z:g,m:_,spatialReference:a})}function _t(e,t){let n=e.at(t);return n?.length===2&&L(b(n[1]),b(n[0]))&&d(n[1])}function vt(e,t){let n=e.at(t);return n?.length===2&&L(b(n[1]),b(n[0]))&&N(n[1])}function yt(e,t){let n=e.at(t);return n?.length===2&&L(b(n[1]),b(n[0]))&&l(n[1])}function J(e,t){if(C(e))return void(e.points=t.flat());let n=t.some(e=>e.some(e=>!F(e)));E(e)?n?(e.curveRings=t,e.rings=[]):(e.rings=t,e.curveRings=void 0):o(e)&&(n?(e.curvePaths=t,e.paths=[]):(e.curvePaths=void 0,e.paths=t))}function bt(e,t,n,r){let i=b(t),a=[];switch(!0){case v(t):a=re(e,t,n);break;case x(t):{let r=m(e,t);a=g(r,t,n);break}case d(t):{let r=s(e,t);a=xe(r,t,n);break}default:{let r=Se(e,t);a=w(r,t,n);break}}if(a.length<2)return a;if(r.hasZ()){let t=e.at(2)??0,r=i.at(2)??0,o=t+(r-t)*n;b(a[0])[2]=o,b(a[1])[2]=r}if(r.hasM()){let e=r.hasZ()?3:2;b(a[0])[e]=0,b(a[1])[e]=i.at(-1)??0}return a}var Y=Symbol(),xt={mode:`on-the-ground`,offset:0},X=class extends ve{constructor(e){super(e),this._updateHandlesOnExternalGeometryChange=null,this._activeOperationInfo=null,this._connectedReshapeManager=null,this._editGeometryOperations=null,this._segmentLabels=null,this._segmentLabelsImportTask=null,this._mover=null,this._snappingContext=null,this._snappingGraphicsLayer=null,this._hoverGraphic=null,this._snappingTask=null,this._stagedVertex=null,this._updatingHandles=new ye,this.callbacks={onReshapeStart(){},onReshape(){},onReshapeStop(){},onMoveStart(){},onMove(){},onMoveStop(){},onGraphicClick(){}},this.connectedReshapeProviders=null,this.enableMidpoints=!0,this.enableCurveOnMidpoint=!1,this.enableMovement=!0,this.enableVertices=!0,this.graphic=null,this.highlightName=null,this.highlightsEnabled=!0,this.layer=null,this.snappingManager=null,this.symbols=dt,this.tooltip=null,this.activeTooltipInfo=null,this.sketchOptions=new ke,this.type=`reshape`,this.vertexGraphics=new j,this.curveControlPointGraphics=new j,this.constructionLineGraphics=new j,this.midpointGraphics=new j,this.selectedManipulators=new j,this.view=null}initialize(){let e=this.view;this._highlightHelper=new Ke({view:e}),this._setup(),this._updateHandlesOnExternalGeometryChange=he(()=>this.graphic?.geometry,e=>{if(!e)return;let t=new Set(this.selectedManipulators.map(Ot));this._highlightHelper.removeAll(),this._setUpHighlights(),this._setupGraphics(),this._clearSelection(),this.vertexGraphics.filter(e=>t.has(Ot(e))).forEach(e=>this._addToSelection(e));let{enableMovement:n,_mover:r,graphic:i,midpointGraphics:a,vertexGraphics:o,curveControlPointGraphics:s}=this,c=o.concat(a,s).toArray();n&&c.push(i),r?.set(`graphics`,c)},ae),this.tooltip=Le(()=>({view:e,options:this.sketchOptions.tooltips})),this.tooltipInfos=tt(this.sketchOptions),this.addHandles([ge(()=>e?.ready,()=>{let{layer:e,view:t}=this;De(t,e),this.addHandles(t.on(`key-down`,e=>this._keyDownHandler(e),ue.TOOL))},{once:!0,initial:!0}),R(()=>this.graphic,()=>this.refresh()),R(()=>this.layer,(e,t)=>{t&&(this._clearSelection(),this._resetGraphics(t)),this.refresh()}),R(()=>[this.highlightsEnabled,this.highlightName],()=>{this._highlightHelper?.removeAll(),this._setUpHighlights()}),R(()=>this.enableMidpoints,()=>this.refresh()),nt(this.tooltip,()=>this._tooltipsContext),R(()=>this.sketchOptions.labels.enabled,e=>{this._segmentLabels?this._segmentLabels.visible=e:this._setUpGeometryHelper()}),R(()=>this.view.effectiveTheme.accentColor,()=>this._updateSymbolsForTheme(),se),this._updateHandlesOnExternalGeometryChange]),this._updateTooltip()}destroy(){this._reset(),this._mover=M(this._mover),this._connectedReshapeManager=M(this._connectedReshapeManager),this.tooltip=M(this.tooltip),this._segmentLabelsImportTask=T(this._segmentLabelsImportTask),this._segmentLabels=M(this._segmentLabels),this._updatingHandles=M(this._updatingHandles)}get _coordinateHelper(){return this._editGeometryOperations?.data.coordinateHelper??Ne(!!this.graphic.geometry?.hasZ,!!this.graphic.geometry?.hasM,this.view.spatialReference)}get test(){return{segmentLabels:this._segmentLabels}}get _selectedManipulator(){return this.selectedManipulators.length===1?this.selectedManipulators.at(0):void 0}get _tooltipsContext(){let{automaticAreaMeasurementUtils:e,automaticLengthMeasurementUtils:t,sketchOptions:n,activeTooltipInfo:r,graphic:i}=this;return{sketchOptions:n,activeTooltipInfo:r,graphic:i,selectedVertex:this._selectedManipulator,automaticAreaMeasurementUtils:e,automaticLengthMeasurementUtils:t,updateGeometry:(e,t,n,r,i)=>{this._setUpGeometryHelper();let a=e===this.graphic;if(a?this._emitMoveStartEvent(0,0):this._emitReshapeStartEvent(e),this._syncGeometryAfterVertexMove(e,t,r,i,!0),a){let{view:e}=this,r=e.toScreen(n),i=e.toScreen(t),a=(i?.x??0)-(r?.x??0),o=(i?.y??0)-(r?.y??0);this._emitMoveEvent(a,o),this._emitMoveStopEvent(a,o)}else this._emitReshapeEvent(e),this._emitReshapeStopEvent(e)}}}get state(){let e=this.view.ready,t=!(!this.graphic||!this.layer);return e&&t?`active`:e?`ready`:`disabled`}get updating(){return this._updatingHandles.updating}isUIGraphic(e){return e===this.graphic||this._isMidpoint(e)||this._isCurveControlPoint(e)||this._isVertex(e)||this._isConstructionLine(e)}refresh(){this._reset(),this._setup()}reset(){this.graphic=null}clearSelection(){this._clearSelection()}removeSelectedVertices(){let{selectedManipulators:e}=this;e.length&&this._removeVertices(e)}_setup(){let{graphic:e,layer:t}=this;if(!t||e?.geometry==null)return;let n=e.geometry;n.type!==`mesh`&&n.type!==`extent`?(n.type===`polygon`&&ne(n),this._setUpHighlights(),this._setupGraphics(),this._setupMover(),this._setupConnectedReshapeManager(),this._setUpGeometryHelper()):this._logGeometryTypeError()}_setUpHighlights(){this.highlightsEnabled&&this.graphic&&this._highlightHelper?.add(this.graphic,this.highlightName)}_setUpGeometryHelper(){let e=this.graphic.geometry;if(e==null||e.type===`mesh`||e.type===`extent`)return this._segmentLabels=M(this._segmentLabels),void this._logGeometryTypeError();this._editGeometryOperations?this._syncEditGeometryOperations(e):this._editGeometryOperations=je.fromGeometry(e,2,{allowCurves:!0}),this._updatingHandles.addPromise(this._setupSegmentLabels())}_saveSnappingContextForHandle(e,t){this._snappingGraphicsLayer=new B({listMode:`hide`,internal:!0,title:`Reshape snapping layer`}),this.view.map.layers.add(this._snappingGraphicsLayer);let n=this._editGeometryOperations;c(n),this._snappingContext=new Me({editGeometryOperations:n,elevationInfo:xt,pointer:t.viewEvent?.pointerType||`mouse`,excludeFeature:this.graphic,feature:this.graphic,visualizer:new Pe(this._snappingGraphicsLayer),vertexHandle:this._getVertexFromEditGeometry(e)})}_reset(){this._clearSelection(),this._highlightHelper?.removeAll(),this._updateTooltip(),this._resetGraphics(),this._resetSnappingStateVars(),this._segmentLabelsImportTask=T(this._segmentLabelsImportTask),this._segmentLabels=M(this._segmentLabels),this._activeOperationInfo=null,this._mover=M(this._mover),this.removeHandles(Y)}_resetSnappingStateVars(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._snappingGraphicsLayer!=null&&(this.view?.map&&this.view.map.layers.remove(this._snappingGraphicsLayer),this._snappingGraphicsLayer.destroy()),this._snappingTask=T(this._snappingTask),this._snappingTask=null,this._snappingContext=null,this._stagedVertex=null}_resetGraphics(e){this._removeMidpointGraphics(e),this._removeVertexGraphics(e),this._removeCurveGraphics(e),this._updateTooltip()}_removeMidpointGraphics(e=this.layer){let{midpointGraphics:t}=this;e?.removeMany(t.items),t.drain(M)}_removeVertexGraphics(e=this.layer){let{vertexGraphics:t}=this;e?.removeMany(t.items),t.drain(M)}_removeCurveGraphics(e=this.layer){let{curveControlPointGraphics:t,constructionLineGraphics:n}=this;e?.removeMany(t.items),e?.removeMany(n.items),t.drain(M),n.drain(M)}_setupGraphics(){let e=this.graphic.geometry;if(e!=null&&(e.type===`polyline`||e.type===`polygon`||e.type===`multipoint`)){let t=St(e);this.enableMidpoints&&e.type!==`multipoint`&&this._setUpMidpointGraphics(t),this.enableVertices&&(this._setUpVertexGraphics(t),this._setupCurveGraphics(t))}}_setUpMidpointGraphics(e){this._removeMidpointGraphics();let t=ht(e,this.symbols,this._coordinateHelper,this.graphic.geometry?.type===`polygon`);this.midpointGraphics.addMany(t),this.layer.addMany(t)}_setUpVertexGraphics(e){this._removeVertexGraphics();let t=ft(e,this.symbols,this._coordinateHelper);this.vertexGraphics.addMany(t),this._storeRelatedVertexIndices(),this.layer.addMany(t)}_setupCurveGraphics(e){this._removeCurveGraphics();let t=pt(e,this.symbols,this._coordinateHelper),n=mt(e,this.symbols,this._coordinateHelper);this.curveControlPointGraphics.addMany(t),this.constructionLineGraphics.addMany(n),this.layer.addMany(n),this.layer.addMany(t)}async _setupSegmentLabels(){let t=this._editGeometryOperations,n=this.sketchOptions.labels.enabled;if(t&&this._segmentLabels?.context?.editGeometryOperations===t&&n||(this._segmentLabels=M(this._segmentLabels)),!this._segmentLabels&&t&&n){let n=this._segmentLabelsImportTask??=S(async t=>{let n=e(()=>import(`./SegmentLabels2D-D4unev2O.js`),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])),{SegmentLabels2D:r}=await this._updatingHandles.addPromise(n);return t.aborted?null:r}),r=await n.promise;if(!r)return;this._segmentLabels=M(this._segmentLabels),this._segmentLabels=new r({context:{view:this.view,editGeometryOperations:t,elevationInfo:xt,labelOptions:this.sketchOptions.labels,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},visible:!0})}}_updateSymbolsForTheme(){let e=this.view.effectiveTheme.accentColor;this.symbols={vertices:{...this.symbols.vertices,default:this.symbols.vertices.default.clone().set(`color`,e),hover:this.symbols.vertices.hover?.clone().set(`color`,e)},controlPoints:{...this.symbols.controlPoints,default:this.symbols.controlPoints.default.clone().set(`color`,e),hover:this.symbols.controlPoints.hover?.clone().set(`color`,e)},midpoints:{...this.symbols.midpoints},constructionLines:this.symbols.constructionLines.clone().set(`color`,e)};for(let e of this.vertexGraphics)this._isSelected(e)?e.symbol=this.symbols.vertices.selected:this._hoverGraphic===e?e.symbol=this.symbols.vertices.hover:e.symbol=this.symbols.vertices.default;for(let e of this.curveControlPointGraphics)this._isSelected(e)?e.symbol=this.symbols.controlPoints.selected:this._hoverGraphic===e?e.symbol=this.symbols.controlPoints.hover:e.symbol=this.symbols.controlPoints.default;for(let e of this.constructionLineGraphics)e.symbol=this.symbols.constructionLines}_storeRelatedVertexIndices(){let e=this.vertexGraphics.items;if(!e)return;let t=e.map(({geometry:e})=>({x:e.x,y:e.y}));for(let n=0;n<t.length;n++){let r=[];for(let e=0;e<t.length;e++){if(n===e)continue;let i=t[n],a=t[e];i.x===a.x&&i.y===a.y&&r.push(e)}e[n].attributes[G.relatedGraphicIndices]=r}}_setupMover(){let{enableMovement:e,graphic:t,midpointGraphics:n,vertexGraphics:r,view:i}=this,a=r.concat(n,this.curveControlPointGraphics).toArray();e&&t.geometry?.type!==`multipoint`&&a.push(t),this._mover=new qe({enableMoveAllGraphics:!1,highlightsEnabled:!1,indicatorsEnabled:!1,graphics:a,view:i,callbacks:{onGraphicClick:e=>this._onGraphicClickCallback(e),onGraphicMoveStart:e=>this._onGraphicMoveStartCallback(e),onGraphicMove:e=>this._onGraphicMoveCallback(e),onGraphicMoveStop:e=>this._onGraphicMoveStopCallback(e),onGraphicPointerOver:e=>this._onGraphicPointerOverCallback(e),onGraphicPointerOut:e=>this._onGraphicPointerOutCallback(e)}})}_setupConnectedReshapeManager(){let{connectedReshapeProviders:e}=this;e!=null&&e.length!==0&&(this._connectedReshapeManager=new H({providerFactories:e,view:this.view}))}_onGraphicClickCallback(e){e.viewEvent.stopPropagation();let t=e.graphic,n=this._isCurveControlPoint(t);if(t===this.graphic)this.clearSelection(),this.emit(`graphic-click`,e),this.callbacks.onGraphicClick?.(e);else if(this._isMidpoint(t)){if(e.viewEvent.button===2)return;let n=this.graphic.clone(),r=this._handleMidpointClickOrStartMove(e);this.refresh(),r.length&&this._emitVertexAddEvent([t],n,r)}else if(this._isVertex(t)||n){if(e.viewEvent.stopPropagation(),e.viewEvent.button===2)return void(n||this._removeVertices(t));e.viewEvent.native.shiftKey||this._clearSelection(),this.selectedManipulators.includes(t)?this._removeFromSelection(t,!0):this._addToSelection(t)}}_setUpOperation(e){let{graphic:t,dx:n,dy:r}=e,i=t===this.graphic;this._resetSnappingStateVars(),this._setUpGeometryHelper(),this._saveSnappingContextForHandle(t,e),this._activeOperationInfo={target:this.graphic,mover:t,operationType:i?`move`:`reshape`,totalDx:n,totalDy:r}}_onGraphicMoveStartCallback(e){let{dx:t,dy:n,graphic:r}=e,i=this._connectedReshapeManager,a=i?At(this.graphic):null;if(r===this.graphic){let{geometry:o}=r;this._setUpOperation(e),this._emitMoveStartEvent(t,n),a&&i?.startFeatureMove([a]),o!=null&&o.type===`point`&&this._onHandleMove(r,t,n,e,()=>{this._updateTooltip(this.graphic,e.viewEvent),this._emitMoveEvent(t,n)});return}let{selectedManipulators:o}=this;if(!o.includes(r)){if(this._clearSelection(),this._isMidpoint(r)){let t=this.graphic.clone(),n=this._handleMidpointClickOrStartMove(e);n.length&&(this._emitVertexAddEvent([r],t,n),this._refreshGraphicIndicesAttributes(n[0]))}this._addToSelection(r)}if(this._setUpOperation(e),a){let e=o.filter(e=>this._isVertex(e));i?.startVertexMove(a,jt(e))}this._emitReshapeStartEvent(r),this._onHandleMove(r,t,n,e,()=>{this._updateTooltip(r,e.viewEvent),this._emitReshapeEvent(r)})}_onGraphicMoveCallback(e){let t=this._activeOperationInfo;if(!t)return;let{dx:n,dy:r,graphic:i}=e;t.totalDx+=n,t.totalDy+=r;let{operationType:a}=t,{geometry:o}=i;if(o!=null)if(a!==`move`)this._onHandleMove(i,n,r,e,()=>{this._updateTooltip(i,e.viewEvent),this._emitReshapeEvent(i)});else{if(o.type===`point`)this._onHandleMove(i,n,r,e,()=>{this._updateTooltip(this.graphic,e.viewEvent),this._emitMoveEvent(n,r)});else if(o.type===`polyline`||o.type===`polygon`){let t=St(o);this._updateVertexGraphicLocations(t);let{dxMap:i,dyMap:a}=Ve(n,r,this.view);this._connectedReshapeManager?.translate(i,a,0),this._updateTooltip(this.graphic,e.viewEvent),this._emitMoveEvent(n,r)}this._syncEditGeometryOperations(o)}}_onGraphicMoveStopCallback(e){let t=this._activeOperationInfo;if(!t)return;let{dx:n,dy:r,graphic:i}=e,{operationType:a}=t;t.totalDx+=n,t.totalDy+=r,this._onHandleMove(i,n,r,e,()=>a===`move`?this._emitMoveStopEvent():this._emitReshapeStopEvent(i)),this._isMidpoint(i)||i.getAttribute(G.curveFromStraightEdgeFlag)?this.refresh():(this._updateTooltip(this._isVertex(i)?i:null),this._resetSnappingStateVars(),this._connectedReshapeManager?.finish(),this._activeOperationInfo=null)}_updateVertexGraphicLocations(e){let{_coordinateHelper:t}=this;for(let n of this.vertexGraphics){let{pathIndex:r,pointIndex:i}=n.attributes;n.geometry=t.arrayToPoint(b(e[r][i]))}this._updateMidpointGraphicLocations(e),this._updateCurveGraphicLocations(e)}_updateMidpointGraphicLocations(e){let{_coordinateHelper:t}=this;for(let n of this.midpointGraphics){let{pathIndex:r,pointIndexStart:i,pointIndexEnd:a}=n.attributes,o=e[r];n.geometry=gt(o[i],o[a],t)}}_updateCurveGraphicLocations(e){let{spatialReference:t}=this._coordinateHelper,n=new Map;for(let e of this.selectedManipulators){let[t,r]=$(e);t!=null&&r!=null&&e.getAttribute(G.controlPointKind)&&_e(n,t,()=>new Set)?.add(r)}for(let t of this.curveControlPointGraphics){let[r,i]=$(t);if(n.get(r)?.has(i))continue;let a=e[r][i];if(x(a)||d(a)){let n=b(e[r][i-1]),o=x(a)?m(n,a):s(n,a),[c,l]=k(o,.25);t.geometry=new u({x:c,y:l,spatialReference:this._coordinateHelper.spatialReference})}else if(v(a)){let e=t.getAttribute(G.controlPointKind),[n,r]=e===K.bezier.cp1?a.b[1]:a.b[2];t.geometry=new u({x:n,y:r,spatialReference:this._coordinateHelper.spatialReference})}}for(let n of this.constructionLineGraphics){let r=n.getAttribute(G.controlPointKind),[i,a]=$(n),o=e[i],s=b(o[a-1]),c=b(o[a]),l=e[i][a];r===K.bezier.line1?n.geometry=new z({paths:[[[s[0],s[1]],[...l.b[1]]]],spatialReference:t}):n.geometry=new z({paths:[[[c[0],c[1]],[...l.b[2]]]],spatialReference:t})}}_refreshGraphicIndicesAttributes(e){let{componentIndex:t,vertexIndex:n}=e,r=e=>{let[r,i]=$(e);r===t&&i>=n&&e.setAttribute(G.pointIndex,i+1)};this.vertexGraphics.forEach(r),this.curveControlPointGraphics.forEach(r),this.constructionLineGraphics.forEach(r);for(let e of this.midpointGraphics){if(e.getAttribute(G.pathIndex)!==t)continue;let r=e.getAttribute(G.pointIndexStart);r>=n&&(e.setAttribute(G.pointIndexStart,r+1),e.setAttribute(G.pointIndexEnd,e.getAttribute(G.pointIndexEnd)+1))}}_getVertexFromEditGeometry(e){let[t,n]=$(e);return c(this._editGeometryOperations),this._editGeometryOperations.data.parts[t].vertices[n]}_onHandleMove(e,t,n,r,i){T(this._snappingTask);let a=this._snappingContext;if(!a)return;let o=e.geometry,s=r.type===`graphic-move-stop`;if(o&&be(o))if(this.snappingManager!=null&&this.selectedManipulators.length<2&&!s){let r=this.snappingManager;this._stagedVertex=r.update({point:o,context:a}),this._syncGeometryAfterVertexMove(e,new u(this._stagedVertex),t,n,s),i(),this._snappingTask=S(async c=>{let l=await r.snap({point:o,context:a,signal:c});l.valid&&(this._stagedVertex=l.apply(),this._syncGeometryAfterVertexMove(e,new u(this._stagedVertex),t,n,s),i())})}else{let r=this._stagedVertex==null?o:new u(this._stagedVertex);this._syncGeometryAfterVertexMove(e,r,t,n,s),i()}else i()}_syncGeometryAfterVertexMove(e,t,n,r,i=!1){let a=this._editGeometryOperations?.data.geometry.clone();if(!a)return;let{_coordinateHelper:o}=this,s=o.pointToVector(t),c=this._getVertexFromEditGeometry(e);if(c){let e=o.getZ(s),t=s[0]-c.pos[0],n=s[1]-c.pos[1],r=e==null?0:e-c.pos[2];a.type!==`point`&&a.type!==`mesh`||this._editGeometryOperations?.moveVertices([c],t,n,r),this._connectedReshapeManager?.translate(t,n,r)}if(a.type===`point`)e.geometry=t;else if(a.type===`mesh`)e.geometry=a.centerAt(t);else{if(e!==this.graphic){let i=o.spatialReference,[s,c]=$(e),l=Z(a),u=o.pointToArray(t);this._updateGeometryFromGraphic(e,l,s,c,u,i,a.type===`polygon`),this._isVertex(e)||this._isCurveControlPoint(e)?(l=this._moveRelatedCoordinates(l,e,u),l=this._moveSelectedHandleCoordinates(l,e,n,r,a.type===`polygon`),this._updateMidpointGraphicLocations(l),this._updateCurveGraphicLocations(l)):this._isMidpoint(e)&&this._updateCurveGraphicLocations(l),J(a,l)}this._updateGraphicGeometry(a),this._syncEditGeometryOperations(a),i&&(this._mover?this._mover.updateGeometry(this._mover.graphics.indexOf(e),t):e.geometry=t)}}_syncEditGeometryOperations(e){this._editGeometryOperations?.trySetGeometry(e)||(this._editGeometryOperations=null,this._setUpGeometryHelper())}_moveRelatedCoordinates(e,t,n){let{relatedGraphicIndices:r}=t.attributes,i=this._coordinateHelper.spatialReference;if(!r?.length)return e;for(let a of r){let r=this.vertexGraphics.at(a),[o,s]=$(r);Q(e,o,s,n,i),r.geometry=t.geometry}return e}_moveSelectedHandleCoordinates(e,t,n,r,i){let a=this._coordinateHelper.spatialReference;for(let o of this.selectedManipulators)if(o!==t){let[t,s]=$(o),c=o.getAttribute(G.relatedGraphicIndices),l=Be(o.geometry,n,r,this.view),u=de(l);if(o.geometry=l,this._updateGeometryFromGraphic(o,e,t,s,u,a,i),c?.length)for(let t of c){let n=this.vertexGraphics.at(t),[r,i]=$(n);Q(e,r,i,u,a),n.geometry=l}}return e}_updateGeometryFromGraphic(e,t,n,r,i,a,o){let s=t[n].length-1;this._isCurveControlPoint(e)?wt(t,n,r,[i[0],i[1]],e.getAttribute(G.controlPointKind)):(Q(t,n,r,i,a),o&&(r===0?Q(t,n,s,i,a):r===s&&(t[n][0]=i)))}_onGraphicPointerOverCallback(e){let t=e.graphic;this._hoverGraphic=t;let n=this._isVertex(t);n&&!this._isSelected(t)?t.symbol=this.symbols.vertices.hover:this._isCurveControlPoint(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.controlPoints.hover),this._updateTooltip(n?t:null),this._updateHoverCursor(t)}_onGraphicPointerOutCallback(e){let t=e.graphic;this._hoverGraphic=null,this._isVertex(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.vertices.default),this._isCurveControlPoint(t)&&!this._isSelected(t)&&(t.symbol=this.symbols.controlPoints.default),this.removeHandles(Y),this._updateTooltip()}_handleMidpointClickOrStartMove(e){let{graphic:t}=e,n=this.graphic.geometry;if(n==null||n.type!==`polygon`&&n.type!==`polyline`)return[];let r=n.clone(),i=[],{[G.pathIndex]:a,[G.pointIndexStart]:o,[G.pointIndexEnd]:s}=t.attributes,c=de(t.geometry),l=s===0?o+1:s;t.attributes={[G.tool]:`box`,[G.pathIndex]:a,[G.pointIndex]:l,[G.relatedGraphicIndices]:[]};let u=Z(r),d=u[a][s];if(F(d))if(this.enableCurveOnMidpoint&&e.viewEvent.native.shiftKey){let e=b(u[a][l]);u[a].splice(l,1,{c:[e,[c[0],c[1]]]}),t.setAttribute(G.controlPointKind,K.circle.interior),t.setAttribute(G.curveFromStraightEdgeFlag,!0),this.midpointGraphics.remove(t),this.curveControlPointGraphics.push(t),J(r,u)}else u[a].splice(l,0,c),i.push({coordinates:u[a][l],componentIndex:a,vertexIndex:l});else{let e=b(u[a][o]),t=bt(e,d,.5,this._coordinateHelper);u[a].splice(s,1,...t),i.push({coordinates:b(u[a][l]),componentIndex:a,vertexIndex:l})}return this._updateGraphicGeometry(r),this._syncEditGeometryOperations(r),i}_addToSelection(e){let t=kt(e);for(let e of t)this._isCurveControlPoint(e)?e.symbol=this.symbols.controlPoints.selected:e.symbol=this.symbols.vertices.selected,this.selectedManipulators.add(e),this._updateTooltip(e);this._emitSelectEvent(t)}_removeFromSelection(e,t){if(this._isVertex(e)){let{vertices:n}=this.symbols;e.symbol=t?n.hover:n.default}else if(this._isCurveControlPoint(e)){let{controlPoints:n}=this.symbols;e.symbol=t?n.hover:n.default}this.selectedManipulators.remove(e),this._emitDeselectEvent([e]),this._updateTooltip()}_clearSelection(){let e=this.selectedManipulators.toArray(),{controlPoints:t,vertices:n}=this.symbols;if(e.length>0){for(let r of e)this._isVertex(r)?r.symbol=n.default:this._isCurveControlPoint(r)&&(r.symbol=t.default);this.selectedManipulators.removeAll(),this._emitDeselectEvent(e),this._updateTooltip()}}_keyDownHandler(e){this._activeOperationInfo==null&&ze(e,this.tooltip)||ie.delete.includes(e.key)&&!e.repeat&&this.selectedManipulators.length&&(this._removeVertices(this.selectedManipulators),e.stopPropagation())}_removeVertices(e){let t=this.graphic.geometry,n=this.vertexGraphics.length;if(t==null||t.type!==`polygon`&&t.type!==`polyline`&&t.type!==`multipoint`||t.type===`polygon`&&n<4||t.type===`multipoint`&&n<2||t.type===`polyline`&&n<3)return;let r=this.graphic.clone(),i=t.clone(),a=Z(i),o=[],s=kt(e);for(let e of s){if(this._isCurveControlPoint(e))continue;let{x:t,y:n}=e.geometry;for(let e=0;e<a.length;e++){let r=a[e];for(let i=0;i<r.length;i++){let[s,c]=b(r[i]);if(t===s&&n===c){o.push({coordinates:b(a[e][i]),componentIndex:e,vertexIndex:i}),a[e].splice(Number(i),1);let t=a[e][i];t&&!F(t)&&(a[e][i]=b(t))}}}}if(i.type===`polygon`)a=a.filter(e=>{if(e.length<2)return!1;let[t,n]=b(e[0]),[r,i]=b(e[e.length-1]);return(e.length!==2||t!==r||n!==i)&&(t===r&&n===i||e.push(e[0]),!0)});else if(i.type===`polyline`)for(let e of a)e.length===1&&a.splice(a.indexOf(e),1);J(i,a),this._updateGraphicGeometry(i),this.refresh(),this._emitVertexRemoveEvent(s,r,o)}_isVertex(e){return this.vertexGraphics.includes(e)}_isCurveControlPoint(e){return this.curveControlPointGraphics.includes(e)}_isConstructionLine(e){return this.constructionLineGraphics.includes(e)}_isSelected(e){return(this._isVertex(e)||this.curveControlPointGraphics.includes(e))&&this.selectedManipulators.includes(e)}_isMidpoint(e){return this.midpointGraphics.includes(e)}_updateHoverCursor(e){let t=this._isMidpoint(e)?`copy`:`move`;this.addHandles(this.view.acquireCursor(t,`high`),Y)}_updateTooltip(e,t){let n=null,{graphic:r,view:i,tooltipInfos:a}=this,o=r?.geometry;o?.type===`point`?n=a.movePoint:this._selectedManipulator?n=a.selectedVertex:e===this.graphic?(n=a.translateGraphic,ct(n,i,this._tooltipsContext,t)):e&&this.selectedManipulators.length>1&&(n=a.translateVertices,lt(n,i,o,this._tooltipsContext,t)),this.activeTooltipInfo=n}_updateGraphicGeometry(e){this._updateHandlesOnExternalGeometryChange?.pause(),this.graphic.geometry=e,this._updateHandlesOnExternalGeometryChange?.resume()}_emitMoveStartEvent(e,t){let n={type:`move-start`,mover:this.graphic,dx:e,dy:t};this.emit(`move-start`,n),this.callbacks.onMoveStart?.(n)}_emitMoveEvent(e,t){let n={type:`move`,mover:this.graphic,dx:e,dy:t};this.emit(`move`,n),this.callbacks.onMove?.(n)}_emitMoveStopEvent(e,t){if(e==null||t==null){let n=this._activeOperationInfo;if(!n)return;e=n.totalDx,t=n.totalDy}let n={type:`move-stop`,mover:this.graphic,dx:e,dy:t};this.emit(`move-stop`,n),this.callbacks.onMoveStop?.(n)}_emitReshapeStartEvent(e){let t={type:`reshape-start`,graphic:this.graphic,mover:e,selected:this.selectedManipulators.toArray()};this.emit(`reshape-start`,t),this.callbacks.onReshapeStart?.(t)}_emitReshapeEvent(e){let t={type:`reshape`,graphic:this.graphic,mover:e,selected:this.selectedManipulators.toArray()};this.emit(`reshape`,t),this.callbacks.onReshape?.(t)}_emitReshapeStopEvent(e){let t={type:`reshape-stop`,graphic:this.graphic,mover:e,selected:this.selectedManipulators.toArray()};this.emit(`reshape-stop`,t),this.callbacks.onReshapeStop?.(t)}_emitSelectEvent(e){let t={type:`vertex-select`,added:e};this.emit(`select`,t),this.callbacks.onVertexSelect?.(t)}_emitDeselectEvent(e){let t={type:`vertex-deselect`,removed:e};this.emit(`deselect`,t),this.callbacks.onVertexDeselect?.(t)}_emitVertexAddEvent(e,t,n){let r={type:`vertex-add`,added:e,graphic:this.graphic,oldGraphic:t,vertices:n};this.emit(`vertex-add`,r),this.callbacks.onVertexAdd?.(r)}_emitVertexRemoveEvent(e,t,n){let r={type:`vertex-remove`,removed:e,graphic:this.graphic,oldGraphic:t,vertices:n};this.emit(`vertex-remove`,r),this.callbacks.onVertexRemove?.(r)}_logGeometryTypeError(){a.getLogger(this).error(new t(`reshape:invalid-geometry`,`Reshape operation not supported for the provided graphic. The geometry type is not supported.`))}};function St(e){let t=Z(e.clone());if(e.type===`polygon`)for(let e of t){let t=e[e.length-1];if(!F(t))continue;let n=e[0];n[0]===t[0]&&n[1]===t[1]&&e.length>2&&e.pop()}return t}function Z(e){return e.type===`polygon`?e.curveRings?.slice()??e.rings.slice():e.type===`polyline`?e.curvePaths?.slice()??e.paths.slice():e.points.map(e=>[e])}function Ct(e,t,n,r){let i=e[t][n];if(x(i))i.c[1]=r;else if(d(i)){let i=b(e[t][n]);e[t][n]={c:[i,r]}}}function wt(e,t,n,r,i){switch(i){case K.circle.interior:Ct(e,t,n,r);break;case K.bezier.cp1:e[t][n].b[1]=r;break;case K.bezier.cp2:e[t][n].b[2]=r}}function Tt(e,t){return e<1e-8*t}function Et(e,{cx:t,cy:n,isInvalid:r,thetaStart:i,thetaEnd:a},o,s){let[c,l]=e,[u,d]=o,f=u-c,p=d-l;t-=c,n-=l;let m=s?i>a:i<a,[h,g]=r?[t,n]:m?[-n,t]:[n,-t],[_,v]=[f,p],[y,b]=[h,g],x=_*b-v*y,S=(f**2+p**2)/2;if(Tt(Math.abs(x),S))return[(c+u)/2,(l+d)/2];let[C,w]=[b/x*S,-y/x*S],T=C**2+w**2,[E,D]=[f/2-C,p/2-w];if(Tt(E**2+D**2,T)){let[e,t]=m?[-w,C]:[w,-C];return[e+C+c,t+w+l]}let O=Math.sqrt((C**2+w**2)/(E**2+D**2))*Math.sign(f*h+p*g);return[E*O+C+c,D*O+w+l]}function Dt(e,t,n){let r=we(new z({curvePaths:[[e,t]],spatialReference:n})),{curvePaths:i}=Te(r,n),a=i[0][1];return N(a)?a:p(e,a)}function Q(e,t,n,r,i){let a=e[t][n],o=e[t].at(n+1);if(_t(e,t)){let n=e[t][1];e[t][0]=[...r],e[t][1]={a:[[...r],[...n.a[1]],0,0]};return}if(vt(e,t)){let n=e[t][1],[i,a]=n.a[1],[o,s]=r,c=Math.hypot(o-i,s-a),[l,u]=[o-i,s-a],d=pe(u,l);e[t][0]=[...r],e[t][1]={a:[[...r],[...n.a[1]],0,0,d,c,n.a[6]]};return}let c=b(a);if(F(a))a.splice(0,a.length,...r);else if(v(a))a.b[0].splice(0,a.b[0].length,...r);else if(x(a)||d(a)){let i=b(e[t][n-1]),o=x(a)?m(i,a):s(i,a);e[t].splice(n,1,{c:[[...r],Et(i,o,r,!0)]})}else if(N(a)){a.a[0].splice(0,a.a[0].length,...r);let o=b(e[t][n-1]);a.a=Dt(o,a,i).a}if(o&&!F(o)&&!v(a)){if(x(o)||d(o)){let i=b(o),a=x(o)?m(c,o):s(c,o);e[t].splice(n+1,1,{c:[i,Et(i,a,r,!1)]})}else if(N(o)){let e=b(a);o.a=Dt(e,o,i).a}}}function $({attributes:e}){return[e?.[G.pathIndex]||0,e?.[G.pointIndex]||0]}function Ot({attributes:e}){return`${e?.[G.pathIndex]}-${e?.[G.pointIndex]}`}function kt(e){return e instanceof y?[e]:[...e]}function At(e){let t=e.sourceLayer??e.layer;return Oe(t)?{graphic:e,layer:t}:null}function jt(e){return e.toArray().map(({attributes:e})=>({pathIndex:e[G.pathIndex],vertexIndex:e[G.pointIndex]}))}P([i()],X.prototype,`_activeOperationInfo`,void 0),P([i()],X.prototype,`_connectedReshapeManager`,void 0),P([i()],X.prototype,`_coordinateHelper`,null),P([i()],X.prototype,`_editGeometryOperations`,void 0),P([i()],X.prototype,`_segmentLabels`,void 0),P([i()],X.prototype,`test`,null),P([i()],X.prototype,`_segmentLabelsImportTask`,void 0),P([i()],X.prototype,`_updatingHandles`,void 0),P([i()],X.prototype,`_selectedManipulator`,null),P([i()],X.prototype,`_tooltipsContext`,null),P([i()],X.prototype,`callbacks`,void 0),P([i()],X.prototype,`connectedReshapeProviders`,void 0),P([i()],X.prototype,`enableMidpoints`,void 0),P([i()],X.prototype,`enableCurveOnMidpoint`,void 0),P([i()],X.prototype,`enableMovement`,void 0),P([i()],X.prototype,`enableVertices`,void 0),P([i()],X.prototype,`graphic`,void 0),P([i()],X.prototype,`highlightName`,void 0),P([i()],X.prototype,`highlightsEnabled`,void 0),P([i()],X.prototype,`layer`,void 0),P([i()],X.prototype,`snappingManager`,void 0),P([i({readOnly:!0})],X.prototype,`state`,null),P([i()],X.prototype,`symbols`,void 0),P([i()],X.prototype,`tooltip`,void 0),P([i()],X.prototype,`tooltipInfos`,void 0),P([i()],X.prototype,`activeTooltipInfo`,void 0),P([i({constructOnly:!0})],X.prototype,`automaticAreaMeasurementUtils`,void 0),P([i({constructOnly:!0})],X.prototype,`automaticLengthMeasurementUtils`,void 0),P([i()],X.prototype,`updating`,null),P([i({type:ke})],X.prototype,`sketchOptions`,void 0),P([i({readOnly:!0})],X.prototype,`type`,void 0),P([i({readOnly:!0})],X.prototype,`vertexGraphics`,void 0),P([i({readOnly:!0})],X.prototype,`curveControlPointGraphics`,void 0),P([i({readOnly:!0})],X.prototype,`constructionLineGraphics`,void 0),P([i({readOnly:!0})],X.prototype,`midpointGraphics`,void 0),P([i({readOnly:!0})],X.prototype,`selectedManipulators`,void 0),P([i()],X.prototype,`view`,void 0),X=P([D(`esri.views.draw.support.Reshape`)],X);var Mt=X;export{Mt as default};