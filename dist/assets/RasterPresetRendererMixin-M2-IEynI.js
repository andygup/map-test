import{DT as e,GC as t,MT as n,OT as r,RS as i,_u as a,ax as o,gD as s,gu as c,gw as l,ha as u,hu as d,iE as f,px as p,wx as m}from"./index-ByaFsVj4.js";import{E as h,T as g}from"./RasterSymbolizer-DO1LKErg.js";import{c as _,s as v}from"./RasterJobHandlerMixin-B24rvnQA.js";async function y(e,t,n){let r=d(e),{rasterFunction:s,sourceJSON:l}=t||{},f=s?JSON.stringify(s.rasterFunctionDefinition||s):null,_=a({...r.query,renderingRule:f,f:`json`}),v=c(_,n);e=r.path;let y=l||await i(e,v).then(e=>e.data),b=y.hasRasterAttributeTable?i(`${e}/rasterAttributeTable`,v):null,x=y.hasColormap?i(`${e}/colormap`,v):null,S=y.hasHistograms?i(`${e}/histograms`,v):null,C=y.currentVersion>=10.3?i(`${e}/keyProperties`,v):null,w=y.hasMultidimensions?i(`${e}/multidimensionalInfo`,v):null,T=await Promise.allSettled([b,x,S,C,w]),E=null;if(y.minValues&&y.minValues.length===y.bandCount){E=[];for(let e=0;e<y.minValues.length;e++)E.push({min:y.minValues[e],max:y.maxValues[e],avg:y.meanValues[e],stddev:y.stdvValues[e]})}let D=o.fromJSON(y.extent),O=Math.ceil(D.width/y.pixelSizeX-.1),k=Math.ceil(D.height/y.pixelSizeY-.1),A=m.fromJSON(y.spatialReference||y.extent.spatialReference),j=T[0].status===`fulfilled`?T[0].value?.data:null,M=j?.features?.length?u.fromJSON(j):null,N=T[1].status===`fulfilled`?T[1].value?.data.colormap:null,P=N?.length?N:null,F=T[2].status===`fulfilled`?T[2].value?.data.histograms:null,I=F?.[0]?.counts?.length?F:null,L=T[3].status===`fulfilled`?T[3].value?.data??{}:{},R=T[4].status===`fulfilled`?T[4].value?.data.multidimensionalInfo:null,z=R?.variables?.length?R:null;z&&z.variables.forEach(e=>{e.statistics?.length&&e.statistics.forEach(e=>{e.avg=e.mean,e.stddev=e.standardDeviation}),e.dimensions?.forEach(e=>{e.name!==`StdTime`||e.recurring||e.unit||(e.unit=`ISO8601`)})});let{defaultVariable:B,serviceDataType:V}=y;B&&B!==L.DefaultVariable&&(L.DefaultVariable=B),V?.includes(`esriImageServiceDataTypeVector`)&&!V.includes(L.DataType)&&(L.DataType=V.replace(`esriImageServiceDataType`,``));let H=y.noDataValue;y.noDataValues?.length&&y.noDataValues.some(e=>e!==H)&&(H=y.noDataValues);let U=y.transposeInfo?new h({blockWidth:256,blockHeight:256,pyramidBlockWidth:256,pyramidBlockHeight:256,pyramidScalingFactor:2,compression:`lerc`,origin:new p({x:y.extent.xmin,y:y.extent.ymax,spatialReference:A}),firstPyramidLevel:1,maximumPyramidLevel:Math.max(0,Math.round(Math.log(Math.max(O,k))/Math.LN2-8)),transposeInfo:y.transposeInfo}):void 0;return new g({width:O,height:k,bandCount:y.bandCount,extent:o.fromJSON(y.extent),spatialReference:A,pixelSize:new p({x:y.pixelSizeX,y:y.pixelSizeY,spatialReference:A}),pixelType:y.pixelType.toLowerCase(),statistics:E,attributeTable:M,colormap:P,histograms:I,keyProperties:L,noDataValue:H,multidimensionalInfo:z,storageInfo:U})}function b(e,t,n){return y(e,{sourceJSON:t},n)}function x(e,t,n){return y(e,{rasterFunction:t},n)}function S(e,t){e.attributeTable||(t.hasRasterAttributeTable=!1),e.histograms||(t.hasHistograms=!1),e.colormap||(t.hasColormap=!1),e.multidimensionalInfo||(t.hasMultidimensions=!1)}var C=class extends l(t){constructor(e){super(e),this.name=void 0,this.method=`none`,this.value=void 0,this.bandIds=void 0,this.renderer=void 0}};s([e({type:String,json:{write:{isRequired:!0}}})],C.prototype,`name`,void 0),s([e({type:[`raster-function-template`,`variable`,`none`],json:{write:{isRequired:!0}}}),n({rasterFunctionTemplate:`raster-function-template`,variable:`variable`,none:`none`})],C.prototype,`method`,void 0),s([e({type:String,json:{write:{isRequired:!0}}})],C.prototype,`value`,void 0),s([e({type:[f],json:{write:{isRequired:!0}}})],C.prototype,`bandIds`,void 0),s([e({types:v,json:{write:!0,origins:{"web-scene":{types:_,write:{overridePolicy:e=>({enabled:e&&e.type!==`vector-field`})}}}}})],C.prototype,`renderer`,void 0),C=s([r(`esri.renderers.support.RasterPresetRenderer`)],C);var w=t=>{let n=t,i=class extends n{constructor(){super(...arguments),this.activePresetRendererName=null,this.presetRenderers=null}};return s([e({type:String,json:{name:`layerDefinition.activePresetRendererName`,write:{allowNull:!0}}})],i.prototype,`activePresetRendererName`,void 0),s([e({type:[C],json:{name:`layerDefinition.presetRenderers`,write:!0}})],i.prototype,`presetRenderers`,void 0),i=s([r(`esri.layers.mixins.RasterPresetRendererMixin`)],i),i};export{x as i,S as n,b as r,w as t};