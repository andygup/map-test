const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-CwGU_LIb.js","assets/knowledgeGraphService-DMm7HDLL.js","assets/index-ByaFsVj4.js","assets/index-DiFef-Um.css","assets/Relationship-CJ80l_Hk.js","assets/GPMessage-DmyNBybH.js","assets/networkEnums-DHenpW2q.js"])))=>i.map(i=>d[i]);
import{$p as e,Aa as t,BS as n,Cx as r,Dg as i,Fg as a,Fh as o,Ih as s,Qp as c,Xp as l,Yp as u,_E as d,_x as f,bx as p,ja as m,wg as h,wn as g,wx as _}from"./index-ByaFsVj4.js";import"./ImmutableArray-C3KNQCVd.js";import{$ as v,J as y,K as b,U as x,W as S,Y as C,_ as w,ct as T,k as E,t as D,v as O}from"./Dictionary-CX-Dz5lT.js";import"./shared-C6TPacPS.js";import"./number-CDIvbS1W.js";import{t as k}from"./ArcadePortal-CRblETBT.js";import{t as A}from"./portalUtils-BL2aimFF.js";import{i as j,n as M,r as N,t as P}from"./Relationship-CJ80l_Hk.js";import{t as F}from"./GraphQueryStreaming-DvkpF8XJ.js";var I=null;async function L(e){let n=d.geometryServiceUrl??``;if(!n){i()||await h();for(let t of e)t.container[t.indexer]=a(t.container[t.indexer],_.WGS84);return}let r=e.map(e=>e.container[e.indexer]),o=new m({geometries:r,outSpatialReference:_.WGS84}),s=await t(n,o);for(let t=0;t<s.length;t++){let n=e[t];n.container[n.indexer]=s[t]}}async function R(e,t){let r=new o({portal:e,id:t});return await r.load(),I===null&&(I=await n(()=>import(`./knowledgeGraphService-CwGU_LIb.js`),__vite__mapDeps([0,1,2,3,4,5,6]))),await I.fetchKnowledgeGraph(r.url)}function z(t,n,i,a,o){if(t===null)return null;if(l(t)||c(t))return t;if(y(t)||y(t))return t.toJSDate();if(v(t))return t.toStorageFormat();if(b(t))return t.toStorageString();if(w(t)){let e={};for(let s of t.keys())e[s]=z(t.field(s),n,i,a,o),e[s]instanceof r&&o.push({container:e,indexer:s});return e}if(e(t)){let e=t.map(e=>z(e,n,i,a,o));for(let t=0;t<e.length;t++)e[t]instanceof r&&o.push({container:e,indexer:t});return e}return E(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&n?f(t):t:void 0}function B(e,t){if(!e)return e;if(e.spatialReference.isWGS84&&t.spatialReference.isWebMercator)return p(e);if(e.spatialReference.equals(t.spatialReference))return e;throw new g(t,`WrongSpatialReference`,null)}function V(e,t){if(!e)return null;let n={};for(let r in e)n[r]=H(e[r],t);return n}function H(t,n){return t===null?null:e(t)?t.map(e=>H(e,n)):t instanceof j?{graphTypeName:t.typeName,id:t.id,graphType:`entity`,properties:V(t.properties,n)}:t instanceof N?{graphType:`object`,properties:V(t.properties,n)}:t instanceof P?{graphTypeName:t.typeName,id:t.id,graphType:`relationship`,originId:t.originId??null,destinationId:t.destinationId??null,properties:V(t.properties,n)}:t instanceof M?{graphType:`path`,path:t.path?t.path.map(e=>H(e,n)):null}:E(t)?B(t,n):l(t)||c(t)||u(t)?t:null}function U(t){t.mode===`async`&&(t.functions.knowledgegraphbyportalitem=function(e,n){return t.standardFunctionAsync(e,n,(t,r,i)=>{if(C(i,2,2,e,n),i[0]===null)throw new g(e,`PortalRequired`,n);if(i[0]instanceof k){let t=S(i[1]),n;return n=e.services?.portal?e.services.portal:s.getDefault(),R(A(i[0],n),t)}if(!1===l(i[0]))throw new g(e,`InvalidParameter`,n);let a=S(i[0]);return R(e.services?.portal??s.getDefault(),a)})},t.signatures.push({name:`knowledgegraphbyportalitem`,min:2,max:2}),t.functions.querygraph=function(r,i){return t.standardFunctionAsync(r,i,async(t,a,o)=>{C(o,2,4,r,i);let s=o[0];if(!x(s))throw new g(r,`InvalidParameter`,i);let c=o[1];if(!l(c))throw new g(r,`InvalidParameter`,i);I===null&&(I=await n(()=>import(`./knowledgeGraphService-CwGU_LIb.js`),__vite__mapDeps([0,1,2,3,4,5,6])));let u=null,d=T(o[2],null);if(!(d instanceof D||d===null))throw new g(r,`InvalidParameter`,i);if(d){let e=[];u=z(d,!0,!1,r,e),e=e.filter(e=>!e.container[e.indexer].spatialReference.isWGS84),e.length>0&&await L(e)}let f=T(o[3],!1),p=new F({openCypherQuery:c,bindParameters:u,provenanceBehavior:f?`include`:`exclude`});(s?.serviceDefinition?.currentVersion??11.3)>11.2&&(p.outputSpatialReference=r.spatialReference);let m=(await I.executeQueryStreaming(s,p)).resultRowsStream.getReader(),h=[];try{for(;;){let{done:t,value:n}=await m.read();if(t)break;if(e(n))for(let e of n)h.push(H(e,r));else{let e=[];for(let t of n)e.push(H(n[t],r));h.push(e)}}}catch(e){throw e}return D.convertJsonToArcade(h,O(r),!1,!0)})},t.signatures.push({name:`querygraph`,min:2,max:4}))}export{U as registerFunctions};