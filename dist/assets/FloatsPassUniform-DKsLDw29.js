import{Aw as e,BT as t,ED as n,Hi as r,Hl as i,Jf as a,Jm as o,Km as s,Qm as c,Rl as ee,Rm as te,Ry as l,VT as u,Vm as d,Wm as ne,X as f,Ym as p,Zy as m,b_ as h,cm as g,eh as re,fm as ie,g_ as _,kD as v,om as y,ot as b,qm as x,ww as ae,y_ as oe}from"./index-BN8X5Ryz.js";import{t as S}from"./Uniform-C_fuiTP5.js";import{t as C}from"./NoParameters-BDE7RvXT.js";var w=class extends e{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.OCCLUSION_QUERY_DEBUG_PIXEL=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1,this.FLOW_GLOBAL_SCALE_THRESHOLD=null}};v([t()],w.prototype,`SCENEVIEW_HITTEST_RETURN_INTERSECTOR`,void 0),v([t()],w.prototype,`DECONFLICTOR_SHOW_VISIBLE`,void 0),v([t()],w.prototype,`DECONFLICTOR_SHOW_INVISIBLE`,void 0),v([t()],w.prototype,`DECONFLICTOR_SHOW_GRID`,void 0),v([t()],w.prototype,`LABELS_SHOW_BORDER`,void 0),v([t()],w.prototype,`TEXT_SHOW_BASELINE`,void 0),v([t()],w.prototype,`TEXT_SHOW_BORDER`,void 0),v([t()],w.prototype,`OVERLAY_DRAW_DEBUG_TEXTURE`,void 0),v([t()],w.prototype,`OVERLAY_SHOW_CENTER`,void 0),v([t()],w.prototype,`SHOW_POI`,void 0),v([t()],w.prototype,`OCCLUSION_QUERY_DEBUG_PIXEL`,void 0),v([t()],w.prototype,`TESTS_DISABLE_OPTIMIZATIONS`,void 0),v([t()],w.prototype,`TESTS_DISABLE_FAST_UPDATES`,void 0),v([t()],w.prototype,`DRAW_MESH_GEOMETRY_NORMALS`,void 0),v([t()],w.prototype,`FEATURE_TILE_FETCH_SHOW_TILES`,void 0),v([t()],w.prototype,`FEATURE_TILE_TREE_SHOW_TILES`,void 0),v([t()],w.prototype,`TERRAIN_TILE_TREE_SHOW_TILES`,void 0),v([t()],w.prototype,`I3S_TREE_SHOW_TILES`,void 0),v([t()],w.prototype,`I3S_SHOW_MODIFICATIONS`,void 0),v([t()],w.prototype,`LOD_INSTANCE_RENDERER_DISABLE_UPDATES`,void 0),v([t()],w.prototype,`LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL`,void 0),v([t()],w.prototype,`EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES`,void 0),v([t()],w.prototype,`LINE_WIREFRAMES`,void 0),v([t()],w.prototype,`FLOW_GLOBAL_SCALE_THRESHOLD`,void 0),w=v([u(`esri.views.3d.support.debugFlags`)],w);var T=new w;function E(){return!!n(`enable-feature:objectAndLayerId-rendering`)}var D=class{constructor(e){this.field=e}},se=class extends D{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[0,0,0],this.fallback=[0,0,0]}},O=class extends D{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}},k=class extends D{constructor(e,t=0){super(e),this.fallback=t,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},A=class{};function j(e){return e!=null}function M(e,t){e&&e.push(t)}function N(e,t,n,r=a()){let i=e||0,o=t||0,c=n||0;return i!==0&&re(r,r,-i/180*Math.PI),o!==0&&s(r,r,o/180*Math.PI),c!==0&&x(r,r,c/180*Math.PI),r}function P(e,t,n,i,a){let o=e.minSize,s=e.maxSize;if(e.useSymbolValue){let e=i.symbolSize[n];return t.minSize[n]=e,t.maxSize[n]=e,t.offset[n]=t.minSize[n],t.factor[n]=0,t.type[n]=1,!0}if(j(e.field))return j(e.stops)?e.stops.length===2&&g(e.stops[0].size)&&g(e.stops[1].size)?(F(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,n),t.type[n]=1,!0):(M(a,`Could not convert size info: stops only supported with 2 elements`),!1):g(o)&&g(s)&&j(e.minDataValue)&&j(e.maxDataValue)?(F(o,s,e.minDataValue,e.maxDataValue,t,n),t.type[n]=1,!0):e.valueUnit===`unknown`?(M(a,`Could not convert size info: proportional size not supported`),!1):r[e.valueUnit]==null?(M(a,`Could not convert size info: scale-dependent size not supported`),!1):(t.minSize[n]=-1/0,t.maxSize[n]=1/0,t.offset[n]=0,t.factor[n]=1/r[e.valueUnit],t.type[n]=1,!0);if(!j(e.field)){if(e.stops?.[0]&&g(e.stops[0].size))return t.minSize[n]=e.stops[0].size,t.maxSize[n]=e.stops[0].size,t.offset[n]=t.minSize[n],t.factor[n]=0,t.type[n]=1,!0;if(g(o))return t.minSize[n]=o,t.maxSize[n]=o,t.offset[n]=o,t.factor[n]=0,t.type[n]=1,!0}return M(a,`Could not convert size info: unsupported variant of sizeInfo`),!1}function F(e,t,n,r,i,a){let o=Math.abs(r-n)>0?(t-e)/(r-n):0;i.minSize[a]=o>0?e:t,i.maxSize[a]=o>0?t:e,i.offset[a]=e-n*o,i.factor[a]=o}function I(e,t,n,r){if(e.normalizationField||e.valueRepresentation)return M(r,`Could not convert size info: unsupported property`),null;if(!ie(e.field))return M(r,`Could not convert size info: field is not a string`),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return M(r,`Could not convert size info: multiple fields in use`),null}else t.size.field=e.field}else t.size=new se(e.field),i(t.size.fallback,n.fallbackSize);let a;switch(e.axis){case`width`:return a=P(e,t.size,0,n,r),a?t:null;case`height`:return a=P(e,t.size,2,n,r),a?t:null;case`depth`:return a=P(e,t.size,1,n,r),a?t:null;case`width-and-depth`:return a=P(e,t.size,0,n,r),a&&P(e,t.size,1,n,r),a?t:null;case null:case void 0:case`all`:return a=P(e,t.size,0,n,r),a&&=P(e,t.size,1,n,r),a&&=P(e,t.size,2,n,r),a?t:null;default:return M(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function L(e,t,n){for(let n=0;n<3;++n){let r=t.unitInMeters;e.type[n]===1&&(r*=t.modelSize[n],e.type[n]=2),e.minSize[n]=e.minSize[n]/r,e.maxSize[n]=e.maxSize[n]/r,e.offset[n]=e.offset[n]/r,e.factor[n]=e.factor[n]/r}let r;if(e.type[0]!==0)r=0;else if(e.type[1]!==0)r=1;else{if(e.type[2]===0)return M(n,`No size axis contains a valid size or scale`),!1;r=2}for(let t=0;t<3;++t)e.type[t]===0&&(e.minSize[t]=e.minSize[r],e.maxSize[t]=e.maxSize[r],e.offset[t]=e.offset[r],e.factor[t]=e.factor[r],e.type[t]=e.type[r]);return!0}function R(e,t,n){e[4*t]=n.r/255,e[4*t+1]=n.g/255,e[4*t+2]=n.b/255,e[4*t+3]=n.a}function z(e,t,n,r){if(e.normalizationField)return M(r,`Could not convert color info: unsupported property`),null;if(y(e.field)){if(!e.stops)return M(r,`Could not convert color info: missing stops or colors`),null;{if(e.stops.length>8)return M(r,`Could not convert color info: too many color stops`),null;t.color=new O(e.field);let i=e.stops;for(let e=0;e<8;++e){let n=i[Math.min(e,i.length-1)];t.color.values[e]=n.value,R(t.color.colors,e,n.color)}b(t.color.fallback,n.fallbackColor)}}else{if(!(e.stops&&e.stops.length>=0))return M(r,`Could not convert color info: no field and no colors/stops`),null;{let r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color=new O(null);for(let e=0;e<8;e++)t.color.values[e]=1/0,R(t.color.colors,e,r);b(t.color.fallback,n.fallbackColor)}}return t}function B(e,t,n,r){if(e.normalizationField)return M(r,`Could not convert opacity info: unsupported property`),null;if(y(e.field)){if(!e.stops)return M(r,`Could not convert opacity info: missing stops or opacities`),null;{if(e.stops.length>8)return M(r,`Could not convert opacity info: too many opacity stops`),null;t.opacity=new k(e.field,n.fallbackColor[3]);let i=e.stops;for(let e=0;e<8;++e){let n=i[Math.min(e,i.length-1)];t.opacity.values[e]=n.value,t.opacity.opacityValues[e]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return M(r,`Could not convert opacity info: no field and no opacities/stops`),null;{let r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:n.fallbackColor[3]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=r}}return t}function V(e,t,n){let r=n===2&&e.rotationType===`arithmetic`;t.offset[n]=r?90:0,t.factor[n]=r?-1:1,t.type[n]=1}function H(e,t,n){if(!y(e.field))return M(n,`Could not convert rotation info: field is not a string`),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return M(n,`Could not convert rotation info: multiple fields in use`),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case`tilt`:return V(e,t.rotation,0),t;case`roll`:return V(e,t.rotation,1),t;case null:case void 0:case`heading`:return V(e,t.rotation,2),t;default:return M(n,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}var U=class{constructor({supports:e,modelSize:t,symbolSize:n,unitInMeters:r,anchor:i,scale:a,rotation:o,fallbackColor:s,fallbackSize:c}){this.supports=e,this.modelSize=t??_(),this.symbolSize=n??_(),this.unitInMeters=r??1,this.anchor=i??h(),this.scale=a??_(),this.rotation=o??h(),this.fallbackColor=s??f(),this.fallbackSize=c??_()}};function W(e,t,n){if(!e)return null;let r=e.reduce((e,r)=>{if(!e)return e;if(r.valueExpression)return M(n,`Could not convert visual variables: arcade expressions not supported`),null;switch(r.type){case`size`:return t.supports.size?I(r,e,t,n):e;case`color`:return t.supports.color?z(r,e,t,n):e;case`opacity`:return t.supports.opacity?B(r,e,t,n):null;case`rotation`:return t.supports.rotation?H(r,e,n):e;default:return null}},new A);return!(e.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r?.size&&!L(r.size,t,n)?null:r:null}var G=class{constructor(e,t,n){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=n}};function K(e,t){if(!e||E()||T.TESTS_DISABLE_FAST_UPDATES)return null;let n=W(e.visualVariables,t);return n?new G(n,Y(n,t),!!n.size):null}function ce(e,t,n){if(!t||!e)return!1;let r=e.visualVariables,i=W(t.visualVariables,n);return!!i&&!!(q(r.size,i.size,`size`)&&q(r.color,i.color,`color`)&&q(r.rotation,i.rotation,`rotation`)&&q(r.opacity,i.opacity,`opacity`))&&(e.visualVariables=i,e.materialParameters=Y(i,n),e.requiresShaderTransformation=!!i.size,!0)}function q(e,t,n){if(!!e!=!!t||e&&e.field!==t?.field)return!1;if(e&&n===`rotation`){let n=e,r=t;for(let e=0;e<3;e++)if(n.type[e]!==r.type[e]||n.offset[e]!==r.offset[e]||n.factor[e]!==r.factor[e])return!1}return!0}var J=class extends C{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}};function Y(e,t){let n=new J(e);return n.vvSize&&(n.vvSymbolAnchor=t.anchor,p($),N(t.rotation[2],t.rotation[0],t.rotation[1],$),n.vvSymbolRotationMatrix=n.vvSymbolRotationMatrix||l(),m(n.vvSymbolRotationMatrix,$)),n}function le(e,t,n){if(!e.vvSize)return n;o(Z,n);let r=e.vvSymbolRotationMatrix;return c($,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),te(Z,Z,$),X(Q,e,t),d(Z,Z,Q),ne(Z,Z,e.vvSymbolAnchor),Z}function X(e,t,n){if(!t.vvSize)return ee(e,1,1,1),e;if(Number.isNaN(n[0]))return i(e,t.vvSize.fallback);for(let r=0;r<3;++r){let i=t.vvSize.offset[r]+n[0]*t.vvSize.factor[r];e[r]=ae(i,t.vvSize.minSize[r],t.vvSize.maxSize[r])}return e}function ue(e,t){let n=e==null?0:t.attributes[e];return typeof n==`number`&&isFinite(n)?n:NaN}var Z=a(),Q=oe(),$=a(),de=class extends J{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}},fe=8,pe=class extends S{constructor(e,t,n,r){super(e,`vec4`,1,(t,i,a)=>t.setUniform4fv(e,n(i,a),r),t)}},me=class extends S{constructor(e,t,n,r){super(e,`float`,1,(t,i,a)=>t.setUniform1fv(e,n(i,a),r),t)}};export{U as a,le as c,E as d,T as f,de as i,ue as l,pe as n,K as o,fe as r,ce as s,me as t,X as u};