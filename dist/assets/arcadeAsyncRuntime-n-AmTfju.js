import{CE as e,Lx as t,Sn as n,TD as r,cm as i,dm as a,lm as o,om as s,sm as c,wn as l}from"./index-BN8X5Ryz.js";import{n as u,t as d}from"./arcadeEnvironment-DUP-IKH2.js";import"./ImmutableArray-C3KNQCVd.js";import{A as f,C as p,D as m,G as h,Q as ee,T as g,U as te,X as _,at as v,b as y,ct as b,ft as x,g as S,gt as ne,ht as C,k as w,m as T,mt as re,nt as E,pt as D,s as O,t as k,x as ie,z as A}from"./Dictionary-Db5-uVgu.js";import"./shared-Bq4SQ-mm.js";import"./number-bRvGjlJj.js";import{n as ae}from"./Feature-BbsZTluv.js";import"./memoryEstimations-D_IbKyOk.js";import"./OptimizedGeometry-BQJ7w5VU.js";import"./OptimizedFeatureSet-CLjmRHYn.js";import"./featureConversionUtils-o9-cJXzl.js";import{a as oe,b as se,c as ce,h as le,i as ue,l as de,o as fe,r as pe,s as me,t as he,v as ge,x as j,y as _e}from"./track-BODfZJUP.js";import{a as ve,i as M,n as ye,o as be,r as xe}from"./containerUtils-BDF13TJN.js";import{n as Se}from"./aiServices-ys27uYUv.js";import"./commonProperties-CaHgSHvW.js";import"./WhereClause-CATd9kVz.js";import"./streamLayerUtils-82UmlW-3.js";import"./measures-DjCw0e_k.js";import"./closestPointOnCurve-CwZL45U3.js";import"./functions-CF8wh9R5.js";import"./fieldStats-BspZIJTx.js";import"./ArcadePortal-CBZerHI1.js";import"./Attachment-BDp8KxLR.js";import"./portalUtils-Bs81nDRc.js";import"./operatorsWorkerConnection-DOouwDAw.js";import{t as Ce}from"./geomasync-BbccmgZq.js";var N=()=>e.getLogger(`esri.arcade.arcadeAsyncRuntime`),P=Symbol(`uninitialized`);function F(e){if(e===P)throw new l(null,`InvalidIdentifier`,null)}function I(e){return F(e),e}function L(e,t){let n=d(t);if(e.localScope!==null){let t=e.localScope[n];if(t!==void 0)return{scope:e.localScope,id:n,var:t}}let r=e.globalScope[n];if(r!==void 0)return{scope:e.globalScope,id:n,var:r};throw new l(e,`InvalidIdentifier`,t)}function R(e,t,n=`InvalidIdentifier`){let r=d(t);if(e.localScope!==null){let t=e.localScope[r];if(t!==void 0)return F(t),t.value}let i=e.globalScope[r];if(i!==void 0)return F(i),i.value;throw new l(e,n,t)}var z=function(){};async function B(e,t){let n=[];for(let r=0;r<t.arguments.length;r++)n.push(await G(e,t.arguments[r]));return n}async function V(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await B(e,t))}z.prototype=Object.freeze(Object.create(null));var we=class extends re{constructor(e,t,n,r){super(),this.definition=e,this.context=t,this._params=n,this._locals=r}createFunction(e){return(...t)=>{let n={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,services:this.context.services,abortSignal:this.context.abortSignal,localScope:new z,depthCounter:{depth:e.depthCounter.depth+1},globalScope:this.context.globalScope,track:this.context.track};if(n.depthCounter.depth>64)throw new l(e,`MaximumCallDepth`,null);return H(n,this.definition.body,this._params,this._locals,t,null)}}call(e,t){return W(e,t,(n,r,i)=>{let a={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:new z,abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1},track:e.track};if(a.depthCounter.depth>64)throw new l(e,`MaximumCallDepth`,t);return H(a,this.definition.body,this._params,this._locals,i,t)})}marshalledCall(e,t,n,r){return r(e,t,async(i,a,o)=>{let s={spatialReference:e.spatialReference,services:e.services,globalScope:n.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeZone:e.timeZone??null,interceptor:e.interceptor,localScope:new z,track:e.track};return o=o.map(t=>!y(t)||t instanceof C?t:D(t,e,r)),D(await H(s,this.definition.body,this._params,this._locals,o,t),n,r)})}};async function H(e,t,n,r,i,a){if(n.length!==i.length)throw new l(e,`WrongNumberOfParameters`,a);if(e.localScope!=null){for(let t=0;t<n.length;t++)e.localScope[n[t]]={value:i[t]};for(let t of r)e.localScope[t]=P}let o=await K(e,t);if(o instanceof m)return o.value;if(o===A||o===S)throw new l(e,`UnexpectedToken`,a);return o instanceof v?o.value:o}var U=class e extends ne{constructor(e){super(),this.moduleGlobalContext=e}global(e){let t=d(e);if(this.moduleGlobalContext.exports.has(t))throw new l(null,`ModuleExportNotFound`,null);let n=this.moduleGlobalContext.globalScope[t];if(F(n),y(n.value)&&!(n.value instanceof C)){let e=new C;return e.fn=n.value,e.parameterEvaluator=V,e.context=this.moduleGlobalContext,this.moduleGlobalContext.globalScope[t]={value:e},e}return n.value}setGlobal(e,t){if(y(t))throw new l(null,`AssignModuleFunction`,null);let n=d(e);if(this.moduleGlobalContext.exports.has(n))throw new l(null,`ModuleExportNotFound`,null);this.moduleGlobalContext.globalScope[n]={value:t}}hasGlobal(e){return this.moduleGlobalContext.exports.has(d(e))}static async load(n,r){let{globals:i,exports:a}=se(r),o=new Z;for(let e of i)e in o||(o[e]=P);let s=n.spatialReference??t.WebMercator,c={lrucache:n.lrucache,interceptor:n.interceptor,services:n.services,console:n.console??ut,abortSignal:n.abortSignal??u,timeZone:n.timeZone??null,spatialReference:s,track:null,depthCounter:{depth:1},libraryResolver:new j(n.libraryResolver._moduleSingletons,r.loadedModules),exports:a,localScope:null,globalScope:o};return await Y(c,r),new e(c)}};async function W(e,t,n){return!0===t.preparsed?n(e,null,t.arguments):n(e,t,await B(e,t))}async function G(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case`UpdateExpression`:return await Pe(e,t);case`AssignmentExpression`:return await Fe(e,t);case`TemplateLiteral`:return await nt(e,t);case`Identifier`:return X(e,t);case`MemberExpression`:return await Ge(e,t);case`Literal`:return t.value;case`CallExpression`:return await et(e,t);case`UnaryExpression`:return await Xe(e,t);case`BinaryExpression`:return await Qe(e,t);case`LogicalExpression`:return await $e(e,t);case`ArrayExpression`:return await Ze(e,t);case`ObjectExpression`:return await Te(e,t);case`MemberAccessChainExpression`:return await Ye(e,t);case`SafeMemberExpression`:throw N().error(`SafeMemberExpression outside of MemberAccessChainExpression`),new l(null,`Unrecognized`,t);default:throw r(t),new l(e,`Unrecognized`,t)}}catch(r){throw n(e,t,r)}}async function K(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case`ImportDeclaration`:return await Ve(e,t);case`ExportNamedDeclaration`:return await He(e,t);case`VariableDeclaration`:return await Ue(e,t);case`BlockStatement`:return await Y(e,t);case`FunctionDeclaration`:return await Be(e,t);case`ReturnStatement`:return await ze(e,t);case`IfStatement`:return await Le(e,t);case`ExpressionStatement`:return await Ie(e,t);case`ForStatement`:return await De(e,t);case`WhileStatement`:return await Ee(e,t);case`ForInStatement`:return await Me(e,t);case`ForOfStatement`:return await Ne(e,t);case`BreakStatement`:return A;case`EmptyStatement`:return p;case`ContinueStatement`:return S;default:throw r(t),new l(e,`Unrecognized`,t)}}catch(r){throw n(e,t,r)}}async function Te(e,t){let n=[];for(let r=0;r<t.properties.length;r++){let i=t.properties[r],a=await G(e,i.value);n[r]={key:i.key.type===`Identifier`?i.key.name:await G(e,i.key),value:a}}let r=Object.create(null),i=new Map;for(let a=0;a<n.length;a++){let o=n[a];if(y(o.value))throw new l(e,`NoFunctionInDictionary`,t);if(!1===s(o.key))throw new l(e,`KeyMustBeString`,t);let c=o.key.toString(),u=c.toLowerCase();i.has(u)?c=i.get(u):i.set(u,c),o.value===p?r[c]=null:r[c]=o.value}let a=new k(r);return a.immutable=!1,a}async function Ee(e,t){let n=await G(e,t.test);if(!1===n)return p;if(!0!==n)throw new l(e,`BooleanConditionRequired`,t);for(;!0===n;){let r=await K(e,t.body);if(r===A)break;if(r instanceof m)return r;if(n=await G(e,t.test),!0!==n&&!1!==n)throw new l(e,`BooleanConditionRequired`,t)}return p}async function De(e,t){try{for(t.init!==null&&(t.init.type===`VariableDeclaration`?await K(e,t.init):await G(e,t.init));;){if(t.test!==null){let n=await G(e,t.test);if(!0===e.abortSignal?.aborted)throw new l(e,`Cancelled`,t);if(!1===n)break;if(!0!==n)throw new l(e,`BooleanConditionRequired`,t)}let n=await K(e,t.body);if(n===A)break;if(n instanceof m)return n;t.update!==null&&await G(e,t.update)}return p}catch(e){throw e}}async function q(e,t,n,r,i=`i`){let a=n.length;for(let o=0;o<a;o++){if(i===`k`){if(o>=n.length)throw new l(e,`OutOfBounds`,t);r.scope[r.id]={value:n[o]}}else r.scope[r.id]={value:o};let a=await K(e,t.body);if(a===A)break;if(a instanceof m)return a}return p}async function Oe(e,t,n,r,i=`i`){let a=n.length();for(let o=0;o<a;o++){r.scope[r.id]=i===`k`?{value:n.get(o)}:{value:o};let a=await K(e,t.body);if(a===A)break;if(a instanceof m)return a}return p}async function ke(e,t,n,r){e:for await(let i of await n.queryAll(e.abortSignal))for(let a of i){r.scope[r.id]={value:ae.createFromGraphicLikeObject(a.geometry,a.attributes,n,e.timeZone)};let i=await K(e,t.body);if(i===A)break e;if(i instanceof m)return i}return p}async function Ae(e,t,n,r){for(let i of n.keys()){let a=n.field(i);r.scope[r.id]={value:k.containerEntry(i,a)};let o=await K(e,t.body);if(o===A)break;if(o instanceof m)return o}return p}async function je(e,t,n,r){for(let i of M(n)){let a=be(n,i,e,t);r.scope[r.id]={value:k.containerEntry(i,a)};let o=await K(e,t.body);if(o===A)break;if(o instanceof m)return o}return p}async function Me(e,t){let n=await G(e,t.right);t.left.type===`VariableDeclaration`&&await K(e,t.left);let r=L(e,t.left.type===`VariableDeclaration`?t.left.declarations[0].id:t.left);return o(n)||s(n)?await q(e,t,n,r):E(n)?await Oe(e,t,n,r):n instanceof k||g(n)?await q(e,t,n.keys(),r,`k`):O(n)?await ke(e,t,n,r):f(n)?await q(e,t,M(n),r,`k`):p}async function Ne(e,t){let n=await G(e,t.right);t.left.type===`VariableDeclaration`&&await K(e,t.left);let r=L(e,t.left.type===`VariableDeclaration`?t.left.declarations[0].id:t.left);return o(n)||s(n)?await q(e,t,n,r,`k`):E(n)?await Oe(e,t,n,r,`k`):n instanceof k||g(n)?await Ae(e,t,n,r):O(n)?await ke(e,t,n,r):f(n)?await je(e,t,n,r):p}async function Pe(e,t){let n=t.argument;if(n.type===`CallExpression`)throw new l(e,`NeverReach`,t);if(n.type===`MemberExpression`){let r=await G(e,n.object),a,c;if(!0===n.computed)a=await G(e,n.property);else{if(n.property.type!==`Identifier`)throw new l(e,`Unrecognized`,t);a=n.property.name}if(o(r)){if(!i(a))throw new l(e,`ArrayAccessMustBeNumber`,t);if(a<0&&(a=r.length+a),a<0||a>=r.length)throw new l(e,`OutOfBounds`,t);c=w(r[a]),r[a]=t.operator===`++`?c+1:c-1}else if(r instanceof k){if(!1===s(a))throw new l(e,`KeyAccessorMustBeString`,t);if(!0!==r.hasField(a))throw new l(e,`FieldNotFound`,t,{key:a});c=w(r.field(a)),r.setField(a,t.operator===`++`?c+1:c-1)}else if(r instanceof U){if(!1===s(a))throw new l(e,`ModuleAccessorMustBeString`,t);if(!0!==r.hasGlobal(a))throw new l(e,`ModuleExportNotFound`,t);c=w(r.global(a)),r.setGlobal(a,t.operator===`++`?c+1:c-1)}else{if(!T(r))throw E(r)?new l(e,`Immutable`,t):new l(e,`InvalidParameter`,t);if(!1===s(a))throw new l(e,`KeyAccessorMustBeString`,t);if(!0!==r.hasField(a))throw new l(e,`FieldNotFound`,t,{key:a});c=w(r.field(a)),r.setField(a,t.operator===`++`?c+1:c-1)}return!1===t.prefix?c:t.operator===`++`?c+1:c-1}let r=L(e,n),a=w(I(r.var).value),c=t.operator===`++`?a+1:a-1;return r.scope[r.id]={value:c},!1===t.prefix?a:t.operator===`++`?a+1:a-1}function J(e,t,n,r,i){switch(t){case`=`:return e===p?null:e;case`/=`:return w(n)/w(e);case`*=`:return w(n)*w(e);case`-=`:return w(n)-w(e);case`+=`:return s(n)||s(e)?h(n)+h(e):w(n)+w(e);case`%=`:return w(n)%w(e);default:throw new l(i,`UnsupportedOperator`,r)}}async function Fe(e,t){let n=t.left;if(n.type===`MemberExpression`){let r=await G(e,n.object),a;if(!0===n.computed)a=await G(e,n.property);else{if(n.property.type!==`Identifier`)throw new l(e,`InvalidIdentifier`,t);a=n.property.name}let c=await G(e,t.right);if(o(r)){if(!i(a))throw new l(e,`ArrayAccessMustBeNumber`,t);if(a<0&&(a=r.length+a),a<0||a>r.length)throw new l(e,`OutOfBounds`,t);if(a===r.length){if(t.operator!==`=`)throw new l(e,`OutOfBounds`,t);r[a]=J(c,t.operator,r[a],t,e)}else r[a]=J(c,t.operator,r[a],t,e)}else if(r instanceof k){if(!1===s(a))throw new l(e,`KeyAccessorMustBeString`,t);if(!0===r.hasField(a))r.setField(a,J(c,t.operator,r.field(a),t,e));else{if(t.operator!==`=`)throw new l(e,`FieldNotFound`,t,{key:a});r.setField(a,J(c,t.operator,null,t,e))}}else if(r instanceof U){if(!1===s(a))throw new l(e,`KeyAccessorMustBeString`,t);if(!0!==r.hasGlobal(a))throw new l(e,`ModuleExportNotFound`,t);r.setGlobal(a,J(c,t.operator,r.global(a),t,e))}else{if(!T(r))throw E(r)?new l(e,`Immutable`,t):new l(e,`InvalidParameter`,t);if(!1===s(a))throw new l(e,`KeyAccessorMustBeString`,t);if(!0===r.hasField(a))r.setField(a,J(c,t.operator,r.field(a),t,e));else{if(t.operator!==`=`)throw new l(e,`FieldNotFound`,t,{key:a});r.setField(a,J(c,t.operator,null,t,e))}}return p}let r=L(e,n),a=await G(e,t.right);return r.scope[r.id]={value:J(a,t.operator,t.operator===`=`?null:I(r.var).value,t,e)},p}async function Ie(e,t){let n=await G(e,t.expression);return n===p?p:new v(n)}async function Le(e,t){let n=await G(e,t.test);if(!0===n)return K(e,t.consequent);if(!1===n)return t.alternate===null?p:K(e,t.alternate);throw new l(e,`BooleanConditionRequired`,t)}async function Y(e,t){return Re(e,t,0)}async function Re(e,t,n){if(n>=t.body.length)return p;let r=await K(e,t.body[n]);return r instanceof m||r===A||r===S||n===t.body.length-1?r:Re(e,t,n+1)}async function ze(e,t){if(t.argument===null)return new m(p);let n=await G(e,t.argument);return new m(n)}async function Be(e,t){if(e.localScope!=null)throw N().error(`Function declarations are only valid in global scope.`),new l(e,`NeverReach`,t);let n=d(t.id);if(!(n in e.globalScope))throw N().error(`Function "${n}" not declared.`),new l(e,`NeverReach`,t);let r=ge(t),i=t.params.map(e=>d(e)),a=Array.from(r).filter(e=>!i.includes(e));return e.globalScope[n]={value:new we(t,e,i,a)},p}async function Ve(e,t){let n=L(e,t.specifiers[0].local),r=e.libraryResolver;if(r==null)throw N().error(`Internal error: module loader not initialized`),new l(e,`NeverReach`,t);let i=r.loadLibrary(n.id),a;return r._moduleSingletons?.has(i.uri)?a=r._moduleSingletons.get(i.uri):(a=await U.load(e,i.syntax),r._moduleSingletons?.set(i.uri,a)),n.scope[n.id]={value:a},p}async function He(e,t){return await K(e,t.declaration),p}async function Ue(e,t){for(let n of t.declarations)await We(e,n);return p}async function We(e,t){let n=null;n=t.init===null?null:await G(e,t.init),n===p&&(n=null);let r=L(e,t.id);r.scope[r.id]={value:n}}async function Ge(e,t){return Ke(e,await G(e,t.object),t)}async function Ke(e,t,n){let r=n.computed?await G(e,n.property):n.property.name;return ye(t,r)}async function qe(e,t,n){for(let r of n)switch(r.type){case`MemberExpression`:t=await Ke(e,t,r);break;case`CallExpression`:t=await tt(e,t,r);break;default:throw new l(null,`Unrecognized`,r)}return t}async function Je(e,t,n){let r=n.computed?await G(e,n.property):n.property.name;return ve(t,r)}async function Ye(e,t){let n=_e(t),r=await G(e,n.root);for(let t of n.sections){let n=await Je(e,r,t.checked);if(n==null)return null;r=await qe(e,n,t.unchecked)}return r}async function Xe(e,t){let n=await G(e,t.argument);if(a(n)){if(t.operator===`!`)return!n;if(t.operator===`-`)return-1*w(n);if(t.operator===`+`)return 1*w(n);if(t.operator===`~`)return~w(n);throw new l(e,`UnsupportUnaryOperator`,t)}if(t.operator===`-`)return-1*w(n);if(t.operator===`+`)return 1*w(n);if(t.operator===`~`)return~w(n);throw new l(e,`UnsupportUnaryOperator`,t)}async function Ze(e,t){let n=[];for(let r=0;r<t.elements.length;r++)n.push(await G(e,t.elements[r]));for(let r=0;r<n.length;r++){if(y(n[r]))throw new l(e,`NoFunctionInArray`,t);n[r]===p&&(n[r]=null)}return n}async function Qe(e,t){let n=await G(e,t.left),i=await G(e,t.right);switch(t.operator){case`|`:case`<<`:case`>>`:case`>>>`:case`^`:case`&`:return ie(w(n),w(i),t.operator);case`==`:return b(n,i);case`!=`:return!b(n,i);case`<`:case`>`:case`<=`:case`>=`:return te(n,i,t.operator);case`+`:return s(n)||s(i)?h(n)+h(i):w(n)+w(i);case`-`:return w(n)-w(i);case`*`:return w(n)*w(i);case`/`:return w(n)/w(i);case`%`:return w(n)%w(i);default:throw r(t.operator),new l(e,`UnsupportedOperator`,t)}}async function $e(e,t){let n=await G(e,t.left);if(!a(n))throw new l(e,`LogicalExpressionOnlyBoolean`,t);switch(t.operator){case`||`:{if(!0===n)return n;let r=await G(e,t.right);if(a(r))return r;throw new l(e,`LogicExpressionOrAnd`,t)}case`&&`:{if(!1===n)return n;let r=await G(e,t.right);if(a(r))return r;throw new l(e,`LogicExpressionOrAnd`,t)}default:throw r(t.operator),new l(e,`LogicExpressionOrAnd`,t)}}function X(e,t){return R(e,t)}async function et(e,t){return tt(e,t.callee.type===`Identifier`?R(e,t.callee,`FunctionNotFound`):await G(e,t.callee),t)}async function tt(e,t,n){if(y(t))return t.call(e,n);throw new l(e,`CallNonFunction`,n)}async function nt(e,t){let n=``,r=0;for(let i of t.quasis)if(n+=i.value?i.value.cooked:``,!1===i.tail){if(t.expressions[r]){let i=await G(e,t.expressions[r]);if(y(i))throw new l(e,`NoFunctionInTemplateLiteral`,t);n+=h(i)}r++}return n}async function rt(e,t){_(t.arguments===null?[]:t.arguments,3,3,e,t);let n=await G(e,t.arguments[0]);if(!1===a(n))throw new l(e,`BooleanConditionRequired`,t);return G(e,n?t.arguments[1]:t.arguments[2])}async function it(e,t){_(t.arguments===null?[]:t.arguments,2,3,e,t);let n=await G(e,t.arguments[0]);if(t.arguments.length===3){let r=await G(e,t.arguments[1]),i=xe(n,r);return i!=null&&i!==``?i:G(e,t.arguments[2])}return n==null||n===``?G(e,t.arguments[1]):n}async function at(e,t){if(t.arguments.length<2)throw new l(e,`WrongNumberOfParameters`,t);if(t.arguments.length===2)return G(e,t.arguments[1]);if((t.arguments.length-1)%2==0)throw new l(e,`WrongNumberOfParameters`,t);return ot(e,t,1,await G(e,t.arguments[0]))}async function ot(e,t,n,r){let i=await G(e,t.arguments[n]);if(b(i,r))return G(e,t.arguments[n+1]);let a=t.arguments.length-n;return a===1?G(e,t.arguments[n]):a===2?null:a===3?G(e,t.arguments[n+2]):ot(e,t,n+2,r)}async function st(e,t){if(t.arguments.length<3||t.arguments.length%2==0)throw new l(e,`WrongNumberOfParameters`,t);let n=await G(e,t.arguments[0]);if(!1===a(n))throw new l(e,`BooleanConditionRequired`,t.arguments[0]);return ct(e,t,0,n)}async function ct(e,t,n,r){if(!0===r)return G(e,t.arguments[n+1]);if(t.arguments.length-n===3)return G(e,t.arguments[n+2]);let i=await G(e,t.arguments[n+2]);if(!1===a(i))throw new l(e,`ModuleExportNotFound`,t.arguments[n+2]);return ct(e,t,n+2,i)}function lt(){let e=Object.create(null);ce(e,V),pe(e,V),me(e,V,X),oe(e,V),fe(e,V),ue(e,V),he(e,V),Ce({functions:e,compiled:!1,signatures:null,evaluateIdentifier:null,mode:`async`,standardFunction:V,standardFunctionAsync:W}),e.iif=rt,e.defaultvalue=it,e.decode=at,e.when=st;let t=function(){this.textformatting={value:k.textFormatting()}};t.prototype=Object.create(null),t.prototype.infinity=Object.freeze({value:1/0}),t.prototype.pi=Object.freeze({value:Math.PI});for(let[n,r]of Object.entries(e))t.prototype[n]=Object.freeze({value:new x(r)});return t}var Z=lt();function Q(e){let t={mode:`async`,compiled:!1,functions:Object.create(null),signatures:[],standardFunction:V,standardFunctionAsync:W,evaluateIdentifier:X};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(let[e,n]of Object.entries(t.functions))Z.prototype[e]=Object.freeze({value:new x(n)});for(let e=0;e<t.signatures.length;e++)le(t.signatures[e],`async`)}function ut(e){console.log(e)}function $(e,n){let r=new Set(Object.keys(n?.vars||{}).map(e=>d(e))),i=new Set(Object.keys(n?.customfunctions||{}).map(e=>d(e))),{globals:a,exports:o}=se(e);return async n=>{let s=n.spatialReference??t.WebMercator,d=null;e.usesModules&&(d=new j(new Map,e.loadedModules));let f=new Z;for(let e of i)n.customfunctions!=null&&e in n.customfunctions?f[e]={value:new x(n.customfunctions[e])}:f[e]=P;for(let e of r){if(n.vars==null||!(e in n.vars)){e in f||(f[e]=P);continue}let t=n.vars[e]??null;c(t)?f[e]={value:ae.createFromGraphic(t,n.timeZone??null)}:f[e]={value:t}}for(let e of a)e in f||(f[e]=P);let p={lrucache:n.lrucache,interceptor:n.interceptor,services:n.services,console:n.console??ut,abortSignal:n.abortSignal??u,timeZone:n.timeZone??null,spatialReference:s,track:n.track,depthCounter:{depth:1},libraryResolver:d,exports:o,localScope:null,globalScope:f},h=await Y(p,e);if(h instanceof m||h instanceof v){let e=h.value;if(ee(e))return null;if(y(e))throw new l(p,`IllegalResult`,null);return e}if(ee(h))return null;throw h===A||h===S?new l(p,`IllegalResult`,null):new l(p,`NeverReach`,null)}}function dt(e,t){return $(e,t)(t)}Q([de]),Q([Se]);export{dt as executeScript,Q as extend,$ as prepareScript};