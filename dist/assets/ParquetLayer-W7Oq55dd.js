import{A as e,AT as t,Ai as n,BT as r,C as i,Dh as a,Di as o,FT as s,Ha as c,Hp as l,Jf as u,L as d,Mi as f,O as p,P as ee,Pn as m,QS as h,Qf as g,R as _,S as v,T as te,U as ne,Ui as re,Vh as ie,Zf as y,_ as b,ax as x,ba as S,ca as C,eT as w,gD as T,gw as E,ha as D,iv as O,jT as k,mp as A,nv as j,pD as M,rd as N,ta as P,uE as F,ua as I,ud as L,vE as R,wx as z,xa as B,ya as V,zT as H}from"./index-CzMixifc.js";import"./QueueProcessor-CbN5H2eO.js";import"./bundle-BKXzeEhA.js";import"./locationUtils-BbkV23gz.js";import{a as U,i as W,o as G,s as K,t as q}from"./parquetUtils-Pl3_C6jO.js";import"./parquet-D6PJ83vk.js";var J=Symbol(`isParquetGraphicOrigin`),Y,ae=class extends S{get[(Y=J,u)](){return this.layer}get[y](){return this.layer}get[B](){return this.layer}constructor(e){super(),this[Y]=!0,this.type=`parquet`,this.layer=e}get id(){return this.layer.id}},X=class extends ie{constructor(e){super(e),this.type=`parquet`}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._initialize(t)),Promise.resolve(this)}destroy(){this._connection?.destroy()}setCustomParameters(e){this._proxy.setCustomParameters(e).catch(()=>{F.getLogger(this).warn(`Failed to update customParameters`)})}async updateFiles(e){await this._proxy.updateFiles(e)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._proxy.queryFeatures(e.toJSON(),{signal:t?.signal})}async queryFeatures(e,t={}){let n=await this.queryFeaturesJSON(e,{signal:t?.signal});return D.fromJSON(n)}async queryObjectIds(e,t){return await this._proxy.queryObjectIds(e.toJSON(),{signal:t?.signal})}async queryFeatureCount(e,t){return this._proxy.queryFeatureCount(e.toJSON(),{signal:t?.signal})}async queryExtent(e,t){if(this.layer.geometryEncoding==null)return F.getLogger(this).warn(`Tried to queryExtent, but source does not have a geometry. Returning null extent.`),{count:0,extent:null};let n=await this._proxy.queryExtent(e.toJSON(),{signal:t?.signal});return{count:n.count,extent:x.fromJSON(n.extent)}}async _initialize(e){this._connection=await V(`ParquetSourceWorker`,{strategy:`dedicated`,signal:e,registryTarget:this}),w(e),this._proxy=this._connection.createInvokeProxy();let{layerDefinition:t,capabilities:n}=await this._proxy.load({urls:this.layer.urls.items,fields:this.layer.fields?.map(e=>e.toJSON()),geometryType:this.layer.geometryType?W(this.layer.geometryType):null,spatialReference:this.layer.spatialReference?.toJSON(),geometryEncoding:this.layer.geometryEncoding?.toJSON(),displayOptimization:this.layer.displayOptimization,customParameters:this.layer.customParameters});w(e),this.sourceJSON=t,this.capabilities=n}};T([H()],X.prototype,`type`,void 0),T([H({constructOnly:!0})],X.prototype,`layer`,void 0),T([H()],X.prototype,`sourceJSON`,void 0),T([H()],X.prototype,`capabilities`,void 0),X=T([s(`esri.layers.graphics.sources.ParquetSource`)],X);var Z=i(),Q=`__OBJECTID`,oe={types:{key:`type`,base:K,typeMap:{wkb:U,location:G}},json:{name:`layerDefinition.geometryEncoding`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:`geometryEncoding`}}}}},$=class extends P(_(re(I(ee(p(e(d(c(C(E(a))))))))))){constructor(e){super(e),this.copyright=null,this.displayOptimization=null,this.fields=null,this.fieldsIndex=null,this.geometryEncoding=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ae(this),this.labelsVisible=!0,this.labelingInfo=null,this.objectIdField=Q,this.operationalLayerType=`ParquetLayer`,this.outFields=null,this.persistenceEnabled=!!M(`parquetlayer-persistence-enabled`),this.popupTemplate=null,this.source=null,this.spatialReference=null,this.templates=null,this.title=`Parquet`,this.type=`parquet`,this.urls=new O}destroy(){this.source?.destroy()}async load(e){return this.addResolvingPromise(this._load(e)),this.addHandles([j(()=>this.urls,e=>this.source?.updateFiles(e.items)),j(()=>this.customParameters,e=>this.source?.setCustomParameters(e))]),this}get capabilities(){return this.source?.capabilities}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,n,r){let i=e.filter(e=>!(e.name===Q&&e.type===`oid`)).map(e=>e.toJSON(r));R(n,i,t)}get isTable(){return this.geometryEncoding==null}set renderer(e){l(e,this.fieldsIndex),this._set(`renderer`,e)}readUrls(e){return new O(e.type===`files`?e.urls:[])}writeUrls(e,t,n,i){let a=[];if(e?.length){i={blockedRelativeUrls:i?.blockedRelativeUrls};for(let t of e)t=h(t,i),t&&a.push(t)}a.length?t.source={type:`files`,urls:a}:i.messages?.push(new r(`parquet-layer:missing-urls`,`Missing or empty 'urls'`,{layer:this}))}createPopupTemplate(e){return b(this,e)}createQuery(){let e=new N;return e.returnGeometry=!0,e.outFields=[`*`],e}async createSource(e){let t=new X({layer:this});return await t.load(e),t}getFieldDomain(e,t){return null}getField(e){return this.fieldsIndex.get(e)}async queryFeatures(e,t){await this.load();let n=await this.source.queryFeatures(this._normalizeQuery(e),t),r=this.graphicOrigin;if(n?.features)for(let e of n.features)e.layer=e.sourceLayer=this,e.origin=r;return n}async queryObjectIds(e,t){return await this.load(),this.source.queryObjectIds(this._normalizeQuery(e),t)}async queryFeatureCount(e,t){return await this.load(),this.source.queryFeatureCount(this._normalizeQuery(e),t)}async queryExtent(e,t){return await this.load(),this.source.queryExtent(this._normalizeQuery(e),t)}_normalizeQuery(e){return N.from(e)??this.createQuery()}async _load(e){let t=await this.createSource(e);this._set(`source`,t),this.read(t.sourceJSON,{origin:`service`}),this.revert([`fields`,`timeInfo`],`service`),l(this.renderer,this.fieldsIndex),A(this.timeInfo,this.fieldsIndex),this.spatialReference??=z.WGS84}};T([H({readOnly:!0,json:{read:!1,write:!1}})],$.prototype,`capabilities`,null),T([H({type:String})],$.prototype,`copyright`,void 0),T([H({readOnly:!0})],$.prototype,`defaultPopupTemplate`,null),T([H()],$.prototype,`displayOptimization`,void 0),T([H({type:[L],json:{name:`layerDefinition.fields`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`fields`}}}})],$.prototype,`fields`,void 0),T([t(`fields`)],$.prototype,`writeFields`,null),T([H(Z.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),T([H(oe)],$.prototype,`geometryEncoding`,void 0),T([H({type:x,json:{name:`extent`}})],$.prototype,`fullExtent`,void 0),T([H({type:q.apiValues,json:{name:`layerDefinition.geometryType`,read:{reader:q.read},write:{writer:q.write,ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:`geometryType`,reader:q.read}}}}})],$.prototype,`geometryType`,void 0),T([H({readOnly:!0,clonable:!1})],$.prototype,`graphicOrigin`,void 0),T([H(f)],$.prototype,`labelsVisible`,void 0),T([H({type:[m],json:{name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:v},write:!0}})],$.prototype,`labelingInfo`,void 0),T([H(o)],$.prototype,`legendEnabled`,void 0),T([H()],$.prototype,`file`,void 0),T([H({type:String,readOnly:!0})],$.prototype,`objectIdField`,void 0),T([H({type:[`ParquetLayer`]})],$.prototype,`operationalLayerType`,void 0),T([H(Z.outFields)],$.prototype,`outFields`,void 0),T([H(n)],$.prototype,`popupEnabled`,void 0),T([H({type:g,json:{name:`popupInfo`,write:!0}})],$.prototype,`popupTemplate`,void 0),T([H({types:ne,json:{name:`layerDefinition.drawingInfo.renderer`,write:!0,origins:{service:{read:{source:`drawingInfo.renderer`}}}}})],$.prototype,`renderer`,null),T([H({type:X,readOnly:!0,cast:null,json:{read:!1}})],$.prototype,`source`,void 0),T([H({type:z,json:{name:`layerDefinition.spatialReference`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{read:{source:`extent.spatialReference`}}}}})],$.prototype,`spatialReference`,void 0),T([H({type:[te]})],$.prototype,`templates`,void 0),T([H()],$.prototype,`title`,void 0),T([H({json:{read:!1},readOnly:!0})],$.prototype,`type`,void 0),T([H({type:O.ofType(String),json:{name:`source`,write:{isRequired:!0,ignoreOrigin:!0}}})],$.prototype,`urls`,void 0),T([k(`urls`)],$.prototype,`readUrls`,null),T([t(`urls`)],$.prototype,`writeUrls`,null),$=T([s(`esri.layers.ParquetLayer`)],$);var se=$;export{se as default};