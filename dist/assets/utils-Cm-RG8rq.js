import{BT as e,K as t,Mh as n,TS as r,Up as i,Vp as a,bS as o,ig as s,px as c,q as l,wx as u}from"./index-CzMixifc.js";import{h as d,n as f}from"./utils-nAxNAb0W.js";import{s as p}from"./quantizationUtils-CzrQVcZ1.js";import{i as m}from"./utils-BUI45WL8.js";var h=null,g=/^(?<hh>([01][0-9])|(2[0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?(\.(?<ms>\d+))?$/;function _(e,t,n){return e.x<0?e.x+=t:e.x>n&&(e.x-=t),e}function v(e,t,n,i){let a=r(n)?o(n):null,s=a?Math.round((a.valid[1]-a.valid[0])/t.scale[0]):null;return e.map(e=>{let n=new c(e.geometry);return p(t,n,n),e.geometry=a?_(n,s??0,i[0]):n,e})}function y(e,n=18,r,i,a){let o=new Float64Array(i*a);n=Math.round(s(n));let c=1/0,u=-1/0,d=l(r);for(let{geometry:r,attributes:s}of e){let{x:e,y:l}=r,f=Math.max(0,e-n),p=Math.max(0,l-n),m=Math.min(a,l+n),h=Math.min(i,e+n),g=+d(s);for(let r=p;r<m;r++)for(let a=f;a<h;a++){let s=r*i+a,d=t(a-e,r-l,n)*g,f=o[s]+=d;c=Math.min(c,f),u=Math.max(u,f)}}return{min:c,max:u}}function b(e){let t=g.exec(e);if(!t)return null;let{hh:r,mm:i,ss:a,ms:o}=t.groups;return Number(r)*n.hours+Number(i)*n.minutes+Number(a)*n.seconds+Number(o||0)}async function x(e,t,n=!0){if(!t)return[];let{field:r,field2:o,field3:s,fieldDelimiter:c,fieldInfos:l,timeZone:p}=e,g=r&&l?.find(e=>e.name.toLowerCase()===r.toLowerCase()),_=!!g&&a(g),v=!!g&&m(g),y=e.valueExpression,x=e.normalizationType,S=e.normalizationField,C=e.normalizationTotal,w=[],T=e.viewInfoParams,E=null,D=null;if(y){if(!h){let{arcadeUtils:e}=await i();h=e}h.hasGeometryOperations(y)&&await h.enableGeometryOperations(),E=h.createFunction(y),D=T?h.getViewInfo({viewingMode:T.viewingMode,scale:T.scale,spatialReference:new u(T.spatialReference)}):null}let O=e.fieldInfos,k=!(t[0]&&`declaredClass`in t[0]&&t[0].declaredClass===`esri.Graphic`)&&O?{fields:O}:null;return t.forEach(e=>{let t=e.attributes,i;if(y){let t=k?Object.assign({},e,{layer:k}):e,n=h.createExecContext(t,D,p);i=h.executeFunction(E,n)}else t&&(i=t[r],o?(i=`${d(i)}${c}${d(t[o])}`,s&&(i=`${i}${c}${d(t[s])}`)):typeof i==`string`&&n&&(v?i=i?new Date(i).getTime():null:_&&(i=i?b(i):null)));if(x&&typeof i==`number`&&isFinite(i)){let e=t&&parseFloat(t[S]);i=f(i,x,e,C)}w.push(i)}),w}function S(e){let t=e.field,n=e.normalizationType,r=e.normalizationField,i;return n===`field`?i=`(NOT `+r+` = 0)`:n!==`log`&&n!==`natural-log`&&n!==`square-root`||(i=`(${t} > 0)`),i}function C(e,t,n){let r=t==null?``:e+` >= `+t,i=n==null?``:e+` <= `+n,a=``;return a=r&&i?w(r,i):r||i,a?`(`+a+`)`:``}function w(e,t){let n=e??``;return t!=null&&t&&(n=n?`(`+n+`) AND (`+t+`)`:t),n}function T(t,n){if(t&&t.spatialRelationship!==`intersects`)return new e(n,`Only 'intersects' spatialRelationship is supported for featureFilter`)}function E(t,n,r){let i=D({layer:t,fields:n});if(i.length)return new e(r,`Unknown fields: `+i.join(`, `)+`. You can only use fields defined in the layer schema`);let a=O({layer:t,fields:n});return a.length?new e(r,`Unsupported fields: `+a.join(`, `)+`. You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true`):void 0}function D(e){let t=e.layer;return e.fields.filter(e=>!t.getField(e))}function O(e){let t=e.layer;return e.fields.filter(e=>{let n=t.getFieldUsageInfo(e);return!n||!n.supportsStatistics})}export{E as a,y as c,C as i,v as l,x as n,w as o,T as r,b as s,S as t};