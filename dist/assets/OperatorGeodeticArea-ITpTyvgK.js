import{AD as e,DD as t}from"./index-BN8X5Ryz.js";import{At as n,Ct as r,Gt as i,Ut as a,X as o,cn as s,in as c,kt as l,ln as u,mn as d,nt as f,r as p,s as m,st as h,u as g,vn as _,x as v,z as y}from"./Point2D-DJueHbCy.js";import{t as b}from"./Envelope2D-B7gkUj4e.js";import{$t as x,Bt as S,Dt as C,Gt as w,In as T,Mt as E,N as D,Q as O,Un as k,Z as A,Zt as ee,a as j,cn as M,en as N,ft as P,hn as F,k as I,l as L,n as R,o as z,r as B,st as V,u as H,ut as U,yn as W}from"./SpatialReference-CfUjvF_j.js";import{t as G}from"./Transformation2D-D07KwcEj.js";import"./SimpleGeometryCursor-BILtMaQf.js";import"./OperatorDefinitions-C5Pat-Jx.js";import"./Distance2DCalculator-CXhBP-8I-CYkwuMp9.js";import{t as K}from"./OperatorShapePreservingLength-Dnrus2Ak.js";import"./OperatorGeodeticDensifyByLength-BigA435W.js";import{t as q}from"./GeodeticDistanceCalculator-Ce-woMPw-B1BBTw6f.js";var te=class{constructor(e,t,n,r,i=100){this.m_startPt=e.clone(),this.m_endPt=t.clone(),this.m_cE2=r,this.m_cE=Math.sqrt(this.m_cE2),this.m_c1By2e=1/(2*this.m_cE),this.m_cRpu=n.getGCS().getUnit().getUnitToBaseFactor(),this.isPcs=n.getCoordinateSystemType()===2,this.PEProjcs=n.getPECoordSys(),this.m_points=h(2*i,NaN)}setSegmentEndPoints(e,t){this.m_startPt.assign(e),this.m_endPt.assign(t)}makeFunctor(){return e=>{let t=[0,0];t[0]=this.m_startPt.x*(1-e)+this.m_endPt.x*e,t[1]=this.m_startPt.y*(1-e)+this.m_endPt.y*e,this.isPcs&&w.projToGeogCenter(this.PEProjcs,1,t,0);let n=Math.sin(t[1]*this.m_cRpu);return this.m_cE2===0?n:-Math.log((1-this.m_cE*n)/(1+this.m_cE*n))*this.m_c1By2e+n/(1-this.m_cE2*n*n)}}};function ne(e,t,r){let i=new b;e.queryEnvelope(i);let a=k(t,i,!0).total(),o=t.getPannableExtent();o.xmin=i.xmin-10*a,o.xmax=i.xmax+10*a;let s=new N().execute(e,o,t,r).getImpl().querySegmentIterator();s.stripAttributes();let c=L();t.querySpheroidData(c);let u=c.e2,d=u===0?2:1,f=new l(0,0),p=new l(0,0),m=new n(0),h=new te(f,p,t,u,100);for(;s.nextPath();)for(;s.hasNextSegment();){let e=s.nextSegment();f.assign(e.getStartXY()),p.assign(e.getEndXY()),h.setSegmentEndPoints(f,p);let t=M(6,0,1,1e-12,1e-15,h.makeFunctor());m.pe((p.x-f.x)*t)}let g=c.majorSemiAxis;return d*g*g*(1-u)*Math.PI*m.getResult()/t.getPannableExtent().width()}function J(e,t,n,r,i){let a=ae(e,t,i),o=Y(e,a.first,n,r,i),s=1,c=0,l=0;do{if(s++,a.first*=.5,a.first<50*t.getTolerance(0))return o;a.second*=2,l=Y(e,a.first,n,r,i),c=Math.abs(l-o),o=l}while(Math.abs(o)>1&&c>1e-8*Math.abs(o)&&(a.second<65e3&&s<8||s<4));return l}function Y(e,t,n,r,i){let a=new x().execute(e,t,0,0,i),o;o=r?new E().execute(a,r,i):a;let s=n.getUnit().getUnitToBaseFactor()===1?Math.PI/180:1,c=new b;o.queryEnvelope(c);let l=new b,u=new b,d=new b;l.setCoords({xmin:c.xmin,ymin:75*s,xmax:c.xmax,ymax:90*s}),u.setCoords({xmin:c.xmin,ymin:-60*s,xmax:c.xmax,ymax:75*s}),d.setCoords({xmin:c.xmin,ymin:-90*s,xmax:c.xmax,ymax:-60*s}),l.inflateCoords(.01*l.width(),0),u.inflateCoords(.01*u.width(),0),d.inflateCoords(.01*d.width(),0);let f=0;return f+=X(o,l,n,i),f+=X(o,u,n,i),f+=X(o,d,n,i),f}function X(e,t,n,r){let i=new N().execute(e,t,n,r);if(i!==null&&!i.isEmpty()){let e=new b;i.queryEnvelope(e);let{first:t,second:a}=ie(n,e,!1),o=D(n,t,null),s=new E().execute(i,o,r).calculateArea2D();return a&&t.destroy(),s}return 0}var Z=[null,null,null,null,null,null,null];function re(e,t,n){let r=e.getUnit().getUnitToBaseFactor(),i=t.getCenter();i.scale(180*r/Math.PI);let a=new l;a.x=0,a.y=0;let o=0;if(o===0){i.y>45?(a.y=f,o=0):i.y<-45?(a.y=-f,o=1):i.x>=45&&i.x<135?(a.x=f,o=2):i.x>=135||i.x<-135?(a.x=f,o=3):i.x<-45&&i.x>=-135?(a.x=-f,o=4):(a.x=0,o=5);let e=r*Math.sqrt(v(t.xmin-t.xmax)+v(t.ymin-t.ymax)),n=a.clone(),s=t.getCenter();if(s.scale(r),o<2&&(n.x=s.x),l.distance(n,s)+.5*e>f)return null}let s=Z[o];if(s!==null&&s.getGCS().equalHorizontal(e))return s;let c=e.getText(),d=a.x,p=a.y,m=0,h=-1;o===6?(_(n),m=0,h=V.PE_PRJ_CYLINDRICAL_EQAREA):h=V.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA;let g=S(`EqualAreaPCS`),y;h===V.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?y=`PROJCS["${g}",${c},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",0],PARAMETER["False_Northing",0],PARAMETER["Central_Meridian",${d}],PARAMETER["Latitude_of_Origin",${p}],UNIT["Meter",1.0]]`:h===V.PE_PRJ_CYLINDRICAL_EQAREA?y=`PROJCS["${g}",${c},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",0],PARAMETER["False_Northing",0],PARAMETER["Central_Meridian",${d}],PARAMETER["Standard_Parallel_1",${m}],PARAMETER["Latitude_of_Origin",${p}],UNIT["Meter",1.0]]`:u(`getEqualAreaPcsFixed`);let b=A(y);return Z[o]&&Z[o].destroy(),Z[o]=b,b}function ie(e,t,n){let r=re(e,t,n);if(r!==null)return p(r,!1);let i=e.getText(),a=e.getUnit().getUnitToBaseFactor(),o=(t.xmin+t.width()/2)*a,s=(t.ymin+t.height()/2)*a,c=0,l=0,d=-1;t.ymin*a>=75*Math.PI/180||t.ymax*a<=-60*Math.PI/180?d=V.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA:t.ymin>0||t.ymax<0?(c=(t.ymin+1/3*t.height())*a,l=(t.ymin+2/3*t.height())*a,d=V.PE_PRJ_ALBERS):(c=(t.ymin+2/3*t.height())*a,d=V.PE_PRJ_CYLINDRICAL_EQAREA);let f=S(`EqualAreaPCS`),m;return d===V.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA?m=`PROJCS["${f}",${i},PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",0],PARAMETER["False_Northing",0],PARAMETER["Central_Meridian",${o}],PARAMETER["Latitude_of_Origin",${s}],UNIT["Meter",1.0]]`:d===V.PE_PRJ_ALBERS?m=`PROJCS["${f}",${i},PROJECTION["Albers"],PARAMETER["False_Easting",0],PARAMETER["False_Northing",0],PARAMETER["Central_Meridian",${o}],PARAMETER["Standard_Parallel_1",${c}],PARAMETER["Standard_Parallel_2",${l}],PARAMETER["Latitude_of_Origin",${s}],UNIT["Meter",1.0]]`:d===V.PE_PRJ_CYLINDRICAL_EQAREA?m=`PROJCS["${f}",${i},PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting",0],PARAMETER["False_Northing",0],PARAMETER["Central_Meridian",${o}],PARAMETER["Standard_Parallel_1",${c}],PARAMETER["Latitude_of_Origin",${s}],UNIT["Meter",1.0]]`:u(`getEqualAreaPCSInstance`),p(A(m),!0)}function ae(e,t,n){let r=e.calculateLength2D(),i=new K().execute(e,t,n)/25e3,a=r/e.getSegmentCount()*2,o=Math.min(a,r/i);return o===0&&(o=1),p(o,r/o)}var oe=class{getOperatorType(){return 10314}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}execute(e,t,n){if(t.getCoordinateSystemType()===0&&c(``),e.isEmpty()||e.getDimension()<2)return 0;if(d(e),e.getGeometryType()===s.enumEnvelope){let r=new W;return r.addEnvelope(e,!1),this.execute(r,t,n)}let r=e;e.getDescription().getAttributeCount()>1&&(r=e.clone(),r.dropAllAttributes());let i=new x().execute(r,0,t.getTolerance(0),0,n),a=null,o=t.getGCS();o!==t&&(a=D(t,o));let l=new z().execute(i,t,!1,n);return l.isEmpty()?0:(l===e&&(l=e.clone()),t.isPannable()?ne(l,t,n):J(l,t,o,a,n))}};function Q(){return{m_p_PCS:new l,m_factor:NaN,setValues:se,assign:ce}}function se(e,t){this.m_factor=e,this.m_p_PCS.assign(t)}function ce(e){this.m_factor=e.m_factor,this.m_p_PCS.assign(e.m_p_PCS)}var le=class{constructor(e,t,n,r){this.m_ptStart=new T,this.m_ptEnd=new T,this.m_ptStart.assign(t),this.m_ptEnd.assign(n),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y,this.m_e=Math.sqrt(e),this.m_e2=e,this.m_c1MinusE2=1-e;let a=Math.sin(r),o;o=this.m_e2===0?2*a:a*(i(this.m_e*a)+1/(1-this.m_e2*a*a)),this.m_baseA=o}setSegmentEndPoints(e,t){this.m_ptStart.assign(e),this.m_ptEnd.assign(t),this.m_deltaX=this.m_ptEnd.x-this.m_ptStart.x,this.m_deltaY=this.m_ptEnd.y-this.m_ptStart.y}makeFunctor(){return e=>{let t=1-e,n=t*this.m_ptStart.x+e*this.m_ptEnd.x,r=t*this.m_ptStart.y+e*this.m_ptEnd.y,a=t*this.m_ptStart.z+e*this.m_ptEnd.z,o=n*n+r*r,s=a/Math.sqrt(a*a+this.m_c1MinusE2*this.m_c1MinusE2*o),c;return c=this.m_e2===0?2*s:s*(i(this.m_e*s)+1/(1-this.m_e2*s*s)),(this.m_deltaY*n-this.m_deltaX*r)/o*(c-this.m_baseA)}}};function ue(){return{e:NaN,one_p_e:NaN,one_m_e:NaN,one_m_e_2:NaN,atanh_e_over_e:NaN,half_qp:NaN,f:NaN,z:NaN}}function $(){return{sin_phi:NaN,one_p_sin_phi:NaN,one_m_sin_phi:NaN,one_m_e_2_sin_2_phi:NaN,sin_half_phi_pf:NaN,sin_half_phi_pz:NaN,sin_half_asin_e_sin_phi_pf:NaN,sin_half_asin_e_sin_phi_pz:NaN,atanh_sin_phi:NaN,atanh_esin_phi:NaN,make_negative:!1,initialize:de,changeSign:fe,assign:pe,clone:me}}function de(e,t,n,r){let i=.5*e;this.sin_phi=Math.sin(e);let a=t*this.sin_phi,o=.5*Math.asin(a);this.one_p_sin_phi=1+this.sin_phi,this.one_m_sin_phi=1-this.sin_phi,this.one_m_e_2_sin_2_phi=(1+a)*(1-a),this.sin_half_phi_pf=Math.sin(i+n),this.sin_half_phi_pz=Math.sin(i+r),this.sin_half_asin_e_sin_phi_pf=Math.sin(o+n),this.sin_half_asin_e_sin_phi_pz=Math.sin(o+r),this.atanh_sin_phi=Math.log(this.sin_half_phi_pf/this.sin_half_phi_pz),this.atanh_esin_phi=Math.log(this.sin_half_asin_e_sin_phi_pf/this.sin_half_asin_e_sin_phi_pz)}function fe(){this.sin_phi=-this.sin_phi;let e=this.one_p_sin_phi;this.one_p_sin_phi=this.one_m_sin_phi,this.one_m_sin_phi=e,e=this.sin_half_phi_pf,this.sin_half_phi_pf=this.sin_half_phi_pz,this.sin_half_phi_pz=e,e=this.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pf=this.sin_half_asin_e_sin_phi_pz,this.sin_half_asin_e_sin_phi_pz=e,this.atanh_sin_phi=-this.atanh_sin_phi,this.atanh_esin_phi=-this.atanh_esin_phi}function pe(e){this.sin_phi=e.sin_phi,this.one_p_sin_phi=e.one_p_sin_phi,this.one_m_sin_phi=e.one_m_sin_phi,this.one_m_e_2_sin_2_phi=e.one_m_e_2_sin_2_phi,this.sin_half_phi_pf=e.sin_half_phi_pf,this.sin_half_phi_pz=e.sin_half_phi_pz,this.sin_half_asin_e_sin_phi_pf=e.sin_half_asin_e_sin_phi_pf,this.sin_half_asin_e_sin_phi_pz=e.sin_half_asin_e_sin_phi_pz,this.atanh_sin_phi=e.atanh_sin_phi,this.atanh_esin_phi=e.atanh_esin_phi,this.make_negative=e.make_negative}function me(){return{...this}}var he=class{constructor(e,t,n){this.m_transformPCS2GCS=null,this.m_scaleToRadians=new G,this.m_scaleToDegrees=new G,this.m_progressTracker=n,_(t!==4),this.m_curveType=t,this.m_inputSR=e,e&&e.getCoordinateSystemType()!==0||c(``),this.m_inputGCS=e.getGCS(),this.m_a=0,this.m_eSquared=0,this.m_b=0,this.m_rpu=0}executePolygonGeodeticArea(n){let r,i=n.clone();if(i.dropAllAttributes(),n.hasNonLinearSegments()&&(i=new x().execute(i,0,this.m_inputSR.getTolerance(0),0,this.m_progressTracker)),this.m_inputSR.isPannable()){let e=new b;i.queryEnvelope(e);let t=this.m_inputSR.getPannableExtent();if(!t.containsEnvelope(e)){let n=t.getCenterX()-e.getCenterX(),r=new G;r.setShiftCoords(n,0),i.applyTransformation(r),e.move(n,0);let o=new a;t.queryIntervalX(o);let s=new a;e.queryIntervalX(s),i=o.contains(s)?R(i,this.m_inputSR):new E().foldInto360RangeGeodetic(i,this.m_inputSR,this.m_curveType)}}if(this.m_transformPCS2GCS?(i=new z().execute(i,this.m_inputSR,!1,this.m_progressTracker),r=i.createInstance(),O(this.m_transformPCS2GCS,i,r,this.m_progressTracker)||(r=new E().execute(i,this.m_transformPCS2GCS,this.m_progressTracker))):r=new z().execute(i,this.m_inputGCS,!1,this.m_progressTracker),r.isEmpty())return 0;if(this.m_curveType===1){let e=L();return this.m_inputGCS.querySpheroidData(e),this.m_a=e.majorSemiAxis,this.m_eSquared=e.e2,this.loxodromeArea(r)}let o=r.getImpl();this.m_rpu=this.m_inputGCS.getUnit().getUnitToBaseFactor(),this.m_scaleToRadians.setScale(this.m_rpu),o.applyTransformation(this.m_scaleToRadians),this.m_scaleToDegrees=this.m_scaleToRadians,this.m_scaleToDegrees.invertThis();let s=L();if(this.m_inputGCS.querySpheroidData(s),this.m_a=s.majorSemiAxis,this.m_b=s.minorSemiAxis,this.m_eSquared=s.e2,this.m_curveType===2)return this.executeClippedPolygonGreatEllipticArea(r);{let n={stack:[],error:void 0,hasError:!1};try{let e=H.unit(9101),i=this.m_inputGCS.getPECoordSys(),a=t(n,i.cloneAlterUnits(e),!1),o,s,c=this.executeClippedPolygonGeodeticArea(r,a,0),l=0;do l++,o=this.executeClippedPolygonGeodeticArea(r,a,l),s=Math.abs(o-c),c=o;while(Math.abs(o)>1&&s>1e-8*Math.abs(o)&&l<7);return o}catch(e){n.error=e,n.hasError=!0}finally{e(n)}}}executeClippedPolygonGeodeticArea(r,i,a){let s={stack:[],error:void 0,hasError:!1};try{let e=new b;r.queryEnvelope(e);let c=t(s,this.getEqualAreaPCSInstance(i,e),!1),u=r.clone();ee(c,u);let d=u.getImpl().getAttributeStreamRef(0),f=r.getImpl().getAttributeStreamRef(0),p=t(s,new B,!1),g=t(s,new B,!1),_=[0,0],v=o(Q,40),y=h(40,-1),x=Q(),S=Q(),C,T,E=c,D=u.calculateArea2D(),O=new n(0),k=.5*Math.PI,A=1e-10*Math.abs(D)+1e-6,M=r.getPathCount(),N,P,F,I,L=new l,R=new l,z=new l,V=new l,H=new l,U=new l,W,G;for(P=r.getPathStart(0),N=0;N<M;N++,P=F)for(F=r.getPathEnd(N),d.queryPoint2D(F-1<<1,z),f.queryPoint2D(F-1<<1,L),Math.abs(L.y)>k&&(L.y=m(k,L.y)),I=P;I<F;I++,z.assign(V),L.assign(R)){if(d.queryPoint2D(I<<1,V),f.queryPoint2D(I<<1,R),Math.abs(R.y)>k&&(R.y=m(k,R.y)),W=l.distance(z,V),W<50||L.y===0&&R.y===0)continue;j.geodeticDistance(this.m_a,this.m_eSquared,L.x,L.y,R.x,R.y,p,g,null,this.m_curveType);let e=p.val,t=g.val;for(x.setValues(0,z),S.setValues(1,V),T=a,v[0].assign(S),y[0]=a,C=0;C>=0;){G=.5*(x.m_factor+S.m_factor),j.geodeticCoordinate(this.m_a,this.m_eSquared,L.x,L.y,e*G,t,p,g,this.m_curveType),H.x=p.val,H.y=g.val,_[0]=H.x,_[1]=H.y,w.geogToProj(E,1,_),U.x=_[0],U.y=_[1];let n=-U.offset(x.m_p_PCS,S.m_p_PCS),r=.5*n*l.distance(x.m_p_PCS,S.m_p_PCS);if(O.pe(r),Math.abs(r)>A||Math.abs(r)>0&&T>0)S.setValues(G,U),C++,v[C].assign(S),Math.abs(r)<=A?(T--,y[C-1]=T,y[C]=T):(T=y[C-1],y[C]=T);else{if(C<=0)break;x.assign(S),C--,S.assign(v[C]),T=y[C]}}}return D+=O.getResult(),Math.abs(D)}catch(e){s.error=e,s.hasError=!0}finally{e(s)}}executeClippedPolygonGreatEllipticArea(e){let t=[],r=[],i=new l,a=new l,o=P(1,this.m_eSquared,new l(0,.5*Math.PI)),s=new n(0),c=new n(0),u=new n(0),d=new T,p=new T,h=new b;e.queryLooseEnvelope(h);let g=0;h.containsCoords(h.xmin,0)||(g=Math.abs(h.ymin)<Math.abs(h.ymax)?h.ymin:h.ymax);let _=new le(this.m_eSquared,d,p,g),v=this.m_a*this.m_a,x=e.getImpl().querySegmentIterator();for(x.stripAttributes();x.nextPath();)for(;x.hasNextSegment();){let e=x.nextSegment();i.assign(e.getStartXY()),a.assign(e.getEndXY()),a.x-i.x>Math.PI?i.x+=2*Math.PI:a.x-i.x<-Math.PI&&(a.x+=2*Math.PI),this.splitSegmentCrossingItegralThreshold(e,t,r);for(let e of t)d.assign(P(this.m_a,this.m_eSquared,e.getStartXY())),p.assign(P(this.m_a,this.m_eSquared,e.getEndXY())),_.setSegmentEndPoints(d,p),this.adaptiveIntegrationWithRomberg(_,s);for(let e of r){let t=e.getStartXY(),n=e.getEndXY(),r=g;t.y<0&&(n=y(t,t=n),t.y=-t.y,n.y=-n.y,r=-r);let i=P(1,this.m_eSquared,t),a=P(1,this.m_eSquared,n),s=Math.min(t.y,n.y),l=C(this.m_eSquared,t.x,n.x,r,s);c.pe(l);let d=Math.abs(C(this.m_eSquared,t.x,n.x,s,f)),p=new T;p.setSub(i,o);let h=new T;h.setSub(a,o);let _=new T;_.setCrossProductVector(p,h);let b=v*(d-.5*_.length());b=m(b,n.x-t.x),u.pe(b)}t.length=0,r.length=0}return u.getResult()+v*(.5*(1-this.m_eSquared)*s.getResult()+c.getResult())}getEqualAreaPCSInstance(e,t){let n=t.getCenterX(),r,i,a=t.height(),o,s;(o=t.ymin>45*Math.PI/180||t.ymax<45*-Math.PI/180)?r=m(.5*Math.PI,t.getCenterY()):(r=t.getCenterY(),i=t.ymin+a*(2/3));let c=S(`EqualAreaPCS`),l=e.toString();return s=o?H.fromString(V.PE_TYPE_PROJCS,`PROJCS["${c}", ${l}, PROJECTION["Lambert_Azimuthal_Equal_Area"],PARAMETER["False_Easting",0],PARAMETER["False_Northing", 0],PARAMETER["Central_Meridian", ${n}], PARAMETER["Latitude_of_Origin", ${r}], UNIT["Meter",1.0]]`,!0):H.fromString(V.PE_TYPE_PROJCS,`PROJCS["${c}", ${l}, PROJECTION["Cylindrical_Equal_Area"],PARAMETER["False_Easting", 0],PARAMETER["False_Northing", 0],PARAMETER["Central_Meridian", ${n}],PARAMETER["Standard_Parallel_1", ${i}],PARAMETER["Latitude_of_Origin", ${r}],UNIT["Meter",1.0]]`,!0),s}splitSegmentCrossingItegralThreshold(e,t,n){let r=P(this.m_a,this.m_eSquared,new l(0,f)),i=P(this.m_a,this.m_eSquared,new l(0,-f)),a=this.splitSegmentPassingThroughPole(e);for(let e of a){let a=e.getStartXY(),o=e.getEndXY(),s=P(this.m_a,this.m_eSquared,a),c=P(this.m_a,this.m_eSquared,o),u=new l,d=new T,f=T.sqrDistance(r,s),p=T.sqrDistance(s,c);if(f<=100){if(!(p>400)){n.push(new F({start:a,end:o}));continue}d.assign(c.sub(s)),d.normalizeThis(),d.assign(s.add(d.mul(20))),u.assign(I(this.m_a,this.m_eSquared,d)),n.push(new F({start:a,end:u})),a.assign(u)}if(s.assign(P(this.m_a,this.m_eSquared,a)),f=T.sqrDistance(r,c),p=T.sqrDistance(s,c),f<=100){if(!(p>400)){n.push(new F({start:a,end:o}));continue}d.assign(c.sub(s)),d.normalizeThis(),d.assign(c.sub(d.mul(20))),u.assign(I(this.m_a,this.m_eSquared,d)),n.push(new F({start:u,end:o})),o.assign(u)}if(s.assign(P(this.m_a,this.m_eSquared,a)),c.assign(P(this.m_a,this.m_eSquared,o)),f=T.sqrDistance(i,s),p=T.sqrDistance(s,c),f<=100){if(!(p>400)){n.push(new F({start:a,end:o}));continue}d.assign(c.sub(s)),d.normalizeThis(),d.assign(s.add(d.mul(20))),u.assign(I(this.m_a,this.m_eSquared,d)),n.push(new F({start:a,end:u})),a.assign(u)}if(s.assign(P(this.m_a,this.m_eSquared,a)),c.assign(P(this.m_a,this.m_eSquared,o)),f=T.sqrDistance(i,c),p=T.sqrDistance(s,c),f<=100){if(!(p>400)){n.push(new F({start:a,end:o}));continue}d.assign(c.sub(s)),d.normalizeThis(),d.assign(c.sub(d.mul(20))),u.assign(I(this.m_a,this.m_eSquared,d)),n.push(new F({start:u,end:o})),o.assign(u)}t.push(new F({start:a,end:o}))}}splitSegmentPassingThroughPole(n){let i={stack:[],error:void 0,hasError:!1};try{let e=[],a=new T,o=new T,s=new T,c=new l,u=n.getStartXY(),d=n.getEndXY(),f=t(i,new B,!1);if(j.geodeticDistance(this.m_a,this.m_eSquared,u.x,u.y,d.x,d.y,f,null,null,2),Math.abs(d.x-u.x)>3.124139361&&f.val>20){let t=new q(new l(0,90),u.divide(this.m_rpu),d.divide(this.m_rpu),this.m_inputGCS,2,2),n=U(t.makeFunctor(),0,1,1e-10);if(n.second<=10&&n.first>0&&n.first<1||(t.setPointDistFrom(new l(0,-90)),n=U(t.makeFunctor(),0,1,1e-10),n.second<=10&&n.first>0&&n.first<1))return a.assign(P(this.m_a,this.m_eSquared,u)),o.assign(P(this.m_a,this.m_eSquared,d)),r(a,o,n.first,s),c.assign(I(this.m_a,this.m_eSquared,s)),e.push(new F({start:u,end:c})),e.push(new F({start:c,end:d})),e}return e.push(new F({start:u,end:d})),e}catch(e){i.error=e,i.hasError=!0}finally{e(i)}}adaptiveIntegrationWithRomberg(e,t){let n=e.makeFunctor(),r=0,i=1,a=n(r),o=n(i),s=1e-17,c=1e-14,l=(r+i)/2,u=n(l),d=Math.abs(u-a),f=Math.abs(o-u),p=0;for(;p++<32&&(d/f<.1||f/d<.1);)d<f?(t.pe(M(5,r,l,c,s,n)),r=l,a=u):(t.pe(M(5,l,i,c,s,n)),i=l,o=u),l=(r+i)/2,u=Math.abs(n(l)),d=Math.abs(u-a),f=Math.abs(o-u);t.pe(M(5,r,i,c,s,n))}loxodromeAreaHemi(e,t,n,r,a){let o=n.clone(),s=a.clone(),c,l,u,d,f,p,m,h,_,v,y,b,x,S,C,w;return o.make_negative&&o.changeSign(),s.make_negative&&s.changeSign(),y=r-t,Math.abs(o.sin_phi)===1||Math.abs(s.sin_phi)===1?e.half_qp*y:o.sin_phi===s.sin_phi?(v=.5*e.one_m_e_2*o.sin_phi*(1/o.one_m_e_2_sin_2_phi+i(e.e*o.sin_phi))*y,v):(C=Math.log(s.sin_half_phi_pf*o.sin_half_phi_pz/(s.sin_half_phi_pz*o.sin_half_phi_pf)),w=Math.log(s.sin_half_asin_e_sin_phi_pf*o.sin_half_asin_e_sin_phi_pz/(s.sin_half_asin_e_sin_phi_pz*o.sin_half_asin_e_sin_phi_pf)),this.m_eSquared===1?(f=0,c=.5*(C+s.sin_phi/s.one_m_e_2_sin_2_phi-o.sin_phi/o.one_m_e_2_sin_2_phi),l=0):(f=-2*e.atanh_e_over_e*(Math.log(s.one_p_sin_phi/o.one_p_sin_phi)-e.e*w),c=(C-e.e*w)/e.one_m_e_2,l=(Math.log(s.one_m_e_2_sin_2_phi/o.one_m_e_2_sin_2_phi)+f/e.atanh_e_over_e)/e.one_m_e_2),u=-w*(o.atanh_esin_phi+s.atanh_esin_phi),d=1/o.one_m_e_2_sin_2_phi-1/s.one_m_e_2_sin_2_phi,p=g(s.one_m_sin_phi/e.one_p_e,e.e)-g(o.one_m_sin_phi/e.one_p_e,e.e),m=g(s.one_p_sin_phi/e.one_p_e,e.e)-g(o.one_p_sin_phi/e.one_p_e,e.e),h=g(o.one_m_sin_phi/-e.one_m_e,e.e)-g(s.one_m_sin_phi/-e.one_m_e,e.e),_=g(o.one_p_sin_phi/-e.one_m_e,e.e)-g(s.one_p_sin_phi/-e.one_m_e,e.e),v=.25/c*(l+u+d+f+.5*(p+m+h+_)),v+=e.half_qp,b=.5*e.one_m_e_2*o.sin_phi*(1/o.one_m_e_2_sin_2_phi+i(e.e*o.sin_phi)),x=.5*e.one_m_e_2*s.sin_phi*(1/s.one_m_e_2_sin_2_phi+i(e.e*s.sin_phi)),x<b&&(S=b,b=x,x=S),v<b&&(v=b),v>x&&(v=x),v*=y,v)}loxodromeArea(e){let t=Math.PI/180,n=0,r=ue(),a=$(),o=$();r.e=Math.sqrt(this.m_eSquared),r.one_p_e=1+r.e,r.one_m_e=1-r.e,r.one_m_e_2=1-this.m_eSquared,r.atanh_e_over_e=i(r.e),this.m_eSquared>=1?r.half_qp=1:r.half_qp=.5*(1+r.atanh_e_over_e*r.one_m_e_2),r.f=.25*Math.PI,r.z=.75*Math.PI,o.initialize(0,r.e,r.f,r.z);let s=e.getPathCount(),c=new l,u=new l,d=e.getImpl().getAttributeStreamRef(0);for(let i=0;i<s;i++){let s=e.getPathStart(i),l=e.getPathEnd(i);if(!(l-s<=1)){d.queryPoint2D(2*(l-1),c);for(let e=s;e<l;e++){d.queryPoint2D(2*e,u);let i=c.y*t,l=u.y*t;if(e===s?(a.initialize(i,r.e,r.f,r.z),a.make_negative=!1):a.assign(o),o.initialize(l,r.e,r.f,r.z),o.make_negative=!1,c.y*u.y<0){if(c.y>=90&&u.y<=-90||u.y>=90&&c.y<=-90)return NaN;let e=$();e.initialize(0,r.e,r.f,r.z),e.make_negative=!1;let s=a.atanh_sin_phi-r.e*a.atanh_esin_phi,l=o.atanh_sin_phi-r.e*o.atanh_esin_phi,d=(l*c.x-s*u.x)/(l-s);i<0?(a.make_negative=!0,n-=this.loxodromeAreaHemi(r,c.x*t,a,d*t,e),a.make_negative=!1,n+=this.loxodromeAreaHemi(r,d*t,e,u.x*t,o)):(n+=this.loxodromeAreaHemi(r,c.x*t,a,d*t,e),o.make_negative=!0,n-=this.loxodromeAreaHemi(r,d*t,e,u.x*t,o),o.make_negative=!1)}else c.y>=0?n+=this.loxodromeAreaHemi(r,c.x*t,a,u.x*t,o):(a.make_negative=!0,o.make_negative=!0,n-=this.loxodromeAreaHemi(r,c.x*t,a,u.x*t,o),a.make_negative=!1,o.make_negative=!1);c.assign(u)}}}return this.m_a*n*this.m_a}calculate(e){if(e.isEmpty()||e.getDimension()<2)return 0;if(e.getGeometryType()===s.enumEnvelope){let t=new W;return t.addEnvelope(e,!1),this.calculate(t)}return this.m_inputSR!==this.m_inputGCS&&this.m_transformPCS2GCS===null&&(this.m_transformPCS2GCS=D(this.m_inputSR,this.m_inputGCS,null)),this.executePolygonGeodeticArea(e)}},ge=class{getOperatorType(){return 10311}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}execute(e,t,n,r){return d(e),n===4?new oe().execute(e,t,r):new he(t,n,r).calculate(e)}};export{ge as OperatorGeodeticArea};