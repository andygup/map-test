const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/OverlayCompositing.glsl-BdWJ9dYd.js","assets/index-C-FXvluM.js","assets/index-NV7R-tPD.css","assets/Octree-CXz4dNsB.js","assets/Util-B1cu74ll.js","assets/GeometryUtil-BqnSbvZN.js","assets/doublePrecisionUtils-B0owpBza.js","assets/vec3f32-nZdmKIgz.js","assets/Geometry-BTp0yhOg.js","assets/NormalAttribute.glsl-BzcwcK9j.js","assets/BindType-BmZEZMMh.js","assets/renderState-CfpGbofm.js","assets/basicInterfaces-CZwQPxTp.js","assets/requestImageUtils-CswTYnN2.js","assets/Indices-JUNGgdWS.js","assets/triangle-C57UtqE7.js","assets/RibbonLine.glsl-BRlvmZSr.js","assets/InterleavedLayout-FN5nlSrs.js","assets/BufferView-Dk0MoByh.js","assets/types-D0PSWh4d.js","assets/hydratedFeatures-DXGiFJc-.js","assets/floatRGBA-omvZ6LNc.js","assets/VertexArrayObject-km1At7bV.js","assets/NestedMap-GuqgquCN.js","assets/glUtil-DIb2YQRb.js","assets/VertexElementDescriptor-BOD-G50G.js","assets/VertexArrayObject-DcaNvwOy.js","assets/BufferObject-DuXoHzsa.js"])))=>i.map(i=>d[i]);
import{aS as Qe,vU as Mt,vV as kr,k6 as Ie,X as u,ew as Me,Y as v,a4 as Le,a3 as V,gC as ct,bx as He,aG as br,sw as Xr,it as Ze,og as Lt,iu as K,c2 as Yr,kk as Qr,bU as U,dG as Zr,dF as Kr,i1 as Jr,bE as H,bz as Pt,i2 as b,ow as Ne,_ as se,vW as ei,b0 as w,e2 as F,af as Ae,vX as k,aU as Tr,cv as ye,ek as De,am as Ee,cK as Rr,cR as ti,cN as Sr,cP as Je,k5 as te,hs as G,ac as Ht,pL as ri,k1 as ii,nC as si,mC as $r,ak as ai,kD as Pe,ov as It,lE as Nt,bo as ni,of as Gt,kn as oi,iw as li,fA as Or,ix as wt,bD as hi,kA as Dr,df as Pr,qd as ci,ob as di,nk as ui,on as Q,oo as ve,nd as Te,hN as Wt,dl as xe,na as $,vY as gi,om as zt,pE as pi,hv as _i,b1 as mi,d0 as Ir,k$ as we,iK as Ar,vZ as fi,pO as Vt,pP as vi,pN as xi,cm as yi,cq as wi,v_ as Ci,cg as bi,v$ as dt,nK as Ti,pD as ut,w0 as Ri,w1 as Si,iE as $i,iv as Oi,iJ as Di,pK as Pi,w2 as Ii,ng as Ai,lZ as X,lG as Ei,i9 as Er,rl as Fi,w3 as Mi,w4 as Li,fB as Hi,i7 as qt}from"./index-C-FXvluM.js";import{T as W,I as Ni,U as Gi,o as ee,V as Wi,W as zi,s as Ut,O as Ct,X as jt,g as ae,Y as At,a as z,Z as Fr,_ as Bt,$ as Fe,n as ne,m as oe,a0 as Mr,a1 as Vi,a2 as gt,G as N,q as Lr,a3 as pt,a4 as qi,a5 as Ui,a6 as ji,a7 as Bi,B as ki,a8 as Xi,b as Yi,t as Qi}from"./Geometry-BTp0yhOg.js";import{A as Zi}from"./Indices-JUNGgdWS.js";import{p as et,a as Hr}from"./triangulationUtils-DYBtHM4K.js";import{t as Ki,_ as Ji,C as es,e as Ve,a as kt,b as ts,u as rs}from"./RibbonLine.glsl-BRlvmZSr.js";import{n as D}from"./NormalAttribute.glsl-BzcwcK9j.js";import{r as is,i as nt,s as ss,n as as,x as ns,E as Xt,I as _t,c as os,u as ls}from"./VertexArrayObject-km1At7bV.js";import{a as hs}from"./BindType-BmZEZMMh.js";import{j as cs,v as Yt,w as Qt}from"./axisAngleDegrees-B_k9QdRo.js";import{B as re,c as Et,g as ie}from"./renderState-CfpGbofm.js";import{a as ce}from"./basicInterfaces-CZwQPxTp.js";import{t as tt}from"./VertexElementDescriptor-BOD-G50G.js";import{E as Zt}from"./BufferObject-DuXoHzsa.js";import{t as ds}from"./NestedMap-GuqgquCN.js";import{s as Ce,u as us,c as de,f as qe}from"./Util-B1cu74ll.js";import{c as gs}from"./GeometryUtil-BqnSbvZN.js";var B,Kt,Jt;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(B||(B={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Kt||(Kt={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(Jt||(Jt={}));let er=class{constructor(){this._extent=Qe(),this.resolution=0,this.renderLocalOrigin=Ki(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new ps}get extent(){return this._extent}setupGeometryViewsCyclical(t){this.setupGeometryView();const r=.001*t.range;if(this._extent[0]-r<=t.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Mt(this._extent,t.range,0,i)}if(this._extent[2]+r>=t.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];Mt(this._extent,-t.range,0,i)}}setupGeometryView(){this.canvasGeometries.numViews=1,kr(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const r=this.canvasGeometries.extents[t];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}},ps=class{constructor(){this.extents=[Qe(),Qe(),Qe()],this.numViews=0}};var C;(function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(C||(C={}));let _s=class{constructor(t,r,i){this._fbos=t,this._format=r,this._name=i}get valid(){var t;return((t=this._handle)==null?void 0:t.getTexture())!=null}dispose(){this._handle=Ie(this._handle)}get texture(){var t;return(t=this._handle)==null?void 0:t.getTexture()}bind(t,r,i){var s,a,n,o;this._handle&&((s=this._handle.fbo)==null?void 0:s.width)===r&&((a=this._handle.fbo)==null?void 0:a.height)===i||((n=this._handle)==null||n.release(),this._handle=this._fbos.acquire(r,i,this._name,this._format)),t.bindFramebuffer((o=this._handle)==null?void 0:o.fbo)}generateMipMap(){var t,r,i,s,a;(i=(r=(t=this._handle)==null?void 0:t.getTexture())==null?void 0:r.descriptor)!=null&&i.hasMipmap&&((a=(s=this._handle)==null?void 0:s.getTexture())==null||a.generateMipmap())}},ue=class{constructor(t,r,i,s,a=W.RGBA_MIPMAP){this.output=i,this.content=s,this.fbo=new _s(t,a,r)}get valid(){return this.fbo.valid}},ms=class{constructor(t){this.targets=[new ue(t,"overlay color",D.Color,C.Color),new ue(t,"overlay IM color",D.Color,C.ColorNoRasterImage),new ue(t,"overlay highlight",D.Highlight,C.Highlight,W.RG),new ue(t,"overlay water",D.Normal,C.WaterNormal),new ue(t,"overlay occluded",D.Color,C.Occluded)],Ni()&&this.targets.push(new ue(t,"overlay olid",D.ObjectAndLayerIdColor,C.ObjectAndLayerIdColor,W.RGBA))}getTexture(t){var r;return(r=this.targets[t])==null?void 0:r.fbo.texture}dispose(){for(const t of this.targets)t.fbo.dispose()}computeValidity(){return this.targets.reduce((t,r,i)=>r.valid?t|=1<<i:t,0)}};var tr;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight",e[e.ViewshedShadowMap=3]="ViewshedShadowMap"})(tr||(tr={}));var j,rt;function fs(e){return e!=null&&!e.running}(function(e){e[e.Idle=0]="Idle",e[e.Rendering=1]="Rendering",e[e.Ready=2]="Ready",e[e.Fading=3]="Fading"})(j||(j={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA",e[e.COUNT=2]="COUNT"}(rt||(rt={}));var bt;let Ue=bt=class extends Le{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new bt({cloudCover:this.cloudCover})}};u([Me({cloudy:"cloudy"})],Ue.prototype,"type",void 0),u([v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ue.prototype,"cloudCover",void 0),Ue=bt=u([V("esri.views.3d.environment.CloudyWeather")],Ue);var Tt;let je=Tt=class extends Le{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new Tt({fogStrength:this.fogStrength})}};u([Me({foggy:"foggy"})],je.prototype,"type",void 0),u([v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],je.prototype,"fogStrength",void 0),je=Tt=u([V("esri.views.3d.environment.FoggyWeather")],je);var Rt;let Re=Rt=class extends Le{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Rt({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([Me({rainy:"rainy"})],Re.prototype,"type",void 0),u([v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Re.prototype,"cloudCover",void 0),u([v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Re.prototype,"precipitation",void 0),Re=Rt=u([V("esri.views.3d.environment.RainyWeather")],Re);var St;let ge=St=class extends Le{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new St({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([Me({snowy:"snowy"})],ge.prototype,"type",void 0),u([v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ge.prototype,"cloudCover",void 0),u([v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ge.prototype,"precipitation",void 0),u([v({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],ge.prototype,"snowCover",void 0),ge=St=u([V("esri.views.3d.environment.SnowyWeather")],ge);var $t;let Be=$t=class extends Le{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new $t({cloudCover:this.cloudCover})}};u([Me({sunny:"sunny"})],Be.prototype,"type",void 0),u([v({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Be.prototype,"cloudCover",void 0),Be=$t=u([V("esri.views.3d.environment.SunnyWeather")],Be);const ke=1e4,vs=1e5;class xs{constructor(){this.startTime=0,this._data=ct(null),this._readChannels=rt.RG,this.parallax=new rr,this.parallaxNew=new rr,this._anchorPoint=He(),this._fadeState=ct(f.HIDE),this._fadeFactor=ct(1)}get data(){return this._data.value}set data(t){this._data.value=t}get readChannels(){return this._readChannels}get fadeState(){return this._fadeState.value}get fadeFactor(){return this._fadeFactor.value}get opacity(){switch(this.fadeState){case f.HIDE:return 0;case f.FADE_OUT:return 1-this.fadeFactor;case f.FADE_IN:return this.fadeFactor;case f.SHOW:case f.CROSS_FADE:return 1}}fade(t,r,i){this.isFading&&this.fadeFactor<1&&(this._fadeFactor.value=i?br((r-this.startTime)/(ws*i),0,1):1,this.fadeFactor===1&&this._endFade()),this._evaluateState(t,r),this._updateParallax(t)}_evaluateState(t,r){const i=t.relativeElevation,s=this._updateAnchorPoint(t);(i>1.7*ke||i<-ke||s>sr)&&this.opacity>0?this._startFade(f.HIDE,r):this.isFading||(i>ke||i<-.35*ke||s>Cs*sr?this.opacity>0&&this._startFade(f.FADE_OUT,r):fs(this.data)&&(this.opacity===0?this._startFade(f.FADE_IN,r):this.data.state===j.Ready&&(this.fadeState===f.SHOW?this._startFade(f.CROSS_FADE,r):this._startFade(f.SHOW,r))))}_updateParallax(t){const r=Xr(t.eye);this.parallax.radiusCurvatureCorrection=.84*Math.sqrt(Math.max(r-Ze.radius*Ze.radius,0))/Math.sqrt(r),Yt(ir,this.parallax.anchorPoint,pe),Lt(this.parallax.transform,K,pe[3],Qt(pe)),Yt(ir,this.parallaxNew.anchorPoint,pe),Lt(this.parallaxNew.transform,K,pe[3],Qt(pe))}_updateAnchorPoint(t){var r;return Yr(this._anchorPoint,t.eye),Qr(this._anchorPoint,this._anchorPoint,Ze.radius),this.fadeState===f.HIDE&&((r=this.data)==null?void 0:r.state)===j.Ready?(U(this.parallax.anchorPoint,this._anchorPoint),0):Zr(Kr(ys,this.parallax.anchorPoint,this._anchorPoint))}requestFade(){this._fadeFactor.value=0}_startFade(t,r){switch(this._fadeState.value=t,this.startTime=r,t){case f.CROSS_FADE:this.requestFade(),this._switchReadChannels(),U(this.parallaxNew.anchorPoint,this._anchorPoint);break;case f.FADE_IN:this.requestFade(),this._switchReadChannels(),U(this.parallax.anchorPoint,this._anchorPoint),U(this.parallaxNew.anchorPoint,this._anchorPoint);break;case f.FADE_OUT:this.requestFade();break;case f.SHOW:this._switchReadChannels(),U(this.parallax.anchorPoint,this._anchorPoint),U(this.parallaxNew.anchorPoint,this._anchorPoint),this._endFade();break;case f.HIDE:this._endFade()}}_endFade(){switch(this._fadeFactor.value=1,this.data&&this.data.state!==j.Ready&&(this.data.state=j.Idle),this.fadeState){case f.CROSS_FADE:U(this.parallax.anchorPoint,this.parallaxNew.anchorPoint),this._fadeState.value=f.SHOW;break;case f.FADE_IN:this._fadeState.value=f.SHOW;break;case f.FADE_OUT:this._fadeState.value=f.HIDE;break;case f.SHOW:case f.HIDE:break;default:Jr(this.fadeState)}}_switchReadChannels(){var t;((t=this.data)==null?void 0:t.state)===j.Ready&&(this._readChannels=1-this._readChannels,this.data.state=j.Fading)}get isFading(){return this.fadeState===f.FADE_OUT||this.fadeState===f.FADE_IN||this.fadeState===f.CROSS_FADE}}var f;(function(e){e[e.HIDE=0]="HIDE",e[e.FADE_IN=1]="FADE_IN",e[e.SHOW=2]="SHOW",e[e.CROSS_FADE=3]="CROSS_FADE",e[e.FADE_OUT=4]="FADE_OUT"})(f||(f={}));let rr=class{constructor(){this.anchorPoint=He(),this.radiusCurvatureCorrection=0,this.transform=H()}};const ir=Pt(0,0,1),pe=cs(),ys=He(),ws=1.25,Cs=.5,sr=2e5;let bs=class extends Gi{constructor(t,r){super(t,"samplerCube",hs.Pass,(i,s,a)=>i.bindTexture(t,r(s,a)))}};function Xa(e){const t=e.fragment;t.constants.add("radiusCloudsSquared","float",Ts).code.add(b`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos) {
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusCloudsSquared;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
return (cameraPosition + dir * pointIntDist) - spherePos;
}`),t.uniforms.add(new ee("radiusCurvatureCorrection",(l,h)=>h.clouds.parallax.radiusCurvatureCorrection)).code.add(b`vec3 correctForPlanetCurvature(vec3 dir) {
dir.z = dir.z * (1.0 - radiusCurvatureCorrection) + radiusCurvatureCorrection;
return dir;
}`),t.code.add(b`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec) {
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),Wi(t),zi(t);const r=Pt(.28,.175,.035);t.constants.add("RIM_COLOR","vec3",r),t.code.add(b`
    vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds) {
      float upDotLight = dot(cameraPosition, mainLightDirection);
      float dirDotLight = max(dot(worldSpaceRay, mainLightDirection), 0.0);
      float sunsetTransition = clamp(pow(max(upDotLight, 0.0), ${b.float(.3)}), 0.0, 1.0);

      // Base color of the clouds that depends on lighting of the sun and sky
      vec3 ambientLight = calculateAmbientIrradiance(cameraPosition,  0.0);
      vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
      vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));

      // Rim light around the edge of the clouds simulating scattering of the direct lun light
      float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
      float rimLightIntensity = 0.5 + 0.5 * pow(max(upDotLight, 0.0), 0.35);
      vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, ${b.float(140)})) * scatteringMod;

      // Brighten the clouds around the sun at the sunsets
      float additionalLight = ${b.float(.2)} * pow(dirDotLight, ${b.float(10)}) * (1. - pow(sunsetTransition, ${b.float(.3)})) ;

      return vec3(baseCloudColor * (1.0 + additionalLight) + directSunScattering);
    }
  `),t.uniforms.add(new Ut("readChannelsRG",(l,h)=>h.clouds.readChannels===rt.RG),new bs("cubeMap",(l,h)=>{var d,p;return((p=(d=h.clouds.data)==null?void 0:d.cubeMap)==null?void 0:p.colorTexture)??null})).code.add(b`vec4 sampleCloud(vec3 rayDir, bool readOtherChannel) {
vec4 s = texture(cubeMap, rayDir);
bool readRG = readChannelsRG ^^ readOtherChannel;
s = readRG ? vec4(vec3(s.r), s.g) : vec4(vec3(s.b), s.a);
return length(s) == 0.0 ? vec4(s.rgb, 1.0) : s;
}`),t.uniforms.add(new Ct("anchorPoint",(l,h)=>h.clouds.parallax.anchorPoint),new Ct("anchorPointNew",(l,h)=>h.clouds.parallaxNew.anchorPoint),new jt("rotationClouds",(l,h)=>h.clouds.parallax.transform),new jt("rotationCloudsNew",(l,h)=>h.clouds.parallaxNew.transform),new ee("cloudsOpacity",(l,h)=>h.clouds.opacity),new ee("fadeFactor",(l,h)=>h.clouds.fadeFactor),new Ut("crossFade",(l,h)=>h.clouds.fadeState===f.CROSS_FADE)).code.add(b`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition) {
vec3 intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPoint);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = sampleCloud(worldRayRotatedCorrected, crossFade);
vec3 cameraPositionN = normalize(cameraPosition);
vec4 cloudColor = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
if(crossFade) {
intersectionPoint = intersectWithCloudLayer(worldRay, cameraPosition, anchorPointNew);
worldRayRotated = rotateDirectionToAnchorPoint(rotationCloudsNew, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = sampleCloud(worldRayRotatedCorrected, false);
vec4 cloudColorNew = vec4(calculateCloudColor(cameraPositionN, worldRay, cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorNew, fadeFactor);
}
float totalTransmittance = length(cloudColor.rgb) == 0.0 ?
1.0 :
clamp(cloudColor.a * cloudsOpacity + (1.0 - cloudsOpacity), 0.0 , 1.0);
return vec4(cloudColor.rgb, totalTransmittance);
}`)}const Ts=(Ze.radius+vs)**2;var be;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(be||(be={}));let Nr=class extends Ne{constructor(){super(...arguments),this.color=Pt(1,1,1)}};function Rs(){const e=new ae;return e.include(At),e.fragment.uniforms.add(new z("tex",t=>t.texture),new Ct("uColor",t=>t.color)),e.fragment.main.add(b`vec4 texColor = texture(tex, uv);
fragColor = texColor * vec4(uColor, 1.0);`),e}const Ss=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:Nr,build:Rs},Symbol.toStringTag,{value:"Module"}));let Gr=class extends Ne{};function $s(){const e=new ae,{outputs:t,fragment:r}=e;return e.include(At),r.uniforms.add(new Fr("textureInput",i=>i.input)),r.constants.add("outlineWidth","int",Math.ceil(it)),r.constants.add("cellSize","int",J),t.add("fragGrid","vec2"),r.main.add(b`vec2 inputTextureSize = vec2(textureSize(textureInput, 0));
vec2 cellBottomLeftCornerInput = floor(gl_FragCoord.xy) * vec2(cellSize);
vec2 coordMid =  (cellBottomLeftCornerInput + 0.5 * vec2(cellSize)) / inputTextureSize;
vec2 commonValue = texture(textureInput, coordMid).rg;
int margin = outlineWidth;
float marginSquare = float(margin*margin);
for(int y = -margin; y <= cellSize + margin; y+=2) {
int dy = y < 0 ? -y : y > cellSize ? y-cellSize : 0;
int xMargin = dy > 0 ? int(ceil(sqrt(marginSquare - float(dy*dy)))) : margin;
for(int x = -xMargin; x <= cellSize + xMargin; x+=2) {
vec2 coord = (cellBottomLeftCornerInput + vec2(x, y)) / inputTextureSize;
vec2 value = texture(textureInput, coord).rg;
if (value != commonValue){
fragGrid = vec2(1.0, 1.0);
return;
}
}
}
bool hasAny = commonValue != vec2(0.0);
fragGrid = vec2(hasAny ? 1.0 : 0.0, 0.0);`),e}const J=32,it=9,Wr=.4,Os=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Gr,blurSize:Wr,build:$s,gridCellPixelSize:J,outlineSize:it},Symbol.toStringTag,{value:"Module"}));function ot(e){const{vertex:t}=e;t.uniforms.add(new z("coverageTexture",r=>r.coverageTexture),new Bt("highlightRenderCellCount",r=>[r.horizontalCellCount,r.verticalCellCount]),new Bt("highlightTextureResolution",r=>[r.highlightTexture.descriptor.width,r.highlightTexture.descriptor.height])),t.constants.add("cellSize","int",J),e.varyings.add("sUV","vec2"),e.varyings.add("vOutlinePossible","float"),t.code.add(b`const ivec2 cellVertices[4] = ivec2[4](ivec2(0,0), ivec2(1,0), ivec2(0,1), ivec2(1,1));`),t.main.add(b`int cellIndex = gl_InstanceID;
int cellX = cellIndex % highlightRenderCellCount[0];
int cellY = (cellIndex - cellX) / highlightRenderCellCount[0];
ivec2 cellPos = ivec2(cellX, cellY);
vec4 cov = texelFetch(coverageTexture, cellPos, 0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
vOutlinePossible = cov.g;
ivec2 iPosInCell = cellVertices[gl_VertexID];
vec2 sPos = vec2(cellPos * cellSize + iPosInCell * (cellSize));
vec2 vPos = sPos / vec2(highlightTextureResolution);
sUV = vPos;
gl_Position = vec4(2.0 * vPos - vec2(1.0), 0.0, 1.0);`)}function st(e){const{fragment:t}=e;t.code.add(b`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(vec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return uint(texel[lic] * 255.0);
}
uint readLevelBits(vec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)}function Ds(){const e=new ae;e.include(ot);const{fragment:t}=e;return t.uniforms.add(new z("highlightTexture",r=>r.highlightTexture),new z("highlightOptionsTexture",r=>r.highlightOptionsTexture),new ee("pixelRatio",r=>r.pixelRatio),new ee("occludedIntensityFactor",r=>r.occludedFactor),new Fe("maxHighlightLevel",r=>r.maxHighlightLevel)),t.constants.add("pixelSampleScale","float",1),e.include(st),t.code.add(b`const float pascal17[9] = float[9](12870.0, 11440.0, 8008.0, 4368.0, 1820.0, 560.0, 120.0, 16.0, 1.0);
const float denom17 =  65536.0;
float colorWeight[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float colorOcclusion[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
float weights[16] = float[16](0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
void applyTexel(vec2 texel, float weight) {
if (texel != vec2(0.0)){
int maxChannel = (maxHighlightLevel >> 2) & 1;
for (int channelIndex = 0; channelIndex <= maxChannel; ++channelIndex){
uint channel = readChannel(texel, channelIndex << 2);
int firstIndex = channelIndex << 2;
int maxIndex  = min(firstIndex + 3, maxHighlightLevel);
for (int highlightIndex = firstIndex; highlightIndex <= maxIndex; ++highlightIndex ) {
uint v = readChannelBits(channel, highlightIndex);
if ((v & 1u) == 1u){
colorWeight[highlightIndex] += weight;
if ((v & 2u) == 2u){
colorOcclusion[highlightIndex] += weight;
}
}
}
}
}
}
vec2 readTexel(ivec2 iuv, int du, int dv) {
return texelFetch(highlightTexture, iuv + ivec2(du, dv), 0).rg;
}
void readAndApplyTexel(ivec2 iuv, int du, int dv, float weight) {
vec2 texel = readTexel(iuv, du, dv);
applyTexel(texel, weight);
}
void readAndApply2TexelsU(ivec2 iuv, int du, int dv, float weight) {
readAndApplyTexel(iuv, -du, dv, weight);
readAndApplyTexel(iuv, +du, dv, weight);
}
float getWeight(int pixelDistance) {
float scaledDistance = float(pixelDistance) * pixelSampleScale / pixelRatio;
float d0f = floor(scaledDistance);
int d0 = int(d0f);
if (d0 >= 8){
return 0.0;
}
float w0 = pascal17[d0];
float w1 = pascal17[d0+1];
float f =  scaledDistance - d0f;
return mix(w0, w1, f);
}`),t.main.add(b`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
ivec2 iuv = ivec2(sUV * highlightTextureSize);
vec2 centerTexel = texelFetch(highlightTexture, iuv, 0).rg;
bool outlinePossible = false;
if (vOutlinePossible > 0.0){
for (int highlightLevel=0; highlightLevel<= maxHighlightLevel; ++highlightLevel) {
if ((readLevelBits(centerTexel,highlightLevel) & 1u) == 0u) {
outlinePossible = true;
break;
}
}
}
if (outlinePossible) {
int maxPixelDistance = clamp(int(8.0 * pixelRatio / pixelSampleScale), 2, 16);
float weightSum = 0.0;
for(int y = 0; y <= maxPixelDistance; ++y) {
float w = getWeight(y);
weights[y] = w;
weightSum += w * (y == 0 ? 1.0 : 2.0);
}
for(int y = 0; y <= maxPixelDistance; ++y) {
weights[y] = weights[y] / weightSum;
}
float weight0 = weights[0];
applyTexel(centerTexel, weight0 * weight0);
for(int y = 0; y <= maxPixelDistance; y += 1) {
float yFactor = weights[y];
if (y != 0) {
float xFactor = weight0;
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApplyTexel(iuv, 0, +y, weight);
readAndApplyTexel(iuv, 0, -y, weight);
}
}
for(int x = 1; x <= maxPixelDistance; x += 1) {
float xFactor = weights[x];
float weight = xFactor * yFactor;
if (weight > 0.0) {
readAndApply2TexelsU(iuv, x, +y, weight);
if (y != 0){
readAndApply2TexelsU(iuv, x, -y, weight);
}
}
}
}
} else {
applyTexel(centerTexel, 1.0);
}
int frontColorIndex = 999;
int maxColorIndex = 0;
for (int i = 0; i <= maxHighlightLevel; ++i) {
if (colorWeight[i] > 0.0){
frontColorIndex = min(frontColorIndex, i);
maxColorIndex = max(maxColorIndex, i);
}
}
if (frontColorIndex == 999){
fragColor = vec4(0.0);
return;
}
vec4 accumulatedColor = vec4(0.0);
for (int curColorIndex = frontColorIndex; curColorIndex <= maxColorIndex; ++curColorIndex) {
float curColorWeight = colorWeight[curColorIndex];
if (curColorWeight <= 0.01){
continue;
}
uint vc = readLevelBits(centerTexel, curColorIndex);
bool centerFilled = (vc & 1u) == 1u;
bool centerOccluded = (vc & 3u) == 3u;
float curColorOcclusion = colorOcclusion[curColorIndex];
bool occluded = centerFilled ? centerOccluded : curColorOcclusion > 0.5 * curColorWeight;
int colorChannel = centerFilled ? 0 : 1;
vec4 colorBase = texelFetch(highlightOptionsTexture, ivec2(curColorIndex, colorChannel), 0);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, 0.03, curColorWeight);
float intensity = colorBase.a * occlusionFactor * outlineFactor;
vec3 currentColor = colorBase.rgb;
float a0 = accumulatedColor.a;
float a1 = intensity;
float alpha = clamp(a0 + a1 - a0 * a1, 0.0, 1.0);
if (alpha > 0.001){
vec3 blendedColor = ((1.0 - a1) * a0 * accumulatedColor.rgb + a1 * currentColor) / alpha;
accumulatedColor = vec4(blendedColor, alpha);
}
}
fragColor = accumulatedColor;`),e}const Ps=Object.freeze(Object.defineProperty({__proto__:null,build:Ds},Symbol.toStringTag,{value:"Module"}));let ar=class extends ne{constructor(t,r,i){super(t,r,new oe(Ps,()=>se(()=>import("./OverlayCompositing.glsl-BdWJ9dYd.js").then(s=>s.H),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),i)}initializePipeline(){return re({blending:Et,colorWrite:ie})}},nr=class extends ne{constructor(t,r,i){super(t,r,new oe(Os,()=>se(()=>import("./OverlayCompositing.glsl-BdWJ9dYd.js").then(s=>s.d),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),i)}initializePipeline(){return re({colorWrite:ie})}},Is=class extends Ne{constructor(){super(...arguments),this.occludedFactor=ei,this.maxHighlightLevel=1,this.verticalCellCount=0,this.horizontalCellCount=0,this.highlightLevel=0,this.pixelRatio=1}};function As(){const e=new ae;e.include(ot),e.include(st);const{fragment:t}=e;return e.outputs.add("fragSingleHighlight","vec2",0),t.uniforms.add(new z("highlightTexture",r=>r.highlightTexture),new Fe("maxHighlightLevel",r=>r.maxHighlightLevel),new Fe("highlightLevel",r=>r.highlightLevel)),e.include(st),t.main.add(b`ivec2 iuv = ivec2(gl_FragCoord.xy);
vec2 inputTexel = texelFetch(highlightTexture, iuv, 0).rg;
uint bits = readLevelBits(inputTexel, highlightLevel);
bool hasHighlight = (bits & 1u) == 1u;
bool hasOccluded  = (bits & 2u) == 2u;
fragSingleHighlight = vec2(hasHighlight ? 1.0 : 0.0, hasOccluded ? 1.0 : 0.0);`),e}const Es=Object.freeze(Object.defineProperty({__proto__:null,build:As},Symbol.toStringTag,{value:"Module"}));let or=class extends ne{constructor(t,r,i){super(t,r,new oe(Es,()=>se(()=>import("./OverlayCompositing.glsl-BdWJ9dYd.js").then(s=>s.e),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),i)}initializePipeline(){return re({colorWrite:ie})}};function Fs(){const e=new ae;e.include(ot);const{fragment:t}=e;return t.uniforms.add(new z("blurInput",r=>r.singleHighlightBlurTexture),new Mr("blurSize",r=>r.blurSize),new z("highlightTexture",r=>r.highlightTexture),new z("highlightOptionsTexture",r=>r.highlightOptionsTexture),new Fe("highlightLevel",r=>r.highlightLevel),new ee("occludedIntensityFactor",r=>r.occludedFactor)),t.constants.add("inner","float",1-(it-Wr)/it),e.include(st),t.main.add(b`vec2 highlightTextureSize = vec2(textureSize(highlightTexture,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
vec2 blurredHighlightValue = (vOutlinePossible == 0.0)
? center
: center * 0.204164
+ texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005
+ texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913
+ texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
float highlightIntensity = blurredHighlightValue.r;
float occlusionWeight = blurredHighlightValue.g;
if (highlightIntensity <= 0.01) {
discard;
}
vec4 fillColor    = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 0), 0);
vec4 outlineColor = texelFetch(highlightOptionsTexture, ivec2(highlightLevel, 1), 0);
vec2 centerTexel = texelFetch(highlightTexture, ivec2(uv * highlightTextureSize), 0).rg;
uint centerBits = readLevelBits(centerTexel, highlightLevel);
bool centerFilled = (centerBits & 1u) == 1u;
bool centerOccluded = (centerBits & 3u) == 3u;
bool occluded = centerOccluded || (0.5 * highlightIntensity < occlusionWeight);
float occlusionFactor = occluded ? occludedIntensityFactor : 1.0;
float outlineFactor = centerFilled ? 1.0 : smoothstep(0.0, inner, highlightIntensity);
float fillFactor = centerFilled ? 1.0 : 0.0;
vec4 baseColor = mix(outlineColor, fillColor, fillFactor);
float intensity = baseColor.a * occlusionFactor * outlineFactor;
fragColor = vec4(baseColor.rgb, intensity);`),e}const Ms=Object.freeze(Object.defineProperty({__proto__:null,build:Fs},Symbol.toStringTag,{value:"Module"}));let lr=class extends ne{constructor(t,r,i){super(t,r,new oe(Ms,()=>se(()=>import("./OverlayCompositing.glsl-BdWJ9dYd.js").then(s=>s.S),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),i)}initializePipeline(){return re({blending:Et,colorWrite:ie})}},zr=class extends Ne{constructor(){super(...arguments),this.blurSize=w()}};function Ls(){const e=new ae;return e.include(ot),e.fragment.uniforms.add(new Mr("blurSize",t=>t.blurSize),new Fr("blurInput",t=>t.blurInput)),e.outputs.add("fragSingleHighlight","vec2",0),e.fragment.main.add(b`vec2 highlightTextureSize = vec2(textureSize(blurInput,0));
vec2 uv = sUV;
vec2 center = texture(blurInput, uv).rg;
if (vOutlinePossible == 0.0) {
fragSingleHighlight = center;
} else {
vec2 sum = center * 0.204164;
sum += texture(blurInput, uv + blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv - blurSize * 1.407333).rg * 0.304005;
sum += texture(blurInput, uv + blurSize * 3.294215).rg * 0.093913;
sum += texture(blurInput, uv - blurSize * 3.294215).rg * 0.093913;
fragSingleHighlight = sum;
}`),e}const Hs=Object.freeze(Object.defineProperty({__proto__:null,SingleHighlightBlurDrawParameters:zr,build:Ls},Symbol.toStringTag,{value:"Module"}));let hr=class extends ne{constructor(t,r,i){super(t,r,new oe(Hs,()=>se(()=>import("./OverlayCompositing.glsl-BdWJ9dYd.js").then(s=>s.f),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),i)}initializePipeline(){return re({colorWrite:ie})}};const Ns=[];new tt(F.POSITION,3,Ae.FLOAT,0,12);new tt(F.POSITION,2,Ae.FLOAT,0,8);new tt(F.POSITION,2,Ae.FLOAT,0,16),new tt(F.UV0,2,Ae.FLOAT,8,16);let Se=class extends Vi{constructor(t){super(t),this.produces=gt.HIGHLIGHTS,this.consumes={required:[gt.HIGHLIGHTS,"highlights"]},this.useMultipleHighlights=!!Tr("enable-feature:multiple-highlights"),this._optionsTexture=null,this._downsampleDrawParameters=new Gr,this._passParameters=new Is,this._singleHighlightBlurDrawParameters=new zr,this._grid=new Gs,t.techniques.precompile(nr),this.useMultipleHighlights?t.techniques.precompile(ar):(t.techniques.precompile(or),t.techniques.precompile(hr),t.techniques.precompile(lr))}initialize(){const{view:t}=this,{highlights:r}=t;this.addHandles([ye(()=>qr(r),()=>{this._optionsTexture=Ee(this._optionsTexture),this.requestRender(ce.UPDATE)},De),ye(()=>r,()=>{this.requestRender(ce.UPDATE)},De),r.on("after-changes",()=>{this.requestRender(ce.UPDATE)})])}destroy(){this._passParameters&&(this._passParameters.highlightOptionsTexture=null),this._grid.coverage=Ie(this._grid.coverage),this._grid.vao=Ee(this._grid.vao),this._optionsTexture=Ie(this._optionsTexture)}_updateOptionsTexture(t){const r=this.renderingContext;let i=this._optionsTexture;if(i==null){const s=new Rr(16,2);s.internalFormat=ti.RGBA,s.samplingMode=Sr.NEAREST,i=new Je(r,s,null),this._optionsTexture=i}i.setData(t),this._passParameters.highlightOptionsTexture=i}render(t){const r=t.find(({name:_})=>_===gt.HIGHLIGHTS),{techniques:i,bindParameters:s,_passParameters:a,renderingContext:n}=this;if(!s.decorations)return r;const o=i.acquire(nr);if(!o.compiled)return o.release(),this.requestRender(ce.UPDATE),r;const l=t.find(({name:_})=>_==="highlights").getTexture(),h=()=>{var le;const{highlights:_}=this.view;this._optionsTexture||this._updateOptionsTexture(Ws(_)),a.highlightOptionsTexture=this._optionsTexture,this._gridUpdateResources(l);const x=this._gridComputeCoverage(o,l,s);o.release();const{horizontalCellCount:M,verticalCellCount:Y}=x;return a.horizontalCellCount=M,a.verticalCellCount=Y,a.coverageTexture=(le=x.coverage)==null?void 0:le.getTexture(),x},d=_=>{const x=_.verticalCellCount*_.horizontalCellCount;n.bindVAO(_.vao),n.drawElementsInstanced(ii.TRIANGLES,6,Ae.UNSIGNED_BYTE,0,x)},{camera:p}=s,m=()=>{n.bindFramebuffer(r.fbo),n.setViewport4fv(p.fullViewport)};return this.useMultipleHighlights?this._renderMultiple(l,h,d,m):this._renderSingle(l,h,d,m),a.highlightTexture=null,a.coverageTexture=null,r}_renderMultiple(t,r,i,s){const{techniques:a,bindParameters:n,_passParameters:o,renderingContext:l}=this,h=a.acquire(ar);if(!h.compiled)return h.release(),void this.requestRender(ce.UPDATE);const d=r();o.highlightTexture=t,o.pixelRatio=n.camera.pixelRatio,o.maxHighlightLevel=ur(this.view.highlights)-1,l.bindTechnique(h,n,o),s(),i(d),h.release()}_renderSingle(t,r,i,s){var Ft;const{fboCache:a,techniques:n,bindParameters:o,_passParameters:l,renderingContext:h}=this,d=n.acquire(or),p=n.acquire(hr),m=n.acquire(lr);if(!m.compiled||!p.compiled||!d.compiled)return m.release(),p.release(),d.release(),void this.requestRender(ce.UPDATE);const _=r(),{width:x,height:M}=t.descriptor;l.maxHighlightLevel=ur(this.view.highlights)-1,l.highlightTexture=t;const{camera:Y}=o,{fullWidth:le,fullHeight:lt,pixelRatio:Ge}=Y,he=Math.ceil(le/Ge),y=Math.ceil(lt/Ge),{_singleHighlightBlurDrawParameters:T}=this;for(let ht=0;ht<=l.maxHighlightLevel;++ht){l.highlightLevel=ht,h.setClearColor(0,0,0,0);const We=a.acquire(x,M,"single highlight",W.RG);h.bindFramebuffer(We.fbo),h.setViewport(0,0,x,M),h.clear(te.COLOR),h.bindTechnique(d,o,l),i(_),T.blurInput=We.getTexture(),G(T.blurSize,1/he,0);const ze=a.acquire(he,y,"single highlight blur h",W.RG);h.unbindTexture((Ft=ze.fbo)==null?void 0:Ft.colorTexture),h.bindFramebuffer(ze.fbo),h.setViewport(0,0,he,y),h.clear(te.COLOR),T.blurInput=We.getTexture(),G(T.blurSize,1/he,0),h.bindTechnique(p,o,l,T),i(_),We.release(),G(T.blurSize,0,1/y),l.singleHighlightBlurTexture=ze.getTexture(),s(),h.bindTechnique(m,o,l,T),i(_),ze.release()}d.release(),p.release(),m.release()}_gridUpdateResources(t){const r=this.renderingContext,i=this._grid,{width:s,height:a}=t.descriptor;if(i.horizontalCellCount=Math.ceil(s/J),i.verticalCellCount=Math.ceil(a/J),i.vao)return;const n=Zt.createIndex(r,Ht.STATIC_DRAW,Vs);i.vao=new is(r,ri,new Map([["geometry",Ns]]),new Map([["geometry",Zt.createVertex(r,Ht.STATIC_DRAW)]]),n)}_gridComputeCoverage(t,r,i){var d;const s=this.renderingContext,a=this._grid,n=r.descriptor,o=Math.ceil(n.width/J),l=Math.ceil(n.height/J);this._downsampleDrawParameters.input=r,(d=a.coverage)==null||d.release();const h=this.fboCache.acquire(o,l,"highlight coverage",W.RG);return a.coverage=h,s.bindFramebuffer(h.fbo),s.bindTechnique(t,i,this._passParameters,this._downsampleDrawParameters),s.setViewport(0,0,o,l),s.screen.draw(),a}get test(){}};u([v()],Se.prototype,"produces",void 0),u([v()],Se.prototype,"consumes",void 0),u([v({constructOnly:!0})],Se.prototype,"techniques",void 0),Se=u([V("esri.views.3d.webgl-engine.effects.highlight.Highlight")],Se);let Gs=class{constructor(){this.coverage=null,this.vao=null,this.verticalCellCount=0,this.horizontalCellCount=0,this.viewportWidth=0,this.viewportHeight=0}};function Ws(e){const t=new Uint8Array(128),r=(s,a)=>{t[s]=a},i=(s,a)=>{const n=4*s,o=4*s+64,{color:l}=a,h=a.haloColor??l;r(n+0,l.r),r(n+1,l.g),r(n+2,l.b),r(n+3,a.fillOpacity*l.a*255),r(o+0,h.r),r(o+1,h.g),r(o+2,h.b),r(o+3,a.haloOpacity*h.a*255)};return Vr(e,(s,a)=>{i(a,s.options)}),t}const cr=new Array(k),dr=new Array(k);function Vr(e,t){const r=Math.min(e.length,k);let i=k;for(let a=r-1;a>=0;--a){const n=e.at(a);if(n){const o=n.name;cr.includes(o,i)||(--i,cr[i]=o,dr[i]=a)}}const s=k-i;for(let a=0;a<s;++a){const n=dr[k-s+a];t(e.at(n),a)}}let zs=0;function qr(e){let t=0;const r=Math.min(k,e.length);for(let i=0;i<r;++i){const s=e.at(i);if(s){const{name:a,options:n}=s;t+=a.length;const{color:o,fillOpacity:l,haloColor:h,haloOpacity:d}=n;t+=o.r+o.g+o.b+o.a+l,t+=h?h.r+h.g+h.b+h.a+d:0}}{const i=e.at(0);if(i){const{shadowOpacity:s,shadowDifference:a,shadowColor:n}=i.options;t+=s+a+n.r+n.g+n.b+n.a}}return zs++}const Vs=new Uint8Array([0,1,2,2,1,3]);function qs(e,t,r,i,s,a,n=0,o){const{highlightGroupIndices:l}=s;l.clear();const h=[];Vr(i,x=>{const{name:M}=x;l.set(M,h.length),h.push(M)});const d=l.size,{gl:p}=e;G(s.highlightMixOrigin,n,0);let m=null;d>1&&(m=t.acquire(r.width,r.height,"highlight mix",W.RG),e.bindFramebuffer(m.fbo),e.clearFramebuffer(si));const _=(m==null?void 0:m.getTexture())??null;s.highlightMixTexture=_,o();for(let x=0;x<d;++x)x>0&&(e.bindTexture(_,0),p.copyTexSubImage2D($r.TEXTURE_2D,0,0,0,n,0,r.width,r.height),e.bindTexture(null,0)),e.clear(te.DEPTH),s.highlightLevel=x,s.highlightGroupName=h[x],a();m==null||m.release()}function ur(e){var r;const t=new Set;for(let i=0;i<k;++i){const s=(r=e.at(i))==null?void 0:r.name;s&&t.add(s)}return t.size}let Us=class{constructor(t,r,i,s){this._textures=t,this._techniques=r,this.materialChanged=i,this.requestRender=s,this._id2glMaterialRef=new ds}dispose(){this._textures.destroy()}acquire(t,r,i){this._ownMaterial(t);const s=t.produces.get(r);if(!(s!=null&&s(i)))return null;let a=this._id2glMaterialRef.get(i,t.id);if(a==null){const n=t.createGLMaterial({material:t,techniques:this._techniques,textures:this._textures,output:i});a=new js(n),this._id2glMaterialRef.set(i,t.id,a)}return a.ref(),a.glMaterial}release(t,r){const i=this._id2glMaterialRef.get(r,t.id);i!=null&&(i.unref(),i.referenced||(Ee(i.glMaterial),this._id2glMaterialRef.delete(r,t.id)))}_ownMaterial(t){t.repository&&t.repository!==this&&ai.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),t.repository=this}},js=class{constructor(t){this.glMaterial=t,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,Ce(this._refCnt>=0)}get referenced(){return this._refCnt>0}};var at;(function(e){e[e.Immediate=0]="Immediate",e[e.FadeWithWeather=1]="FadeWithWeather"})(at||(at={}));let Bs=class{constructor(t){this.shadowMap=t,this.slot=N.OPAQUE_MATERIAL,this.slicePlane=null,this.hasOccludees=!1,this.enableFillLights=!0,this.oitPass=Lr.NONE,this.alignPixelEnabled=!1,this.decorations=!0,this.overlayStretch=1,this.viewshedEnabled=!1,this._camera=new nt,this._inverseViewport=w(),this._oldLighting=new pt,this._newLighting=new pt,this._fadedLighting=new pt,this._lighting=this._newLighting,this.ssr=new ks,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.highlightMixTexture=null,this.highlightGroupName=null,this.highlightGroupIndices=new Map,this.highlightLevel=0,this.highlightMixOrigin=w(),this.hudRenderStyle=gs.Occluded,this.clouds=new xs,this.shadowHighlightsVisible=!1}get camera(){return this._camera}set camera(t){this._camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}fadeLighting(){switch(this.clouds.fadeFactor){case 0:this._lighting=this._oldLighting;break;default:this._fadedLighting.lerpLighting(this._oldLighting,this._newLighting,this.clouds.fadeFactor),this._lighting=this._fadedLighting;break;case 1:this._lighting=this._newLighting,this._oldLighting.copyFrom(this._newLighting)}}updateLighting(t,r,i,s){this._oldLighting.copyFrom(this.lighting),this._newLighting.noonFactor=r,this._newLighting.globalFactor=i,this._newLighting.set(t),s===at.FadeWithWeather&&this.clouds.requestFade(),this.fadeLighting()}},ks=class{constructor(){this.fadeFactor=1,this.reprojectionMatrix=H()}};class Xs{constructor(t,r){this.rctx=t,this.lastFrameCamera=new nt,this.output=D.Color,this.renderOccludedMask=Ke,this.bind=new Bs(r),this.bind.alignPixelEnabled=!0}}const Ke=Pe.Occlude|Pe.OccludeAndTransparent|Pe.OccludeAndTransparentStencil;let Oe=class extends nt{constructor(){super(...arguments),this._projectionMatrix=H()}get projectionMatrix(){return this._projectionMatrix}};u([v()],Oe.prototype,"_projectionMatrix",void 0),u([v({readOnly:!0})],Oe.prototype,"projectionMatrix",null),Oe=u([V("esri.views.3d.webgl-engine.lib.CascadeCamera")],Oe);var Ot;(function(e){e[e.Highlight=0]="Highlight",e[e.ExcludeHighlight=1]="ExcludeHighlight"})(Ot||(Ot={}));class Xe{constructor(){this.camera=new Oe,this.lightMat=H()}}class Ys{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Qs{constructor(t,r){this._fbos=t,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Ys,this._projectionView=H(),this._projectionViewInverse=H(),this._modelViewLight=H(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=It(),this._cascades=[new Xe,new Xe,new Xe,new Xe],this._lastOrigin=null,this._maxTextureWidth=Math.min(Tr("esri-mobile")?4096:16384,t.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}get depthTexture(){var t;return(t=this._handle)==null?void 0:t.getTexture()}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return Nt(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}disposeOffscreenBuffers(){this._handle=Ie(this._handle),this._discardSnapshots()}set maxCascades(t){this.settings.maxNumCascadesHighQuality=br(Math.floor(t),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(t){this._enabled=t,t||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}get cascades(){for(let t=0;t<this._numCascades;++t)ft[t]=this._cascades[t];return ft.length=this._numCascades,ft}start(t,r,i,s,a){Ce(this.enabled);const{near:n,far:o}=ra(i);this._computeCascadeDistances(n,o,s),this._textureHeight=this._computeTextureHeight(t,a,s),this._setupMatrices(t,r);const{viewMatrix:l,projectionMatrix:h}=t;for(let d=0;d<this._numCascades;++d)this._constructCascade(d,h,l,r);this._lastOrigin=null,this.clear()}finish(){var t;Ce(this.enabled),(t=this._handle)==null||t.detachDepth()}getShadowMapMatrices(t){if(!this._lastOrigin||!ni(t,this._lastOrigin)){this._lastOrigin=this._lastOrigin||He(),U(this._lastOrigin,t);for(let r=0;r<this._numCascades;++r){Gt(vr,this._cascades[r].lightMat,t);for(let i=0;i<16;++i)xr[16*r+i]=vr[i]}}return xr}moveSnapshot(t){var r,i;Ce(this.enabled),(r=this._handle)==null||r.detachDepth(),(i=this._snapshots[t])==null||i.release(),this._snapshots[t]=this._handle,this._handle=null,this.clear()}copySnapshot(t){var l,h,d,p;const r=(h=(l=this._handle)==null?void 0:l.getTexture())==null?void 0:h.descriptor;if(!this.enabled||!r)return;(d=this._snapshots[t])==null||d.release();const{width:i,height:s}=r,a=t===Ot.Highlight?"shadow highlight snapshot":"shadow no highlight snapshot";this._snapshots[t]=this._fbos.acquire(i,s,a,W.RGBA4);const n=this._fbos.rctx;this._bindFbo();const o=n.bindTexture((p=this._snapshots[t])==null?void 0:p.getTexture(),Je.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D($r.TEXTURE_2D,0,0,0,0,0,i,s),n.bindTexture(o,Je.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(t){var r;return this.enabled?(r=this._snapshots[t])==null?void 0:r.getTexture():null}clear(){const t=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),t.setClearColor(1,1,1,1),t.clear(te.COLOR|te.DEPTH)}_computeTextureHeight(t,r,i){const s=Math.min(window.devicePixelRatio,r)/t.pixelRatio,a=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,n=qi(Math.floor(Math.max(t.fullWidth,t.fullHeight)*s*a)),o=Math.min(this._maxTextureWidth,this._numCascades*n);return Ui(o/this._numCascades)}_ensureFbo(){var t,r,i,s,a;((r=(t=this._handle)==null?void 0:t.fbo)==null?void 0:r.width)===this._textureWidth&&((i=this._handle)==null?void 0:i.fbo.height)===this._textureHeight||((s=this._handle)==null||s.release(),this._handle=this._fbos.acquire(this._textureWidth,this._textureHeight,"shadow map",W.RGBA4)),(a=this._handle)==null||a.acquireDepth(ji.DEPTH16_BUFFER)}_discardSnapshot(t){this._snapshots[t]=Ie(this._snapshots[t])}_discardSnapshots(){for(let t=0;t<this._snapshots.length;++t)this._discardSnapshot(t);this._snapshots.length=0}_bindFbo(){var t;this._fbos.rctx.bindFramebuffer((t=this._handle)==null?void 0:t.fbo)}_constructCascade(t,r,i,s){const a=this._cascades[t],n=-this._cascadeDistances[t],o=-this._cascadeDistances[t+1],l=(r[10]*n+r[14])/Math.abs(r[11]*n+r[15]),h=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]);Ce(l<h);for(let _=0;_<8;++_){Nt(gr,_%4==0||_%4==3?-1:1,_%4==0||_%4==1?-1:1,_<4?l:h,1);const x=E[_];oi(x,gr,this._projectionViewInverse),x[0]/=x[3],x[1]/=x[3],x[2]/=x[3]}li(mt,E[0]),a.camera.viewMatrix=Gt(Zs,this._modelViewLight,mt);for(let _=0;_<8;++_)Or(E[_],E[_],a.camera.viewMatrix);let d=E[0][2],p=E[0][2];for(let _=1;_<8;++_)d=Math.min(d,E[_][2]),p=Math.max(p,E[_][2]);d-=200,p+=200,a.camera.near=-p,a.camera.far=-d,ta(i,s,d,p,a.camera),wt(a.lightMat,a.camera.projectionMatrix,a.camera.viewMatrix);const m=this._textureHeight;a.camera.viewport=[t*m,0,m,m]}_setupMatrices(t,r){wt(this._projectionView,t.projectionMatrix,t.viewMatrix),hi(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===Dr.Global?t.eye:Pr(mt,0,0,1);ci(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_computeCascadeDistances(t,r,i){const s=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(us(r/t,4)),s);const a=(r-t)/this._numCascades,n=(r/t)**(1/this._numCascades);let o=t,l=t;for(let h=0;h<this._numCascades+1;++h)this._cascadeDistances[h]=di(o,l,this.settings.splitSchemeLambda),o*=n,l+=a}get test(){}}const Zs=H(),gr=It(),E=[];for(let e=0;e<8;++e)E.push(It());const pr=w(),_r=w(),Ks=w(),mr=w(),fr=w(),mt=He(),ft=[],vr=H(),xr=K.concat(K,K,K,K),I=w(),_e=w(),Z=[w(),w(),w(),w()],R=w(),vt=w(),q=w(),$e=w(),me=w(),fe=w(),Ye=w();function Js(e,t,r,i,s,a,n,o){G(I,0,0);for(let y=0;y<4;++y)Q(I,I,e[y]);ve(I,I,.25),G(_e,0,0);for(let y=4;y<8;++y)Q(_e,_e,e[y]);ve(_e,_e,.25),Te(Z[0],e[4],e[5],.5),Te(Z[1],e[5],e[6],.5),Te(Z[2],e[6],e[7],.5),Te(Z[3],e[7],e[4],.5);let l=0,h=Wt(Z[0],I);for(let y=1;y<4;++y){const T=Wt(Z[y],I);T<h&&(h=T,l=y)}xe(R,Z[l],e[l+4]);const d=R[0];let p,m;R[0]=-R[1],R[1]=d,xe(vt,_e,I),$(vt,R)<0&&gi(R,R),Te(R,R,vt,r),zt(R,R),p=m=$(xe(q,e[0],I),R);for(let y=1;y<8;++y){const T=$(xe(q,e[y],I),R);T<p?p=T:T>m&&(m=T)}pi(i,I),ve(q,R,p-t),Q(i,i,q);let _=-1,x=1,M=0,Y=0;for(let y=0;y<8;++y){xe($e,e[y],i),zt($e,$e);const T=R[0]*$e[1]-R[1]*$e[0];T>0?T>_&&(_=T,M=y):T<x&&(x=T,Y=y)}de(_>0,"leftArea"),de(x<0,"rightArea"),ve(me,R,p),Q(me,me,I),ve(fe,R,m),Q(fe,fe,I),Ye[0]=-R[1],Ye[1]=R[0];const le=qe(i,e[Y],fe,Q(q,fe,Ye),1,s),lt=qe(i,e[M],fe,q,1,a),Ge=qe(i,e[M],me,Q(q,me,Ye),1,n),he=qe(i,e[Y],me,q,1,o);de(le,"rayRay"),de(lt,"rayRay"),de(Ge,"rayRay"),de(he,"rayRay")}function g(e,t){return 3*t+e}const yr=w();function P(e,t){return G(yr,e[t],e[t+3]),yr}const O=w(),c=_i();function ea(e,t,r,i,s){xe(O,r,i),ve(O,O,.5),c[0]=O[0],c[1]=O[1],c[2]=0,c[3]=O[1],c[4]=-O[0],c[5]=0,c[6]=O[0]*O[0]+O[1]*O[1],c[7]=O[0]*O[1]-O[1]*O[0],c[8]=1,c[g(0,2)]=-$(P(c,0),e),c[g(1,2)]=-$(P(c,1),e);let a=$(P(c,0),r)+c[g(0,2)],n=$(P(c,1),r)+c[g(1,2)],o=$(P(c,0),i)+c[g(0,2)],l=$(P(c,1),i)+c[g(1,2)];a=-(a+o)/(n+l),c[g(0,0)]+=c[g(1,0)]*a,c[g(0,1)]+=c[g(1,1)]*a,c[g(0,2)]+=c[g(1,2)]*a,a=1/($(P(c,0),r)+c[g(0,2)]),n=1/($(P(c,1),r)+c[g(1,2)]),c[g(0,0)]*=a,c[g(0,1)]*=a,c[g(0,2)]*=a,c[g(1,0)]*=n,c[g(1,1)]*=n,c[g(1,2)]*=n,c[g(2,0)]=c[g(1,0)],c[g(2,1)]=c[g(1,1)],c[g(2,2)]=c[g(1,2)],c[g(1,2)]+=1,a=$(P(c,1),t)+c[g(1,2)],n=$(P(c,2),t)+c[g(2,2)],o=$(P(c,1),r)+c[g(1,2)],l=$(P(c,2),r)+c[g(2,2)],a=-.5*(a/n+o/l),c[g(1,0)]+=c[g(2,0)]*a,c[g(1,1)]+=c[g(2,1)]*a,c[g(1,2)]+=c[g(2,2)]*a,a=$(P(c,1),t)+c[g(1,2)],n=$(P(c,2),t)+c[g(2,2)],o=-n/a,c[g(1,0)]*=o,c[g(1,1)]*=o,c[g(1,2)]*=o,s[0]=c[0],s[1]=c[1],s[2]=0,s[3]=c[2],s[4]=c[3],s[5]=c[4],s[6]=0,s[7]=c[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=c[6],s[13]=c[7],s[14]=0,s[15]=c[8]}function ta(e,t,r,i,s){const a=1/E[0][3],n=1/E[4][3];Ce(a<n);let o=a+Math.sqrt(a*n);const l=Math.sin(ui(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));o/=l,Js(E,o,l,pr,_r,Ks,mr,fr),ea(pr,_r,mr,fr,s.projectionMatrix),s.projectionMatrix[10]=2/(r-i),s.projectionMatrix[14]=-(r+i)/(r-i)}function ra(e){let{near:t,far:r}=e;return t<2&&(t=2),r<2&&(r=2),t>=r&&(t=2,r=4),{near:t,far:r}}let A=class extends mi{constructor(e){super(e),this._pending=new ia,this._changes=new ss,this._renderers=new Map,this._sortedRenderers=new Ir,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._sortedRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materials(){return this.rendererContext.materials}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccludedDraped(){for(const e of this._renderers.values())if(e.numGeometries!==0&&!e.queryRenderOccludedState(Pe.Occlude))return!0;return!1}get isEmpty(){return!this.updating&&this._renderers.size===0&&this._geometries.size===0}getMaterialRenderer(e){return this._renderers.get(e)}get sortedRenderers(){return this._sortedRenderers}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=as(this._changes);let t=!1;return e.forEach((r,i)=>{let s=this._renderers.get(i);!s&&r.adds.length>0&&(s=new ns({material:i}),s.initializeRenderContext(this.rendererContext.pluginContext,this._materials),this._renderers.set(i,s),t=!0),s&&(s.modify(r),s.numGeometries===0&&(this._renderers.delete(i),s.destroy(),t=!0))}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),this._hasHighlights=we(this._renderers,r=>{const i=r.produces.get(N.DRAPED_MATERIAL);return!!i&&i(D.Highlight)}),this._hasWater=we(this._renderers,r=>{const i=r.produces.get(N.DRAPED_WATER);return!!i&&i(D.Normal)}),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const i=this._pending.empty;for(const s of r)this._pending.adds.add(s);i&&this.notifyChange("updating"),t===Xt.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const r=this._pending.empty,i=this._pending.adds;for(const s of e)i.has(s)?(this._pending.removed.add(s),i.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),t===Xt.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const r=this._changes.updates.length===0;for(const i of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(i),s.updateType=t}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case _t.TRANSFORMATION:case _t.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case _t.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedRenderers.forAll(r=>t=!!r.updateAnimation&&r.updateAnimation(e)||t),t}precompile(e){return this._sortedRenderers.reduce((t,r)=>r.precompile(e)||t,!1)}render(e){this._sortedRenderers.forAll(t=>{const r=t.acquireTechniques(e);r&&(t.render(e,r),os(r))})}intersect(e,t,r,i,s){for(const a of this._geometries.values()){if(!i(a))continue;this._intersectRenderGeometry(a,r,t,0,e,s);const n=this.rendererContext.longitudeCyclical;n&&(a.boundingSphere[0]-a.boundingSphere[3]<n.min&&this._intersectRenderGeometry(a,r,t,n.range,e,s),a.boundingSphere[0]+a.boundingSphere[3]>n.max&&this._intersectRenderGeometry(a,r,t,-n.range,e,s)),s++}return s}_updateSortedMaterialRenderers(){this._sortedRenderers.clear();let e=0;for(const t of this._renderers.values())t.drapedPriority=e++,this._sortedRenderers.push(t);this._sortedRenderers.sort((t,r)=>{var i,s,a,n;return((i=r.material)==null?void 0:i.renderPriority)===((s=t.material)==null?void 0:s.renderPriority)?t.drapedPriority-r.drapedPriority:(((a=r.material)==null?void 0:a.renderPriority)||0)-(((n=t.material)==null?void 0:n.renderPriority)||0)})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes)),this._changes.updates.filterInPlace(({renderGeometry:e})=>!this._pending.has(e)),this._pending.clear()}_intersectRenderGeometry(e,t,r,i,s,a){if(!e.visible||!e.material.visible)return;let n=0;i+=e.transformation[12],n=e.transformation[13],xt[0]=r[0]-i,xt[1]=r[1]-n,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,xt,(o,l,h)=>{sa(t,h,a,e.material.renderPriority,s,e.layerUid,e.graphicUid)},t)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let t;for(const{graphicUid:r}of e)r!=null&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let t;for(const{graphicUid:r}of e)r!=null&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(Ar(e.boundingSphere))),e}get test(){}};u([v()],A.prototype,"drapeSource",void 0),u([v()],A.prototype,"updating",null),u([v()],A.prototype,"rctx",null),u([v({constructOnly:!0})],A.prototype,"rendererContext",void 0),u([v()],A.prototype,"_materials",null),u([v()],A.prototype,"_localOriginFactory",null),u([v({readOnly:!0})],A.prototype,"isEmpty",null),u([v()],A.prototype,"_renderers",void 0),u([v()],A.prototype,"_geometries",void 0),A=u([V("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],A);class ia{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function sa(e,t,r,i,s,a,n){const o=new fi(a,n,t),l=h=>{h.set(xi.OVERLAY,o,e.dist,e.normal,e.transformation,r,i)};if((s.results.min.drapedLayerOrder==null||r>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Vt.MIN&&(s.results.max.drapedLayerOrder==null||r<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Vt.ALL){const h=vi(s.ray);l(h),s.results.all.push(h)}}const xt=w();let wr=class extends ne{constructor(t,r,i){super(t,r,new oe(Ss,()=>se(()=>import("./OverlayCompositing.glsl-BdWJ9dYd.js").then(s=>s.T),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),i)}initializePipeline(t){return t.hasAlpha?re({blending:Et,colorWrite:ie}):re({colorWrite:ie})}};class Ur extends Bi{constructor(){super(...arguments),this.hasAlpha=!1}}u([ki()],Ur.prototype,"hasAlpha",void 0);let jr=class extends Ne{constructor(){super(...arguments),this.overlayIndex=B.INNER,this.opacity=1}};function aa(){const e=new ae;return e.include(At),e.fragment.uniforms.add(new z("tex",t=>t.texture)),e.fragment.uniforms.add(new Fe("overlayIdx",t=>t.overlayIndex)),e.fragment.uniforms.add(new ee("opacity",t=>t.opacity)),e.fragment.main.add(b`vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;`),e}const na=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:jr,build:aa},Symbol.toStringTag,{value:"Module"}));let Cr=class extends ne{constructor(t,r,i){super(t,r,new oe(na,()=>se(()=>import("./OverlayCompositing.glsl-BdWJ9dYd.js").then(s=>s.O),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27]))),i)}},L=class extends ls{constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new jr,this.hasHighlights=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new Ir,this._passParameters=new Nr,this._materials=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new nt,this.worldToPCSRatio=1,this.events=new yi,this.longitudeCyclical=null,this.produces=new Map([[N.DRAPED_MATERIAL,t=>t!==D.Highlight||this.hasHighlights],[N.DRAPED_WATER,()=>this._hasWater]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const{view:e}=this,{_stage:t}=e,r=t.renderer.fboCache,i=t.renderView,{waterTextures:s,textures:a}=i;this._renderContext=new Xs(this._rctx,new Qs(r,e.state.viewingMode)),this.addHandles([ye(()=>s.updating,()=>this.events.emit("content-changed"),De),ye(()=>this.spatialReference,l=>this._localOriginFactory=new Ji(l),De),wi(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0),ye(()=>qr(this.view.highlights),()=>this._sortedDrapeSourceRenderersDirty=!0,De)]),this._materials=new Us(a,this._techniques,()=>{this.notifyChange("rendersOccludedDraped"),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));const{_bindParameters:n,_camera:o}=this;n.slot=N.DRAPED_MATERIAL,n.mainDepth=null,o.near=1,o.far=1e4,o.relativeElevation=null,n.camera=this._camera,n.oitPass=Lr.NONE,n.updateLighting([new Xi(Ci())],0,0,at.Immediate),this.addHandles(this.view.resourceController.scheduler.registerTask(bi.STAGE,this))}destroy(){this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._passParameters.texture=Ee(this._passParameters.texture),this.disposeOverlays()}get _bindParameters(){return this._renderContext.bind}get _rctx(){return this.view._stage.renderView.renderingContext}get _techniques(){return this.view._stage.renderView.techniques}get rctx(){return this._rctx}get materials(){return this._materials}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}get pluginContext(){return this._pluginContext}initializeRenderContext(e){this._pluginContext=e,this._techniques.precompile(Cr)}uninitializeRenderContext(){}acquireTechniques(){return[]}render(){}get updating(){return this._sortedDrapeSourceRenderersDirty||we(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._renderTargets!=null}getMaterialRenderer(e){for(const t of this._renderers.values()){const r=t.getMaterialRenderer(e);if(r)return r}return null}get layers(){return this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers(),this._sortedRenderers.map(e=>e.drapeSource.layer).filter(e=>!!e)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,A)}createDrapeSourceRenderer(e,t,r){const i=this._renderers.get(e);i!=null&&i.destroy();const s=new t({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles(ye(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const t=this._renderers.get(e);t!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e;return((e=this._renderTargets)==null?void 0:e.computeValidity())??0}releaseRenderTargets(){var e;(e=this._renderTargets)==null||e.dispose()}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&dt(e,t=>t.drapeTargetType===ts.WithoutRasterImage)}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=dt(e,t=>t.drapeSourceType===Ve.Features),this._hasDrapedRasterSource=dt(e,t=>t.drapeSourceType===Ve.RasterImage)):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t,r=this._bindParameters.overlayStretch){this._overlays==null&&(this._renderTargets=new ms(this.view._stage.renderer.fboCache),this._overlays=[new er,new er]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=r}disposeOverlays(){this._overlays=null,this._renderTargets=Ee(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,r;if(e!=null)return e===C.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?(t=this._renderTargets)==null?void 0:t.getTexture(C.Color):(r=this._renderTargets)==null?void 0:r.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,t){let r=!1;for(const[i,s]of this._renderers){if(e.done)break;(i.destroyed||t(i))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=we(this._renderers,i=>i.hasHighlights),this.notifyChange("rendersOccludedDraped"),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Ti,e=>e.updatePolicy===es.SYNC)}get isEmpty(){return!ut.OVERLAY_DRAW_DEBUG_TEXTURE&&!we(this._renderers,e=>!e.isEmpty)}get hasWater(){return this._hasWater}get rendersOccludedDraped(){const e=this._renderContext.renderOccludedMask;this._renderContext.renderOccludedMask=yt,++this._techniques.precompiling;const t=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,this._renderContext.renderOccludedMask=e,t}renders(e){if(ut.OVERLAY_DRAW_DEBUG_TEXTURE&&e!==C.Occluded&&e!==C.Highlight)return!0;++this._techniques.precompiling;const t=this._sortedRenderers.some(({renderer:r})=>r.precompile(this._renderContext));return--this._techniques.precompiling,t}get mode(){var e,t;return this.isEmpty?be.Disabled:(e=this._renderTargets)!=null&&e.getTexture(C.WaterNormal)?be.EnabledWithWater:(t=this._renderTargets)!=null&&t.getTexture(C.Color)?be.Enabled:be.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach(r=>t=r.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}precompileShaders(e){if(this._renderTargets){this._bindParameters.alignPixelEnabled=e.alignPixelEnabled,this._bindParameters.highlightGroupName=null,++this._techniques.precompiling;for(const t of this._renderTargets.targets){if(t.content===C.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=t.output;this._renderContext.output=r,this._bindParameters.slot=r===D.Normal?N.DRAPED_WATER:N.DRAPED_MATERIAL,t.content===C.Occluded&&(this._renderContext.renderOccludedMask=yt),this._sortedRenderers.forAll(({drapeSource:i,renderer:s})=>{t.content===C.ColorNoRasterImage&&i.drapeSourceType===Ve.RasterImage||s.precompile(this._renderContext)}),this._renderContext.renderOccludedMask=Ke}--this._techniques.precompiling}}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const t of this._overlays)this.longitudeCyclical?t.setupGeometryViewsCyclical(this.longitudeCyclical):t.setupGeometryView();this._bindParameters.alignPixelEnabled=e.alignPixelEnabled;for(const t of this._renderTargets.targets){if(t.content===C.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)continue;const r=this._drawTarget(B.INNER,t,e),i=this._drawTarget(B.OUTER,t,e);(r||i)&&t.fbo.generateMipMap()}}}_drawTarget(e,t,r){const i=this._overlays[e],s=i.canvasGeometries;if(s.numViews===0)return!1;const{contentPixelRatio:a}=r;this._screenToWorldRatio=a*i.mapUnitsPerPixel/this._bindParameters.overlayStretch;const n=t.output;if(this.isEmpty||n===D.Normal&&!this.hasWater||!i.hasSomeSizedView())return!1;const{_rctx:o,_bindParameters:l}=this;if(this._camera.pixelRatio=i.pixelRatio*a,this._renderContext.output=n,l.screenToWorldRatio=this._screenToWorldRatio,l.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,l.slot=n===D.Normal?N.DRAPED_WATER:N.DRAPED_MATERIAL,t.content===C.Occluded&&(this._renderContext.renderOccludedMask=yt),l.highlightGroupName=null,!this.renders(t.content))return this._renderContext.renderOccludedMask=Ke,!1;const{resolution:h}=i,d=e===B.INNER?0:h;if(o.setViewport(d,0,h,h),this._bindTargetFBO(t),e===B.INNER&&(o.setClearColor(0,0,0,0),o.clear(te.COLOR)),ut.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==C.Occluded&&t.content!==C.Highlight){this._techniques.precompile(wr,Dt);const p=this._techniques.acquire(wr,Dt);for(let m=0;m<s.numViews;m++)this._setViewParameters(s.extents[m],i),this._ensureDebugPatternResources(i.resolution,la[e]),o.bindTechnique(p,l,this._passParameters),o.screen.draw();p.release()}if(t.output===D.Highlight){const{fboCache:p}=this.view._stage.renderer,m=this._resolution;qs(o,p,{width:m,height:m},this.view.highlights,l,()=>this._renderAllGeometry(e,t),d,()=>this._bindTargetFBO(t))}else this._renderAllGeometry(e,t);return o.bindFramebuffer(null),this._renderContext.renderOccludedMask=Ke,!0}_renderAllGeometry(e,t){const r=this._overlays[e],i=r.canvasGeometries;this._sortedRenderers.forAll(({drapeSource:s,renderer:a})=>{if(t.content===C.ColorNoRasterImage&&s.drapeSourceType===Ve.RasterImage)return;const{fullOpacity:n}=s,o=n!=null&&n<1&&t.output===D.Color&&this._bindTemporaryFBO();for(let l=0;l<i.numViews;l++)this._setViewParameters(i.extents[l],r),a.render(this._renderContext);if(o){this._bindTargetFBO(t),this._overlayParameters.texture=o.getTexture(),this._overlayParameters.opacity=n,this._overlayParameters.overlayIndex=e;const l=this._techniques.acquire(Cr);this._rctx.bindTechnique(l,this._bindParameters,this._overlayParameters),this._rctx.screen.draw(),l.release(),o.release()}})}_bindTargetFBO(e){const t=this._resolution,r=2*t;e.fbo.bind(this._rctx,r,t)}_bindTemporaryFBO(){const e=this._resolution,t=2*e,r=this.view._stage.renderer.fboCache,i=r.acquire(t,e,"overlay tmp");return r.rctx.bindFramebuffer(i.fbo),r.rctx.clear(te.COLOR),i}get _resolution(){var e;return((e=this._overlays)==null?void 0:e[B.INNER].resolution)??0}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,r,i){var a;this._sortedDrapeSourceRenderersDirty&&this._updateSortedDrapeSourceRenderers();let s=0;for(const{renderer:n}of this._sortedRenderers)s=((a=n.intersect)==null?void 0:a.call(n,e,t,r,i,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers,t=e.length;this._renderers.forEach((r,i)=>{const s=e.indexOf(i.layer),a=s>=0,n=i.renderGroup??(a?kt.MapLayer:kt.ViewLayer),o=t*n+(a?s:0);this._sortedRenderers.push(new oa(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,t){const r=this._camera;r.viewport=[0,0,t.resolution,t.resolution],Ri(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),Si(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=we(this._renderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water"))}_ensureDebugPatternResources(e,t){if(Pr(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let i=0;for(let a=0;a<e;a++)for(let n=0;n<e;n++){const o=Math.floor(n/10),l=Math.floor(a/10);o<2||l<2||10*o>e-20||10*l>e-20?(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=255):(r[i++]=255,r[i++]=255,r[i++]=255,r[i++]=1&o&&1&l?1&n^1&a?0:255:1&o^1&l?0:128)}const s=new Rr(e);s.samplingMode=Sr.NEAREST,this._passParameters.texture=new Je(this._rctx,s,r)}get test(){}};u([v()],L.prototype,"hasHighlights",void 0),u([v()],L.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([v({constructOnly:!0})],L.prototype,"view",void 0),u([v({readOnly:!0})],L.prototype,"_techniques",null),u([v()],L.prototype,"worldToPCSRatio",void 0),u([v()],L.prototype,"spatialReference",void 0),u([v({type:Boolean,readOnly:!0})],L.prototype,"updating",null),u([v()],L.prototype,"isEmpty",null),u([v({readOnly:!0})],L.prototype,"rendersOccludedDraped",null),L=u([V("esri.views.3d.terrain.OverlayRenderer")],L);class oa{constructor(t,r,i){this.drapeSource=t,this.renderer=r,this.index=i}}const la=[[1,.5,.5],[.5,.5,1]],ha=-2,yt=Pe.OccludeAndTransparent,Dt=new Ur;Dt.hasAlpha=!0;let pn=class{constructor(t,r={}){this.geometry=t,this.screenToWorldRatio=1,this._transformation=H(),this._shaderTransformation=null,this._boundingSphere=null,this.id=$i(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.castShadow=r.castShadow??!1,r.objectShaderTransformation&&this.objectShaderTransformationChanged(r.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(t){Oi(this._transformation,t),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(t){t==null?this._shaderTransformation=null:(this._shaderTransformation??(this._shaderTransformation=H()),wt(this._shaderTransformation,t,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){return this.boundingInfo?(this._boundingSphere==null&&(this._boundingSphere??(this._boundingSphere=Di()),Or(Ar(this._boundingSphere),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*Pi(this.shaderTransformation)),this._boundingSphere):Ii}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this._shaderTransformation??this.transformation}get attributes(){return this.geometry.attributes}get highlight(){return this.geometry.highlights}foreachHighlightGroup(t){this.geometry.foreachHighlightGroup(t)}get hasHighlights(){return this.geometry.hasHighlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(t){this.geometry.visible=t}};const S={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},ca={dash:S.dash,"dash-dot":[...S.dash,...S.dot],dot:S.dot,"long-dash":S["long-dash"],"long-dash-dot":[...S["long-dash"],...S.dot],"long-dash-dot-dot":[...S["long-dash"],...S.dot,...S.dot],none:null,"short-dash":S["short-dash"],"short-dash-dot":[...S["short-dash"],...S["short-dot"]],"short-dash-dot-dot":[...S["short-dash"],...S["short-dot"],...S["short-dot"]],"short-dot":S["short-dot"],solid:null},da=8;function ua(e,t){return e==null?e:{pattern:e.slice(),pixelRatio:t}}function mn(e){return{pattern:[e,e],pixelRatio:2}}function fn(e){return(e==null?void 0:e.type)==="style"?ga(e.style):null}function ga(e){return e!=null?ua(ca[e],da):null}function vn(e,t,r=null){const i=[],s=t.mapPositions;pa(t,i);const a=i[0][1].data,n=i[0][1].indices.length,o=Zi(n);return _a(t,i,o),va(t,i,o),ma(t,i,o),fa(t,i,o),xa(t,i,o),ya(t,i,o),wa(t,i,a),new Yi(e,i,s,Ai.Line,r)}function pa(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,s=Ca(r)&&i,a=r.length/3-(s?1:0),n=new Array(2*(a-1)),o=s?r.slice(0,-3):r;let l=0;for(let h=0;h<a-1;h++)n[l++]=h,n[l++]=h+1;t.push([F.POSITION,new X(o,n,3,s)])}function _a(e,t,r){if(e.attributeData.colorFeature!=null)return;const i=e.attributeData.color;t.push([F.COLOR,new X(i??Ei,r,4)])}function ma(e,t,r){e.attributeData.normal&&t.push([F.NORMAL,new X(e.attributeData.normal,r,3)])}function fa(e,t,r){e.attributeData.colorFeature!=null&&t.push([F.COLORFEATUREATTRIBUTE,new X([e.attributeData.colorFeature],r,1,!0)])}function va(e,t,r){e.attributeData.sizeFeature==null&&t.push([F.SIZE,new X([e.attributeData.size??1],r,1,!0)])}function xa(e,t,r){e.attributeData.sizeFeature!=null&&t.push([F.SIZEFEATUREATTRIBUTE,new X([e.attributeData.sizeFeature],r,1,!0)])}function ya(e,t,r){e.attributeData.opacityFeature!=null&&t.push([F.OPACITYFEATUREATTRIBUTE,new X([e.attributeData.opacityFeature],r,1,!0)])}function wa(e,t,r){if(e.overlayInfo==null||e.overlayInfo.renderCoordsHelper.viewingMode!==Dr.Global||!e.overlayInfo.spatialReference.isGeographic)return;const i=Er(r.length),s=Fi(e.overlayInfo.spatialReference);for(let p=0;p<i.length;p+=3)Mi(r,p,i,p,s);const a=r.length/3,n=Qi(a+1);let o=ba,l=Ta,h=0,d=0;G(o,i[d++],i[d++]),d++,n[0]=0;for(let p=1;p<a+1;++p)p===a&&(d=0),G(l,i[d++],i[d++]),d++,h+=Li(o,l),n[p]=h,[o,l]=[l,o];t.push([F.DISTANCETOSTART,new X(n,t[0][1].indices,1,!0)])}function Ca(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}const ba=w(),Ta=w();function xn(e,t,r,i){const s=e.type==="polygon"?et.CCW_IS_HOLE:et.NONE,a=e.type==="polygon"?e.rings:e.paths,{position:n,outlines:o}=Hr(a,!!e.hasZ,s,e.spatialReference),l=Er(n.length),h=rs(n,e.spatialReference,0,l,0,n,0,n.length/3,t,r,i),d=h!=null;return{lines:d?Br(o,n,l):[],projectionSuccess:d,sampledElevation:h}}function yn(e,t){const r=e.type==="polygon"?et.CCW_IS_HOLE:et.NONE,i=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:a}=Hr(i,!1,r),n=Hi(s,e.spatialReference,0,s,t,0);for(let o=2;o<s.length;o+=3)s[o]=ha;return{lines:n?Br(a,s):[],projectionSuccess:n}}function Br(e,t,r=null){const i=new Array;for(const{index:s,count:a}of e){if(a<=1)continue;const n=3*s,o=3*a;i.push({position:qt(t,3*s,3*a),mapPositions:r!=null?qt(r,n,o):void 0})}return i}export{mn as a,vn as b,Ds as c,$s as d,J as e,it as f,pn as g,Xa as h,As as i,zr as j,Ls as k,yn as l,Nr as m,fn as n,Gr as o,xn as p,Rs as q,ha as r,Fs as s,jr as t,Wr as u,aa as v};
