import{BT as e,Bf as t,Bs as n,Cl as r,HE as i,Ml as a,NE as o,Nl as s,Ol as c,Pl as l,Ps as u,Ts as d,Vf as f,al as p,bf as m,c_ as h,f_ as g,gD as _,gf as v,jl as y,kE as b,ml as x,oT as S,pl as C,rl as w,sl as T,tD as E,u_ as D,vl as O,vm as k,ws as A,xf as j,yl as M,ym as N,yw as P}from"./index-CzMixifc.js";import{a as F,r as I}from"./Indices-DELx3He_.js";import{E as L,H as R,O as z,U as B,n as V,o as ee,r as te,s as ne,u as H,x as U}from"./BufferView-BPABY7if.js";import{a as W}from"./Util-YNFIi00s.js";import{l as re}from"./Emissions.glsl-nadaueeL.js";import{t as ie}from"./NoParameters-B66z9IwQ.js";import{t as ae}from"./triangle-B4dfMIWc.js";import{c as oe,i as se,o as ce,u as le}from"./renderState-DH1meWdn.js";import{r as ue}from"./MaterialUtil-BLN1UlUe.js";var de=class{constructor(){this.uid=P()}},fe=class extends de{constructor(e){super(),this.highlightName=e,this.channel=0}},pe=class extends de{constructor(){super(...arguments),this.channel=1}},me=ce(1,0,1,771);function he(e,t=!1){switch(e){case 0:return t?oe:le;case 1:return me;case 2:case 3:return null}}function ge(e){if(e.draped)return null;switch(e.oitPass){case 0:case 2:return e.writeDepth?se:null;case 1:case 3:return null}}function _e(e,t=513){return{func:e===0||e===2?t:515}}var ve={factor:-1,units:-2},ye=5e5;function be({oitPass:e,enableOffset:t}){return t&&e===1?ve:null}function xe(e,t){return e===1?t?{buffers:[d,A,u]}:{buffers:[d,A]}:t?{buffers:[d,A]}:null}var Se=class{constructor(e){this._bits=[...e]}equals(e){return E(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}},Ce=class extends ie{constructor(){super(),this._parameterBits=this._parameterBits?.map(()=>0)??[],this._parameterNames??=[]}get key(){return this._key??=new Se(this._parameterBits),this._key}decode(e=this.key){let t=this._parameterBits;this._parameterBits=[...e.bits];let n=this._parameterNames.map(e=>`    ${e}: ${this[e]}`).join(`
`);return this._parameterBits=t,n}};function G(t={}){return(n,r)=>{n.hasOwnProperty(`_parameterNames`)||Object.defineProperty(n,`_parameterNames`,{value:n._parameterNames?.slice()??[],configurable:!0,writable:!0}),n.hasOwnProperty(`_parameterBits`)||Object.defineProperty(n,`_parameterBits`,{value:n._parameterBits?.slice()??[0],configurable:!0,writable:!0}),n._parameterNames.push(r);let i=t.count||2,a=Math.ceil(Math.log2(i)),o=n._parameterBits,s=0;for(;o[s]+a>16;)s++,s>=o.length&&o.push(0);let c=o[s],l=(1<<a)-1<<c;o[s]+=a,t.count?Object.defineProperty(n,r,{get(){return(this._parameterBits[s]&l)>>c},set(n){if(this[r]!==n){if(this._key=null,this._parameterBits[s]=this._parameterBits[s]&~l|+n<<c&l,typeof n!=`number`)throw new e(`internal:invalid-shader-configuration`,`Configuration value for ${r} must be a number, got ${typeof n}`);if(t.count==null)throw new e(`internal:invalid-shader-configuration`,`Configuration value for ${r} must provide a count option`)}}}):Object.defineProperty(n,r,{get(){return!!((this._parameterBits[s]&l)>>c)},set(t){if(this[r]!==t&&(this._key=null,this._parameterBits[s]=this._parameterBits[s]&~l|+t<<c&l,typeof t!=`boolean`))throw new e(`internal:invalid-shader-configuration`,`Configuration value for ${r} must be boolean, got ${typeof t}`)}})}}function we(e){if(e.length<1024)return Array.from(e);if(Array.isArray(e))return Float64Array.from(e);if(!(`BYTES_PER_ELEMENT`in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return o(e)?B().from(e):b(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}}var Te=class e{get center(){return D(this._data[0],this._data[1],this._data[2])}get radius(){return this._data[3]}get bbMin(){return D(this._data[4],this._data[5],this._data[6])}get bbMax(){return D(this._data[7],this._data[8],this._data[9])}constructor(e,t,n){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=n,this._data=[.1,0,0,0,0,0,0,0,0,0],this._children=void 0,W(e.length>=1),W(n.size===3||n.size===4);let{data:r,size:i,indices:a}=n;W(a.length%this._numIndexPerPrimitive===0),W(a.length>=e.length*this._numIndexPerPrimitive);let o=e.length,s=i*a[this._numIndexPerPrimitive*e[0]];K.clear(),K.push(s);let c=D(r[s],r[s+1],r[s+2]),l=g(c);for(let t=0;t<o;++t){let n=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){s=i*a[n+e],K.push(s);let t=r[s];c[0]=Math.min(t,c[0]),l[0]=Math.max(t,l[0]),t=r[s+1],c[1]=Math.min(t,c[1]),l[1]=Math.max(t,l[1]),t=r[s+2],c[2]=Math.min(t,c[2]),l[2]=Math.max(t,l[2])}}for(let e=0;e<3;++e)this._data[4+e]=c[e],this._data[7+e]=l[e];let u=T(h(),this.bbMin,this.bbMax,.5),d=.5*Math.max(Math.max(l[0]-c[0],l[1]-c[1]),l[2]-c[2]),f=d*d;for(let e=0;e<K.length;++e){s=K.at(e);let t=r[s]-u[0],n=r[s+1]-u[1],i=r[s+2]-u[2],a=t*t+n*n+i*i;if(a<=f)continue;let o=Math.sqrt(a),c=.5*(o-d);d+=c,f=d*d;let l=c/o;u[0]+=t*l,u[1]+=n*l,u[2]+=i*l}this._data[3]=d;for(let e=0;e<3;++e)this._data[0+e]=u[e];K.clear()}getChildren(){if(this._children||l(this.bbMin,this.bbMax)<=1)return this._children;let t=T(h(),this.bbMin,this.bbMax,.5),n=this.primitiveIndices.length,r=new Uint8Array(n),i=Array(8);for(let e=0;e<8;++e)i[e]=0;let{data:a,size:o,indices:s}=this.position;for(let e=0;e<n;++e){let n=0,c=this._numIndexPerPrimitive*this.primitiveIndices[e],l=o*s[c],u=a[l],d=a[l+1],f=a[l+2];for(let e=1;e<this._numIndexPerPrimitive;++e){l=o*s[c+e];let t=a[l],n=a[l+1],r=a[l+2];t<u&&(u=t),n<d&&(d=n),r<f&&(f=r)}u<t[0]&&(n|=1),d<t[1]&&(n|=2),f<t[2]&&(n|=4),r[e]=n,++i[n]}let c=0;for(let e=0;e<8;++e)i[e]>0&&++c;if(c<2)return;let u=Array(8);for(let e=0;e<8;++e)u[e]=i[e]>0?new Uint32Array(i[e]):void 0;for(let e=0;e<8;++e)i[e]=0;for(let e=0;e<n;++e){let t=r[e];u[t][i[t]++]=this.primitiveIndices[e]}this._children=[];for(let t=0;t<8;++t)u[t]!==void 0&&this._children.push(new e(u[t],this._numIndexPerPrimitive,this.position));return this._children}static prune(){K.prune()}},K=new S({deallocator:null}),Ee=class{constructor(e){this.id=P(),this._attributes=new Map;for(let[t,n]of e)this._attributes.set(t,{...n,indices:I(n.indices)})}get attributes(){return this._attributes}};function De(e,t){if(!e)return!1;let{size:n,data:i,indices:a}=e;c(t,0,0,0),c(Y,0,0,0);let o=0,l=0;for(let e=0;e<a.length-2;e+=3){let u=a[e]*n,d=a[e+1]*n,f=a[e+2]*n;c(q,i[u],i[u+1],i[u+2]),c(J,i[d],i[d+1],i[d+2]),c(Ae,i[f],i[f+1],i[f+2]);let p=ae(q,J,Ae);p?(s(q,q,J),s(q,q,Ae),r(q,q,1/3*p),s(t,t,q),o+=p):(s(Y,Y,q),s(Y,Y,J),s(Y,Y,Ae),l+=3)}return(l!==0||o!==0)&&(o===0?l!==0&&(r(t,Y,1/l),!0):(r(t,t,1/o),!0))}function Oe(e,t){if(!e)return!1;let{size:n,data:i,indices:a}=e;c(t,0,0,0);let o=-1,s=0;for(let e=0;e<a.length;e++){let r=a[e]*n;o!==r&&(t[0]+=i[r],t[1]+=i[r+1],t[2]+=i[r+2],s++),o=r}return s>1&&r(t,t,1/s),s>0}function ke(e,t,n){if(!e)return!1;c(n,0,0,0),c(Y,0,0,0);let i=0,a=0,{size:o,data:l,indices:u}=e,d=u.length-1,f=d+(t?2:0);for(let e=0;e<f;e+=2){let t=e<d?e+1:0,c=u[e<d?e:d]*o,f=u[t]*o;q[0]=l[c],q[1]=l[c+1],q[2]=l[c+2],J[0]=l[f],J[1]=l[f+1],J[2]=l[f+2],r(q,s(q,q,J),.5);let p=x(q,J);p>0?(s(n,n,r(q,q,p)),i+=p):i===0&&(s(Y,Y,q),a++)}return i===0?a!==0&&(r(n,Y,1/a),!0):(r(n,n,1/i),!0)}var q=h(),J=h(),Ae=h(),Y=h(),je=class e extends Ee{constructor(e,t,n=null,r=0,i=null,a=-1,o){super(t),this.material=e,this.mapPositions=n,this.type=r,this.olidColor=i,this.edgeIndicesLength=a,this.baseGeometry=o,this._highlights=null,this._highlightOptionsCounts=null,this.visible=!0,this._boundingInfo=null;let s=this.positionAttribute;s!=null&&this.edgeIndicesLength<0&&(this.edgeIndicesLength=s.indices.length)}instantiate(t={}){let n=new e(t.material||this.material,[],this.mapPositions,this.type,this.olidColor,this.edgeIndicesLength,this.baseGeometry);return this._attributes.forEach((e,t)=>{e.exclusive=!1,n._attributes.set(t,e)}),n._boundingInfo=this._boundingInfo,n.transformation=t.transformation||this.transformation,n}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:we(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){let r=this._attributes.get(e);r?this._attributes.set(e,{...r,exclusive:!0,data:t}):n()&&console.warn(`Setting undefined attribute ${e} data`)}get positionAttribute(){return this.attributes.get(`position`)??this.baseGeometry?.attributes.get(`position`)}get indexCount(){return this._attributes.values().next().value?.indices?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo??=this._calculateBoundingInfo(),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===0?this._computeAttachmentOriginTriangles(e):this.type===2?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&p(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){let t=this.positionAttribute;return De(t,e)}_computeAttachmentOriginLines(e){let t=this.positionAttribute;return ke(t,Me(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){let t=this.positionAttribute;return Oe(t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){let e=this.positionAttribute;if(!e||e.indices.length===0)return null;let t=this.type===0?3:1;W(e.indices.length%t===0,`Indexing error: `+e.indices.length+` not divisible by `+t);let n=F(e.indices.length/t);return new Te(n,t,e)}get transformation(){return this._transformation??t}set transformation(e){this._transformation=e&&e!==t?f(e):null}get highlights(){return this._highlights||Ne}get hasHighlights(){return(this._highlightOptionsCounts?.size??0)>0}foreachHighlightOptions(e){this._highlightOptionsCounts?.forEach((t,n)=>e(n))}allocateIdAndHighlight(e){let t=new fe(e);return this.addHighlight(t)}addHighlight(e){this._ensureHighlights().add(e);let{highlightName:t}=e,n=(this._highlightOptionsCounts?.get(t)??0)+1;return this._ensureHighlightOptionsCounts().set(t,n),e}_ensureHighlights(){let e=this._highlights;return e||(e=new Set,this._highlights=e),e}_ensureHighlightOptionsCounts(){let e=this._highlightOptionsCounts;return e||(e=new Map,this._highlightOptionsCounts=e),e}removeHighlight(e){if(this._highlights?.delete(e)){let{highlightName:t}=e,n=this._highlightOptionsCounts?.get(t)??0;n<=1?this._highlightOptionsCounts?.delete(t):this._ensureHighlightOptionsCounts().set(t,n-1)}}};function Me(e,t){return!(!(`isClosed`in e)||!e.isClosed)&&t.indices.length>2}var Ne=new Set,Pe=class extends Ce{constructor(){super(...arguments),this.output=0,this.hasEmission=!1}};_([G({count:10})],Pe.prototype,`output`,void 0),_([G()],Pe.prototype,`hasEmission`,void 0);var Fe=class extends Pe{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}},X=class extends Fe{constructor(){super(...arguments),this.oitPass=0,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=1,this.instanced=!1,this.writeDepth=!0,this.oitPremultipliedAlpha=!1}};_([G({count:3})],X.prototype,`oitPass`,void 0),_([G()],X.prototype,`hasSlicePlane`,void 0),_([G()],X.prototype,`hasHighlightMixTexture`,void 0);var Ie=class{constructor(e,t){this.id=P(),this.supportsEdges=!1,this._renderPriority=0,this._parameters=new t,ue(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){ue(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&(this.parameters.renderOccluded&e.renderOccludedMask)!==0}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:0}get hasEmissions(){return!1}getConfiguration(e,t,n=new X){return n.output=e,n.hasEmission=t.hasEmission&&re(e),n.hasHighlightMixTexture=e===8&&t.highlightMixTexture!=null,n}},Le=class extends ie{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}};function Re(e,t,n,r=1){let{data:i,indices:a}=e,o=t.typedBuffer,s=t.typedBufferStride,c=a.length;if(n*=s,r===1)for(let e=0;e<c;++e)o[n]=i[a[e]],n+=s;else for(let e=0;e<c;++e){let t=i[a[e]];for(let e=0;e<r;e++)o[n]=t,n+=s}}function ze(e,t,n){let{data:r,indices:i}=e,a=t.typedBuffer,o=t.typedBufferStride,s=i.length;n*=o;for(let e=0;e<s;++e){let t=2*i[e];a[n]=r[t],a[n+1]=r[t+1],n+=o}}function Be(e,t,n,r=1){let{data:i,indices:a}=e,o=t.typedBuffer,s=t.typedBufferStride,c=a.length;if(n*=s,r===1)for(let e=0;e<c;++e){let t=3*a[e];o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2],n+=s}else for(let e=0;e<c;++e){let t=3*a[e];for(let e=0;e<r;++e)o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2],n+=s}}function Ve(e,t,n,r=1){let{data:i,indices:a}=e,o=t.typedBuffer,s=t.typedBufferStride,c=a.length;if(n*=s,r===1)for(let e=0;e<c;++e){let t=4*a[e];o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2],o[n+3]=i[t+3],n+=s}else for(let e=0;e<c;++e){let t=4*a[e];for(let e=0;e<r;++e)o[n]=i[t],o[n+1]=i[t+1],o[n+2]=i[t+2],o[n+3]=i[t+3],n+=s}}function He(e,t,n){let r=e.typedBuffer,i=e.typedBufferStride;t*=i;for(let e=0;e<n;++e)r[t]=0,r[t+1]=0,r[t+2]=0,r[t+3]=0,t+=i}function Ue(e,t,n,r,i=1){if(!t)return void Be(e,n,r,i);let{data:a,indices:o}=e,s=n.typedBuffer,c=n.typedBufferStride,l=o.length,u=t[0],d=t[1],f=t[2],p=t[4],m=t[5],h=t[6],g=t[8],_=t[9],v=t[10],y=t[12],b=t[13],x=t[14];r*=c;let S=0,C=0,w=0,T=N(t)?e=>{S=a[e]+y,C=a[e+1]+b,w=a[e+2]+x}:e=>{let t=a[e],n=a[e+1],r=a[e+2];S=u*t+p*n+g*r+y,C=d*t+m*n+_*r+b,w=f*t+h*n+v*r+x};if(i===1)for(let e=0;e<l;++e)T(3*o[e]),s[r]=S,s[r+1]=C,s[r+2]=w,r+=c;else for(let e=0;e<l;++e){T(3*o[e]);for(let e=0;e<i;++e)s[r]=S,s[r+1]=C,s[r+2]=w,r+=c}}function We(e,t,n,r,i=1){if(!t)return void Be(e,n,r,i);let{data:a,indices:o}=e,s=t,c=n.typedBuffer,l=n.typedBufferStride,u=o.length,d=s[0],f=s[1],p=s[2],m=s[4],h=s[5],g=s[6],_=s[8],v=s[9],y=s[10],b=!k(s),x=1e-6,S=1-x;r*=l;let C=0,w=0,T=0,E=N(s)?e=>{C=a[e],w=a[e+1],T=a[e+2]}:e=>{let t=a[e],n=a[e+1],r=a[e+2];C=d*t+m*n+_*r,w=f*t+h*n+v*r,T=p*t+g*n+y*r};if(i===1)if(b)for(let e=0;e<u;++e){E(3*o[e]);let t=C*C+w*w+T*T;if(t<S&&t>x){let e=1/Math.sqrt(t);c[r]=C*e,c[r+1]=w*e,c[r+2]=T*e}else c[r]=C,c[r+1]=w,c[r+2]=T;r+=l}else for(let e=0;e<u;++e)E(3*o[e]),c[r]=C,c[r+1]=w,c[r+2]=T,r+=l;else for(let e=0;e<u;++e){if(E(3*o[e]),b){let e=C*C+w*w+T*T;if(e<S&&e>x){let t=1/Math.sqrt(e);C*=t,w*=t,T*=t}}for(let e=0;e<i;++e)c[r]=C,c[r+1]=w,c[r+2]=T,r+=l}}function Ge(e,t,n,r,i=1){if(!t)return void Ve(e,n,r,i);let{data:a,indices:o}=e,s=t,c=n.typedBuffer,l=n.typedBufferStride,u=o.length,d=s[0],f=s[1],p=s[2],m=s[4],h=s[5],g=s[6],_=s[8],v=s[9],y=s[10],b=!k(s),x=1e-6,S=1-x;if(r*=l,i===1)for(let e=0;e<u;++e){let t=4*o[e],n=a[t],i=a[t+1],s=a[t+2],u=a[t+3],C=d*n+m*i+_*s,w=f*n+h*i+v*s,T=p*n+g*i+y*s;if(b){let e=C*C+w*w+T*T;if(e<S&&e>x){let t=1/Math.sqrt(e);C*=t,w*=t,T*=t}}c[r]=C,c[r+1]=w,c[r+2]=T,c[r+3]=u,r+=l}else for(let e=0;e<u;++e){let t=4*o[e],n=a[t],s=a[t+1],u=a[t+2],C=a[t+3],w=d*n+m*s+_*u,T=f*n+h*s+v*u,E=p*n+g*s+y*u;if(b){let e=w*w+T*T+E*E;if(e<S&&e>x){let t=1/Math.sqrt(e);w*=t,T*=t,E*=t}}for(let e=0;e<i;++e)c[r]=w,c[r+1]=T,c[r+2]=E,c[r+3]=C,r+=l}}function Ke(e,t,n,r,i=1){let{data:a,indices:o}=e,s=n.typedBuffer,c=n.typedBufferStride,l=o.length;if(r*=c,t===a.length&&t===4){s[r]=a[0],s[r+1]=a[1],s[r+2]=a[2],s[r+3]=a[3];let e=new Uint32Array(n.typedBuffer.buffer,n.start),t=c/4,o=e[r/=4];r+=t;let u=l*i;for(let n=1;n<u;++n)e[r]=o,r+=t;return}if(i!==1)if(t!==4)for(let e=0;e<l;++e){let t=3*o[e];for(let e=0;e<i;++e)s[r]=a[t],s[r+1]=a[t+1],s[r+2]=a[t+2],s[r+3]=255,r+=c}else for(let e=0;e<l;++e){let t=4*o[e];for(let e=0;e<i;++e)s[r]=a[t],s[r+1]=a[t+1],s[r+2]=a[t+2],s[r+3]=a[t+3],r+=c}else{if(t===4){for(let e=0;e<l;++e){let t=4*o[e];s[r]=a[t],s[r+1]=a[t+1],s[r+2]=a[t+2],s[r+3]=a[t+3],r+=c}return}for(let e=0;e<l;++e){let t=3*o[e];s[r]=a[t],s[r+1]=a[t+1],s[r+2]=a[t+2],s[r+3]=255,r+=c}}}function qe(e,t,n){let{data:r,indices:i}=e,a=t.typedBuffer,o=t.typedBufferStride,s=i.length,c=r[0];n*=o;for(let e=0;e<s;++e)a[n]=c,n+=o}function Je(e,t,n,i){M(Z,e,t);let a=Math.max(Math.sqrt(y(Z)),1e-4);r(Z,Z,1/a),n[i++]=Z[0],n[i++]=Z[1],n[i++]=Z[2],n[i++]=a}var Z=h();function Ye(e,t,n,r,i=1){let a=t.typedBuffer,o=t.typedBufferStride;if(r*=o,i===1)for(let t=0;t<n;++t)a[r]=e[0],a[r+1]=e[1],a[r+2]=e[2],a[r+3]=e[3],r+=o;else for(let t=0;t<n;++t)for(let t=0;t<i;++t)a[r]=e[0],a[r+1]=e[1],a[r+2]=e[2],a[r+3]=e[3],r+=o}function Xe(e,t,n,r,i,a,o){let s={numItems:0,numVerticesPerItem:0};for(let c of n.fields.keys()){let n=e.get(c),l=n?.indices;if(n&&l)c===`position`&&(s={numItems:1,numVerticesPerItem:l.length}),Ze(c,n,r,i,a,o);else if(c===`olidColor`&&t!=null){let n=e.get(`position`)?.indices;if(n){let e=n.length;Ye(t,a.getField(c,R),e,o)}}}return s}function Ze(e,t,n,r,i,a){switch(e){case`position`:{W(t.size===3);let r=i.getField(e,U);W(!!r,`No buffer view for ${e}`),Ue(t,n,r,a);break}case`normal`:{W(t.size===3);let n=i.getField(e,U);W(!!n,`No buffer view for ${e}`),We(t,r,n,a);break}case`normalCompressed`:case`profileRight`:case`profileUp`:{W(t.size===2);let n=i.getField(e,L);W(!!n,`No buffer view for ${e}`),ze(t,n,a);break}case`uv0`:{W(t.size===2);let n=i.getField(e,ee)??i.getField(e,V);W(!!n,`No buffer view for ${e}`),ze(t,n,a);break}case`uvi`:{W(t.size===2);let n=i.getField(e,L);W(!!n,`No buffer view for ${e}`),ze(t,n,a);break}case`color`:case`symbolColor`:{let n=i.getField(e,R);W(!!n,`No buffer view for ${e}`),W(t.size===3||t.size===4),Ke(t,t.size,n,a);break}case`colorFeatureAttribute`:case`opacityFeatureAttribute`:case`sizeFeatureAttribute`:{let n=i.getField(e,te)??i.getField(e,te);W(!!n,`No buffer view for ${e}`),W(t.size===1),qe(t,n,a);break}case`tangent`:{W(t.size===4);let r=i.getField(e,H);W(!!r,`No buffer view for ${e}`),Ge(t,n,r,a);break}case`profileVertexAndNormal`:{W(t.size===4);let n=i.getField(e,ne)??i.getField(e,H);W(!!n,`No buffer view for ${e}`),Ve(t,n,a);break}case`profileAuxData`:{W(t.size===3);let n=i.getField(e,z)??i.getField(e,U);W(!!n,`No buffer view for ${e}`),Be(t,n,a);break}}}var Qe={func:513},$e={func:519},et={mask:255},tt={mask:0},nt={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},rt={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},it={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},at={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},ot=class{constructor(e=0,t=!1,n=!0){this.tolerance=e,this.isVerticalRay=t,this.normalRequired=n}},Q=m();function st(e,t,n,r,i,a){if(!e.visible)return;let o=C(Dt,r,n),s=(e,t,n)=>a(e,n,t),{tolerance:c}=t,l=new ot(c,!1,t.options.normalRequired);if(e.boundingInfo)W(e.type===0),lt(e.boundingInfo,n,o,c,i,l,s);else{let t=e.positionAttribute,r=t.indices;ht(n,o,0,r.length/3,r,t.data,t.stride,i,l,s)}}var ct=h();function lt(e,t,n,r,i,a,o){if(e==null)return;let s=Ct(n,ct);if(v(Q,e.bbMin),j(Q,e.bbMax),i?.applyToAabb(Q),wt(Q,t,s,r)){let{primitiveIndices:s,position:c}=e,l=s?s.length:c.indices.length/3;if(l>Et){let s=e.getChildren();if(s!==void 0){for(let e of s)lt(e,t,n,r,i,a,o);return}}mt(t,n,0,l,c.indices,c.data,c.stride,s,i,a,o)}}var $=h();function ut(e,t,n,r,i,a,o,s,c){let{data:l,stride:u}=a;ht(e,C(Dt,t,e),n,r,i,l,u,o,s,c)}function dt(e,t,n,r){if(!n.visible)return;let i=(e,t,n)=>r(e,n,t),{boundingInfo:a}=n;if(a){let{bbMin:n,bbMax:r}=a;if(e<n[0]||e>r[0]||t<n[1]||t>r[1])return}let o=n.positionAttribute,s=o.indices;ft(e,t,0,s.length/3,s,o,i)}function ft(e,t,n,r,i,a,o){let{data:s,stride:c}=a;for(let a=n;a<r;++a){let n=3*a,r=c*i[n],l=c*i[n+1],u=c*i[n+2],d=s[r+0]-e,f=s[r+1]-t,p=s[l+0]-e,m=s[l+1]-t,h=s[u+0]-e,g=s[u+1]-t,_=h*m-g*p,v=d*g-f*h,y=p*f-m*d;(_<0||v<0||y<0)&&(_>0||v>0||y>0)||o(0,a,null)}}function pt(e,t,n,r,i,a,o,s){let c=e[0],l=e[1],u=e[2],d=t[0],f=t[1],p=t[2];for(let e=n;e<r;++e){let t=3*e,n=t+1,r=t+2,m=a*t,h=i[m],g=i[m+1],_=i[m+2],v=a*n,y=a*r,b=i[v]-h,x=i[v+1]-g,S=i[v+2]-_,C=i[y]-h,w=i[y+1]-g,T=i[y+2]-_,E=f*T-w*p,D=p*C-T*d,O=d*w-C*f,k=b*E+x*D+S*O;if(Math.abs(k)<=1e-7)continue;let A=c-h,j=l-g,M=u-_,N=A*E+j*D+M*O;if(k>0){if(N<0||N>k)continue}else if(N>0||N<k)continue;let P=j*S-x*M,F=M*b-S*A,I=A*x-b*j,L=d*P+f*F+p*I;if(k>0){if(L<0||N+L>k)continue}else if(L>0||N+L<k)continue;let R=(C*P+w*F+T*I)/k;R>=0&&s(R,e,o?yt(b,x,S,C,w,T,$):null)}}function mt(e,t,n,r,i,a,o,s,c,l,u){let d=e[0],f=e[1],p=e[2],m=t[0],h=t[1],g=t[2],{normalRequired:_}=l;for(let e=n;e<r;++e){let t=s[e],n=3*t,r=o*i[n],l=a[r],v=a[r+1],y=a[r+2],b=o*i[n+1],x=a[b],S=a[b+1],C=a[b+2],w=o*i[n+2],T=a[w],E=a[w+1],D=a[w+2];c!=null&&([l,v,y]=c.applyToVertex(l,v,y,e),[x,S,C]=c.applyToVertex(x,S,C,e),[T,E,D]=c.applyToVertex(T,E,D,e));let O=x-l,k=S-v,A=C-y,j=T-l,M=E-v,N=D-y,P=h*N-M*g,F=g*j-N*m,I=m*M-j*h,L=O*P+k*F+A*I;if(Math.abs(L)<=1e-7)continue;let R=d-l,z=f-v,B=p-y,V=R*P+z*F+B*I;if(L>0){if(V<0||V>L)continue}else if(V>0||V<L)continue;let ee=z*A-k*B,te=B*O-A*R,ne=R*k-O*z,H=m*ee+h*te+g*ne;if(L>0){if(H<0||V+H>L)continue}else if(H>0||V+H<L)continue;let U=(j*ee+M*te+N*ne)/L;U>=0&&u(U,t,_?yt(O,k,A,j,M,N,$):null)}}function ht(e,t,n,r,i,o,s,l,u,d){let f=t,p=Ot,m=Math.abs(f[0]),h=Math.abs(f[1]),g=Math.abs(f[2]),_=m>=h?m>=g?0:2:h>=g?1:2,v=_,y=f[v]<0?2:1,b=(_+y)%3,x=(_+(3-y))%3,S=f[b]/f[v],w=f[x]/f[v],T=1/f[v],E=gt,D=_t,O=vt,{normalRequired:k}=u;for(let t=n;t<r;++t){let n=3*t,r=s*i[n];c(p[0],o[r+0],o[r+1],o[r+2]);let u=s*i[n+1];c(p[1],o[u+0],o[u+1],o[u+2]);let f=s*i[n+2];c(p[2],o[f+0],o[f+1],o[f+2]),l&&(a(p[0],l.applyToVertex(p[0][0],p[0][1],p[0][2],t)),a(p[1],l.applyToVertex(p[1][0],p[1][1],p[1][2],t)),a(p[2],l.applyToVertex(p[2][0],p[2][1],p[2][2],t))),C(E,p[0],e),C(D,p[1],e),C(O,p[2],e);let m=E[b]-S*E[v],h=E[x]-w*E[v],g=D[b]-S*D[v],_=D[x]-w*D[v],y=O[b]-S*O[v],A=O[x]-w*O[v],j=y*_-A*g,M=m*A-h*y,N=g*h-_*m;if((j<0||M<0||N<0)&&(j>0||M>0||N>0))continue;let P=j+M+N;if(P===0)continue;let F=j*(T*E[v])+M*(T*D[v])+N*(T*O[v]);if(F*Math.sign(P)<0)continue;let I=F/P;I>=0&&d(I,t,k?bt(p):null)}}var gt=h(),_t=h(),vt=h();function yt(e,t,n,r,i,a,o){return c(xt,e,t,n),c(St,r,i,a),O(o,xt,St),w(o,o),o}function bt(e){return C(xt,e[1],e[0]),C(St,e[2],e[0]),O($,xt,St),w($,$),$}var xt=h(),St=h();function Ct(e,t){return c(t,1/e[0],1/e[1],1/e[2])}function wt(e,t,n,r){return Tt(e,t,n,r,1/0)}function Tt(e,t,n,r,i){let a=(e[0]-r-t[0])*n[0],o=(e[3]+r-t[0])*n[0],s=Math.min(a,o),c=Math.max(a,o),l=(e[1]-r-t[1])*n[1],u=(e[4]+r-t[1])*n[1];if(c=Math.min(c,Math.max(l,u)),c<0||(s=Math.max(s,Math.min(l,u)),s>c))return!1;let d=(e[2]-r-t[2])*n[2],f=(e[5]+r-t[2])*n[2];return c=Math.min(c,Math.max(d,f)),!(c<0)&&(s=Math.max(s,Math.min(d,f)),!(s>c)&&s<i)}var Et=1e3,Dt=h(),Ot=[h(),h(),h()],kt=class{constructor(e){this.layout=e}elementCount(e){return e.get(`position`).indices.length}write(e,t,n,r,i,a){return Xe(n,r,this.layout,e,t,i,a)}intersect(e,t,n,r,i,a,o){let s=this.layout.createView(e).getField(`position`,U);if(s==null)return;let c=C(At,a,i),l=s.count/3,u=r.options.normalRequired;pt(i,c,0,l,s.typedBuffer,s.typedBufferStride,u,(e,t,n)=>o(e,n,t))}},At=h();export{Ee as A,ge as B,ze as C,Le as D,Ie as E,_e as F,fe as H,ye as I,ve as L,we as M,Ce as N,X as O,G as P,he as R,Je as S,Ue as T,pe as U,xe as V,Xe as _,dt as a,Re as b,nt as c,tt as d,$e as f,He as g,Ye as h,ot as i,Te as j,je as k,at as l,it as m,ut as n,st as o,rt as p,wt as r,Qe as s,kt as t,et as u,Ke as v,Ze as w,Ve as x,We as y,be as z};