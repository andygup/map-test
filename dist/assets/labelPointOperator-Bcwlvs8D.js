import{B as e,I as t,cn as n,in as r,kt as i,mn as a,ut as o,vn as s}from"./Point2D-BslC4Gs9.js";import{t as c}from"./Envelope2D-n2TB2v9l.js";import{Un as l,Wn as u,_t as d,hn as f,x as p,yn as m}from"./SpatialReference-BzfAMI5E.js";import{n as h,t as g}from"./SimpleGeometryCursor-BbFgAuic.js";import{t as _}from"./OperatorProximity-B1IUV103.js";import{h as v,r as y,t as b}from"./apiConverter-BOyb99jX.js";import{n as x}from"./Centroid-DZi-eb9F-CuZY5cfj.js";var S=class{getOperatorType(){return 10203}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t){return new C(e,t)}execute(e,t){return new C(null,t).labelPoint(e)}},C=class extends h{progress_(){}tock(){return!0}getRank(){return 1}constructor(e,t){super(),this.m_index=-1,this.m_progressCounter=0,this.m_progressTracker=t,this.m_inputGeoms=e}next(){let e=this.m_inputGeoms.next();return e?(a(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.labelPoint(e)):null}getGeometryID(){return this.m_index}labelPoint(e){if(e===null&&r(`null pointer is not allowed`),e.getGeometryType()===n.enumPoint)return e;if(e.isEmpty())return new u({vd:e.getDescription()});switch(e.getGeometryType()){case n.enumPolygon:return this.labelPointPolygon(e);case n.enumPolyline:return this.labelPointPolyline(e);case n.enumMultiPoint:return this.labelPointMultiPoint(e);case n.enumEnvelope:return this.labelPointEnvelope(e);default:r(`geometry is not supported`)}}labelPointPolygon(t){let n=new c;t.queryEnvelope(n);let r=l(null,n,!0).total(),a=null,f=t;if(t.hasNonLinearSegments()){let e=new m({copy:t}),n=d(e,.25*r,r);s(n!==t),a=n,f=a}let h=0,g=0;for(let e=0,t=f.getPathCount();e<t;++e){let t=Math.abs(f.calculateRingArea2D(e));t>g&&(g=t,h=e)}let v=new i;if(Math.abs(g)<=2*r*r?v.setNAN():v.assign(x(f,h)),Number.isNaN(v.x)){let e=new c;return f.queryPathEnvelope(h,e),new u({pt:e.getCenter()})}if(f.getPointCount()<4)return new u({x:v.x,y:v.y});let y=i.getNAN(),b=[y.clone(),y.clone(),y.clone(),y.clone()],S=[NaN,NaN,NaN,NaN],C=[NaN,NaN,NaN,NaN],w=!1,T=new _().getNearestCoordinate(f,v,!0,!1);if(T.m_distance===0&&(w=!0,b[0]=v,T=new _().getNearestCoordinate(f,v,!1,!1),T.m_distance>.25*n.minDimension()*1.66666666))return new u({x:v.x,y:v.y});S[0]=T.m_distance,C[0]=0;let E=new i,D=!1,O=.25,k=-1,A=new c;f.queryPathEnvelope(h,A);do{let t=NaN;if(b[1]=this.calculateParacentroid_(f,e(A.xmin,A.xmax,O),r),b[1].isNAN()||(T=new _().getNearestCoordinate(f,b[1],!1,!1),t=T.m_distance),t>r&&p(f,b[1],r)===1)D=!0,S[1]=t,C[1]=i.sqrDistance(b[1],v);else if(t>k&&(k=t,E.setCoordsPoint2D(b[1])),O-=.01,O<.1){if(!(k>=0))break;D=!0,S[1]=k,b[1]=E,C[1]=i.sqrDistance(b[1],v)}}while(!D);D=!1,O=.5,k=-1;let j=.01,M=1;do{let t=NaN;if(b[2]=this.calculateParacentroid_(f,e(A.xmin,A.xmax,O),r),b[2].isNAN()||(T=new _().getNearestCoordinate(f,b[2],!1,!1),t=T.m_distance),t>r&&p(f,b[2],r)===1)D=!0,S[2]=t,C[2]=i.sqrDistance(b[2],v);else if(t>k&&(k=t,E.setCoordsPoint2D(b[2])),O=.5+j*M,j+=.01,M*=-1,O<.3||O>.7){if(!(k>=0))break;D=!0,S[2]=k,b[2]=E,C[2]=i.sqrDistance(b[2],v)}}while(!D);D=!1,O=.75,k=-1;do{let t=NaN;if(b[3]=this.calculateParacentroid_(f,e(A.xmin,A.xmax,O),r),b[3].isNAN()||(T=new _().getNearestCoordinate(f,b[3],!1,!1),t=T.m_distance),t>r&&p(f,b[3],r)===1)D=!0,S[3]=t,C[3]=i.sqrDistance(b[3],v);else if(t>k&&(k=t,E.setCoordsPoint2D(b[3])),O+=.01,O>.9){if(!(k>=0))break;D=!0,S[3]=k,b[3]=E,C[3]=i.sqrDistance(b[3],v)}}while(!D);let N=[0,1,2,3],P=w?0:1;for(let e=P;e<4;e++)for(let e=P;e<3;e++){let t=C[e],n=C[e+1];if(o(t,n)>0){let r=N[e];N[e]=N[e+1],N[e+1]=r,C[e]=n,C[e+1]=t}}let F=P,I=0,L=0;for(let e=P;e<4;e++){switch(e){case 0:L=2*S[N[e]];break;case 1:L=1.66666666*S[N[e]];break;case 2:L=1.33333333*S[N[e]];break;case 3:L=S[N[e]]}L>I&&(I=L,F=N[e])}return s(!b[F].isNAN()),new u({x:b[F].x,y:b[F].y})}labelPointPolyline(e){let t=new i;if(e.getPointCount()>2*e.getPathCount()){let n=-1,r=-Number.MAX_VALUE;for(let t=0,i=e.getPathCount();t<i;t++)if(e.getPathSize(t)>2){let i=e.calculatePathLength2D(t);i>r&&(r=i,n=t)}let i=e.getPathStart(n),a=e.getPathEnd(n),o=Math.trunc((i+a)/2);t.assign(e.getXY(o))}else{let n=-Number.MAX_VALUE,r=e.querySegmentIterator();for(;r.nextPath();)if(r.hasNextSegment()){let e=r.nextSegment(),i=e.calculateLength2D();i>n&&(n=i,t.assign(e.getCoord2D(e.lengthToT(.5*i))))}}return new u({x:t.x,y:t.y})}labelPointMultiPoint(e){let t=new c;e.queryEnvelope(t);let n=t.getCenter(),r=new _().getNearestCoordinate(e,n,!1,!1).m_coordinate;return new u({x:r.x,y:r.y})}labelPointEnvelope(e){let t=e.getCenterXY();return new u({x:t.x,y:t.y})}calculateParacentroid_(e,n,r){let a=new c;e.queryEnvelope(a);let o=new i(n,0),l=Number.MAX_VALUE,u=Number.MAX_VALUE,d=!1,p=!1,m=new f;m.setStartXYCoords(o.x,a.ymin-1),m.setEndXYCoords(o.x,a.ymax+1);let h=new c,g=new i,_=new i,v=t(i,2),y=e.querySegmentIterator();for(;y.nextPath();)for(;y.hasNextSegment();){let e=y.nextSegment();if(e.queryEnvelope(h),s(e.isMonotoneQuickAndDirty()),g.setCoordsPoint2D(m.getStartXY()),_.setCoordsPoint2D(m.getEndXY()),h.clipLine(g,_)===0||m.intersect(e,v,null,null,r)!==1)continue;let t=v[0].y;l>u?t<l&&(l=t,d=!0):t<u&&(u=t,p=!0)}return d&&p?o.y=(l+u)/2:o.setNAN(),o}},w=new S;function T(e){return w.execute(e,null)}function E(e){let t=w.executeMany(new g(e),null);return Array.from(t)}function D(){return w.supportsCurves()}function O(e){return v(T(y(e)),b(e))}function k(e){let t=e.map(y),n=b(e);return E(t).map(e=>v(e,n))}var A=D(),j=Object.freeze(Object.defineProperty({__proto__:null,execute:O,executeMany:k,supportsCurves:A},Symbol.toStringTag,{value:`Module`}));export{k as i,A as n,O as r,j as t};