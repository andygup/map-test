import{Dv as e,RS as t,SC as n,du as r,fS as i,gC as a,ga as o}from"./index-ByaFsVj4.js";import{t as s}from"./urlUtils-7tPnOsRB.js";var c=`Layer does not support extent calculation.`;function l(t,n){let r=t.geometry,a=t.toJSON(),o=a;if(r!=null&&(o.geometry=JSON.stringify(r),o.geometryType=e(r),o.inSR=i(r.spatialReference)),a.topFilter?.groupByFields&&(o.topFilter.groupByFields=a.topFilter.groupByFields.join(`,`)),a.topFilter?.orderByFields&&(o.topFilter.orderByFields=a.topFilter.orderByFields.join(`,`)),a.topFilter&&(o.topFilter=JSON.stringify(o.topFilter)),a.objectIds&&(o.objectIds=a.objectIds.join(`,`)),a.orderByFields&&(o.orderByFields=a.orderByFields.join(`,`)),a.outFields&&!(n?.returnCountOnly||n?.returnExtentOnly||n?.returnIdsOnly)?a.outFields.includes(`*`)?o.outFields=`*`:o.outFields=a.outFields.join(`,`):delete o.outFields,a.outSR?o.outSR=i(a.outSR):r&&a.returnGeometry&&(o.outSR=o.inSR),a.returnGeometry&&delete a.returnGeometry,a.timeExtent){let e=a.timeExtent,{start:t,end:n}=e;t==null&&n==null||(o.time=t===n?t:`${t??`null`},${n??`null`}`),delete a.timeExtent}return o}async function u(e,t,n,r){let i=await m(e,t,`json`,r);return o(t,n,i.data),i}async function d(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:m(e,t,`json`,n,{returnIdsOnly:!0})}async function f(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:m(e,t,`json`,n,{returnExtentOnly:!0,returnCountOnly:!0}).then(e=>{let t=e.data;if(t.hasOwnProperty(`extent`))return e;if(t.features||t.hasOwnProperty(`count`))throw Error(c);return e})}function p(e,t,n){return t.timeExtent!=null&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):m(e,t,`json`,n,{returnIdsOnly:!0,returnCountOnly:!0})}function m(e,i,o,c={},u={}){let d=typeof e==`string`?a(e):e,f=i.geometry?[i.geometry]:[];return c.responseType=`json`,r(f,null,c).then(e=>{let r=e?.[0];r!=null&&((i=i.clone()).geometry=r);let a=s({...d.query,f:o,...u,...l(i,u)});return t(n(d.path,`queryTopFeatures`),{...c,query:{...a,...c.query}})})}export{u as i,f as n,d as r,p as t};