const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AttributeBinsQuery-DDqWAUtw.js","assets/queryUtils-DJQEBA7c.js","assets/index-ByaFsVj4.js","assets/index-DiFef-Um.css","assets/FixedIntervalBinParameters-CVvi6EKG.js","assets/AttributeBinsQuery-RgLfJYUc.js"])))=>i.map(i=>d[i]);
import{A as e,AT as t,Ai as n,BS as r,BT as i,B_ as a,C as o,DT as s,Dh as c,Di as l,E as u,Ha as d,Hp as f,Hw as p,Jf as m,L as h,Li as g,M as _,Mi as v,N_ as y,Ni as ee,O as te,OT as b,P as x,Pn as S,Qf as C,R as w,S as T,Sr as E,Ti as D,U as O,Ui as ne,Vh as re,W as ie,Xw as ae,Zf as k,_ as A,_v as j,ax as M,ba as N,ca as P,gC as F,gD as I,ha as L,iE as R,j as z,ji as B,mp as V,pD as H,rd as U,ta as W,uE as G,ua as K,ud as q,vE as oe,wx as J,xa as se,ya as ce}from"./index-ByaFsVj4.js";import"./memoryEstimations-C5pKF3kD.js";import"./OptimizedGeometry-DX91by73.js";import"./OptimizedFeatureSet-DAaREXtE.js";import"./featureConversionUtils-C045qQF5.js";import"./QueryEngineCapabilities-COyCnRVj.js";import{i as le,r as ue}from"./clientSideDefaults-8lL7sncR.js";import"./date-DKxAu4UK.js";import"./geojson-DV2DU2io.js";import"./xmlUtils-Dwxxb6WI.js";import{c as de,i as fe,r as pe,s as me,t as he}from"./wfsUtils-DDFTQ7-a.js";import{t as ge}from"./AttributeBinsFeatureSet-5T6eXFdE.js";var _e=Symbol(`isWFSGraphicOrigin`),Y,ve=class extends N{get[(Y=_e,m)](){return this.layer}get[k](){return this.layer}get[se](){return this.layer}constructor(e){super(),this[Y]=!0,this.type=`wfs`,this.layer=e}get id(){return this.layer.id}},X=class extends re{constructor(){super(...arguments),this._connection=null,this._workerHandler=null,this.capabilities=le(!1,!1),this.type=`wfs`,this.refresh=p(async()=>{await this.load();let e={customParameters:this.layer.customParameters,maxRecordCount:this.layer.maxRecordCount,maxTotalRecordCount:this.layer.maxTotalRecordCount,maxPageCount:this.layer.maxPageCount},{extent:t}=await this._workerHandler.refresh(e);return t&&(this.sourceJSON.extent=t),{dataChanged:!0,updates:{extent:this.sourceJSON.extent}}})}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._startWorker({signal:t})),Promise.resolve(this)}destroy(){this._connection?.close(),this._connection=null,this._workerHandler=null}async openPorts(){return await this.load(),this._connection.openPorts()}async queryFeatures(e,t={}){let n=await this.queryFeaturesJSON(e,t);return L.fromJSON(n)}async queryFeaturesJSON(e,t={}){return await this.load(t),this._workerHandler.queryFeatures(e?e.toJSON():void 0,t)}async queryFeatureCount(e,t={}){return await this.load(t),this._workerHandler.queryFeatureCount(e?e.toJSON():void 0,t)}async queryObjectIds(e,t={}){return await this.load(t),this._workerHandler.queryObjectIds(e?e.toJSON():void 0,t)}async queryExtent(e,t={}){await this.load(t);let n=await this._workerHandler.queryExtent(e?e.toJSON():void 0,t);return{count:n.count,extent:M.fromJSON(n.extent)}}async querySnapping(e,t={}){return await this.load(t),this._workerHandler.querySnapping(e,t)}async queryAttributeBins(e,t={}){await this.load(t);let n=await this._workerHandler.queryAttributeBins(e?.toJSON(),t);return ge.fromJSON(n)}async _createLoadOptions(e){let{url:t,customParameters:n,name:r,namespaceUri:a,fields:o,geometryType:s,maxRecordCount:c,maxPageCount:l,maxTotalRecordCount:u,swapXY:d}=this.layer,f=this.layer.originOf(`spatialReference`)===`defaults`?void 0:this.layer.spatialReference;if(!t)throw new i(`wfs-layer:missing-url`,`WFSLayer must be created with a url`);this.wfsCapabilities||=await me(t,{customParameters:n,...e});let p=[`fields`,`geometryType`,`name`,`namespaceUri`,`swapXY`].some(e=>this.layer[e]==null),m=p?await pe(this.wfsCapabilities,r,a,{spatialReference:f,customParameters:n,signal:e?.signal}):{...de(o??[]),geometryType:s,name:r,namespaceUri:a,spatialReference:f,swapXY:d},h=fe(this.wfsCapabilities.readFeatureTypes(),m.name,m.namespaceUri),g=j.toJSON(m.geometryType),{operations:_}=this.wfsCapabilities,v=_.GetFeature.url,y=_.GetFeature.outputFormat;return{customParameters:n,featureType:h,fields:m.fields?.map(e=>e.toJSON())??[],geometryField:m.geometryField,geometryType:g,getFeatureUrl:v,getFeatureOutputFormat:y,maxRecordCount:c,maxPageCount:l,maxTotalRecordCount:u,objectIdField:m.objectIdField,spatialReference:m.spatialReference?.toJSON(),swapXY:!!m.swapXY}}async _startWorker(e){let[t,n]=await ae([this._createLoadOptions(e),ce(`WFSSourceWorker`,{...e,strategy:H(`feature-layers-workers`)?`dedicated`:`local`,registryTarget:this})]),r=t.error||n.error||null,i=n.value||null;if(r)throw i&&i.close(),r;let a=t.value;this._connection=n.value,this._workerHandler=this._connection.createInvokeProxy();let o=await this._workerHandler.load(a,e);for(let e of o.warnings)G.getLogger(this.layer).warn(`#load()`,`${e.message} (title: '${this.layer.title||`no title`}', id: '${this.layer.id??`no id`}')`,{warning:e});this.sourceJSON={dateFieldsTimeReference:{timeZoneIANA:`UTC`},extent:o.extent,fields:a.fields,geometryType:a.geometryType,objectIdField:a.objectIdField,geometryField:a.geometryField,drawingInfo:ue(a.geometryType),name:a.featureType.title,wfsInfo:{name:a.featureType.name,featureUrl:a.getFeatureUrl,maxFeatures:a.maxRecordCount,swapXY:a.swapXY,supportedSpatialReferences:a.featureType.supportedSpatialReferences,version:`2.0.0`,wfsNamespace:a.featureType.namespaceUri}}}};I([s()],X.prototype,`capabilities`,void 0),I([s({constructOnly:!0})],X.prototype,`layer`,void 0),I([s()],X.prototype,`sourceJSON`,void 0),I([s()],X.prototype,`type`,void 0),I([s()],X.prototype,`wfsCapabilities`,void 0),X=I([b(`esri.layers.graphics.sources.WFSSource`)],X);var Z,Q=o(),$=Z=class extends x(W(P(w(ne(K(te(u(z(e(h(_(d(c))))))))))))){static fromWFSLayerInfo(e){let{customParameters:t,fields:n,geometryField:r,geometryType:i,name:a,namespaceUri:o,objectIdField:s,spatialReference:c,swapXY:l,url:u,wfsCapabilities:d}=e;return new Z({customParameters:t,fields:n,geometryField:r,geometryType:i,name:a,namespaceUri:o,objectIdField:s,spatialReference:c,swapXY:l,url:u,wfsCapabilities:d})}constructor(e){super(e),this.copyright=null,this.customParameters=null,this.dateFieldsTimeZone=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureUrl=void 0,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.graphicOrigin=new ve(this),this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType=`WFS`,this.maxRecordCount=3e3,this.maxPageCount=10,this.maxTotalRecordCount=2e5,this.mode=0,this.name=null,this.namespaceUri=null,this.outFields=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new X({layer:this}),this.spatialReference=J.WGS84,this.spatialReferences=[4326],this.swapXY=void 0,this.title=`WFS`,this.type=`wfs`,this.url=null,this.version=void 0}destroy(){this.source?.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[`WFS`]},e).then(()=>this.source.load(e)).then(()=>{this.read(this.source.sourceJSON,{origin:`service`,url:this.parsedUrl}),this.revert([`objectIdField`,`fields`,`timeInfo`,`spatialReference`,`name`,`namespaceUri`],`service`),f(this.renderer,this.fieldsIndex),V(this.timeInfo,this.fieldsIndex)})),Promise.resolve(this)}get capabilities(){return this.source?.capabilities}get createQueryVersion(){return this.commitProperty(`definitionExpression`),this.commitProperty(`timeExtent`),this.commitProperty(`timeOffset`),this.commitProperty(`geometryType`),this.commitProperty(`capabilities`),(this._get(`createQueryVersion`)||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}writeFields(e,t,n){let r=e.filter(e=>e.name!==he);this.geometryField&&r.unshift(new q({name:this.geometryField,alias:this.geometryField,type:`geometry`})),oe(n,r.map(e=>e.toJSON()),t)}get parsedUrl(){return F(this.url)}set renderer(e){f(e,this.fieldsIndex),this._set(`renderer`,e)}get wfsCapabilities(){return this.source?.wfsCapabilities}set wfsCapabilities(e){this.source&&(this.source.wfsCapabilities=e)}createPopupTemplate(e){return A(this,e)}createQuery(){let e=new U({returnGeometry:!0,outFields:[`*`],where:this.definitionExpression||`1=1`}),{timeOffset:t,timeExtent:n}=this;return e.timeExtent=t!=null&&n!=null?n.offset(-t.value,t.unit):n||null,e}getFieldDomain(e,t){return this.getField(e)?.domain}getField(e){return this.fieldsIndex?.get(e)}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(U.from(e)||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}queryObjectIds(e,t){return this.load().then(()=>this.source.queryObjectIds(U.from(e)||this.createQuery(),t))}queryFeatureCount(e,t){return this.load().then(()=>this.source.queryFeatureCount(U.from(e)||this.createQuery(),t))}queryExtent(e,t){return this.load().then(()=>this.source.queryExtent(U.from(e)||this.createQuery(),t))}async queryAttributeBins(e,t){let{source:n,capabilities:i}=await this.load();E(e,i,`WFSLayer`);let a=await r(()=>import(`./AttributeBinsQuery-DDqWAUtw.js`),__vite__mapDeps([0,1,2,3,4,5])),o=await n.queryAttributeBins(a.default.from(e),t);if(o.features)for(let e of o.features)e.layer=e.sourceLayer=this;return o}async hasDataChanged(){try{let{dataChanged:e,updates:t}=await this.source.refresh();return t!=null&&this.read(t,{origin:`service`,url:this.parsedUrl,ignoreDefaults:!0}),e}catch{}return!1}};I([s({readOnly:!0})],$.prototype,`capabilities`,null),I([s({type:String})],$.prototype,`copyright`,void 0),I([s({readOnly:!0})],$.prototype,`createQueryVersion`,null),I([s({json:{name:`wfsInfo.customParameters`,write:{overridePolicy:e=>({enabled:!!(e&&Object.keys(e).length>0),ignoreOrigin:!0})}}})],$.prototype,`customParameters`,void 0),I([s(y(`dateFieldsTimeReference`))],$.prototype,`dateFieldsTimeZone`,void 0),I([s({readOnly:!0})],$.prototype,`defaultPopupTemplate`,null),I([s({type:String,json:{name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],$.prototype,`definitionExpression`,void 0),I([s({type:String})],$.prototype,`displayField`,void 0),I([s(B)],$.prototype,`elevationInfo`,void 0),I([s({type:String,readOnly:!0,json:{name:`wfsInfo.featureUrl`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`featureUrl`,void 0),I([s({type:[q],json:{name:`layerDefinition.fields`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`fields`}}}})],$.prototype,`fields`,void 0),I([t(`fields`)],$.prototype,`writeFields`,null),I([s(Q.fieldsIndex)],$.prototype,`fieldsIndex`,void 0),I([s({type:M,json:{name:`extent`}})],$.prototype,`fullExtent`,void 0),I([s()],$.prototype,`geometryField`,void 0),I([s({type:String,json:{read:{source:`layerDefinition.geometryType`,reader:j.read},write:{target:`layerDefinition.geometryType`,writer:j.write,ignoreOrigin:!0},origins:{service:{read:j.read}}}})],$.prototype,`geometryType`,void 0),I([s({readOnly:!0,clonable:!1})],$.prototype,`graphicOrigin`,void 0),I([s({type:String})],$.prototype,`id`,void 0),I([s(v)],$.prototype,`labelsVisible`,void 0),I([s({type:[S],json:{name:`layerDefinition.drawingInfo.labelingInfo`,read:{reader:T},write:!0}})],$.prototype,`labelingInfo`,void 0),I([s(l)],$.prototype,`legendEnabled`,void 0),I([s({type:[`show`,`hide`]})],$.prototype,`listMode`,void 0),I([s({type:String})],$.prototype,`objectIdField`,void 0),I([s({type:[`WFS`]})],$.prototype,`operationalLayerType`,void 0),I([s({type:R,json:{name:`wfsInfo.maxFeatures`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`maxRecordCount`,void 0),I([s({type:R})],$.prototype,`maxPageCount`,void 0),I([s({type:R})],$.prototype,`maxTotalRecordCount`,void 0),I([s({type:[0],readOnly:!0,json:{origins:{"web-map":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],$.prototype,`mode`,void 0),I([s({type:String,json:{name:`wfsInfo.name`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`name`,void 0),I([s({type:String,json:{name:`wfsInfo.wfsNamespace`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`namespaceUri`,void 0),I([s(D)],$.prototype,`opacity`,void 0),I([s(Q.outFields)],$.prototype,`outFields`,void 0),I([s({readOnly:!0})],$.prototype,`parsedUrl`,null),I([s(n)],$.prototype,`popupEnabled`,void 0),I([s({type:C,json:{name:`popupInfo`,write:!0}})],$.prototype,`popupTemplate`,void 0),I([s({types:O,json:{origins:{service:{name:`drawingInfo.renderer`},"web-scene":{types:ie,name:`layerDefinition.drawingInfo.renderer`,write:!0}},name:`layerDefinition.drawingInfo.renderer`,write:{ignoreOrigin:!0}}})],$.prototype,`renderer`,null),I([s(ee)],$.prototype,`screenSizePerspectiveEnabled`,void 0),I([s({readOnly:!0})],$.prototype,`source`,void 0),I([s({type:J,json:{name:`layerDefinition.spatialReference`,write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`extent.spatialReference`}}}})],$.prototype,`spatialReference`,void 0),I([s({readOnly:!0,type:[R],json:{name:`wfsInfo.supportedSpatialReferences`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`spatialReferences`,void 0),I([s({type:Boolean,value:!1,json:{name:`wfsInfo.swapXY`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`swapXY`,void 0),I([s({json:{write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:`name`}}}})],$.prototype,`title`,void 0),I([s({json:{read:!1},readOnly:!0})],$.prototype,`type`,void 0),I([s(g)],$.prototype,`url`,void 0),I([s({type:String,readOnly:!0,json:{name:`wfsInfo.version`,write:{ignoreOrigin:!0,isRequired:!0}}})],$.prototype,`version`,void 0),I([s()],$.prototype,`wfsCapabilities`,null),$=Z=I([b(`esri.layers.WFSLayer`)],$);var ye=$;export{ye as default};