import{CE as e,FS as t,Jf as n,Jm as r,Jy as i,Kl as a,Kx as o,Mx as s,PS as c,Rm as l,Ry as u,Tm as d,Tw as f,Um as p,Vm as m,Xf as h,Zy as g,bl as _,dw as v,hl as y,kS as ee,kl as te,nS as ne,n_ as b,nw as re,pl as ie,pw as ae,wS as oe,y_ as x}from"./index-BN8X5Ryz.js";import{a as se,t as ce}from"./meshVertexSpaceUtils-s2jLb8qI.js";import{n as S}from"./projectPointToVector-BkRdoTqD.js";import{t as C}from"./computeTranslationToOriginAndRotation-0WDVmpJG.js";import{x as w,z as T}from"./BufferView-BW77W5ev.js";import{n as E,o as D,s as O,t as k}from"./vec3-B5yu4INg.js";import{i as le}from"./vec4-BLZ_ZPtE.js";import{n as ue,t as de}from"./spatialReferenceEllipsoidUtils-qw9wv8RL.js";var fe=`Projection may be possible after calling projection.load().`;function A(e,t,n,r){e.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${n.wkid}).${r?` `:``}${r}`)}function j(e,t,n,r,i,a){return B(0,w.fromTypedArray(e),0,T.fromTypedArray(t),n,T.fromTypedArray(r),i,w.fromTypedArray(a))?a:null}function pe(e,t,n,r,i,a){return B(1,w.fromTypedArray(e),0,T.fromTypedArray(t),n,T.fromTypedArray(r),i,w.fromTypedArray(a))?a:null}function M(e,t,n,r){return b(e,t,0,n,r,0)?n:null}function N(e,t,n,r){return b(e,t,0,n,r,0)?n:null}function P(e,t,n){return i(W,n),D(t,e,W),ae(W)&&E(t,t),t}function F(e,t,n){return g(W,n),le(t,e,W),ae(W)&&E(t,t,4),t}function me(e,t,n,r){let i=t===0;return I(e,t,n,(e,t)=>{let n=Math.cos(f(e));t[0]=i?n:1/n,t[1]=1},r)}function he(e,t,n,r){let i=t===0;return I(e,t,n,(e,t)=>{let n=Math.cosh(-e/re.radius);t[0]=1,t[1]=i?n:1/n},r)}function I(e,t,n,r,i){let a=t===0?3:4,o=[0,0];for(let t=0,s=1;t<e.length;t+=a,s+=3){r(n[s],o);let c=e[t]*o[0],l=e[t+1]*o[1],u=e[t+2],d=1/Math.sqrt(c*c+l*l+u*u);i[t]=c*d,i[t+1]=l*d,i[t+2]=u*d,a===4&&(i[t+3]=e[t+3])}return i}function L(e,t,n,r,i,a){if(!B(0,w.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),1,T.fromTypedArray(t),n,T.fromTypedArray(r),i,w.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let t=3;t<e.length;t+=4)a[t]=e[t];return a}function R(e,t,n,r,i,a){if(!B(1,w.fromTypedArray(e,16),1,T.fromTypedArray(t),n,T.fromTypedArray(r),i,w.fromTypedArray(a,16)))return null;for(let t=3;t<e.length;t+=4)a[t]=e[t];return a}function z(e,t,n,r,a){switch(C(r,n,U,r),e===1&&p(U,U),t){case 0:return i(a,U);case 1:return g(a,U)}}function B(e,t,n,r,i,a,o,c){if(!t)return;let l=r.count;if(ge(i))for(let r=0;r<l;r++)a.getVec(r,V),t.getVec(r,H),_(H,H,z(e,n,V,o,W)),c.setVec(r,H);else for(let i=0;i<l;i++){a.getVec(i,V),t.getVec(i,H);let l=s(r.get(i,1)),u=Math.cos(l);n===1!=(e===0)&&(u=1/u),z(e,n,V,o,W),e===0?(W[0]*=u,W[1]*=u,W[2]*=u,W[3]*=u,W[4]*=u,W[5]*=u):(W[0]*=u,W[3]*=u,W[6]*=u,W[1]*=u,W[4]*=u,W[7]*=u),_(H,H,W),ie(H,H),c.setVec(i,H)}return c}function ge(e){return e.isWGS84||c(e)||oe(e)||t(e)}var V=x(),H=x(),U=n(),W=u(),G=()=>e.getLogger(`esri.geometry.support.meshUtils.vertexSpaceConversion`);function _e(e,t,{vertexSpace:n,spatialReference:r}){if(n.type===`georeferenced`){let i=e;if(!S(t,i,r))return!1;let{origin:a}=n;return te(e,i,a),!0}let i=de(r),a=e;if(!S(t,a,i))return!1;let{origin:o}=n,s=Me;if(!C(r,o,s,i))return!1;let c=p(Me,s);return c!=null&&(y(e,a,c),!0)}function ve(e,t,n){let{vertexSpace:r,transform:i,vertexAttributes:a}=e,o=se(r)?i:null,s=Y(e.spatialReference,n,3);if(ce(r,t)&&(!o||d(o.localMatrix,h))&&X(s)){let{position:e,normal:t,tangent:r}=a,i=n?.allowBufferReuse;return{position:i?e:e.slice(),normal:i?t:t?.slice(),tangent:i?r:r?.slice()}}switch(e.vertexSpace.type){case`local`:return t.type===`local`?Ce(e,e.vertexSpace,t.origin,n):be(e,e.vertexSpace,t.origin,n);case`georeferenced`:return t.type===`local`?xe(e,e.vertexSpace,t.origin,n):ye(e,e.vertexSpace,t.origin,n)}}function ye({vertexAttributes:e,transform:t,spatialReference:n},{origin:i},o,s){let c=Y(n,s,3),l=i||!X(c)?r(Q,t?.localMatrix??h):null;l&&J(l,n,s,3);let{position:u,normal:d,tangent:f}=l?q(e,l):e,p=s?.allowBufferReuse,m=p?u:new Float64Array(u.length),g=u;if(i&&(g=k(m,g,i)),o){let e=a(je,o);g=k(m,g,e)}return{position:g!==e.position||p?g:g.slice(),normal:d!==e.normal||p?d:d?.slice(),tangent:f!==e.tangent||p?f:f?.slice()}}function K(e,t){return t?.useEllipsoid&&ee(e)?ue:de(e)}function be({spatialReference:e,vertexAttributes:t,transform:n},{origin:r},i,o){let s=K(e,o);if(!C(e,r,Q,s))return A(G(),e,s),null;n&&l(Q,Q,n.localMatrix),J(Q,e,o,1);let c=new Float64Array(t.position.length),u=we(t.position,Q,e,c,s);if(!u)return null;let d=Te(u,e,c,s,t.normal,Q);if(t.normal&&!d)return null;let f=Ee(u,e,c,s,t.tangent,Q);if(t.tangent&&!f)return null;if(i){let e=a(je,i);k(u,u,e)}return{position:u,normal:d,tangent:f}}function xe({vertexAttributes:e,spatialReference:t,transform:n},{origin:r},a,o){let s=K(t,o);if(!C(t,a,Q,s))return A(G(),t,s),null;let c=1/Y(t,o,2);m(Q,Q,[c,c,c]);let l=p($,Q),{position:u,normal:d,tangent:f}=Se(e,r,n),h=new Float64Array(u.length),g=De(u,t,l,h,s);if(!g)return null;let _=i(Ae,l),v=Oe(d,u,t,h,s,_,d===e.normal?void 0:d);if(!v&&d)return null;let y=ke(f,u,t,h,s,_,f===e.tangent?void 0:f);return!y&&f?null:{position:g,normal:v,tangent:y}}function Se(e,t,n){if(!t)return e;if(!n){let{position:n,normal:r,tangent:i}=e;return{position:k(new Float64Array(n.length),n,t),tangent:i,normal:r}}let r=q(e,n.localMatrix);return k(r.position,r.position,t),r}function Ce({vertexAttributes:e,spatialReference:t,transform:n},{origin:r},i,a){let o=K(t,a);if(!C(t,r,Q,o))return A(G(),t,o),null;if(n&&l(Q,Q,n.localMatrix),!C(t,i,$,o))return A(G(),o,t),null;p($,$);let s=l(Q,$,Q);return J(s,t,a,3),q(e,s)}function q(e,t){let n=new Float64Array(e.position.length);O(n,e.position,t);let r=e.normal?new Float32Array(e.normal.length):null,i=e.tangent?new Float32Array(e.tangent.length):null;return r&&e.normal&&P(e.normal,r,t),i&&e.tangent&&F(e.tangent,i,t),{position:n,normal:r,tangent:i}}function we(e,t,n,r,i){O(r,e,t);let a=new Float64Array(e.length);return N(r,i,a,n)?a:(A(G(),i,n),null)}function Te(e,t,n,r,i,a){if(i==null)return null;let o=new Float32Array(i.length);return P(i,o,a),pe(o,e,t,n,r,o)?o:(A(G(),r,t),null)}function Ee(e,t,n,r,i,a){if(i==null)return null;let o=new Float32Array(i.length);return F(i,o,a),R(o,e,t,n,r,o)?o:(A(G(),r,t),null)}function J(e,t,n,r){let i=Y(t,n,r);X(i)||m(e,e,[i,i,i])}function Y(e,t,n){let r=!!(1&n),i=!!(2&n),a=t?.sourceUnit,o=t?.targetUnit;if(!a&&!o)return 1;let s=Z(a,e);r||!a||X(s)||(G().warn(`source unit conversion not supported`),s=1);let c=1/Z(o,e);return i||!o||X(c)||(G().warn(`target unit conversion not supported`),c=1),s*c}function X(e){return v(e,1)}function De(e,t,n,r,i){let a=M(e,t,r,i);if(!a)return A(G(),t,i),null;let o=new Float64Array(a.length);return O(o,a,n),o}function Oe(e,t,n,r,i,a,o){if(e==null)return null;let s=o??new Float32Array(e.length);return j(e,t,n,r,i,s)?(D(s,s,a),s):(A(G(),n,i),null)}function ke(e,t,n,r,i,a,o){if(e==null)return null;let s=o??new Float32Array(e.length);return L(e,t,n,r,i,s)?(D(s,s,a,4),s):(A(G(),n,i),null)}function Z(e,t){if(e==null)return 1;let n=ne(t);return 1/o(n,`meters`,e)}var Q=n(),$=n(),Ae=u(),je=x(),Me=n();export{F as a,R as c,fe as d,A as f,N as h,he as i,me as l,j as m,ve as n,L as o,P as p,Z as r,pe as s,_e as t,M as u};