import{En as e,Ex as t,Ix as n,am as r,cm as i,dm as a,fE as o,gn as s,kv as c,om as l,pn as ee,vn as u,wn as d}from"./index-BN8X5Ryz.js";import{V as te,Y as f,Z as p,et as m,j as h,nt as g,p as ne,q as _,r as v,s as y,t as b,v as x}from"./Dictionary-Db5-uVgu.js";import{s as S}from"./featureConversionUtils-o9-cJXzl.js";function C(e,t,n=null){let r=w(e,!0);if(r.hasm!==void 0&&(r.hasM=r.hasm,delete r.hasm),r.hasz!==void 0&&(r.hasZ=r.hasz,delete r.hasz),r.spatialreference!==void 0&&(r.spatialReference=r.spatialreference,delete r.spatialreference),r.spatialReference||=t,r.curverings!==void 0){let e=Z(r.curverings,r.hasZ,r.hasM,q);if(e==null)return null;r.curveRings=e.arrays,delete r.curverings,delete r.rings,r.hasZ=e.hasZ,r.hasM=e.hasM}else if(r.rings!==void 0){let e=Z(r.rings,r.hasZ,r.hasM,K);if(e==null)return null;r.rings=e.arrays,r.hasZ=e.hasZ,r.hasM=e.hasM}if(r.curvepaths!==void 0){let e=Z(r.curvepaths,r.hasZ,r.hasM,q);if(e==null)return null;r.curvePaths=e.arrays,delete r.curvepaths,delete r.paths,r.hasZ=e.hasZ,r.hasM=e.hasM}else if(r.paths!==void 0){let e=Z(r.paths,r.hasZ,r.hasM,K);if(e==null)return null;r.paths=e.arrays,r.hasZ=e.hasZ,r.hasM=e.hasM}if(r.points!==void 0){let e=ae(r.points,r.hasZ,r.hasM);if(e==null)return null;r.points=e.array,r.hasZ=e.hasZ,r.hasM=e.hasM}let i=c(r);if(n!=null&&i?.type!==n)throw new d(null,`InvalidParameter`,null);return i}function w(e,t=!1){let n={};for(let r of e.keys()){let i=t?r.toLowerCase():r,a=e.attributes[r];n[i]=x(a)?w(a):a}return n}var T=Symbol(`NoValue`);function E(e){return Array.isArray(e)&&e.length>0?e[0]:g(e)&&e.length()>0?e.get(0):T}function D(e){let n=E(E(e));return n===T||Array.isArray(n)||g(n)||n instanceof t?e:[e]}var O=0;function k(e){return o(e,O)??O}function A(e){return typeof e==`number`&&!Number.isNaN(e)}var j=null;function M(e){return o(e,j)??j}function N(e){return typeof e==`number`&&!Number.isNaN(e)||e===null}function P(e){return!(e.length<2)&&typeof e[0]==`number`&&!Number.isNaN(e[0])&&typeof e[1]==`number`&&!Number.isNaN(e[1])}function F(e){return P(e)?e.length>2?e.slice(0,2):e:null}function I(e){return P(e)?A(e[2])?e.length>3?e.slice(0,3):e:[e[0],e[1],k(e[2])]:null}function re(e){return P(e)?e.length>=3&&!N(e[2])?[e[0],e[1],M(e[2])]:e.length>3?e.slice(0,3):e:null}function ie(e){return P(e)?A(e[2])&&N(e[3])?e.length>4?e.slice(0,4):e:[e[0],e[1],k(e[2]),M(e[3])]:null}function L(e){return[e.x,e.y]}function R(e){return[e.x,e.y,e.z??O]}function z(e){return[e.x,e.y,e.m??j]}function B(e){return[e.x,e.y,e.z??O,e.m??j]}function V(e,t,n){if(g(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==2)throw new d(null,`InvalidParameter`,null);let r=K(e[0],t,n);if(r==null)return null;let i=K(e[1],L,F);return i==null?null:{c:[r,i]}}function H(e,t,n){if(g(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==4&&e.length!==7)throw new d(null,`InvalidParameter`,null);let r=K(e[0],t,n);if(r==null)return null;let i=K(e[1],L,F);if(i==null)return null;let a=e[2];if(a!==0&&a!==1)throw new d(null,`InvalidParameter`,null);let o=e[3];if(o!==0&&o!==1)throw new d(null,`InvalidParameter`,null);if(e.length===4)return{a:[r,i,a,o]};let s=e[4];if(typeof s!=`number`)throw new d(null,`InvalidParameter`,null);if(Number.isNaN(s))return null;let c=e[5];if(typeof c!=`number`)throw new d(null,`InvalidParameter`,null);if(Number.isNaN(c))return null;let l=e[6];if(typeof l!=`number`)throw new d(null,`InvalidParameter`,null);return Number.isNaN(l)?null:{a:[r,i,a,o,s,c,l]}}function U(e,t,n){if(g(e)&&(e=e.toArray()),!Array.isArray(e)||e.length!==3)throw new d(null,`InvalidParameter`,null);let r=K(e[0],t,n);if(r==null)return null;let i=K(e[1],L,F);if(i==null)return null;let a=K(e[2],L,F);return a==null?null:{b:[r,i,a]}}function W(e,t){return e?t?ie:I:t?re:F}function G(e,t){return e?t?B:R:t?z:L}function K(e,n,r){return Array.isArray(e)?r(e):e instanceof t?n(e):g(e)?r(e.toArray()):null}function q(e,n,r){return Array.isArray(e)?r(e):x(e)?e.hasField(`c`)?V(e.field(`c`),n,r):e.hasField(`a`)?H(e.field(`a`),n,r):e.hasField(`b`)?U(e.field(`b`),n,r):null:e instanceof t?n(e):g(e)?r(e.toArray()):null}function J(e,t,n,r){let i=[];if(Array.isArray(e))for(let a of e){let e=t(a,n,r);e!=null&&i.push(e)}else if(g(e))for(let a=0;a<e.length();a++){let o=t(e.get(a),n,r);o!=null&&i.push(o)}return i}function Y(e,n,r){return Array.isArray(e)?e.length>=n:g(e)?e.length()>=n:e instanceof t&&e[r]}function X(e,t,n){return e===void 0&&t===void 0?{hasZ:Y(n,3,`hasZ`),hasM:Y(n,4,`hasM`)}:e===void 0?!0===t?{hasZ:Y(n,4,`hasZ`),hasM:!0}:{hasZ:Y(n,3,`hasZ`),hasM:!1}:t===void 0?!0===e?{hasZ:!0,hasM:Y(n,4,`hasM`)}:{hasZ:!1,hasM:Y(n,3,`hasM`)}:{hasZ:!0===e,hasM:!0===t}}function ae(e,t,n){let r=E(e);if(r===T)return null;let{hasZ:i,hasM:a}=X(t,n,r);return{array:J(e,K,G(i,a),W(i,a)),hasZ:i,hasM:a}}function Z(e,t,n,r){let i=E(E(e=D(e)));if(i===T)return null;let{hasZ:a,hasM:o}=X(t,n,i),s=G(a,o),c=W(a,o),l=[];if(Array.isArray(e))for(let t=0;t<e.length;t++)l.push(J(e[t],r,s,c));else if(g(e))for(let t=0;t<e.length();t++)l.push(J(e.get(t),r,s,c));return{arrays:l,hasZ:a,hasM:o}}function oe(e){switch(e.type){case`small-integer`:case`esriFieldTypeSmallInteger`:case`integer`:case`esriFieldTypeInteger`:case`single`:case`esriFieldTypeSingle`:case`double`:case`esriFieldTypeDouble`:case`big-integer`:case`esriFieldTypeBigInteger`:case`long`:case`esriFieldTypeLong`:case`oid`:case`esriFieldTypeOID`:return{name:e.name,type:`number`};case`global-id`:case`esriFieldTypeGlobalID`:case`guid`:case`esriFieldTypeGUID`:case`string`:case`esriFieldTypeString`:return{name:e.name,type:`text`};case`date`:case`esriFieldTypeDate`:case`timestamp-offset`:case`esriFieldTypeTimestampOffset`:return{name:e.name,type:`date`};case`date-only`:case`esriFieldTypeDateOnly`:return{name:e.name,type:`dateOnly`};case`time-only`:case`esriFieldTypeTimeOnly`:return{name:e.name,type:`time`};default:return null}}function Q(e,t,n){if(e==null)return null;switch(t){case`time-only`:return _(e)?e:ee.fromReader(e.toString());case`date-only`:return m(e)?e:s.fromReader(e.toString());case`timestamp-offset`:return f(e)?e:u.fromReaderAsTimeStampOffset(e.toString());case`date`:return f(e)?e:r(e)?u.dateJSAndZoneToArcadeDate(e,n):u.epochToArcadeDate(e,n);case`geometry`:return null;default:return e}}var $=class t{constructor(){this.arcadeDeclaredClass=`esri.arcade.Feature`,this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._fieldTypesFixed=!0,this.fieldsIndex=null,this.contextTimeZone=null,this.immutable=!0,this._fieldsToFixDataTypes=null,this.immutable=!0}static createFromGraphic(e,n){let r=new t;return r.contextTimeZone=n??null,r._geometry=e.geometry==null?null:e.geometry,e.attributes===void 0||e.attributes===null?r.attributes={}:r.attributes=e.attributes,e._sourceLayer?(r._layer=e._sourceLayer,r._fieldTypesFixed=!1):e._layer?(r._layer=e._layer,r._fieldTypesFixed=!1):e.layer&&`fields`in e.layer?(r._layer=e.layer,r._fieldTypesFixed=!1):e.sourceLayer&&`fields`in e.sourceLayer&&(r._layer=e.sourceLayer,r._fieldTypesFixed=!1),r._layer&&!r._fieldTypesFixed&&(r.fieldsIndex=this.hydrateFieldsIndex(r._layer)),r}static createFromArcadeFeature(e){if(e instanceof t){let n=new t;return n._fieldTypesFixed=e._fieldTypesFixed,n.attributes=e.attributes,n._geometry=e._geometry,n._optimizedGeomDefinition=e._optimizedGeomDefinition,e._layer&&(n._layer=e._layer),n.fieldsIndex=e.fieldsIndex,n.contextTimeZone=e.contextTimeZone,n}let n={};for(let t of e.keys())n[t]=e.field(t);return t.createFromGraphicLikeObject(e.geometry(),n,e.fullSchema(),e.contextTimeZone)}static createFromOptimisedFeature(e,n,r){let i=new t;return i._geometry=e.geometry?{geometry:e.geometry}:null,i._optimizedGeomDefinition=r,i.attributes=e.attributes||{},i._layer=n,i._fieldTypesFixed=!1,i}static createFromArcadeDictionary(e,r){let i=new t;return i.attributes=e.field(`attributes`),i.attributes!==null&&i.attributes instanceof b?(i.attributes=i.attributes.attributes,i.attributes===null&&(i.attributes={})):i.attributes={},i._geometry=e.field(`geometry`),i._geometry!==null&&(i._geometry instanceof b?i._geometry=C(i._geometry,r):i._geometry instanceof n||(i._geometry=null)),i}static createFromGraphicLikeObject(e,n,r=null,i){let a=new t;return a.contextTimeZone=i??null,n===null&&(n={}),a.attributes=n,a._geometry=e??null,a._layer=r,a._layer&&(a._fieldTypesFixed=!1,a.fieldsIndex=this.hydrateFieldsIndex(a._layer)),a}static hydrateFieldsIndex(t){return t===null?null:y(t)?t.getFieldsIndex():t.fieldsIndex?t.fieldsIndex:e.fromLayerJSON({datesInUnknownTimezone:t.datesInUnknownTimezone,fields:t.fields,timeInfo:t.timeInfo,editFieldsInfo:t.editFieldsInfo,dateFieldsTimeReference:t.dateFieldsTimeReference??{timeZone:`UTC`,respectsDaylightSaving:!1}})}repurposeFromGraphicLikeObject(e,t,n=null){t===null&&(t={}),this.attributes=t,this._geometry=e??null,this._layer=n,this._layer?this._fieldTypesFixed=!1:this._fieldTypesFixed=!0}castToText(e=!1){!1===this._fieldTypesFixed&&this._fixFieldTypes();let t=p(this.attributes,{useNumbersForDates:e});return`{"geometry":`+(this.geometry()===null?`null`:te(this.geometry()))+`,"attributes":`+t+`}`}_fixFieldTypes(){if(this._fieldsToFixDataTypes&&this._fieldsToFixDataTypes?.length>0)return this._fixAllFields(this._fieldsToFixDataTypes),void(this._fieldTypesFixed=!0);let e=[],t=this._layer.fields;for(let n=0;n<(t?.length??0);n++){let r=t[n],{name:i,type:a}=r;switch(a){case`date`:case`esriFieldTypeDate`:e.push({field:i,dataType:`date`});break;case`date-only`:case`esriFieldTypeDateOnly`:e.push({field:i,dataType:`date-only`});break;case`time-only`:case`esriFieldTypeTimeOnly`:e.push({field:i,dataType:`time-only`});break;case`timestamp-offset`:case`esriFieldTypeTimestampOffset`:e.push({field:i,dataType:`timestamp-offset`});break;case`geometry`:case`esriFieldTypeGeometry`:e.push({field:i,dataType:`geometry`})}}this._fieldsToFixDataTypes=e,e.length>0&&this._fixAllFields(e),this._fieldTypesFixed=!0}isUnknownDateTimeField(e){return this.fieldsIndex?.getTimeZone(e)===`unknown`}_fixAllFields(e){this.attributes={...this.attributes};let t=this.contextTimeZone??`system`;for(let n=0;n<e.length;n++){let r=e[n].field,i=e[n].dataType,a=this.attributes[r];if(a===void 0){for(let e in this.attributes)if(e.toLowerCase()===r.toLowerCase()){a=this.attributes[e],this.attributes[e]=Q(a,i,this.isUnknownDateTimeField(e)?`unknown`:t);break}}else a!==null&&(this.attributes[r]=Q(a,i,this.isUnknownDateTimeField(r)?`unknown`:t))}}geometry(){return this._geometry===null||this._geometry instanceof n||(this._optimizedGeomDefinition?(this._geometry=c(S(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM)),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=c(this._geometry)),this._geometry}field(e){this._fieldTypesFixed||this._fixFieldTypes();let t=this.attributes[e];if(t!==void 0)return t;let n=e.toLowerCase();for(let e in this.attributes)if(e.toLowerCase()===n)return this.attributes[e];if(this._hasFieldDefinition(n))return null;throw new d(null,`FieldNotFound`,null,{key:e})}_hasFieldDefinition(e){if(this._layer===null)return!1;for(let t=0;t<this._layer.fields.length;t++)if(this._layer.fields[t].name.toLowerCase()===e)return!0;return!1}setField(e,t){if(this.immutable)throw new d(null,`Immutable`,null);if(t instanceof Date&&(t=this.isUnknownDateTimeField(e)?u.unknownDateJSToArcadeDate(t):u.dateJSToArcadeDate(t)),!1===h(t))throw new d(null,`TypeNotAllowedInFeature`,null);let n=e.toLowerCase();if(this.attributes[e]===void 0){for(let e in this.attributes)if(e.toLowerCase()===n)return void(this.attributes[e]=t);this.attributes[e]=t}else this.attributes[e]=t}hasField(e){let t=e.toLowerCase();if(this.attributes[e]!==void 0)return!0;for(let e in this.attributes)if(e.toLowerCase()===t)return!0;return!!this._hasFieldDefinition(t)}keys(){let e=[],t={};for(let n in this.attributes)e.push(n),t[n.toLowerCase()]=1;if(this._layer!==null)for(let n=0;n<this._layer.fields.length;n++){let r=this._layer.fields[n];t[r.name.toLowerCase()]!==1&&e.push(r.name)}return e=e.sort(),e}isEmpty(){for(let e in this.attributes)return!1;return!(this._layer!=null&&this._layer.fields.length>0)&&this.geometry()==null}static parseAttributesFromDictionary(e){let t={};for(let n in e.attributes){let r=e.attributes[n];if(!h(r))throw new d(null,`InvalidParameter`,null);t[n]=r}return t}static fromJson(e,n){let r=null;e.geometry!==null&&e.geometry!==void 0&&(r=c(e.geometry));let o={};if(e.attributes!==null&&e.attributes!==void 0)for(let t in e.attributes){let n=e.attributes[t];if(n===null)o[t]=n;else{if(!(l(n)||i(n)||a(n)||f(n)||_(n)||m(n)))throw new d(null,`InvalidParameter`,null);o[t]=n}}return t.createFromGraphicLikeObject(r,o,null,n??null)}fullSchema(){return this._layer}gdbVersion(){if(this._layer===null)return``;let e=this._layer.gdbVersion;return e===void 0?``:e===``&&this._layer.capabilities?.isVersioned?`SDE.DEFAULT`:e}castAsJson(e){let t={attributes:{},geometry:!0===e?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null};for(let n in this.attributes){let r=this.attributes[n];r!==void 0&&(t.attributes[n]=ne(r,e))}return t}async castAsJsonAsync(e=null,t){return this.castAsJson(t)}};v($);export{C as i,$ as n,Q as r,oe as t};