const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/resourceUtils-C90nuAwH.js","assets/resourceUtils-Bt8ctqoA.js","assets/index-BN8X5Ryz.js","assets/index-CWJhHB6-.css"])))=>i.map(i=>d[i]);
import{$S as e,$T as t,lT as n,lh as r,pT as i,rT as a}from"./index-BN8X5Ryz.js";import{i as o,s}from"./resourceUtils-Bt8ctqoA.js";async function c(e,t,n){let r=await u(e,t,n);await d(r,t,n)}async function l(e,t,n,r,i){let a=await u(n,r,i);await e.update({data:t}),await d(a,r,i)}async function u(n,c,l){if(!c?.resources)return;let u=c.portalItem===n.portalItem?new Set(n.paths):new Set;n.paths.length=0,n.portalItem=c.portalItem;let d=new Set(c.resources.toKeep.map(e=>e.resource.path)),f=new Set,p=[];d.forEach(e=>{u.delete(e),n.paths.push(e)});let m=[],h=[],g=[];for(let e of c.resources.toUpdate)if(u.delete(e.resource.path),d.has(e.resource.path)||f.has(e.resource.path)){let{resource:t,content:i,finish:a}=e,c=o(t,r());n.paths.push(c.path),m.push({resource:c,content:await s(i),compress:e.compress}),a&&g.push(()=>a(c))}else{n.paths.push(e.resource.path),h.push({resource:e.resource,content:await s(e.content),compress:e.compress});let t=e.finish;t&&g.push(()=>t(e.resource)),f.add(e.resource.path)}for(let e of c.resources.toAdd)if(n.paths.push(e.resource.path),u.has(e.resource.path))u.delete(e.resource.path);else{m.push({resource:e.resource,content:await s(e.content),compress:e.compress});let t=e.finish;t&&g.push(()=>t(e.resource))}if(m.length||h.length){let{addOrUpdateResources:t}=await e(async()=>{let{addOrUpdateResources:e}=await import(`./resourceUtils-C90nuAwH.js`);return{addOrUpdateResources:e}},__vite__mapDeps([0,1,2,3]));await t(c.portalItem,m,`add`,l),await t(c.portalItem,h,`update`,l)}if(g.forEach(e=>e()),p.length===0)return u;let _=await a(p);if(i(l),_.length>0)throw new t(`save:resources`,`Failed to save one or more resources`,{errors:_});return u}async function d(e,t,r){if(!e||!t.portalItem)return;let i=[];for(let n of e){let e=t.portalItem.resourceFromPath(n);i.push(e.portalItem.removeResource(e,r))}await n(i)}export{c as n,l as t};