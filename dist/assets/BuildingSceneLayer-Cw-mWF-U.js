import{$T as e,$f as t,$h as n,A as r,Ai as i,BT as a,C as ee,CE as o,Di as te,Ei as s,En as ne,FC as re,FE as c,GT as l,Jh as ie,L as ae,Lx as u,M as oe,Od as se,Oi as ce,Rh as le,Ua as ue,VT as d,W as de,WT as f,Wa as fe,Wh as pe,XT as me,Yh as he,ZS as ge,Zh as _e,_ as ve,_E as ye,ba as be,ca as xe,cm as Se,cp as Ce,fv as we,g as p,gT as Te,hv as m,iE as Ee,ip as De,iw as h,ji as Oe,jp as ke,kD as g,lh as Ae,ma as je,ov as Me,pa as Ne,pd as Pe,pr as Fe,qT as Ie,sT as Le,sp as Re,vx as ze,xa as Be,zi as Ve}from"./index-BN8X5Ryz.js";import"./quatf64-D37SEdPg.js";import"./quat-C8PgLo31.js";import"./plane-Da5EsY0J.js";import"./vectorStacks-Cuo89CNO.js";import"./projectPointToVector-BkRdoTqD.js";import"./computeTranslationToOriginAndRotation-0WDVmpJG.js";import"./spatialReferenceEllipsoidUtils-qw9wv8RL.js";import{n as He}from"./capabilities-5-b9b9so.js";import{n as Ue,r as We}from"./SceneService-CV9CcpT-.js";import{i as Ge,n as Ke,r as qe,t as Je}from"./I3SLayerDefinitions-DCkrs9K5.js";import"./dehydratedPoint-CWZQBefp.js";import"./projectVectorToVector-DGzn2p7I.js";import"./featurePopupQueryUtils-BtodurzF.js";import"./I3SBinaryReader-CPmcprrx.js";import{t as Ye}from"./I3SUtil-BFPXufgH.js";import"./symbolColorUtils-KqO0oQTm.js";import"./orientedBoundingBox-Bd4igSGQ.js";import"./Emissions.glsl-C_Yvv-sZ.js";import"./glsl-BMw-Ib6r.js";import"./Uniform-C_fuiTP5.js";import"./Float3DrawUniform-ua6q6ZtZ.js";import"./Float3PassUniform-SaBA6LBM.js";import"./FloatPassUniform-CSAt82xV.js";import"./Texture2DDrawUniform-jqrXjxoW.js";import"./Texture2DPassUniform-DFWoDpEL.js";import"./NoParameters-BDE7RvXT.js";import"./layerViewUtils-CJcMVuwG.js";import{n as Xe,t as Ze}from"./popupUtils-z3ynpNjO.js";import"./originUtils-CJnuu7mB.js";import"./resourceUtils-Bt8ctqoA.js";import"./resourceUtils-t_8WR2aj.js";import"./saveUtils-CEfw3trS.js";import{t as Qe}from"./associatedFeatureServiceUtils-g0mrYesf.js";import"./memoize-Dl61_jt0.js";import{o as $e,p as _,y as et}from"./elevationInfoUtils-uoMH3ofe.js";var tt=Symbol(`isBuildingGraphicOrigin`),v,nt=class extends be{get[(v=tt,De)](){return this.sublayer}get[Re](){return this.sublayer}get[Be](){return this.sublayer}constructor(e){super(),this[v]=!0,this.type=`building`,this.sublayer=e}get layer(){return this.sublayer.layer}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}},y=class extends pe(fe){constructor(e){super(e),this.title=``,this.id=-1,this.modelName=null,this.isEmpty=null,this.legendEnabled=!0,this.visible=!0,this.opacity=1}readTitle(e,t){return typeof t.alias==`string`?t.alias:typeof t.name==`string`?t.name:``}readIdOnlyOnce(e){return this.id===-1?typeof e==`number`?e:-1:this.id}};g([a({type:String,json:{origins:{"web-scene":{write:!0},"portal-item":{write:!0}}}})],y.prototype,`title`,void 0),g([f(`service`,`title`,[`alias`,`name`])],y.prototype,`readTitle`,null),g([a()],y.prototype,`layer`,void 0),g([a({type:ye,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],y.prototype,`id`,void 0),g([f(`service`,`id`)],y.prototype,`readIdOnlyOnce`,null),g([a(s(String))],y.prototype,`modelName`,void 0),g([a(s(Boolean))],y.prototype,`isEmpty`,void 0),g([a({type:Boolean,nonNullable:!0})],y.prototype,`legendEnabled`,void 0),g([a({type:Boolean,json:{name:`visibility`,write:!0}})],y.prototype,`visible`,void 0),g([a({type:Number,json:{write:!0}})],y.prototype,`opacity`,void 0),y=g([d(`esri.layers.buildingSublayers.BuildingSublayer`)],y);var b=ee(),x=class extends _e(n(y)){constructor(e){super(e),this.type=`building-component`,this.nodePages=null,this.materialDefinitions=[],this.textureSetDefinitions=[],this.geometryDefinitions=[],this.indexInfo=null,this.serviceUpdateTimeStamp=null,this.store=null,this.attributeStorageInfo=[],this.fields=[],this.associatedLayer=null,this.outFields=null,this.listMode=`show`,this.renderer=null,this.definitionExpression=null,this.popupEnabled=!0,this.popupTemplate=null,this.layerType=`3d-object`}initialize(){this._set(`graphicOrigin`,new nt(this))}get parsedUrl(){return this.layer?{path:`${this.layer.parsedUrl?.path}/sublayers/${this.id}`,query:this.layer.parsedUrl?.query}:{path:``}}get fieldsIndex(){return new ne(this.fields)}readAssociatedLayer(e,t){let n=this.layer.associatedFeatureServiceItem,r=t.associatedLayerID;return n!=null&&typeof r==`number`?new p({portalItem:n,customParameters:this.customParameters,layerId:r}):null}get objectIdField(){if(this.fields!=null){for(let e of this.fields)if(e.type===`oid`)return e.name}return``}get globalIdField(){if(this.fields!=null){for(let e of this.fields)if(e.type===`global-id`)return e.name}return``}get displayField(){return this.associatedLayer==null?void 0:this.associatedLayer.displayField}get apiKey(){return this.layer.apiKey}get customParameters(){return this.layer.customParameters}get fullExtent(){return this.layer.fullExtent}get spatialReference(){return this.layer.spatialReference}get version(){return this.layer.version}get elevationInfo(){return this.layer.elevationInfo}get minScale(){return this.layer.minScale}get maxScale(){return this.layer.maxScale}get effectiveScaleRange(){return this.layer.effectiveScaleRange}get defaultPopupTemplate(){return this.createPopupTemplate()}load(e){let t=e==null?null:e.signal,n=this._fetchService(t).then(()=>{this.indexInfo=We(this.parsedUrl.path,this.rootNode,this.nodePages,this.customParameters,this.apiKey,o.getLogger(this),t)});return this.addResolvingPromise(n),Promise.resolve(this)}createPopupTemplate(e){return ve(this,e)}async _fetchService(e){let t=(await ge(this.parsedUrl.path,{query:{f:`json`,...this.customParameters,token:this.apiKey},responseType:`json`,signal:e})).data;this.read(t,{origin:`service`,url:this.parsedUrl})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){let n=this.getField(e)?.domain??null;return this.associatedLayer?Fe(this.associatedLayer,e,t,n):n}getFeatureType(e){return e&&this.associatedLayer!=null?this.associatedLayer.getFeatureType(e):null}get types(){return this.associatedLayer==null?[]:this.associatedLayer.types??[]}get typeIdField(){return this.associatedLayer==null?null:this.associatedLayer.typeIdField}get geometryType(){return this.layerType===`3d-object`?`mesh`:`point`}get profile(){return this.layerType===`3d-object`?`mesh-pyramids`:`points`}get capabilities(){let e=this.associatedLayer!=null&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:He,{query:t,operations:{supportsQuery:n},data:{supportsZ:r,supportsM:i,isVersioned:a}}=e;return{query:t,operations:{supportsQuery:n},data:{supportsZ:r,supportsM:i,isVersioned:a}}}createQuery(){let e=new Pe;return this.geometryType!==`mesh`&&(e.returnGeometry=!0,e.returnZ=!0),e.where=this.definitionExpression||`1=1`,e.sqlFormat=`standard`,e}queryExtent(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryExtent(e||this.createQuery(),t))}queryFeatureCount(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatureCount(e||this.createQuery(),t))}queryFeatures(e,t){return this._getAssociatedLayerForQuery().then(n=>n.queryFeatures(e||this.createQuery(),t)).then(e=>{if(e?.features)for(let t of e.features)t.layer=this.layer,t.sourceLayer=this,t.origin=this.graphicOrigin;return e})}async queryObjectIds(e,t){return(await(await this._getAssociatedLayerForQuery()).queryObjectIds(e||this.createQuery(),t)).filter(Se)}async queryCachedAttributes(e,t){let n=ke(this.fieldsIndex,await Xe(this,Ze(this)));return Ye(this.parsedUrl.path,this.attributeStorageInfo,e,t,n,this.apiKey,this.customParameters)}async queryCachedFeature(t,n){let r=await this.queryCachedAttributes(t,[n]);if(!r||r.length===0)throw new e(`scenelayer:feature-not-in-cached-data`,`Feature not found in cached data`);return new se({attributes:r[0],layer:this,sourceLayer:this})}getFieldUsageInfo(e){return this.fieldsIndex.has(e)?{supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1}:{supportsLabelingInfo:!1,supportsRenderer:!0,supportsPopupTemplate:!0,supportsLayerQuery:this.associatedLayer!=null}}_getAssociatedLayerForQuery(){let e=this.associatedLayer;return e!=null&&e.loaded?Promise.resolve(e):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),this.associatedLayer==null)throw new e(`buildingscenelayer:query-not-available`,`BuildingSceneLayer component layer queries are not available without an associated feature layer`,{layer:this});try{await this.associatedLayer.load()}catch(t){throw new e(`buildingscenelayer:query-not-available`,`BuildingSceneLayer associated feature layer could not be loaded`,{layer:this,error:t})}return this.associatedLayer}};g([a({readOnly:!0})],x.prototype,`parsedUrl`,null),g([a({type:qe,readOnly:!0})],x.prototype,`nodePages`,void 0),g([a({type:[Je],readOnly:!0})],x.prototype,`materialDefinitions`,void 0),g([a({type:[Ge],readOnly:!0})],x.prototype,`textureSetDefinitions`,void 0),g([a({type:[Ke],readOnly:!0})],x.prototype,`geometryDefinitions`,void 0),g([a({readOnly:!0})],x.prototype,`serviceUpdateTimeStamp`,void 0),g([a({readOnly:!0})],x.prototype,`store`,void 0),g([a({type:String,readOnly:!0,json:{read:{source:`store.rootNode`}}})],x.prototype,`rootNode`,void 0),g([a({readOnly:!0})],x.prototype,`attributeStorageInfo`,void 0),g([a(b.fields)],x.prototype,`fields`,void 0),g([a({readOnly:!0})],x.prototype,`fieldsIndex`,null),g([a({readOnly:!0,type:p})],x.prototype,`associatedLayer`,void 0),g([f(`service`,`associatedLayer`,[`associatedLayerID`])],x.prototype,`readAssociatedLayer`,null),g([a(b.outFields)],x.prototype,`outFields`,void 0),g([a({type:String,readOnly:!0})],x.prototype,`objectIdField`,null),g([a({type:String,readOnly:!0})],x.prototype,`globalIdField`,null),g([a({readOnly:!0,type:String,json:{read:!1}})],x.prototype,`displayField`,null),g([a({readOnly:!0,type:String})],x.prototype,`apiKey`,null),g([a({readOnly:!0,type:String})],x.prototype,`customParameters`,null),g([a({readOnly:!0,type:ze})],x.prototype,`fullExtent`,null),g([a({readOnly:!0,type:u})],x.prototype,`spatialReference`,null),g([a({readOnly:!0})],x.prototype,`version`,null),g([a({readOnly:!0,type:Ve})],x.prototype,`elevationInfo`,null),g([a({readOnly:!0,type:Number})],x.prototype,`minScale`,null),g([a({readOnly:!0,type:Number})],x.prototype,`maxScale`,null),g([a({readOnly:!0,type:Number})],x.prototype,`effectiveScaleRange`,null),g([a({type:[`hide`,`show`],json:{write:!0}})],x.prototype,`listMode`,void 0),g([a({types:de,json:{origins:{service:{read:{source:`drawingInfo.renderer`}}},name:`layerDefinition.drawingInfo.renderer`,write:!0},value:null})],x.prototype,`renderer`,void 0),g([a({type:String,json:{origins:{service:{read:!1,write:!1}},name:`layerDefinition.definitionExpression`,write:{enabled:!0,allowNull:!0}}})],x.prototype,`definitionExpression`,void 0),g([a(i)],x.prototype,`popupEnabled`,void 0),g([a({type:Ce,json:{read:{source:`popupInfo`},write:{target:`popupInfo`}}})],x.prototype,`popupTemplate`,void 0),g([a({readOnly:!0,type:String,json:{origins:{service:{read:{source:`store.normalReferenceFrame`}}},read:!1}})],x.prototype,`normalReferenceFrame`,void 0),g([a({readOnly:!0,json:{read:!1}})],x.prototype,`defaultPopupTemplate`,null),g([a({readOnly:!0})],x.prototype,`graphicOrigin`,void 0),g([a()],x.prototype,`types`,null),g([a()],x.prototype,`typeIdField`,null),g([a({json:{write:!1}}),l(new Ie({"3DObject":`3d-object`,Point:`point`}))],x.prototype,`layerType`,void 0),g([a()],x.prototype,`geometryType`,null),g([a()],x.prototype,`profile`,null),g([a({readOnly:!0,json:{read:!1}})],x.prototype,`capabilities`,null),g([a({readOnly:!0})],x.prototype,`statisticsInfo`,void 0),x=g([d(`esri.layers.buildingSublayers.BuildingComponentSublayer`)],x);function S(e,t){e.forEach(e=>{t(e),e.type===`building-group`&&S(e.sublayers,t)})}var C={type:m,readOnly:!0,json:{origins:{service:{read:{source:`sublayers`,reader:w}}},read:!1}};function w(e,t,n){if(e&&Array.isArray(e))return new m(e.map(e=>{let t=rt(e);if(t){let r=new t;return r.read(e,n),r}return n?.messages&&e&&n.messages.push(new me(`building-scene-layer:unsupported-sublayer-type`,`Building scene sublayer of type '`+(e.type||`unknown`)+`' are not supported`,{definition:e,context:n})),null}))}function rt(e){return e.layerType===`group`?T:x}var T=class extends y{constructor(e){super(e),this.type=`building-group`,this.listMode=`show`,this.sublayers=null}loadAll(){return ie(this,e=>S(this.sublayers,t=>{t.type!==`building-group`&&e(t)}))}static{this.sublayersProperty=C}static{this.readSublayers=w}};g([a({type:[`hide`,`show`,`hide-children`],json:{write:!0}})],T.prototype,`listMode`,void 0),g([a(C)],T.prototype,`sublayers`,void 0),T=g([d(`esri.layers.buildingSublayers.BuildingGroupSublayer`)],T);var E=class extends h{constructor(){super(...arguments),this.type=null}};g([a({type:String,readOnly:!0,json:{write:{isRequired:!0}}})],E.prototype,`type`,void 0),E=g([d(`esri.layers.support.BuildingFilterAuthoringInfo`)],E);var D=E,O,k=O=class extends h{constructor(){super(...arguments),this.filterType=null,this.filterValues=null}clone(){return new O({filterType:this.filterType,filterValues:c(this.filterValues)})}};g([a({type:String,json:{write:{isRequired:!0}}})],k.prototype,`filterType`,void 0),g([a({type:[String],json:{write:{isRequired:!0}}})],k.prototype,`filterValues`,void 0),k=O=g([d(`esri.layers.support.BuildingFilterAuthoringInfoType`)],k);var it=k,A,at=m.ofType(it),j=A=class extends h{clone(){return new A({filterTypes:c(this.filterTypes)})}};g([a({type:at,json:{write:{isRequired:!0}}})],j.prototype,`filterTypes`,void 0),j=A=g([d(`esri.layers.support.BuildingFilterAuthoringInfoBlock`)],j);var ot=j,M,st=m.ofType(ot),N=M=class extends D{constructor(){super(...arguments),this.type=`checkbox`}clone(){return new M({filterBlocks:c(this.filterBlocks)})}};g([a({type:[`checkbox`]})],N.prototype,`type`,void 0),g([a({type:st,json:{write:{isRequired:!0}}})],N.prototype,`filterBlocks`,void 0),N=M=g([d(`esri.layers.support.BuildingFilterAuthoringInfoCheckbox`)],N);var P=N,F=class extends h{};g([a({readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],F.prototype,`type`,void 0),F=g([d(`esri.layers.support.BuildingFilterMode`)],F);var I=F,L,R=L=class extends I{constructor(){super(...arguments),this.type=`solid`}clone(){return new L}};g([a({type:[`solid`],readOnly:!0,json:{write:{isRequired:!0}}})],R.prototype,`type`,void 0),R=L=g([d(`esri.layers.support.BuildingFilterModeSolid`)],R);var z=R,B,V=B=class extends I{constructor(){super(...arguments),this.type=`wire-frame`,this.edges=null}clone(){return new B({edges:c(this.edges)})}};g([l({wireFrame:`wire-frame`})],V.prototype,`type`,void 0),g([a(t)],V.prototype,`edges`,void 0),V=B=g([d(`esri.layers.support.BuildingFilterModeWireFrame`)],V);var H=V,U,W=U=class extends I{constructor(){super(...arguments),this.type=`x-ray`}clone(){return new U}};g([a({type:[`x-ray`],readOnly:!0,json:{write:{isRequired:!0}}})],W.prototype,`type`,void 0),W=U=g([d(`esri.layers.support.BuildingFilterModeXRay`)],W);var ct=W,G,K=G=class extends h{constructor(){super(...arguments),this.filterExpression=null,this.filterMode=new z,this.title=``}clone(){return new G({filterExpression:this.filterExpression,filterMode:c(this.filterMode),title:this.title})}};g([a({type:String,json:{write:{enabled:!0,isRequired:!0}}})],K.prototype,`filterExpression`,void 0),g([a({nonNullable:!0,types:{key:`type`,base:I,typeMap:{solid:z,"wire-frame":H,"x-ray":ct}},json:{read:e=>{switch(e?.type){case`solid`:return z.fromJSON(e);case`wireFrame`:return H.fromJSON(e);case`x-ray`:return ct.fromJSON(e);default:return}},write:{enabled:!0,isRequired:!0}}})],K.prototype,`filterMode`,void 0),g([a({type:String,json:{write:{enabled:!0,isRequired:!0}}})],K.prototype,`title`,void 0),K=G=g([d(`esri.layers.support.BuildingFilterBlock`)],K);var lt=K,q,ut=m.ofType(lt),J=q=class extends h{constructor(e){super(e),this.description=null,this.filterBlocks=null,this.id=Ae(),this.name=null}clone(){return new q({description:this.description,filterBlocks:c(this.filterBlocks),id:this.id,name:this.name,filterAuthoringInfo:c(this.filterAuthoringInfo)})}};g([a({type:String,json:{write:!0}})],J.prototype,`description`,void 0),g([a({type:ut,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`filterBlocks`,void 0),g([a({types:{key:`type`,base:D,typeMap:{checkbox:P}},json:{read:e=>e?.type===`checkbox`?P.fromJSON(e):null,write:!0}})],J.prototype,`filterAuthoringInfo`,void 0),g([a({type:String,constructOnly:!0,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`id`,void 0),g([a({type:String,json:{write:{enabled:!0,isRequired:!0}}})],J.prototype,`name`,void 0),J=q=g([d(`esri.layers.support.BuildingFilter`)],J);var Y=class extends h{constructor(){super(...arguments),this.fieldName=null,this.modelName=null,this.label=null,this.min=null,this.max=null,this.mostFrequentValues=null,this.subLayerIds=null}};g([a({type:String})],Y.prototype,`fieldName`,void 0),g([a({type:String})],Y.prototype,`modelName`,void 0),g([a({type:String})],Y.prototype,`label`,void 0),g([a({type:Number})],Y.prototype,`min`,void 0),g([a({type:Number})],Y.prototype,`max`,void 0),g([a({json:{read:e=>Array.isArray(e)&&(e.every(e=>typeof e==`string`)||e.every(e=>typeof e==`number`))?e.slice():null}})],Y.prototype,`mostFrequentValues`,void 0),g([a({type:[Number]})],Y.prototype,`subLayerIds`,void 0),Y=g([d(`esri.layers.support.BuildingFieldStatistics`)],Y);var dt=Y,X=class extends _e(n(h)){constructor(e){super(e),this.url=null,this.customParameters=null}get fields(){return this.loaded||this.loadStatus===`loading`?this._get(`fields`):(o.getLogger(this).error(`building summary statistics are not loaded`),null)}load(e){let t=e==null?null:e.signal;return this.addResolvingPromise(this._fetchService(t)),Promise.resolve(this)}async _fetchService(e){let t=(await ge(this.url,{query:{f:`json`,...this.customParameters,token:this.apiKey},responseType:`json`,signal:e})).data;this.read(t,{origin:`service`})}};g([a({constructOnly:!0,type:String})],X.prototype,`url`,void 0),g([a({constructOnly:!0})],X.prototype,`customParameters`,void 0),g([a({constructOnly:!0})],X.prototype,`apiKey`,void 0),g([a({readOnly:!0,type:[dt],json:{read:{source:`summary`}}})],X.prototype,`fields`,null),X=g([d(`esri.layers.support.BuildingSummaryStatistics`)],X);var ft=m.ofType(J),pt=c(T.sublayersProperty),Z=pt.json?.origins;Z&&(Z[`web-scene`]={type:[x],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}},Z[`portal-item`]={type:[x],write:{enabled:!0,overridePolicy:()=>({enabled:!1})}});var Q=class extends Ue(Ne(ae(oe(r(ue(xe(je(le)))))))){constructor(e){super(e),this.operationalLayerType=`BuildingSceneLayer`,this.allSublayers=new Me({getCollections:()=>[this.sublayers],getChildrenFunction:e=>e.type===`building-group`?e.sublayers:null}),this.sublayers=null,this._allSublayerOverrides=null,this.filters=new ft,this.activeFilterId=null,this.summaryStatistics=null,this.outFields=null,this.legendEnabled=!0,this.type=`building-scene`}normalizeCtorArgs(e){return typeof e==`string`?{url:e}:e??{}}destroy(){this.allSublayers.destroy()}readSublayers(e,t,n){let r=T.readSublayers(e,t,n);return S(r,e=>e.layer=this),this._allSublayerOverrides&&=(mt(r,this._allSublayerOverrides),null),r}write(e,t){return e=super.write(e,t),!t||t.origin!==`web-scene`&&t.origin!==`portal-item`||(this.sublayers?gt(this.sublayers,e,t):this._allSublayerOverrides&&_t(this._allSublayerOverrides,e,t)),e}read(e,t){if(super.read(e,t),(t?.origin===`web-scene`||t?.origin===`portal-item`)&&Array.isArray(e?.sublayers)){let n=ht(e.sublayers,t);this.sublayers?$(this.sublayers,n):(this._allSublayerOverrides??=new Map,this._allSublayerOverrides.set(t.origin,n))}}readSummaryStatistics(e,t){if(typeof t.statisticsHRef==`string`&&this.parsedUrl){let e=re(this.parsedUrl.path,t.statisticsHRef);return new X({url:e,apiKey:this.apiKey,customParameters:this.customParameters})}return null}set elevationInfo(e){e!=null&&e.mode!==`absolute-height`||this._set(`elevationInfo`,e),this._validateElevationInfo(e)}load(e){let t=e==null?null:e.signal,n=this.loadFromPortal({supportedTypes:[`Scene Service`]},e).catch(Le).then(()=>this._fetchService(t)).then(()=>this._fetchAssociatedFeatureService(t));return this.addResolvingPromise(n),Promise.resolve(this)}loadAll(){return he(this,e=>{S(this.sublayers,t=>{t.type!==`building-group`&&e(t)}),this.summaryStatistics&&e(this.summaryStatistics)})}async saveAs(e,t){return this._debouncedSaveOperations(1,{...t,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`building-scene`},e)}async save(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:`building-scene`})}validateLayer(t){if(!t.layerType||t.layerType!==`Building`)throw new e(`buildingscenelayer:layer-type-not-supported`,`BuildingSceneLayer does not support this layer type`,{layerType:t.layerType})}_getTypeKeywords(){return[`Building`]}async _fetchAssociatedFeatureService(e){try{let{portalItem:t}=await Qe(`${this.url}/layers/${this.layerId}`,{sceneLayerItem:this.portalItem,customParameters:this.customParameters,apiKey:this.apiKey,signal:e});this.associatedFeatureServiceItem=t}catch{Te(this._logWarningOnPopupEnabled())}}async _logWarningOnPopupEnabled(){let e=new AbortController;this.addHandles(Ee(e)),await we(()=>this.allSublayers.filter(e=>e.type===`building-component`).some(e=>e.popupEnabled&&e.popupTemplate!=null),e.signal);let t=this.allSublayers.filter(e=>e.type===`building-component`).filter(e=>e.popupEnabled&&e.popupTemplate!=null),n=[],r=[];for(let e of t){let t=e.title??`untitled ${e.id}`;e.attributeStorageInfo?n.push(t):r.push(t)}let i=n.length>0?`\nThe following sublayers will fall back to binary attributes for Popups:
  ${n.join(`
  `)}`:``,a=r.length>0?`\nThe following sublayers have no binary attributes and will not work with Popups:
  ${r.join(`
  `)}`:``;o.getLogger(this).warn(`Associated FeatureLayer could not be loaded for this BuildingSceneLayer: ${this.title}.`,i,a)}_validateElevationInfo(e){let t=`Building scene layers`;_(o.getLogger(this),et(t,`absolute-height`,e)),_(o.getLogger(this),$e(t,e))}};function mt(e,t){t.forEach(t=>$(e,t))}function $(e,t){let{overrides:n,context:r}=t;S(e,e=>e.read(n.get(e.id),r))}function ht(t,n){let r=new Map;for(let i of t)typeof i==`object`&&i&&typeof i.id==`number`?r.set(i.id,i):n.messages?.push(new e(`building-scene-layer:invalid-sublayer-override`,`Invalid value for sublayer override. Not an object or no id specified.`,{value:i}));return{overrides:r,context:n}}function gt(e,t,n){let r=[];S(e,e=>{let t=e.write({},n);Object.keys(t).length>1&&r.push(t)}),r.length>0&&(t.sublayers=r)}function _t(e,t,n){let r=n?.origin&&e.get(n.origin);r&&(t.sublayers=[],r.overrides.forEach(e=>{t.sublayers.push(c(e))}))}g([a({type:[`BuildingSceneLayer`]})],Q.prototype,`operationalLayerType`,void 0),g([a({readOnly:!0})],Q.prototype,`allSublayers`,void 0),g([a(pt)],Q.prototype,`sublayers`,void 0),g([f(`service`,`sublayers`)],Q.prototype,`readSublayers`,null),g([a({type:ft,nonNullable:!0,json:{write:!0}})],Q.prototype,`filters`,void 0),g([a({type:String,json:{write:!0}})],Q.prototype,`activeFilterId`,void 0),g([a({readOnly:!0,type:X})],Q.prototype,`summaryStatistics`,void 0),g([f(`summaryStatistics`,[`statisticsHRef`])],Q.prototype,`readSummaryStatistics`,null),g([a({type:[String],json:{read:!1}})],Q.prototype,`outFields`,void 0),g([a(ce)],Q.prototype,`fullExtent`,void 0),g([a(te)],Q.prototype,`legendEnabled`,void 0),g([a({type:[`show`,`hide`,`hide-children`]})],Q.prototype,`listMode`,void 0),g([a(s(u))],Q.prototype,`spatialReference`,void 0),g([a(Oe)],Q.prototype,`elevationInfo`,null),g([a({json:{read:!1},readOnly:!0})],Q.prototype,`type`,void 0),g([a()],Q.prototype,`associatedFeatureServiceItem`,void 0),Q=g([d(`esri.layers.BuildingSceneLayer`)],Q);var vt=Q;export{vt as default};