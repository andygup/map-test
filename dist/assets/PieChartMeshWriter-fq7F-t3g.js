import{$l as e,Ac as t,BT as n,Bc as r,Cc as i,Eu as a,Hc as o,Lc as s,Ms as c,Ou as l,Rc as u,Vc as d,Xv as f,dw as p,fb as m,fc as h,fw as g,ig as _,ln as v,mE as y,pD as b,rh as x,tn as ee,uE as S,uc as C,wu as te}from"./index-ByaFsVj4.js";import{t as ne}from"./OptimizedGeometry-DX91by73.js";import{g as re,u as ie}from"./GeometryUtils-BAHLKUGl.js";import{n as w}from"./labelPoint-DoaytHlZ.js";import{C as ae,S as oe,T as se,g as ce,h as le,i as ue,p as de,w as fe,x as pe}from"./CIMSymbolHelper-CZHBBcY6.js";import{d as me}from"./rasterizingUtils-LzhctegF.js";import{n as he,r as ge,t as _e}from"./TurboLine-CIru50vB.js";import{c as ve,i as ye,r as be,t as xe}from"./utils-Dm-H4TMy.js";import{a as T,i as Se,n as Ce,r as we,s as E}from"./UpdateTracking2D-VGFir_CJ.js";import{S as Te,a as Ee,d as De,i as Oe,l as ke,n as Ae,o as je,r as Me,t as Ne,u as Pe}from"./constants-TfCITEY_.js";function Fe(e,t){let n;if(typeof e==`string`)n=y(e+`-seed(${t})`);else{let r=12;n=e^t;do n=107*(n>>8^n)+r|0;while(--r!==0)}return(1+n/(1<<31))/2}function Ie(e){return Math.floor(Fe(e,Le)*Re)}var Le=53290320,Re=10;function D(e){return e instanceof O?e:typeof e==`object`&&`type`in e?ze[e.type].hydrate(e):new k(e)}var O=class{constructor(e){this.inputs=e}encode(){let e=[];for(let t of this.inputs)e.push(...t.encode());return e.push(...this.instructions),e}},k=class extends O{constructor(e){super([]),this.value=e}simplify(){return this}get instructions(){if(Array.isArray(this.value)){let[e,t,n,r]=this.value;return r==null?E.vector3.encode([e,t||0,n||0]):E.vector4.encode([e,t||0,n||0,r])}return E.scalar.encode(this.value)}},ze={AnimatedTransform:class e extends O{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(t){return new e(t,D(t.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;let t=this._parent.simplify();if(!(t instanceof k))return this;let[n,r,i,a]=t.value,o=this._config.translation.from[0],s=this._config.translation.from[1],c=this._config.rotation.from,l=this._config.scale.from;if(o===this._config.translation.to[0]&&s===this._config.translation.to[1]&&c===this._config.rotation.to&&l===this._config.scale.to){let e=i+c,t=a*l,u=Math.sin(i),d=Math.cos(i);return new k([d*a*o-u*a*s+n,u*a*o+d*a*s+r,e,t])}return new e(this._config,t)}get instructions(){return E.animatedTransform.encode(this._config)}},AnimatedColor:class e extends O{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(t){return new e(t,D(t.parent))}simplify(){let t=this._parent.simplify();if(!(t instanceof k))return this;let[n,r,i,a]=t.value,o=this._config.color.from[0],s=this._config.color.from[1],c=this._config.color.from[2],l=this._config.color.from[3],u=this._config.opacity.from;return o===this._config.color.to[0]&&s===this._config.color.to[1]&&c===this._config.color.to[2]&&l===this._config.color.to[3]&&u===this._config.opacity.to?(l*=u,new k([n*o,r*s,i*c,a*l])):new e(this._config,t)}get instructions(){return E.animatedColor.encode(this._config)}},AnimatedShift:class e extends O{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(t){return new e(t,D(t.parent))}simplify(){let t=this._parent.simplify();return t instanceof k?new e(this._config,t):this}get instructions(){return E.animatedShift.encode(this._config)}}};function Be(e){return He(e.map(e=>A(e)).map(e=>D(e).simplify()))}function Ve(e){let t=[];return t.push(e.transform),t.push(e.fromColor),t.push(e.toColor),t.push(e.colorMix),t.push(e.toOpacity),t.push(e.opacityMix),e?.shift?t.push(e?.shift):t.push([1,1,1,1]),t}function He(e){let t=[],n=[],r=0;for(let i of e){let a=[...i.encode(),...E.ret.encode()];t.push([r+e.length,0,0,0]),n.push(...a),r+=a.length}return[...t,...n]}async function Ue(e,t){let n=e,r;if(typeof n==`number`||typeof n==`string`||typeof n==`boolean`)r=n;else if(Array.isArray(n))r=await Promise.all(n.map(e=>Ue(e,t)));else if(typeof n==`object`)if(`valueExpressionInfo`in n){let{valueExpressionInfo:e}=n,{expression:i}=e;r={...n,computed:await t.createComputedField({expression:i})}}else for(let e in r={},n)r[e]=await Ue(n[e],t);return r}function A(e,t,n){function r(e){if(!(`computed`in e))return e;let r=e.computed.readWithDefault(t,n,[255*e.defaultValue[0],255*e.defaultValue[1],255*e.defaultValue[2],e.defaultValue[3]]);if(typeof r==`string`){let e=x.fromString(r);e&&(r=[e.r,e.g,e.b,e.a])}return r}let i=e,a;if(typeof i==`number`||typeof i==`string`||typeof i==`boolean`)a=i;else if(Array.isArray(i))a=i.map(e=>A(e,t,n));else if(typeof i==`object`)if(`type`in i&&i.type!=null&&i.type===`Process`)switch(i.op){case`ArcadeColor`:{let e=A(i.value,t,n);M(Array.isArray(e)&&e.length===4),a=[e[0]/255,e[1]/255,e[2]/255,e[3]]}break;case`Transparency`:{let e=A(i.value,t,n);M(typeof e==`number`),a=1-e/100}break;case`Divide`:case`Multiply`:case`Add`:{let e=A(i.left,t,n);M(typeof e==`number`);let r=A(i.right,t,n);switch(M(typeof r==`number`),i.op){case`Divide`:a=e/r;break;case`Multiply`:a=e*r;break;case`Add`:a=e+r}}break;case`Random`:{let e=A(i.seed,t,n),r=A(i.min,t,n),o=A(i.max,t,n),s=t.getObjectId(),c=Ie(s||0);a=r+Fe(c,e)*(o-r)}break;case`Cond`:{let e=A(i.condition,t,n),r=A(i.ifTrue,t,n),o=A(i.ifFalse,t,n);a=e?r:o}break;case`MatchWinding`:{let e=A(i.sign,t,n),r=A(i.angle,t,n);if(e>0)for(;r<0;)r+=2*Math.PI;else for(;r>0;)r-=2*Math.PI;a=r}}else if(`computed`in i)a=r(i);else for(let e in a={},i)a[e]=A(i[e],t,n);return a}function*j(e){let t=e;if(Array.isArray(t))for(let e of t)yield*j(e);else if(typeof t==`object`)if(`type`in t&&t.type!=null&&t.type===`Process`)switch(t.op){case`ArcadeColor`:case`Transparency`:yield*j(t.value);break;case`Divide`:case`Multiply`:case`Add`:yield*j(t.left),yield*j(t.right);break;case`Random`:yield*j(t.seed),yield*j(t.min),yield*j(t.max);break;case`Cond`:yield*j(t.condition),yield*j(t.ifTrue),yield*j(t.ifFalse);break;case`MatchWinding`:yield*j(t.sign),yield*j(t.angle)}else if(`computed`in t)yield t.computed;else for(let e in t)yield*j(t[e])}function M(e){if(!e)throw Error(`Assertion failed.`)}var We=()=>S.getLogger(`esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils`),Ge=0,Ke=100;function N(e,t){return[!!e?.minScale&&t.scaleToZoom(e.minScale)||Ge,!!e?.maxScale&&t.scaleToZoom(e.maxScale)||Ke]}function P(e){return 1<<e}function F(e){let t=0;for(let[n,r]of e)r&&(t|=1<<n);return t}function I(e){let t;if(!e)return[0,0,0,0];if(typeof e==`string`){let r=x.fromString(e);if(!r)return We().errorOnce(new n(`mapview:mesh-processing`,`Unable to parse string into color`,{color:e})),[0,0,0,0];t=r.toArray()}else t=e;let[r,i,a,o]=t;return[r*(o/255),i*(o/255),a*(o/255),o]}function qe(e){switch(e){case`butt`:case`Butt`:return 0;case`round`:case`Round`:return 1;case`square`:case`Square`:return 2}}function Je(e){switch(e){case`bevel`:case`Bevel`:return 0;case`miter`:case`Miter`:return 2;case`round`:case`Round`:return 1}}function Ye(e,t){return Math.round(Math.min(Math.sqrt(e*t),255))}function L(e,t){return Math.round(e*t)/t}var Xe=96/72,Ze=class{static executeEffects(e,t,n,r){let i=Xe,a=ue(e),o=new se(t);for(let t of e){let e=pe(t);e&&(o=e.execute(o,t,i,n,a,r))}return o}static applyEffects(e,t){if(!e)return t;let n=ue(e),r,i=new se(w.fromJSONCIM(t));for(let t of e){let e=pe(t);e&&(i=e.execute(i,t,1,null,n,!1))}let a=[],o=null;for(;r=i.next();)a.push(...f(r)),o=r.geometryType;return a.length===0||o===null?null:o===`esriGeometryPolygon`?{rings:a}:{paths:a}}};function Qe(e){switch(e){case c.BYTE:case c.UNSIGNED_BYTE:return 1;case c.SHORT:case c.UNSIGNED_SHORT:case c.HALF_FLOAT:return 2;case c.FLOAT:case c.INT:case c.UNSIGNED_INT:return 4}}function $e(e){let t=[],n=[],r=[];for(let i of e){let e=Qe(i.type)*i.count;switch(e%2||e%4||4){case 4:t.push(i);continue;case 2:n.push(i);continue;case 1:r.push(i);continue;default:throw Error(`Found unexpected dataType byte count`)}}return t.push(...n),t.push(...r),t}var et=class e{static fromVertexSpec(t,n){let{attributes:r,optionalAttributes:i}=t,a,o,s,c=[];for(let e in r){if(r[e].otherSource)continue;let t=r[e];t.pack===`position`?a={...t,name:e,offset:0}:t.pack===`id`?o={...t,name:e,offset:4}:e===`bitset`?s={...t,name:e,offset:7}:c.push({...t,name:e})}for(let e in i)if(!0===n[e]){let t=i[e];c.push({...t,name:e})}let l=$e(c),u=[],d=8,f=1;for(let e of l)u.push({...e,offset:d}),d+=Qe(e.type)*e.count,e.packAlternating&&(f=Math.max(e.packAlternating.count,f));let p=Uint32Array.BYTES_PER_ELEMENT,m=d%p;return new e(a,o,s,u,d+(m?p-m:0),f)}constructor(e,t,n,r,i,a){this.position=e,this.id=t,this.bitset=n,this.standardAttributes=r,this.stride=i,this.packVertexCount=a,r.push(n),this._attributes=[e,t,n,...r]}get attributeLayout(){if(!this._attributeLayout){let e=be(this._attributes);this._attributeLayout={attributes:this._attributes.map(e=>({name:e.name,count:e.count,offset:e.offset,type:e.type,packPrecisionFactor:e.packPrecisionFactor,normalized:e.normalized??!1})),hash:e,stride:this.stride}}return this._attributeLayout}},tt=class e{static fromVertexSpec(t,n){let r=et.fromVertexSpec(t,n);return new e(r)}constructor(e){this._spec=e,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(e,t,n,r,i,a){for(let e=0;e<this._spec.packVertexCount;e++){let o=e*this._spec.stride;this._packPosition(n,r,o),this._packId(t,o);let s=this._spec.bitset;if(a){if(s.packTessellation){let e=s.packTessellation(a,i,n,r);this._pack(e,s,o)}for(let e of this._spec.standardAttributes)if(e.packTessellation!=null){let t=e.packTessellation(a,i,n,r);this._pack(t,e,o)}else if(e.packAlternating?.packTessellation){let t=e.packAlternating.packTessellation(a,i,n,r);for(let n=0;n<this._spec.packVertexCount;n++){let r=t[n];this._pack(r,e,n*this._spec.stride)}}}}e.vertexWriteRegion(this._packedU32View)}pack(e,t){for(let n of this._spec.standardAttributes)if(n.pack&&typeof n.pack!=`string`){let r=n.pack(e,t);for(let e=0;e<this._spec.packVertexCount;e++)this._pack(r,n,e*this._spec.stride)}else if(n.packAlternating?.pack){let r=n.packAlternating.pack(e,t);for(let e=0;e<this._spec.packVertexCount;e++){let t=r[e];this._pack(t,n,e*this._spec.stride)}}}_packPosition(e,t,n){let{offset:r}=this._spec.position,i=this._spec.position.packPrecisionFactor??1,a=ve(e*i,t*i);this._dataView.setUint32(n+r,a,!0)}_packId(e,t){let n=e*(this._spec.id.packPrecisionFactor??1),r=4278190080&this._dataView.getUint32(t+this._spec.id.offset,!0);this._dataView.setUint32(t+this._spec.id.offset,n|r,!0)}_pack(e,t,n){ye(this._dataView,e,t,n)}},R=class{constructor(e,t,n,r){this._instanceId=e,this._evaluator=t,this._enabledOptionalAttributes=n,this._viewParams=r,this._evaluator.evaluator=e=>this.vertexSpec.createComputedParams(e)}get _vertexPack(){if(!this._cachedVertexPack){let e=tt.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||e.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=e}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get effectInfos(){return this._evaluator.inputMeshParams.effects?.effectInfos}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}get _preventEffectClipping(){return!1}setReferences(e){this._references=e}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){for(let{effect:e}of this.effectInfos||[])await fe(e)}enqueueRequest(e,t,n){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(e,t,n)}write(e,t,n,r,i){this.ensurePacked(t,n,r);let a=this.evaluatedMeshParams.effects;if(!a||a.length===0)return void this._write(e,n,void 0,i);let o=this.getEffectCursor(e,n,a);if(!o)return;let s;for(;s=o.next();)s.invertY(),this._write(e,n,s,i)}ensurePacked(e,t,n){if(!this._evaluator.hasDynamicProperties)return;let r=this._evaluator.evaluateMeshParams(e,t,n);this._vertexPack.pack(r,this._viewParams)}hasArcadeDependency(e){return this._evaluator.hasArcadeDependency(e)}_writeVertex(e,t,n,r,i){let a=this.evaluatedMeshParams;this._vertexPack.writeVertex(e,t,n,r,a,i)}getEffectCursor(e,t,n){let r=t.readGeometryForDisplay()?.clone();if(!r)return;let i=w.fromOptimizedCIM(r,t.geometryType);i.invertY();let a=e.id||``;return Ze.executeEffects(n,i,a,this._preventEffectClipping)}},nt=class extends R{};function rt(e){let{sprite:t,isMapAligned:n,colorLocked:r,scaleSymbolsProportionally:i,isStroke:a}=e,o=0;return n&&(o|=P(T.bitset.isMapAligned)),r&&(o|=P(T.bitset.colorLocked)),t.sdf&&(o|=P(T.bitset.isSDF)),i&&(o|=P(T.bitset.scaleSymbolsProportionally)),a&&(o|=P(T.bitset.isStroke)),o}var it={type:c.SHORT,count:2,packPrecisionFactor:10,pack:({scaleInfo:e},{tileInfo:t})=>N(e,t)},at={type:c.FLOAT,count:4,packPrecisionFactor:1,packTessellation:({value1Position2Value2:e})=>(M(e),e)},ot={type:c.FLOAT,count:4,packPrecisionFactor:1,packTessellation:()=>[0,0,0,1]},st={type:c.FLOAT,count:1,packPrecisionFactor:1,pack:()=>0},ct={type:c.FLOAT,count:1,packPrecisionFactor:1,packTessellation:({lineLength:e})=>e},lt={type:c.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},ut={type:c.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},dt={type:c.FLOAT,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[e,t]},ft={type:c.UNSIGNED_BYTE,count:3,pack:`id`},pt={type:c.UNSIGNED_BYTE,count:1,pack:rt},mt={type:c.SHORT,count:2,pack:`position`,packPrecisionFactor:1},ht={marker:{type:c.FLOAT,count:2,packAlternating:{count:4,pack:({texelDimensions:e})=>[[-.5*e[0],-.5*e[1]],[.5*e[0],-.5*e[1]],[-.5*e[0],.5*e[1]],[.5*e[0],.5*e[1]]]}},line:{type:c.FLOAT,count:2,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t},{baseSize:n})=>[e*n/2,t*n/2]},fill:{type:c.FLOAT,count:2,packTessellation:()=>[0,0]}},gt={marker:{type:c.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:e,texXmin:t,texYmax:n,texYmin:r})=>[[t,r],[e,r],[t,n],[e,n]]}}},_t={type:c.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{let{rect:t,width:n,height:r}=e,i=t.x+4,a=t.y+4;return[i+1,a+1,i+n-1,a+r-1]}},vt={type:c.UNSIGNED_SHORT,count:4,packPrecisionFactor:4,pack:({animations:e,baseSize:t,referenceSize:n})=>[e.dataColumn,e.dataRow,t,n]},yt={type:c.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:e,pixelDimensions:t,baseSize:n,sprite:r,sizeRatio:i})=>{let a=Math.max(n*r.width/r.height,n),o=r.sdfDecodeCoeff*a*i;return[t[0],t[1],e,o]}},bt={type:c.BYTE,count:1,packTessellation:({angle:e})=>e};function xt(e,t,n,r,i,a,o){Wt=0;let s=(r-n)*a,c=i&&i.length,l=c?(i[0]-n)*a:s,u,d,f,p,m,h=St(t,n,r,0,l,a,!0);if(h&&h.next!==h.prev){if(c&&(h=Dt(t,n,r,i,h,a)),s>80*a){u=f=t[0+n*a],d=p=t[1+n*a];for(let e=a;e<l;e+=a){let r=t[e+n*a],i=t[e+1+n*a];u=Math.min(u,r),d=Math.min(d,i),f=Math.max(f,r),p=Math.max(p,i)}m=Math.max(f-u,p-d),m=m===0?0:1/m}B(h,e,a,u,d,m,o,0)}}function St(e,t,n,r,i,a,o){let s;if(o===Pt(e,t,n,r,i,a)>0)for(let n=r;n<i;n+=a)s=Tt(n+t*a,e[n+t*a],e[n+1+t*a],s);else for(let n=i-a;n>=r;n-=a)s=Tt(n+t*a,e[n+t*a],e[n+1+t*a],s);return s&&G(s,s.next)&&(V(s),s=s.next),s}function z(e,t=e){if(!e)return e;let n,r=e;do if(n=!1,r.steiner||!G(r,r.next)&&H(r.prev,r,r.next)!==0)r=r.next;else{if(V(r),r=t=r.prev,r===r.next)break;n=!0}while(n||r!==t);return t}function B(e,t,n,r,i,a,o,s){if(!e)return;!s&&a&&(e=At(e,r,i,a));let c=e;for(;e.prev!==e.next;){let l=e.prev,u=e.next;if(a?wt(e,r,i,a):Ct(e))t.push(l.index/n+o),t.push(e.index/n+o),t.push(u.index/n+o),V(e),e=u.next,c=u.next;else if((e=u)===c){s?s===1?B(e=Lt(e,t,n,o),t,n,r,i,a,o,2):s===2&&Rt(e,t,n,r,i,a,o):B(z(e),t,n,r,i,a,o,1);break}}}function Ct(e){let t=e.prev,n=e,r=e.next;if(H(t,n,r)>=0)return!1;let i=e.next.next,a=i,o=0;for(;i!==e.prev&&(o===0||i!==a);){if(o++,U(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&H(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function wt(e,t,n,r){let i=e.prev,a=e,o=e.next;if(H(i,a,o)>=0)return!1;let s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,c=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,d=Ft(s,c,t,n,r),f=Ft(l,u,t,n,r),p=e.prevZ,m=e.nextZ;for(;p&&p.z>=d&&m&&m.z<=f;){if(p!==e.prev&&p!==e.next&&U(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&H(p.prev,p,p.next)>=0||(p=p.prevZ,m!==e.prev&&m!==e.next&&U(i.x,i.y,a.x,a.y,o.x,o.y,m.x,m.y)&&H(m.prev,m,m.next)>=0))return!1;m=m.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&U(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&H(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=f;){if(m!==e.prev&&m!==e.next&&U(i.x,i.y,a.x,a.y,o.x,o.y,m.x,m.y)&&H(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Tt(e,t,n,r){let i=K.create(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function V(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Et(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function Dt(e,t,n,r,i,a){let o=[];for(let i=0,s=r.length;i<s;i++){let c=St(e,t,n,r[i]*a,i<s-1?r[i+1]*a:n*a,a,!1);c===c.next&&(c.steiner=!0),o.push(Et(c))}o.sort(It);for(let e of o)i=Ot(e,i);return i}function Ot(e,t){let n=kt(e,t);if(!n)return t;let r=Vt(n,e);return z(r,r.next),z(n,n.next)}function kt(e,t){let n=t,r=e.x,i=e.y,a,o=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){let e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>o){if(o=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}a=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!a)return null;if(r===o)return a.prev;let s=a,c=a.x,l=a.y,u,d=1/0;for(n=a.next;n!==s;)r>=n.x&&n.x>=c&&r!==n.x&&U(i<l?r:o,i,c,l,i<l?o:r,i,n.x,n.y)&&(u=Math.abs(i-n.y)/(r-n.x),(u<d||u===d&&n.x>a.x)&&W(n,e)&&(a=n,d=u)),n=n.next;return a}function At(e,t,n,r){let i;for(;i!==e;i=i.next){if(i||=e,i.z===null&&(i.z=Ft(i.x,i.y,t,n,r)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,At(e,t,n,r);i.prevZ=i.prev,i.nextZ=i.next}return e.prevZ.nextZ=null,e.prevZ=null,jt(e)}function jt(e){let t,n=1;for(;;){let r,i=e;e=null,t=null;let a=0;for(;i;){a++,r=i;let o=0;for(;o<n&&r;o++)r=r.nextZ;let s=n;for(;o>0||s>0&&r;){let n;o===0?(n=r,r=r.nextZ,s--):s!==0&&r?i.z<=r.z?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,o--),t?t.nextZ=n:e=n,n.prevZ=t,t=n}i=r}if(t.nextZ=null,n*=2,a<2)return e}}function H(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Mt(e,t,n,r){return!!(G(e,t)&&G(n,r)||G(e,r)&&G(n,t))||H(e,t,n)>0!=H(e,t,r)>0&&H(n,r,e)>0!=H(n,r,t)>0}function Nt(e,t){let n=e;do{if(n.index!==e.index&&n.next.index!==e.index&&n.index!==t.index&&n.next.index!==t.index&&Mt(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Pt(e,t,n,r,i,a){let o=0;for(let n=r,s=i-a;n<i;n+=a)o+=(e[s+t*a]-e[n+t*a])*(e[n+1+t*a]+e[s+1+t*a]),s=n;return o}function U(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function W(e,t){return H(e.prev,e,e.next)<0?H(e,t,e.next)>=0&&H(e,e.prev,t)>=0:H(e,t,e.prev)<0||H(e,e.next,t)<0}function Ft(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function G(e,t){return e.x===t.x&&e.y===t.y}function It(e,t){return e.x-t.x}function Lt(e,t,n,r){let i=e;do{let a=i.prev,o=i.next.next;!G(a,o)&&Mt(a,i,i.next,o)&&W(a,o)&&W(o,a)&&(t.push(a.index/n+r),t.push(i.index/n+r),t.push(o.index/n+r),V(i),V(i.next),i=e=o),i=i.next}while(i!==e);return i}function Rt(e,t,n,r,i,a,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.index!==e.index&&zt(s,e)){let c=Vt(s,e);s=z(s,s.next),c=z(c,c.next),B(s,t,n,r,i,a,o,0),B(c,t,n,r,i,a,o,0);return}e=e.next}s=s.next}while(s!==e)}function zt(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!Nt(e,t)&&W(e,t)&&W(t,e)&&Bt(e,t)}function Bt(e,t){let n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r}function Vt(e,t){let n=K.create(e.index,e.x,e.y),r=K.create(t.index,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}var K=class e{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,n,r){let i=Wt<Ht.length?Ht[Wt++]:new e;return i.index=t,i.x=n,i.y=r,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}},Ht=[],Ut=8096,Wt=0;for(let e=0;e<Ut;e++)Ht.push(new K);var Gt=1e-5,q=new re(0,0,0,1,0),Kt=new re(0,0,0,1,0);function qt(e,t,n){let r=0;for(let i=1;i<n;i++){let n=e[2*(t+i-1)],a=e[2*(t+i-1)+1];r+=(e[2*(t+i)]-n)*(e[2*(t+i)+1]+a)}return r}function Jt(e,t,n,r,i){let a=0;for(let o=n;o<r;o+=3){let n=(e[o]-i)*2,r=(e[o+1]-i)*2,s=(e[o+2]-i)*2;a+=Math.abs((t[n]-t[s])*(t[r+1]-t[n+1])-(t[n]-t[r])*(t[s+1]-t[n+1]))}return a}function Yt(e,t){let{coords:n,lengths:r}=t,i=e,a=0;for(let e=0;e<r.length;){let t=e,o=r[e],s=qt(n,a,o),c=[];for(;++t<r.length;){let e=r[t],i=qt(n,a+o,e);if(!(i>0))break;s+=i,c.push(a+o),o+=e}let l=i.length;xt(i,n,a,a+o,c,2,0);let u=Jt(i,n,l,i.length,0),d=Math.abs(s);if(Math.abs((u-d)/Math.max(1e-7,d))>Gt)return i.length=0,!1;e=t,a+=o}return!0}function Xt(e){let{coords:t,lengths:n}=e,{buffer:r}=he(t,n);return r}function Zt(e,t,n){let r=0;for(let i=0;i<e.lengths.length;i++){let a=e.lengths[i];for(let i=0;i<a;i++){let a=e.coords[2*(i+r)],o=e.coords[2*(i+r)+1];if(a<t||a>n||o<t||o>n)return!0}r+=a}return!1}function Qt(e,t){if(e==null)return null;if(!Zt(e,-128,640))return e;q.setPixelMargin(t),q.reset(3);let n=0;for(let t=0;t<e.lengths.length;t++){let r=e.lengths[t],i=e.coords[2*(0+n)],a=e.coords[2*(0+n)+1];q.moveTo(i,a);for(let t=1;t<r;t++)i=e.coords[2*(t+n)],a=e.coords[2*(t+n)+1],q.lineTo(i,a);q.close(),n+=r}let r=q.result(!1);if(!r)return null;let i=[],a=[];for(let e of r){for(let{x:t,y:n}of e)a.push(t,n);i.push(e.length)}return new ne(i,a)}function $t(e,t){Kt.setPixelMargin(t);let n=Kt,r=-t,i=512+t,a=[],o=!1;if(!e.nextPath())return null;let s=e.pathLength(),c=!0;for(;c;){e.seekPathStart();let t=[];if(!e.pathSize)return null;n.reset(2),e.nextPoint();let l=e.x,u=e.y;if(o)n.moveTo(l,u);else{if(l<r||l>i||u<r||u>i){o=!0;continue}t.push({x:l,y:u})}let d=!1;for(;e.nextPoint();)if(l=e.x,u=e.y,o)n.lineTo(l,u);else{if(l<r||l>i||u<r||u>i){d=!0;break}t.push({x:l,y:u})}if(d)o=!0;else{if(o){let e=n.resultWithStarts();if(e)for(let t of e)a.push({...t,pathLength:s})}else a.push({line:t,start:0,pathLength:s});c=e.nextPath(),s=c?e.pathLength():0,o=!1}}return a=a.filter(e=>e.line.length>1),a.length===0?null:a}q.setExtent(512),Kt.setExtent(512);var en=class{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0,this.pathLength=0,this.distanceOffset=0,this.lineLength=0}},J={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:c.SHORT,count:2,packPrecisionFactor:10,pack:({scaleInfo:e},{tileInfo:t})=>N(e,t)}},attributes:{id:{type:c.UNSIGNED_BYTE,count:3,pack:`id`},pos:{type:c.SHORT,count:2,pack:`position`,packPrecisionFactor:10},bitset:{type:c.UNSIGNED_BYTE,count:1},color:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>I(e)},offset:{type:c.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[L(e,16),L(t,16)]},normal:{type:c.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[L(e,16),L(t,16)]},halfWidth:{type:c.HALF_FLOAT,count:1,pack:({width:e})=>_(.5*e)},referenceHalfWidth:{type:c.HALF_FLOAT,count:1,pack:({referenceWidth:e})=>_(.5*e)}}},tn=class{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0,this.distanceOffset=0}},nn=65535,rn=class extends R{constructor(e,t,n,r){super(e,t,n,r),this.vertexSpec=J,this._currentWrite=new tn,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:nn,textured:!1},this._tessParams=new en,this._initializeTessellator()}writeLineVertices(e,t,n){let r=this._getLines(t);r!=null&&this._writeVertices(e,n,r)}_initializeTessellator(){this._lineTessellator=new _e(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(e,t,n){let r=n??w.fromFeatureSetReaderCIM(t);r&&this._writeGeometry(e,t,r)}_writeGeometry(e,t,n,r){e.recordStart(this.instanceId,this.attributeLayout,r),this.writeLineVertices(e,n,t),e.recordEnd()}_getLines(e){return $t(e,xe(this.evaluatedMeshParams))}_writeVertices(e,t,n){let{_currentWrite:r,_tessellationOptions:i,evaluatedMeshParams:a}=this,{width:o,capType:s,joinType:c,miterLimit:l,hasSizeVV:u}=a,d=_(.5*o);i.halfWidth=d,i.capType=qe(s),i.joinType=Je(c),i.miterLimit=l;let f=!u;r.out=e,r.id=t.getDisplayId(),r.vertexCount=0,r.indexCount=0,r.vertexFrom=e.vertexCount(),r.vertexBounds=f&&d<1.05?0:1;for(let{line:e,start:t,pathLength:a}of n)i.initialDistance=t%nn,r.pathLength=a,r.distanceOffset=Math.floor(t/nn)*nn,this._lineTessellator.tessellate(e,i,f)}_writeTesselatedVertex(e,t,n,r,i,a,o,s,c,l,u){let{out:d,id:f,vertexBounds:p,pathLength:m,distanceOffset:h}=this._currentWrite;return this.hasEffects&&d.recordBounds(e,t,p,p),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=s,this._tessParams.normalX=c,this._tessParams.normalY=l,this._tessParams.directionX=i,this._tessParams.directionY=a,this._tessParams.distance=u,this._tessParams.pathLength=m,this._tessParams.distanceOffset=h,this._writeVertex(d,f,e,t,this._tessParams),this._currentWrite.vertexFrom+ this._currentWrite.vertexCount++}_writeTriangle(e,t,n){let{out:r}=this._currentWrite;r.indexEnsureSize(3),r.indexWrite(e),r.indexWrite(t),r.indexWrite(n),this._currentWrite.indexCount+=3}},an=100,on=b(`featurelayer-fast-triangulation-enabled`),sn=class extends R{async loadDependencies(){await Promise.all([super.loadDependencies(),ge()])}_write(e,t,n){let r=n?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(r);i&&(e.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(e,t,i.justXY()),e.recordEnd())}_clip(e){if(!e)return null;let t=this.hasEffects;return Qt(e,t?256:8)}_writeGeometry(e,t,n){let r=(n=n.justXY()).maxLength>an,i=[],a=this.createTesselationParams(t);if(!r&&on&&Yt(i,n))return void(i.length&&this._writeVertices(e,t,n.coords,a,i));let o=Xt(n);this._writeVertices(e,t,o,a)}_writeVertices(e,t,n,r,i){let a=t.getDisplayId(),o=e.vertexCount(),s=this.hasEffects,c=0;if(i)for(let t of i){let i=n[2*t],o=n[2*t+1];s&&e.recordBounds(i,o,0,0),this._writeVertex(e,a,i,o,r),c++}else for(let t=0;t<n.length;t+=2){let i=Math.round(n[t]),o=Math.round(n[t+1]);s&&e.recordBounds(i,o,0,0),this._writeVertex(e,a,i,o,r),c++}e.indexEnsureSize(c);for(let t=0;t<c;t++)e.indexWrite(t+o)}},cn={createComputedParams:e=>e,optionalAttributes:{},attributes:{id:{type:c.UNSIGNED_BYTE,count:3,pack:`id`},bitset:{type:c.UNSIGNED_BYTE,count:1},pos:{type:c.SHORT,count:2,pack:`position`,packPrecisionFactor:10},inverseArea:{type:c.FLOAT,count:1,packTessellation:({inverseArea:e})=>e}}},ln=class extends sn{constructor(){super(...arguments),this.vertexSpec=cn}createTesselationParams(e){return{inverseArea:1/e.readGeometryArea()}}},Y={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:c.SHORT,count:2,packPrecisionFactor:10,pack:({scaleInfo:e},{tileInfo:t})=>N(e,t)}},attributes:{id:{type:c.UNSIGNED_BYTE,count:3,pack:`id`},bitset:{type:c.UNSIGNED_BYTE,count:1},pos:{type:c.SHORT,count:2,pack:`position`,packPrecisionFactor:10},color:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>I(e)}}},un=class extends sn{constructor(){super(...arguments),this.vertexSpec=Y}createTesselationParams(e){return null}},X={createComputedParams:e=>e,optionalAttributes:Y.optionalAttributes,attributes:{...Y.attributes,tlbr:{count:4,type:c.UNSIGNED_SHORT,pack:({sprite:e})=>{let{rect:t,width:n,height:r}=e,i=t.x+4,a=t.y+4;return[i,a,i+n,a+r]}},inverseRasterizationScale:{count:1,type:c.BYTE,packPrecisionFactor:16,pack:({sprite:e})=>1/e.rasterizationScale}}},dn=class extends un{constructor(){super(...arguments),this.vertexSpec=X}_write(e,t,n){let r=n?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(r);if(!i)return;let a=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,a),this._writeGeometry(e,t,i),e.recordEnd()}};function fn(e){let{sprite:t,aspectRatio:n,scaleProportionally:r}=e,i=_(e.height),a=i>0?i:t.height,o=i*n;return o<=0?o=t.width:r&&(o*=t.width/t.height),{width:o,height:a}}function pn(e){let{applyRandomOffset:t,sampleAlphaOnly:n}=e;return F([[2,t],[4,n]])}var mn={createComputedParams:e=>e,optionalAttributes:X.optionalAttributes,attributes:{...X.attributes,bitset:{count:1,type:c.UNSIGNED_BYTE,pack:pn},width:{count:1,type:c.HALF_FLOAT,pack:e=>fn(e).width},height:{count:1,type:c.HALF_FLOAT,pack:e=>fn(e).height},offset:{count:2,type:c.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[_(e),-_(t)]},scale:{count:2,type:c.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,scaleY:t})=>[e,t]},angle:{count:1,type:c.UNSIGNED_BYTE,pack:({angle:e})=>ie(e)}}},hn=class extends dn{constructor(){super(...arguments),this.vertexSpec=mn}},gn={createComputedParams:e=>e,optionalAttributes:J.optionalAttributes,attributes:{...J.attributes,bitset:{type:c.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>I(e)}}},_n={createComputedParams:e=>e,optionalAttributes:J.optionalAttributes,attributes:{...J.attributes,bitset:{type:c.UNSIGNED_BYTE,count:1,pack:e=>F([[0,!0],[1,e.outlineUsesColorVV]])},color:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>I(e)}}},vn=class extends rn{constructor(){super(...arguments),this.vertexSpec=_n}},yn=class extends un{constructor(e,t,n,r){super(e,t,n,r),this.vertexSpec=gn,this._lineMeshWriter=this._createOutlineWriter(e,t,n,r)}_createOutlineWriter(e,t,n,r){return new vn(e,t,n,r)}_write(e,t){let n=this.evaluatedMeshParams.effects,r=this.evaluatedMeshParams.outlineEffects;if(n?.length||r?.length){if(n?.length){let r=this.getEffectCursor(e,t,n);if(r){let n;for(;n=r?.next();)n.invertY(),this._writeFill(e,t,n)}}else this._writeFill(e,t);if(r?.length){let n=this.getEffectCursor(e,t,r);if(n){let r;for(;r=n?.next();)r.invertY(),this._writeOutline(e,t,r)}}else this._writeOutline(e,t)}else this._writeSimpleOutlineFill(e,t)}_writeSimpleOutlineFill(e,t){let n=t.readGeometryForDisplay(),r=this._clip(n);r&&(this._writeGeometry(e,t,r),this._lineMeshWriter.writeLineVertices(e,w.fromOptimizedCIM(r,`esriGeometryPolyline`),t))}_writeFill(e,t,n){let r=n?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(r);i&&this._writeGeometry(e,t,i)}_writeOutline(e,t,n){let r=n?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(r);i&&this._lineMeshWriter.writeLineVertices(e,w.fromOptimizedCIM(i,`esriGeometryPolyline`),t)}_clip(e){return e?Qt(e,xe(this.evaluatedMeshParams)):null}get effectInfos(){return[...this._evaluator.inputMeshParams.effects?.effectInfos??[],...this._evaluator.inputMeshParams.outlineEffects?.effectInfos??[]]}write(e,t,n,r,i){this.ensurePacked(t,n,r),e.recordStart(this.instanceId,this.attributeLayout),this._write(e,n),e.recordEnd()}ensurePacked(e,t,n){super.ensurePacked(e,t,n),this._lineMeshWriter.ensurePacked(e,t,n)}enqueueRequest(e,t,n){super.enqueueRequest(e,t,n),this._lineMeshWriter.enqueueRequest(e,t,n)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}get hasEffects(){return!!this.evaluatedMeshParams.outlineEffects}},bn=mn,xn=_n,Sn={createComputedParams:e=>e,optionalAttributes:bn.optionalAttributes,attributes:{...bn.attributes,bitset:{type:c.UNSIGNED_BYTE,count:1,pack:e=>pn(e)},aux1:{count:1,type:c.HALF_FLOAT,pack:e=>fn(e).width},aux2:{count:1,type:c.HALF_FLOAT,pack:e=>fn(e).height},aux3:{count:2,type:c.HALF_FLOAT,pack:({offsetX:e,offsetY:t})=>[_(e),_(t)]},aux4:{count:2,type:c.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*16,t*16]}}},Cn={createComputedParams:e=>e,optionalAttributes:bn.optionalAttributes,attributes:{...bn.attributes,color:xn.attributes.color,bitset:{type:c.UNSIGNED_BYTE,count:1,pack:e=>F([[0,!0]])},aux1:{count:1,type:c.HALF_FLOAT,pack:e=>_(.5*e.width)},aux2:{count:1,type:c.HALF_FLOAT,pack:e=>_(.5*e.referenceWidth)},aux3:{count:2,type:c.HALF_FLOAT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e,t]},aux4:{count:2,type:c.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*16+128,t*16+128]}}},wn=class extends vn{constructor(){super(...arguments),this.vertexSpec=Cn}},Tn=class extends yn{constructor(){super(...arguments),this.vertexSpec=Sn}_createOutlineWriter(e,t,n,r){return new wn(e,t,n,r)}write(e,t,n,r,i){this.ensurePacked(t,n,r);let a=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,a),this._write(e,n),e.recordEnd()}ensurePacked(e,t,n){super.ensurePacked(e,t,n),this._lineMeshWriter.ensurePacked(e,t,n)}enqueueRequest(e,t,n){super.enqueueRequest(e,t,n),this._lineMeshWriter.enqueueRequest(e,t,n)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}},En=()=>S.getLogger(`esri.views.2d.engine.webgl.shaderGraph.techniques.fill.GradientSizeHelper`),Dn=class{constructor(e,t){this._size=e,this._sizeUnits=t,this._relativeSize=null}get relativeSize(){return this._relativeSize??=this.calculateRelativeSize(),this._relativeSize}calculateRelativeSize(){if(this._sizeUnits===v.Relative){let e=Math.min(this._size/100,1);return[e,e]}return this.calculateRelativeSizeFromAbsolute()}},On=class extends Dn{constructor(e,t,n,r){super(t,n),this.rotationMatrix00=1,this.rotationMatrix01=0,this.rotationMatrix10=0,this.rotationMatrix11=1,this.bounds={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0},this.rotationMatrix00=Math.cos(r),this.rotationMatrix01=-Math.sin(r),this.rotationMatrix10=-this.rotationMatrix01,this.rotationMatrix11=this.rotationMatrix00;let{bounds:i,rotationMatrix00:a,rotationMatrix01:o,rotationMatrix10:s,rotationMatrix11:c}=this;e.forEachVertex((e,t)=>{let n=e*a+t*o,r=e*s+t*c;i.xmin=Math.min(i.xmin,n),i.ymin=Math.min(i.ymin,r),i.xmax=Math.max(i.xmax,n),i.ymax=Math.max(i.ymax,r)}),this.center=[(i.xmin+i.xmax)/2,(i.ymin+i.ymax)/2]}},kn=class extends On{constructor(e,t,n,r){super(e,t,n,r),this.method=`linear`}getRelativePosition(e,t){let{rotationMatrix00:n,rotationMatrix01:r,bounds:i}=this,{xmin:a,xmax:o}=i;return[(e*n+t*r-a)/(o-a),0]}calculateRelativeSizeFromAbsolute(){let{_size:e,bounds:t}=this,{xmin:n,xmax:r}=t;return[_(e)/(r-n),0]}},An=class extends On{constructor(e,t,n,r){super(e,t,n,r),this.method=`rectangular`}getRelativePosition(e,t){let{bounds:n,center:r,rotationMatrix00:i,rotationMatrix01:a,rotationMatrix10:o,rotationMatrix11:s}=this,c=e*o+t*s,l=e*i+t*a-r[0],u=c-r[1];return[l*(2/(n.xmax-n.xmin)),-u*(2/(n.ymax-n.ymin))]}calculateRelativeSizeFromAbsolute(){let{_size:e,bounds:t}=this,{xmin:n,ymin:r,xmax:i,ymax:a}=t;return[_(2*e)/(i-n),_(2*e)/(a-r)]}},jn=class extends On{constructor(e,t,n){super(e,t,n,0),this.method=`circular`;let{xmin:r,xmax:i,ymin:a,ymax:o}=this.bounds,s=i-r,c=o-a;this.radius=Math.sqrt(s*s+c*c)/2}getRelativePosition(e,t){let{center:n,radius:r}=this;return[(e-n[0])/r,-((t-n[1])/r)]}calculateRelativeSizeFromAbsolute(){let{_size:e}=this;return[_(e)/this.radius,0]}};function Mn(e,t){if(e==null)return null;let n=g(t.angle),r=t.gradientSize,i=t.gradientSizeUnits;switch(t.gradientMethod.toLowerCase()){case`linear`:return new kn(e,r,i,n);case`rectangular`:return new An(e,r,i,n);case`circular`:return new jn(e,r,i);default:return En().errorOnce(`Gradient fill method "${t.gradientMethod}" currently unsupported.`),null}}var Nn={createComputedParams:e=>e,optionalAttributes:Y.optionalAttributes,attributes:{...Y.attributes,bitset:{type:c.UNSIGNED_BYTE,count:1,pack:({gradientSizeUnits:e,gradientType:t})=>{let n=0;return e===v.Absolute&&(n|=P(we.isAbsolute)),t.toLowerCase()===`discrete`&&(n|=P(we.isDiscrete)),n}},tlbr:{count:4,type:c.UNSIGNED_SHORT,pack:({sprite:e})=>{let{rect:t,width:n,height:r}=e,i=t.x+4+1,a=t.y+4;return[i,a,i+n-2,a+r]}},relativePosition:{count:2,type:c.HALF_FLOAT,packTessellation:({gradientStats:e},t,n,r)=>e?.getRelativePosition(n,r)??[0,0]},relativeGradientSize:{count:2,type:c.HALF_FLOAT,packTessellation:({gradientStats:e})=>e?.relativeSize??[1,1]},gradientMethod:{count:1,type:c.UNSIGNED_BYTE,pack:({gradientMethod:e})=>{switch(e.toLowerCase()){case`rectangular`:return Se.rectangular;case`circular`:return Se.circular;default:return Se.linear}}}}},Pn=class extends sn{constructor(){super(...arguments),this.vertexSpec=Nn}get _preventEffectClipping(){return!0}createTesselationParams(e){return{gradientStats:Mn(this._unclippedGeometry,this.evaluatedMeshParams)}}_write(e,t,n){let r=n?.asOptimized()??t.readGeometryForDisplay();this._unclippedGeometry=r;let i=this._clip(r);if(!i)return void(this._unclippedGeometry=null);let a=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,a),this._writeGeometry(e,t,i),this._unclippedGeometry=null,e.recordEnd()}},Fn={optionalAttributes:X.optionalAttributes,createComputedParams:e=>e,attributes:{...X.attributes,...gn.attributes}},In={optionalAttributes:X.optionalAttributes,createComputedParams:e=>e,attributes:{...X.attributes,..._n.attributes}},Ln=class extends vn{constructor(){super(...arguments),this.vertexSpec=In}},Rn=class extends yn{constructor(){super(...arguments),this.vertexSpec=Fn}_createOutlineWriter(e,t,n,r){return new Ln(e,t,n,r)}write(e,t,n,r,i){this.ensurePacked(t,n,r);let a=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,a),this._write(e,n),e.recordEnd()}ensurePacked(e,t,n){super.ensurePacked(e,t,n),this._lineMeshWriter.ensurePacked(e,t,n)}enqueueRequest(e,t,n){super.enqueueRequest(e,t,n),this._lineMeshWriter.enqueueRequest(e,t,n)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}},zn={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:c.SHORT,count:2,pack:`position`,packPrecisionFactor:10},id:{type:c.UNSIGNED_BYTE,count:3,pack:`id`},bitset:{type:c.UNSIGNED_BYTE,count:1},offset:{type:c.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}},Bn=class extends R{constructor(){super(...arguments),this.vertexSpec=zn}_write(e,t){e.recordStart(this.instanceId,this.attributeLayout);let n=t.getDisplayId();if(t.geometryType===`esriGeometryPoint`){let r=t.readXForDisplay(),i=t.readYForDisplay();this._writeQuad(e,n,r,i)}else t.geometryType===`esriGeometryMultipoint`&&t.readGeometryForDisplay()?.forEachVertex((t,r)=>{t>=0&&t<=512&&r>=0&&r<=512&&this._writeQuad(e,n,t,r)});e.recordEnd()}_writeQuad(e,t,n,r){let i=e.vertexCount();this._writeVertex(e,t,n,r),e.indexWrite(i+0),e.indexWrite(i+1),e.indexWrite(i+2),e.indexWrite(i+1),e.indexWrite(i+3),e.indexWrite(i+2)}},Vn=class{static getPlacement(e,t,n,r,i){let a=oe(n);return a?(t===-1&&e.invertY(),a.execute(e,n,r,i)):null}},Hn=96,Un=class{constructor(e){let{offsetX:t,offsetY:n,postAngle:r,fontSize:i,haloSize:a,outlineSize:o,scaleFactor:s,transforms:c}=e;if(this.offsetX=t,this.offsetY=n,this.postAngle=r,this.fontSize=Math.min(i,Hn),this.haloSize=a??0,this.outlineSize=o??0,this.transforms=c,c&&c.infos.length>1){let e=ee(i,r,!1,t,n,c,!1);this.fontSize=Math.min(e.size,Hn);let a=e.size/i;this.haloSize*=a,this.outlineSize*=a,this.postAngle=e.rotation,this.offsetX=e.offsetX,this.offsetY=e.offsetY}s&&(this.fontSize*=s,this.offsetX*=s,this.offsetY*=s)}},Wn=28,Z=[4,4],Gn=[16,4],Kn={topLeft:Gn,topRight:Gn,bottomLeft:Gn,bottomRight:Gn},Q=[4,2],$=[4,6],qn={topLeft:Q,topRight:Q,bottomLeft:$,bottomRight:$},Jn={topLeft:Q,topRight:$,bottomLeft:Q,bottomRight:$},Yn={topLeft:$,topRight:$,bottomLeft:Z,bottomRight:Z},Xn={topLeft:Z,topRight:Z,bottomLeft:$,bottomRight:$},Zn={topLeft:$,topRight:Z,bottomLeft:$,bottomRight:Z},Qn={topLeft:Z,topRight:$,bottomLeft:Z,bottomRight:$},$n={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:c.UNSIGNED_SHORT,count:2,packPrecisionFactor:10,packTessellation:({minZoom:e,maxZoom:t})=>[e||0,t||28]},clipAngle:{type:c.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:e})=>tr(e||0)},referenceSymbol:{type:c.BYTE,count:4,packPrecisionFactor:1,packTessellation:(e,t)=>{let n=e.isLineLabel||!e.referenceBounds,r=le(n?`center`:t.horizontalAlignment),i=ce(n?`middle`:t.verticalAlignment),{offsetX:a,offsetY:o,size:s}=n?{offsetX:0,offsetY:0,size:0}:e.referenceBounds;return[_(a),-_(o),Math.round(_(s)),r+1<<2|i+1]}},visibility:{type:c.FLOAT,count:1,otherSource:!0}},attributes:{pos:{type:c.SHORT,count:2,pack:`position`,packPrecisionFactor:10},id:{type:c.UNSIGNED_BYTE,count:3,pack:`id`},bitset:{type:c.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:e,mapAligned:t})=>F([[0,e],[3,!!t]])},offset:{type:c.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:e})=>{let{bottomLeft:t,bottomRight:n,topLeft:r,topRight:i}=e;return[r,i,t,n]}}},textureUV:{type:c.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:e})=>{let{bottomLeft:t,bottomRight:n,topLeft:r,topRight:i}=e;return[r,i,t,n]}}},color:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:e})=>e},fontAndReferenceSize:{type:c.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({fontSize:e},{referenceSize:t})=>[Math.round(_(e)),Math.round(_(t??e))]},outlineColor:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>I(e)},haloColor:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:e})=>I(e)},outlineAndHaloSize:{type:c.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:e,haloSize:t})=>[Math.round(_(e)),Math.round(_(t))]}}},er=class extends R{constructor(){super(...arguments),this.vertexSpec=$n,this._textMeshParamsPropsInitialized=!1}ensurePacked(e,t,n){super.ensurePacked(e,t,n),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new Un(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(e,t,n){let r=this._getShaping();if(!r)return;let i=t.getDisplayId();if(this.evaluatedMeshParams.placement!=null)return this._writePlacedTextMarkers(e,t,r,n);if(n?.nextPath())return n.nextPoint(),this._writeGlyphs(e,i,n.x,n.y,r,0);if(t.geometryType===`esriGeometryPolygon`){let n=t.readCentroidForDisplay();if(!n)return;let[a,o]=n.coords;return this._writeGlyphs(e,i,a,o,r,0)}if(t.geometryType===`esriGeometryMultipoint`){t.readGeometryForDisplay()?.forEachVertex((t,n)=>this._writeGlyphs(e,i,t,n,r,0));return}let a=t.readXForDisplay(),o=t.readYForDisplay();return this._writeGlyphs(e,i,a,o,r,0)}_writePlacedTextMarkers(e,t,n,r){let i=r??w.fromFeatureSetReaderCIM(t);if(!i)return;let a=Vn.getPlacement(i,-1,this.evaluatedMeshParams.placement,_(1),e.id);if(!a)return;let o=t.getDisplayId(),s=a.next();for(;s!=null;){let t=s.tx,r=-s.ty,i=-s.getAngle();this._writeGlyphs(e,o,t,r,n,i),s=a.next()}}_getShaping(e){let t=this._textMeshTransformProps,n=this.evaluatedMeshParams;if(!n.glyphs?.glyphs.length)return null;let r=_(t.fontSize),i=_(t.offsetX),a=_(t.offsetY),o=p(_(n.lineWidth),32,512),s=29*p(n.lineHeightRatio,.25,4);return de(n.glyphs,{scale:r/24,angle:t.postAngle,xOffset:i,yOffset:a,horizontalAlignment:n.horizontalAlignment,verticalAlignment:e||n.verticalAlignment,maxLineWidth:o,lineHeight:s,decoration:n.decoration,borderLineSizePx:_(n.boxBorderLineSize),hasBackground:!!n.boxBackgroundColor,useCIMAngleBehavior:n.useCIMAngleBehavior})}_writeGlyphs(e,t,n,r,i,a,o,s,c=!0){let l=this.evaluatedMeshParams,u=this._textMeshTransformProps,d=_(u.fontSize),f=u.haloSize,p=u.outlineSize,m=_(u.offsetX),h=_(u.offsetY),[g,v]=N(l.scaleInfo,this.getTileInfo());a!==0&&i.setRotation(a);let y=i.bounds,b=n+y.x+m,x=r+y.y-h,ee=2*(l.minPixelBuffer?l.minPixelBuffer/d:1),S=Math.max(y.width,y.height)*ee;i.textBox&&(e.recordStart(this.instanceId,this.attributeLayout,i.glyphs[0].textureBinding),c&&e.recordBounds(b,x,S,S),this._writeTextBox(e,t,n,r,i.textBox,o,s),e.recordEnd());for(let a of i.glyphs){e.recordStart(this.instanceId,this.attributeLayout,a.textureBinding),c&&e.recordBounds(b,x,S,S);let{texcoords:i,offsets:u}=a;this._writeQuad(e,t,n,r,{texcoords:i,offsets:u,fontSize:d,haloSize:f,outlineSize:p,color:I(l.color),isBackground:!1,referenceBounds:o,minZoom:g,maxZoom:v,...s}),e.recordEnd()}a!==0&&i.setRotation(-a)}_writeTextBox(e,t,n,r,i,a,o){let s=this.evaluatedMeshParams,{fontSize:c,haloSize:l,outlineSize:u}=this._textMeshTransformProps,{boxBackgroundColor:d,boxBorderLineColor:f}=s,p={isBackground:!0,fontSize:c,haloSize:l,outlineSize:u,referenceBounds:a,...o};d&&(this._writeQuad(e,t,n,r,{texcoords:Kn,offsets:i.main,color:I(d),...p}),f||(this._writeQuad(e,t,n,r,{texcoords:Yn,offsets:i.top,color:I(d),...p}),this._writeQuad(e,t,n,r,{texcoords:Xn,offsets:i.bot,color:I(d),...p}),this._writeQuad(e,t,n,r,{texcoords:Zn,offsets:i.left,color:I(d),...p}),this._writeQuad(e,t,n,r,{texcoords:Qn,offsets:i.right,color:I(d),...p}))),f&&(this._writeQuad(e,t,n,r,{texcoords:qn,offsets:i.top,color:I(f),...p}),this._writeQuad(e,t,n,r,{texcoords:qn,offsets:i.bot,color:I(f),...p}),this._writeQuad(e,t,n,r,{texcoords:Jn,offsets:i.left,color:I(f),...p}),this._writeQuad(e,t,n,r,{texcoords:Jn,offsets:i.right,color:I(f),...p}))}_writeQuad(e,t,n,r,i){let a=e.vertexCount();this._writeVertex(e,t,n,r,i),e.indexWrite(a+0),e.indexWrite(a+1),e.indexWrite(a+2),e.indexWrite(a+1),e.indexWrite(a+3),e.indexWrite(a+2)}},tr=e=>Math.round(e*(254/360)),nr={createComputedParams:e=>e,optionalAttributes:J.optionalAttributes,attributes:{...J.attributes,bitset:{type:c.UNSIGNED_BYTE,count:1,pack:({gradientMethod:e,gradientSizeUnits:t,gradientType:n})=>F([[Ce.isAlongLine,e.toLowerCase()===`alongline`],[Ce.isAbsoluteSize,t===v.Absolute],[Ce.isDiscrete,n.toLowerCase()===`discrete`]])},tlbr:{type:c.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{let{rect:t,width:n,height:r}=e,i=t.x+4+1,a=t.y+4;return[i,a,i+n-2,a+r]}},accumulatedDistance:{type:c.HALF_FLOAT,count:1,packTessellation:({distance:e,pathLength:t,distanceOffset:n})=>(n+e)/t},gradientSize:{type:c.HALF_FLOAT,count:1,pack:({gradientSize:e,gradientSizeUnits:t})=>t===v.Relative?e/100:_(e)},totalLength:{type:c.HALF_FLOAT,count:1,packTessellation:({pathLength:e})=>e},segmentDirection:{type:c.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]}}},rr=class extends rn{get _preventEffectClipping(){return!0}constructor(e,t,n,r){super(e,t,n,r),this.vertexSpec=nr,this._tessellationOptions.textured=!0}_write(e,t,n){let r=n??w.fromFeatureSetReaderCIM(t);if(!r)return;let{sprite:i}=this.evaluatedMeshParams;this._writeGeometry(e,t,r,i?.textureBinding)}},ir={createComputedParams:e=>e,optionalAttributes:J.optionalAttributes,attributes:{...J.attributes,bitset:{type:c.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:e,shouldScaleDash:t,isSDF:n})=>F([[4,e],[2,t],[3,n]])},tlbr:{type:c.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{let{rect:t,width:n,height:r}=e,i=t.x+4,a=t.y+4;return[i,a,i+n,a+r]}},accumulatedDistance:{type:c.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},segmentDirection:{type:c.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},offsetAlongLine:{type:c.HALF_FLOAT,count:1,pack:({offsetAlongLine:e})=>_(e)},capType:{type:c.UNSIGNED_BYTE,count:1,pack:({capType:e})=>{switch(e){case`Butt`:case`butt`:default:return 0;case`Square`:case`square`:return 1;case`Round`:case`round`:return 2}}}}},ar=class extends rn{constructor(e,t,n,r){super(e,t,n,r),this.vertexSpec=ir,this._tessellationOptions.textured=!0}_write(e,t,n){let r=n??w.fromFeatureSetReaderCIM(t);if(!r)return;let{sprite:i}=this.evaluatedMeshParams;this._writeGeometry(e,t,r,i?.textureBinding)}},or=class e{static from(e){return`width`in e?this.fromSimpleMeshParams(e):this.fromComplexMeshParams(e)}static fromSimpleMeshParams(t){let n=new e(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:r,width:i,height:a,angle:o,alignment:s,outlineSize:c,referenceSize:l,sprite:u,overrideOutlineColor:d}=t;return n.rawWidth=_(i),n.rawHeight=_(a),n.angle=o,n.alignment=s,n.outlineSize=_(c),n.referenceSize=_(l),n.overrideOutlineColor=d,n.offsetX=_(t.offsetX),n.offsetY=_(t.offsetY),r!==`simple`||u.sdf||(n.rawWidth=u.width,n.rawHeight=u.height),n._computeSize(t,!1),n}static fromComplexMeshParams(t){let n=new e(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{alignment:r,transforms:i,size:a,scaleX:o,anchorX:s,anchorY:c,angle:l,colorLocked:u,frameHeight:d,widthRatio:f,offsetX:p,offsetY:m,outlineSize:h,referenceSize:g,scaleFactor:v,sizeRatio:y,isAbsoluteAnchorPoint:b,rotateClockwise:x,scaleSymbolsProportionally:S,sprite:C}=t;if(i&&i.infos.length>0){let e=ee(a,l,x,p,m,i);a=e.size,l=e.rotation,p=e.offsetX,m=e.offsetY,x=!1}v&&(a*=v,p*=v,m*=v);let te=o*(C.width/C.height);n.alignment=r,n.rawHeight=_(a),n.rawWidth=n.rawHeight*te,n.referenceSize=_(g),n.sizeRatio=y,n.sdfDecodeCoeff=(C.sdfDecodeCoeff??1)*y,n.angle=l,n.rotateClockwise=x,n.anchorX=s,n.anchorY=c,n.offsetX=_(p),n.offsetY=_(m),b&&a&&(C.sdf?n.anchorX=s/(a*f):n.anchorX=s/(a*te),n.anchorY=c/a);let ne=S&&d?a/d:1;return n.outlineSize=h===0||isNaN(h)?0:_(h)*ne,n.scaleSymbolsProportionally=S,n.colorLocked=u,n._computeSize(t,!0),n}constructor(e,t,n,r,i,a,o){this.sprite=e,this.color=t,this.outlineColor=n,this.minPixelBuffer=r,this.placement=i,this.scaleInfo=a,this.effects=o,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.sdfDecodeCoeff=1,this.alignment=0,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(e,t){let{sprite:n,hasSizeVV:r}=e,i=!!n.sdf,a=n.sdfPaddingRatio??.5,{rawWidth:o,rawHeight:s,sizeRatio:c,outlineSize:l}=this,u=n.rect,d=o*c,f=s*c,p=0,m=0;if(i){let e=1/(1-a);if(d*=e,f*=e,r)this.computedWidth=d,this.computedHeight=f;else{let e=t&&o>s?d:o,r=s,i=l+2;this.computedWidth=Math.min(e+i,d),this.computedHeight=Math.min(r+i,f);let a=Math.max(n.width,n.height)/Math.max(d,f);p=(this.computedWidth-d)*a,m=(this.computedHeight-f)*a}}else this.computedWidth=d*(u.width/n.width),this.computedHeight=f*(u.height/n.height),p=8,m=8;let h=u.x+4-p/2,g=u.y+4-m/2,_=h+n.width+p,v=g+n.height+m;this.texXmin=sr(h),this.texYmin=sr(g),this.texXmax=cr(_),this.texYmax=cr(v),this.computedWidth*=(this.texXmax-this.texXmin)/(_-h),this.computedHeight*=(this.texYmax-this.texYmin)/(v-g),this.anchorX*=d/this.computedWidth,this.anchorY*=f/this.computedHeight}};function sr(e,t=1e-7){let n=Math.ceil(e);return n-e<t?n:Math.floor(e)}function cr(e,t=1e-7){let n=Math.floor(e);return e-n<t?n:Math.ceil(e)}var lr=3.14159265359/180,ur=128/Math.PI;function dr(e,t){return e%=t,Math.abs(e>=0?e:e+t)}function fr(e){return dr(e*ur,256)}function pr(t,n,r,i,o=!1){let s=e(),c=o?1:-1;return te(s),(n||r)&&a(s,s,[n,-r]),i&&l(s,s,c*lr*-i),s}var mr={createComputedParams:e=>or.from(e),optionalAttributes:{zoomRange:{type:c.SHORT,count:2,packPrecisionFactor:10,pack:({scaleInfo:e},{tileInfo:t})=>N(e,t)}},attributes:{pos:{type:c.SHORT,count:2,pack:`position`,packPrecisionFactor:10},id:{type:c.UNSIGNED_BYTE,count:3,pack:`id`},bitset:{type:c.UNSIGNED_BYTE,count:1,pack:({sprite:e,alignment:t,scaleSymbolsProportionally:n,overrideOutlineColor:r,colorLocked:i})=>{let a=0;return e.sdf&&(a|=P(T.bitset.isSDF)),t===1&&(a|=P(T.bitset.isMapAligned)),n&&(a|=P(T.bitset.scaleSymbolsProportionally)),r&&(a|=P(T.bitset.overrideOutlineColor)),i&&(a|=P(T.bitset.colorLocked)),a}},offset:{type:c.HALF_FLOAT,count:2,packAlternating:{count:4,pack:({angle:e,computedWidth:t,computedHeight:n,anchorX:r,anchorY:i,offsetX:a,offsetY:o,rotateClockwise:s})=>{let c=pr(0,a,o,-e,s),l=-(.5+r)*t,u=-(.5-i)*n,d=[l,u],f=[l+t,u],p=[l,u+n],h=[l+t,u+n];return m(d,d,c),m(f,f,c),m(p,p,c),m(h,h,c),[d,f,p,h]}}},textureUV:{type:c.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:e,texXmin:t,texYmax:n,texYmin:r})=>[[t,r],[e,r],[t,n],[e,n]]}},color:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>I(e)},outlineColor:{type:c.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>I(e)},sizing:{type:c.UNSIGNED_BYTE,count:4,pack:({rawWidth:e,rawHeight:t,outlineSize:n,referenceSize:r})=>[Ye(Math.max(e,t),128),Ye(n,128),Ye(r,128),0]},placementAngle:{type:c.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:e})=>fr(e)},sdfDecodeCoeff:{type:c.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:e})=>e}}},hr=class extends R{constructor(){super(...arguments),this.vertexSpec=mr}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(e,t,n){let r=this.evaluatedMeshParams.sprite?.textureBinding,i=t.getDisplayId();e.recordStart(this.instanceId,this.attributeLayout,r);let a=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(this.evaluatedMeshParams.computedWidth,a),s=Math.max(this.evaluatedMeshParams.computedHeight,a),c=-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,l=this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight,u=this.evaluatedMeshParams.offsetX+c,d=-this.evaluatedMeshParams.offsetY+l;if(this.evaluatedMeshParams.placement!=null){let r=null;if(n!=null){let e=Math.max(this.evaluatedMeshParams.computedWidth,this.evaluatedMeshParams.computedHeight);if(r=ae(n,2*e,!1),r===null)return}this._writePlacedMarkers(e,t,r,o,s)}else if(n?.nextPath()){n.nextPoint();let t=n.x,r=n.y;e.recordBounds(t+u,r+d,o,s),this._writeQuad(e,i,t,r)}else if(t.geometryType===`esriGeometryPolygon`){let n=t.readCentroidForDisplay();if(!n)return;let[r,a]=n.coords;e.recordBounds(r+u,a+d,o,s),this._writeQuad(e,i,r,a)}else if(t.geometryType===`esriGeometryPoint`){let n=t.readXForDisplay(),r=t.readYForDisplay();e.recordBounds(n+u,r+d,o,s),this._writeQuad(e,i,n,r)}else t.readGeometryForDisplay()?.forEachVertex((t,n)=>{e.recordBounds(t+u,n+d,o,s),Math.abs(t)>1024||Math.abs(n)>1024||this._writeQuad(e,i,t,n)});e.recordEnd()}_writePlacedMarkers(e,t,n,r,i){let a=n??w.fromFeatureSetReaderCIM(t);if(!a)return;let o=Vn.getPlacement(a,-1,this.evaluatedMeshParams.placement,_(1),e.id);if(!o)return;let s=t.getDisplayId(),c=o.next(),l=this.evaluatedMeshParams.offsetX,u=-this.evaluatedMeshParams.offsetY;for(;c!=null;){let t=c.tx,n=-c.ty;if(Math.abs(t)>1024||Math.abs(n)>1024){c=o.next();continue}let a=-c.getAngle();e.recordBounds(t+l,n+u,r,i),this._writeQuad(e,s,t,n,a),c=o.next()}}_writeQuad(e,t,n,r,i){let a=e.vertexCount(),o=i==null?null:{placementAngle:i};this._writeVertex(e,t,n,r,o),e.indexWrite(a+0),e.indexWrite(a+1),e.indexWrite(a+2),e.indexWrite(a+1),e.indexWrite(a+3),e.indexWrite(a+2)}},gr={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:c.SHORT,count:2,packPrecisionFactor:10,pack:`position`},id:{type:c.UNSIGNED_BYTE,count:3,pack:`id`},bitset:{type:c.UNSIGNED_BYTE,count:1,pack:e=>0},offset:{type:c.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:e})=>{let t=_(e),n=-t/2,r=-t/2;return[[n,r],[n+t,r],[n,r+t],[n+t,r+t]]}}},texCoords:{type:c.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:c.UNSIGNED_BYTE,count:2,pack:({size:e})=>[e,e]},referenceSize:{type:c.UNSIGNED_BYTE,count:1,pack:({size:e})=>_(e)},zoomRange:{type:c.UNSIGNED_BYTE,count:2,pack:({scaleInfo:e},{tileInfo:t})=>N(e,t)}}},_r=class extends R{constructor(){super(...arguments),this.vertexSpec=gr}_write(e,t){let n=t.getDisplayId(),r=this.evaluatedMeshParams.minPixelBuffer,i=Math.max(_(this.evaluatedMeshParams.size),r),a,o;if(t.geometryType===`esriGeometryPoint`)a=t.readXForDisplay(),o=t.readYForDisplay();else{let e=t.readCentroidForDisplay();if(!e)return;a=e?.coords[0],o=e?.coords[1]}e.recordStart(this.instanceId,this.attributeLayout),e.recordBounds(a,o,i,i);let s=e.vertexCount();this._writeVertex(e,n,a,o),e.indexWrite(s+0),e.indexWrite(s+1),e.indexWrite(s+2),e.indexWrite(s+1),e.indexWrite(s+3),e.indexWrite(s+2),e.recordEnd()}};export{Ie as $,lt as A,Ze as B,bt as C,it as D,dt as E,at as F,He as G,qe as H,ut as I,A as J,Ue as K,yt as L,ft as M,ot as N,vt as O,st as P,Fe as Q,pt as R,mt as S,_t as T,Je as U,I as V,N as W,Be as X,Ve as Y,D as Z,rn as _,er as a,Yt as b,Bn as c,Tn as d,yn as f,ln as g,un as h,rr as i,ct as j,ht as k,Rn as l,dn as m,hr as n,Wn as o,hn as p,j as q,ar as r,Vn as s,_r as t,Pn as u,en as v,gt as w,$t as x,Qt as y,nt as z};