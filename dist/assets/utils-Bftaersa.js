import{$p as e,B_ as t,Ep as n,G_ as r,H_ as i,L_ as a,R_ as o,Rp as s,U_ as c,V_ as l,Yp as u,Z_ as d}from"./index-BN8X5Ryz.js";var f=`,`,p={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},m=new Set([`integer`,`small-integer`]),h=null;function g(e){return n(e)||s(e)||u(e)}async function _(t){let{field:n,field2:r,field3:i,normalizationField:a,valueExpression:o,fields:s}=t,c=[];if(o){if(!h){let{arcadeUtils:t}=await e();h=t}c=h.extractFieldNames(o)}return n&&c.push(n),r&&c.push(r),i&&c.push(i),a&&c.push(a),s&&c.push(...s),c}function v(e){return String(e).padStart(2,`0`)}function y(e,t,n){let r;return t===`date`||t===`number`?(t===`number`&&(e=new Date(e)),r=`TIMESTAMP'${n?e.getFullYear():e.getUTCFullYear()}-${v((n?e.getMonth():e.getUTCMonth())+1)}-${v(n?e.getDate():e.getUTCDate())} ${v(n?e.getHours():e.getUTCHours())}:${v(n?e.getMinutes():e.getUTCMinutes())}:${v(n?e.getSeconds():e.getUTCSeconds())}'`):r=e,r}function b(e,t,n,r){let{hasQueryEngine:i}=e,a=`(${y(n,x(e,n),i)} - ${y(t,x(e,t),i)})`,o=p[r],s=`/`;return o<1&&(o=1/o,s=`*`),{sqlExpression:o===1?a:`(${a} ${s} ${o})`,sqlWhere:null}}function x(e,t){if(t instanceof Date)return`date`;if(typeof t==`number`)return`number`;if(typeof t==`string`){let r=e.getField(t);if(t.toLowerCase()===`<now>`)return;if(n(r))return`field`}}function S(e,t){let n=t&&e.getField(t);return!!n&&m.has(n.type)}function C(e){return`cast(${e} as float)`}function w(e,n){let{format:s,fieldFormat:u,timeZoneOptions:d,fieldType:f}=n??{},p=u?a(u):null,m,h;if(d&&({timeZone:m,timeZoneName:h}=r(d.layerTimeZone,d.datesInUnknownTimezone,d.viewTimeZone,p||o(s||`short-date-short-time`),f)),typeof e==`string`&&isNaN(Date.parse(f===`time-only`?`1970-01-01T${e}Z`:e)))return e;switch(f){case`date-only`:{let t=p||o(s||`short-date`);return typeof e==`string`?c(e,{...t}):i(e,{...t,timeZone:`UTC`})}case`time-only`:{let n=p||o(s||`short-time`);return typeof e==`string`?t(e,n):i(e,{...n,timeZone:`UTC`})}case`timestamp-offset`:{if(!m&&typeof e==`string`&&new Date(e).toISOString()!==e)return e;let t=s||p||d?p||o(s||`short-date-short-time`):void 0,n=t?{...t,timeZone:m,timeZoneName:h}:void 0;return typeof e==`string`?l(e,n):i(e,n)}default:{let t=s||p||d?p||o(s||`short-date-short-time`):void 0;return i(typeof e==`string`?new Date(e):e,t?{...t,timeZone:m,timeZoneName:h}:void 0)}}}export{f as a,g as i,S as n,_ as o,C as r,w as s,b as t};