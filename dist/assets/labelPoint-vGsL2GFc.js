import{Cv as e,Ev as t,Fv as n,Kv as r,SE as i,Sv as a,Tv as o,Xv as s,bv as c,ox as l,ry as u,tx as d,ty as f,xv as p,yv as m}from"./index-CZ4oMP1N.js";import{t as h}from"./OptimizedGeometry-hOUTi-cB.js";var g=class{static fromOptimized(e,t,n=1){return new _().initialize(e,t,n)}static fromJSON(e){let[t,n]=y(e),r=p(e),i=o(e);return new b().initialize(t,n,r,i,1)}static fromOptimizedCIM(e,t,n=1){return new C().initialize(e,t,n)}static fromJSONCIM(e,t=1){let[n,r]=y(e),i=p(e),a=o(e);return new w().initialize(n,r,i,a,t)}static fromFeatureSetReader(e){let t=e.readGeometryForDisplay(),n=e.geometryType;return t&&n?this.fromOptimized(t,n):null}static fromFeatureSetReaderCIM(e){let t=e.readGeometryForDisplay(),n=e.geometryType;return t&&n?this.fromOptimizedCIM(t,n):null}static createEmptyOptimized(e,t=!1,n=!1,r=1){return new C().initialize(new h([],[],t,n),e,r)}static createEmptyJSON(e,t=!1,n=!1){return new b().initialize([],e,t,n,1)}static createEmptyOptimizedCIM(e,t=!1,n=!1,r=1){return new C().initialize(new h([],[],t,n),e,r)}static createEmptyJSONCIM(e,t=!1,n=!1,r=1){return new w().initialize([],e,t,n,r)}asJSON(){let e=s(this),{hasZ:t,hasM:n}=this;return this.geometryType===`esriGeometryEnvelope`?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:this.geometryType===`esriGeometryMultipoint`?{points:e.flat(),hasZ:t,hasM:n}:this.geometryType===`esriGeometryPoint`?{x:e[0][0][0],y:e[0][0][1],z:t?e[0][0][2]:void 0,m:n?e[0][0][t?3:2]:void 0}:this.geometryType===`esriGeometryPolygon`?{rings:e,hasZ:t,hasM:n}:{paths:e,hasZ:t,hasM:n}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,n=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;let r=e,i=t;for(;this.nextPoint();)n+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return n+=(e-r)*(t+i),-.5*n}invertY(){this.yFactor*=-1}},_=class e extends g{constructor(){super(...arguments),this._end=-1}get hasZ(){return this._geometry?.hasZ}get hasM(){return this._geometry?.hasM}initialize(e,t,n){return this.geometryType=t,this._stride=e.stride,this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){let t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1)&&(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,!0)}prevPath(){return!(this.pathIndex<=0)&&(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,!0)}getCurrentPath(){let t=this._end,n=this._geometry.coords,r=this._pathOffset;return new e().initialize(new h([this.pathSize],n.slice(r,t),this.hasZ,this.hasM),this.geometryType,this.yFactor)}pathLength(){let e=this._end,t=this._stride,n=this._geometry.coords,r=0;for(let i=this._pathOffset+t;i<e;i+=t){let e=n[i-t],a=n[i-t+1],o=n[i]-e,s=n[i+1]-a;r+=Math.sqrt(o*o+s*s)}return r}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(let t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){let t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){let e=this._geometry.clone();if(this.yFactor!==1)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return this.geometryType===`esriGeometryPoint`&&(e.lengths.length=0),e}isClosed(){let e=this._geometry.coords,t=this._pathOffset,n=this._end-this._stride;for(let r=0;r<this._stride;r++)if(e[t+r]!==e[n+r])return!1;return!0}clone(){return new e().initialize(this._geometry.clone(),this.geometryType,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,t)=>e+t)}get pathSize(){let{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){let e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}};function v(e){let t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function y(n){return e(n)?[n.rings,`esriGeometryPolygon`]:m(n)?[n.paths,`esriGeometryPolyline`]:c(n)?[[n.points],`esriGeometryMultipoint`]:a(n)?[[[[n.xmin,n.ymin],[n.xmin,n.ymax],[n.xmax,n.ymax],[n.xmax,n.ymin],[n.xmin,n.ymin]]],`esriGeometryEnvelope`]:t(n)?[[[v(n)]],`esriGeometryPoint`]:[[],`esriGeometryPolyline`]}var b=class e extends g{initialize(e,t,n,r,i){return this._paths=e,this.geometryType=t,this.hasZ=n,this.hasM=r,this._pathIndex=this._pointIndex=-1,this.yFactor=i,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){let e=this._currentPath.length,t=this._currentPath,n=0;for(let r=1;r<e;r++){let e=t[r-1],i=t[r],a=e[0],o=e[1],s=i[0]-a,c=i[1]-o;n+=Math.sqrt(s*s+c*c)}return n}startPath(){this._paths.push([])}getCurrentPath(){return new e().initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){let t=s(e);for(let e of t)this.pushPath(e)}asOptimized(){let{hasZ:e,hasM:t}=this,n=new h([],[],e,t),{coords:r,lengths:i}=n;if(this.geometryType===`esriGeometryPoint`)r.push(...this._paths[0][0]),i.length=0;else for(let n of this._paths){for(let i of n)r.push(i[0]),r.push(i[1]*this.yFactor),e&&r.push(i[2]),t&&r.push(i[this._mIndex]);i.push(n.length)}return n}isClosed(){let e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}clone(){return new e().initialize(i(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,t)=>e+t)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}},x=4,S=1,C=class e extends _{initialize(e,t,n){return super.initialize(e,t,n),this._controlPoints||=this._controlPoints=Array(this.totalSize).fill(void 0).map(e=>new Set),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){let t=new e().initialize(this._geometry.clone(),this.geometryType,this.yFactor);return t._controlPoints=this._controlPoints,t}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}},w=class e extends b{initialize(e,t,n,r,i){return super.initialize(e,t,n,r,i)}clone(){return new e().initialize(i(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][x]=S}getControlPoint(){return this._paths[this.pathIndex][this._pointIndex][x]===S}setControlPointAt(e){this._paths[this.pathIndex][e][x]=S}getControlPointAt(e){return this._paths[this.pathIndex][e][x]===S}},T=100*222045e-21;function E(e){if(e.totalSize===0)return null;let t=u(e);if(!t)return null;let r=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*T,i=0,a=0;e.reset();for(let t=0;e.nextPath();t++){let n=e.getCurrentRingArea();n>a&&(a=n,i=t)}if(e.seekPath(i),e.pathSize===0)return null;e.seekPathStart();let o=f(e);if(Math.abs(a)<=2*r*r)return[(o[0]+o[2])/2,(o[1]+o[3])/2];e.seekPathStart();let s=n(e,d());if(s===null)return null;if(e.totalPoints<4)return s;let c=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],l=[NaN,NaN,NaN,NaN],p=[NaN,NaN,NaN,NaN],m=!1,h=O(s,e,!0);h.distance===0&&(m=!0,c[0][0]=s[0],c[0][1]=s[1],h=O(s,e,!1)),l[0]=h.distance,p[0]=0;let g=[NaN,NaN],_=!1,v=.25,y=-1,b=NaN;do if(b=NaN,c[1]=k(e,L(o[0],o[2],v),r,t),isNaN(c[1][0])||isNaN(c[1][1])||(h=O(c[1],e,!1),b=h.distance),!isNaN(b)&&b>r&&D(c[1],e))_=!0,l[1]=b,p[1]=R(c[1],s);else if(!isNaN(b)&&b>y&&(y=b,g[0]=c[1][0],g[1]=c[1][1]),v-=.01,v<.1){if(!(y>=0))break;_=!0,l[1]=y,c[1][0]=g[0],c[1][1]=g[1],p[1]=R(c[1],s)}while(!_);_=!1,v=.5,y=-1;let x=.01,S=1;do if(b=NaN,c[2]=k(e,L(o[0],o[2],v),r,t),isNaN(c[2][0])||isNaN(c[2][1])||(h=O(c[2],e,!1),b=h.distance),!isNaN(b)&&b>r&&D(c[2],e))_=!0,l[2]=b,p[2]=R(c[2],s);else if(!isNaN(b)&&b>y)y=b,g[0]=c[2][0],g[1]=c[2][1];else if(b>y&&(y=b,g[0]=c[2][0],g[1]=c[2][1]),v=.5+x*S,x+=.01,S*=-1,v<.3||v>.7){if(!(y>=0))break;_=!0,l[2]=y,c[2][0]=g[0],c[2][1]=g[1],p[2]=R(c[2],s)}while(!_);_=!1,v=.75,y=-1;do if(b=NaN,c[3]=k(e,L(o[0],o[2],v),r,t),isNaN(c[3][0])||isNaN(c[3][1])||(h=O(c[3],e,!1),b=h.distance),!isNaN(b)&&b>r&&D(c[3],e))_=!0,l[3]=b,p[3]=R(c[3],s);else if(b>y&&(y=b,g[0]=c[3][0],g[1]=c[3][1]),v+=.01,v>.9){if(!(y>=0))break;_=!0,l[3]=y,c[3][0]=g[0],c[3][1]=g[1],p[3]=R(c[3],s)}while(!_);let C=[0,1,2,3],w=m?0:1,E;for(let e=w;e<4;e++)for(let e=w;e<3;e++){let t=p[e],n=p[e+1];z(t,n)>0&&(E=C[e],C[e]=C[e+1],C[e+1]=E,p[e]=n,p[e+1]=t)}let A=w,j=0,M=0;for(let e=w;e<4;e++){switch(e){case 0:M=2*l[C[e]];break;case 1:M=1.66666666*l[C[e]];break;case 2:M=1.33333333*l[C[e]];break;case 3:M=l[C[e]]}M>j&&(j=M,A=C[e])}return c[A]}function D(e,t){let n,r,i,a,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(n=t.x,r=t.y;t.nextPoint();n=i,r=a)i=t.x,a=t.y,r>e[1]!=a>e[1]&&((i-n)*(e[1]-r)-(a-r)*(e[0]-n)>0?o++:o--);return o!==0}function O(e,t,n){if(n&&D(e,t))return{coord:e,distance:0};let i=1/0,a=0,o=0,s=[0,0],c=[0,0],l=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(s[0]=t.x,s[1]=t.y;t.nextPoint();s=c){c=[t.x,t.y],r(l,e,s,c);let n=R(e,l);n<i&&(i=n,a=l[0],o=l[1])}return{coord:[a,o],distance:Math.sqrt(i)}}function k(e,t,n,r){let i=[t,0],a=1/0,o=1/0,s=!1,c=!1,u=[[t,r[1]-1],[t,r[3]+1]],f=[0,0],p=[0,0],m=[0,0],h=[[0,0],[0,0]],g=d();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(h[0][0]=e.x,h[0][1]=e.y;e.nextPoint();h[0][0]=h[1][0],h[0][1]=h[1][1]){if(h[1][0]=e.x,h[1][1]=e.y,A(g,h)===null||(p[0]=u[0][0],p[1]=u[0][1],m[0]=u[1][0],m[1]=u[1][1],F(g,p,m)===0)||!l(u[0],u[1],h[0],h[1],f))continue;let t=f[1];a>o?t<a&&(a=t,s=!0):t<o&&(o=t,c=!0)}return s&&c?i[1]=(a+o)/2:i[0]=i[1]=NaN,i}function A(e,t){if(t.length<2)return null;e||=d();let[n,r]=t[0],[i,a]=t[1];return e[0]=Math.min(n,i),e[1]=Math.min(r,a),e[2]=Math.max(n,i),e[3]=Math.max(r,a),e}var j=1,M=4,N=3,P=12;function F(e,t,n){let r=I(t,e),i=I(n,e),a=e[0],o=e[1],s=e[2],c=e[3];if(r&i)return 0;if(!(r|i))return 4;let l=(r?1:0)|(i?2:0);do{let l=n[0]-t[0],u=n[1]-t[1];if(l>u)r&N?(r&j?(t[1]+=u*(a-t[0])/l,t[0]=a):(t[1]+=u*(s-t[0])/l,t[0]=s),r=I(t,e)):i&N?(i&j?(n[1]+=u*(a-n[0])/l,n[0]=a):(n[1]+=u*(s-n[0])/l,n[0]=s),i=I(n,e)):r?(r&M?(t[0]+=l*(o-t[1])/u,t[1]=o):(t[0]+=l*(c-t[1])/u,t[1]=c),r=I(t,e)):(i&M?(n[0]+=l*(o-n[1])/u,n[1]=o):(n[0]+=l*(c-n[1])/u,n[1]=c),i=I(n,e));else if(r&P?(r&M?(t[0]+=l*(o-t[1])/u,t[1]=o):(t[0]+=l*(c-t[1])/u,t[1]=c),r=I(t,e)):i&P?(i&M?(n[0]+=l*(o-n[1])/u,n[1]=o):(n[0]+=l*(c-n[1])/u,n[1]=c),i=I(n,e)):r?(r&j?(t[1]+=u*(a-t[0])/l,t[0]=a):(t[1]+=u*(s-t[0])/l,t[0]=s),r=I(t,e)):(i&j?(n[1]+=u*(a-n[0])/l,n[0]=a):(n[1]+=u*(s-n[0])/l,n[0]=s),i=I(n,e)),r&i)return 0}while(r|i);return l}function I(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function L(e,t,n){return e+(t-e)*n}function R(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function z(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;let n=isNaN(e),r=isNaN(t);return n<r?-1:n>r?1:0}export{g as n,E as t};