const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/lengthOperator-DO2El8sG.js","assets/SpatialReference-BzfAMI5E.js","assets/index-CzMixifc.js","assets/index-CDgdHpAj.css","assets/Envelope2D-n2TB2v9l.js","assets/Point2D-BslC4Gs9.js","assets/OperatorDefinitions-DoM9xd5U.js","assets/SimpleGeometryCursor-BbFgAuic.js","assets/Transformation2D-B6W9saMR.js","assets/lengthOperator-Dt-MIlZz.js","assets/apiConverter-BOyb99jX.js","assets/jsonConverter-CYYMdpyx.js","assets/OptimizedGeometry-5fDazGe-.js","assets/memoryEstimations-C3WUBUZI.js"])))=>i.map(i=>d[i]);
import{Ag as e,An as t,BS as n,BT as r,Bx as i,CE as a,DT as o,Fg as s,Gf as c,Gh as l,Gw as u,JE as d,Jw as f,Jx as p,Kw as m,Nx as h,OT as g,Ov as _,Ox as v,QC as y,Q_ as b,Qc as ee,Qw as x,Rv as te,Sb as S,Sg as C,UT as w,Vl as ne,WT as T,XT as re,Z_ as ie,Zu as ae,Zv as oe,_w as E,bS as se,dg as ce,eT as D,fT as le,gD as O,hT as ue,hw as de,iv as k,jd as fe,kx as pe,lw as me,mb as he,nD as ge,nh as _e,nv as A,pg as ve,px as ye,qE as be,rT as j,rh as xe,rv as M,sl as Se,vT as N,vd as Ce,wx as we,zi as Te}from"./index-CzMixifc.js";import"./memoryEstimations-C3WUBUZI.js";import"./OptimizedGeometry-5fDazGe-.js";import"./Point2D-BslC4Gs9.js";import"./Envelope2D-n2TB2v9l.js";import"./SpatialReference-BzfAMI5E.js";import"./Transformation2D-B6W9saMR.js";import"./SimpleGeometryCursor-BbFgAuic.js";import"./OperatorDefinitions-DoM9xd5U.js";import"./jsonConverter-CYYMdpyx.js";import"./apiConverter-BOyb99jX.js";import"./geodeticCurveType-B3tSXlNQ.js";import"./geodeticAreaOperator-Csb55Hyk.js";import"./geodeticLengthOperator-BOd67Z-X.js";import"./Distance2DCalculator-CXhBP-8I-DgwBxA-7.js";import"./distanceOperator-DtUZpUXI.js";import"./operatorSimplify-HaL4veBZ.js";import"./simplifyOperator-DqzqfbFt.js";import"./quatf64-eO7UAs9K.js";import"./quat-XKFzqP_i.js";import"./earcut-CsNwSYFA.js";import"./plane--nqwMDYx.js";import"./vectorStacks-BQiry9fn.js";import"./projectPointToVector-D72S8Uh5.js";import"./spatialReferenceEllipsoidUtils-b6wDfyu0.js";import"./dehydratedPoint-CVzHYxaL.js";import"./projectVectorToVector-CZxjcyx6.js";import{S as Ee,d as De,m as Oe}from"./elevationInfoUtils-BcUBf70F.js";import{o as ke}from"./colorUtils-Btp0B-0Y.js";import{t as Ae}from"./GraphicsLayer-CSZ-X1QF.js";import"./ObjectStack-DiVLRoBj.js";import"./ray-XqUMyuyU.js";import{t as je}from"./GeometryDescriptor-BbSGeosl.js";import{t as Me}from"./getDefaultUnitForView-hBFUzhgR.js";import{n as Ne,t as Pe}from"./ExclusiveOperationManager-BRGv9mhm.js";import"./quantity-DI5We-W2.js";import{a as Fe,i as Ie,o as Le,s as Re}from"./geodesicUtils-DoIAZh7n.js";import{n as ze,r as Be,t as Ve}from"./SketchViewModel-Dri-bLEj.js";import"./isSupportedObject-B58JKqS1.js";import"./layerUtils-CCmUM-i4.js";import"./SketchOptions-CQ-6mB9z.js";import"./LineSnappingHint-C4TfMb_L.js";import{n as He}from"./ParallelSnappingHint-V0i1PzO4.js";import"./snappingUtils-BVQZFw4z.js";import"./vec3-D7a6REBc.js";import"./sphere-DkSdrT5o.js";import"./constraints-CZ12pnWC.js";import"./SnappingCandidate-CgOYxD9J.js";import"./EdgeSnappingCandidate-CRqUhTG1.js";import"./DrapedEdgeSnappingCandidate-yTm_e8W9.js";import"./IntersectionSnappingHint-GxnfNu8X.js";import"./IntersectionSnappingCandidate-CEWLdgd3.js";import"./LineSnappingCandidate-DrfbJnwY.js";import"./RightAngleTriangleSnappingCandidate-BnNMDbkx.js";import"./RightAngleSnappingHint-DDG9ajUd.js";import"./viewUtils-BjnASAVJ.js";import"./viewUtils-D2qwRYoF.js";import"./euclideanLengthMeasurementUtils-D4gy5vyI.js";import"./lineSegment-WEn1ku7V.js";import"./triangle-B4dfMIWc.js";import"./hitTestSelectUtils-B7XlogWA.js";import{t as Ue}from"./mapCollectionUtils-BUGTAoOg.js";import{t as We}from"./throttle-B2HVGxWH.js";import{a as Ge}from"./createUtils-Ch7ggY8g.js";function Ke(e){return re([A(()=>{let{analysis:t,sketchGraphic:n,toolState:r,visible:i}=e.analysisViewData,{geometryVisualizationVisible:a}=t.viewOptions;return{geometryVisualizationVisible:a,geometry:t.geometry,sketchGraphic:n,toolState:r,visible:i}},({geometryVisualizationVisible:t,sketchGraphic:n,toolState:r,visible:i})=>{if(e.remove(),i)return t&&n!=null&&r!==`reshaping`&&r!==`sketching`?e.show(n):void 0},M)])}var P=class extends E{constructor(e){super(e)}initialize(){this.addHandles(Ke({analysisViewData:this.analysisViewData,remove:()=>{},show:()=>{}}))}get updating(){return!1}};O([o({constructOnly:!0})],P.prototype,`view`,void 0),O([o({constructOnly:!0})],P.prototype,`analysisViewData`,void 0),O([o()],P.prototype,`updating`,null),P=O([g(`esri.views.2d.analysis.ElevationProfile.ElevationProfileInputVisualization2D`)],P);var qe={noDataValue:-5e5,defaultQueryOptions:()=>({noDataValue:qe.noDataValue,demResolution:`auto`,maximumAutoTileRequests:150,ignoreInvisibleLayers:!0,signal:null}),updateThrottleMillis:100,delayAfterPreviewMillis:500,defaultDemResolution:h(10,`centimeters`,`meters`),densificationMaxSamples:3e3,largeChartSamples:1e4,maxTotalSamples:1e5,maxChartRatio:300,minSlopeSampleDistance:10,formatPrecision:1,profileLinesUpdateThrottleMillis:100,hoveredPointsStyle:{size:14,borderStyle:`solid`,borderWidth:3,borderColor:`#ffffff`,boxShadow:`0px 0px 0px 5px rgba(255,255,255,0.2)`}};function F(){return qe}function Je(e,t){if(!e||e.length===0)return;let n=e.length-1,r=[],i=[];for(let t=0;t<=n;t++){let{x:a,y:o,z:s}=e[t];s!=null&&i.push([a,o,s]),t!==n&&s!=null||!i.length||(r.push(i),i=[])}return Ge(r,t,!0)}var I=class extends E{constructor(e){super(e),this.index=0,this._graphic=new Ce,this._updateGeometryThrottled=We(e=>{e&&(this._graphic.geometry=Je(e.samples,e.spatialReference))},F().profileLinesUpdateThrottleMillis)}initialize(){this._graphic.attributes={index:this.index},this.addGraphic(this._graphic),this.addHandles([A(()=>this._effectiveVisible,e=>{this._graphic.visible=e},M),A(()=>this._colorUpdateParameters,e=>this._updateColor(e),M),A(()=>this.analysisViewData.analysis.geometry,()=>{this._graphic.geometry=null},M),A(()=>this._geometryUpdateParameters,e=>this._updateGeometryThrottled(e),M),this._updateGeometryThrottled])}destroy(){this._graphic.destroy()}get updating(){return this._updateGeometryThrottled.hasPendingUpdates()}get _result(){return this.getResult()}get _effectiveVisible(){let{analysisViewData:e,_result:t}=this;return e.visible&&!!t?.available&&t.computation.profile.viewOptions.lineVisible}get _geometryUpdateParameters(){let e={samples:this._result?.samples,spatialReference:this.view.spatialReference};return e.samples&&this._effectiveVisible&&this.analysisViewData.progress!==1?null:e}get _colorUpdateParameters(){let e=this._result?.computation.profile.color;return e?{color:e.toArray(),contrastColor:ke(e).toArray()}:null}_updateColor(e){e&&(this._graphic.symbol=new c({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{type:`CIMSolidStroke`,capStyle:`Butt`,color:e.color,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[5,4],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],joinStyle:`Round`,width:1.5},{type:`CIMSolidStroke`,capStyle:`Butt`,color:e.contrastColor,joinStyle:`Round`,width:1.5}]}}}))}};O([o({constructOnly:!0})],I.prototype,`addGraphic`,void 0),O([o({constructOnly:!0})],I.prototype,`analysisViewData`,void 0),O([o({constructOnly:!0})],I.prototype,`getResult`,void 0),O([o({constructOnly:!0})],I.prototype,`index`,void 0),O([o({constructOnly:!0})],I.prototype,`view`,void 0),O([o()],I.prototype,`updating`,null),O([o()],I.prototype,`_result`,null),O([o()],I.prototype,`_effectiveVisible`,null),O([o()],I.prototype,`_geometryUpdateParameters`,null),O([o()],I.prototype,`_colorUpdateParameters`,null),I=O([g(`esri.views.2d.analysis.ElevationProfile.ElevationProfileLineVisualization2D`)],I);var L=class extends E{constructor(e){super(e),this.position=null,this.color=new xe(`#ffffff`),this.element=Ye()}initialize(){this.addHandles([A(()=>this._screenLocation,e=>{e&&(this.element.style.transform=`translate(${e.x}px, ${e.y}px)`)},M),A(()=>this.color.toCss(),e=>{this.element.style.background=e},M)]),this.view.surface?.appendChild(this.element)}destroy(){this.element.remove()}get _screenLocation(){let{position:e,view:t}=this;t.type===`3d`?(t.commitProperty(`size`),t.commitProperty(`camera`)):t.commitProperty(`center`);let n=t?.spatialReference,r=n?C(e,n).geometry:null;return r&&t?.ready?t.toScreen(r):null}};function Ye(){let e=document.createElement(`div`),{size:t,borderStyle:n,borderColor:r,borderWidth:i,boxShadow:a}=F().hoveredPointsStyle,{style:o}=e;return o.display=`block`,o.position=`absolute`,o.top=`0`,o.left=`0`,o.contain=`strict`,o.boxSizing=`border-box`,o.width=`${t}px`,o.height=`${t}px`,o.marginTop=`-${t/2}px`,o.marginLeft=`-${t/2}px`,o.border=`${n} ${i}px ${r}`,o.borderRadius=`${t}px`,o.boxShadow=a,e}O([o()],L.prototype,`position`,void 0),O([o({type:xe})],L.prototype,`color`,void 0),O([o()],L.prototype,`view`,void 0),O([o()],L.prototype,`_screenLocation`,null),L=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointVisualization`)],L);var R=class extends E{constructor(e){super(e),this._hoveredPoints=new k}initialize(){let{analysisViewData:e}=this,{analysis:t}=e;this.addHandles([A(()=>{let{hoveredPoints:n,visible:r,updating:i}=e;return r?i?null:n.map((e,n)=>{let r=t.profiles.at(n);return!0===r?.viewOptions.hoveredPointVisible&&e!=null?{hoveredPoint:e,color:r.color}:null}).filter(e=>!!e):[]},e=>this._update(e),M),A(()=>t.geometry,()=>this._update([]),M)])}destroy(){this._hoveredPoints.drain(e=>e.destroy())}get updating(){return!1}_update(e){if(!e)return;let{view:t,_hoveredPoints:n}=this,r=e.length;for(;n.length>r;)n.pop()?.destroy();for(;n.length<r;){let e=new L({view:t});n.push(e)}for(let t=0;t<r;++t){let i=e[t],a=n.at(r-1-t);a.position=i.hoveredPoint,a.color=i.color}}};O([o()],R.prototype,`view`,void 0),O([o()],R.prototype,`analysisViewData`,void 0),O([o()],R.prototype,`_hoveredPoints`,void 0),O([o()],R.prototype,`updating`,null),R=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileHoveredPointsVisualization`)],R);var z=class extends E{constructor(e){super(e),this._graphicsLayer=new Ae({listMode:`hide`,internal:!0})}initialize(){this.view.map.add(this._graphicsLayer),this.view.map.layers.reorder(this._graphicsLayer,0);let{view:e,analysisViewData:t}=this;this._hoveredPointsVisualization=new R({view:e,analysisViewData:t}),this._inputVisualization=new P({view:e,analysisViewData:t}),this._lineVisualizations=Ue(()=>this.analysisViewData.analysis.profiles,n=>new I({view:e,analysisViewData:t,addGraphic:e=>{e.attributes={index:this.analysisViewData.analysis.profiles.indexOf(n)},this._graphicsLayer.add(e),this._graphicsLayer.graphics.sort((e,t)=>{let n=e.attributes?.index??0;return(t.attributes?.index??0)-n})},getResult:()=>t.results.find(e=>e.computation.profile===n)}))}destroy(){this._inputVisualization.destroy(),this._hoveredPointsVisualization.destroy(),this._lineVisualizations.destroy(),this._graphicsLayer.graphics.drain(e=>{e.destroyed||e.destroy()}),this._graphicsLayer.removeFromParent(),this._graphicsLayer.destroy()}get updating(){return this._hoveredPointsVisualization.updating||this._inputVisualization.updating||this._lineVisualizations.some(e=>e.updating)}};O([o()],z.prototype,`view`,void 0),O([o()],z.prototype,`analysisViewData`,void 0),O([o()],z.prototype,`updating`,null),z=O([g(`esri.views.2d.analysis.ElevationProfile.ElevationProfileVisualization2D`)],z);function B(e,t){let n,r=!1;function i(...i){let a=e.apply(this,i);return r&&n!==void 0&&t?.(n,a)?n:(r=!0,n=a,a)}return i}var Xe=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,t){this._store.put(e,t)}},V=class extends r{constructor(e,t,n){super(e,t,n),this.name=`unknown`,this.name=e}},H=class extends V{constructor(){super(`too-complex`,`The input geometry has too many points.`)}},Ze=class extends V{constructor(){super(`elevation-query-error`,`Error querying elevation from provider.`)}},Qe=class extends V{constructor(){super(`unknown`,`Unknown error.`)}},U=class extends r{constructor(){super(`invalid-geometry`,`The input geometry is invalid.`)}};async function $e(t,r,a,o,c,l,u){let d,f,p,m=t.spatialReference,h=m.isGeographic||m.isWebMercator,g=0;if(!h){let{execute:e}=await n(async()=>{let{execute:e}=await import(`./lengthOperator-DO2El8sG.js`);return{execute:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]));D(u),g=e(t,{unit:`meters`}),D(u)}let _=1/i(o);if(h){await e([{source:m,dest:o},{source:m,dest:we.WGS84}],u);let n=xt(t);d=Le([n],`meters`)[0];let i=et(d,c);if(Ct(t,d,i)>l)throw new H;let h=tt(n,r,a);({densifiedPath:f,distances:p}=mt(h,i,_)),f=s(f,o)}else{await e([{source:m,dest:o}],u),d=g;let n=et(d,c);if(Ct(t,d,n)>l)throw new H;let i=tt(t,r,a);({densifiedPath:f,distances:p}=pt(i,n,_)),D(u),f=s(f,o)}return{densifiedPath:f,pathLength:d*_,distances:p}}function et(e,t){let n=e/t.densificationMaxSamples;return Math.max(t.samplingDistance,n)}function tt(e,t,n){if(t==null)return it(e);let r=e.spatialReference,i=t.mode,a=De(t,r),o=null;switch(n.type){case`2d`:o=nt(e,i,a);break;case`3d`:o=rt(e,i,a,n)}return o==null?it(e):new _({hasZ:!0,hasM:!1,spatialReference:r,paths:at(e.paths,o)})}function nt({hasZ:e},t,n){return t===`absolute-height`?e?([e,t,r])=>[e,t,r+n]:([e,t])=>[e,t,n]:null}function rt({spatialReference:e,hasZ:t},n,r,{elevationProvider:i}){let a=(t,n,r,a)=>i?.getElevation(t,n,r,e,a)??0;switch(n){case`on-the-ground`:return([e,t])=>[e,t,a(e,t,0,`ground`)];case`absolute-height`:return t?([e,t,n])=>[e,t,n+r]:([e,t])=>[e,t,r];case`relative-to-ground`:return t?([e,t,n])=>[e,t,n+a(e,t,n,`ground`)+r]:([e,t])=>[e,t,a(e,t,0,`ground`)+r];case`relative-to-scene`:return t?([e,t,n])=>[e,t,n+a(e,t,n,`scene`)+r]:([e,t])=>[e,t,a(e,t,0,`scene`)+r];default:return null}}function it(e){return e.hasZ?new _({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:at(e.paths,([e,t])=>[e,t])}):e}function at(e,t){let n=e.length,r=Array(n);for(let i=0;i<n;++i){let n=e[i],a=n.length,o=Array(n.length);r[i]=o;for(let e=0;e<a;++e)o[e]=t(n[e])}return r}function ot(e){return lt(e)&&e.paths.some(e=>e.length>1)}function st(e){return ct(e)&&ot(e.geometry)}function ct(e){return ut(e)&&lt(e?.geometry)}function lt(e){return!ut(e)&&e!=null&&e.type===`polyline`}function ut(e){return e!=null&&`geometry`in e}function dt(e){let t=e?.layer;return t!=null&&t.type===`graphics`&&t.internal}function ft(e,t,n,r,a){let{spatialReference:o,hasZ:s}=e,c={from:null,to:null,distance:0,azimuth:0,reverseAzimuth:0,spatialReference:o,metersPerSR:i(o)},l=[],u=[],d=0;for(let i=0;i<e.paths.length;++i){let o=e.paths[i],s=[],f=[],p=0;for(let e=1;e<o.length;++e){let i=o[e-1],l=o[e],u=r(c,i,l),m;for(m=p;m<u.distance&&!y(m,u.distance);m+=t)s.push(a(u,m)),f.push((d+m)*n);p=m-u.distance,d+=u.distance,s.push(l),f.push(d*n)}l[i]=s,u[i]=f}return{densifiedPath:new _({spatialReference:o,hasZ:s,paths:l}),distances:u}}function pt(e,t,n){let{hasZ:r}=e;return ft(e,t,n,gt,r?bt:yt)}function mt(e,t,n){let{hasZ:r}=e;return ft(e,t,n,ht,r?vt:_t)}function ht(e,t,n){return e.distance=0,Fe(e,t,n,e.spatialReference),e.from=t,e.to=n,e}function gt(e,t,n){return e.from=t,e.to=n,e.distance=S(n,t)*e.metersPerSR,e}function _t({from:e,azimuth:t,spatialReference:n},r){return Ie([0,0],e,t,r,n)}function vt({from:e,to:t,azimuth:n,distance:r,spatialReference:i},a){let o=a/r,s=[0,0,me(e[2],t[2],o)];return Ie(s,e,n,a,i),s}function yt({from:e,to:t,distance:n},r){return he([0,0],e,t,r/n)}function bt({from:e,to:t,distance:n},r){return Se([0,0,0],e,t,r/n)}function xt(e){return Re(e.spatialReference)?e:s(e,we.WGS84)}function St(e){return e.paths.reduce((e,t)=>e+t.length,0)}function Ct(e,t,n){return St(e)+Math.floor(t/n)+Math.max(0,e.paths.reduce(e=>1+e,0)-1)}function wt(e,t){let n=e.length;if(n===0)return null;let r=e[0],a=r.sampledZ,o=a,s=a,c=0,l=0,u=null,d=null,f=a??0,m=0,g=0,_=a==null?0:1,v=0,y=0,b=i(t),ee=p(t),x=F().minSlopeSampleDistance/b,te=2*x,S=new kt,C=new kt,w=()=>{T(),S.copy(C),C.reset()},ne=(e,t)=>{w(),e>0&&e-S.start<=te&&(e=S.start+x),C.restart(e,t)},T=()=>{if(S.isHole||C.isHole)return;let e=C.avgElevation-S.avgElevation,t=C.start-S.start,n=e*ee,r=t*b,i=h(Math.atan2(n,r),`radians`,`degrees`);i>0?(m+=i,u=W(u,i),v++):i<0&&(g-=i,d=W(d,-i),y++)};r.sampledZ!=null&&ne(r.distance,r.sampledZ);for(let t=1;t<n;++t){let n=e[t-1],r=e[t],i=r.sampledZ;if(i==null){C.isHole||w();continue}_++,f+=i,o=Dt(o,i),s=W(s,i),C.isHole||r.distance-C.start>=x?ne(r.distance,i):C.insert(i);let a=n.sampledZ;if(a!=null){let e=i-a;e>0?c+=e:e<0&&(l-=e)}}return w(),_===0?null:{maxDistance:e[n-1].distance,minElevation:o,maxElevation:s,avgElevation:_===0?null:f/_,elevationGain:c,elevationLoss:l,maxPositiveSlope:u,maxNegativeSlope:d,avgPositiveSlope:v===0?null:m/v,avgNegativeSlope:y===0?null:g/y}}function Tt(e){let t=e.filter(d),n=t.length;if(n===0)return null;let r=t[0];if(n===1)return r;let i=r.maxDistance,a=r.minElevation,o=r.maxElevation,s=r.maxPositiveSlope,c=r.maxNegativeSlope;for(let e=1;e<t.length;++e){let n=t[e];i=W(i,n.maxDistance),a=Dt(a,n.minElevation),o=W(o,n.maxElevation),s=W(s,n.maxPositiveSlope),c=W(c,n.maxNegativeSlope)}return{maxDistance:i,minElevation:a,maxElevation:o,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:s,maxNegativeSlope:c,avgPositiveSlope:null,avgNegativeSlope:null}}function Et(e){let t=null,n=null,r=null;for(let a of e){if(a==null)continue;let{statistics:e,spatialReference:o}=a;if(e==null)continue;let s=i(o);t=W(t,Ot(e.maxDistance,s));let c=p(o);r=Dt(r,Ot(e.minElevation,c)),n=W(n,Ot(e.maxElevation,c))}return{minDistance:0,maxDistance:t??0,minElevation:r??0,maxElevation:n??0}}function Dt(e,t){return t==null?e:e==null?t:Math.min(e,t)}function W(e,t){return t==null?e:e==null?t:Math.max(e,t)}function Ot(e,t){return e!=null&&t!=null?e*t:null}var kt=class{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return this._sampleCount===0}get start(){return this._start}copy(e){this._start=e._start,this._sampleCount=e._sampleCount,this._totalElevation=e._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(e,t){this._start=e,this._sampleCount=1,this._totalElevation=t}insert(e){++this._sampleCount,this._totalElevation+=e}};function At(e,t,n=[]){if(e>=t||(n.push(e),t-e<2))return n;let r=t-1;n.push(r);let i=jt(e+1,r);for(;;){let e=i.next();if(e.done)break;n.push(e.value)}return n}function*jt(e,t){if(e>=t)return;let n=e+Math.floor((t-e)/2);yield n;let r=jt(e,n),i=jt(n+1,t);for(;;){let e=r.next(),t=i.next();if(e.done&&t.done)break;e.done||(yield e.value),t.done||(yield t.value)}}async function*Mt(e,t){let{view:n,geometry:r,elevationInfo:i,providers:a,options:o}=e,s=n.spatialReference;if(!s||r==null||!ot(r))throw new U;let c=a.length;if(c===0)return null;let l=Math.round(o.maxTotalSamples/c);if(St(r)>l)throw new H;let d=await $e(r,i,n,s,o,l,t);D(t);let f=0,p=Array(c),m=Array(c);for(let n=0;n<c;n++){let r=zt(d);p[n]=r,f+=r.samples.length;let i={...e,provider:a[n],result:r,densificationResult:d};m[n]=Nt(i,t)[Symbol.iterator]()}if(f>o.maxTotalSamples)throw new H;let h=await Promise.all(m.map(e=>{let t=e.next();return!0===t.done?Promise.resolve(null):t.value}));D(t);for(let e=0;e<c;e++)p[e]=h[e];yield p,await u(e.delayAfterPreview??F().delayAfterPreviewMillis,null,t.signal),D(t);let g=[];try{let e;do{e=!1;for(let t=0;t<c;t++){let n=m[t].next();!1===n.done&&(g.push({resultPromise:n.value,index:t}),e=!0)}}while(e)}finally{m.forEach(e=>e.return?.())}for(let{resultPromise:e,index:n}of g)p[n]=await e,D(t),yield p;for(let e of p)e!=null&&(e.progress=1);yield p}function*Nt(e,t){let{densificationResult:n}=e,r={...e,abortOptions:t,densificationResult:n},i=At(0,r.result.samples.length),a=i.slice(0,r.provider.numSamplesForPreview);yield Pt(r,a,!0);let o=be(i,r.provider.numSamplesPerChunk);for(let e of o)yield Pt(r,e,!1)}async function Pt({densificationResult:e,result:t,provider:n,queue:r,abortOptions:i,cache:a},o,s){let{densifiedPath:c,pathLength:l}=e,u=t.spatialReference,{samples:d}=t,f=[];for(let e=0;e<o.length;e++)f[e]=[...d[o[e]].coordinate];try{return await r.push({geometry:new oe({spatialReference:u,points:f,hasZ:c.hasZ}),provider:n,indices:o,preview:s,result:t,parameters:{...F().defaultQueryOptions(),minDemResolution:s?Math.round(l/n.numSamplesForPreview):Math.round(l/d.length),cache:a}},i),{...t}}catch(e){return x(e),null}}function Ft(e){return new ee({priority:ne.ELEVATION_PROFILE,concurrency:1,scheduler:e,process:async e=>{D(e.parameters);try{await It(e)}catch(e){x(e)}}})}async function It({geometry:e,provider:t,indices:n,preview:r,result:i,parameters:a}){if(n.length===0)return;let o=(await Ut(t,e,a)).geometry,{hasZ:s,points:c}=o,l=a.noDataValue,{samples:u}=i;for(let e=0;e<n.length;e++){let t=u[n[e]];if(t.isHole)continue;let r=s?c[e][2]:null;r===null||r===l?t.sampledZ=null:(i.hasZ=!0,t.sampledZ=r),t.sampled=!0}Lt(u),i.progress=r?0:i.progress+n.length/u.length,i.statistics=wt(i.samples,i.spatialReference)}function Lt(e){let t=e.length-1,n=0;for(let r=1;r<=t;r++)(e[r].sampled||r===t)&&(Rt(e,n,r),n=r)}function Rt(e,t,n){if(n-t===1)return;let r=e[t],i=r.sampledZ,a=e[n],o=a.sampledZ;if(i==null||o==null){for(let r=t+1;r<n;r++)e[r].sampledZ=null;return}let s=r.distance,c=a.distance-s;for(let r=t+1;r<n;r++){let t=e[r],n=(t.distance-s)/c;t.sampledZ=me(i,o,n)}}function zt({densifiedPath:e,distances:t}){let n=e.spatialReference,r=se(n),i=e.paths,a=i.length,o=[],s=null,c=0;for(let e=0;e<a;e++){let n=i[e],a=n.length,l=t[e];for(let e=0;e<a;e++){let t=n[e],i=l[e];r&&(t[0]=te(t[0],r.valid[0],r.valid[1])),s&&e===0&&Bt(o,s,t,c,i),o.push(Vt(t,i)),s=t,c=i}}return{progress:0,samples:o,hasZ:!1,statistics:null,spatialReference:n}}function Bt(e,t,n,r,i){e.push(Ht(t,r)),e.push(Ht(n,i))}function Vt(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!1,isHole:!1}}function Ht(e,t){return{coordinate:e,distance:t,sampledZ:null,sampled:!0,isHole:!0}}async function Ut(e,t,n){try{return await e.queryElevation(t,n)}catch{throw new Ze}}function Wt(e,t,n){if(!e||e.length===0)return;let r=e.length-1,i=e[0];if(t<=n(i))return i;let a=e[r];if(t>=n(a))return a;let o=0,s=0,c=r;for(;o<c;){s=o+Math.floor((c-o)/2);let i=e[s],a=n(i);if(a===t)return i;if(t<a){if(s>0){let r=e[s-1],o=n(r);if(t>o)return t-o>=a-t?i:r}c=s}else{if(s<r){let r=e[s+1],o=n(r);if(t<o)return t-a>=o-t?r:i}o=s+1}}return e[s]}function Gt(e){return e>.999999?1:e}var G=class extends E{constructor(e){super(e),this.error=null,this._getStableEffectiveUnits=B(()=>{let e=Et(this._activeComputations.map(e=>e.result.rawResult)),t=this.analysis.displayUnits,n=Me(this.view);return{distance:v(e.maxDistance,`meters`,t.distance??n),elevation:pe(e.maxElevation,`meters`,t.elevation??n)}},a),this._updateTask=null,this._queue=null,this._currentTileCache=null,this._parametersPerComputation=new Map,this._getStableUpdateParameters=B(()=>({stationary:this.view.stationary??!0,activeComputations:this._activeComputations,generationParameters:this._generationParameters}),a),this._getStableGenerationParameters=B(()=>{let{view:e,analysis:t}=this;return e?.ready&&this._queue?{view:e,geometry:t.geometry,geometryIsValid:t.valid,elevationInfo:this.elevationInfo,queue:this._queue,cache:this._tileCache,options:this._options,slicePlane:e.type===`3d`?e.slice.plane:null}:null},a),this._getStableElevationInfo=B(()=>this.analysis.elevationInfo??Kt,ue),this._getStableOptions=B(()=>{let{densificationMaxSamples:e,defaultDemResolution:t,maxTotalSamples:n}=F(),r=this._minDemResolution??t;return r=parseFloat(r.toFixed(2)),{samplingDistance:r,densificationMaxSamples:Math.round(e/this._activeComputations.length),maxTotalSamples:n}},a),this._updateThrottled=We(e=>this._update(e),F().updateThrottleMillis)}initialize(){this._computationsCollection=Ue(()=>this.analysis.profiles,e=>this.computationFactory.create({controller:this,profile:e,onInvalidate:e=>this._invalidateComputation(e)}),{recycleItems:!0}),this.addHandles([this._computationsCollection.on(`change`,()=>{this._parametersPerComputation.clear(),this._updateThrottled(this._updateParameters)}),A(()=>this._updateParameters,e=>this._updateThrottled(e),M),this._updateThrottled]);let e=this.view.type===`3d`?this.view.resourceController:void 0;this._queue=Ft(e?.scheduler),e?.addUpdatingObject(this)}destroy(){this._abortUpdate(),this._parametersPerComputation.clear(),this._computationsCollection?.destroy(),this._queue=N(this._queue),this._currentTileCache=N(this._currentTileCache)}get effectiveDisplayUnits(){return this._getStableEffectiveUnits()}get progress(){let e=0,t=0;for(let n of this._activeComputations)e++,t+=n.progress;return Gt(e>0?t/e:0)}get updating(){let{progress:e}=this,t=!!this._queue?.updating,n=this._updateThrottled.hasPendingUpdates(),r=this._updateTask!=null&&!this._updateTask.finished;return t||n||r||e>0&&e<1}get results(){return this._computations.map(e=>e.result)}get statistics(){return Tt(this._activeComputations.map(e=>e.result.statistics))}get hoveredPoints(){return this._computations.map(e=>e.hoveredPoint)}onElevationChange(e){let{view:t}=this;return t?.type===`3d`?b(()=>t.elevationProvider,`elevation-change`,e,{onListenerAdd:e,onListenerRemove:e}):T()}get _tileCache(){this._currentTileCache=N(this._currentTileCache);let e=this.view;if(e?.type===`3d`){let t=e.basemapTerrain?.elevationQueryCache;if(t!=null)return t}return this._currentTileCache??=new Xe(new t(20971520)),this._currentTileCache}get _computations(){return this._computationsCollection?.toArray()??[]}get _activeComputations(){return this._computations.filter(e=>e.profile.enabled&&e.available)}get _minDemResolution(){let e=this._minDemResolutions;return e.length>0?ge(e):null}get _minDemResolutions(){let e=[];for(let{minDemResolution:t}of this._activeComputations)t!=null&&e.push(t);return e}get _updateParameters(){return this._getStableUpdateParameters()}get _generationParameters(){return this._getStableGenerationParameters()}get elevationInfo(){return this._getStableElevationInfo()}get _options(){return this._getStableOptions()}_update({stationary:e,activeComputations:t,generationParameters:n}){this._abortUpdate(),e&&(n==null?this._clearResults():this._updateTask=ce(async e=>{this.error=null;let r=t.filter(e=>!this._isComputationValid(e,n));try{if(!n.geometryIsValid)throw new U;let t=Mt({...n,providers:r},{signal:e}),i=!1;for await(let a of t){D(e),i||=(this._clearInvalidResults(n),!0);for(let e=0;e<r.length;e++)r[e].setResult(a[e])}for(let e of r)this._parametersPerComputation.set(e,n)}catch(e){f(e),this._abortUpdate(),this.error=e instanceof V?e:e instanceof U?null:new Qe,r.forEach(e=>e.clearResult())}}))}_abortUpdate(){this._updateTask=le(this._updateTask)}_isComputationValid(e,t){return this._parametersPerComputation.has(e)&&this._parametersPerComputation.get(e)===t}_invalidateComputation(e){this._parametersPerComputation.delete(e),this._updateThrottled(this._updateParameters)}_clearInvalidResults(e){for(let t of this._computations)this._isComputationValid(t,e)||(t.clearResult(),this._parametersPerComputation.delete(t))}_clearResults(){for(let e of this._computations)e.clearResult(),this._parametersPerComputation.delete(e)}};O([o({constructOnly:!0})],G.prototype,`analysis`,void 0),O([o({constructOnly:!0})],G.prototype,`analysisViewData`,void 0),O([o({constructOnly:!0})],G.prototype,`computationFactory`,void 0),O([o({constructOnly:!0})],G.prototype,`view`,void 0),O([o()],G.prototype,`error`,void 0),O([o({readOnly:!0})],G.prototype,`effectiveDisplayUnits`,null),O([o()],G.prototype,`progress`,null),O([o()],G.prototype,`updating`,null),O([o()],G.prototype,`results`,null),O([o()],G.prototype,`statistics`,null),O([o()],G.prototype,`hoveredPoints`,null),O([o()],G.prototype,`_updateTask`,void 0),O([o()],G.prototype,`_queue`,void 0),O([o()],G.prototype,`_tileCache`,null),O([o()],G.prototype,`_computationsCollection`,void 0),O([o()],G.prototype,`_computations`,null),O([o()],G.prototype,`_activeComputations`,null),O([o({readOnly:!0})],G.prototype,`_minDemResolution`,null),O([o()],G.prototype,`_minDemResolutions`,null),O([o()],G.prototype,`_updateParameters`,null),O([o()],G.prototype,`_generationParameters`,null),O([o()],G.prototype,`elevationInfo`,null),O([o()],G.prototype,`_options`,null),G=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileController`)],G);var Kt=new Te({...Oe});function qt(e,t){if(e==null||t==null)return null;let{samples:n,spatialReference:r}=e,{distance:a,elevation:o}=t,s=i(r),c=p(r),l=n.length,u=Array(l);for(let e=0;e<l;++e){let t=n[e],r=t.sampledZ,i=t.coordinate;u[e]={x:i[0],y:i[1],z:r,distance:Yt(t.distance,s,a),elevation:K(r,c,o)}}return u}function Jt(e,t){if(e==null||t==null||e.statistics==null||e.spatialReference==null)return null;let{distance:n,elevation:r}=t,{statistics:a,spatialReference:o}=e,s=i(o),c=p(o);return{maxDistance:Yt(a.maxDistance,s,n),minElevation:K(a.minElevation,c,r),maxElevation:K(a.maxElevation,c,r),avgElevation:K(a.avgElevation,c,r),elevationGain:K(a.elevationGain,c,r),elevationLoss:K(a.elevationLoss,c,r),maxPositiveSlope:a.maxPositiveSlope,maxNegativeSlope:a.maxNegativeSlope,avgPositiveSlope:a.avgPositiveSlope,avgNegativeSlope:a.avgNegativeSlope}}function Yt(e,t,n){return e==null?null:h(e*t,`meters`,n)}function K(e,t,n){return e==null?null:h(e*t,`meters`,n)}var q=class extends de{constructor(e){super(e),this._getSamplesMemoized=Ee((e,t)=>qt(e,t)),this._getStatisticsMemoized=Ee((e,t)=>Jt(e,t)),this.rawResult=null}get available(){let{computation:e}=this;return e.profile.enabled&&e.available}get profile(){return this.computation.profile}get progress(){return Gt(this.rawResult!=null&&this.computation.profile.enabled?this.rawResult.progress:0)}get samples(){return this._getSamplesMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get statistics(){return this._getStatisticsMemoized(this.rawResult,this.computation.controller.effectiveDisplayUnits)}get hoveredPoint(){if(!this.computation.profile.enabled)return null;let e=this.computation.controller.analysisViewData.hoveredPosition;if(e==null)return null;let{rawResult:t,samples:n}=this;if(n==null||t==null)return null;let r=n.length;if(r===0)return null;let i=n[r-1].distance,a=Wt(n,e*i,e=>e.distance);if(a==null)return null;let{x:o,y:s,z:c}=a;return c==null?null:new ye({x:o,y:s,z:c,spatialReference:t.spatialReference})}};O([o()],q.prototype,`available`,null),O([o({readOnly:!0})],q.prototype,`profile`,null),O([o({readOnly:!0})],q.prototype,`progress`,null),O([o()],q.prototype,`samples`,null),O([o()],q.prototype,`statistics`,null),O([o({constructOnly:!0})],q.prototype,`computation`,void 0),O([o()],q.prototype,`rawResult`,void 0),O([o()],q.prototype,`hoveredPoint`,null),q=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileResult`)],q);var J=class extends E{constructor(e){super(e),this.result=new q({computation:this}),this.numSamplesForPreview=30,this.numSamplesPerChunk=200}initialize(){this.addHandles([A(()=>{let{geometry:e,elevationInfo:t}=this.controller.analysis;return[e,t]},()=>this.onInvalidate(this),ie)])}setResult(e){this.result.rawResult=e}clearResult(){this.setResult(null)}get progress(){return this.result.progress}get hoveredPoint(){return this.result.hoveredPoint}get available(){return!0}get minDemResolution(){return F().defaultDemResolution}};O([o({constructOnly:!0})],J.prototype,`controller`,void 0),O([o({constructOnly:!0})],J.prototype,`profile`,void 0),O([o({constructOnly:!0})],J.prototype,`onInvalidate`,void 0),O([o()],J.prototype,`result`,void 0),O([o({readOnly:!0})],J.prototype,`progress`,null),O([o()],J.prototype,`hoveredPoint`,null),O([o()],J.prototype,`available`,null),O([o()],J.prototype,`numSamplesForPreview`,void 0),O([o()],J.prototype,`numSamplesPerChunk`,void 0),O([o({readOnly:!0})],J.prototype,`minDemResolution`,null),J=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileLineComputation`)],J);function Xt(e){if(e==null)return null;if(_e(e))return Zt(e);let t=e.tileInfo;if(t==null)return null;let n=t.lods?.at(-1);return n==null?null:n.resolution*i(t.spatialReference)}function Zt(e){if(e==null)return null;let t=e.layers.items.map(Qt).filter(d);return ge(t)??null}function Qt(e){return e&&`tileInfo`in e?Xt(e):null}var Y=class extends J{constructor(){super(...arguments),this.type=`ground`,this.numSamplesForPreview=50,this.numSamplesPerChunk=1e3,this._getStableQueryElevationDependencies=B(()=>({ground:this._ground,groundLayers:this._getStableGroundLayers()}),a),this._getStableGroundLayers=B(()=>this._ground?.layers?.toArray(),a)}get minDemResolution(){return Zt(this._ground)}get available(){return!0===this._ground?.layers.some(e=>e.visible)}initialize(){this.addHandles([A(()=>this._queryElevationDependencies,()=>this.onInvalidate(this)),A(()=>this._ground,e=>{e&&!e.loaded&&e.load()},{initial:!0})])}async queryElevation(e,t){let n=this._queryElevationDependencies;if(n==null)throw Error(`${this.declaredClass}: no dependencies`);let{ground:r}=n;if(r==null)throw Error(`No ground configured in the view`);let i=await r.queryElevation(e,t),a=p(e.spatialReference),o=p(r.layers.at(0).spatialReference);if(a!==o){let e=i.geometry;e.points=e.points.map(([e,n,r])=>[e,n,r===t.noDataValue?r:r*o/a])}return i}get _queryElevationDependencies(){return this._getStableQueryElevationDependencies()}get _ground(){return this.controller.view?.map?.ground}};O([o()],Y.prototype,`minDemResolution`,null),O([o()],Y.prototype,`available`,null),O([o()],Y.prototype,`_queryElevationDependencies`,null),O([o()],Y.prototype,`_ground`,null),Y=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileLineGroundComputation`)],Y);function $t(e){return e?.map?.allLayers?.toArray().filter(e=>(e.type!==`graphics`||!e.internal)&&e.visible).map(e=>e.uid)??[]}var X=class extends J{constructor(){super(...arguments),this.type=`input`,this.numSamplesForPreview=50,this.numSamplesPerChunk=500,this._getStableElevationDependencies=B(()=>{let{view:e}=this.controller;if(!e)return null;let t=this._getStableElevationInfo();return{view:e,stationary:!this._requiresElevationAlignment||e.stationary,elevationInfo:t,visibleLayerIds:this._getStableLayerIds(),spatialReference:this._getStableSpatialReference()}},a),this._getStableElevationInfo=B(()=>this.controller.elevationInfo,ue),this._getStableSpatialReference=B(()=>this.controller.view?.spatialReference,ue),this._getStableLayerIds=B(()=>{let{view:e}=this.controller;return e.type===`3d`?$t(e):[]},a)}initialize(){let e=()=>this.onInvalidate(this);this.addHandles([A(()=>this._queryElevationDependencies,e,ie),this.controller.onElevationChange(e)])}async queryElevation(e,{noDataValue:t,signal:n}){let r=this._queryElevationDependencies;if(r==null)throw Error(`${this.declaredClass}: no dependencies`);let{view:i,spatialReference:a}=r;if(this._requiresElevationAlignment&&i.type===`3d`&&a){let r=await je.fromGeometry(e).project(a,n);if(!r)return{geometry:e,noDataValue:t};let o=i.elevationProvider;return r.coordinates.forEach(e=>{e.z=o.getElevation(e.x,e.y,0,a,`ground`)??0}),{geometry:r.export(),noDataValue:t}}return{geometry:e,noDataValue:t}}get _requiresElevationAlignment(){return this.controller.elevationInfo?.mode===`on-the-ground`&&this.controller.view.type===`3d`}get _queryElevationDependencies(){return this._getStableElevationDependencies()}};O([o()],X.prototype,`_queryElevationDependencies`,null),X=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileLineInputComputation`)],X);var Z=class extends J{constructor(){super(...arguments),this.type=`query`,this.numSamplesForPreview=50,this.numSamplesPerChunk=500}get minDemResolution(){return Xt(this.profile.source)}get available(){let{source:e}=this.profile;return!!e&&(e.visible==null||e.visible)&&(e.layers==null||e.layers.some(e=>e.visible))}initialize(){this.addHandles(A(()=>this.profile.source,()=>this.onInvalidate(this),ie))}queryElevation(e,t){if(!this.profile.source)throw Error(`No source configured for the elevation profile line`);return this.profile.source.queryElevation(e,t)}};O([o({readOnly:!0})],Z.prototype,`minDemResolution`,null),O([o()],Z.prototype,`available`,null),Z=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileLineQueryComputation`)],Z);var en=k.ofType(Be);function tn(e,t){let n=Ue(t?.excludeInternal?()=>e.map?.allLayers.filter(e=>!(`internal`in e)||!e.internal):()=>e.map?.allLayers,e=>new Be({layer:e}),{recycleItems:!0,createCollection:()=>new en}),r=new ze({enabled:!0,selfEnabled:t?.selfEnabled??!1,featureEnabled:!0,featureSources:n,distance:t?.distance??He.distance,touchSensitivityMultiplier:t?.touchSensitivityMultiplier??He.touchSensitivityMultiplier});return{...w(n),options:r}}var Q=class extends E{constructor(e){super(e),this._sketchViewModels=new k,this._updatingHandles=new ve,this._operationManager=new Pe}initialize(){let{view:e}=this;this._allLayerSnappingOptions=tn(this.view,{selfEnabled:!0,excludeInternal:!0}),this._graphicsLayer=new Ae({listMode:`hide`,internal:!0}),this.addHandles([A(()=>({map:e.map,internalGraphicsLayer:this._graphicsLayer,state:this.state,geometryVisualizationVisible:this._analysis.viewOptions.geometryVisualizationVisible,visible:this.analysisViewData.visible}),({map:e,internalGraphicsLayer:t,state:n,geometryVisualizationVisible:r,visible:i})=>{rn(e,t);let a=this.sketchGraphic;switch(a&&(a.visible=i),n){case`idle`:case`reshaping-disabled`:a&&!r&&(a.visible=!1),this._operationManager.stop(),this._ensureUpdatedSketchGraphic();break;case`reshaping`:j(this._startReshape());break;case`awaiting-sketch`:this.analysisViewData.interactive=!0}},M),A(()=>this._analysis.elevationInfo,e=>{this._graphicsLayer.elevationInfo=e},M),this._allLayerSnappingOptions])}destroy(){this._operationManager.destroy(),this._sketchViewModels.drain(e=>N(e));let e=this._graphicsLayer;this.view.map?.remove(e),e.destroy()}get sketchGraphic(){return this._get(`sketchGraphic`)}set sketchGraphic(e){e!==this._get(`sketchGraphic`)&&(this._set(`sketchGraphic`,e),this._updateAnalysisFromSketchGraphic())}get state(){let{visible:e,interactive:t}=this.analysisViewData;if(!e)return`idle`;switch(this._operationManager.currentOperationType){case`place`:return this._sketching?`sketching`:`awaiting-sketch`;case`pick-feature`:return`picking`;default:return this._analysis.geometry?t?`reshaping`:`reshaping-disabled`:`idle`}}get updating(){return this._sketchViewModels.some(e=>e.updating)||this._updatingHandles.updating}get _sketching(){return this._sketchViewModels.some(e=>e.createGraphic===this.sketchGraphic)}get _analysis(){return this.analysisViewData.analysis}get _lineSymbol(){return nn(this.view.type)}place(e){return this._operationManager.start(`place`,async t=>{let n=this._createSketchViewModel(),r=this._analysis.clone();this._ensureUpdatedSketchGraphic();let i=this.sketchGraphic,a=this._analysis.elevationInfo,o=T(()=>{this.sketchGraphic===i&&(this._graphicsLayer.elevationInfo=a)}),s=n.on(`create`,e=>{switch(e.state){case`start`:this._graphicsLayer.removeAll(),this.sketchGraphic=e.graphic,this._analysis.elevationInfo=this._graphicsLayer.elevationInfo;break;case`active`:this._updateAnalysisFromSketchGraphic();break;case`complete`:this.sketchGraphic&&(this._updateAnalysisFromSketchGraphic(),this._addSketchGraphic(this.sketchGraphic)),t.stop();break;case`cancel`:t.stop()}});t.handles.push(s,T(()=>(s.remove(),n.destroy(),this._sketchViewModels.remove(n),this._updateAnalysisFromSketchGraphic(),this._analysis.valid?m(e)||r.equals(this._analysis)?t.reject():void t.resolve({}):(this._clear(),t.reject()))),o),this._graphicsLayer.elevationInfo=an,await this._updatingHandles.addPromise(j(n.create(`polyline`)))},e)}async pickFeature(e){return this._operationManager.start(`pick-feature`,async e=>{let{view:t}=this;t.closePopup();let n=null;e.handles.push(t.on(`immediate-click`,r=>{r.defer(async()=>{n?.abort(),n=ce(async n=>{let{results:i}=await t.hitTest(r);D(n);let a=null;for(let e of i)if(e.type===`graphic`&&st(e.graphic)&&!dt(e.graphic)){a=e.graphic;break}a&&(r.preventDefault(),r.stopPropagation(),this.sketchGraphic=null,this._analysis.setGeometryFromFeature(a),e.resolve({feature:a}),e.stop())}),await n.promise})},l.TOOL),t.on(`key-down`,t=>{ae(t)&&(e.reject(),e.stop())},l.TOOL),t.acquireCursor(`crosshair`,`high`),T(()=>{n?.abort(),e.reject()})),t.focus()},e)}_startReshape(){let e=this._createSketchViewModel();return this._sketchViewModels.add(e),this._operationManager.start(`reshape`,async t=>{let n=()=>{let t=this._ensureUpdatedSketchGraphic();return t?this._updatingHandles.addPromise(e.update(t,{tool:`reshape`})):Promise.resolve()};if(!this._ensureUpdatedSketchGraphic())return;let r=e.on(`update`,e=>{this._updateAnalysisFromSketchGraphic(),e.state===`complete`&&(this.state===`reshaping`?j(n()):t.resolve())});t.handles.push(r,T(()=>{r.remove(),this._sketchViewModels.remove(e),e.destroy(),t.resolve()})),await n()})}_createSketchViewModel(){return new Ve({layer:this._graphicsLayer,view:this.view,defaultCreateOptions:{mode:`click`,hasZ:!0},updateOnGraphicClick:!1,defaultUpdateOptions:{enableMoveAllGraphics:!1,enableRotation:!1,enableScaling:!1,enableZ:!1,highlightOptions:{enabled:!1},multipleSelectionEnabled:!1,reshapeOptions:{shapeOperation:`none`},toggleToolOnClick:!1,tool:`reshape`},polylineSymbol:this._lineSymbol,activeLineSymbol:this._lineSymbol,snappingOptions:this._allLayerSnappingOptions.options})}_ensureUpdatedSketchGraphic(){let{geometry:e}=this._analysis;if(!e)return this.sketchGraphic=null,this._graphicsLayer.removeAll(),null;let t=this.sketchGraphic??=new Ce({symbol:this._lineSymbol,geometry:e});return t.geometry=e,this._addSketchGraphic(t),t}_addSketchGraphic(e){let{graphics:t}=this._graphicsLayer;t.includes(e)||t.add(e),t.length!==1&&t.removeMany(t.filter(t=>t!==e))}_clear(){this.sketchGraphic=null,this._analysis.clear()}_updateAnalysisFromSketchGraphic(){let e=this.sketchGraphic?.geometry;lt(e)||(e=null);let t=this._analysis;t.geometry!==e&&(t.geometry=e)}};function nn(e){if(e===`2d`){let e={type:`CIMSolidStroke`,enable:!0,capStyle:`Butt`,joinStyle:`Round`,width:1.5};return new c({data:{type:`CIMSymbolReference`,symbol:{type:`CIMLineSymbol`,symbolLayers:[{...e,effects:[{type:`CIMGeometricEffectDashes`,dashTemplate:[5,4],lineDashEnding:`FullGap`,controlPointEnding:`NoConstraint`}],color:[0,0,0,255]},{...e,color:[255,255,255,255]}]}}})}return new fe({color:[0,0,0,0]})}function rn(e,t){t&&(t.removeFromParent(),e?.add(t))}O([o({constructOnly:!0})],Q.prototype,`analysisViewData`,void 0),O([o({constructOnly:!0})],Q.prototype,`view`,void 0),O([o()],Q.prototype,`sketchGraphic`,null),O([o({nonNullable:!0})],Q.prototype,`state`,null),O([o()],Q.prototype,`updating`,null),O([o()],Q.prototype,`_sketching`,null),O([o()],Q.prototype,`_analysis`,null),O([o()],Q.prototype,`_lineSymbol`,null),Q=O([g(`esri.views.analysis.ElevationProfile.ElevationProfileTool`)],Q);var an=new Te({mode:`on-the-ground`,offset:0}),$=class extends Ne{constructor(e){super(e),this.type=`elevation-profile-view-2d`,this.analysis=null,this.hoveredPosition=null}initialize(){let{analysis:e,view:t}=this;this._controller=new G({analysis:e,analysisViewData:this,view:t,computationFactory:{create:e=>{switch(e.profile.type){case`ground`:return new Y(e);case`input`:return new X(e);case`query`:return new Z(e);case`scene`:throw new r(`elevation-profile-analysis-view-2d:unsupported`,`The scene profile line type is not supported in 2D views.`)}}}}),this._visualization=new z({view:t,analysisViewData:this}),this._sketchTool=new Q({view:t,analysisViewData:this})}destroy(){this._controller?.destroy(),this._visualization?.destroy(),this._sketchTool?.destroy()}get effectiveDisplayUnits(){return this._controller?.effectiveDisplayUnits??{distance:`meters`,elevation:`meters`}}get error(){return this._controller?.error}get hoveredPoints(){return this._controller?.hoveredPoints??[]}get interactive(){return super.interactive}set interactive(e){super.interactive=e}get progress(){return this._controller?.progress??0}get results(){return this._controller?.results??[]}get statistics(){return this._controller?.statistics}get updating(){return!0===this._controller?.updating||!0===this._visualization?.updating||!0===this._sketchTool?.updating}get visible(){return super.visible}set visible(e){super.visible=e}get sketchGraphic(){return this._sketchTool?.sketchGraphic}get toolState(){return this._sketchTool?.state??`idle`}place(e){return this._sketchTool.place(e)}pickFeature(e){return this._sketchTool.pickFeature(e)}};O([o({readOnly:!0})],$.prototype,`type`,void 0),O([o({constructOnly:!0,nonNullable:!0})],$.prototype,`analysis`,void 0),O([o({readOnly:!0})],$.prototype,`effectiveDisplayUnits`,null),O([o({readOnly:!0})],$.prototype,`error`,null),O([o()],$.prototype,`hoveredPosition`,void 0),O([o()],$.prototype,`hoveredPoints`,null),O([o({readOnly:!0})],$.prototype,`progress`,null),O([o({readOnly:!0})],$.prototype,`results`,null),O([o({readOnly:!0})],$.prototype,`statistics`,null),O([o({readOnly:!0})],$.prototype,`updating`,null),O([o()],$.prototype,`sketchGraphic`,null),O([o()],$.prototype,`toolState`,null),O([o()],$.prototype,`_controller`,void 0),O([o()],$.prototype,`_visualization`,void 0),O([o()],$.prototype,`_sketchTool`,void 0),$=O([g(`esri.views.2d.analysis.ElevationProfileAnalysisView2D`)],$);var on=$;export{on as default};