import{RS as e,SC as t,du as n,gC as r,ha as i,hu as a}from"./index-CZ4oMP1N.js";import{t as o}from"./urlUtils-BholpLvl.js";import{t as s}from"./queryUtils-D1dUonfL.js";import{t as c}from"./PivotQuery-DIW1lqua.js";function l(e){let t=s(e),n=t.outPivots;if(n?.length){for(let e of n)e.pivotType===`Pivot`&&e.pivotParameters.outStatistic?e.pivotParameters.outStatistic=JSON.stringify(e.pivotParameters.outStatistic):e.pivotType===`Unpivot`&&(e.unPivotParameters.sourceFields=e.unPivotParameters.sourceFields.join(`,`));t.outPivots=JSON.stringify(n)}return t}async function u(e,t,n){return await d(e,t,n)}async function d(i,a,s={}){let c=typeof i==`string`?r(i):i,u=a.geometry?[a.geometry]:[],d=await n(u,null,{signal:s.signal}),f=d?.[0];f!=null&&((a=a.clone()).geometry=f);let p=o({...c.query,f:`json`,...l(a)});return e(t(c.path,`queryPivot`),{...s,query:{...p,...s.query}})}async function f(e,t,n){let r=a(e),o={...n},{data:s}=await u(r,c.from(t),o);return i.fromJSON(s)}export{f as executePivotQuery};